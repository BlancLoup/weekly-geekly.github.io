<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing FreeBSD 9.0 on a Hetzner server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 When FreeBSD 9.0 came out, I set out to install this system on the server that I just installed at Hetzner. Although they do not openly...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing FreeBSD 9.0 on a Hetzner server</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  When <b>FreeBSD 9.0</b> came out, I set out to install this system on the server that I just installed at Hetzner.  Although they do not openly propose and do not allow to install FreeBSD, however, it is quite possible to do this through the <b>Rescue System</b> .  But, as it turned out, you can install only FreeBSD 7.4 and FreeBSD 8.2. <br><br>  After communicating with Hetzner support service, they replied that they were ready to insert a disc with this software for an additional fee.  Of course, this was not part of the budget. <br><br>  There are many tips on upgrading FreeBSD from version 8 to version 9 on the Internet, but they either do not fully reflect the essence of the problem, or do not allow you to upgrade anything at all.  I spent a lot of time before I managed to do it, so I decided to write this article, which will help save time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So let's get started. <br><a name="habracut"></a><br><h5>  1. Installing the FreeBSD version from Henzner </h5><br><br>  <b>Start Rescue System</b> <br><br>  First you need to activate the Rescue System and log in via ssh to the server, as written in the instructions from Hetzner. <br><br><h6>  To start the installation, run the following command. </h6><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># installimage</span></span></code> </pre> <br><br><h6>  Then we specify the parameters and run the installation.  The whole installation takes only a few minutes, as a result we get </h6><br><pre> <code class="bash hljs">Hetzner Online AG - installimage Your server will be installed now, this will take some time You can abort at any time with CTRL+C ‚Ä¶ Deleting selected harddrive(s)‚Ä¶ DONE Creating a file system and extracting the image‚Ä¶ DONE Copying kernel‚Ä¶ DONE Configuring rc.conf‚Ä¶ DONE Configuring loader.conf‚Ä¶ DONE Enabling SSH login <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> root‚Ä¶ DONE Configuring resolv.conf‚Ä¶ DONE Congratulations! The configuration has been completed successfully. You can now use <span class="hljs-string"><span class="hljs-string">'reboot'</span></span> to boot your newly installed FreeBSD system.</code> </pre><br><br><h6>  After installation we reboot </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># reboot</span></span></code> </pre><br><br><h5>  2 Setting data for update </h5><br>  We will update the system through sup.  In my opinion, the easiest and correct way to upgrade the system. <br>  sup is included in the regular FreeBSD operating system tools. <br><br><h6>  Go to the directory </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cd /usr/share/examples/cvsup/</span></span></code> </pre><br><br><h6>  Check </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ls README gnats-supfile refuse.README www-supfile cvs-supfile ports-supfile stable-supfile doc-supfile refuse standard-supfile</span></span></code> </pre><br><br>  Now you need to specify a new version of the operating system. <br>  The default is the current version. <br><br><h6>  We copy the configuration file </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cp standard-supfile standard-supfile-UPDATE_9</span></span></code> </pre><br><br><h6>  Edit it </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ee standard-supfile-UPDATE_9 *default host=CHANGE_THIS.FreeBSD.org *default base=/var/db *default prefix=/usr *default release=cvs tag=RELENG_9_0 *default delete use-rel-suffix *default compress src-all</span></span></code> </pre><br><br><h6>  We synchronize the source code of the src, the new operating system </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /usr/bin/csup -h cvsup4.ru.freebsd.org -g -L 2 \</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#? /usr/share/examples/cvsup/standard-supfile-UPDATE_9</span></span></code> </pre><br><br>  After all the files are copied, you need to read the file / usr / src / UPDATING (To avoid problems) <br><br>  Now you need to enable the generation of the profiling code (set NO_PROFILE = true in the /etc/make.conf file). <br><br>  And there you need to set the value of CFLAGS to -O2 -pipe. <br><br>  -pipe allows the compiler to use soft channels instead of temporary files for communication, <br>  which reduces disk access (at the expense of RAM). <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ee /etc/make.conf NO_PROFILE=true CFLAGS= -O2 -pipe</span></span></code> </pre><br><br><h6>  You also need to add the line to make.conf: KERNCONF = MYKERNEL, so as not to write when building and installing the kernel </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># make build kernel KERNCONF=MYKERNEL</span></span></code> </pre><br><br><h6>  but just </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># make build kernel</span></span></code> </pre><br><br><h6>  Edit the /etc/src.conf file </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ee /etc/src.conf WITHOUT_BLUETOOTH=TRUE WITHOUT_GAMES=TRUE</span></span></code> </pre><br><br>  In general, the make.conf config can be supplemented with many parameters, it depends on what compilation parameters you need. <br><br><h6>  My config make.conf </h6><br><habracut text=""><br><pre> <code class="bash hljs">CPUTYPE?=nocona CFLAGS= -O2 -fno-strict-aliasing -pipe <span class="hljs-comment"><span class="hljs-comment"># CXXFLAGS= -O2 -pipe #         . COPTFLAGS= -O2 -pipe -funroll-loops -ffast-math -fno-strict-aliasing OPTIMIZED_CFLAGS=YES KERNCONF=GARPIX BUILD_OPTIMIZED=YES WITH_CPUFLAGS=YES WITHOUT_DEBUG=YES WITH_OPTIMIZED_CFLAGS=YES NO_PROFILE=YES BUILD_STATIC=YES WITHOUT_X11=YES DWITH_SLANG=YES DLLVM_HOSTTRIPLE="x86_64-garpix-freebsd9.0" STRIP= CFLAGS+=-fno-omit-frame-pointer WITH_CTF=1 # added by use.perl 2012-02-07 19:02:35 PERL_VERSION=5.12.4</span></span></code> </pre><br><br><br><h6>  Get the kernel sources </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># svn checkout svn://svn.freebsd.org/base/releng/9.0 /usr/src</span></span></code> </pre><br><br><h6>  Go to the directory with the kernel </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cd /usr/src/sys/amd64/conf</span></span></code> </pre><br><br><h6>  We copy a config with a kernel in the directory created for earlier </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mkdir /root/kernels # cp GENERIC /root/kernels/MYKERNEL # ln -s /root/kernels/MYKERNEL</span></span></code> </pre><br><br>  Now you need to configure the kernel for your computer. <br>  <a href="http://www.freebsd.org/doc/ru/books/handbook/kernelconfig-config.html">Read more about this on the official FreeBSD website.</a> <br><br><h6>  My kernel config </h6><br><habracut text=""><br><pre> <code class="bash hljs">cpu HAMMER ident MYKERNEL makeoptions DEBUG=-g <span class="hljs-comment"><span class="hljs-comment"># Build kernel with gdb(1) debug symbols makeoptions WITH_CTF=1 makeoptions MODULES_OVERRIDE="zfs opensolaris dtrace cyclic nfsclient krpc nfs_common nfslock" options SCHED_ULE # ULE scheduler options PREEMPTION # Enable kernel thread preemption options INET # InterNETworking options INET6 # IPv6 communications protocols options IPFIREWALL # Firewall IPFw #options IPFIREWALL_DEFAULT_TO_ACCEPT # Accept to Firewall options IPFIREWALL_VERBOSE # Enable Logs from Firewall #options IPFIREWALL_VERBOSE_LIMIT=10 # Limit logs from Firewall options DUMMYNET # Speed Traffic to Firewall options SCTP # Stream Control Transmission Protocol options FFS # Berkeley Fast Filesystem options SOFTUPDATES # Enable FFS soft updates support options UFS_ACL # Support for access control lists options UFS_DIRHASH # Improve performance on big directories options UFS_GJOURNAL # Enable gjournal-based UFS journaling options MD_ROOT # MD is a potential root device options NFSCL # New Network Filesystem Client options NFSD # New Network Filesystem Server options NFSLOCKD # Network Lock Manager options NFS_ROOT # NFS usable as /, requires NFSCL options CD9660 # ISO 9660 Filesystem options PROCFS # Process filesystem (requires PSEUDOFS) options PSEUDOFS # Pseudo-filesystem framework options GEOM_PART_GPT # GUID Partition Tables. options GEOM_LABEL # Provides labelization options SCSI_DELAY=5000 # Delay (in ms) before probing SCSI options KTRACE # ktrace(1) support options STACK # stack(9) support options SYSVSHM # SYSV-style shared memory options SYSVMSG # SYSV-style message queues options SYSVSEM # SYSV-style semaphores options _KPOSIX_PRIORITY_SCHEDULING # POSIX P1003_1B real-time extensions options PRINTF_BUFR_SIZE=128 # Prevent printf output being interspersed. options KBD_INSTALL_CDEV # install a CDEV entry in /dev options HWPMC_HOOKS # Necessary kernel hooks for hwpmc options AUDIT # Security event auditing options MAC # TrustedBSD MAC Framework options KDTRACE_FRAME # Ensure frames are compiled in options KDTRACE_HOOKS # Kernel DTrace hooks options DDB_CTF # all architectures - kernel ELF linker loads CTF data options INCLUDE_CONFIG_FILE # Include this file in kernel options KDB # Kernel debugger related code options KDB_TRACE # Print a stack trace for a panic options COMPAT_FREEBSD8 # Compatible with FreeBSD8 options P1003_1B_SEMAPHORES # POSIX-style semaphores options DEVICE_POLLING # Polling Network Enabled # Settings for max connections = 256options SEMMNI=512 options SEMMNS=1024 options SEMUME=64 options SEMMNU=512 # Make an SMP-capable kernel by default options SMP # Symmetric MultiProcessor Kernel # CPU frequency control device cpufreq # Bus support.device acpi device pci # ATA controllers device ahci # AHCI-compatible SATA controllers device ata # Legacy ATA/SATA controllers options ATA_CAM # Handle legacy controllers with CAM options ATA_STATIC_ID # Static device numbering device mvs # Marvell 88SX50XX/88SX60XX/88SX70XX/SoC SATA device siis # SiliconImage SiI3124/SiI3132/SiI3531 SATA # ATA/SCSI peripherals device scbus # SCSI bus (required for ATA/SCSI) device ch # SCSI media changers device da # Direct Access (disks) device sa # Sequential Access (tape etc) device cd # CD device pass # Passthrough device (direct ATA/SCSI access) device ses # SCSI Environmental Services (and SAF-TE) # RAID controllers interfaced to the SCSI subsystem device hptrr # Highpoint RocketRAID 17xx, 22xx, 23xx, 25xx # atkbdc0 controls both the keyboard and the PS/2 mouse device atkbdc # AT keyboard controller device atkbd # AT keyboard device psm # PS/2 mouse device via # VGA video card driver # sys cons is the default console driver, resembling an SCO console device sc options SC_PIXEL_MODE # add support for the raster text mode # Serial (COM) ports device uart # Generic UART driver device put # Multi I/O cards and multi-channel UARTs # PCI Ethernet NICs. device bxe # Broadcom BCM57710/BCM57711/BCM57711E 10Gb Ethernet&gt; device de # DEC/Intel DC21x4x (``Tulip)&gt; device em # Intel PRO/1000 Gigabit Ethernet Family&gt; device igb # Intel PRO/1000 PCIE Server Gigabit Family&gt; device ixgbe # Intel PRO/10GbE PCIE Ethernet Family&gt; device le # AMD Am7900 LANCE and Am79C9xx PCnet&gt; device ti # Alteon Networks Tigon I/II gigabit Ethernet&gt; device txp # 3Com 3cR990 (``Typhoon)&gt; device vx # 3Com 3c590, 3c595 (``Vortex)&gt; # PCI Ethernet NICs that use the common MII bus controller code.&gt; # </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">NOTE:</span></span></span><span class="hljs-comment"> Be sure to keep the 'device minibus' line in order to use these NICs!&gt; device minibus # MII bus support&gt; device ae # Attansic/Atheros L2 FastEthernet&gt; device age # Attansic/Atheros L1 Gigabit Ethernet&gt; device alc # Atheros AR8131/AR8132 Ethernet&gt; device ale # Atheros AR8121/AR8113/AR8114 Ethernet&gt; device bce # Broadcom BCM5706/BCM5708 Gigabit Ethernet&gt; device bfe # Broadcom BCM440x 10/100 Ethernet&gt; device bge # Broadcom BCM570xx Gigabit Ethernet&gt; device dc # DEC/Intel 21143 and various workalikes&gt; device et # Agere ET1310 10/100/Gigabit Ethernet&gt; device fxp # Intel EtherExpress PRO/100B (82557, 82558)&gt; device jme # JMicron JMC250 Gigabit/JMC260 Fast Ethernet&gt; device leg # Level 1 LXT1001 gigabit Ethernet&gt; device msk # Marvell/SysKonnect Yukon II Gigabit Ethernet&gt; device nfe # nVidia nForce MCP on-board Ethernet&gt; device nge # NatSemi DP83820 gigabit Ethernet&gt; device pcn # AMD Am79C97x PCI 10/100 (precedence over 'le')&gt; device re # RealTek 8139C+/8169/8169S/8110S&gt; device rl # RealTek 8129/8139&gt; device sf # Adaptec AIC-6915 (``Starfire)&gt; device sge # Silicon Integrated Systems SiS190/191&gt; device sis # Silicon Integrated Systems SiS 900/SiS 7016&gt; device sk # SysKonnect SK-984x &amp; SK-982x gigabit Ethernet&gt; device ste # Sundance ST201 (D-Link DFE-550TX)&gt; device stge # Sundance/Tamarack TC9021 gigabit Ethernet&gt; device tl # Texas Instruments ThunderLAN&gt; device tx # SMC EtherPower II (83c170 ``EPIC)&gt; device vge # VIA VT612x gigabit Ethernet&gt; device vr # VIA Rhine, Rhine II&gt; device wb # Winbond W89C840F&gt; device xl # 3Com 3c90x (``Boomerang, ``Cyclone)&gt; # Pseudo devices. device loop # Network loopback device random # Entropy device device ether # Ethernet support device vlan # 802.1Q VLAN support device tun # Packet tunnel. device pty # BSD-style compatibility pseudo ttys device md # Memory "disks" device gif # IPv6 and IPv4 tunneling device faith # IPv6-to-IPv4 relaying (translation) device firmware # firmware assist module # The `bpf' device enables the Berkeley Packet Filter. # Be aware of the administrative consequences of enabling this! # Note that 'bpf' is required for DHCP. device bpf # Berkeley packet filter # USB support options USB_DEBUG # enable debug msgs device uhci # UHCI PCI-&gt;USB interface device ohci # OHCI PCI-&gt;USB interface device ehci # EHCI PCI-&gt;USB interface (USB 2.0) device xhci # XHCI PCI-&gt;USB interface (USB 3.0) device usb # USB Bus (required) device uhid # "Human Interface Devices" device ukbd # Keyboard device ulpt # Printer device umass # Disks/Mass storage - Requires scbus and da device ums # Mouse</span></span></code> </pre><br><br><br><h6>  After the kernel is configured, go to the directory with the source / usr / src </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cd /usr/src</span></span></code> </pre><br><br><h6>  I almost forgot, you need to add the following option to your kernel config </h6><br><pre> <code class="bash hljs">options COMPAT_FREEBSD8 <span class="hljs-comment"><span class="hljs-comment"># Compatible with FreeBSD8</span></span></code> </pre><br><br><h6>  Now edit the following files by adding lines. </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ee /usr/src/sys/conf/NOTES # Enable FreeBSD8 compatibility syscalls options COMPAT_FREEBSD8 # ee /usr/src/sys/conf/options COMPAT_FREEBSD8 opt_compat.h</span></span></code> </pre><br><br><h6>  Go to the compilation of the world and the kernel </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cd /usr/src # make kernel-toolchain</span></span></code> </pre><br><br>  wait until the process is over <br><br><h6>  Now compile the kernel </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># make build kernel</span></span></code> </pre><br><br><h6>  When the kernel is compiled, install it. </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># make install kernel</span></span></code> </pre><br><br><h6>  Now you need to compile the world </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># make build world</span></span></code> </pre><br><br>  The world compiles for a very long time, you have to wait <br><br>  We look at the output date and if the output is incorrect, then <a href="http://www.malevanov.spb.ru/freebsd/mergemaster/">you must read the article</a> <br><br><h6>  Now do the following </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># adjkerntz -i # cd /usr/src</span></span></code> </pre><br><br><h6>  Installing configuration files </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mergemaster -a -p</span></span></code> </pre><br><br><h6>  If you have questions, you should always press <b>i</b> </h6><br><pre> <code class="bash hljs">i  [Enter]</code> </pre><br><br><h6>  Sometimes you need to press <b>d</b> if there are no other options. </h6><br><pre> <code class="bash hljs">d  [Enter]</code> </pre><br><br>  i - Install new configuration files <br>  d - Delete temporary configuration files <br><br><h6>  Now delete the rc.d directory </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># rm -rf /etc/rc.d</span></span></code> </pre><br><br><h6>  We continue to install configs </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mergemaster -i -p # mergemaster -p</span></span></code> </pre><br><br><h6>  Set the world </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># make install world</span></span></code> </pre><br><br><h6>  Once the world is established, copy the world configs </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mergemaster -a # mergemaster -i # mergemaster</span></span></code> </pre><br><br>  <b>You need to perform in turn, without forgetting the parameters i and d, there will be many questions.</b> <br><br>  That's all, the new system is installed, but <b>you cannot restart the computer yet</b> <br><br><h6>  Change password at root user </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># passwd</span></span></code> </pre><br><br><h6>  Now you need to configure SSH and then the system will not enter </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ee /etc/ssh/sshd_config</span></span></code> </pre> <br><br><pre> <code class="bash hljs">PermitRootLogin yes</code> </pre><br><br><h5>  Check whether everything fell as it should </h5><br><br><h6>  What sense are the demons running?  Read /etc/rc.conf, is there any service that can be started in alternative ways, you can find out by looking </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># sockstat -l</span></span></code> </pre><br><br><h6>  Also in /etc/rc.conf, network settings </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># less, tail, cat -  ,   .</span></span></code> </pre><br><br><h6>  Content /var/run/dmesg.boot will tell all about the hardware used </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pciconf -lv</span></span></code> </pre><br><br><h6>  Show all hardware, both used and unused </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># atacontrol list</span></span></code> </pre><br><br><h6>  Will display a list of ATA devices </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># camcontrol devlist</span></span></code> </pre><br><br><h6>  Will display a list of USB devices </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># usbconfig list</span></span></code> </pre><br><br><h6>  Now set the time zone </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cp /usr/share/zoneinfo/Europe/Moscow /etc/localtime # date</span></span></code> </pre><br><br>  or <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># setenv TZ Europe/Moscow-04:00 # date</span></span></code> </pre><br><br><h5>  Locale setting </h5><br><br><h6>  By default, the koi8-r encoding is installed on FreeBSD (in my opinion, this is the last century, changing to utf-8) </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#ee /etc/login.conf</span></span></code> </pre><br><br><pre> <code class="bash hljs">russian|Russian Users Accounts:\ :charset=UTF-8:\ :lang=ru_RU.UTF-8:\ :tc=default:</code> </pre><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cap_mkdb /etc/login.conf # pw usermod -n $username -L russian</span></span></code> </pre><br><br><h6>  In addition to the above method, you can write variables in the shell used </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#ee /etc/csh.cshrc</span></span></code> </pre><br><br><pre> <code class="bash hljs">setenv LANG ru_RU.UTF-8 setenv LC_CTYPE ru_RU.UTF-8 setenv LC_COLLATE POSIX setenv LC_ALL ru_RU.UTF-8</code> </pre><br><br><h6>  Optionally, for those who love bash </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ee /etc/profile</span></span></code> </pre><br><br><pre> <code class="bash hljs">LANG=<span class="hljs-string"><span class="hljs-string">"ru_RU.UTF-8"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LANG LC_CTYPE=<span class="hljs-string"><span class="hljs-string">"ru_RU.UTF-8"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LC_CTYPE LC_COLLATE=<span class="hljs-string"><span class="hljs-string">"POSIX"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LC_COLLATE LC_ALL=<span class="hljs-string"><span class="hljs-string">"ru_RU.UTF-8"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LC_ALL</code> </pre><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ee /root/.cshrc</span></span></code> </pre><br><br><pre> <code class="bash hljs">setenv LANG ru_RU.UTF-8 setenv LC_CTYPE ru_RU.UTF-8 setenv LC_COLLATE POSIX setenv LC_ALL ru_RU.UTF-8</code> </pre><br><br><h6>  Next, just type in the console </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># setenv LANG ru_RU.UTF-8 # setenv LC_CTYPE ru_RU.UTF-8 # setenv LC_COLLATE POSIX # setenv LC_ALL ru_RU.UTF-8</span></span></code> </pre><br><br><h6>  Register settings in sysctl </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ee /etc/sysctl.conf</span></span></code> </pre><br><br>  <b>Attention data settings for my server, they depend on many parameters, computer hardware, the amount of RAM, type of processor, server load, and so on.</b> <br><br><habracut text=""><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># $FreeBSD: src/etc/sysctl.conf,v 1.8.40.1.2.1 2011/11/11 04:20:22 kensmith Exp $ # # This file is read when going to multi-user and its contents piped thru # ``sysctl to adjust kernel values. ``man 5 sysctl.conf for details. # # Uncomment this to prevent users from seeing information about processes that # are being run under another UID. #security.bsd.see_other_uids=0 kern.ipc.shmall=2048000 kern.ipc.shmmax=4461780992 kern.ipc.semmap=16000 net.inet.tcp.blackhole=2 net.inet.udp.blackhole=1 # kern.ipc.nmbclusters=65536 kern.ipc.somaxconn=32768 kern.ipc.maxsockets=204800 kern.ipc.maxsockbuf=262144 kern.ipc.shm_use_phys=1 kern.maxfiles=256000 kern.maxfilesperproc=230400 net.inet.ip.portrange.first=1024 net.inet.ip.portrange.last=65535 net.inet.ip.portrange.randomized=0 net.inet.tcp.maxtcptw=40960 net.inet.ip.intr_queue_maxlen=4096 net.inet.tcp.msl=40000 net.inet.tcp.finwait2_timeout=40000 net.inet.tcp.syncookies=1 # In Large Load sent ansver selective net.inet.tcp.delayed_ack=0 net.inet.tcp.sack.enable=0 net.inet.tcp.msl=30000 net.inet.tcp.nolocaltimewait=1 net.inet.tcp.fast_finwait2_recycle=1 net.inet.icmp.drop_redirect=1 net.inet.icmp.log_redirect=1 net.inet.ip.redirect=0 net.inet.ip.fw.enable=1 net.inet.flowtable.enable=0 net.inet6.ip6.fw.enable=1 net.inet6.ip6.redirect=0 net.inet6.ip6.accept_rtadv=1 net.inet.tcp.sendspace=16384 net.inet.tcp.recvspace=8192 net.inet.tcp.recvbuf_auto=0 net.inet.tcp.sendbuf_auto=1 net.inet.tcp.sendbuf_inc=8192 net.inet.tcp.sendbuf_max=131072 net.link.ether.inet.max_age=1200 net.inet.tcp.maxtcptw=102400 net.inet.tcp.nolocaltimewait=1 net.inet.tcp.syncookies=1 net.isr.direct=0 kern.polling.enable=1 kern.polling.burst_max=1000 kern.polling.each_burst=50 net.inet.icmp.icmplim=100 net.inet.tcp.rfc3465=0 # Security Jail security.jail.sysvipc_allowed=1 security.jail.allow_raw_sockets=1 security.jail.chflags_allowed=1 security.jail.set_hostname_allowed=1</span></span></code> </pre><br><br><h6>  We configure bootLoader (I give an example of the config, I <b>will</b> repeat <b>it for my server</b> and I give for the sake of an example) </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ee /boot/loader.conf</span></span></code> </pre><br><br><br><habracut text=""><br><pre> <code class="bash hljs">zfs_load=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> vfs.root.mountfrom=<span class="hljs-string"><span class="hljs-string">"zfs:garpix/root"</span></span> vfs.zfs.zio.use_uma=<span class="hljs-string"><span class="hljs-string">"0"</span></span> ahci_load=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> aio_load=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> geom_mirror_load=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> geom_stripe_load=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> geom_cache_load=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> geom_label_load=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> accf_http_load=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> accf_data_load=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> accf_dns_load=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> coretemp_load=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> if_em_load=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> verbose_loading=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> boot_verbose=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> vm.kmem_size_max=<span class="hljs-string"><span class="hljs-string">"4G"</span></span> vm.kmem_size=<span class="hljs-string"><span class="hljs-string">"4G"</span></span> <span class="hljs-comment"><span class="hljs-comment"># HPET Enable kern.timecounter.hardware=HPET # Dtrace dtraceall_load="YES" # Semafores kern.ipc.semmni=1024 kern.ipc.semmns=2048 kern.ipc.semmnu=1024 kern.maxfiles=204800 kern.maxfilesperproc=200000 kern.ipc.maxsockets=204800 kern.ipc.nmbclusters=204800 kern.ipc.nmbjumbop=192000 kern.ipc.somaxconn=8192 kern.ipc.shmmax=2147483648 kern.ipc.maxsockbuf=10485760 kern.ipc.nsfbufs=10240 kern.maxvnodes=200000 kern.ps_arg_cache_limit=4096 # TCP Steck #net.inet.tcp.syncache.hashsize=1024 #net.inet.tcp.syncache.bucketlimit=100 #net.inet.tcp.syncache.cachelimit=65536 #net.inet.tcp.hostcache.cachelimit=1966080 #net.inet.tcp.tcbhashsize=32768 vm.pmap.shpgperproc=2048 vm.pmap.pg_ps_enabled=1 hw.bge.allow_asf=1 loader_logo="MYLOGO"</span></span></code> </pre><br><br><br><h6>  RC.CONF settings </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ee /etc/rc.conf</span></span></code> </pre><br><br>  I give for example my rc.conf config (media 100BaseTX mediaopt full-duplex, flag0 depend on the ‚ÄúHetzner‚Äù data center), this needs to be checked with the support service as I have a <b>media autoselect</b> on another server in another data center I also have the Hetzner IPv6 settings I will not describe this topic in detail for a separate article, but by example you can do it and it will work. <br><br><habracut text=""><br><pre> <code class="bash hljs">hostname=<span class="hljs-string"><span class="hljs-string">"garpix"</span></span> sshd_enable=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> sendmail_enable=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> zfs_enable=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> <span class="hljs-comment"><span class="hljs-comment"># IPv4 inet config ntpd_enable="YES" ifconfig_re0="inet xxx.xxx.xxx.xxx netmask xxx.xxx.xxx.xxx media 100BaseTX mediaopt full-duplex,flag0" defaultrouter="xxx.xxx.xxx.xxx" # IPv6 inet6 config ipv6_network_interfaces="re0" ifconfig_re0_ipv6="inet6 2a01:4f8:141:54c3::2 prefixlen 64 accept_rtadv" ipv6_default_interface="re0" ipv6_static_routes="gw defgw" ipv6_route_gw="2a01:4f8:141:54c0:: -prefixlen 59 -iface re0" ipv6_route_defgw="default 2a01:4f8:141:54c0::1" # Firewall firewall_enable="YES" firewall_script="/etc/rc.ipfw"</span></span></code> </pre><br><br><br><h6>  And most importantly, now you need to configure Firewall </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ee /etc/rc.ipfw</span></span></code> </pre><br><br><h6>  RC.IPFW </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh ipfw -q -f flush oif="re0" cmd="ipfw -q add " ks="keep-state" tcp_out="20,21,22,25,80,110,137,138,139,143,443,445,2802,3306,5190,6667,8080,9000" tcp_in="20,21,22,80,443,8080,5432" tcp6_in="::80,::443" ftp_high="21,1024-65535" udp_out="53,999,1234" udp_in="1234" # allow all #$cmd 00100 pass all from any to any # deny all $cmd 00100 pass all from any to any via lo0 $cmd 00101 deny all from any to 127.0.0.0/8 $cmd 00102 deny all from 127.0.0.0/8 to any $cmd 00500 check-state $cmd 00502 deny all from any to any frag $cmd 00501 deny tcp from any to any established $cmd 00600 allow tcp from any to any out via $oif setup $ks $cmd 00601 allow udp from any to any out via $oif $ks # IPv6 $cmd 00701 allow ip6 from any to any $tcp6_in via $oif setup $ks # tcp Out $cmd 00702 skip to 10000 tcp from any to any $tcp_out out via $oif setup $ks # Ftp $cmd 00703 allow tcp from any to any via $oif established $cmd 00704 allow tcp from me to any via $oif setup $ks $cmd 00705 allow tcp from any to me $ftp_high via $oif setup $ks $cmd 00706 skip to 10000 tcp from any to any $ftp_high out via $oif setup $ks # Udp out $cmd 00707 skip to 10000 udp from any to any $udp_out out via $oif $ks # Udp in $cmd 00708 skip to 10000 udp from any to any $udp_in in via $oif $ks # tcp In $cmd 00709 allow tcp from any to me $tcp_in in via $oif setup $ks # ping $cmd 02000 allow icmp from any to any icmptype 8 $cmd 02001 allow icmp from any to any icmptype 0 # IPv6 $cmd 02004 allow ipv6-icmp from any to any</span></span></code> </pre><br><br><h6>  Making the script executable </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># chmod 0755 /etc/rc.ipfw</span></span></code> </pre><br><br><h6>  Now reboot </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># reboot</span></span></code> </pre><br><br>  If everything is done correctly, then everything should work like a "clock" <br><br>  About everyones <b>delete-old</b> and <b>make delete-old-libs,</b> everyone decides for himself. <br><br><h6>  In my kernel config, I registered DTrace, if you did also check if everything works </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># trace -l | head</span></span></code> </pre><br><br><h6>  Manage make.conf to support Dtrace at user level. </h6><br><pre> <code class="bash hljs">STRIP= CFLAGS+=-fno-omit-frame-pointer</code> </pre><br><br>  <b>Now you need to install ports</b> <br><br><h6>  We receive the list of ports </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># portsnap fetch</span></span></code> </pre><br><br><h6>  Removing ports </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># portsnap extract</span></span></code> </pre><br><br><h6>  Go to the directory with the ports and set the index </h6><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cd /usr/ports # make fetch index</span></span></code> </pre><br><br>  Everything is ready, now the system is fully working, with ports and everything that is required for normal operation.  You can install the applications that you need, mc, ftp, nginx, etc.  etc. <br><br>  <i>PS If you find inaccuracies or comments, write - I will correct, I gathered material from Google and from Habr, I described everything in detail so that it could be used as an instruction.</i>  <i>Of course, much is elementary here, but I hope this will help some users to save time.</i> </habracut></habracut></habracut></habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/143546/">https://habr.com/ru/post/143546/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../143540/index.html">How to scatter windows on desktops after loading</a></li>
<li><a href="../143542/index.html">Runetology (146): Head of Molotok.ru, Igor Tarasenko</a></li>
<li><a href="../143543/index.html">Designing a rotator algorithm by rating</a></li>
<li><a href="../143544/index.html">Word of Dokach</a></li>
<li><a href="../143545/index.html">Mozilla is worried - Windows RT will not be able to choose a browser</a></li>
<li><a href="../143547/index.html">Gentoo high-quality font smoothing</a></li>
<li><a href="../143550/index.html">The ideal personal information manager - what is it?</a></li>
<li><a href="../143551/index.html">What is an information object</a></li>
<li><a href="../143552/index.html">About AI in Mind Games</a></li>
<li><a href="../143556/index.html">Choosing a programming language</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>