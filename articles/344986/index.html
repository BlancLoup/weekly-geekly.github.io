<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dependency injection in .Net Mark Siman 3 - Cross-cutting aspects of the application, interception, decorator</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dependencies between application layers | Designer implementation, lifetime | Cross-cutting aspects of the application, interception, decorator 

 In ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dependency injection in .Net Mark Siman 3 - Cross-cutting aspects of the application, interception, decorator</h1><div class="post__text post__text-html js-mediator-article">  <a href="https://habrahabr.ru/post/343830/">Dependencies between application layers</a> |  <a href="https://habrahabr.ru/post/344380/">Designer implementation, lifetime</a> |  Cross-cutting aspects of the application, interception, decorator <br><br>  In the two previous notes we covered the main parts of the web application.  We have an object that implements business logic - MyService.  There is an IRepository responsible for interacting with the database.  Not enough role model and logging. <br><br><h2>  Decorator </h2><br>  There is an opinion that in MVC web applications it is convenient to check the rights right at the beginning of the controller method.  For example: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">HttpPost</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DeleteProduct</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Thread.CurrentPrincipal.IsInRole(<span class="hljs-string"><span class="hljs-string">"ProducManager"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnauthorizedAccessException(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.MyService.DeleteProduct(id); }  <span class="hljs-number"><span class="hljs-number">1.</span></span>     </code> </pre> <br><a name="habracut"></a>  or using an attribute <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">PrincipalPermission(SecurityAction.Demand,Role = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ProductManager"</span></span></span><span class="hljs-meta">)</span></span>] [HttpPost] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DeleteProduct</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.MyService.DeleteProduct(id); }  <span class="hljs-number"><span class="hljs-number">2.</span></span>        </code> </pre> <br>  This approach has its advantages.  Not the most obvious of these is that the rights check is rendered from MyService.  It turns out the division of responsibility: the core business of logic performs only its task and is not engaged in verification of rights.  Speaking in "popular science" language follows the Single Responsibility Principle (SOLID). <br><br>  But isn't the role model part of business logic?  In addition, there are more complex checks.  For example, ProducManager may not be responsible for all products, but only for certain product categories, etc.  It will not be good to place such checks in controllers.  In MyService, as we already know, they also have no place.  How to be? <br><br>  The ‚ÄúDecorator‚Äù pattern comes to the rescue. <br><br>  We have already agreed that <br><br><ul><li>  Programming is better in accordance with the interface (Dependency Inversion Principle, SOLID).  Therefore, the controller does not use the MyService itself, but the interface. </li><li>  Dependencies are best implemented through the constructor. </li></ul><br>  The controller code in Listing 3 satisfies both remarks: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyController</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IMyService MyService; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> class </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyController</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IMyService service</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(service == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(service)); MyService = service } [HttpPost] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DeleteProduct</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.MyService.DeleteProduct(id); } }  <span class="hljs-number"><span class="hljs-number">3.</span></span> MyController  IMyService</code> </pre> <br>  We can do the decorator MySecurityService: IMyService (Listing 4), in which there is a rights check.  And, since our code follows the Liskov substitution principle, use it in the controller.  In this case, we do not need to change something in MyController. <br><blockquote>  The substitution principle of Liskov (Liskov Substitution Principle of SOLID) (Liskov is the last name) <br><br>  The client must treat all implementations of abstraction as equivalent.  We should be able to replace one implementation with another without destroying the consumer. </blockquote><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MySecurityService</span></span> : <span class="hljs-title"><span class="hljs-title">IMyService</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IMyService MyService; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IUserInfo UserInfo; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MySecurityService</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IMyService service, IUserInfo userInfo</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(service == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(service)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(userInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(userInfo)); MyService = service; UserInfo = userInfo; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DeleteProduct</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(UserInfo.IsInRole(<span class="hljs-string"><span class="hljs-string">"ProductManager"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnauthorizedAccessException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(service)); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.MyService.DeleteProduct(id); } }  <span class="hljs-number"><span class="hljs-number">4.</span></span>  MySecurityService           DeleteProduct.</code> </pre> <br>  or so, with the attribute: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MySecurityService</span></span> : <span class="hljs-title"><span class="hljs-title">IMyService</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IMyService MyService; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MySecurityService</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IMyService service</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(service == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(service)); MyService = service; } [PrincipalPermission(SecurityAction.Demand,Role = <span class="hljs-string"><span class="hljs-string">"ProductManager"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DeleteProduct</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.MyService.DeleteProduct(id); } }  <span class="hljs-number"><span class="hljs-number">5.</span></span>  MySecurityService   </code> </pre> <br>  Note that you should not use the PrincipalPermission attribute directly in MyService.  It is better if MyService is not associated with a specific rights verification implementation. <br><br>  In the same way, using decorators, you can add logging and error handling.  Below is an example (for understanding only) of the assembly of full functionality: decorators are nested inside each other. <br><br><pre> <code class="cs hljs">IMyService service = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyService(...); service = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySecurityService(service, ...); service = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyLoggerService(service, ...); service = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyExceptionSaveService(service, ...);  <span class="hljs-number"><span class="hljs-number">6.</span></span>     .  .</code> </pre> <br>  Note that decorators can be in different projects (in different assemblies).  You can, for example, have separate error handling decorators for the web application and the mobile client. <br><br>  Retreat: <br><br>  In the literature can be found the term "interception".  Here are the listings 1 and 2 essentially implement the "Interception": intercept control, do something and give control to the main code.  The "decorator" also implements "Interception". <br><br>  Parts of the program that apply to many functions of the application, such as logging, security, caching, etc.  referred to as ‚ÄúAspects‚Äù or ‚ÄúCross-cutting Aspects.‚Äù <br><br>  If at the interview you are asked about logging / caching / checking rights, you can wrap up a phrase like this: I think that to implement the end-to-end aspects of the application, it is better to use traps based on the Decorator pattern.  Of course, for this, the code must follow the principle of Barbara Liskov's substitution. <br><br><h2>  Conclusion </h2><br>  We covered typical web application development tasks: <br><br>  - How to break an application into layers <br>  - How to organize the interaction between classes <br>  - How to implement end-to-end aspects of the application <br><br>  We made the best understanding of the topic ‚Äúdependency injection‚Äù.  Knowing why you need to use the OT connection of the ioc-container will be a matter of technique. </div><p>Source: <a href="https://habr.com/ru/post/344986/">https://habr.com/ru/post/344986/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344972/index.html">Found the largest database of stolen passwords: what you should know</a></li>
<li><a href="../344974/index.html">Solving the problem of class name CSS conflicts in a React application using a webpack loader</a></li>
<li><a href="../344980/index.html">Simplify user action log</a></li>
<li><a href="../344982/index.html">Lectures of the Technosphere. Neural networks in machine learning</a></li>
<li><a href="../344984/index.html">Automated correction of indentation in layout based on typographic styles and text metrics</a></li>
<li><a href="../344988/index.html">Seriously, games?</a></li>
<li><a href="../344990/index.html">Avito Product Analytics Meetup - video, photo, slides</a></li>
<li><a href="../344992/index.html">Stack: analyze parameter values</a></li>
<li><a href="../344994/index.html">Netflix selects the best movie covers for each viewer.</a></li>
<li><a href="../344996/index.html">Evaluation of option premiums - analytical formulas vs modeling</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>