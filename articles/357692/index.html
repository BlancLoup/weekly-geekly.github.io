<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Certificate Store in LibreOffice Office Suite</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="LibreOffice is a powerful office suite. LibreOffice is free and open source. 

 The office package contains a text and spreadsheet processor, a progra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Certificate Store in LibreOffice Office Suite</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/f4f/0ad/d89/f4f0add89e38429faf2c62793794fc1d.png" align="left" alt="image">  <a href="https://ru.libreoffice.org/">LibreOffice</a> is a powerful office suite.  LibreOffice is free and open source. <br><br>  The office package contains a text and spreadsheet processor, a program for preparing and viewing presentations, a vector graphics editor, a database management system and a formula editor: <br><br><img src="https://habrastorage.org/web/1ef/050/38b/1ef05038bda1407e9627d26c54dc069a.png" alt="image"><br><a name="habracut"></a><br>  Moreover, the ongoing policy of import substitution, when domestic Linux forks are increasingly appearing on officials' tables instead of MS Windows, contributes to the widespread use of the LibreOffice package in government. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      LibreOffice is developing intensively and since its inception has absorbed many additional features.  One of these possibilities is the electronic signature (digital signature in the terminology of the LibreOffice) document.  To generate an electronic signature ( <b>File ‚Üí Digital signatures ‚Üí Digital signatures ... ‚Üí Sign a document</b> ) <a href="https://habrahabr.ru/post/316328/">personal</a> certificates are used: <br><br><img src="https://habrastorage.org/web/8c3/1ab/0b8/8c31ab0b8c5048da903add7fa1d21863.png" alt="image"><br><br>  Looking at the picture, an inexperienced user (and even more so an official) has a deep sense of misunderstanding: what kind of file is about to open, what kind of password should be entered! <br><br>  It should be noted that this is not a very good translation of the LibreOffice developers.  This is not about the file, but about the <a href="https://geektimes.ru/post/281890/">PKCS # 11</a> token / smartcard, and not about the password, but about the user PIN for the token.  There must be something like this: <br><br><img src="https://habrastorage.org/web/5e3/56e/b0f/5e356eb0f6e94d7ca6f3b5c40e1dcb47.png" alt="image"><br><br>  Here we come to the main question: where and how are the certificates that LibreOffice uses for generating electronic signature of documents stored? <br><br>  As a certificate store, LibreOffice uses, as a rule, certificate stores created and maintained by Mozilla products (Firefox, Thunderbird, SeaMonkey).  By default, this is the Thunderbird email client certificate store ( <b>Tools ‚Üí Options ... ‚Üí Security ‚Üí Certificate ...</b> ): <br><br><img src="https://habrastorage.org/web/c48/106/c67/c48106c67afb4b319494d1c1607d233c.png" alt="image"><br><br>  Certificate stores for Mozilla products are created using the Network Security Services ( <a href="https://habrahabr.ru/post/335712/">NSS)</a> package.  Using command line utilities, you can create your own certificate store, for example: <br><br><pre><code class="bash hljs">bash-4.3$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/a513/tmp bash-4.3$ mkdir db_for_libre bash-4.3$ modutil -create -dbdir /home/a513/tmp/db_for_libre WARNING: Performing this operation <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> the browser is running could cause corruption of your security databases. If the browser is currently running, you should <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> browser before continuing this operation. Type <span class="hljs-string"><span class="hljs-string">'q &lt;enter&gt;'</span></span> to abort, or &lt;enter&gt; to <span class="hljs-built_in"><span class="hljs-built_in">continue</span></span>: bash-4.3$ ls -l db_for_libre  60 -rw------- 1 a513 a513 65536  31 16:49 cert8.db -rw------- 1 a513 a513 16384  31 16:49 key3.db -rw------- 1 a513 a513 16384  31 16:49 secmod.db bash-4.3$</code> </pre> <br>  The certificate store created in the / home / a513 / tmp / db_for_libre directory contains three databases, namely cert8.db, key3.db, and secmod.db.  To create them, the old version of the Berkeley database (usually described in NSS documents as ‚ÄúDBM‚Äù) is used, unlike the certificate store, say, <a href="http://soft.lissi.ru/articles/googlechromgost/">google-chrome</a> , which is also created and maintained using the NSS package, but to support the databases ( cert9.db, key4.db, and pkcs11.txt) the storage uses the SQLite3 mechanism.  To work with both storage, the same NSS utilities are used, just in the ‚Äìd (storage directory) parameter before the storage path, if you are going to work with the new storage format (SQLite3), you just need to specify the prefix: -d sql: &lt;path to storage&gt;. <br><br>  Moreover, it is also easy to create a repository in the new format (cert9.db, key4.db and pkcs11.txt) from the old-format certificate storage (cert8.db, key3.db and secmod.db).  To do this, simply run the certutil certificate utility in the key (-K) or certificate (-L) mode with the ‚ÄìX parameter: <br><br><pre> <code class="bash hljs">bash-4.3$ ls -l /home/a513/tmp/db_for_libre/  60 -rw------- 1 a513 a513 65536  31 17:56 cert8.db -rw------- 1 a513 a513 16384  31 17:56 key3.db -rw------- 1 a513 a513 16384  31 16:49 secmod.db bash-4.3$ certutil -L -d sql:/home/a513/tmp/db_for_libre -X Certificate Nickname Trust Attributes SSL,S/MIME, JAR/XPI bash-4.3$ ls -l /home/a513/tmp/db_for_libre/  120 -rw------- 1 a513 a513 65536  31 17:56 cert8.db -rw------- 1 a513 a513 28672  31 17:56 cert9.db -rw------- 1 a513 a513 16384  31 17:56 key3.db -rw------- 1 a513 a513 28672  31 17:56 key4.db -rw------- 1 a513 a513 440  31 17:56 pkcs11.txt -rw------- 1 a513 a513 16384  31 16:49 secmod.db bash-4.3$</code> </pre> <br>  As you can see, now in the repository there are databases in both the old and the new formats. <br>  Unfortunately, the reverse transformation is unknown to me and therefore new certificate stores, for example, google-chrome (~ / .pki) in LibreOffice are not available. <br><br>  The NSS package supports work with PKCS # 11 tokens / smartcards, on which, as a rule, users keep their personal certificates with private keys.  Note that personal certificates are received today in <a href="https://geektimes.ru/post/283668/">certification centers</a> . <br><br>  So, we stopped at the fact that we had requested a PIN to the token.  PKCS # 11 tokens / smartcards can be connected via Firefox, Thunderbir, <a href="http://soft.lissi.ru/solution/mozilla/">Seamonkey</a> , or modutil.  For example, to connect a <a href="https://geektimes.ru/post/288674/">cloud</a> token, just run the command: <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$modutil</span></span> ‚Äìadd LS11CLOUD2016 ‚Äìlibfile libls11cloud.so ‚Äìdbdir /home/a513/tmp/db_for_libre $</code> </pre> <br>  It is to this token that LibreOffice requested a password: <br><br><img src="https://habrastorage.org/web/845/a91/53d/845a9153d7d2479f9a2b040c1b4b97c1.png" alt="image"><br><br>  After entering the password, a list of personal certificates will be available that can be used to generate a signature.  Here you can also view the contents of certificates: <br><br><img src="https://habrastorage.org/web/a10/025/836/a100258366e741e188598ac73c92f278.png" alt="image"><br><br>  As soon as the certificate is selected, the electronic signature will be generated: <br><br><img src="https://habrastorage.org/web/2e4/46a/b6b/2e446ab6bb0e4c3ea2fc5584ed748e03.png" alt="image"><br><br>  Now, when the document is reopened to work with it, then by the presence of a correct signature, you can be sure that the document has not been corrected by anyone.  Otherwise, there is no trust in the document. <br><br>  In conclusion, a few words about working with the certificate store.  If the user decides to create his own repository other than Mozilla products and use the NSS command line utilities for this, it is convenient to use <a href="https://habrahabr.ru/post/335712/">GUINSS GUI</a> , which can be <a href="http://soft.lissi.ru/downloads/download_guinss/">downloaded</a> here. <br><br>  This utility allows you to connect tokens / smart cards, import root certificates and certificates from a secure container PKCS # 12.  It also allows you to create requests (CSR) for certificates in the PKCS # 10 format: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/999/823/fd6/999823fd632c0ac50df0167986ad72bb.png" alt="image"><br><br>  A generated certificate request can be sent to the CA to receive a certificate: <br><br><img src="https://habrastorage.org/web/ed1/fc8/77f/ed1fc877f5bc43eb962686d65d035008.png" alt="image"><br><br>  The created repository can be used outside of LibreOffice. <br>  PS In the office package, certificates from the store are now used to generate an electronic signature in accordance with GOST R 34.10-2001 / 2012 in <a href="https://habr.com/post/428429/">PDF documents</a> . </div><p>Source: <a href="https://habr.com/ru/post/357692/">https://habr.com/ru/post/357692/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../357682/index.html">Someone is trying to hack GitHub users who work under Windows</a></li>
<li><a href="../357684/index.html">Plugin system on ASP.NET. Idea development</a></li>
<li><a href="../357686/index.html">Deprived of the premium for Russian citizenship, the programmer will receive a payment from Mail.ru</a></li>
<li><a href="../357688/index.html">Client-server step-by-step, from single-threaded to multi-threaded (Client-Server step by step)</a></li>
<li><a href="../357690/index.html">Getting Instagram users by city</a></li>
<li><a href="../357694/index.html">Haskell - knight's move</a></li>
<li><a href="../357696/index.html">Parsing the site using T-SQL</a></li>
<li><a href="../357698/index.html">Documentation generator using built-in 1C: Enterprise 8.3.10 language</a></li>
<li><a href="../357700/index.html">External scripts with access to your credit cards and personal account</a></li>
<li><a href="../357702/index.html">Haskel - knight's move II</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>