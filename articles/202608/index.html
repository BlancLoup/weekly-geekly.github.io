<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Another way to extend the functionality of the studio Cach√©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It was necessary to meet with the opinion that the studio Cach√© is not completely perfect, in particular the fact that it cannot be expanded. However,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Another way to extend the functionality of the studio Cach√©</h1><div class="post__text post__text-html js-mediator-article">  It was necessary to meet with the opinion that the studio Cach√© is not completely perfect, in particular the fact that it cannot be expanded.  However, this is not the case.  There is a regular mechanism of <a href="">templates and extensions</a> , which allows the studio to be completed with interactive additions. <br>  In this article we will touch on another extension method that can help more effectively manage the generated code.  This will help the studio integration class with the version control system. <br>  What can be done with the version control class?  First, to track some events occurring in the studio, such as connecting, creating, deleting, opening documents, and secondly, the ability to add items to the menu, including the shortcut.  Through these menu items you can not only execute code on the server, but also create some simple dialogs. <br><a name="habracut"></a><br>  Let's try to expand the studio menu in order to reduce / increase the indent, comment / uncomment the code block (these features in recent versions of Cach√© are available by keyboard shortcuts), and also add the ability to reformat indents and brackets, which is often not enough when editing large programs. <br><br><h5>  Creating a version control class </h5><br>  Create a class Util.StudioExtension as a descendant of% Studio.Extension.Base and assign it in the server configuration for the area in which we are going to use this extension: <br><br>  System Administration&gt; Configuration&gt; Advanced Settings -&gt; Version Control System 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <font color="#000080">Class Util.StudioExtension Extends% Studio.Extension.Base</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000080">XData</font> <font color="#000000">Menu</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuBase</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">Menu</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format"</font> <font color="#800000">Type</font> <font color="#000000">=</font> <font color="#008000">"1"</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"PlusTab"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"MinusTab"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Separator</font> <font color="#000000">=</font> <font color="#008000">"1"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"ReformatSelection"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"ReformatDocument"</font> <font color="#800000">Save</font> <font color="#000000">=</font> <font color="#008000">"100"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Separator</font> <font color="#000000">=</font> <font color="#008000">"1"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"CommentBlock"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"UnCommentBlock"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;/</font> <font color="#000080">Menu</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;/</font> <font color="#000080">MenuBase</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <br>  In this block, the tags MenuBase, Menu, MenuItem are the display of the classes% Studio.Extension.Base,% Studio.Extension.Menu,% Studio.Extension.MenuItem, the meaning of the attributes can be understood from their documentation.  In our case, Name is the internal name of the item, Type = 1 means that the context menu, Separator = 1, that the item is a separator, Save = 100, that when you click the menu item, the document should be saved. <br><br>  Create a method that handles the display of the menu itself.  Add readable Russian names to menu items; in cases when we consider it necessary, we make them inactive (Enabled = 0).  For example, it makes no sense to make active the item ‚Äúreformat the selected text‚Äù if nothing is selected. <br><div class="spoiler">  <b class="spoiler_title">OnMenuItem method</b> <div class="spoiler_text">  <font color="#000080">Method</font> <font color="#000000">OnMenuItem (</font> <font color="#ff00ff">MenuName</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">InternalName</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">SelectedText</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">Enabled</font> <font color="#000080">As% Boolean</font> <font color="#000000">,</font> <br>  <font color="#000080">ByRef</font> <font color="#ff00ff">DisplayName</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000080">As% Status</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format"</font> <font color="#800000">DisplayName</font> <font color="#000000">=</font> <font color="#008000">"Format"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, PlusTab"</font> <font color="#800000">DisplayName</font> <font color="#000000">=</font> <font color="#008000">"-&gt; | increase indent"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, MinusTab"</font> <font color="#800000">DisplayName</font> <font color="#000000">=</font> <font color="#008000">"| &lt;- decrease indent"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, ReformatDocument"</font> <font color="#800000">DisplayName</font> <font color="#000000">=</font> <font color="#008000">"Reformat Document"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, ReformatSelection"</font> <font color="#800000">DisplayName</font> <font color="#000000">=</font> <font color="#008000">"Reformat selected"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, CommentBlock"</font> <font color="#800000">DisplayName</font> <font color="#000000">=</font> <font color="#008000">"Comment block"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, UnCommentBlock"</font> <font color="#800000">DisplayName</font> <font color="#000000">=</font> <font color="#008000">"Uncomment the block"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Enabled</font> <font color="#000000">= 1</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#0000ff">$ piece</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">,</font> <font color="#0000ff">$ length</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">))</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:(</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, ReformatDocument"</font> <font color="#000000">) &amp;&amp; (</font> <font color="#800000">ext</font> <font color="#000000">'=</font> <font color="#008000">"MAC"</font> <font color="#000000">) &amp;&amp; (</font> <font color="#800000">ext</font> <font color="#000000">' =</font> <font color="#008000">"CLS"</font> <font color="#000000">)</font> <font color="#800000">Enabled</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:(</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, ReformatSelection"</font> <font color="#000000">) &amp;&amp; (</font> <font color="#800000">SelectedText</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#000000">)</font> <font color="#800000">Enabled</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:(</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, MinusTab"</font> <font color="#000000">) &amp;&amp; (</font> <font color="#800000">SelectedText</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#000000">)</font> <font color="#800000">Enabled</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:(</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, UnCommentBlock"</font> <font color="#000000">) &amp;&amp; (</font> <font color="#800000">SelectedText</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#000000">)</font> <font color="#800000">Enabled</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <br></div></div><br>  After reconnection by the studio, a new context menu item should appear, but it still does nothing: <br><img src="https://habrastorage.org/getpro/habr/post_images/30a/1e8/c45/30a1e8c456b4358a631c5ef634e7c3b4.png"><br><br><h5>  Indenting Class <br></h5><br>  Create a UserAction method that will respond to various actions, including the selection of menu items: <br><div class="spoiler">  <b class="spoiler_title">UserAction method</b> <div class="spoiler_text">  <font color="#008000">/ * Some event happened</font> <font color="#008000"><br></font>  <font color="#008000">Type = 0 - the menu item is pressed,</font> <font color="#008000"><br></font>  <font color="#008000">In this case, InternalName is the name of the menu item;</font> <font color="#008000"><br></font>  <font color="#008000">InternalName - the name of the document</font> <font color="#008000"><br></font>  <font color="#008000">SelectedText - selected text (if selected)</font> <font color="#008000"><br><br></font>  <font color="#008000">Type = 1 - the event is created automatically, while</font> <font color="#008000"><br></font>  <font color="#008000">Name = 0 - the user has changed the document.</font> <font color="#008000"><br></font>  <font color="#008000">Name = 1 - a new document has been created and saved.</font> <font color="#008000"><br></font>  <font color="#008000">Name = 2 - user deleted the document</font> <font color="#008000"><br></font>  <font color="#008000">Name = 3 - user opened the document</font> <font color="#008000"><br></font>  <font color="#008000">Name = 4 - the user closed the document</font> <font color="#008000"><br></font>  <font color="#008000">Name = 5 - the user is connected</font> <font color="#008000"><br></font>  <font color="#008000">InternalName - the name of the document with which the event occurred</font> <font color="#008000"><br><br></font>  <font color="#008000">Action is used to specify a studio action.</font> <font color="#008000"><br></font>  <font color="#008000">0 - Do nothing</font> <font color="#008000"><br></font>  <font color="#008000">1 - Show standard yes / no / cancel dialog.</font>  <font color="#008000">The dialogue text is specified in the variable Target.</font> <font color="#008000"><br></font>  <font color="#008000">2 - Launch csp page.</font>  <font color="#008000">Target specifies the page name</font> <font color="#008000"><br></font>  <font color="#008000">3 - Run the EXE file on the client.</font>  <font color="#008000">Target specifies the path to the file</font> <font color="#008000"><br></font>  <font color="#008000">4 - Insert the text contained in the variable Target at the current position in the document</font> <font color="#008000"><br></font>  <font color="#008000">5 - Open documents contained in the variable Target.</font>  <font color="#008000">The list of documents is separated by a comma.</font>  <font color="#008000">If the document name contains 'test.mac: label + 10', then the document test.mac will open at the position 'label + 10'.</font> <font color="#008000"><br></font>  <font color="#008000">6 - Display a window with a message displayed in the variable Target</font> <font color="#008000"><br></font>  <font color="#008000">7 - Displays a dialog with Yes / No / Cancel options.</font>  <font color="#008000">The text of the dialog is contained in the variable Target.</font>  <font color="#008000">The test message is passed in the variable Msg.</font> <font color="#008000"><br></font>  <font color="#008000">If the Reload argument is true, the current document will be reloaded.</font> <font color="#008000"><br></font>  <font color="#008000">* /</font> <br>  <font color="#000080">Method</font> <font color="#000000">UserAction (</font> <font color="#ff00ff">Type</font> <font color="#000080">As% Integer</font> <font color="#000000">,</font> <font color="#ff00ff">Name</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">InternalName</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">SelectedText</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <br>  <font color="#000080">ByRef</font> <font color="#ff00ff">Action</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">Target</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">Msg</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">Reload</font> <font color="#000080">As% Boolean</font> <font color="#000000">)</font> <font color="#000080">As% Status</font> <font color="#000080"><br></font>  { <br>  <font color="#0000ff">set</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#0000ff">$ zconvert</font> <font color="#000000">(</font> <font color="#0000ff">$ piece</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">,</font> <font color="#0000ff">$ length</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">)),</font> <font color="#008000">"U"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, PlusTab"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#008000">;</font>  <font color="#008000">insert text</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatTab</font> <font color="#000000">).</font>  <font color="#0000ff">PlusTab</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">,</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#008000">"CSP"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, MinusTab"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#008000">;</font>  <font color="#008000">insert text</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatTab</font> <font color="#000000">).</font>  <font color="#0000ff">MinusTab</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">,</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#008000">"CSP"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <br>  } <br></div></div><br>  The class itself that we use to format tabs: <br><div class="spoiler">  <b class="spoiler_title">Class Util.FormatTab</b> <div class="spoiler_text">  <font color="#000080">/// Class for working with tabs in the text</font> <font color="#000080"><br></font>  <font color="#000080">Class Util.FormatTab</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000080">/// Add tabs to the beginning of all lines that begin</font> <font color="#000080"><br></font>  <font color="#000080">/// with a space or tab.</font> <font color="#000080"><br></font>  <font color="#000080">/// For text with a mark</font> <font color="#000080"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">PlusTab (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">inCsp</font> <font color="#000080">As% Boolean</font> <font color="#000000">=</font> <font color="#000080">0</font> <font color="#000000">)</font> <font color="#000080">As% String</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">cr</font> <font color="#000000">=</font> <font color="#0000ff">$ char</font> <font color="#000000">(13,10)</font> <font color="#008000">;</font>  <font color="#008000">linefeed characters</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">tab</font> <font color="#000000">=</font> <font color="#0000ff">$ char</font> <font color="#000000">(9)</font> <font color="#008000">;</font>  <font color="#008000">tab characters</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsIn</font> <font color="#000000">=</font> <font color="#0000ff">$ listfromstring</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">,</font> <font color="#800000">cr</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsOut</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">for</font> <font color="#800000">i</font> <font color="#000000">= 1: 1:</font> <font color="#0000ff">$ listlength</font> <font color="#000000">(</font> <font color="#800000">stringsIn</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">line</font> <font color="#000000">=</font> <font color="#0000ff">$ listget</font> <font color="#000000">(</font> <font color="#800000">stringsIn</font> <font color="#000000">,</font> <font color="#800000">i</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">firstSymbol</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">, 1,1)</font> <font color="#000000"><br></font>  <font color="#0000ff">if</font> <font color="#000000">(</font> <font color="#800000">inCsp</font> <font color="#000000">= 1) || (</font> <font color="#800000">firstSymbol</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#000000">) || (</font> <font color="#800000">firstSymbol</font> <font color="#000000">=</font> <font color="#800000">tab</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">for</font> <font color="#800000">pos</font> <font color="#000000">= 1: 1:</font> <font color="#0000ff">$ length</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">)</font> <font color="#008000">;</font>  <font color="#008000">look for the position of the first non-whitespace character</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">symbol</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">,</font> <font color="#800000">pos</font> <font color="#000000">,</font> <font color="#800000">pos</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">:(</font> <font color="#800000">symbol</font> <font color="#000000">'=</font> <font color="#008000">""</font> <font color="#000000">) &amp;&amp; (</font> <font color="#800000">symbol</font> <font color="#000000">' =</font> <font color="#800000">tab</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">line</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">, 1,</font> <font color="#800000">pos</font> <font color="#000000">-1) _</font> <font color="#800000">tab</font> <font color="#000000">_</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">,</font> <font color="#800000">pos</font> <font color="#000000">, *)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsOut</font> <font color="#000000">=</font> <font color="#800000">stringsOut</font> <font color="#000000">_</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">quit $ listtostring</font> <font color="#000000">(</font> <font color="#800000">stringsOut</font> <font color="#000000">,</font> <font color="#800000">cr</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Remove tabs at the beginning of a line</font> <font color="#000080"><br></font>  <font color="#000080">/// text - the text that is processed</font> <font color="#000080"><br></font>  <font color="#000080">/// inCsp - sign that we work with the csp page,</font> <font color="#000080"><br></font>  <font color="#000080">/// while not trying to forcibly leave a space at the beginning of the line</font> <font color="#000080"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">MinusTab (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">inCsp</font> <font color="#000080">As% Boolean</font> <font color="#000000">=</font> <font color="#000080">0</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">cr</font> <font color="#000000">=</font> <font color="#0000ff">$ char</font> <font color="#000000">(13,10)</font> <font color="#008000">;</font>  <font color="#008000">linefeed characters</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">tab</font> <font color="#000000">=</font> <font color="#0000ff">$ char</font> <font color="#000000">(9)</font> <font color="#008000">;</font>  <font color="#008000">tab characters</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">tabSize</font> <font color="#000000">= 4</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsIn</font> <font color="#000000">=</font> <font color="#0000ff">$ listfromstring</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">,</font> <font color="#800000">cr</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsOut</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">for</font> <font color="#800000">i</font> <font color="#000000">= 1: 1:</font> <font color="#0000ff">$ listlength</font> <font color="#000000">(</font> <font color="#800000">stringsIn</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">line</font> <font color="#000000">=</font> <font color="#0000ff">$ listget</font> <font color="#000000">(</font> <font color="#800000">stringsIn</font> <font color="#000000">,</font> <font color="#800000">i</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">firstSymbol</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">, 1,1)</font> <font color="#000000"><br></font>  <font color="#0000ff">for</font> <font color="#800000">j</font> <font color="#000000">= 1: 1:</font> <font color="#800000">tabSize</font> <font color="#800000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">symbol</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">, 1,1)</font> <font color="#000000"><br></font>  <font color="#0000ff">if</font> <font color="#800000">symbol</font> <font color="#000000">=</font> <font color="#008000">"";</font>  <font color="#008000">remove the first 4 spaces</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">line</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">, 2, *)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">elseif</font> <font color="#800000">symbol</font> <font color="#000000">=</font> <font color="#800000">tab</font> <font color="#008000">;</font>  <font color="#008000">we remove tabulation, and on it we finish</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">line</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">, 2, *)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#0000ff"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">else</font> <font color="#008000">;</font>  <font color="#008000">no space or tab, end spaces delete spaces</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">quit</font> <font color="#0000ff"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#008000">;</font>  <font color="#008000">and suddenly all spaces were removed, and the string was erroneous in terms of syntax</font> <font color="#008000"><br></font>  <font color="#008000">;</font>  <font color="#008000">it will definitely happen if it is not a csp document</font> <font color="#008000"><br></font>  <font color="#0000ff">if</font> <font color="#000000">(</font> <font color="#800000">inCsp</font> <font color="#000000">= 0) &amp;&amp; ((</font> <font color="#800000">firstSymbol</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#000000">) || (</font> <font color="#800000">firstSymbol</font> <font color="#000000">=</font> <font color="#800000">tab</font> <font color="#000000">)) &amp;&amp; (</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">, 1,1) '=</font> <font color="#008000">""</font> <font color="#000000">) &amp;&amp; (</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">, 1,1)' =</font> <font color="#800000">tab</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">line</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#000000">_</font> <font color="#800000">line</font> <font color="#800000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsOut</font> <font color="#000000">=</font> <font color="#800000">stringsOut</font> <font color="#000000">_</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">quit $ listtostring</font> <font color="#000000">(</font> <font color="#800000">stringsOut</font> <font color="#000000">,</font> <font color="#800000">cr</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <br></div></div><br>  Now, if you reconnect with the studio (this should always be done after changing the version control class), the menu items ‚Äúadd indent‚Äù and ‚Äúremove indent‚Äù should work. <br><br><h5>  Class for commenting / uncommenting code <br></h5><br>  We modify the UserAction method of the Util.StudioExtension class by adding the processing of new items: <br><div class="spoiler">  <b class="spoiler_title">UserAction method</b> <div class="spoiler_text">  <font color="#000080">Method</font> <font color="#000000">UserAction (</font> <font color="#ff00ff">Type</font> <font color="#000080">As% Integer</font> <font color="#000000">,</font> <font color="#ff00ff">Name</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">InternalName</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">SelectedText</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <br>  <font color="#000080">ByRef</font> <font color="#ff00ff">Action</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">Target</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">Msg</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">Reload</font> <font color="#000080">As% Boolean</font> <font color="#000000">)</font> <font color="#000080">As% Status</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#0000ff">$ zconvert</font> <font color="#000000">(</font> <font color="#0000ff">$ piece</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">,</font> <font color="#0000ff">$ length</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">)),</font> <font color="#008000">"U"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">docname</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">, 1, * - 4)</font> <font color="#000000"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, PlusTab"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#008000">;</font>  <font color="#008000">insert text</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatTab</font> <font color="#000000">).</font>  <font color="#0000ff">PlusTab</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">,</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#008000">"CSP"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, MinusTab"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#008000">;</font>  <font color="#008000">insert text</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatTab</font> <font color="#000000">).</font>  <font color="#0000ff">MinusTab</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">,</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#008000">"CSP"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, CommentBlock"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#000000"><br></font>  <font color="#0000ff">s</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatComment</font> <font color="#000000">).</font>  <font color="#0000ff">AddComment</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, UnCommentBlock"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#000000"><br></font>  <font color="#0000ff">s</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatComment</font> <font color="#000000">).</font>  <font color="#0000ff">RemoveComment</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> </div></div><br>  We use the Util.FormatComment class to process strings: <br><div class="spoiler">  <b class="spoiler_title">Class Util.FormatComment</b> <div class="spoiler_text">  <font color="#000080">/// Class for commenting / uncommenting code</font> <font color="#000080"><br></font>  <font color="#000080">Class Util.FormatComment</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000080">/// Add a comment to the beginning of each line</font> <font color="#000080"><br></font>  <font color="#000080">/// with a space or tab.</font> <font color="#000080"><br></font>  <font color="#000080">/// For text with a mark</font> <font color="#000080"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">AddComment (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000080">As% String</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">cr</font> <font color="#000000">=</font> <font color="#0000ff">$ char</font> <font color="#000000">(13,10)</font> <font color="#008000">;</font>  <font color="#008000">linefeed characters</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsIn</font> <font color="#000000">=</font> <font color="#0000ff">$ listfromstring</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">,</font> <font color="#800000">cr</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsOut</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsCount</font> <font color="#000000">=</font> <font color="#0000ff">$ listlength</font> <font color="#000000">(</font> <font color="#800000">stringsIn</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">for</font> <font color="#800000">i</font> <font color="#000000">= 1: 1:</font> <font color="#0000ff">$ listlength</font> <font color="#000000">(</font> <font color="#800000">stringsIn</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">line</font> <font color="#000000">=</font> <font color="#0000ff">$ listget</font> <font color="#000000">(</font> <font color="#800000">stringsIn</font> <font color="#000000">,</font> <font color="#800000">i</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">s</font> <font color="#000000">:(</font> <font color="#800000">i</font> <font color="#000000">&lt;</font> <font color="#800000">stringsCount</font> <font color="#000000">) || (</font> <font color="#800000">line</font> <font color="#000000">'=</font> <font color="#008000">""</font> <font color="#000000">)</font> <font color="#800000">line</font> <font color="#000000">=</font> <font color="#008000">"//"</font> <font color="#000000">_</font> <font color="#800000">line</font> <font color="#008000">;</font>  <font color="#008000">when copying a block of text, an extra line feed often ends up, no need to comment on it</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsOut</font> <font color="#000000">=</font> <font color="#800000">stringsOut</font> <font color="#000000">_</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">w</font> <font color="#000000">!!!</font> <font color="#0000ff">$ listtostring</font> <font color="#000000">(</font> <font color="#800000">stringsOut</font> <font color="#000000">,</font> <font color="#800000">cr</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit $ listtostring</font> <font color="#000000">(</font> <font color="#800000">stringsOut</font> <font color="#000000">,</font> <font color="#800000">cr</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Remove comments from the beginning of the line.</font> <font color="#000080"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">RemoveComment (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">cr</font> <font color="#000000">=</font> <font color="#0000ff">$ char</font> <font color="#000000">(13,10)</font> <font color="#008000">;</font>  <font color="#008000">newline character</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">tab</font> <font color="#000000">=</font> <font color="#0000ff">$ char</font> <font color="#000000">(9)</font> <font color="#008000">;</font>  <font color="#008000">tab character</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsIn</font> <font color="#000000">=</font> <font color="#0000ff">$ listfromstring</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">,</font> <font color="#800000">cr</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsOut</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">for</font> <font color="#800000">i</font> <font color="#000000">= 1: 1:</font> <font color="#0000ff">$ listlength</font> <font color="#000000">(</font> <font color="#800000">stringsIn</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">line</font> <font color="#000000">=</font> <font color="#0000ff">$ listget</font> <font color="#000000">(</font> <font color="#800000">stringsIn</font> <font color="#000000">,</font> <font color="#800000">i</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#008000">;</font>  <font color="#008000">remove leading spaces and tabs to determine if there is a comment in this line</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">line0</font> <font color="#000000">=</font> <font color="#0000ff">$ translate</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">,</font> <font color="#008000">""</font> <font color="#000000">_</font> <font color="#800000">tab</font> <font color="#000000">,</font> <font color="#008000">""</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">if $ extract</font> <font color="#000000">(</font> <font color="#800000">line0</font> <font color="#000000">, 1,1) =</font> <font color="#008000">";"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">pos</font> <font color="#000000">=</font> <font color="#0000ff">$ find</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">,</font> <font color="#008000">";"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">line</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">, 1,</font> <font color="#800000">pos</font> <font color="#000000">-2) _</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">,</font> <font color="#800000">pos</font> <font color="#000000">, *)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">elseif $ extract</font> <font color="#000000">(</font> <font color="#800000">line0</font> <font color="#000000">, 1,3) =</font> <font color="#008000">"///"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">pos</font> <font color="#000000">=</font> <font color="#0000ff">$ find</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">,</font> <font color="#008000">"///"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">line</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">, 1,</font> <font color="#800000">pos</font> <font color="#000000">-4) _</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">,</font> <font color="#800000">pos</font> <font color="#000000">, *)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">elseif $ extract</font> <font color="#000000">(</font> <font color="#800000">line0</font> <font color="#000000">, 1,2) =</font> <font color="#008000">"//"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">pos</font> <font color="#000000">=</font> <font color="#0000ff">$ find</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">,</font> <font color="#008000">"//"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">line</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">, 1,</font> <font color="#800000">pos</font> <font color="#000000">-3) _</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">,</font> <font color="#800000">pos</font> <font color="#000000">, *)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsOut</font> <font color="#000000">=</font> <font color="#800000">stringsOut</font> <font color="#000000">_</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">quit $ listtostring</font> <font color="#000000">(</font> <font color="#800000">stringsOut</font> <font color="#000000">,</font> <font color="#800000">cr</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Returns whether the line is commented out.</font> <font color="#000080"><br></font>  <font color="#000080">/// understands only single-line comments.</font> <font color="#000080"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">CheckForComment (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000080">As% Boolean</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">cr</font> <font color="#000000">=</font> <font color="#0000ff">$ char</font> <font color="#000000">(13,10)</font> <font color="#008000">;</font>  <font color="#008000">newline character</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">tab</font> <font color="#000000">=</font> <font color="#0000ff">$ char</font> <font color="#000000">(9)</font> <font color="#008000">;</font>  <font color="#008000">tab character</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsIn</font> <font color="#000000">=</font> <font color="#0000ff">$ listfromstring</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">,</font> <font color="#800000">cr</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">stringsOut</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">for</font> <font color="#800000">i</font> <font color="#000000">= 1: 1:</font> <font color="#0000ff">$ listlength</font> <font color="#000000">(</font> <font color="#800000">stringsIn</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">line</font> <font color="#000000">=</font> <font color="#0000ff">$ listget</font> <font color="#000000">(</font> <font color="#800000">stringsIn</font> <font color="#000000">,</font> <font color="#800000">i</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">line</font> <font color="#000000">=</font> <font color="#0000ff">$ translate</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">,</font> <font color="#008000">""</font> <font color="#000000">_</font> <font color="#800000">tab</font> <font color="#000000">,</font> <font color="#008000">""</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">return</font> <font color="#000000">:</font> <font color="#0000ff">$ e</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">, 1,2) =</font> <font color="#008000">"//"</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#0000ff">return</font> <font color="#000000">:</font> <font color="#0000ff">$ e</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">, 1,1) =</font> <font color="#008000">";"</font>  <font color="#000000">one</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">0</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <br></div></div><br><h5>  Text formatting </h5><br>  Let's connect a class to reformat code.  It can be useful if your project was written by different teams or programmers who did not adhere to the same style.  Type Code <br>  <font color="#0000ff">for</font> <font color="#800000">i</font> <font color="#000000">=</font> <font color="#800000">TheNum</font> <font color="#000000">: 1:</font> <font color="#800000">TheNum</font> <font color="#000000">+2</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">StartTime</font> <font color="#000000">= 12 * 3600 + (300 *</font> <font color="#0000ff">$ R</font> <font color="#000000">(6))</font> <font color="#000000"><br></font>  <font color="#0000ff">while</font> <font color="#800000">StartTime</font> <font color="#000000">&lt;(3600 * 22)</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">show</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Cinema.Show</font> <font color="#000000">).</font>  <font color="#0000ff">% New</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">show</font> <font color="#000000">.</font>  <font color="#0000ff">Film</font> <font color="#000000">=</font> <font color="#800000">TheFilm</font> <font color="#800000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">show</font> <font color="#000000">.</font>  <font color="#0000ff">Theater</font> <font color="#000000">=</font> <font color="#800000">the</font> <font color="#000000">(</font> <font color="#800000">i</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">show</font> <font color="#000000">.</font>  <font color="#0000ff">StartTime</font> <font color="#000000">=</font> <font color="#800000">StartTime</font> <font color="#800000"><br></font>  <font color="#0000ff">do</font> <font color="#800000">show</font> <font color="#000000">.</font>  <font color="#0000ff">% Save</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">StartTime</font> <font color="#000000">=</font> <font color="#800000">StartTime</font> <font color="#000000">+ (</font> <font color="#800000">TheFilm</font> <font color="#000000">.</font> <font color="#0000ff">Length</font> <font color="#000000">* 60) + 1200 \ 300 * 300</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#800080">}</font> <br>  can be turned into <br>  <font color="#0000ff">for</font> <font color="#800000">i</font> <font color="#000000">=</font> <font color="#800000">TheNum</font> <font color="#000000">: 1:</font> <font color="#800000">TheNum</font> <font color="#000000">+2</font> <font color="#000000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">StartTime</font> <font color="#000000">= 12 * 3600 + (300 *</font> <font color="#0000ff">$ R</font> <font color="#000000">(6))</font> <font color="#000000"><br></font>  <font color="#0000ff">while</font> <font color="#800000">StartTime</font> <font color="#000000">&lt;(3600 * 22)</font> <font color="#000000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">show</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Cinema.Show</font> <font color="#000000">).</font>  <font color="#0000ff">% New</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">show</font> <font color="#000000">.</font>  <font color="#0000ff">Film</font> <font color="#000000">=</font> <font color="#800000">TheFilm</font> <font color="#800000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">show</font> <font color="#000000">.</font>  <font color="#0000ff">Theater</font> <font color="#000000">=</font> <font color="#800000">the</font> <font color="#000000">(</font> <font color="#800000">i</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">show</font> <font color="#000000">.</font>  <font color="#0000ff">StartTime</font> <font color="#000000">=</font> <font color="#800000">StartTime</font> <font color="#800000"><br></font>  <font color="#0000ff">do</font> <font color="#800000">show</font> <font color="#000000">.</font>  <font color="#0000ff">% Save</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">StartTime</font> <font color="#000000">=</font> <font color="#800000">StartTime</font> <font color="#000000">+ (</font> <font color="#800000">TheFilm</font> <font color="#000000">.</font> <font color="#0000ff">Length</font> <font color="#000000">* 60) + 1200 \ 300 * 300</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#800080">}</font> <br>  or vice versa, as someone like.  The class for the style ‚Äúbracket above the bracket‚Äù - Util.CodeFormat, the class for the style ‚Äúbracket at the end of the line‚Äù - Util.CodeFormat3 <br><br>  Modify the UserAction method by adding processing new menu items: <br><div class="spoiler">  <b class="spoiler_title">UserAction method</b> <div class="spoiler_text">  <font color="#000080">Method</font> <font color="#000000">UserAction (</font> <font color="#ff00ff">Type</font> <font color="#000080">As% Integer</font> <font color="#000000">,</font> <font color="#ff00ff">Name</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">InternalName</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">SelectedText</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">Action</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <br>  <font color="#000080">ByRef</font> <font color="#ff00ff">Target</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">Msg</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">Reload</font> <font color="#000080">As% Boolean</font> <font color="#000000">)</font> <font color="#000080">As% Status</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#0000ff">$ zconvert</font> <font color="#000000">(</font> <font color="#0000ff">$ piece</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">,</font> <font color="#0000ff">$ length</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">)),</font> <font color="#008000">"U"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">docname</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">, 1, * - 4)</font> <font color="#000000"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, PlusTab"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#008000">;</font>  <font color="#008000">insert text</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatTab</font> <font color="#000000">).</font>  <font color="#0000ff">PlusTab</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">,</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#008000">"CSP"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, MinusTab"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#008000">;</font>  <font color="#008000">insert text</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatTab</font> <font color="#000000">).</font>  <font color="#0000ff">MinusTab</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">,</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#008000">"CSP"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, CommentBlock"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatComment</font> <font color="#000000">).</font>  <font color="#0000ff">AddComment</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, UnCommentBlock"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatComment</font> <font color="#000000">).</font>  <font color="#0000ff">RemoveComment</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, ReformatSelection"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.CodeFormat</font> <font color="#000000">).</font>  <font color="#0000ff">FormatString</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, ReformatDocument"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#008000">"MAC"</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.CodeFormat</font> <font color="#000000">).</font>  <font color="#0000ff">FormatMAC</font> <font color="#000000">(</font> <font color="#800000">docname</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#008000">"CLS"</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.CodeFormat</font> <font color="#000000">).</font>  <font color="#0000ff">FormatClass</font> <font color="#000000">(</font> <font color="#800000">docname</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <br></div></div><br>  Class handler code in the style of "bracket above the bracket" <br><div class="spoiler">  <b class="spoiler_title">Class Util.CodeFormat</b> <div class="spoiler_text">  <font color="#000080">/// Code formatter class</font> <font color="#000080"><br></font>  <font color="#000080">Class Util.CodeFormat Extends% RegisteredObject</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000080">/// name of the input buffer global</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">Buffer1</font> <font color="#000080">As% String</font> <font color="#000000">;</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// name of the output buffer global</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">Buffer2</font> <font color="#000080">As% String</font> <font color="#000000">;</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Current line input buffer</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">CurrentLine1</font> <font color="#000080">As% Numeric</font> <font color="#000000">[</font> <font color="#000080">InitialExpression</font> <font color="#000000">=</font> <font color="#000080">1</font> <font color="#000000">];</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Current line of the output buffer</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">CurrentLine2</font> <font color="#000080">As% Numeric</font> <font color="#000000">[</font> <font color="#000080">InitialExpression</font> <font color="#000000">=</font> <font color="#000080">1</font> <font color="#000000">];</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Current position in the input buffer line</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">CurrentPos1</font> <font color="#000080">As% Numeric</font> <font color="#000000">[</font> <font color="#000080">InitialExpression</font> <font color="#000000">=</font> <font color="#000080">1</font> <font color="#000000">];</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Level of curly braces</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">LevelFigureBrace</font> <font color="#000080">As% Integer</font> <font color="#000000">[</font> <font color="#000080">InitialExpression</font> <font color="#000000">=</font> <font color="#000080">0</font> <font color="#000000">];</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Level of parentheses</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">LevelRoundBrace</font> <font color="#000080">As% Integer</font> <font color="#000000">[</font> <font color="#000080">InitialExpression</font> <font color="#000000">=</font> <font color="#000080">0</font> <font color="#000000">];</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Is there any code on the line?</font>  <font color="#000080">&lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">/// Combinations:</font> <font color="#000080"><br></font>  <font color="#000080">/// LineHasCode = 0 &amp;&amp; SkipSpace = 1 -&gt; the beginning of the line, we expect a label or code</font> <font color="#000080"><br></font>  <font color="#000080">/// LineHasCode = 0 &amp;&amp; SkipSpace = 0 -&gt; should not be such</font> <font color="#000080"><br></font>  <font color="#000080">/// LineHasCode = 1 &amp;&amp; SkipSpace = 0 -&gt; already have the code, just write it as it is</font> <font color="#000080"><br></font>  <font color="#000080">/// LineHasCode = 1 &amp;&amp; SkipSpace = 1 -&gt; already have the code, but skip spaces, for example, after {</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">LineHasCode</font> <font color="#000080">As% Boolean</font> <font color="#000000">;</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Skip spaces</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">SkipSpace</font> <font color="#000080">As% Boolean</font> <font color="#000000">[</font> <font color="#000080">InitialExpression</font> <font color="#000000">=</font> <font color="#000080">1</font> <font color="#000000">];</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Skip line feeds</font> <font color="#000080"><br></font>  <font color="#000080">/// 1 - skip one</font> <font color="#000080"><br></font>  <font color="#000080">/// -1 - translation just missed, you need to be attentive to the labels and other</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">SkipCR</font> <font color="#000080">As% Boolean</font> <font color="#000000">[</font> <font color="#000080">InitialExpression</font> <font color="#000000">=</font> <font color="#000080">0</font> <font color="#000000">];</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Need indent (when code appears)</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">NeedIndent</font> <font color="#000080">As% Boolean</font> <font color="#000000">;</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// In a single line comment?</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">InSingleLineComment</font> <font color="#000080">As% Boolean</font> <font color="#000000">[</font> <font color="#000080">InitialExpression</font> <font color="#000000">=</font> <font color="#000080">0</font> <font color="#000000">];</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// In multiline comments?</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">InMultiLineComment</font> <font color="#000080">As% Boolean</font> <font color="#000000">[</font> <font color="#000080">InitialExpression</font> <font color="#000000">=</font> <font color="#000080">0</font> <font color="#000000">];</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Process the line feed</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ProcessCR (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">if</font> <font color="#000000">..</font> <font color="#0000ff">SkipCR</font> <font color="#000000">= 1</font> <font color="#000000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">SkipCR</font> <font color="#000000">= -1</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">do</font> <font color="#000000">: ..</font> <font color="#0000ff">NeedIndent</font> <font color="#000000">..</font> <font color="#0000ff">Write</font> <font color="#000000">(..</font> <font color="#0000ff">MakeIndent</font> <font color="#000000">())</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">LineHasCode</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">SkipSpace</font> <font color="#000000">= 1</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">NeedIndent</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">InSingleLineComment</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">WriteCR</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Handle whitespace</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ProcessSpace (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">: (..</font> <font color="#0000ff">InMultiLineComment</font> <font color="#000000">) ..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#008000">;</font>  <font color="#008000">the line break was suppressed, the normal character behind it was whitespace.</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">: ..</font> <font color="#0000ff">SkipCR</font> <font color="#000000">= -1 ..</font> <font color="#0000ff">SkipCR</font> <font color="#000000">= 0, ..</font> <font color="#0000ff">NeedIndent</font> <font color="#000000">= 0, ..</font> <font color="#0000ff">SkipSpace</font> <font color="#000000">= 1</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">: '..</font> <font color="#0000ff">SkipSpace</font> <font color="#000000">..</font> <font color="#0000ff">Write</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">: '..</font> <font color="#0000ff">LineHasCode</font> <font color="#000000">..</font> <font color="#0000ff">NeedIndent</font> <font color="#000000">= 1</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Process the opening of the brace</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ProcessFigureBraceOpen (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">: (..</font> <font color="#0000ff">LevelRoundBrace</font> <font color="#000000">) ..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">: (..</font> <font color="#0000ff">InMultiLineComment</font> <font color="#000000">) ..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">: (..</font> <font color="#0000ff">InSingleLineComment</font> <font color="#000000">) ..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">: ..</font> <font color="#0000ff">LineHasCode</font> <font color="#000000">..</font> <font color="#0000ff">WriteCR</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">Write</font> <font color="#000000">(..</font> <font color="#0000ff">MakeIndent</font> <font color="#000000">() _</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">WriteCR</font> <font color="#000000">()</font> <font color="#000000"><br><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">LevelFigureBrace</font> <font color="#000000">= ..</font> <font color="#0000ff">LevelFigureBrace</font> <font color="#000000">+1</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">LineHasCode</font> <font color="#000000">= 0, ..</font> <font color="#0000ff">SkipSpace</font> <font color="#000000">= 1, ..</font> <font color="#0000ff">NeedIndent</font> <font color="#000000">= 1, ..</font> <font color="#0000ff">SkipCR</font> <font color="#000000">= 1</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Handle curly braces</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ProcessFigureBraceClose (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">: (..</font> <font color="#0000ff">LevelRoundBrace</font> <font color="#000000">) ..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">: (..</font> <font color="#0000ff">InMultiLineComment</font> <font color="#000000">) ..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">: (..</font> <font color="#0000ff">InSingleLineComment</font> <font color="#000000">) ..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">: (..</font> <font color="#0000ff">LevelFigureBrace</font> <font color="#000000">= 0) ..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">: ..</font> <font color="#0000ff">LineHasCode</font> <font color="#000000">..</font> <font color="#0000ff">WriteCR</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">LevelFigureBrace</font> <font color="#000000">= ..</font> <font color="#0000ff">LevelFigureBrace</font> <font color="#000000">-1</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">Write</font> <font color="#000000">(..</font> <font color="#0000ff">MakeIndent</font> <font color="#000000">() _</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">WriteCR</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">SkipCR</font> <font color="#000000">= 1, ..</font> <font color="#0000ff">NeedIndent</font> <font color="#000000">= 1, ..</font> <font color="#0000ff">SkipSpace</font> <font color="#000000">= 1, ..</font> <font color="#0000ff">LineHasCode</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Process the opening of the parenthesis</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ProcessRoundBraceOpen (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:( ..</font> <font color="#0000ff">InMultiLineComment</font> <font color="#000000">= 0) &amp;&amp; (..</font> <font color="#0000ff">InSingleLineComment</font> <font color="#000000">= 0) ..</font> <font color="#0000ff">LevelRoundBrace</font> <font color="#000000">= ..</font> <font color="#0000ff">LevelRoundBrace</font> <font color="#000000">+1</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">Write</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Process the closing of the parenthesis</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ProcessRoundBraceClose (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:( ..</font> <font color="#0000ff">InMultiLineComment</font> <font color="#000000">= 0) &amp;&amp; (..</font> <font color="#0000ff">InSingleLineComment</font> <font color="#000000">= 0) &amp;&amp; (..</font> <font color="#0000ff">LevelRoundBrace</font> <font color="#000000">&gt; 0) ..</font> <font color="#0000ff">LevelRoundBrace</font> <font color="#000000">= ..</font> <font color="#0000ff">LevelRoundBrace</font> <font color="#000000">-1</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">Write</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Handle the opening of a multi-line comment</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ProcessMultilineCommentOpen (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">InMultiLineComment</font> <font color="#000000">= 1</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Handle closing a multi-line comment</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ProcessMultilineCommentClose (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">InMultiLineComment</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Single line comment</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ProcessOnelineCommentOpen (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">InSingleLineComment</font> <font color="#000000">= 1</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Process the code without any special features</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ProcessCommonCode (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008000">// translated the line, and on the new line immediately the text is visible label.</font> <font color="#008000"><br></font>  <font color="#008000">// It is necessary to translate all the same string, despite the fact that the translation was suppressed</font> <font color="#008000"><br></font>  <font color="#0000ff">if</font> <font color="#000000">..</font> <font color="#0000ff">SkipCR</font> <font color="#000000">= -1</font> <font color="#000000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">WriteCR</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">NeedIndent</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">SkipCR</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">: ..</font> <font color="#0000ff">NeedIndent</font> <font color="#800000">text</font> <font color="#000000">= ..</font> <font color="#0000ff">MakeIndent</font> <font color="#000000">() _</font> <font color="#800000">text</font> <font color="#800000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">Write</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">SkipSpace</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">LineHasCode</font> <font color="#000000">= 1</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">NeedIndent</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Reformat the mac program</font> <font color="#000080"><br></font>  <font color="#000080">/// d ## class (Util.CodeFormat) .FormatMAC ("Untitled1")</font> <font color="#000080"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">FormatMAC (</font> <font color="#ff00ff">name</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000080">As% Integer</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">:</font> <font color="#800000">name</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">: '</font> <font color="#0000ff">$ data</font> <font color="#000000">(^ rMAC (</font> <font color="#800000">name</font> <font color="#000000">))</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">parser</font> <font color="#000000">= ..</font> <font color="#0000ff">% New</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer1</font> <font color="#000000">=</font> <font color="#008000">"^ || buffer1"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer2</font> <font color="#000000">=</font> <font color="#008000">"^ || buffer2"</font> <font color="#008000"><br></font>  <font color="#0000ff">kill</font> <font color="#000000">@</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer1</font> <font color="#0000ff"><br></font>  <font color="#0000ff">kill</font> <font color="#000000">@</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer2</font> <font color="#0000ff"><br></font>  <font color="#0000ff">set</font> <font color="#800000">key</font> <font color="#000000">= 0,</font> <font color="#800000">line</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">for</font> <font color="#008000">// write to the buffer data from the global program</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">key</font> <font color="#000000">=</font> <font color="#0000ff">$ order</font> <font color="#000000">(^ rMAC (</font> <font color="#800000">name</font> <font color="#000000">, 0,</font> <font color="#800000">key</font> <font color="#000000">))</font> <font color="#0000ff">quit</font> <font color="#000000">: +</font> <font color="#800000">key</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">@</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer1</font> <font color="#000000">@ (</font> <font color="#0000ff">$ increment</font> <font color="#000000">(</font> <font color="#800000">line</font> <font color="#000000">)) = ^ rMAC (</font> <font color="#800000">name</font> <font color="#000000">, 0,</font> <font color="#800000">key</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">braces</font> <font color="#000000">=</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">FormatBuffer</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">write</font> <font color="#000000">!,</font> <font color="#800000">name</font> <font color="#000000">,</font> <font color="#008000">":"</font> <font color="#000000">,</font> <font color="#800000">braces</font> <font color="#800000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">key</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">for</font> <font color="#008000">;</font>  <font color="#008000">delete old program lines</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">key</font> <font color="#000000">=</font> <font color="#0000ff">$ order</font> <font color="#000000">(^ rMAC (</font> <font color="#800000">name</font> <font color="#000000">, 0,</font> <font color="#800000">key</font> <font color="#000000">))</font> <font color="#0000ff">quit</font> <font color="#000000">: +</font> <font color="#800000">key</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">kill</font> <font color="#000000">^ rMAC (</font> <font color="#800000">name</font> <font color="#000000">, 0,</font> <font color="#800000">key</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">merge</font> <font color="#000000">^ rMAC (</font> <font color="#800000">name</font> <font color="#000000">, 0) = @</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer2</font> <font color="#0000ff"><br></font>  <font color="#0000ff">set</font> <font color="#000000">^ rMAC (</font> <font color="#800000">name</font> <font color="#000000">, 0,0) =</font> <font color="#0000ff">$ order</font> <font color="#000000">(@</font> <font color="#800000">parser</font> <font color="#000000">.</font> <font color="#0000ff">Buffer2</font> <font color="#000000">@ (</font> <font color="#008000">""</font> <font color="#000000">), - 1)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">^ rMAC (</font> <font color="#800000">name</font> <font color="#000000">, 0) =</font> <font color="#0000ff">$ horolog</font> <font color="#0000ff"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Format all class methods &lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">/// d ## class (Util.CodeFormat) .FormatClass ("Import.NIAdvs")</font> <font color="#000080"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">FormatClass (</font> <font color="#ff00ff">class</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">method</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">for</font> <font color="#0000ff"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">method</font> <font color="#000000">=</font> <font color="#0000ff">$ order</font> <font color="#000000">(^ oddDEF (</font> <font color="#800000">class</font> <font color="#000000">,</font> <font color="#008000">"m"</font> <font color="#000000">,</font> <font color="#800000">method</font> <font color="#000000">))</font> <font color="#0000ff">quit</font> <font color="#000000">:</font> <font color="#800000">method</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">FormatMethod</font> <font color="#000000">(</font> <font color="#800000">class</font> <font color="#000000">,</font> <font color="#800000">method</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Format the class method.</font>  <font color="#000080">Not very nicely written - a mixture of globals and objects &lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">/// d ## class (Util.CodeFormat) .FormatMethod ("Import.NIAdvs", "% OnValidateObject5")</font> <font color="#000080"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">FormatMethod (</font> <font color="#ff00ff">class</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">method</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">mdef</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">% Dictionary.MethodDefinition</font> <font color="#000000">).</font>  <font color="#0000ff">% OpenId</font> <font color="#000000">(</font> <font color="#800000">class</font> <font color="#000000">_</font> <font color="#008000">"||"</font> <font color="#000000">_</font> <font color="#800000">method</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">:</font> <font color="#800000">mdef</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">gl1</font> <font color="#000000">=</font> <font color="#008000">"^ oddDEF (" ""</font> <font color="#000000">_</font> <font color="#800000">class</font> <font color="#000000">_</font> <font color="#008000">"" "," "m" "," ""</font> <font color="#000000">_</font> <font color="#800000">method</font> <font color="#000000">_</font> <font color="#008000">"", 30) ";</font>  <font color="#008000">method code is stored here</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">parser</font> <font color="#000000">= ..</font> <font color="#0000ff">% New</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer1</font> <font color="#000000">=</font> <font color="#008000">"^ || buffer1"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer2</font> <font color="#000000">=</font> <font color="#008000">"^ || buffer2"</font> <font color="#008000"><br></font>  <font color="#0000ff">kill</font> <font color="#000000">@</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer1</font> <font color="#0000ff"><br></font>  <font color="#0000ff">kill</font> <font color="#000000">@</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer2</font> <font color="#0000ff"><br><br></font>  <font color="#0000ff">set</font> <font color="#800000">key</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">for</font> <font color="#008000">// write the data from the global method to the buffer</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">key</font> <font color="#000000">=</font> <font color="#0000ff">$ order</font> <font color="#000000">(@</font> <font color="#800000">gl1</font> <font color="#000000">@ (</font> <font color="#800000">key</font> <font color="#000000">))</font> <font color="#0000ff">quit</font> <font color="#000000">: +</font> <font color="#800000">key</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">@</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer1</font> <font color="#000000">@ (</font> <font color="#800000">key</font> <font color="#000000">) = @</font> <font color="#800000">gl1</font> <font color="#000000">@ (</font> <font color="#800000">key</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">braces</font> <font color="#000000">=</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">FormatBuffer</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">write</font> <font color="#000000">!,</font> <font color="#800000">class</font> <font color="#000000">,</font> <font color="#008000">"."</font>  <font color="#000000">,</font> <font color="#800000">method</font> <font color="#000000">,</font> <font color="#008000">":"</font> <font color="#000000">,</font> <font color="#800000">braces</font> <font color="#800000"><br><br></font>  <font color="#0000ff">do</font> <font color="#800000">mdef</font> <font color="#000000">.</font>  <font color="#0000ff">Implementation</font> <font color="#000000">.</font>  <font color="#0000ff">Clear</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">key</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">for</font> <font color="#0000ff"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">key</font> <font color="#000000">=</font> <font color="#0000ff">$ order</font> <font color="#000000">(@</font> <font color="#800000">parser</font> <font color="#000000">.</font> <font color="#0000ff">Buffer2</font> <font color="#000000">@ (</font> <font color="#800000">key</font> <font color="#000000">))</font> <font color="#0000ff">quit</font> <font color="#000000">: +</font> <font color="#800000">key</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#800000">mdef</font> <font color="#000000">.</font>  <font color="#0000ff">Implementation</font> <font color="#000000">.</font>  <font color="#0000ff">WriteLine</font> <font color="#000000">(</font> <font color="#0000ff">@parser</font> <font color="#000000">.</font> <font color="#0000ff">Buffer2</font> <font color="#000000">@ (</font> <font color="#800000">key</font> <font color="#000000">))</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">do</font> <font color="#800000">mdef</font> <font color="#000000">.</font>  <font color="#0000ff">% Save</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Format the string, which then returns</font> <font color="#000080"><br></font>  <font color="#000080">/// w ## class (Util.CodeFormat) .FormatString ("if x = 1 {s x = 1}")</font> <font color="#000080"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">FormatString (</font> <font color="#ff00ff">str</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000080">As% String</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br><br></font>  <font color="#0000ff">set</font> <font color="#800000">parser</font> <font color="#000000">= ..</font> <font color="#0000ff">% New</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer1</font> <font color="#000000">=</font> <font color="#008000">"^ || buffer1"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer2</font> <font color="#000000">=</font> <font color="#008000">"^ || buffer2"</font> <font color="#008000"><br></font>  <font color="#0000ff">kill</font> <font color="#000000">@</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer1</font> <font color="#0000ff"><br></font>  <font color="#0000ff">kill</font> <font color="#000000">@</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer2</font> <font color="#0000ff"><br><br></font>  <font color="#0000ff">set</font> <font color="#800000">rowend</font> <font color="#000000">=</font> <font color="#0000ff">$ char</font> <font color="#000000">(13,10)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">rows</font> <font color="#000000">=</font> <font color="#0000ff">$ listfromstring</font> <font color="#000000">(</font> <font color="#800000">str</font> <font color="#000000">,</font> <font color="#800000">rowend</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">key</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">for</font> <font color="#800000">i</font> <font color="#000000">= 1: 1:</font> <font color="#0000ff">$ listlength</font> <font color="#000000">(</font> <font color="#800000">rows</font> <font color="#000000">)</font> <font color="#008000">// write to the buffer data from the global method</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#000000">@</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">Buffer1</font> <font color="#000000">@ (</font> <font color="#800000">i</font> <font color="#000000">) =</font> <font color="#0000ff">$ listget</font> <font color="#000000">(</font> <font color="#800000">rows</font> <font color="#000000">,</font> <font color="#800000">i</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">do</font> <font color="#800000">parser</font> <font color="#000000">.</font>  <font color="#0000ff">FormatBuffer</font> <font color="#000000">()</font> <font color="#000000"><br><br></font>  <font color="#0000ff">set</font> <font color="#800000">str</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">key</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">for</font> <font color="#0000ff"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">key</font> <font color="#000000">=</font> <font color="#0000ff">$ order</font> <font color="#000000">(@</font> <font color="#800000">parser</font> <font color="#000000">.</font> <font color="#0000ff">Buffer2</font> <font color="#000000">@ (</font> <font color="#800000">key</font> <font color="#000000">))</font> <font color="#0000ff">quit</font> <font color="#000000">:</font> <font color="#800000">key</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">str</font> <font color="#000000">=</font> <font color="#800000">str</font> <font color="#000000">_</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(@</font> <font color="#800000">parser</font> <font color="#000000">.</font> <font color="#0000ff">Buffer2</font> <font color="#000000">@ (</font> <font color="#800000">key</font> <font color="#000000">))</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#0000ff">$ listget</font> <font color="#000000">(</font> <font color="#800000">rows</font> <font color="#000000">,</font> <font color="#0000ff">$ listlength</font> <font color="#000000">(</font> <font color="#800000">rows</font> <font color="#000000">)) =</font> <font color="#008000">""</font> <font color="#800000">str</font> <font color="#000000">=</font> <font color="#800000">str</font> <font color="#000000">_</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#008000">""</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit $ listtostring</font> <font color="#000000">(</font> <font color="#800000">str</font> <font color="#000000">,</font> <font color="#800000">rowend</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Read the text from the input buffer &lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">/// Returns a list of text and its type &lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">/// Types of text &lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">/// p - whitespace character &lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">/// s - string &lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">/// e - end of line &lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">/// E - the end of the text in general &lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">/// {- {&lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">///} -} &lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">/// (- (&lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">///) -) &lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">///;</font>  <font color="#000080">- start of single line comment &lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">/// / * - the beginning of a multi-line comment &lt;br&gt;</font> <font color="#000080"><br></font>  <font color="#000080">/// * / - end of multi-line comment</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ReadTerm ()</font> <font color="#000080">As% List</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#0000ff">$ data</font> <font color="#000000">(@ ..</font> <font color="#0000ff">Buffer1</font> <font color="#000000">@ (..</font> <font color="#0000ff">CurrentLine1</font> <font color="#000000">)) = 0 ..</font> <font color="#0000ff">CurrentLine1</font> <font color="#000000">= ..</font> <font color="#0000ff">CurrentLine1</font> <font color="#000000">+1, ..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">= 1</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">:</font> <font color="#0000ff">$ data</font> <font color="#000000">(@ ..</font> <font color="#0000ff">Buffer1</font> <font color="#000000">@ (..</font> <font color="#0000ff">CurrentLine1</font> <font color="#000000">)) = 0</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#008000">""</font> <font color="#000000">,</font> <font color="#008000">"E"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">str</font> <font color="#000000">= @ ..</font> <font color="#0000ff">Buffer1</font> <font color="#000000">@ (..</font> <font color="#0000ff">CurrentLine1</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">char1</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">str</font> <font color="#000000">, ..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">, ..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">char2</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">str</font> <font color="#000000">, ..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">+1, ..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">+1)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">char1</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#000000">..</font> <font color="#0000ff">CurrentLine1</font> <font color="#000000">= ..</font> <font color="#0000ff">CurrentLine1</font> <font color="#000000">+1, ..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">= 1</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">:</font> <font color="#800000">char1</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#008000">""</font> <font color="#000000">,</font> <font color="#008000">"e"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">= ..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">+1</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">:</font> <font color="#800000">char1</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">,</font> <font color="#008000">"p"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">:</font> <font color="#800000">char1</font> <font color="#000000">=</font> <font color="#0000ff">$ char</font> <font color="#000000">(9)</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">,</font> <font color="#008000">"p"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">:</font> <font color="#800000">char1</font> <font color="#000000">=</font> <font color="#008000">"{"</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">,</font> <font color="#008000">"{"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">:</font> <font color="#800000">char1</font> <font color="#000000">=</font> <font color="#008000">"}"</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">,</font> <font color="#008000">"}"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">:</font> <font color="#800000">char1</font> <font color="#000000">=</font> <font color="#008000">"("</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">,</font> <font color="#008000">"("</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">:</font> <font color="#800000">char1</font> <font color="#000000">=</font> <font color="#008000">")"</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">,</font> <font color="#008000">")"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">:</font> <font color="#800000">char1</font> <font color="#000000">=</font> <font color="#008000">";"</font>  <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">,</font> <font color="#008000">";"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">if</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">=</font> <font color="#008000">"/"</font> <font color="#000000">) &amp;&amp; (</font> <font color="#800000">char2</font> <font color="#000000">=</font> <font color="#008000">"/"</font> <font color="#000000">)</font> <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">= ..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">+1</font> <font color="#0000ff">quit $ listbuild</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">_</font> <font color="#800000">char2</font> <font color="#000000">,</font> <font color="#008000">";"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">if</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">=</font> <font color="#008000">"/"</font> <font color="#000000">) &amp;&amp; (</font> <font color="#800000">char2</font> <font color="#000000">=</font> <font color="#008000">"*"</font> <font color="#000000">)</font> <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">= ..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">+1</font> <font color="#0000ff">quit $ listbuild</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">_</font> <font color="#800000">char2</font> <font color="#000000">,</font> <font color="#008000">"/ *"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">if</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">=</font> <font color="#008000">"*"</font> <font color="#000000">) &amp;&amp; (</font> <font color="#800000">char2</font> <font color="#000000">=</font> <font color="#008000">"/"</font> <font color="#000000">)</font> <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">= ..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">+1</font> <font color="#0000ff">quit $ listbuild</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">_</font> <font color="#800000">char2</font> <font color="#000000">,</font> <font color="#008000">"* /"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">if</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">=</font> <font color="#008000">"" ""</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">pos2</font> <font color="#000000">=</font> <font color="#0000ff">$ find</font> <font color="#000000">(</font> <font color="#800000">str</font> <font color="#000000">,</font> <font color="#008000">"" ""</font> <font color="#000000">, ..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">text</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">str</font> <font color="#000000">, ..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">-1,</font> <font color="#800000">pos2</font> <font color="#000000">-1)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">CurrentPos1</font> <font color="#000000">=</font> <font color="#800000">pos2</font> <font color="#800000"><br></font>  <font color="#0000ff">quit $ listbuild</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">,</font> <font color="#008000">"s"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">quit $ listbuild</font> <font color="#000000">(</font> <font color="#800000">char1</font> <font color="#000000">,</font> <font color="#008000">"s"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Same as ReadTerm, but arguments are given and obtained differently</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ReadTerm1 (</font> <font color="#000080">ByRef</font> <font color="#ff00ff">type</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000080">As% String</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">res</font> <font color="#000000">= ..</font> <font color="#0000ff">ReadTerm</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">type</font> <font color="#000000">=</font> <font color="#0000ff">$ listget</font> <font color="#000000">(</font> <font color="#800000">res</font> <font color="#000000">, 2)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit $ listget</font> <font color="#000000">(</font> <font color="#800000">res</font> <font color="#000000">, 1)</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Print text to output buffer</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">Write (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">=</font> <font color="#800080">""</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">@ ..</font> <font color="#0000ff">Buffer2</font> <font color="#000000">@ (..</font> <font color="#0000ff">CurrentLine2</font> <font color="#000000">) =</font> <font color="#0000ff">$ get</font> <font color="#000000">(@ ..</font> <font color="#0000ff">Buffer2</font> <font color="#000000">@ (..</font> <font color="#0000ff">CurrentLine2</font> <font color="#000000">)) _</font> <font color="#800000">text</font> <font color="#800000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// translate the string in the output buffer</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">WriteCR ()</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">CurrentLine2</font> <font color="#000000">= ..</font> <font color="#0000ff">CurrentLine2</font> <font color="#000000">+1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Indent text line</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">MakeIndent ()</font> <font color="#000080">As% String</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">indent</font> <font color="#000000">=</font> <font color="#0000ff">$ char</font> <font color="#000000">(9)</font> <font color="#000000"><br></font>  <font color="#0000ff">for</font> <font color="#800000">i</font> <font color="#000000">= 1: 1: ..</font> <font color="#0000ff">LevelFigureBrace set</font> <font color="#800000">indent</font> <font color="#000000">=</font> <font color="#800000">indent</font> <font color="#000000">_</font> <font color="#0000ff">$ char</font> <font color="#000000">(9)</font> <font color="#000000"><br></font>  <font color="#0000ff">for</font> <font color="#800000">i</font> <font color="#000000">= 1: 1: ..</font> <font color="#0000ff">LevelRoundBrace set</font> <font color="#800000">indent</font> <font color="#000000">=</font> <font color="#800000">indent</font> <font color="#000000">_</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">quit</font> <font color="#800000">indent</font> <font color="#800000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Format the text in the internal "buffer"</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">FormatBuffer ()</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">level</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">for</font> <font color="#0000ff"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">text</font> <font color="#000000">= ..</font> <font color="#0000ff">ReadTerm1</font> <font color="#000000">(.</font> <font color="#800000">type</font> <font color="#000000">)</font> <font color="#0000ff">quit</font> <font color="#000000">:</font> <font color="#800000">type</font> <font color="#000000">=</font> <font color="#008000">"E"</font> <font color="#008000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">type</font> <font color="#000000">=</font> <font color="#008000">"e"</font> <font color="#000000">..</font> <font color="#0000ff">ProcessCR</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">type</font> <font color="#000000">=</font> <font color="#008000">"p"</font> <font color="#000000">..</font> <font color="#0000ff">ProcessSpace</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">type</font> <font color="#000000">=</font> <font color="#008000">";"</font>  <font color="#000000">..</font> <font color="#0000ff">ProcessOnelineCommentOpen</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">type</font> <font color="#000000">=</font> <font color="#008000">"/ *"</font> <font color="#000000">..</font> <font color="#0000ff">ProcessMultilineCommentOpen</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">type</font> <font color="#000000">=</font> <font color="#008000">"* /"</font> <font color="#000000">..</font> <font color="#0000ff">ProcessMultilineCommentClose</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">type</font> <font color="#000000">=</font> <font color="#008000">"("</font> <font color="#000000">..</font> <font color="#0000ff">ProcessRoundBraceOpen</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">type</font> <font color="#000000">=</font> <font color="#008000">")"</font> <font color="#000000">..</font> <font color="#0000ff">ProcessRoundBraceClose</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">type</font> <font color="#000000">=</font> <font color="#008000">"{"</font> <font color="#000000">..</font> <font color="#0000ff">ProcessFigureBraceOpen</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">type</font> <font color="#000000">=</font> <font color="#008000">"}"</font> <font color="#000000">..</font> <font color="#0000ff">ProcessFigureBraceClose</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">type</font> <font color="#000000">=</font> <font color="#008000">"s"</font> <font color="#000000">..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">: ..</font> <font color="#0000ff">LevelFigureBrace</font> <font color="#000000">&gt;</font> <font color="#800000">level level</font> <font color="#000000">= ..</font> <font color="#0000ff">LevelFigureBrace</font> <font color="#0000ff"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">quit</font> <font color="#800000">level</font> <font color="#800000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <br></div></div><br>  Class handler code in the style of "bracket at the end of the line."  If this style is preferable, you need to replace the calls to the UtilCodeFormat class from the UserAction method with UtilCodeFormat3. <br><div class="spoiler">  <b class="spoiler_title">Class Util.CodeFormat3</b> <div class="spoiler_text">  <font color="#000080">Class Util.CodeFormat3 Extends Util.CodeFormat</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000080">/// Undo the last line feed</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ReturnCR ()</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">CurrentLine2</font> <font color="#000000">= ..</font> <font color="#0000ff">CurrentLine2</font> <font color="#000000">-1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Roll back the last spaces</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ReturnSpace ()</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">str</font> <font color="#000000">= @ ..</font> <font color="#0000ff">Buffer2</font> <font color="#000000">@ (..</font> <font color="#0000ff">CurrentLine2</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">len</font> <font color="#000000">=</font> <font color="#0000ff">$ length</font> <font color="#000000">(</font> <font color="#800000">str</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">for</font> <font color="#0000ff"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">lastchar</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">str</font> <font color="#000000">,</font> <font color="#800000">len</font> <font color="#000000">,</font> <font color="#800000">len</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">:(</font> <font color="#800000">lastchar</font> <font color="#000000">'=</font> <font color="#008000">""</font> <font color="#000000">) &amp;&amp; (</font> <font color="#800000">lastchar</font> <font color="#000000">' =</font> <font color="#0000ff">$ char</font> <font color="#000000">(9))</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">str</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">str</font> <font color="#000000">, 1,</font> <font color="#800000">len</font> <font color="#000000">-1)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">len</font> <font color="#000000">=</font> <font color="#800000">len</font> <font color="#000000">-1</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">@ ..</font> <font color="#0000ff">Buffer2</font> <font color="#000000">@ (..</font> <font color="#0000ff">CurrentLine2</font> <font color="#000000">) =</font> <font color="#800000">str</font> <font color="#800000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">/// Process the opening of the brace</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">ProcessFigureBraceOpen (</font> <font color="#ff00ff">text</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">: (..</font> <font color="#0000ff">LevelRoundBrace</font> <font color="#000000">) ..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">: (..</font> <font color="#0000ff">InMultiLineComment</font> <font color="#000000">) ..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">: (..</font> <font color="#0000ff">InSingleLineComment</font> <font color="#000000">) ..</font> <font color="#0000ff">ProcessCommonCode</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">: '..</font> <font color="#0000ff">LineHasCode</font> <font color="#000000">..</font> <font color="#0000ff">ReturnCR</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">ReturnSpace</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">write</font> <font color="#000000">(</font> <font color="#008000">""</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">Write</font> <font color="#000000">(</font> <font color="#800000">text</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">LevelFigureBrace</font> <font color="#000000">= ..</font> <font color="#0000ff">LevelFigureBrace</font> <font color="#000000">+1</font> <font color="#000000"><br><br></font>  <font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">WriteCR</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">..</font> <font color="#0000ff">LineHasCode</font> <font color="#000000">= 0, ..</font> <font color="#0000ff">SkipSpace</font> <font color="#000000">= 1, ..</font> <font color="#0000ff">NeedIndent</font> <font color="#000000">= 1, ..</font> <font color="#0000ff">SkipCR</font> <font color="#000000">= 1</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <br></div></div><br>  Class expansion studio Cach√© entirely: <br><div class="spoiler">  <b class="spoiler_title">Class Util.StudioExtension</b> <div class="spoiler_text">  <font color="#000080">Class Util.StudioExtension Extends% Studio.Extension.Base</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000080">XData</font> <font color="#000000">Menu</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuBase</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">Menu</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format"</font> <font color="#800000">Type</font> <font color="#000000">=</font> <font color="#008000">"1"</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"PlusTab"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"MinusTab"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Separator</font> <font color="#000000">=</font> <font color="#008000">"1"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"ReformatSelection"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"ReformatDocument"</font> <font color="#800000">Save</font> <font color="#000000">=</font> <font color="#008000">"100"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Separator</font> <font color="#000000">=</font> <font color="#008000">"1"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"CommentBlock"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">MenuItem</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"UnCommentBlock"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;/</font> <font color="#000080">Menu</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;/</font> <font color="#000080">MenuBase</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">Method</font> <font color="#000000">OnMenuItem (</font> <font color="#ff00ff">MenuName</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">InternalName</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">SelectedText</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <br>  <font color="#000080">ByRef</font> <font color="#ff00ff">Enabled</font> <font color="#000080">As% Boolean</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">DisplayName</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000080">As% Status</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format"</font> <font color="#800000">DisplayName</font> <font color="#000000">=</font> <font color="#008000">"Format"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, PlusTab"</font> <font color="#800000">DisplayName</font> <font color="#000000">=</font> <font color="#008000">"-&gt; | increase indent"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, MinusTab"</font> <font color="#800000">DisplayName</font> <font color="#000000">=</font> <font color="#008000">"| &lt;- decrease indent"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, ReformatDocument"</font> <font color="#800000">DisplayName</font> <font color="#000000">=</font> <font color="#008000">"Reformat Document"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, ReformatSelection"</font> <font color="#800000">DisplayName</font> <font color="#000000">=</font> <font color="#008000">"Reformat selected"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, CommentBlock"</font> <font color="#800000">DisplayName</font> <font color="#000000">=</font> <font color="#008000">"Comment block"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, UnCommentBlock"</font> <font color="#800000">DisplayName</font> <font color="#000000">=</font> <font color="#008000">"Uncomment the block"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Enabled</font> <font color="#000000">= 1</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#0000ff">$ piece</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">,</font> <font color="#0000ff">$ length</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">))</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:(</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, ReformatDocument"</font> <font color="#000000">) &amp;&amp; (</font> <font color="#800000">ext</font> <font color="#000000">'=</font> <font color="#008000">"MAC"</font> <font color="#000000">) &amp;&amp; (</font> <font color="#800000">ext</font> <font color="#000000">' =</font> <font color="#008000">"CLS"</font> <font color="#000000">)</font> <font color="#800000">Enabled</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:(</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, ReformatSelection"</font> <font color="#000000">) &amp;&amp; (</font> <font color="#800000">SelectedText</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#000000">)</font> <font color="#800000">Enabled</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:(</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, MinusTab"</font> <font color="#000000">) &amp;&amp; (</font> <font color="#800000">SelectedText</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#000000">)</font> <font color="#800000">Enabled</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#000000">:(</font> <font color="#800000">MenuName</font> <font color="#000000">=</font> <font color="#008000">"Format, UnCommentBlock"</font> <font color="#000000">) &amp;&amp; (</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatComment</font> <font color="#000000">).</font> <font color="#0000ff">CheckForComment</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">) = 0)</font> <font color="#800000">Enabled</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#008000">/ * Some event happened</font> <font color="#008000"><br></font>  <font color="#008000">Type = 0 - the menu item is pressed,</font> <font color="#008000"><br></font>  <font color="#008000">In this case, InternalName is the name of the menu item;</font> <font color="#008000"><br></font>  <font color="#008000">InternalName - the name of the document</font> <font color="#008000"><br></font>  <font color="#008000">SelectedText - selected text (if selected)</font> <font color="#008000"><br></font>  <font color="#008000">Type = 1 - the event is created automatically, while</font> <font color="#008000"><br></font>  <font color="#008000">Name = 0 - the user has changed the document.</font> <font color="#008000"><br></font>  <font color="#008000">Name = 1 - a new document has been created and saved.</font> <font color="#008000"><br></font>  <font color="#008000">Name = 2 - user deleted the document</font> <font color="#008000"><br></font>  <font color="#008000">Name = 3 - user opened the document</font> <font color="#008000"><br></font>  <font color="#008000">Name = 4 - the user closed the document</font> <font color="#008000"><br></font>  <font color="#008000">Name = 5 - the user is connected</font> <font color="#008000"><br></font>  <font color="#008000">InternalName - the name of the document with which the event occurred</font> <font color="#008000"><br></font>  <font color="#008000">Action is used to specify a studio action</font> <font color="#008000"><br></font>  <font color="#008000">0 - Do nothing</font> <font color="#008000"><br></font>  <font color="#008000">1 - Show standard yes / no / cancel dialog.</font>  <font color="#008000">The dialogue text is specified in the variable Target.</font> <font color="#008000"><br></font>  <font color="#008000">2 - Launch csp page.</font>  <font color="#008000">Target specifies the page name</font> <font color="#008000"><br></font>  <font color="#008000">3 - Run the EXE file on the client.</font>  <font color="#008000">Target specifies the path to the file</font> <font color="#008000"><br></font>  <font color="#008000">4 - Insert the text contained in the variable Target at the current position in the document</font> <font color="#008000"><br></font>  <font color="#008000">5 - Open documents contained in the variable Target.</font>  <font color="#008000">The list of documents is separated by a comma.</font>  <font color="#008000">If the document name contains 'test.mac: label + 10', then the document test.mac will open at the position 'label + 10'.</font> <font color="#008000"><br></font>  <font color="#008000">6 - Display a window with a message displayed in the variable Target</font> <font color="#008000"><br></font>  <font color="#008000">7 - Displays a dialog with Yes / No / Cancel options.</font>  <font color="#008000">The text of the dialog is contained in the variable Target.</font>  <font color="#008000">The test message is passed in the variable Msg.</font> <font color="#008000"><br></font>  <font color="#008000">If the Reload argument is true, the current document will be reloaded.</font> <font color="#008000"><br></font>  <font color="#008000">* /</font> <font color="#008000"><br></font>  <font color="#000080">Method</font> <font color="#000000">UserAction (</font> <font color="#ff00ff">Type</font> <font color="#000080">As% Integer</font> <font color="#000000">,</font> <font color="#ff00ff">Name</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">InternalName</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">SelectedText</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <br>  <font color="#000080">ByRef</font> <font color="#ff00ff">Action</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">Target</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">Msg</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">Reload</font> <font color="#000080">As% Boolean</font> <font color="#000000">)</font> <font color="#000080">As% Status</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#0000ff">$ zconvert</font> <font color="#000000">(</font> <font color="#0000ff">$ piece</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">,</font> <font color="#0000ff">$ length</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">)),</font> <font color="#008000">"U"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">docname</font> <font color="#000000">=</font> <font color="#0000ff">$ extract</font> <font color="#000000">(</font> <font color="#800000">InternalName</font> <font color="#000000">, 1, * - 4)</font> <font color="#000000"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, PlusTab"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#008000">;</font>  <font color="#008000">insert text</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatTab</font> <font color="#000000">).</font>  <font color="#0000ff">PlusTab</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">,</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#008000">"CSP"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, MinusTab"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#008000">;</font>  <font color="#008000">insert text</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatTab</font> <font color="#000000">).</font>  <font color="#0000ff">MinusTab</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">,</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#008000">"CSP"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, CommentBlock"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatComment</font> <font color="#000000">).</font>  <font color="#0000ff">AddComment</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, UnCommentBlock"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.FormatComment</font> <font color="#000000">).</font>  <font color="#0000ff">RemoveComment</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, ReformatSelection"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 4</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Target</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.CodeFormat</font> <font color="#000000">).</font>  <font color="#0000ff">FormatString</font> <font color="#000000">(</font> <font color="#800000">SelectedText</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">if</font> <font color="#800000">Name</font> <font color="#000000">=</font> <font color="#008000">"Format, ReformatDocument"</font> <font color="#008000"><br></font>  <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">set</font> <font color="#800000">Action</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#008000">"MAC"</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.CodeFormat</font> <font color="#000000">).</font>  <font color="#0000ff">FormatMAC</font> <font color="#000000">(</font> <font color="#800000">docname</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">ext</font> <font color="#000000">=</font> <font color="#008000">"CLS"</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Util.CodeFormat</font> <font color="#000000">).</font>  <font color="#0000ff">FormatClass</font> <font color="#000000">(</font> <font color="#800000">docname</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">quit</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <br></div></div><br>  Done! </div><p>Source: <a href="https://habr.com/ru/post/202608/">https://habr.com/ru/post/202608/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202598/index.html">About bitcoins and money</a></li>
<li><a href="../202600/index.html">YotaPhone (phone and e-reader in one device) is scheduled for December this year.</a></li>
<li><a href="../202602/index.html">Comet C / 2012 S1 (ISON) in sight STEREO or how to observe it if the weather is bad</a></li>
<li><a href="../202604/index.html">We are friends of Total Commander (64 bits) and plugins (32 bits)</a></li>
<li><a href="../202606/index.html">Bro Browser, Retro IRC Chat and other utilities in PaintCAD 4Windows</a></li>
<li><a href="../202610/index.html">Linux Mint 16 RC "Petra" released</a></li>
<li><a href="../202612/index.html">Announcement: Habrawriter</a></li>
<li><a href="../202614/index.html">Legal basis for ensuring information security in a commercial organization</a></li>
<li><a href="../202618/index.html">Payoneer mobile app update</a></li>
<li><a href="../202620/index.html">Technology gets closer to the body</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>