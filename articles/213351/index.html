<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OS X, Vagrant and Parallels Desktop. Build your boxes with veewee</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post I want to share my experience in creating my own Vagrant boxes in OS X with the Parallels Desktop virtualization system. If there is inte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OS X, Vagrant and Parallels Desktop. Build your boxes with veewee</h1><div class="post__text post__text-html js-mediator-article">  In this post I want to share my experience in creating my own Vagrant boxes in OS X with the Parallels Desktop virtualization system.  If there is interest, welcome under cut. <br><br><a name="habracut"></a><br><br>  About <a href="http://www.vagrantup.com/">Vagrant</a> and <a href="http://www.getchef.com/">Chef was</a> already a good post: <a href="http://habrahabr.ru/post/178797/">Development Environment with Vagrant and Chef</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, if you, like me, use Parallels Desktop, a problem arises.  The fact is that Parallels and VirtualBox cannot be started simultaneously.  Therefore, you can use the virtual machine provider <a href="https://github.com/Parallels/vagrant-parallels">vagrant-parallels</a> . <br><br>  The procedure for installing and using is described in some detail on the plugin page on Github, but I will duplicate the process just in case. <br><br>  Personally, I use <a href="http://brew.sh/">Homebrew</a> to install various useful applications - and we will use it. <br><br><pre><code class="bash hljs">eric@Copoka-3 ~&gt; brew tap phinze/cask eric@Copoka-3 ~&gt; brew cask install vagrant eric@Copoka-3 ~&gt; vagrant plugin install vagrant-parallels</code> </pre> <br>  In general, everything is ready for work.  There is not enough trivia - actually the boxes.  On the site with the plugin there is a link to the devbox, but we also want something more diverse and different. <br><br>  And here <a href="https://github.com/jedi4ever/veewee">veewee</a> comes on the scene.  Unfortunately, there is no ready veewee package, so we will assemble it ourselves. <br><br>  In order not to overload the system with unnecessary gems, install <a href="https://rvm.io/">rvm</a> : <br><br><pre> <code class="bash hljs">eric@Copoka-3 ~&gt; \curl -sSL https://get.rvm.io | bash -s stable eric@Copoka-3 ~&gt; rvm install 2.1.0 eric@Copoka-3 ~&gt; rvm use 2.1.0</code> </pre><br><br>  Ruby is ready.  Now actually veewee: <br><br><pre> <code class="bash hljs">eric@Copoka-3 ~&gt; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> Work eric@Copoka-3 ~/Work&gt; git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/jedi4ever/veewee.git eric@Copoka-3 ~/Work&gt; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> veewee eric@Copoka-3 ~/W/veewee&gt; rvm use 2.1.0@veewee --create eric@Copoka-3 ~/W/veewee&gt; gem install bundler --no-ri --no-rdoc eric@Copoka-3 ~/W/veewee&gt; bundle install eric@Copoka-3 ~/W/veewee&gt; rake install</code> </pre><br><br>  Now, to start creating mailboxes, you need to install the Parallels SDK by downloading it from the <a href="">SDK</a> link. <br>  Download, install, you can proceed. <br><br><pre> <code class="bash hljs">eric@Copoka-3 ~&gt; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> Work eric@Copoka-3 ~/Work&gt; mkdir boxes eric@Copoka-3 ~/Work&gt; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> boxes</code> </pre><br><br>  To create a box is invited to use the template.  The list of templates can be obtained as follows: <br><br><pre> <code class="bash hljs">eric@Copoka-3 ~/W/boxes&gt; veewee parallels templates</code> </pre><br><br>  The list is quite large, I will not give.  For our purposes, let's use the good old Ubuntu 12.04 LTS: <br><br><pre> <code class="bash hljs">eric@Copoka-3 ~/W/boxes&gt; veewee parallels define <span class="hljs-string"><span class="hljs-string">'precise64'</span></span> <span class="hljs-string"><span class="hljs-string">'ubuntu-12.04.3-server-amd64'</span></span></code> </pre><br><br>  Next, we are asked to start the build with the <code>veewee parallels build</code> , but we will fail.  Although it would seem that we used a template for working with parallels, this template tries to install guest tools for VirtualBox and VMWare, but knows nothing about Parallels.  Fix this flaw: <br><br><pre> <code class="bash hljs">eric@Copoka-3 ~/W/boxes&gt; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> definitions/precise64/ eric@Copoka-3 ~/W/b/d/precise64&gt;</code> </pre><br><br>  Here you need to create a <code>parallels.sh</code> file with the following content (I looked in the template for ubuntu-13.10-server-amd64, but there‚Äôs another problem, I'll tell you later): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Install the Parallels Tools PARALLELS_TOOLS_ISO=prl-tools-lin.iso mount -o loop $PARALLELS_TOOLS_ISO /media/cdrom /media/cdrom/install --install-unattended-with-deps --progress umount /media/cdrom</span></span></code> </pre><br><br>  Then edit <code>definition.rb</code> , remove virtualbox and vmfusion references from the <code>postinstall_files</code> list, and add <code>parallels.sh</code> . <br>  Now you can proceed: <br><br><pre> <code class="bash hljs">eric@Copoka-3 ~/W/b/d/precise64&gt; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../.. eric@Copoka-3 ~/W/boxes&gt; veewee parallels build precise64</code> </pre><br><br>  You can go to dinner, the process is quite long.  In the end, everything will be safely completed and we will see something like the following: <br><br><pre> <code class="bash hljs">...- ... The box precise64 was built successfully! You can now login to the box with: ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -p 22 -l vagrant 10.211.55.7 eric@Copoka-3 ~/W/boxes&gt;</code> </pre><br><br>  At this stage, you can go to the machine ( <code>vagrant</code> password), make sure everything is fine, add something (for example, Russian support).  After we make sure that everything is set as it should, you can pack it in a box for Vagrant. <br>  But here we are waiting for another underwater rock.  When trying to export, we get the following error: <br><br><pre> Error was not executed.
 - Command: prl_disk_tool compact --buildmap --hdd /Users/eric/Documents/Parallels/precise64.pvm/harddisk.hdd.
 - Exitcode: 2.
 - Output:
 Operation progress 5% Unable to compact the disk.
</pre><br><br>  This is a known <a href="https://github.com/jedi4ever/veewee/issues/856">error</a> . To solve it, you need to comment out the <code>optimize_disk</code> line in the <code>gems/veewee-0.3.12/lib/veewee/provider/parallels/box/export.rb</code> export.rb file (relative to the gemset version used) - I had it 69th line. <br><br>  After that, the export will work properly, and in the current directory we will see our cherished box: <br><br><pre> <code class="bash hljs">eric@Copoka-3 ~/W/boxes&gt; ll total 1252512 drwxr-xr-x+ 3 eric staff 102B 20  17:44 definitions drwxr-xr-x+ 4 eric staff 136B 20  17:39 iso -rw-r--r--+ 1 eric staff 612M 20  18:46 precise64.box eric@Copoka-3 ~/W/boxes&gt;</code> </pre><br><br>  Add it to the piggy bank: <br><br><pre> <code class="bash hljs">eric@Copoka-3 ~/W/boxes&gt; vagrant box add <span class="hljs-string"><span class="hljs-string">'precise64'</span></span> <span class="hljs-string"><span class="hljs-string">'/Users/eric/Work/boxes/precise64.box'</span></span></code> </pre><br><br>  Now choose a place for a test run and start the resulting box: <br><br><pre> <code class="bash hljs">eric@Copoka-3 ~/W/boxes&gt; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Work eric@Copoka-3 ~/Work&gt; mkdir testbox eric@Copoka-3 ~/Work&gt; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> testbox eric@Copoka-3 ~/W/testbox&gt; vagrant init precise64 eric@Copoka-3 ~/W/testbox&gt; vagrant up --provider=parallels eric@Copoka-3 ~/W/testbox&gt; vagrant ssh Welcome to Ubuntu 12.04.4 LTS (GNU/Linux 3.8.0-29-generic x86_64) * Documentation: https://help.ubuntu.com/ Last login: Thu Feb 20 18:33:11 2014 from 10.211.55.2 vagrant@precise64:~$</code> </pre><br><br>  What they wanted to get. <br><br>  Now about Ubuntu 13.10.  There, the template practically does not require any changes, you only need to uncomment the line for Parallels in <code>definition.rb</code> and, therefore, comment out VirtualBox.  Then everything is exactly the same. <br><br>  However, when trying to make a <code>vagrant up</code> our mailbox from 13.10, the machine waits for the machine to start, although the machine starts successfully.  This is due to an error in the Parallels drivers for Linux.  Parallels knows about this error and promises to fix it in the near update.  You can read about it on the <a href="https://github.com/Parallels/vagrant-parallels/issues/58">vagrant-parallels issue tracker.</a> <br><br>  As a temporary solution, it is proposed, at launch time, to help vagrant with your hands: log into the machine from the console and restart dhclient on eth0. <br><br>  I hope my somewhat chaotic notes will come in handy for someone, and allow me to save time. </div><p>Source: <a href="https://habr.com/ru/post/213351/">https://habr.com/ru/post/213351/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../21334/index.html">developers.org.ua</a></li>
<li><a href="../213341/index.html">European Space Agency will send PLATO observatory to space</a></li>
<li><a href="../213343/index.html">Investing in games: the Asian threat</a></li>
<li><a href="../213347/index.html">In the United States launched the sale of "smart" pistols, working only with a "smart" watch</a></li>
<li><a href="../21335/index.html">Gmail - interface changes</a></li>
<li><a href="../213353/index.html">HackDay # 30 in Moscow</a></li>
<li><a href="../213355/index.html">LED lamps will follow the visitors of Newark Airport.</a></li>
<li><a href="../213359/index.html">We remove the parking brake: the development of "behind the glass", nano-franding and news</a></li>
<li><a href="../21336/index.html">Gmail - interface changes</a></li>
<li><a href="../213361/index.html">The court's decision. Railways vs Apple</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>