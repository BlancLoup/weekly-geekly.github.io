<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PCIe SSD, subspecies and future</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Subspecies and prospects of the usual SSD drives were considered in the previous material , and before him considered hard drives . 

 Traditional SAS...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PCIe SSD, subspecies and future</h1><div class="post__text post__text-html js-mediator-article">  Subspecies and prospects of the usual SSD drives were considered in the <a href="http://habrahabr.ru/company/etegro/blog/217735/">previous material</a> , and before him considered <a href="http://habrahabr.ru/company/etegro/blog/217115/">hard drives</a> . <br><br>  Traditional SAS / SATA interfaces are familiar, developed and convenient in everyday life.  There is a large infrastructure - disks, controllers, compatibility with expanders, waste cable management.  Attached is the SCSI and SATA stack operation, the latency of the interface controllers.  The ongoing struggle to increase IOPS and reduce delays requires getting rid of unnecessary links and placing drives as close as possible to the processor.  So what to do if the performance of the SAS / SATA SSD is not satisfied and you want even faster? <br><br>  Choose a PCIe! <br><img src="https://habrastorage.org/getpro/habr/post_images/a1b/ae6/eac/a1bae6eacad87c097ba209c3593ce1fc.jpg"><br>  Trends, as usual, divided. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  The simplest cards (as in the photo above) use regular SATA drives connected to a PCIe controller.  There are no advantages over simple SATA SSDs, everything is transmitted to the same AHCI stack.  This subspecies will not be considered, it is intended for consumer devices. <br><br>  More sophisticated options use SAS bridge and flash memory controllers with connection to the bridge. <br><br> <a href="http://http:"><img src="https://habrastorage.org/getpro/habr/post_images/e0a/9e3/89f/e0a9e389f808c3c6aa027f5d0b90782c.jpg"></a> <br><br>  In fact, the second subspecies is an array of SAS SSD, which are combined into a single space by means of the OS.  The undoubted advantage of this approach is the ability to use a standard SCSI stack.  Works everywhere, complaints minimum, the decision worked out for decades.  Density is also at altitude, because there is no restriction of 2.5 ‚Äùformat and a flash can be placed a lot, the volume reaches 3.2TB.  Typical representatives - Intel 910, LSI Nytro WarpDrive and Nytro XP, very fast cards with low CPU usage.  The natural disadvantage is still the translation of all levels of the driver and the SCSI stack, which add a delay and I want to get rid of it. <br><br>  In order to get rid of unnecessary SCSI stack, which was developed in ancient times, when the existence of flash in mass drives has not yet dreamed, some developers have come up with drives with specialized controllers that connect PCIe directly to the NAND controller.  Such cards make Fusion-io, Virident, Huawei, Micron. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cca/fc3/814/ccafc3814eb692e52bba6e58f41246d6.png"><br><br>  Pros: <br><ul><li>  Low latency, the best figure for today is around three microseconds. </li><li>  High performance - up to 3.2 / 2.8 GB / s read / write in large blocks and <br>  770K / 630K IOPS read / write in 4K blocks. <br></li><li>  Lack of SCSI stack, optimization of work with NAND (for example, Fusion-io). </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/33a/8be/b31/33a8beb315306349f44cbb68816d9a1f.jpg"><br><br>  Minuses: <br><ul><li>  High CPU utilization (not so important when processors with 16 cores are available). </li><li>  Impossibility of hot swapping: in general, PCIe cards do not allow this. </li><li>  Drivers are unique to each controller. </li></ul><br><br>  The uniqueness of the drivers complicates the spread of promising technology, so the search for a single solution began. <br><br>  <b>NVM Express</b> <br><br>  Over 90 companies have joined the NVMHCI Work Group to develop the new NVM Express protocol, which will unleash the potential of SSD solutions in a single standard.  The future is not forgotten - multi-core optimization enables each thread to select its turn of commands and interrupts.  An advanced error detection and control system is great for industrial applications.  The self-encryption protocol is supported. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/746/4eb/f69/7464ebf695e34b715c4975430c801989.png"><br>  <i>So get rid of SCSI</i> <br><br>  The scalable host controller interface supports up to 64K commands in one I / O queue, which can also be 64 thousand.  The basis of NVM Express is the combined Submission and Completion Queue mechanism (the execution queue and the completed queue).  Commands from the programs are placed in the Submission Queue, the result of the execution is placed in the Completion Queue controller.  Several Submission Queues can use the same Completion Queue and all of them are located in the host‚Äôs memory. <br><br> <a href="http://http:"><img src="https://habrastorage.org/getpro/habr/post_images/1f6/c97/680/1f6c976808a12cb2f93335c3b71558cb.png"></a> <br>  <i>Beautiful scheme</i> <br><br>  Admin Submission and Completion Queue exist for controlling devices ‚Äî creating and deleting command queues, canceling command execution, etc.  Only management commands from the Admin Command Set can enter these queues. <br><br>  Custom software can create queues up to the controller limit, but it is considered normal practice to focus on server capabilities.  For example, for four cores in the system, it is better to create four pairs of queues to avoid locks and bind processes to the cores.  This approach provides efficient performance scaling and low latency. <br><br>  Main features of NVMe: <br><ol><li>  Supports 64K I / O queues, 64K commands each. </li><li>  Developed arbitration mechanism and priority queue I / O system. </li><li>  The command set is reduced to 13 without taking into account control and reservation commands. </li><li>  Support for MSI-X and interrupt aggregation. </li><li>  A total command size of 64 bytes ensures high performance on random operations in small blocks. </li><li>  Support for I / O virtualization, such as SR-IOV. </li><li>  Manages one record in the MMIO register in the command queue. </li><li>  Supports multiple namespaces. </li><li>  Advanced error detection and management. </li><li>  Supports MPIO (including backup), full data protection (DIF / DIX). </li></ol><br><br>  <i>Summary table of advantages over traditional AHCI interface (without translation)</i> <table><tbody><tr><td></td><td>  AHCI </td><td>  Nvme </td></tr><tr><td>  Maximum queue depth </td><td>  1 command queue;  32 commands per queue </td><td>  65536 queues;  65536 commands per queue </td></tr><tr><td>  Uncacheable register accesses (2000 cycles each) </td><td>  6 per non-queued command;  9 per queued command </td><td>  2 per command </td></tr><tr><td>  MSI-X and interrupt steering </td><td>  single interrupt;  no steering </td><td>  2048 MSI-X interrupts </td></tr><tr><td>  Parallelism and multiple threads </td><td>  requires synchronization lock to issue a command </td><td>  no locking </td></tr><tr><td>  Efficiency for 4 KB commands </td><td>  command parameters require two serialized host DRAM fetches </td><td>  gets command parameters in one 64 bytes fetch </td></tr></tbody></table><br><br>  Drivers for Windows were supported by the <a href="https://www.openfabrics.org/index.php">OpenFabrics Alliance</a> , starting with Windows Server 2012 R2, NVMe support is built in by Microsoft itself. <br><br>  The drivers for Linux from Intel were included in kernel 3.3, and the kernel 3.13 included a new block layer for working with SSDs, which were helped by Fusion-io employees.  The new design of the kernel divides the internal queues into two levels (by processors and hardware submission queues), removing the bottleneck and parallelizing I / O.  In release 3.13, only the virtioblk driver was modified, other drivers will be modified later. <br><br>  It seems everything is fine, fantastic performance and low latency for accelerators have found their place in the market, but something is missing.  Well, of course, what is a real corporate drive without hot swapping?  Disorder, must be eliminated. <br><br>  For distribution to the masses, it is also desirable to use the existing form factor, the choice fell on the 2.5 "format (logical), while preserving the SAS connector. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1bb/d20/59f/1bbd2059f701fadb7d3d988331242107.png"><br>  <i>SAS connector with additional contacts</i> <br><br>  A traditional PCIe flash card requires careful handling in order not to damage static-sensitive chips.  In addition to the possibility of hot-swapping, in a 2.5 "format, the flash is protected by a casing to avoid excesses. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/965/6e0/0f7/9656e00f77990cb5b4dce08d9c358c0c.jpg"><br>  <i>NVMe SSD</i> <br><br>  Naturally, not without a small flaw.  As we already wrote, the flash itself is a very slow product and controllers have a large number of channels to parallelize the work.  In the 2.5 "format, space is limited and it is extremely problematic to achieve the performance of a full-size PCI card - there is not a lot of flash to fit. <br><br>  Samsung XS1715 promises 740K IOPS for reading, Micron P420m and Intel P3700 are noticeably more modest - 430K and 450K, respectively. <br><br>  <b>Now about us and NVMe</b> <br><br>  Among current products, 4 NVMe SSDs can be installed into a four-processor <a href="http://www.etegro.ru/configurator/servers/rackmount/enterprise/rs530g4">ETegro Hyperion RS530 G4</a> server based on Intel Xeon E7-4800 v2. <br><br> <a href="http://http:"><img src="https://habrastorage.org/getpro/habr/post_images/7bc/4f0/1c6/7bc4f01c6f5d0597b5fd4a2fa8529c99.jpg"></a> <br><br>  The four drives on the left can be either SAS or NVMe, depending on the connected cables.  Under three million IOPS, under 12GB / s read speed is a great addition to 60 cores and six terabytes of RAM :) <br><br>  By the way, the server has four hot-swapped PCIe slots, so even the current PCIe cards can be changed on the fly, albeit with some inconvenience. <br><br>  In the next generation of dual-processor systems based on Intel (which will be launched in the fall), regular seats for NVMe drives are also provided. </div><p>Source: <a href="https://habr.com/ru/post/218853/">https://habr.com/ru/post/218853/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../218843/index.html">How long can you be mistaken thinking that Foglight will promptly report a problem with memory loading</a></li>
<li><a href="../218845/index.html">Hello% habrauser%! Let's get acquainted!</a></li>
<li><a href="../218847/index.html">Two days to the International Space Apps Challenge</a></li>
<li><a href="../218849/index.html">4 ways to grow your business with customers</a></li>
<li><a href="../218851/index.html">Samsung introduced new smart bulbs</a></li>
<li><a href="../218855/index.html">Erlang / OTP 17.0 released</a></li>
<li><a href="../218857/index.html">Why do employees make stupid mistakes and what to do about it. Part 2</a></li>
<li><a href="../218859/index.html">Accident Alert Info Panel Project (Part 2)</a></li>
<li><a href="../218861/index.html">Solar Solar Solar Impulse 2 will take a trip around the world</a></li>
<li><a href="../218865/index.html">Plugin to expand accessibility support in the PhoneGap framework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>