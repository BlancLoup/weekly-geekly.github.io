<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Win32 / DoS.OutFlare.A aims to circumvent the anti-DDOS service CloudFlare</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="CloudFlare is a popular CDN- support service for websites and includes various types of services, such as, accelerating the loading of web pages for t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Win32 / DoS.OutFlare.A aims to circumvent the anti-DDOS service CloudFlare</h1><div class="post__text post__text-html js-mediator-article">  CloudFlare is a popular <a href="http://ru.wikipedia.org/wiki/Content_Delivery_Network">CDN-</a> support <a href="http://ru.wikipedia.org/wiki/Content_Delivery_Network">service</a> for websites and includes various types of services, such as, accelerating the loading of web pages for the end user, security features, for example, anti-DDoS.  We detected a malicious program, Win32 / DoS.OutFlare.A, which aims to bypass this service in order to launch DoS attacks on sites that are under the control of CloudFlare.  Our analysis is dedicated to Win32 / DoS.OutFlare.A. <br><br><a name="habracut"></a><img src="https://habrastorage.org/storage2/ce2/d5a/306/ce2d5a30628aaf797e73b5efa82ac30e.jpeg"><br><br>  The behavior of malicious code is not particularly remarkable.  At the start, he tries to create the <b>Global \ sad_day</b> mutex as evidence of his stay in the system.  If successful, it copies itself to the% APPDATA% directory, adds itself to autorun and restarts.  After this, OutFlare launches a copy of the Internet Explorer browser process - iexplore.exe in a suspended state (suspend) and implements its payload into it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/ea3/4a7/fba/ea34a7fbac37c9b740bfff5da103f2e7.png"><br>  Fig.  CloudFlare performs important tasks in separate streams. <br><br>  Before connecting to its C &amp; C managing server, the malicious code performs three tests to measure the speed of outgoing downloads using public services <a href="http://www.speakeasy.net/">www.speakeasy.net</a> and stores these results in memory.  After that, the bot connects to the IRC server using TCP port 9835 and the channel #main.  At this stage, the bot will be in the Idle state, waiting for commands from the server.  Most of these commands are DoS attacks.  One of them - ‚Äúcf‚Äù, is especially interesting.  This team is responsible for implementing client-side CloudFlare anti-DDoS bypass. <br><br><img src="https://habrastorage.org/storage2/1d6/c26/f7f/1d6c26f7fc7a01aa1ecdb36c20710690.png"><br>  Fig.  List of commands supported by the bot. <br><br>  The CloudFlare service uses a special method aimed at preventing DDoS attacks.  In such a system, the client must fulfill certain conditions when accessing a site controlled by CloudFlare, which in turn must be sure that the request is legitimate and comes from the user's browser.  The service asks the browser to execute a special Java script that is a mathematical expression, while visually, the test from CloudFlare looks like for the user as in the figure below: <br><br><img src="https://habrastorage.org/storage2/91e/d44/c79/91ed44c79c15dcae29c81db52e6f5de4.png"><br><br>  The page contains a special form of a POST request, which will be used to send a response to the server.  Immediately below this form is a Javascript code snippet that counts a mathematical expression and executes a POST request from the previous form. <br><br><img src="https://habrastorage.org/storage2/518/b92/f54/518b92f54f431b685441ba38172bd0b1.png"><br>  Fig.  POST HTTP request form. <br><br><img src="https://habrastorage.org/storage2/569/94a/5e6/56994a5e6498fab486d5dc7cefd737f0.png"><br>  Fig.  Counting math expression. <br><br>  The user's web browser will execute this Javascript and execute an HTTP POST request, which will look like in the screenshot below.  This response sent to the server will contain the calculated value of the mathematical expression. <br><br><img src="https://habrastorage.org/storage2/806/7d4/f95/8067d4f95c1f3e6b6d61ba3ef0a6a3a3.png"><br><br>  If the expression was calculated correctly, the CloudFlare service will respond by setting a special cookie confirming the connection to the server.  References to this cookie in further requests, during this open session with the server, will cause CloudFlare to send the request to the server directly, bypassing the special check. <br><br><img src="https://habrastorage.org/storage2/238/6cf/112/2386cf1129a9d68aabfef0d8164925b7.png"><br><br>  Win32 / DoS.OutFlare.A contains functionality that aims to bypass this protection mechanism.  It analyzes a part of the code of a web page and searches for matches by the necessary part of the JS CloudFlare functionality.  After the necessary parameters have been identified, the malicious code calculates the mathematical expression and sends it to the server to obtain the necessary cookie, which is necessary for conducting a DDoS attack on a real web server. <br><br><img src="https://habrastorage.org/storage2/325/2a7/9cd/3252a79cd23cfa73ac9f75062b66ab76.png"><br>  Fig.  Extracting an expression that needs to be evaluated. <br><br><img src="https://habrastorage.org/storage2/508/cdb/06b/508cdb06bc093311a26299b011eb87ac.png"><br>  Fig.  Calculation of expression. </div><p>Source: <a href="https://habr.com/ru/post/170227/">https://habr.com/ru/post/170227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../170209/index.html">Nuclear battery</a></li>
<li><a href="../170213/index.html">Bidirectional transactional data replication</a></li>
<li><a href="../170215/index.html">Where did xUnit go</a></li>
<li><a href="../170217/index.html">Best Android Mobile Development Apps</a></li>
<li><a href="../170221/index.html">Safety control systems practices and examples</a></li>
<li><a href="../170229/index.html">Website development for mobile devices</a></li>
<li><a href="../170233/index.html">Free Windows Phone / Windows 8 Developer School in St. Petersburg</a></li>
<li><a href="../170235/index.html">Automatic tuning of Icecast2 and mpd to several audio streams</a></li>
<li><a href="../170237/index.html">NTT Expands IaaS Services Geography and Advertise SDN</a></li>
<li><a href="../170239/index.html">PlayStation Meeting 2013 summary</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>