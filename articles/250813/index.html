<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Spatial positioning system for aviation (using FPGA)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prologue 
 In any article devoted to FPGA , in the comments sooner or later the thought appears, they say, "a funny thing, put together a simple proje...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Spatial positioning system for aviation (using FPGA)</h1><div class="post__text post__text-html js-mediator-article"><h4>  Prologue </h4><br>  In any article devoted to <a href="http://ru.wikipedia.org/wiki/FPGA">FPGA</a> , in the comments sooner or later the thought appears, they say, "a funny thing, put together a simple project, flashed LEDs, and what to do with this useful - I will not put my mind to it."  Someone under the FPGA creates games, someone porting the standard processors of the old days, but all this is positioned primarily as an entertainment and technology development.  Indeed, the FPGA technology in the application ‚Äúfor home, for family‚Äù is too expensive and clearly redundant.  Today I will try to talk about a system in which the FPGA finds its harmonious use exclusively for peaceful and socially useful purposes (no mechanisms for speculation on the exchange, voyeurism or killing one‚Äôs own kind).  However, as it will be possible to notice from the further story, a significant part of the narration will be devoted to the subject area and the level of system design. <br><a name="habracut"></a><br>  A brief background is as follows - one large domestic enterprise received a mandate (not sure if it was an order, so let's just call it ‚Äúan order‚Äù) to create a navigation system for one domestic airport.  In principle, they had the experience of creating such systems, but they required special knowledge of a number of technologies, and therefore experts in the development of devices based on FPGA were involved.  Actually, the story and will be conducted from the point of view of such a specialist, many other questions may well be missed for ignorance ... <br><br><h4>  Formulation of the problem </h4><br>  The main task of the system is to ‚Äúmonitor‚Äù all ground objects traveling across the airport, to consolidate information, display on the operator‚Äôs workplace, and possibly other services that automate movement control.  Further development of the system assumed its use for [legitimate] flying objects in the vicinity of the airport.  The standard solution of this problem is the <a href="http://ru.wikipedia.org/wiki/ADS-B">ADS-B</a> technology, which assumes that each aircraft has a special transceiver (transponder) transmitting various data on the air at a frequency of 1090 MHz in a special format using amplitude modulation.  The coordinates of the aircraft can also act as such data.  Recently, there is a tendency to install such transponders on ground machines of airport services.  The disadvantage of this system is that the coordinates are determined by the object itself (based on GPS / GLONASS / Galileo or more ancient technologies), and the navigation system can only trust them.  Even if we discard the possibility of deliberate distortion of data, their accuracy is not particularly great and may be critical for ground vehicles.  Another frequently used option is active radar, which illuminates all objects in the immediate vicinity.  The disadvantage of this technology is the impossibility of identifying objects, as well as the relationship between the size of the object and the size / brightness of the mark on the radar. <br><br><img src="https://habrastorage.org/files/718/df8/864/718df886469147bab5c82904e5b79691.png"><br>  Recently, a hybrid technology that combines the advantages of these two approaches, based on the so-called multilateration (MLAT), is becoming more common.  For a more detailed description, I will send everyone to a good <a href="http://adsbradar.ru/crosstags/multilateratsiya">amateur resource</a> , and I will briefly tell the general idea.  Every modern civilian aircraft (true for large aircraft, in small aircraft is more and more difficult) constantly sends on the air (in fact, on request, but now it does not matter) the messages in the standard ADS-B Mode-S.  These messages can be received by a single receiver and then we have to be content with their internal content.  MLAT uses many receivers with known coordinates.  In this case, we have additional information in the form of a message receiving time from each of the receivers.  We do not know the absolute time of sending a message by plane, but we know the difference in the arrival times of messages relative to the receiver chosen as the base one.  If we assume that radio waves propagate in the air evenly and straightforwardly (quite possible assumption for our task), we get the difference in distances from the aircraft to the receivers relative to the base.  On the basis of these data, armed with a compass and a ruler (better still a computer with a 3D accelerator), it is easy to establish the coordinates of the aircraft relative to the receivers, and then recalculate them to standard ones. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Initially, MLAT technology was used for older types of transponders that do not support ADS-B Mode-S mode (only Mode-A, the implementation of which is noticeably simpler).  Now all this is integrated into a common system called ADS-X (Extended ADS).  This kind of system was chosen for use.  It should be noted that in the world (and in Russia), of course, there are similar systems operated by Western manufacturers, but there was a desire (including a politically determined one) to create a domestic system of this kind. <br><br>  There are three types of system architecture: <br><ol><li>  Independent receivers with their own clock sources; </li><li>  Receivers with a common clock signal; </li><li>  A common receiver that receives analog signals from antennas. </li></ol><br>  The first type of architecture is universal in terms of placement on the ground; however, the problem of synchronization of clocks of receivers is acute for it.  Modern GPS modules have the accuracy of the formation of time marks of the order of 100-200 ns.  As you know, radio waves propagate at the speed of light (300,000 km / s).  Thus, the measurement error of 100 ns will give us an estimate of the positioning error of 30 m. It is quite enough for air traffic control, but not suitable for ground vehicles - here at least 3-5 m of accuracy is required. As a result, this architecture requires use more sophisticated technology to synchronize clock receivers. <br>  The second and third type of architecture is free from a similar problem, however, it requires a direct connection of receivers (antennas) with the information processing center, which leads to restrictions on the area covered by the system.  In addition, there are problems of "adding" delays in the delivery of signals by wire, but they can be solved by calibrating the system relative to transmitters with known coordinates.  Since our task is to build a local system for the airport, as well as due to the presence of some infrastructure, the customer chose the third option of the system architecture. <br><br><h4>  Design of the receiver structure </h4><br>  The immediate task of the device being created is to receive an analog signal from receiving antennas, detect ADS-B frames in it, and calculate delays between receiving the same frame by different antennas.  In the future, the collected information for each received frame is transmitted to the higher system. <br><br>  The ADS-B Mode-S format frame (also called squitter, from English. Squitter) consists of 56 or 112 data bits with a preceding preamble.  The 8 ¬µs preamble contains two pairs of pulses going some distance from each other, followed by the information part, in which each data bit is encoded with a transition 0 =&gt; 1 or 1 =&gt; 0. <br><img src="https://habrastorage.org/files/64b/f13/961/64bf13961e004bdda9d36a814269bf55.png"><br>  The first look at this picture makes you want to put a comparator and sample the result at the maximum possible frequency (at least 1-2 GHz if desired), recording the exact time of the frame start.  Unfortunately, this solution will not work [normally] and there are many reasons for this: <br><ol><li>  when the signal is transferred to the RF frequency (1090 MHz) and back, the waveform is significantly distorted, the pulses are far from rectangular; </li><li>  signals from different sources will have different power, which means there is a problem of choosing the level by which the comparator should work; </li><li>  in the conditions of a large number of transponders working alongside, a situation is quite likely when two (or more) squitters overlap each other - this is quite a normal situation and receivers should be able to receive such signals in some cases; </li><li>  interference in the air and reflections that distort the shape of the received signals; </li><li>  and finally, such a solution leaves behind the brackets the problem of directly receiving and decoding messages with the purpose of identifying from which object the given squitter was sent. </li></ol><br>  In this regard, a different approach was used, which allows to more accurately determine the difference in time of their reception by the forms of received signals.  Mathematical modeling showed that the sampling frequency in this case may be relatively low, in our case it was chosen equal to 12 MHz, that is, 12 samples per bit of transmitted data (remember, the length of 1 bit is 1 Œºs). <br><br>  In ancient times, I wrote <a href="http://habrahabr.ru/post/111544/">an article</a> about general approaches to the development of equipment.  In principle, nothing fundamentally has changed since that time.  Initially, as mentioned above, the very idea of ‚Äã‚Äãcalculating delays was tested on the mathematical model, after receiving positive results, a functional diagram of the device was developed. <br><br><img src="https://habrastorage.org/files/057/dac/a23/057daca239a647ed8703c910d17b1d14.png"><br>  One of the system requirements is scalability - the ability to increase the number of reception channels without significantly changing the device architecture.  It was planned that one device will be able to serve up to 32 receiving channels (16 with redundancy). <br>  The signals arriving from the antennas are transferred to a low frequency in AM demodulation units, the number of which is equal to the number of receiving channels.  Next, data is digitized using multichannel ADCs with a relatively low sampling rate (tens of MHz).  Such ADCs have many analog data inputs and a high-speed serial or serial-parallel digital interface, within which information from all channels is transmitted packed into frames.  This allows you to significantly save on the trace of the printed circuit board and on the resources of the I / O elements of the microcircuits that implement the interface with the ADC. <br><br>  As an information processing device, it is most convenient (in this case) to use FPGA, which allows solving a complex of tasks right away - an interface with an ADC, data buffering in high-speed internal memory, DSP processing and complex control algorithms implemented on an embedded processor.  In fact, the question of choosing a hardware platform is not easy.  According to general estimates, there is a chance that in a good DSP you can also manage to do all the processing, but did not want to risk it.  Moreover, in any case, you also need to support the interface with the ADC, which means you would have to install the FPGA one way or another. <br><br>  The received signals are buffered and sent to ADS-B frame receive blocks.  The number of blocks corresponds to the number of received channels.  They detect the preamble, extract the data and check their checksums.  Also taken a number of measures to receive superimposed frames, in the event that one of them has a noticeably greater power.  The received frames with time stamps are transmitted for further processing. <br><br>  At the same time, another procedure is performed ‚Äî the calculation of the exact delay (with an accuracy of less than one sampling interval) from the forms of the received signals.  For all received frames, their position in the buffer is established, after which they are sent in pairs (relative to any channel selected by the master), combined with an accuracy of one sampling interval, for processing.  After intensive digital processing in both the time and the spectral regions, the output is a number in fractions of the sampling frequency ‚Äî how far the frames are separated from each other.  For example, in the following picture, two signal implementations are shown, separated from each other by half of the sampling interval (for convenience of perception, they are combined in time and the points indicate when they were sampled).  The unit for calculating the exact delay when these signals are fed to the input will produce a value of 0.5 (or -0.5, depending on which of the signals came earlier), i.e.  half the sampling interval. <br><img src="https://habrastorage.org/files/a6c/2da/923/a6c2da9231ab46e09261176c310471fb.png"><br><br>  At the end of this procedure, you can prepare summary information for each frame: the data contained in the frame and reception delays for each channel.  The complexity of the overall frame processing control procedure also lies in the fact that different channels can receive frames from different objects at the same (near) time - depending on which transmitter is more powerful and who will be located relative to the antennas.  In the end, the collected information is sent to the higher-level system for further processing and calculating the spatial position of objects. <br><br>  As you can see, the resulting text does not contain a single line of code.  Going into any implementation nuances is a long and difficult affair.  To give the code, in my opinion, the occupation is completely meaningless, for any single piece looks trite, and too much nobody will read too much.  Therefore, in this article I focused on the basic ideas and the general structural description.  Maybe in the future will be written another part, revealing the details of the implementation of some individual elements.  Well, now it's time to finish ... <br><br><h4>  As an epilogue </h4><br>  In the framework of the first stage of development <s>,</s> a prototype of the system described above, containing only 4 channels <s>,</s> was created <s>from the radio components found in the trash can</s> .  When testing ‚Äúon the table,‚Äù the error in measuring delays with a strong signal level was less than 2 ns and gradually decreased with a deterioration of the signal-to-noise ratio.  When testing in real conditions, the error was about 10 ns, which, according to colleagues, is about 2-3 times better than that of a similar purchasing system.  Taking into account that the estimated cost of the product being developed from scratch <s>due to the fact that the developers lived in the barracks on bread and water</s> was in the region of the serial samples of competitors, all this inspired bright prospects for successful completion of the project. <br><br>  Unfortunately, last fall there was a sad event - a private airliner <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2582%25D0%25B0%25D1%2581%25D1%2582%25D1%2580%25D0%25BE%25D1%2584%25D0%25B0_%25D1%2581%25D0%25B0%25D0%25BC%25D0%25BE%25D0%25BB%25D1%2591%25D1%2582%25D0%25B0_Falcon_50_%25D0%25B2_%25D0%25B0%25D1%258D%25D1%2580%25D0%25BE%25D0%25BF%25D0%25BE%25D1%2580%25D1%2582%25D1%2583_%25D0%2592%25D0%25BD%25D1%2583%25D0%25BA%25D0%25BE%25D0%25B2%25D0%25BE">crashed</a> at Vnukovo airport, and even with a very high-profile passenger.  One of the factors of the incident was the lack of a modern navigation system at the airport, like the one described above.  This event led to paradoxical consequences for the project - somewhere high up, it was decided that it was too long and unguaranteed to create its own system, and therefore it was decided to purchase ready-made receivers (and possibly other components of the system - I do not own the question) at the western partners, and the current development was closed. </div><p>Source: <a href="https://habr.com/ru/post/250813/">https://habr.com/ru/post/250813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250799/index.html">Ask Lenovo</a></li>
<li><a href="../250803/index.html">Centralized logs for applications using heka + elasticsearch + kibana</a></li>
<li><a href="../250807/index.html">Visual brute force on the example of solving a 3D puzzle</a></li>
<li><a href="../250809/index.html">Using an alternative memory allocator in a C / C ++ project</a></li>
<li><a href="../250811/index.html">Apache Spark Introduction</a></li>
<li><a href="../250815/index.html">Lock-free data structures. Concurrent maps: skip list</a></li>
<li><a href="../250817/index.html">The mathematical problem of 100 boxes and the rescue of prisoners</a></li>
<li><a href="../250819/index.html">Black Swift - at Embedded World Conference</a></li>
<li><a href="../250821/index.html">The quality of data networks. Software and hardware measurements</a></li>
<li><a href="../250823/index.html">Pebble: accelerometer, example of use</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>