<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Are the "top" sites safe: exploring Alexa ranking</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you look at the Alexa Top-1000 sites in the .ru zone, then in the first three hundred there will be Yandex, Google, Mail.ru and other major project...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Are the "top" sites safe: exploring Alexa ranking</h1><div class="post__text post__text-html js-mediator-article">  If you look at the <a href="https://ru.wikipedia.org/wiki/Alexa_Internet">Alexa</a> Top-1000 sites in the .ru zone, then in the first three hundred there will be Yandex, Google, Mail.ru and other major projects and companies, and then mainly entertainment, game resources, torrents and profile Media (and sometimes there will be domains of teaser partner networks). <br><br><img src="https://habrastorage.org/files/610/cf8/8de/610cf88ded1244d5bd5828977610bec1.jpg"><br><br>  For sites that are not the most top positions of the first thousand, attendance is about 10,000 - 80,000 unique hosts per day, and sometimes higher.  For hackers, such resources are attractive because, on the one hand, websites have a high attendance rate, and on the other hand, a low level of protection (usually no one at all), since the owners of such sites often do not pay enough attention to security issues (they don‚Äôt know, they don‚Äôt know how do not want).  For example, a resource with attendance of 85,000 unique hosts per day can work on Wordpress with vulnerable versions of plug-ins.  It turns out that the ratio of the cost of hacking to the "profit" from it for this category of sites as much as possible, and this is a tidbit that at least one attacker can use.  In theory, everything seems to be logical, but I would like to see this in practice, so I decided to scan a large array of top resources (for example, the first 50,000 Alexa sites in the .ru zone) for hacking / infection, redirects and other security problems.  What came out of it is in the article below. <br><a name="habracut"></a><br>  To save readers time, I‚Äôll immediately give the results: about 2% of the sites (to be exact, 971 sites) were ‚Äúsick‚Äù.  Among the problems was a complete set: redirects to download infected apk and exe files, hidden mobile redirects to wap-click affiliate programs, phishing, and even two defaces.  Despite the fact that the percentage of problem sites seems to be small, the danger turned out to be significant, since hidden redirects showed up on popular sites with an attendance of 60K hosts per day. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For more effective detection of malicious code, I used several infection indicators, since malware is not always possible to be determined only by signatures or only by using behavioral analysis.  For the analysis, the following were taken into account: <br><ul><li>  redirects when opening pages with various parameters User Agent + Referer, </li><li>  malicious script signatures (regular expressions), </li><li>  the presence of a domain or URL fragment in dangerous, suspicious or malicious databases, </li><li>  availability of the site in the ‚Äúblack lists‚Äù of search engines (safe browsing) and anti-virus services (based on virus total) </li></ul><br>  To minimize the number of false positives, white lists of domains and URL fragments were used.  For example, redirects were not taken into account when clicking from banners and banner plug-ins, redirects to mobile versions of sites, etc.  When checking each site, a series of requests were sent to the start page, navigation was made to the linked pages, on which certain actions were performed, as if the site had real visitors with various parameters (browser, referrer, platform, etc.).  After that, the result for all pages was combined and a general report was formed.  And so for each of the 50,000 verifiable resources.  The standard phantomjs for such a task did not fit due to restrictions on some readonly DOM objects that I had to override, so I had to properly finish them together with WebKit. <br><br>  An analysis of a large array of sites revealed some common infection patterns and typical ways of introducing malware into script and page code (for example, frequent use of a link shortening service, like goo.gl, vk.cc to hide the address of scripts, add code to the beginning or end of jquery *. js files, a family of unscrupulous teaser / advertising partner networks, etc.). <br><br>  Details show on a couple of examples.  The first will be a resource located on the 750 position ranking ru sites Alexa.  This is a fairly popular torrent.  It has a naturally high attendance - just over 60,000 unique visitors per day (according to the liveinternet counter). <br><br><img src="https://habrastorage.org/files/f88/5c6/301/f885c6301fd44f6a80ebd5efc1211114.png"><br><br>  Let's try to open the site from the mobile: we enter the address of the site in the Google search bar, go to the subsection and click on the download button in the text of the page.  Instead of downloading a .torrent file, we are starting to redirect to third-party sites, and as a result we are offered to download and install an .apk file called download.apk. <br><br><img src="https://habrastorage.org/files/be9/b91/521/be9b91521e2f4c1cac3d98abf2e719eb.png"><br><br>  In order to quickly check the file for ‚Äúmalwares‚Äù, we upload it to Virustotal and get the quite expected result - SMS.Agent (i.e. sms spy): <br><br><img src="https://habrastorage.org/files/6ab/066/11b/6ab06611be1046b5bab2f12e35346f6a.png"><br><br>  If you repeat the experiment a few more times, then sometimes you are prompted to download a download accelerator, which, as you may have guessed, speeds up the interception of your SMS: <br><br><img src="https://habrastorage.org/files/e24/e98/9a8/e24e989a8524403db94b527b06caa83a.png"><br><br>  In order for the malicious code to be discovered as late as possible, the hacker tries his best to disguise it: he injects the code dynamically and uses a multi-step test in runtime.  For this reason, it is extremely difficult to catch a redirect, without knowing all the nuances, with automated scanners.  In this case, the redirect had the following properties: <br><ul><li>  the malicious injection was in the scrolltop.js script. </li><li>  the code worked on the visitor 1 time in 4.5 months (cookies were set) </li><li>  The code was introduced dynamically only if the visitor came from a search engine. </li><li>  the redirect itself worked only when clicking on certain links </li><li>  the .apk download started if the visitor came from the android device (checked in the redirection chain to a malicious resource) </li></ul><br><br>  Below is the code snippet that the loader implemented: <br><br><img src="https://habrastorage.org/files/0b2/179/4e0/0b21794e00664ece85400e969fa157d7.png"><br><br>  If at least one of the listed conditions is not met, then no redirection will occur.  Despite the complex condition of the occurrence of a redirect, the scanner managed to calculate the malware by its characteristic signature and script injection from a suspicious domain: <br><br><img src="https://habrastorage.org/files/175/88f/be4/17588fbe4a48486580920e57fe6e9ff7.png"><br><br>  You can roughly estimate the "scale of the disaster" for this site.  When hacking and infecting a resource with a traffic of about 50-60K, an average of about 400-500 visitors come from mobile devices.  On a vskid, hundreds of visitors can download an infected .apk file. <br><br>  Consider another "top" example from the list of infected.  This time it is a fitness portal, which occupies approximately 450 places (that is, even more visited).  This "patient" alternately threw on the paid subscription service, then on the software that offers acceleration android. <br><br><img src="https://habrastorage.org/files/8ca/bee/ab8/8cabeeab8e6540aa9bebeb50fd97d22b.png"><br><br>  At the next redirect, for the sake of curiosity, I clicked the ‚ÄúContinue browsing‚Äù button and then magic happened: I was automatically subscribed to paid content, which was immediately notified by SMS.  No questions or confirmation that I want to do this, no additional gestures were required. <br><br><img src="https://habrastorage.org/files/d8d/cb6/d74/d8dcb6d741ae4d459eb1ca8687393972.png"><br><br>  Checked in the list of connected services in the personal account of MTS - there really appeared a paid subscription for 20 rubles.  Unsubscribed. <br><br>  What is interesting, at the time of generating the page with the ‚Äúcontinue browsing‚Äù button, the script already knows your phone number, because the SMS subscription is done with the ‚Äúblessing‚Äù of the mobile operator itself, which provides the necessary interface and information about the subscriber. <br><br><img src="https://habrastorage.org/files/46b/7eb/619/46b7eb619eb049519bd43d114bec3ea4.png"><br><br>  So the subscription process can not be automated.  And if you do not follow the SMS notifications, you can get a few dozen rubles a day simply by visiting various portals (this is without considering clickjacking, where you unknowingly click on the right place and approve the subscription or download of the malware). <br><br>  The implementation mechanics on this site are simpler: a hacker added the following fragment to one of the javascript files: <br><br><img src="https://habrastorage.org/files/403/548/13e/40354813e9d1446986e3678502f18127.png"><br><br>  This code downloaded the script from the yadro24.ru domain, and that, in turn, redirected users to the wap-click portal, provided that the visitor was connected via 3G / LTE Internet (using the javascript code, you can see what redirects are possible). <br><br><img src="https://habrastorage.org/files/a09/004/1a1/a090041a1a364e3eb7c2498cd58464e1.png"><br><br>  If the mobile site visitor came through WI-FI, no redirects to the wap-click affiliate program occurred.  This, by the way, is a big problem for determining wap-click redirects with online services, since all requests need to be sent via 3G / LTE to certain cellular operators. <br><br>  Similar infection variants were found on other sites from the Alexa Top.  Sometimes they embed code at the beginning of scripts, sometimes at the end. <br><br><img src="https://habrastorage.org/files/382/cae/52b/382cae52ba6a42c09ddacdb6f7be56f2.png"><br><br>  The considered examples are an obvious target hacking of sites and introduction of code by hackers.  But among the tested sites, there was often another option: voluntary placement of a widget with hidden redirects or a teaser partner network that redirects mobile users to dangerous sites or a wap-click affiliate program.  At the same time, site owners are either not aware of what is happening, or, in pursuit of high earnings, turn a blind eye to this. <br><br>  Summary statistics for various categories of infection was as follows: <br><br><img src="https://habrastorage.org/files/0e4/fd6/0b6/0e4fd60b68f741e1b696c90900b3f06d.png"><br><br>  A curious fact: most of the resources that make up the ‚Äúproblem‚Äù list (those that download malicious files or redirect visitors to dangerous sites and wap-click affiliate programs) are not marked in Yandex / Google Safe Browsing as ‚Äúmalware‚Äù or even ‚Äúunwanted‚Äù .  Whether search engines do not have time to check them, or does not detect them, although the latter is unlikely.  True, some sites are still removed from the search results of the mobile search. <br><br>  Well, and finally, I would like to advise two things: <br><br><ol><li>  If you are a visitor to these popular resources - do not hope that all of them are safe.  Even if you have an antivirus installed, it will not save you from such problems as wap-click redirects to SMS subscriptions, because it is not a virus (you are simply imperceptibly subscribed to a paid service and removed every day for 20 rubles) And, frankly, Antiviruses protect from drive-by attacks far from 100% of cases, especially on Android.  Therefore, it is good practice to independently check such sites with specialized services if any suspicion arises. </li><li>  If you are the owner of such resources and have not yet thought about the security of the site, or it seems to you that you are not hacked - it's time to do a full site diagnostics: scan the files on the hosting for hacker web shells, backdoors (there are AI-BOLIT utilities for this, ClamAv, Maldet), it is even possible to do a Pentest project, and also check available security problems with services (for example, using rescan.pro, quttera.com, sitecheck.sucuri.net).  And also, do not be lazy to go from the search results to your site from a mobile device via a 3G / LTE connection, selectively click the links of the site, look at the code, check for any anomalies. </li></ol><br><br>  It should be noted that some resources at the time of writing this article have already coped with the infection and currently do not pose a threat, but there remains a sufficiently large portion of the sites visited, which even after 10 days did not change the situation: <br><br><img src="https://habrastorage.org/files/193/5ea/d37/1935ead379bf4013b291d854a80135da.png"></div><p>Source: <a href="https://habr.com/ru/post/301816/">https://habr.com/ru/post/301816/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301806/index.html">DevConf :: PHP 2016 - the final vote on the section reports is over, manage to cast your vote before May 31</a></li>
<li><a href="../301808/index.html">PostgreSQL is not Rocket Science. How much is the eggs now?</a></li>
<li><a href="../301810/index.html">Squeezing gigabits: or undocumented ViPNet Client / Coordinator feature</a></li>
<li><a href="../301812/index.html">We test the project on SaltStack using KitchenCI</a></li>
<li><a href="../301814/index.html">How to choose ITshnika in Russia: myth number 2, number 3</a></li>
<li><a href="../301820/index.html">Postgres in Chinese or setting Full Text Search in Postgres for Chinese</a></li>
<li><a href="../301822/index.html">Websocket in production</a></li>
<li><a href="../301826/index.html">Dropbox explained why it is embedded in the operating system kernel</a></li>
<li><a href="../301828/index.html">DevConf :: Hackathon by Yii at TASS June 18-19, 2016</a></li>
<li><a href="../301830/index.html">Using the ceiling clock as an information board</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>