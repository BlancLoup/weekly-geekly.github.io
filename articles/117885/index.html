<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write the client for Habr for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Looking ahead, here's what happened: 



 12:56 I will do it in parallel with the writing of the topic (so interesting). In the course of writing a cl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write the client for Habr for Android</h1><div class="post__text post__text-html js-mediator-article">  Looking ahead, here's what happened: <br><img src="https://habrastorage.org/getpro/habr/post_images/315/c18/b06/315c18b068cd2e8d3572e5060a2b7080.png" alt="image"><br><br><a name="habracut"></a><br>  12:56  I will do it in parallel with the writing of the topic (so interesting).  In the course of writing a client explaining all the steps.  So, we smoked, poured tea, prepared a playlist and, while the tea is cooling down, we check if the name habrahabr is occupied in the market.  Great, go to the creation of the application. <br><br>  13:02 Create a new project. <br>  <a href="">Screenshot</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      API level is 4, for the reason that at a lower value - on Samsung Galaxy Tab tablets, the screen resolution will be incorrect and the owners of these miracle devices will not fail to shove a bunch of minuses into the market (although in principle, this is hardly a developer‚Äôs cant). <br><br>  13:08 Fix the manifest. <br>  It is necessary to add two lines: <br>  - android: configChanges = "orientation", this line is necessary so that when we change the orientation of the screen does not destroy our activites. <br>  - &lt;uses-permission android: name = "android.permission.INTERNET" /&gt;, we request permission to access the Internet <br>  <a href="http://pastebin.com/vunnSNS1">AndroidManifest</a> <br>  * plays front242 - headhunter v3.0 <br><br>  13:13 Fix layout. <br>  Erase everything and add a single element - <a href="http://pastebin.com/MDuRrPN6">webview</a> - full screen <br><br>  13:16 Icon. <br>  With the help of a firebug, we cut the absolute link and with the help of Photoshop we cut to 48 * 48 px and throw in res / drawable ... <br><br>  13:27 With the icon all the more difficult it turned out.  The spot of the logo after the reduction turned into muddy crap, I had to <a href="">google it</a> .  I hope the author will not be offended. <br><br>  Phew, the hardest thing is done, finally you can get it. <br><br>  13:39 Load Habr <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> habr extends Activity { <br> <br> <font color="#0000ff">private</font> WebView wv; <br> <br> <font color="#008000">/** Called when the activity is first created. */</font> <br> <font color="#0000ff">@Override</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onCreate(Bundle savedInstanceState) { <br> super.onCreate(savedInstanceState); <br> setContentView(R.layout.main); <br> <br> wv = (WebView) findViewById(R.id.wv); <br> <br> WebSettings webSettings = wv.getSettings(); <br> webSettings.setSavePassword( <font color="#0000ff">true</font> ); <br> webSettings.setSaveFormData( <font color="#0000ff">true</font> ); <br> webSettings.setJavaScriptEnabled( <font color="#0000ff">true</font> ); <br> <br> wv.loadUrl( <font color="#A31515">"http://habrahabr.ru"</font> ); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  * Here we just set our habr view on us, having previously turned on javascript and form / password memorization.  It looks ugly for now, but it is already working.  Smoke break <br><br>  13:53 We continue the conversation. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> habr extends Activity { <br> <br> <font color="#0000ff">private</font> WebView wv; <br> <font color="#0000ff">private</font> String LASTURL = <font color="#A31515">""</font> ; <br> <br> <font color="#008000">/** Called when the activity is first created. */</font> <br> <font color="#0000ff">@Override</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onCreate(Bundle savedInstanceState) { <br> super.onCreate(savedInstanceState); <br> <font color="#0000ff">this</font> .getWindow().requestFeature(Window.FEATURE_PROGRESS); <br> setContentView(R.layout.main); <br> <br> wv = (WebView) findViewById(R.id.wv); <br> <br> WebSettings webSettings = wv.getSettings(); <br> webSettings.setSavePassword( <font color="#0000ff">true</font> ); <br> webSettings.setSaveFormData( <font color="#0000ff">true</font> ); <br> webSettings.setJavaScriptEnabled( <font color="#0000ff">true</font> ); <br> <br> final Activity activity = <font color="#0000ff">this</font> ; <br> <br> wv.setWebChromeClient( <font color="#0000ff">new</font> WebChromeClient() { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onProgressChanged(WebView view, <font color="#0000ff">int</font> progress) <br> { <br> activity.setTitle( <font color="#A31515">" "</font> +LASTURL); <br> activity.setProgress(progress * 100); <br> <br> <font color="#0000ff">if</font> (progress == 100) <br> activity.setTitle( <font color="#A31515">" "</font> +LASTURL); <br> } <br> }); <br> wv.setWebViewClient( <font color="#0000ff">new</font> WebViewClient() { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onReceivedError(WebView view, <font color="#0000ff">int</font> errorCode, String description, String failingUrl) { <br> Toast.makeText(getApplicationContext(), <font color="#A31515">"Error: "</font> + description+ <font color="#A31515">" "</font> + failingUrl, Toast.LENGTH_LONG).show(); <br> } <br> <br> <font color="#0000ff">@Override</font> <br> <font color="#0000ff">public</font> boolean shouldOverrideUrlLoading(WebView view, String url) <br> { <br> <font color="#0000ff">if</font> (url.indexOf( <font color="#A31515">"habrahabr"</font> )&lt;=0) { <br> <font color="#008000">// the link is not for a page on my site, so launch another Activity that handles URLs</font> <br> Intent intent = <font color="#0000ff">new</font> Intent(Intent.ACTION_VIEW, Uri.parse(url)); <br> startActivity(intent); <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onPageStarted (WebView view, String url, Bitmap favicon) { <br> LASTURL = url; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onPageFinished (WebView view, String url) { <br> <br> } <br> }); <br> <br> wv.loadUrl( <font color="#A31515">"http://habrahabr.ru"</font> ); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  So, we need a loading thermometer. <br>  1. We request the feature: this.getWindow (). RequestFeature (Window.FEATURE_PROGRESS); <br>  2. On progresschandzh - fill the window of the thermometer <br>  activity.setTitle ("" + LASTURL); <br>  activity.setProgress (progress * 100); <br>  if (progress == 100) activity.setTitle ("" + LASTURL); <br>  3. At the beginning of the download, we store the url in the variable LASTURL = url; <br><br>  We process the fallen off wifi on onresrated error: <br>  Toast.makeText (getApplicationContext (), "Error:" + description + "" + failingUrl, Toast.LENGTH_LONG) .show (); <br>  (a message pops up for absolutely morons, although so everything will be written on the page) <br><br>  14:05 Fix the layout. <br>  A bit of theory.  On the downloaded page, you can run javascript.  If you type something like a javascript in the address bar of the browser: alert (document.body.innerHTML) - then we will see the page body (for the copy-pasters - in the example above - the letter ‚Äúc‚Äù is Russian, so that the parser will skip). <br>  Well, then - the tree house, etc., create what you want, even though completely rework the page.  However, we will not go so far (I hope) and just hide the sidebar to improve readability.  And the browser itself will stretch the useful content on the page.  So, try to add a handler at the end of the page loading: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">void</font> onPageFinished (WebView view, String url) { <br> view.loadUrl( <font color="#A31515">"javascript:(function() { "</font> + <br> <font color="#A31515">"hide('sidebar');"</font> + <br> <font color="#A31515">"function hide(id){if (document.getElementById(id)){document.getElementById(id).style['display'] = 'none';}}"</font> + <br> <font color="#A31515">"})()"</font> ); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  / * Distracted by work * / <br>  Tax, sidebar is hidden, but with some leap.  Fix image loading: <br><br>  14:34 Accelerate the download <br>  To do this, turn off the pictures at the start of the page: <br>  view.getSettings (). setLoadsImagesAutomatically (false); <br>  and turn on at the finish, after hacking with javascript: <br>  view.getSettings (). setLoadsImagesAutomatically (true); <br><br>  Tax, loading content has become significantly faster (on my half-dead Yota, in the emulator, at least) <br><br>  14:37 Lunch <br><br>  15:23 We continue the conversation <br>  While I was going to lunch, I looked into the free wifi zone, and I also tested it.  With regret I saw the search bar, ridiculously hanging in the empty right corner.  Let's try to do something with it. <br>  For starters, we stupidly hide. <br><br>  * music: submatakana - the krypt (this is something with something) <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#A31515">"hideByClass('panel-tools');"</font> + <br> <font color="#A31515">"function hideByClass(c){var e=document.getElementsByClassName(c);for(var i=0;i&lt;e.length;i++){e[i].style['display'] = 'none';}}"</font> +</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Hmm, breaking does not build.  Tax, let's try to attach it to the list of blogs. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#A31515">"var parent = document.getElementsByClassName('page-navigation')[0];"</font> + <br> <font color="#A31515">"var panel = document.getElementsByClassName('panel-tools')[0];"</font> + <br> <font color="#A31515">"var div = document.createElement('div');"</font> + <br> <font color="#A31515">"div.innerHTML = panel.innerHTML;"</font> + <br> <font color="#A31515">"parent.appendChild(div);"</font> +</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Ops, now we have two panels) <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#A31515">"panel.innerHTML = '';"</font> + <br> <font color="#A31515">"div.style['margin-left'] = '30px;'"</font> +</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  15:57 Ops, one quote is not there and the whole script collapses like a house of cards. <br>  It should be like this: div.style ['margin-left'] = '30px'; <br>  So I will try to cut down the ad units in the menu, but not so much, that I have been busy with a sinful layout for a long time (I hate). <br><br>  16:04 Since these elements are not named, I tried this: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#A31515">"var urls=document.getElementsByTagName('a');for(var i=0;i&lt;urls.length;i++){if (urls[i].target='_top'){urls[i].appendChild(document.createTextNode(''));}}"</font> +</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Did not grow together <br><br>  16:16 Let's try to hit the squares: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#A31515">"var imgs=document.getElementsByTagName('IMG');for(var i=0;i&lt;imgs.length;i++){if (imgs[i].height=60) {imgs[i].src='';imgs[i].width=0;} }"</font> +</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The pictures disappeared, but the empty space still sticks out (Okay, let it remain for those who wish to do their homework. Let them live for the joy of the advertisers. <br>  Smoke break <br><br>  16:45 Search, perhaps we will return back, having a little pressed down on width: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#A31515">"var panel = document.getElementById('search');"</font> + <br> <font color="#A31515">"panel.style['width'] = '55px';"</font> +</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Well, let's finally do android. <br>  16:47 Override the hardware button back. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> boolean onKeyDown ( <font color="#0000ff">int</font> keyCode, KeyEvent <font color="#0000ff">event</font> ) { </li><li>  <font color="#0000ff">if</font> ((keyCode == KeyEvent.KEYCODE_BACK) &amp;&amp; wv.canGoBack ()) { </li><li>  wv.goBack (); </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; </li><li>  } </li><li>  <font color="#0000ff">return</font> super.onKeyDown (keyCode, <font color="#0000ff">event</font> ); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  16:57 Create a menu <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> boolean onCreateOptionsMenu (Menu menu) </li><li>  { </li><li>  super.onCreateOptionsMenu (menu); </li><li></li><li>  <font color="#0000ff">this</font> .myMenu = menu; </li><li>  MenuItem item = menu.add (0, 1, 0, <font color="#A31515">"MAIN PAGE"</font> ); </li><li>  item.setIcon (R.drawable.home); </li><li>  MenuItem item2 = menu.add (0, 2, 0, <font color="#A31515">"BACK"</font> ); </li><li>  item2.setIcon (R.drawable.arrowleft); </li><li>  MenuItem item3 = menu.add (0, 3, 0, <font color="#A31515">"F5"</font> ); </li><li>  item3.setIcon (R.drawable.s); </li><li>  MenuItem item4 = menu.add (0, 4, 0, <font color="#A31515">"CLEAR CACHE"</font> ); </li><li>  item4.setIcon (R.drawable.trash); </li><li>  MenuItem item5 = menu.add (0, 5, 0, <font color="#A31515">"VOID"</font> ); </li><li>  item5.setIcon (R.drawable.vote); </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> boolean onOptionsItemSelected (MenuItem item) { </li><li>  <font color="#0000ff">switch</font> (item.getItemId ()) </li><li>  { </li><li>  <font color="#0000ff">case</font> 1: </li><li>  wv.loadUrl ( <font color="#A31515">"http://habrahabr.ru"</font> ); </li><li>  <font color="#0000ff">break</font> ; </li><li>  <font color="#0000ff">case</font> 2: </li><li>  <font color="#0000ff">if</font> (wv.canGoBack ()) { </li><li>  wv.goBack (); </li><li>  } </li><li>  <font color="#0000ff">break</font> ; </li><li>  <font color="#0000ff">case</font> 3: </li><li>  wv.loadUrl (LASTURL); </li><li>  <font color="#0000ff">break</font> ; </li><li>  <font color="#0000ff">case</font> 4: </li><li>  wv.clearCache ( <font color="#0000ff">true</font> ); </li><li>  <font color="#0000ff">break</font> ; </li><li>  <font color="#0000ff">case</font> 5: </li><li>  Intent marketIntent2 = <font color="#0000ff">new</font> Intent (Intent.ACTION_VIEW, Uri.parse ( </li><li>  <font color="#A31515">"http://market.android.com/details?id="</font> + getPackageName ())); </li><li>  startActivity (marketIntent2); </li><li>  <font color="#0000ff">break</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  Here to explain especially even nothing like ... <br>  The web store stores data in a local isolated cache and the clearCache function removes cached maps and the like. <br><br>  We send to the user‚Äôs market using intent + start activation, this is the standard mechanism for interacting with external applications. <br><br>  17:01 Taks, perhaps, it is worth making a mode with / without pictures <br>  Fix the menu: <br>  menu.add (0, 6, 0, ‚ÄûIMG ON‚Äú); <br>  menu.add (0, 7, 0, ‚ÄûIMG OFF‚Äú); <br><br>  17:05 Mutima save settings <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">private</font> <font color="#0000ff">void</font> saveSettings (Boolean val) </li><li>  { </li><li>  SharedPreferences settings = getSharedPreferences (PREFS_NAME, 0); </li><li>  SharedPreferences.Editor editor = settings.edit (); </li><li>  editor.putBoolean ( <font color="#A31515">"IMGMODE"</font> , val); </li><li>  editor.commit (); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  In it, we will pass the settings (load or not pictures), and let them push the transferred value into the variable. <br>  (the above declared constant PREFS_NAME is like the name of the config) <br><br>  Now just call it in the menu handler: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">case</font> 6: </li><li>  saveSettings ( <font color="#0000ff">true</font> ); </li><li>  <font color="#0000ff">break</font> ; </li><li>  <font color="#0000ff">case</font> 7: </li><li>  saveSettings ( <font color="#0000ff">false</font> ); </li><li>  <font color="#0000ff">break</font> ; </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  17:18 And we read the constant when creating an application from our config <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  SharedPreferences settings = getSharedPreferences (PREFS_NAME, 0); </li><li>  imgOn = settings.getBoolean ( <font color="#A31515">"IMGMODE"</font> , <font color="#0000ff">false</font> ); </li><li>  webSettings.setLoadsImagesAutomatically (imgOn); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  17:19 Testing again <br><br>  17:25 It seems there are no jambs.  We export the project. <br>  In eclipse, this is the right button on the export project and a wizard is launched that allows you to create / select a certificate and a packaging project.  Next, we stamp into the <a href="https://market.android.com/publish/Home">market</a> <br><br>  17:38 We publish. <br>  In fact, not the easiest task.  Somewhere you need to get a bunch of promotions of a certain size, so it's not hard for designers here. <br><br>  According to the parameters. <br>  - To install Russian as the main language of the application, you must first add Russian, and only after that it will be possible to remove English. <br>  - In the descriptive and promotional text fields, it is advisable to mention the keywords by which the application can be searched. <br>  - If you set the price free - then make it paid - it is impossible <br>  - Do not put a copy protection checkbox, the application will not be placed on the part of the device <br>  - It is better to specify all countries, even if the application is only for Russian speakers, for example. <br><br>  17:50 Published. <br><br>  <a href="https://market.android.com/details%3Fid%3Dru.habrahabr.android">Download from the market</a> <br>  <a href="http://narod.ru/disk/10774830001/habrahabr.zip.html">Download source code</a> <br><br>  Hmm, with the icon it didn't turn out very nicely (For some reason this thought gnaws me. So if anyone can portray something 48 * 48 - I will be very grateful. <br><br>  Fully, the final source: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  package ru.habrahabr.android; </li><li></li><li>  import android.app.Activity; </li><li>  import android.content.Intent; </li><li>  import android.content.SharedPreferences; </li><li>  import android.graphics.Bitmap; </li><li>  import android.net.Uri; </li><li>  import android.os.Bundle; </li><li>  import android.view.KeyEvent; </li><li>  import android.view.Menu; </li><li>  import android.view.MenuItem; </li><li>  import android.view.Window; </li><li>  import android.webkit.WebChromeClient; </li><li>  import android.webkit.WebSettings; </li><li>  import android.webkit.WebView; </li><li>  import android.webkit.WebViewClient; </li><li>  import android.widget.Toast; </li><li></li><li>  <font color="#0000ff">public</font> <font color="#0000ff">class</font> habr extends Activity { </li><li></li><li>  <font color="#0000ff">private</font> WebView wv; </li><li>  <font color="#0000ff">private</font> String LASTURL = <font color="#A31515">""</font> ; </li><li>  Menu myMenu = <font color="#0000ff">null</font> ; </li><li>  <font color="#0000ff">private</font> <font color="#0000ff">static</font> final String PREFS_NAME = <font color="#A31515">"MyPrefs"</font> ; </li><li>  <font color="#0000ff">private</font> Boolean imgOn; </li><li></li><li>  <font color="#008000">/ ** Called when the activity is first created.</font>  <font color="#008000">* /</font> </li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> onCreate (Bundle savedInstanceState) { </li><li>  super.onCreate (savedInstanceState); </li><li>  <font color="#0000ff">this</font> .getWindow (). requestFeature (Window.FEATURE_PROGRESS); </li><li>  setContentView (R.layout.main); </li><li></li><li>  wv = (WebView) findViewById (R.id.wv); </li><li></li><li>  WebSettings webSettings = wv.getSettings (); </li><li>  webSettings.setSavePassword ( <font color="#0000ff">true</font> ); </li><li>  webSettings.setSaveFormData ( <font color="#0000ff">true</font> ); </li><li>  webSettings.setJavaScriptEnabled ( <font color="#0000ff">true</font> ); </li><li></li><li>  SharedPreferences settings = getSharedPreferences (PREFS_NAME, 0); </li><li>  imgOn = settings.getBoolean ( <font color="#A31515">"IMGMODE"</font> , <font color="#0000ff">false</font> ); </li><li>  webSettings.setLoadsImagesAutomatically (imgOn); </li><li></li><li>  final Activity activity = <font color="#0000ff">this</font> ; </li><li></li><li>  wv.setWebChromeClient ( <font color="#0000ff">new</font> WebChromeClient () { </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> onProgressChanged (WebView view, <font color="#0000ff">int</font> progress) </li><li>  { </li><li>  activity.setTitle ( <font color="#A31515">""</font> + LASTURL); </li><li>  activity.setProgress (progress * 100); </li><li>  <font color="#0000ff">if</font> (progress == 100) </li><li>  activity.setTitle ( <font color="#A31515">""</font> + LASTURL); </li><li>  } </li><li>  }); </li><li>  wv.setWebViewClient ( <font color="#0000ff">new</font> WebViewClient () { </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> onReceivedError (WebView view, <font color="#0000ff">int</font> errorCode, String description, String failingUrl) { </li><li>  Toast.makeText (getApplicationContext (), <font color="#A31515">"Error:"</font> + description + <font color="#A31515">""</font> + failingUrl, Toast.LENGTH_LONG) .show (); </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> boolean shouldOverrideUrlLoading (WebView view, String url) </li><li>  { </li><li>  <font color="#0000ff">if</font> (url.indexOf ( <font color="#A31515">"habrahabr"</font> ) &lt;= 0) { </li><li>  <font color="#008000">// so link</font> </li><li>  Intent intent = <font color="#0000ff">new</font> Intent (Intent.ACTION_VIEW, Uri.parse (url)); </li><li>  startActivity (intent); </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; </li><li>  } </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> onPageStarted (WebView view, String url, Bitmap favicon) { </li><li>  LASTURL = url; </li><li>  view.getSettings (). setLoadsImagesAutomatically ( <font color="#0000ff">false</font> ); </li><li>  } </li><li></li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> onPageFinished (WebView view, String url) { </li><li>  view.loadUrl ( <font color="#A31515">"javascript: (function () {"</font> + </li><li>  <font color="#A31515">"hide ('sidebar');"</font>  + </li><li>  <font color="#008000">// "var parent = document.getElementsByClassName ('page-navigation') [0];" +</font> </li><li>  <font color="#008000">// "var panel = document.getElementsByClassName ('panel-tools') [0];" +</font> </li><li>  <font color="#008000">// "var div = document.createElement ('div');" +</font> </li><li>  <font color="#008000">//"div.innerHTML = panel.innerHTML; "+</font> </li><li>  <font color="#008000">//"parent.appendChild(div);"+</font> </li><li>  <font color="#008000">//"panel.innerHTML = ''; "+</font> </li><li>  <font color="#008000">//"div.style['margin-left '] =' 31px '; "+</font> </li><li>  <font color="#A31515">"var panel = document.getElementById ('search');"</font>  + </li><li>  <font color="#A31515">"panel.style ['width'] = '55px';"</font>  + </li><li></li><li>  <font color="#008000">// "var imgs = document.getElementsByTagName ('IMG'); for (var i = 0; i &lt;imgs.length; i ++) {if (imgs [i] .height = 60) {imgs [i] .src = ''; imgs [i] .width = 0;}} "+</font> </li><li>  <font color="#008000">// "var urls = document.getElementsByTagName ('li'); for (var i = 0; i &lt;urls.length; i ++) {if (urls [i] .style = 'margin: -14px 0pt 0pt;') {urls [i] .style ['display'] = 'none';}} "+</font> </li><li>  <font color="#008000">// "hideByClass ('panel-tools');" +</font> </li><li>  <font color="#A31515">"function hide (id) {if (document.getElementById (id)) {document.getElementById (id) .style ['display'] = 'none';}}"</font> + </li><li>  <font color="#008000">// "function hideByClass (c) {var e = document.getElementsByClassName (c); for (var i = 0; i &lt;e.length; i ++) {e [i] .style ['display'] = 'none' ;}} "+</font> </li><li>  <font color="#A31515">"}) ()"</font> ); </li><li>  <font color="#0000ff">if</font> (imgOn) view.getSettings (). setLoadsImagesAutomatically ( <font color="#0000ff">true</font> ); </li><li>  } </li><li>  }); </li><li></li><li>  wv.loadUrl ( <font color="#A31515">"http://habrahabr.ru"</font> ); </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> boolean onKeyDown ( <font color="#0000ff">int</font> keyCode, KeyEvent <font color="#0000ff">event</font> ) { </li><li>  <font color="#0000ff">if</font> ((keyCode == KeyEvent.KEYCODE_BACK) &amp;&amp; wv.canGoBack ()) { </li><li>  wv.goBack (); </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; </li><li>  } </li><li>  <font color="#0000ff">return</font> super.onKeyDown (keyCode, <font color="#0000ff">event</font> ); </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> boolean onCreateOptionsMenu (Menu menu) </li><li>  { </li><li>  super.onCreateOptionsMenu (menu); </li><li></li><li>  <font color="#0000ff">this</font> .myMenu = menu; </li><li>  MenuItem item = menu.add (0, 1, 0, <font color="#A31515">"MAIN PAGE"</font> ); </li><li>  item.setIcon (R.drawable.home); </li><li>  MenuItem item2 = menu.add (0, 2, 0, <font color="#A31515">"BACK"</font> ); </li><li>  item2.setIcon (R.drawable.arrowleft); </li><li>  MenuItem item3 = menu.add (0, 3, 0, <font color="#A31515">"F5"</font> ); </li><li>  item3.setIcon (R.drawable.s); </li><li>  MenuItem item4 = menu.add (0, 4, 0, <font color="#A31515">"CLEAR CACHE"</font> ); </li><li>  item4.setIcon (R.drawable.trash); </li><li>  MenuItem item5 = menu.add (0, 5, 0, <font color="#A31515">"VOID"</font> ); </li><li>  item5.setIcon (R.drawable.vote); </li><li>  menu.add (0, 6, 0, <font color="#A31515">"IMG ON"</font> ); </li><li>  menu.add (0, 7, 0, <font color="#A31515">"IMG OFF"</font> ); </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> boolean onOptionsItemSelected (MenuItem item) { </li><li>  <font color="#0000ff">switch</font> (item.getItemId ()) </li><li>  { </li><li>  <font color="#0000ff">case</font> 1: </li><li>  wv.loadUrl ( <font color="#A31515">"http://habrahabr.ru"</font> ); </li><li>  <font color="#0000ff">break</font> ; </li><li>  <font color="#0000ff">case</font> 2: </li><li>  <font color="#0000ff">if</font> (wv.canGoBack ()) { </li><li>  wv.goBack (); </li><li>  } </li><li>  <font color="#0000ff">break</font> ; </li><li>  <font color="#0000ff">case</font> 3: </li><li>  wv.loadUrl (LASTURL); </li><li>  <font color="#0000ff">break</font> ; </li><li>  <font color="#0000ff">case</font> 4: </li><li>  wv.clearCache ( <font color="#0000ff">true</font> ); </li><li>  <font color="#0000ff">break</font> ; </li><li>  <font color="#0000ff">case</font> 5: </li><li>  Intent marketIntent2 = <font color="#0000ff">new</font> Intent (Intent.ACTION_VIEW, Uri.parse ( </li><li>  <font color="#A31515">"http://market.android.com/details?id="</font> + getPackageName ())); </li><li>  startActivity (marketIntent2); </li><li>  <font color="#0000ff">break</font> ; </li><li>  <font color="#0000ff">case</font> 6: </li><li>  saveSettings ( <font color="#0000ff">true</font> ); </li><li>  <font color="#0000ff">break</font> ; </li><li>  <font color="#0000ff">case</font> 7: </li><li>  saveSettings ( <font color="#0000ff">false</font> ); </li><li>  <font color="#0000ff">break</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">private</font> <font color="#0000ff">void</font> saveSettings (Boolean val) </li><li>  { </li><li>  SharedPreferences settings = getSharedPreferences (PREFS_NAME, 0); </li><li>  SharedPreferences.Editor editor = settings.edit (); </li><li>  editor.putBoolean ( <font color="#A31515">"IMGMODE"</font> , val); </li><li>  editor.commit (); </li><li>  } </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  <b>UPD</b> : Very much redid the layout. <br>  He took the style developed by <a href="http://almalexa.habrahabr.ru/">almalexa.habrahabr.ru as a basis</a> and significantly refined it with a file for a small resolution. <br>  The resulting style: <a href="http://userstyles.org/styles/46932/habr">userstyles.org/styles/46932/habr</a> <br>  On this I think the development is complete.  Client in the market - updated. <br>  Total: all about everything went day. <br><img src="https://habrastorage.org/getpro/habr/post_images/015/965/051/015965051c9bca01b9056052ed369fbe.png" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/117885/">https://habr.com/ru/post/117885/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117875/index.html">Easy way to share localhost</a></li>
<li><a href="../117876/index.html">Django - error handling in ajax forms</a></li>
<li><a href="../117878/index.html">GoPro Motorsports: camcorder onboard review</a></li>
<li><a href="../117879/index.html">WebMatrix: working with mobile clients definition package from 51Degrees.mobi</a></li>
<li><a href="../117881/index.html">Webpage = URL</a></li>
<li><a href="../117887/index.html">Node.js and the javascript era</a></li>
<li><a href="../117888/index.html">Webvisor in Yandex. Metric. Look at the site through the eyes of visitors</a></li>
<li><a href="../117889/index.html">Electronic money will be a full-fledged alternative to paper</a></li>
<li><a href="../117891/index.html">Hackers hacked one of the servers Ashampoo</a></li>
<li><a href="../117892/index.html">Iran plans to launch "Internet for the faithful"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>