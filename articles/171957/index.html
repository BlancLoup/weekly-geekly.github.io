<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Free, without registration, but with SMS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In Yandex. Mail, a new opportunity has just recently appeared - letters in SMS. We made it not only for those who like to send free text messages, but...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Free, without registration, but with SMS</h1><div class="post__text post__text-html js-mediator-article">  In Yandex. Mail, a new opportunity has just recently appeared - letters in SMS.  We made it not only for those who like to send free text messages, but also for those who need a quick response from the recipient.  Now from the web interface of the mail, along with the letter, you can send an SMS message with a link to a copy of the letter itself. <br><br>  The link will open in a special mobile interface that does not require authorization.  There you can read the letter and reply to it.  At the same time, it does not matter at all what service the recipient's email is on.  Today we will reveal some secrets about the technical details of the implementation. <br><br>  It was possible to notify the recipient about the sent letter earlier, but with minor restrictions.  For example, if the letter was sent not to Yandex. Mail, the SMS looked like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/7d9/992/10a/7d999210a50ab7e0b517d5e53701a513.png"><br><br><a name="habracut"></a><br>  This was the usual notification without the ability to read the letter and respond to it.  In addition, the notification was sent only after the letter was delivered to the addressee.  We did this specifically in order to exclude the possibility of sms delivery before the third-party server accepts the letter.  Implemented by adding encrypted service headers to the letter and checking these headers in <a href="http://en.wikipedia.org/wiki/Non_delivery_report">DSN-</a> bounce received from the receiving party.  In the new version, we have redrew everything. <br><br>  First, they gave access to the sent letter.  The new version implies more than just a delivery receipt.  Now you can tell the user that he was sent a letter, regardless of whether it is delivered to his mailbox. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d4/ac8/112/6d4ac8112dd438f11e6f552fca889c04.png" width="504" height="215"><br><br>  This allows you to give access to the letter, even if another mail service for some reason loses the letter, or if the recipient was entered incorrectly.  The letter itself, opened from SMS, looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a1/fbb/55a/7a1fbb55a15cf5057f2c472cbf230e03.png"><br><br>  And secondly, due to the fact that in the new version of the sender-receiver chain, the need to receive a letter by another server disappeared, we allowed ourselves to send SMS immediately after sending the letter. <br><br><h4>  Security </h4><br>  We devoted a lot of time and attention to the issue of security, because it can be called the most difficult in this task.  Many aspects of the architecture were initially worked out, based precisely on considerations of the security of user data from any encroachment and fraud: <br><br><ol><li>  When a user sends an email with an SMS notification, it is saved as sent.  Based on unique data, a key is generated, encrypted using <a href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a> and wrapped for convenience in <a href="http://en.wikipedia.org/wiki/Base64">Base64</a> .  All operations with the letter occur on this key. </li><li>  When you try to open a letter by reference from an SMS message, the time of its creation is checked.  The letter is available only within two hours after sending.  It seems to us that two hours is enough to read the SMS and answer it.  And since the possibility of replying to a letter from a page without viewing authentication is potentially unsafe, we have limited the number of replies from it. </li><li>  In order to prevent spam from being sent, we decided not to send various meta-information (addresses, phone numbers, etc.) from the client by http-arguments.  Thus, they can not be changed and send a letter to an arbitrary address. </li></ol><br>  For these purposes, a separate database is deployed - <a href="http://en.wikipedia.org/wiki/MongoDB">MongoDB</a> .  It is simple, lightweight, scales well and will be useful to us in the future for various tasks.  The experience of learning MongoDB turned out to be interesting and useful - the freedom to manage collections and the structure of records allows programmers to be less dependent on database administrators.  It speeds up the design, prototyping, development and provides an opportunity to experiment with formats and operations. <br><br>  The performance of this base also makes it easy to use it for more "difficult" tasks.  Load testing showed that with mixed queries and small amounts of data (100b, 3kb), the ‚Äúweb server -&gt; backend -&gt; mongoS -&gt; DB‚Äù bundle withstands at least 6000 requests per second, and the response time is within 40 milliseconds.  A multi-threaded backend implementing business logic and a pool of connections to the database are used.  During testing, the base consisted of a single machine with SATA disks.  Now its configuration consists of three shards, in each - a replica of three machines on SSD-drives.  To use a pool of connections, a tcp balancer is raised above all MongoS, because the C ++ driver cannot connect to several machines with failover. <br><br>  In addition, we have taken many other measures to protect the user's letters from unauthorized viewing and use.  In various parts of the system, various hashes, digests are generated and verified, hosts and timestamps are checked.  The reference shortener has been specifically re-configured so that the identification hash is longer and has a uniform distribution, which makes it unnecessary to search for links. <br><br><h4>  About future </h4><br>  Like any new feature, we launch letters in SMS quite carefully: you need to be sure that the service will not only work correctly, but also withstand the load.  That is why, at first, we do not place the setting for sending SMS to a prominent place, leaving it behind the tick ‚ÄúSend SMS to the addressee after sending a letter‚Äù at the very bottom of the page writing the letter. <br><br>  It seems to us that the flight is now normal, so in the near future a new opportunity will be advanced in the mail interface.  And although we usually do not disclose our plans, today we will make an exception and show the screenshot of the SMS sending interface in the form in which millions of Yandex.Mail users will see it after it passes all the tests: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/067/4ab/525/0674ab52515a62a9c0923a7e58a27889.png"><br><habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/171957/">https://habr.com/ru/post/171957/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../171941/index.html">10 devices that you can upgrade, a little digging with electronics</a></li>
<li><a href="../171945/index.html">Began beta testing of Unity 4 Game Engine with Windows 8 support</a></li>
<li><a href="../171947/index.html">Few woman-related English idioms</a></li>
<li><a href="../171949/index.html">Harlem Shake: USA vs. Russia</a></li>
<li><a href="../171953/index.html">Why should I redo it? After all, it's not difficult for me!</a></li>
<li><a href="../171959/index.html">Google Chrome extensions: cookies and HTTP requests</a></li>
<li><a href="../171963/index.html">Firefox for Windows 8 Tiled Interface</a></li>
<li><a href="../171965/index.html">CeBIT 2013. Day three. Zotac, Cooler Master and Sapphire</a></li>
<li><a href="../171967/index.html">Tern - clever javascript editing with type inference</a></li>
<li><a href="../171969/index.html">Platform-as-a-Service: 2012 Results</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>