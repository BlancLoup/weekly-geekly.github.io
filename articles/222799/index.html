<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Secure encrypted data storage and features of working with it</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At some point we were faced with the need to organize encrypted storage for remote file allocation. After a brief search, I found an easy, cloudy solu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Secure encrypted data storage and features of working with it</h1><div class="post__text post__text-html js-mediator-article">  At some point we were faced with the need to organize encrypted storage for remote file allocation.  After a brief search, I found an easy, cloudy solution, which in the end was completely satisfactory.  Next, I will briefly describe this solution and some features of working with him, perhaps someone will come in handy.  In my opinion, the option is reliable and at the same time quite comfortable. <br><a name="habracut"></a><br><h5>  Architecture </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/b4a/642/dcb/b4a642dcbf9a4ca955570e0f22b2f385.png" alt="owncloud" align="left">  I decided to use the <a href="http://owncloud.org/">ownCloud</a> cloud storage system as a basis.  Which was installed in OS Debian Linux v7.1 and deployed as a virtual machine under the Proxmox Virtual Environment v3.1 hypervisor. <br><br>  I installed the cloud storage system on the Linux encrypted disk, access to the data is possible only via the HTTPS protocol, in addition to the standard password, you must also enter a one-time password (OTP).  Regularly backed up.  The possibility of emergency shutdown and delete all data ownCloud. <br><br><h5>  Proxmox Virtual Environment Hypervisor </h5><br>  The Proxmox Virtual Environment hypervisor is a specialized OS distribution of Debian Linux v7.1, remote access to the system is possible via the SSH protocol on the standard TCP port 22. However, the main working tool for managing virtual machines is a Web interface. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Once a day, a hot copy (snapshot) of the ownCloud virtual machine is generated and exported to NFS servers using the standard features of Proxmox VE. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cae/c79/071/caec79071f0e071bd8770f298196cd87.png" alt="vm" width="289" height="326"><br><br>  In the screenshot, the virtual machine in the web interface has the identifier 100 (ownCloud).  Access to its console is possible through the context menu item ‚ÄúConsole‚Äù. <br><br>  For example, this is how a password is entered for an encrypted disk at boot time: <br><img src="https://habrastorage.org/getpro/habr/post_images/ed0/f80/a20/ed0f80a20533a9a5bdd33337ace6ab1d.png"><br><br><h5>  OwnCloud cloud storage </h5><br>  <i>About installing ownCloud on Habr√©, there is a fairly good article from the <a href="https://habrahabr.ru/users/blackice13/" class="user_link">BlackIce13</a> user <a href="http://habrahabr.ru/post/208566/">http://habrahabr.ru/post/208566/</a> there are already listed the main features and some advantages of this platform.</i> <i><br><br></i>  <i>From myself I can only add that, in my opinion, there is a somewhat simpler way to install ownCloud for the Linux Debian distribution and many others than the one suggested by the author.</i>  <i>Available repositories are available: <a href="http://software.opensuse.org/download/package%3Fproject%3Disv:ownCloud:community%26package%3Downcloud">http://software.opensuse.org/download/package?project=isv:ownCloud:community&amp;package=owncloud</a></i> <i><br></i>  <i>In this case, all the necessary dependencies are set automatically, and you will only be required to adjust the settings to fit your specifics.</i> <br><br>  ownCloud deployed on the basis of the OS Debian Linux v7.1 inside a virtual container.  Remote access to the storage is possible via SSH protocol on the standard TCP port 22. <br>  The main work with ownCloud is carried out through a Web-interface, it is also possible to connect via WebDAV protocol and use synchronization clients (Sync). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f0/8c1/bd6/4f08c1bd6c17e43f101cdd641e32184c.jpg"><br><br>  By the way, since access to ownCloud is done via HTTPS, access and error logs are kept by the Apache server in the files "/var/log/apache2/access.log" and "/var/log/apache2/error.log", respectively.  OwnCloud also has its own log "/var/www/owncloud/data/owncloud.log". <br><br><h5>  One Time OTP Passwords </h5><br>  To enhance security, access to ownCloud via a Web interface is possible using two-factor authentication: a traditional password and a one-time OTP password.  The OTP functionality is implemented using the external <a href="http://apps.owncloud.com/content/show.php/One%2BTime%2BPassword%2BBackend%3Fcontent%3D159196">One Time Password Backend</a> add-on.  There is no native OTP support for ownCloud. <br><br>  The configuration of the main OTP parameters is carried out in the ‚ÄúAdmin‚Äù section under the administrative account. <br><img src="https://habrastorage.org/getpro/habr/post_images/89e/262/3b9/89e2623b9d5affecd89d535263f022c2.png"><br><br>  In the screenshots, the two-factor authentication and one-time password settings are selected to ensure compatibility with the FEITIAN OTP c200 hardware generators. <br>  Algorithm: Time-based One Time Password (TOTP) <br>  Number of digits in the password: 6 <br>  Password lifetime: 60 seconds <br><img src="https://habrastorage.org/getpro/habr/post_images/028/f71/2f8/028f712f844e251b924ef5dc698b8fa3.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae9/484/68d/ae948468d50be245bd88f7719d88d802.png"><br><br>  In order for two-factor authentication to take effect, you must assign it to a Token Seed user.  Up to this point, he can enter his ownCloud using only a regular password.  What you actually need to do immediately after creating the user, go to the "Personal" section and enter Token Seed in the field of the same name. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ad/ed6/b48/0aded6b48e1833c8c2567e538a4e493f.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f96/d1a/f77/f96d1af7784de4cb48b6031f974beb7f.png"><br><br>  It is not recommended to generate Token Seed using the built-in capabilities of the ownCloud OTP module, since its operation has problems.  Input format: Base32 (% 32) UPPERCASE.  You can convert Token Seed into different formats using the utility <a href="http://www.darkfader.net/toolbox/convert/">www.darkfader.net/toolbox/convert</a> <br><br>  <i>Specifically for this project was used Token Seed embedded in hardware Token FEITIAN OTP c200.</i>  <i>In general, you can use any password generator, and then bring it to the desired format using the converter provided in the text.</i> <i><br><br></i>  <i>An example of such an Android application is Android Token: <a href="https://play.google.com/store/apps/details%3Fid%3Duk.co.bitethebullet.android.token%26hl%3Dru">https://play.google.com/store/apps/details?id=uk.co.bitethebullet.android.token&amp;hl=en</a></i> <br><br>  Initialized Token Seed looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/81d/01e/82d/81d01e82d5b2d60087c98f403c3404c4.png"><br><br>  <b>To disable OTP, just remove Token Seed from the settings.</b>  If this is impossible, for example, due to the fact that the OTP generator is lost, so there is no access to the user's personal account, then the OTP can only be disabled by directly modifying the data in the MySQL DBMS.  To do this, you need to start the MySQL client from the command line: <br> <code># mysql -uowncloud ‚Äìp <br> Enter password:</code> <br> <br>  Then execute the query similar to the following, changing the value of the ‚Äúuser‚Äù field to the necessary one: <br> <code>mysql&gt; delete from owncloud.oc_user_otp where `user` = 'test';</code> <br> <br>  Due to architectural constraints, OTP only works when accessing ownCloud via a web interface, but not via WebDAV.  This disadvantage is compensated by the fact that the list of IP addresses that can use WebDAV is strictly limited.  The ‚ÄúAllow from‚Äù directives in the Apache server configuration file "/etc/apache2/conf.d/owncloud.conf" are responsible for this.  Please note that the directives are indicated there twice. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4dc/ad3/5e6/4dcad35e6b46cca9e2df62a94335d05b.png"><br><br>  IP addresses are listed separated by spaces.  You must make sure that the list always contains the IP loopback 127.0.0.1, as well as the public IP server itself ownCloud.  Otherwise, WebDAV may fail.  After changing the Apache settings, you must restart it: <br> <code>service apache2 restart</code> <br> <br><h5>  Brute force protection </h5><br>  In recent versions of ownCloud, a log of failed authorization attempts is maintained: "/var/log/owncloud/auth.log".  The content of "/var/log/owncloud/auth.log" is controlled by the Fail2ban service.  If they receive 5 or more unsuccessful authorization attempts from the same IP address for a short time, then they are blocked by the IPTables packet filter for 10 minutes.  If, after automatic unlocking, attempts continue, the IP is blocked again forever.  Follows the work Fail2ban possible in the log "/var/log/fail2ban.log". <br><br>  The list of IP addresses that should not be blocked under any circumstances is set by the ‚Äúignoreip‚Äù parameter in the configuration file "/etc/fail2ban/jail.conf".  IPs are separated by spaces. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d9c/78e/611/d9c78e611a9236d007c13dcc0cd29616.png"><br><br>  After changing the settings of Fail2ban, you must restart it: <br> <code>service fail2ban restart</code> <br> <br>  If you need to manually unblock any IP, you need to execute a command on the server from the CLI that is similar to the following, by correcting the address in it: <br> <code>iptables -D fail2ban-Owncloud -s 187.22.109.14/32 -j DROP</code> <br> <br>  PS <br>  Live version of ownCloud can be viewed on the official website <a href="http://demo.owncloud.org/">http://demo.owncloud.org</a> </div><p>Source: <a href="https://habr.com/ru/post/222799/">https://habr.com/ru/post/222799/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../222785/index.html">My story of the Imagine Cup, or how our ships sailed to the finals</a></li>
<li><a href="../222789/index.html">Dual numbers in business or how to evaluate the sensitivity of a solution to changes in initial conditions</a></li>
<li><a href="../222791/index.html">Evernote surpasses 100 million users</a></li>
<li><a href="../222793/index.html">Current statistics of casual game income</a></li>
<li><a href="../222797/index.html">Solar Roadways - solar panels throughout the roadbed</a></li>
<li><a href="../222801/index.html">COOLRF: Reboot</a></li>
<li><a href="../222803/index.html">Fast-static - Node.js module makes life much easier</a></li>
<li><a href="../222805/index.html">Store passwords with vim</a></li>
<li><a href="../222813/index.html">Harvard CS50x to EdX Course, Subtitle Translation (Weeks 0-3)</a></li>
<li><a href="../222815/index.html">Results and discussion of the May habrasue competition: we make our own GLONASS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>