<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hello, who is calling or determining the number in Asterisk</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Given the specifics of telephone networks in Russia, problems with determining the number when setting up analog GTS lines on Asterisk occur quite oft...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hello, who is calling or determining the number in Asterisk</h1><div class="post__text post__text-html js-mediator-article">  Given the specifics of telephone networks in Russia, problems with determining the number when setting up analog GTS lines on Asterisk occur quite often.  The diversity of GATS and the quality of telephone lines mounted during the USSR times always present problems for integrators of IP PBXs. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9dd/163/fb9/9dd163fb994fb0798248201047367699.jpg" alt="image"></div><br>  An IP PBX Asterisk was installed, and successfully used.  After some time, it became possible to connect the number identifier, since  city ‚Äã‚Äãlines were transferred to a digital GATS with CallerID support, before that the lines were connected to an analog GATS (yes, analog PBXs are still alive), but the identification did not work. <br><a name="habracut"></a><br>  To begin with, let's look at some theoretical information about what standards there are for determining a phone number. <br><br>  <b>Number Theory</b> <br><br>  AON (also called Russian AON) - the work of the Soviet analog GATS, was distributed in the early 90s, but still occurs.  Information about the caller's number is transmitted in the form of a code bearing the name "Without Interval Package."  It is not a service as such, since it was not intended for subscribers.  The phone number is transmitted in the form of 7 digits.  A telephone device that supports caller ID when an incoming call "picks up the phone" and reads the service signals of the telephone exchange, while the call signal is simulated for the caller.  At Asterisk, this type of number identifier cannot be made to earn. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      CallerID (also known as Euro AON) is a service provided on digital GATS.  Method for sending a request and receiving Caller ID information in the interval between calls.  That is, in contrast to the caller ID here is not "lifting the tube."  There are several standards in CallerID: <br><br>  Bellcore-standard is used in the USA, Canada, Australia, China, Hong Kong, Singapore, Italy and some telephone companies in the UK. <br><br>  DTMF-standard: the digits of the number are transmitted in the same way as the tone dialing - short dual-frequency parcels. <br><br>  FSK-standard: The data stream is transmitted by frequency modulation before the first or before the second call on the line.  Experience has shown that most digital GATS Rostelecom work on this standard. <br><br>  <b>Practice or why nothing works</b> <br><br>  To determine the number in DAHDI channels in most cases, adding the following lines in chan_dahdi.conf is enough: <br><br>  chan_dahdi.conf <br><pre><code class="hljs coffeescript">usecallerid=<span class="hljs-literal"><span class="hljs-literal">yes</span></span> ;  CallerID callerid=asreceived ;  callerid   </code> </pre> <br>  If the identification of the number did not work, I recommend to start by connecting a regular telephone with CallerID support and see if the definition works on it.  In our case, the number on the TA was determined without problems, but on Asterisk did not want to.  Moreover, when connecting the TA parallel to the asterisk, the definition ceased to work on the phone. <br><br>  We proceed to further analysis.  Let's write the audio channel of the line and analyze the recording in the audio editor.  In it we will try to find the CallerID data. <br><br>  The first dahdi channel is recorded by the following command: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dahdi_monitor</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> -v -r streamrx.wav</code> </pre> <br>  We start the recording team and call our line.  After this, we stop the execution of dahdi_monitor, as a result we will have the file streamrx.wav.  Copy it to yourself and open it in an audio editor (for example Audacity). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/59e/a75/2aa/59ea752aa8839618aa6c268a8ff3e864.png" alt="image"><br><br>  Apparently no data callerid does not come to us.  Since the usual phone number determines, it can be assumed that there are problems with the equipment (board or FXO module). <br><br>  We put the working FXO module into the board and check it again. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/44d/4da/355/44d4da355b93805892789806ffbaa9a7.png" alt="image"><br><br>  Now, the identification of the number works without problems, we see the CallerID data in the FSK standard on the record.  As you can see, in this case there was a problem with the module. <br><br>  <b>Repair FXO Module</b> <br><br>  FXO modules of different manufacturers for analog cards are built almost according to the same scheme based on two microcircuits: SI3019 and SI3050. <br><br>  An example of a circuit with a datasheet on the Si3050 Si3018 / 19: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e35/4b8/06a/e354b806a2a2225cc4e2b41abb5d6112.png" alt="image"></a> <br><br>  In this scheme, the line is connected to the contacts RING and TIP.  What elements should pay attention to when problems with the work of the module? <br><br>  - Diode bridge D1 (can also be made in the form of two assemblies with 2 diodes each).  Sometimes out of order on the lines of analog PBX and when exceeding the permissible voltage.  In this case, the module itself can remain operational, but some of the diodes do not work.  Checked after watering from the scheme. <br>  - Dinistor RV1 (275 V, 100 A).  In our case, it turned out to be workable. <br>  - Resistors R30, R32 (15 M ?, 1/8 W, 5%), R31, R33 (5.1 M?, 1/8 W, 5%), R8, R7 (20 M?, 1/8 W).  They also turned out to be all right. <br><br>  The problem was in the Si3019 chip.  The resistance at the connection point of the Ring1 pin was two times less than on the working module.  After replacing the Si3019 chip, everything worked without problems. <br><br>  Also in a thunderstorm period, in the absence of external protection, the Zener diode Z1 (43 V, 1/2 W) often fails.  The symptoms are the following: the module does not see the incoming call, when trying to call through this channel, there is no action except silence.  Solved by replacing the Zener diode. </div><p>Source: <a href="https://habr.com/ru/post/326600/">https://habr.com/ru/post/326600/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../326588/index.html">How to make your IDEA IDE level</a></li>
<li><a href="../326590/index.html">Mail.Ru Group Online Course News: Restarting Advanced C ++ Programming</a></li>
<li><a href="../326592/index.html">Fat programs - speed factors</a></li>
<li><a href="../326594/index.html">Bash scripts, part 4: input and output</a></li>
<li><a href="../326596/index.html">Exoskeleton do it yourself</a></li>
<li><a href="../326602/index.html">Terrible import kraken - how to use ES6-modules and not go crazy</a></li>
<li><a href="../326608/index.html">Personal vDisk in Citrix XenDesktop: what is the advantage and how it works</a></li>
<li><a href="../326610/index.html">Functional components</a></li>
<li><a href="../326612/index.html">The digest of interesting materials for the mobile developer # 199 (April 10-16)</a></li>
<li><a href="../326614/index.html">Simple JDBC Beginner Example</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>