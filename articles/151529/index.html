<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Under the hood of the quest for programmers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the moment we are working on a new project - the development of an online quest , the essence of which is that programmers, divided into two camps ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Under the hood of the quest for programmers</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://www.luxquest.org/"><img src="https://habrastorage.org/storage2/2ba/8a1/3e9/2ba8a13e990d3b48cafe2569fd98d0e5.png"></a> <br>  At the moment we are working on a new project - the development of an <a href="http://www.luxquest.org/">online quest</a> , the essence of which is that programmers, divided into two camps (ITshniki and FSB), would solve a variety of tasks in the field of programming in their favorite language, while passing through some interesting story by reading a colorful comic book with an exciting script.  Immediately make a reservation that there are no restrictions on programming languages.  The only limitation: they may simply not be installed on servers due to their rarity, for example.  Today we would like to talk about the problems that we met in the development of the server part. <br><br>  The main problem of the project was to ensure the security of the servers during the game, because  we will allow to run in our own, in fact, extraneous code without any restrictions on access to resources.  Those.  when launching the programs, we need to set up the environment in such a way so that the spent program (which may in fact be an installer of the virus) does not break the server and is deleted upon completion of work.  When solving a problem, it is necessary to form a list of the points of which it consists  Our list looks like this: <br><ol><li>  We have a server on which some software from an external source will spin, and which, in fact, does not know what it will do while it is working; </li><li>  There are, in perspective, a large number of users who will upload a large number of applications to a server.  It is quite possible that some of them may even turn out to be viruses: we will allow you to upload everything from php to exe files.  The problem is similar, but a bit wider: the program can remain working on the server resident; </li><li>  Starting, the program will eat away a huge amount of resources. </li></ol><br><br>  Then, we started looking for solutions. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/85f/4e6/e06/85f4e6e066dd0fdf7724ec0a58d3e00f.png"><br>  As you understand, this is not an option under such conditions, since  The server will definitely fall, it's a matter of time.  When someone writes a program with some terrible bug, or when someone floods the virus.  Here, by the way, there is another problem: you can spoil the results of rivals, using them as your own. <br><br><img src="https://habrastorage.org/storage2/30e/b90/b22/30eb90b22f60bddf2ccab82cc87f5ec6.png"><br>  If Linux were our platform, this would be a solution.  It would be a good and sustainable solution that would suit everyone in terms of cost and time of creation.  However, historically, our group is .NET developers and this system is alien to us.  Therefore, in order not to undermine the security of the server by not knowing the details, it was decided to stop on the Windows platform. <br>  You can create a sandbox in the Windows system.  An entire study was conducted on this issue.  For example, you can limit the process by the amount of RAM allocated to them.  Or according to the amount of disk memory that can be occupied on the file system.  You can limit the process in almost everything, however, forgive me Bill Gates, there are too many viruses in Windows OS, which means that all these obstacles can be removed, for example, with a virus.  Therefore, in the middle of the development of this version, it was decided to abandon it after all.  Despite the fact that in essence it would be a cool solution: there are no problems collecting the results of the program, and there are no problems cleaning up the program‚Äôs activities.  Windows kernel objects, called Jobs, put restrictions on the use of OS resources, and NTFS rules put restrictions on working in the file system.  Practically what is necessary, but the feeling of self-preservation prompted that there are still options that can be made fairly quickly. <br><br><img src="https://habrastorage.org/storage2/a92/d4d/dc6/a92d4ddc6503e9164b6d482a37b21e85.png"><br>  In fact, this option lies on the surface as the first thing that comes to mind.  There is a virtual machine on which you need to secure the necessary application and files.  Next, the application is launched, its output is collected in a file, and after completion of work - the file is taken from the virtual machine, which in turn is reset to its original state.  This solution has a number of advantages that make it advantageous in all respects: <br><ol><li>  The state of the machine is reset, which means that there, inside, even the apocalypse, even the demolition of the operating system from the hard drives.  Absolutely no matter what happens.  At the end of the work (or by timeout), just take and roll back to snapshot. </li><li>  The environment does not break after the previous machine runs. </li><li>  You can control every little thing. </li><li>  However, there is one drawback: complex management. </li></ol><br>  At first, we thought that inside the machine we would have to launch an agent that would manage the deployment, launch, and fence of the output program for subsequent transfer to the host machine.  However, later, as it turned out, there is a wonderful product: VirtualBox, which has a rich API and an agent that I need so much.  Why I was so pleased with the presence of the finished agent?  The more components we launch from scratch, the more bugs we will say.  Not because we are so inexperienced, no.  Just bugs are always there, and even more so in newly written software.  The code debugged by hundreds of thousands of launches is much better than samopisny. <br>  For the same reason, we abandoned one risky step: in order to save on resources we could use it as a guest operating system ReactOS.  Really could be.  If it were not for one BUT.  Some interpreters simply did not start there.  In no way.  Maybe this OS has only one error, and it is located deep in the core.  But its presence affects half of the applications and creates a feeling of instability of what is happening.  If it were not for this, we would choose it, if only for the following reasons: <br><ol><li>  It occupies relatively nothing on the hard disk (~ 40Mb) </li><li>  It almost does not take RAM (~ 40 MB) </li><li>  It almost does not take on CPU resources </li></ol><br>  This makes it ideal for the case when you need to run up to 20 virtual machines on one physical machine.  This smart operating system will be perfect when it is carefully finished to a bezless condition.  Lightweight Windows, the launch time of which is in seconds (~ 5). <br>  So, the final decision: <br><ol><li>  Hosting is cloudy.  It has an API, you can dynamically, programmatically, to increase the nodes, if thousands of people come to the server and start playing.  Also, you can dynamically disable them. </li><li>  Noda rises from the pattern.  In the template - Windows, Git, VirtualBox and script.  The script downloads the latest version of executable files from the repository and starts the service. </li><li>  The service starts, picks up VirtualBox, searches for a sample virtual machine and, depending on the configuration, clones it in several instances.  The machine is pre-configured with PHP, Perl, Python, Ruby, Lua interpreters, as well as Java, .Net Framework 3.5 versions.  Windows 7 64bit. </li><li>  Starts to listen to a queue of commands. </li><li>  When a team arrives, it is parsed, onto a free Wirth machine, a script or EXE file of the player is uploaded, is launched.  The solution of the problem takes 30 seconds.  After the time expires, or when the process is completed, the output.log file to which the program stream is written OUTPUT is copied to the host machine and the virtual machine is reset to its original state, rolling back to the last snapshot. </li><li>  The results go to the browser. </li></ol><br><img src="https://habrastorage.org/storage2/c4c/35a/562/c4c35a5628c7f197c12c427273444045.png"><br>  At the moment, we can talk about the following results of our work: <br><ol><li>  The only thing we don‚Äôt like is the size of the virtual machine image.  At a workstation, cloning a 4 GB image into five nodes takes about 20-30 minutes.  When fixing a bug, it would be a nightmare.  Therefore, the presence of a ready agent on the side of the guest virtual machine and the presence of stable versions of interpreters is a separate fat plus.  This to some extent guarantees the uninterrupted operation of the guest machine.  How will behave in the cloud - we will soon load and find out; </li><li>  The total time that takes all the way from the browser to the virtual machine, starting, waiting for the end and back - in the form of logs (taking into account the rollback of the guest machine to the initial state), takes 4 seconds when loading a maximum of 20% CPU.  This is a great result.  Those.  when starting the server on which 5 Wirth machines will spin, we will be able to process up to 75 task checks per minute.  That is, we can assume that you can get rid of one server.  The second will work, just in case.  And the third, if one of the two turns off (and suddenly!). </li><li>  We did not begin to validate postal addresses for a subscription for the simple reason: first, if they enter the left-hand addresses, the mail will still come to people.  Secondly, why send spam about the fact that you, like, signed up, if you can just write it on the screen?  And third: why make people climb into the mailbox to delete this spam? :) </li></ol><br><br>  Next time we will tell you in more detail about the technical part, let's look even deeper.  In the meantime, welcome to the game site (and do not forget to write in the comments, in what language would you like to solve the problems?): <br><img src="https://habrastorage.org/getpro/habr/post_images/afa/19d/045/afa19d045b2bce238895a5f2856f9174.gif"><br> <a href="http://www.luxquest.org/"><img src="https://habrastorage.org/storage2/37c/c5a/ce4/37cc5ace415e232057cbf59d25066f4d.png"></a> </div><p>Source: <a href="https://habr.com/ru/post/151529/">https://habr.com/ru/post/151529/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../151522/index.html">A torrent client whose users cannot be blamed for downloading, storing and distributing content</a></li>
<li><a href="../151524/index.html">Western Digital will replace the air in the hard drive with helium to improve performance.</a></li>
<li><a href="../151526/index.html">Remote shutdown of the PHP linux server</a></li>
<li><a href="../151527/index.html">First, business processes, and then - startups, software, etc.</a></li>
<li><a href="../151528/index.html">iPod nano is the most useful device I've ever bought!</a></li>
<li><a href="../151530/index.html">15 years ago google.com was registered</a></li>
<li><a href="../151532/index.html">Old school wins</a></li>
<li><a href="../151533/index.html">YouTube has launched a program to find the best online lecturers.</a></li>
<li><a href="../151536/index.html">Goodbye, Internet Explorer 8</a></li>
<li><a href="../151538/index.html">Gif sockets. Real-time communication via animated GIF</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>