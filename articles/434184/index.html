<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make friends with Alice and HomeBridge</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have long wanted, in addition to the smart home, a voice assistant who understands and speaks Russian. As a result, I decided to take a chance and t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make friends with Alice and HomeBridge</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/u_/ii/8i/u_ii8i75ovakz625savr9lbudba.png" alt="image"></div><br>  I have long wanted, in addition to the smart home, a voice assistant who understands and speaks Russian.  As a result, I decided to take a chance and take a <s>raw</s> new column of Yandex. Station with a young, but already much beloved, Alice.  The first impression was great, but when I heard enough jokes and had a lot of talk, I began to learn the practical side of the column.  I was most interested in the question of Alice‚Äôs interaction with the smart home. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Description of the problem</b> <div class="spoiler_text">  My home is <a href="https://github.com/nfarina/homebridge">powered by a HomeBridge</a> server.  About his setup and use on Habr√© and other resources, many articles have been written ( <a href="https://habr.com/company/e-Legion/blog/350312/">one</a> , <a href="https://www.indahomekit.ru/2018/01/20/podklyutchaem-homebridge-v-homekit/">two</a> , <a href="https://github.com/nfarina/homebridge/wiki/Running-HomeBridge-on-a-Raspberry-Pi">three</a> ), so I will not dwell on this.  Not having studied the question thoroughly, I was sure that Alice‚Äôs catalog of skills already had a lot of solutions for interacting with smart home control systems.  It turned out that at the time of this writing, most of the skills on the subject of ‚ÄúSmart Home‚Äù require a device with a display for operation, which is not suitable for the station.  The only skill that seemed to meet the requirements and was able to work without a display was <a href="https://dialogs.yandex.ru/store/skills/72395d5f-moj-umnyj-dom">Alfred</a> .  The skill did not suit me due to the fact that it is rigidly tied to the service - IFTTT.  Suppose I want to create a virtual switch that functions in a smart home system and allows scripts to be tied to its current state.  Alfred uses the WebHook service for IFTTT with which you can only affect the trigger created in the <a href="https://help.ifttt.com/hc/en-us/articles/115010361348-What-is-an-Applet-">IFTTT applet,</a> but you cannot get the current state of the applet (you can turn the switch to on or off, but you cannot find out what state the switch is now). <br></div></div><br>  To solve the above task, the <a href="https://alicehomebridge.org/">Alice-HomeBridge</a> service has been created, designed to communicate with the voice assistant of Yandex.Alice and various smart home control systems.  Further, we will consider the HomeBridge configuration as examples of settings, but this approach is applicable for other systems such as <a href="https://www.home-assistant.io/">Home Assistant</a> , <a href="https://www.openhab.org/">openHAB</a> and others. <br><br>  The service allows users, <a href="https://alicehomebridge.org/index.php/ru/profil%3Fview%3Dregistration">after registering on the site, to</a> create virtual switches. <br><br><img src="https://habrastorage.org/webt/ch/e_/hr/che_hrwfku3y_guj9yh3amj7yn4.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      You can change or find out the state of the switches using a specially crafted GET request to the service. <br><br><img src="https://habrastorage.org/webt/ev/um/-u/evum-ulou_hyouaetd4oejdqzne.png"><br><br>  In order for the service to interact with the voice assistant "Alice" the skill "Lazy Jimmy" is created. <br><br> <a href="https://dialogs.yandex.ru/store/skills/662345c4-dzhimmi-valo-upravlyaet-dom%3Futm_source%3Dsite%26utm_medium%3Dbadge%26utm_campaign%3Dv1%26utm_term%3Dd2"><img alt="Lazy jimmy" src="https://habrastorage.org/getpro/habr/post_images/318/3f3/f42/3183f3f422f73cfc44b3e4ebd936ab33.svg"></a> <br>  Tell Alice: ‚ÄúStart the skill lazy Jimmy‚Äù and he will offer you to provide an activation code that you can find in <a href="https://alicehomebridge.org/index.php/ru/profil">your personal account</a> . <br><br><img src="https://habrastorage.org/webt/nl/9l/ks/nl9lksijqnfjbvld5ul5xycfnza.png"><br><br>  After activation, you can change the state of your switches using the ‚ÄúTurn On‚Äù or ‚ÄúTurn Off‚Äù commands.  For example, if you say ‚ÄúTurn on the Light‚Äù, the state of the ‚ÄúLight‚Äù switch will change to positive.  If you just say ‚ÄúLight‚Äù, the state of the switch will change to the opposite. <br><br>  In order for the dialogue to sound more natural, there is the ability to create switches with more understandable names, for example, ‚ÄúWith Utrechkom‚Äù, then you can tell Alice ‚ÄúSay Jimmy With Utrechkom‚Äù and the state of the switch will change. <br><br>  It remains to configure the HomeBridge.  For example, we will use the <a href="https://github.com/luisiam/homebridge-cmdswitch2">cmdswitch2</a> extension.  Create a HomeKit switch with the name "Alice Button 1". <br><br><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"platform"</span></span>: <span class="hljs-string"><span class="hljs-string">"cmdSwitch2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"CMD Switch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"switches"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Alice Button 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"on_cmd"</span></span>: <span class="hljs-string"><span class="hljs-string">"curl --silent \"http://alicehomebridge.org/alice/switches.php?switch=34&amp;hb=ADB7BYBT728O&amp;state=set&amp;val=true\""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"off_cmd"</span></span>: <span class="hljs-string"><span class="hljs-string">"curl --silent \"http://alicehomebridge.org/alice/switches.php?switch=34&amp;hb=ADB7BYBT728O&amp;state=set&amp;val=false\""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"state_cmd"</span></span>: <span class="hljs-string"><span class="hljs-string">"curl --silent \"http://alicehomebridge.org/alice/switches.php?switch=34&amp;hb=ADB7BYBT728O&amp;state=get\" | grep -oh \"true\""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"polling"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"interval"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ] }</code> </pre> <br>  In order not to overload the server with excessive requests, set the interval parameter value for at least 2 seconds. <br><br>  All is ready. <br><br><img src="https://habrastorage.org/webt/vh/5t/4y/vh5t4ykyxbsexa2-pzuib09_bzs.png"><br><br>  Now, if you say ‚ÄúAlice tell lazy Jimmy with a morning‚Äù, the ‚ÄúAlice Button 1‚Äù switch will change state.  Here is a demonstration of how everything works in conjunction with customized HomeKit scripts: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/hGNGzKjo7Os" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <a href="https://www.sendspace.com/file/pu2ccz">Full version of the HomeBridge configuration file</a> <br><br>  <b>PS</b> Most smart home control systems, such as HomeKit, support scripting.  You can create a script that you would like to use in a certain situation, for example, when you wake up and assign it a call to the ‚ÄúTurn On Switch‚Äù event. <br><br>  <b>PS</b> My service is just developing and, to put it mildly, is far from ideal.  But Alice refuses to accept some phrases from time to time.  For example, she perfectly conveys the skill phrase "Turn on the light", but the phrase "Good morning" will not pass.  I hope Yandex knows about the problem and will soon fix it.  Waiting for your comments. </div><p>Source: <a href="https://habr.com/ru/post/434184/">https://habr.com/ru/post/434184/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../434174/index.html">Genetics of the Romanesco variety: a fractal mathematical model of gene expression</a></li>
<li><a href="../434176/index.html">Getting ready to investigate incidents</a></li>
<li><a href="../434178/index.html">How the service provider did its Service Desk</a></li>
<li><a href="../434180/index.html">Droidcon sf review</a></li>
<li><a href="../434182/index.html">Inkjet printing as one of the directions of applied fluid dynamics</a></li>
<li><a href="../434186/index.html">Meta-compilation: what is advised to give foreign publications for holidays</a></li>
<li><a href="../434188/index.html">Security Week 52: The Greatest Hits</a></li>
<li><a href="../434190/index.html">How to create a digital Christmas miracle: an interview with the CIO of Santa Claus</a></li>
<li><a href="../434192/index.html">How Baldur's Gate Saved Computer RPGs</a></li>
<li><a href="../434194/index.html">Developing skills for Alice. Experience with voice interfaces, tips for beginners</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>