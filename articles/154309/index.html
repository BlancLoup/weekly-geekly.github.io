<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Protecting Microsoft Hyper-V Server from Unauthorized Network Access</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Currently, virtualization is widespread and is used everywhere to solve a wide variety of tasks. 

 We decided to find out whether modern virtualizati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Protecting Microsoft Hyper-V Server from Unauthorized Network Access</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/abe/1e4/bbc/abe1e4bbc13e59ef488e6f8089975b20.png" align="left">  Currently, virtualization is widespread and is used everywhere to solve a wide variety of tasks. <br><br>  We decided to find out whether modern virtualization platforms need additional information protection tools and whether <a href="http://www.securitycode.ru/">Security Code</a> products can be useful for enhancing their level of security and for meeting the requirements of regulators when processing personal data and state secret information on such platforms. <br><a name="habracut"></a><br><br clear="all"><br clear="all"><h2>  Microsoft Hyper-V Security </h2><br>  Referring to the widely used <a href="http://www.microsoft.com/en-us/server-cloud/windows-server/hyper-v.aspx">Microsoft Hyper-V</a> virtualization platform.  Microsoft's materials on this product emphasize that the platform was designed and developed to meet security requirements (for example, Hyper-V security is covered in a Microsoft <a href="http://blogs.msdn.com/b/rsa2008/archive/2008/04/07/isolation-of-virtual-machines.aspx">report</a> at the RSA 2008 conference).  Hyper-V hypervisor uses micronuclear architecture.  Access checks are implemented at all levels, starting from hypercalls from virtual machines and access to physical memory and resources, and ending with the possibilities of organizing role-based access to virtual machines and combining them into groups.  Each virtual machine gets its own unique SID, which is used when setting access rights to physical files that store machine images and data ‚Äî this eliminates the possibility of accessing data from one machine to another. <br><br>  In addition, <a href="http://technet.microsoft.com/ru-ru/library/ff470402.aspx">recommendations have been</a> published to strengthen security settings when deploying the Hyper-V platform.  They, in particular, pay attention to the network security of the Hyper-V server itself.  For example, to increase the network security level of the server, it is recommended to install at least two network adapters: one should be allocated for the administration channel, and the rest should be set up for organizing network access of virtual machines to external networks.  In doing so, Microsoft recommends isolating the administration network from all other networks.  This is necessary in order to exclude the possibility of network access to Hyper-V administration tools from virtual machines and external networks.  The most reliable method of isolation is physical: changing the network topology, installing and configuring the necessary network equipment, and highlighting a special administration network that is separated from the general network. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Alternatives to physical network isolation </h2><br>  In some cases, the physical isolation of networks is impossible or highly undesirable.  Then logical isolation is applied, the impossibility of network exchange is not achieved by physical separation of networks, but by using special software tools that specify the necessary access rules.  In the case of Hyper-V, the IPSec suite of protocols can be used as such a tool, which allows you to lay ‚Äúvirtual‚Äù access channels on top of a conventional network.  IPSec support is built into the OS, but different options are available in different versions of Windows.  Support for user authentication (and not computer) appeared only in the new OS, IPSec configuration is performed differently depending on the version of Windows. <br><br>  In the Security Code product line, there is a product that helps organize the logical isolation of networks by using the protocols of the IPSec family (AH and ESP) in transport mode.  This is <a href="http://www.securitycode.ru/products/trustaccess/">a TrustAccess</a> distributed <a href="http://www.securitycode.ru/products/trustaccess/">firewall</a> (ME class 2), which supports almost all versions of Windows, is easy to deploy and configure, has official compatibility status with the platform running Hyper-V, ‚ÄúWorks with Server 2008 R2‚Äù and Compatibility of users with ‚ÄúCompatible with Windows 7‚Äù. <br><br>  An important feature of this product is the ability to distinguish network access not only by network addresses and protocols, but also by subjects of access - users and computers that initiated access to the protected resource. <br><br>  At the same time, TrustAccess implements its own network authentication and access control mechanisms, which allows creating an independent secure logical perimeter on top of the existing local network without changing its topology.  The product has been certified by FSTEC and can be used to protect confidential information up to class 1G inclusive, all classes of personal data information systems (ISPDn classes K1, K2, K3), as well as to protect state secrets in automated systems up to class 1B inclusive. <br><br><h2>  Using TrustAccess for Logic Hyper-V Management Network Isolation </h2><br>  Consider a Hyper-V server with two network adapters configured according to Microsoft recommendations: <br><ul><li>  <b>Network adapter 1</b> ‚Äî dedicated only for administrative access to the server; </li><li>  <b>Network Adapter 2</b> - designed for use by virtual machines. </li></ul><br>  In the Hyper-V settings, you need to create a new virtual network associated with adapter 2 (External type).  The option ‚ÄúAllow management operating system to share this network adapter‚Äù should be disabled. <br><br>  The local network establishes the TrustAccess management server and creates user accounts for Hyper-V administrators.  The TrustAccess agent is installed on the Hyper-V server, as well as on all the computers from which the server will be administered.  This configuration is shown in <a href="https://habr.com/ru/company/securitycode/blog/154309/">Figure 1</a> : <br><a name="Pic1"></a><br><img src="https://habrastorage.org/storage2/8c8/b7e/c26/8c8b7ec26c440339e5c451fc6d9b2486.png"><br><br>  Using the TrustAccess management console for the Hyper-V server, rules are configured that allow network access only to specific users and groups (Hyper-V administrators) for network adapter 1. <br><br><h2>  How is logical isolation achieved </h2><br><ul><li>  The Hyper-V administrator at his workplace points out his TrustAccess account information and authenticates with the management server. </li><li>  After successful authentication, a network connection to the Hyper-V server is created to administer an ISAKMP security session for its administration, a session key is generated, and all network traffic addressed to the Hyper-V server is automatically signed by the TrustAccess agent (IPSec, AH in transport mode).  From the user's point of view, all channel security mechanisms work transparently, i.e.  do not require any intervention from him. </li><li>  The TrustAccess agent on the Hyper-V server passes network traffic addressed to the server itself, in accordance with the access rules and current security sessions;  The user is identified by the IPSec / AH IP packet header that contains the session ID.  If the IP packet signature is missing or does not match the data, the packet will be dropped.  Checks are also performed on the packet sequence number in the IPSec AH header to protect against replay attacks. </li><li>  The response network traffic of the server is also signed by the session key and passes similar checks by the agent on the user's computer. </li></ul><br>  Thus, only Hyper-V administrators authenticated with TrustAccess can create network connections and exchange information.  In this case, all attempts to access the server, including unauthorized, will be recorded.  Registered events can be centrally processed with the ability to generate reports. <br><br>  With TrustAccess, you can protect the virtual machines themselves, as well as other corporate network resources (servers and workstations).  You can allocate new secure network segments ( <a href="https://habr.com/ru/company/securitycode/blog/154309/">Figure 2</a> ) or granularly configure user access rights to network services of protected resources.  At the same time, the availability of FSTEC certificates will assist in the certification of information systems processing personal data and data constituting state secrets. <br><a name="Pic2"></a><br><img src="https://habrastorage.org/storage2/0ff/522/106/0ff52210637dd1e2fd3b9eae10d38918.png"><br><br><h2>  Conclusion </h2><br>  As we can see, third-party products can help meet security requirements and recommendations when building secure infrastructures based on the Hyper-V virtualization platform.  From the point of view of network protection of the server against unauthorized access, the TrustAccess firewall has made it possible to isolate the administration network in a convenient way without the need to change the topology of the local network and install additional equipment. </div><p>Source: <a href="https://habr.com/ru/post/154309/">https://habr.com/ru/post/154309/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../154295/index.html">About voting systems</a></li>
<li><a href="../154297/index.html">International IT HR conference "find the answer!" # 6</a></li>
<li><a href="../154301/index.html">Critical bug in CoreGraphics on iOS</a></li>
<li><a href="../154305/index.html">Required resources for game designers</a></li>
<li><a href="../154307/index.html">How to treat computer games</a></li>
<li><a href="../154311/index.html">How I Boost.Any with Boost.mpl was friends</a></li>
<li><a href="../154313/index.html">ORM for Sitecore do it yourself</a></li>
<li><a href="../154315/index.html">In-depth review of freshly baked Linux 3.6</a></li>
<li><a href="../154317/index.html">Meet the free and free Scada headset</a></li>
<li><a href="../154319/index.html">Popular about pseudo-elements: Before and: After</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>