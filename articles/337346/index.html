<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Waiting for 15 years. Nginx Application Server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Since the appearance of Nginx in 2004, we all wondered: when will nginx be able to run applications? We ran PHP in php-fpm and apache, we launched Pyt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Waiting for 15 years. Nginx Application Server</h1><div class="post__text post__text-html js-mediator-article">  Since the appearance of Nginx in 2004, we all wondered: when will nginx be able to run applications?  We ran PHP in php-fpm and apache, we launched Python via uWSGI, sometimes we lived with Apache, and if we needed different versions of PHP, we lived with a zoo from FPMs. <br><br><img src="https://habrastorage.org/web/a14/36d/15e/a1436d15e44e469183ac7fa5a1ea1268.jpg" alt="image"><br><br>  Just at the NginxConf conference in Portland Nginx, Inc.  announced the launch of the Nginx Application Platform.  ITSumma tested one of its components, the Application Server itself, called the Nginx Unit, from the closed version.  In this post we will talk about how the Nginx Unit looks and how to launch applications on it. <br><a name="habracut"></a><br>  Nginx Unit is a web application server that allows you to run web applications written in various programming languages ‚Äã‚Äã(php, python, go).  This tool is quite easy and allows you to reconfigure the settings and the number of applications as needed during development on the fly. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ‚Üí <a href="http://unit.nginx.org/">Main project site</a> <br><br>  Currently supported platforms: <br>  - Python 2.6, 2.7, 3 <br>  - PHP 5, 7 <br>  - Go 1.6 or later <br><br>  An important and cool opportunity for people with zoo platforms: different versions of the same platform can be launched within one config, one appserver - goodbye, PHP-FPM zoo. <br><br>  ‚Üí The source code of the project is loaded on <a href="https://github.com/nginx/unit">GitHab</a> . <br><br>  What is cool and interesting: the guys have downloaded the code from the first commit to GitHab and promise to accept pull-requests in the classic GitHab style.  Among other things, you can see the history, logic and style of development - very interesting. <br><br><h3>  Installation </h3><br>  Important: The current version is still beta, with a huge amount of debugging code that adds its overhead.  In the next versions promise significant optimization, which should surpass the current app servers for performance. <br><br>  Packages are now available for CentOS 7.0 and Ubuntu 16.04 LTS <br><br>  <b>Installation for CentOS 7</b> <br><br>  1. Create the file /etc/yum.repos.d/unit.repo with the following contents: <br><br><pre><code class="bash hljs">[unit] name=unit repo baseurl=http://nginx.org/packages/mainline/centos/7/<span class="hljs-variable"><span class="hljs-variable">$basearch</span></span>/ gpgcheck=0 enabled=1</code> </pre> <br>  2. Run the package installation: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum install unit</span></span></code> </pre> <br>  <b>Installation for Ubuntu 16.04</b> <br><br>  1. Download the <a href="">NGINX</a> , Inc. <a href="">PGP key</a> . <br><br>  2. Add the key to the apt keychain.  After that, there should be no alerts about the missing PGP key during the installation of Unit. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># sudo apt-key add nginx_signing.key</span></span></code> </pre> <br>  3. Add the following lines to the end of the /etc/apt/sources.list file: <br><br><pre> <code class="bash hljs">deb http://nginx.org/packages/mainline/ubuntu/ xenial nginx deb-src http://nginx.org/packages/mainline/ubuntu/ xenial nginx</code> </pre> <br>  4. Download Unit: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># apt-get update # apt-get install unit</span></span></code> </pre> <br>  Nginx Unit consists of several service processes (master / controller / router) and the application processes themselves.  Configuration is done through REST API, through Unix socket unit.control.sock. <br><br>  Getting the current config <br><br><pre> <code class="hljs mel">curl --unix-socket ./<span class="hljs-keyword"><span class="hljs-keyword">control</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">unit</span></span>.sock http:<span class="hljs-comment"><span class="hljs-comment">//localhost/</span></span></code> </pre> <br>  Download new <br><br><pre> <code class="bash hljs">curl -X PUT -d @/path/to/start.json --unix-socket ./control.unit.sock http://localhost/</code> </pre> <br>  The configuration consists of a set of applications (application) and workers (listener). <br><br><h3>  Application launch </h3><br>  Consider the launch of the application on the example of the launch of "1C-Bitrix" and Laravel: <br>  The front end is the classic nginx, and the back end is the Nginx Unit.  Now every Nginx Unit ‚Äúapplication‚Äù for PHP implies one entry point.  In the case of Bitrix there may be two - urlrewrite.php and index.php, respectively, in beta - you need to either merge this logic into one file in the code, or run two applications.  In the next versions of the Nginx Unit, the guys promise to do the routing to avoid this problem. <br><br>  Configuration for Laravel: <br><br><pre> <code class="bash hljs"> location / { proxy_pass http://127.0.0.1:8300; proxy_redirect http://127.0.0.1:8300/ /; proxy_read_timeout 60s; proxy_set_header Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; proxy_set_header X-Real-IP <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>; proxy_set_header X-Forwarded-For <span class="hljs-variable"><span class="hljs-variable">$proxy_add_x_forwarded_for</span></span>; proxy_set_header X-Forwarded-Proto <span class="hljs-variable"><span class="hljs-variable">$scheme</span></span>; } location ~ \.php$ { proxy_pass http://127.0.0.1:8300; proxy_redirect http://127.0.0.1:8300/ /; proxy_read_timeout 60s; proxy_set_header Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; proxy_set_header X-Real-IP <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>; proxy_set_header X-Forwarded-For <span class="hljs-variable"><span class="hljs-variable">$proxy_add_x_forwarded_for</span></span>; proxy_set_header X-Forwarded-Proto <span class="hljs-variable"><span class="hljs-variable">$scheme</span></span>; }</code> </pre> <br>  Configuration for 1C-Bitrix: <br><br><pre> <code class="bash hljs"> location = / { proxy_pass http://127.0.0.1:8601; proxy_redirect http://127.0.0.1:8601/ /; proxy_read_timeout 60s; proxy_set_header Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; proxy_set_header X-Real-IP <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>; proxy_set_header X-Forwarded-For <span class="hljs-variable"><span class="hljs-variable">$proxy_add_x_forwarded_for</span></span>; proxy_set_header X-Forwarded-Proto <span class="hljs-variable"><span class="hljs-variable">$scheme</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } location / { try_files <span class="hljs-variable"><span class="hljs-variable">$uri</span></span> /bitrix/urlrewrite.php =404; proxy_pass http://127.0.0.1:8600; proxy_redirect http://127.0.0.1:8600/ /; proxy_read_timeout 60s; proxy_set_header Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; proxy_set_header X-Real-IP <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>; proxy_set_header X-Forwarded-For <span class="hljs-variable"><span class="hljs-variable">$proxy_add_x_forwarded_for</span></span>; proxy_set_header X-Forwarded-Proto <span class="hljs-variable"><span class="hljs-variable">$scheme</span></span>; }</code> </pre> <br>  To replace the configuration run <br><br><pre> <code class="bash hljs">curl -X PUT -d @/path/to/start.json --unix-socket ./control.unit.sock http://localhost/</code> </pre> <br>  (By default, the socket, you can proxy from the socket to the TCP port using nginx.) <br><br>  At the moment, the configuration must be loaded when the app server is started; in future versions, the Unit will save the loaded configuration upon restart. <br><br>  First we list the applications, and for each application we indicate the version of the interpreter.  As an entry point, you can specify the index parameter (and then the script will be taken from the query string), or, in the case of the entry point, the script - and then the queries will go to a specific script.  Again, note that two applications are running for 1C-Bitrix: <br><br>  Config: <br><br><pre> <code class="bash hljs">{ <span class="hljs-string"><span class="hljs-string">"applications"</span></span>: { <span class="hljs-string"><span class="hljs-string">"laravel"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"php 7.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"user"</span></span>: <span class="hljs-string"><span class="hljs-string">"nobody"</span></span>, <span class="hljs-string"><span class="hljs-string">"group"</span></span>: <span class="hljs-string"><span class="hljs-string">"nobody"</span></span>, <span class="hljs-string"><span class="hljs-string">"workers"</span></span>: 2, <span class="hljs-string"><span class="hljs-string">"root"</span></span>: <span class="hljs-string"><span class="hljs-string">"/var/www/vhosts/laravel/public"</span></span>, <span class="hljs-string"><span class="hljs-string">"script"</span></span>: <span class="hljs-string"><span class="hljs-string">"index.php"</span></span>, }, <span class="hljs-string"><span class="hljs-string">"plain"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"php 7.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"user"</span></span>: <span class="hljs-string"><span class="hljs-string">"nobody"</span></span>, <span class="hljs-string"><span class="hljs-string">"group"</span></span>: <span class="hljs-string"><span class="hljs-string">"nobody"</span></span>, <span class="hljs-string"><span class="hljs-string">"workers"</span></span>: 2, <span class="hljs-string"><span class="hljs-string">"root"</span></span>: <span class="hljs-string"><span class="hljs-string">"/var/www/vhosts/test"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span>: <span class="hljs-string"><span class="hljs-string">"index.php"</span></span> }, <span class="hljs-string"><span class="hljs-string">"bitrix"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"php 5.6"</span></span>, <span class="hljs-string"><span class="hljs-string">"user"</span></span>: <span class="hljs-string"><span class="hljs-string">"nobody"</span></span>, <span class="hljs-string"><span class="hljs-string">"group"</span></span>: <span class="hljs-string"><span class="hljs-string">"nobody"</span></span>, <span class="hljs-string"><span class="hljs-string">"workers"</span></span>: 2, <span class="hljs-string"><span class="hljs-string">"root"</span></span>: <span class="hljs-string"><span class="hljs-string">"/var/www/vhosts/bitrix"</span></span>, <span class="hljs-string"><span class="hljs-string">"script"</span></span>: <span class="hljs-string"><span class="hljs-string">"/bitrix/urlrewrite.php"</span></span> }, <span class="hljs-string"><span class="hljs-string">"bitrix_index"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"php 5.6"</span></span>, <span class="hljs-string"><span class="hljs-string">"user"</span></span>: <span class="hljs-string"><span class="hljs-string">"nobody"</span></span>, <span class="hljs-string"><span class="hljs-string">"group"</span></span>: <span class="hljs-string"><span class="hljs-string">"nobody"</span></span>, <span class="hljs-string"><span class="hljs-string">"workers"</span></span>: 2, <span class="hljs-string"><span class="hljs-string">"root"</span></span>: <span class="hljs-string"><span class="hljs-string">"/var/www/vhosts/bitrix"</span></span>, <span class="hljs-string"><span class="hljs-string">"script"</span></span>: <span class="hljs-string"><span class="hljs-string">"index.php"</span></span> } },</code> </pre> <br>  Then the ups are hung on the ports: <br><br><pre> <code class="bash hljs"> <span class="hljs-string"><span class="hljs-string">"listeners"</span></span>: { <span class="hljs-string"><span class="hljs-string">"*:8300"</span></span>: { <span class="hljs-string"><span class="hljs-string">"application"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel"</span></span> }, <span class="hljs-string"><span class="hljs-string">"*:8500"</span></span>: { <span class="hljs-string"><span class="hljs-string">"application"</span></span>: <span class="hljs-string"><span class="hljs-string">"plain"</span></span> }, <span class="hljs-string"><span class="hljs-string">"*:8600"</span></span>: { <span class="hljs-string"><span class="hljs-string">"application"</span></span>: <span class="hljs-string"><span class="hljs-string">"bitrix"</span></span> }, <span class="hljs-string"><span class="hljs-string">"*:8601"</span></span>: { <span class="hljs-string"><span class="hljs-string">"application"</span></span>: <span class="hljs-string"><span class="hljs-string">"bitirx_index"</span></span> } } }</code> </pre> <br>  We have all been waiting for this for a long time, but let's still consider the cases where the Unit will bring a serious advantage: <br><br><ul><li>  <b>heterogeneous application infrastructure.</b>  Now, within the same app-server, you can keep different versions of PHP, run Python and Go.  NodeJS, Java and possibly Ruby are expected by the end of the year.  All this in one config, the same app-server.  Applications are no longer written in the same language, and this will really make life easier for all of us. </li><li>  <b>Zoo versions on one system</b> .  Tired of the many configurations and builds of fpm with different versions?  Now it can be run within the same application.  It is clear that this is not a ‚Äúclean‚Äù situation, but it often occurs and, again, a serious relief of life. </li><li>  if we feel points 1 and 2 on ourselves, then the third one, about which Nginx speaks, is yet to be tried.  Unified and simple configuration management microservice architecture.  A single configuration management system through the REST API, a single product as a whole. </li></ul><br>  While the Application Platform is still beta, you can already try and prepare your configurations for production.  We are waiting for further news! </div><p>Source: <a href="https://habr.com/ru/post/337346/">https://habr.com/ru/post/337346/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337336/index.html">About choosing a name for the game</a></li>
<li><a href="../337338/index.html">How to determine the mobile operator and home region by phone number</a></li>
<li><a href="../337340/index.html">The last countdown - Google has fun</a></li>
<li><a href="../337342/index.html">At the same place, at the same time: we are waiting for you at the new meeting of Android developers in the LC</a></li>
<li><a href="../337344/index.html">Critical analysis of old and synthesis of new knowledge will make Testing software science</a></li>
<li><a href="../337348/index.html">RustGo: Rust call from Go with almost zero overhead</a></li>
<li><a href="../337350/index.html">Use Stream API easier (or do not use at all)</a></li>
<li><a href="../337352/index.html">Time off the hook: turning emotions into allies</a></li>
<li><a href="../337354/index.html">5 myths about personal data</a></li>
<li><a href="../337356/index.html">Real Offline Perfect Forward Secrecy for your products</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>