<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>BIDI (unicode bidirectional algorithm)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Multilingual sites are good, but rather dreary. And if for the most popular languages ​​it is enough to have several variants of text, then with the a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>BIDI (unicode bidirectional algorithm)</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/b42/9c4/927/b429c4927aa705006c00de931f80cd7c.gif" alt="image">  Multilingual sites are good, but rather dreary.  And if for the <a href="http://ru.wikipedia.org/wiki/%25D0%25AF%25D0%25B7%25D1%258B%25D0%25BA%25D0%25B8_%25D0%25B2_%25D0%2598%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25BD%25D0%25B5%25D1%2582%25D0%25B5">most popular</a> languages ​​it is enough to have several variants of text, then with the addition of RTL (right-to-left) everything becomes much worse.  We have to start a new set of styles with the replacement of the entire right to the left and vice versa (for properties like float, padding, margin etc), but this is not all.  There may be situations when phrases in languages ​​with different directions are side by side in the same document, and bidi begins to work here.  If anyone is interested .... <a name="habracut"></a><br><br><br><h4>  Bidi </h4><br>  When there are languages ​​with different (RTL and LTR) spelling on the page, the characters are displayed, as a rule, not in the order in which they are stored in the browser's memory.  Bidi is committed to putting them in their places.  The order of the characters depends on the so-called basic direction of the text.  It is set by the <a href="http://htmlbook.ru/html/attr/dir">dir</a> attribute, which can be specified for most tags.  The easiest way to set the base direction of the entire page in RTL is to add the dir attribute to the top: <code>&lt;html dir="rtl"&gt;</code> .  In addition, most of the characters in unicode themselves have a certain direction.  On this basis, they are divided into strictly typed, weakly typed and non-typed (neutral). <br><br><h5>  Strongly Typed Symbols </h5><br>  These are the most letters.  The sequence of LTR characters is displayed one after another from left to right, RTL - from right to left: <br><div style="text-align:center;"> <a href="http://www.w3.org/International/php/examples/generate%3Fdata%3Dbidi%26test%3D7"><img src="https://habrastorage.org/getpro/habr/post_images/5c5/b71/65b/5c5b7165bae1ea5b6d7b9ab736a284eb.gif" alt="image"></a> </div><br>  The phrase from several differently directed pieces is displayed in several passes.  Their direction does not depend on the base, but only on the direction of the characters.  Therefore, for example, words in Arabic will be read from right to left in both RTL and LTR versions of the site.  But the order of these "visits" will change.  In the following example, you will first read bahrain, then مصر, then kuwait: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"> <a href="http://www.w3.org/International/php/examples/generate%3Fdata%3Dbidi%26test%3D7"><img src="https://habrastorage.org/getpro/habr/post_images/0a4/720/b9e/0a4720b9e8f7b79d14831446917cf353.gif" alt="image"></a> </div><br>  If we add <code>dir=”rtl”</code> any parent element, then the basic direction, and hence the word order, will change, but the words themselves will be read the same way as before: <br><br><div style="text-align:center;"> <a href="http://www.w3.org/International/php/examples/generate%3Fdata%3Dbidi%26test%3D9"><img src="https://habrastorage.org/getpro/habr/post_images/307/005/5ae/3070055ae38dc73896ab7a088b91f35d.gif" alt="image"></a> </div><br>  Please note that the only difference in the code of these two pages (the pictures are clickable) is the presence of the dir attribute, but not the word order. <br><br><h5>  Non-typed characters </h5><br>  Spaces and punctuation are not typed, because they can be used in any text.  They are called neutral.  From the point of view of bidi, a neutral symbol located between two strongly typed characters of the <b>same direction</b> has the same direction, that is, the space between the two RTL characters will also become RTL.  Thanks to this, the three Arabic words in the following example are displayed in one go: <br><br><div style="text-align:center;"> <a href="http://www.w3.org/International/php/examples/generate%3Fdata%3Dbidi%26test%3D10"><img src="https://habrastorage.org/getpro/habr/post_images/0b7/9a4/4c8/0b79a44c8aba04fdb90754e881b8c4cb.gif" alt="image"></a> </div><br>  But when a neutral symbol stands between symbols with <b>different directions</b> , it assumes a base direction, which is not always correct.  Suppose the name is taken from the base and must end with an exclamation mark: <br><br><pre> <code class="php hljs">The title is <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $title <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>! in <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $lang <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>.</code> </pre> <br>  For a name in Arabic, it would be correct to move the exclamation mark: <br><br><div style="text-align:center;"> <a href="http://www.w3.org/International/php/examples/generate%3Fdata%3Dbidi%26test%3D8a"><img src="https://habrastorage.org/getpro/habr/post_images/eed/23f/dd7/eed23fdd73f1eafeae63112e2bc62a9b.gif" alt="image"></a> </div><br>  But bidi won't do that.  The exclamation mark (like the space next to it) is between characters with different directions, which means it takes the base direction and will be displayed during the next - LTR - approach.  That is, the first entry will display “The title is“, the second - “مفتاح معايير الويب” and then “!  in Arabic ”: <br><br><div style="text-align:center;"> <a href="http://www.w3.org/International/php/examples/generate%3Fdata%3Dbidi%26test%3D8a"><img src="https://habrastorage.org/getpro/habr/post_images/bba/391/551/bba3915517331e7e2d8746f646b129f2.gif" alt="image"></a> </div><br>  Thus, for Arabic-speaking site visitors, the phrase will begin with an exclamation mark, and not end with it. <br><br><h6>  Mirror Symbols </h6><br>  These are all kinds of brackets and they deserve a separate mention, because the bidi not only transfers them, but also expands them.  The opening (sya?) Bracket always "opens" in the base direction, the closing - in the opposite direction.  And this is how it happens: <div style="text-align:center;"> <a href="http://www.w3.org/International/php/examples/generate%3Fdata%3Dbidi%26test%3D25"><img src="https://habrastorage.org/getpro/habr/post_images/b7c/a20/e29/b7ca20e2936486e41c8b54f0b0b28c3a.png" alt="image"></a> </div>  The rules are the same: in the top line, the closing bracket is on the border -&gt; takes the base direction -&gt; is transferred and flipped.  Not nice <br><br><h5>  Weakly typed characters </h5><br>  Numbers are considered LTR symbols, but they do not affect the neutral ones: <br><br><div style="text-align:center;"> <a href="http://www.w3.org/International/php/examples/generate%3Fdata%3Dbidi%26test%3D11"><img src="https://habrastorage.org/getpro/habr/post_images/aa5/1e0/749/aa51e07491b979015359f7f15bc293c6.gif" alt="image"></a> </div><br>  Since the numbers in this example are between Arabic characters, they will be displayed during the RTL approach, but left-to-right and without affecting the spaces.  There are also subtleties like the one that the dollar sign, for example, will be considered part of the number, not a neutral symbol, but I know little about it. <br><br><h4>  What to do? </h4><br>  Problems, apparently, arise on the border of texts with different directions and are connected with neutral symbols.  Bidi cannot independently determine the direction of such a symbol and regards it as a base one.  The simplest solution is to wrap the problem area in <code>&lt;span&gt;</code> with the appropriate dir.  Thus, we will eliminate ambiguity, but for this we need to know in advance the direction of the text, which will be located in this place. <br>  Another possible value is added to HTML5 for the dir attribute - <a href="http://www.w3.org/International/tests/html-css/bidi-html5/results-bidi-html5"><code>auto</code></a> and even a whole new <a href="http://www.w3.org/International/tests/html-css/bidi-html5/results-bidi-html5"><code>&lt;bdi&gt;</code></a> .  When using any of them, the bidi will find the first strongly typed symbol inside the element and take the corresponding basic direction, which will solve most problems. <br>  In addition to tags, you can use special <a href="http://www.w3.org/International/articles/inline-bidi-markup/">markers</a> (directional mark).  These are non-printable characters, which in their action replace a strongly typed LTR or RTL symbol.  In html, you can use the mnemonics &amp; lrm;  and &amp; rlm; <br><br>  Well, such a <a href="http://jsfiddle.net/Olorin/W9qDS">test</a> : <table><tbody><tr><th>  Line </th><th>  <nobr>IE 10</nobr> </th><th>  <nobr>Opera 12.15</nobr> </th><th>  <nobr>FF 21</nobr> </th><th>  <nobr>Chrome 27.0.1453.94 m</nobr> </th></tr><tr><td><pre> <code class="html hljs xml">Title is مفتاح معايير الويب! in Arabic</code> </pre> </td><td>  - </td><td>  - </td><td>  - </td><td>  - </td></tr><tr><td><pre> <code class="html hljs xml">Title is مفتاح معايير الويب!&amp;rlm; in Arabic</code> </pre> </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td><pre> <code class="html hljs xml">Title is <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rtl"</span></span></span><span class="hljs-tag">&gt;</span></span>مفتاح معايير الويب!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> in Arabic</code> </pre> </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td><pre> <code class="html hljs xml">Title is <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"auto"</span></span></span><span class="hljs-tag">&gt;</span></span>مفتاح معايير الويب!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> in Arabic</code> </pre> </td><td>  - </td><td>  - </td><td>  + </td><td>  + </td></tr><tr><td><pre> <code class="html hljs xml">Title is <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bdi</span></span></span><span class="hljs-tag">&gt;</span></span>مفتاح معايير الويب!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bdi</span></span></span><span class="hljs-tag">&gt;</span></span> in Arabic</code> </pre> </td><td>  - </td><td>  - </td><td>  + </td><td>  + </td></tr></tbody></table>  Plus means that the exclamation mark is transferred to the left, that is, it is displayed as part of the Arabic text. <br><br><h4>  More tar! </h4><br>  And there are also input fields in which there may also be a jumble of multidirectional characters. <br>  We have, say, an RTL site and a field for entering a phone number in a free format.  If you enter numbers in a row, or through a hyphen, then everything is fine, but the reaction to spaces is quite amusing.  Here is <a href="http://jsfiddle.net/Olorin/ePkmU/">an example</a> .  Try also to highlight a pair of numbers in parentheses.  Why is that?  Yes, everything is the same: the numbers are LTR characters, but because of their weak typing they do not affect the neutral ones, which means the spaces take the basic direction (RTL) and instead of one LTR line (which would be printed in one go) there are several separated spaces and all this is displayed in accordance with the bidi: "words" - from right to left, the characters in them - from left to right.  If we add a strictly typed LTR symbol to the beginning, it will set the direction of the neutral ones in the LTR as well and the problem will disappear.  The only solution I see is to somehow handle user input with js.  For example, add a marker &amp; lrm;  in front of each neutral symbol.  If someone tells a more beautiful solution, I will be grateful. <br><br>  <b>upd:</b> <br>  <a href="https://habrahabr.ru/users/t2l/" class="user_link">T2L</a> proposed this solution: <code>&lt;input type="text" value="123456" dir="ltr" style="text-align: right" /&gt;</code> <br>  Simply set the base direction in the LTR and align the content to the right.  I think this will be optimal for fields that do not assume strictly typed RTL characters. <br><br><h4>  Conclusion </h4><br>  The algorithm is good, but not perfect, and this must be taken into account.  As for the input fields, I asked a <a href="http://habrahabr.ru/qa/40169/">question</a> in Habré, but I received only one answer (although very detailed, thanks, <a href="https://habrahabr.ru/users/yogev_ezra/" class="user_link">yogev_ezra</a> ).  The text is based on an <a href="http://www.w3.org/International/articles/inline-bidi-markup/">article</a> with w3, which explained everything to me.  For the transfer of forces was not enough, I decided to try to retell.  Pictures from the same place.  Indications of any errors are welcome. <br><br>  PS <br>  Yes, and thanks <a href="https://habrahabr.ru/users/gribozavr/" class="user_link">gribozavr</a> for the <a href="http://habrahabr.ru/post/104493/">hint</a> . </div><p>Source: <a href="https://habr.com/ru/post/181123/">https://habr.com/ru/post/181123/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../181111/index.html">Using S3cmd in Windows</a></li>
<li><a href="../181113/index.html">New in Caché 2013.1 DBMS: Integrated WebSockets Support</a></li>
<li><a href="../181117/index.html">Smartphones on Atom. Achievements and prospects</a></li>
<li><a href="../181119/index.html">Micron - the heart of Russian microelectronics</a></li>
<li><a href="../181121/index.html">Kerberos constraint delegation for SharePoint 2010 SP1 and SQL Server 2012 Reporting Services (Named Instance)</a></li>
<li><a href="../181125/index.html">Better Place has declared bankruptcy</a></li>
<li><a href="../181127/index.html">All work Curiosity (281 sol) for 1 minute (video)</a></li>
<li><a href="../181131/index.html">New HTML5 Visual ZEN-components in Caché 2013.2 DBMS</a></li>
<li><a href="../181137/index.html">Life hacking from TeamLab Office 7.4</a></li>
<li><a href="../181139/index.html">Matternet wants to create a future transportation network</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>