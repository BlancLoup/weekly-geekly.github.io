<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optimization of Android applications for x86. 2GIS Experience</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably, it makes no sense for Habra readers to submit 2GIS - Russian geoservice, which has become the most important source of information for resid...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optimization of Android applications for x86. 2GIS Experience</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/112/5e2/ca8/1125e2ca822374c22f4d869d2c036013.jpg">  Probably, it makes no sense for Habra readers to submit <a href="http://habrahabr.ru/company/2gis/">2GIS</a> - Russian geoservice, which has become the most important source of information for residents of many cities of our (and not only) country.  Service developers pay great attention to mobile applications - the product is available for various mobile operating systems and is among the best free applications in the ‚Äúmap‚Äù and ‚Äúnavigation‚Äù categories on Google Play and the App Store. <br>  Mobile devices with Android OS based on x86 are possible, while a little less than 2GIS are known, but with a constant increase in the range, their popularity is growing. <br>  We invited 2GIS to visit the Intel blog to ask them a few questions about optimizing the mobile version of the program for the x86 architecture.  Answers prepared by Sergey Galin - Head of the 2GIS mobile development team. <br><a name="habracut"></a><br>  <i><b>How does your application work in terms of using native code?</b></i>  <i><b>Those.</b></i>  <i><b>How big is his percentage, what exactly is being done natively and why?</b></i> <br><img align="left" src="https://habrastorage.org/getpro/habr/post_images/474/c49/c9d/474c49c9d8ee4231bd6991e8065c3d13.jpg">  Our Android app works in 99% native code - i.e.  absolutely everything except the process of starting the application and working with the Android API.  Including rendering the entire user interface "in-house", without using the functions of the operating system for rendering.  This is a cross-platform application based on Qt 4.8 (the port on Android is our own).  It happened historically, since the development began for Symbian and Windows Mobile, then I wanted to add Android (at that time, Android 2.2).  However, taking into account the ‚Äúgravity‚Äù of our application, which in real time draws a 3D map and works with a huge offline database, the Android ‚Äúdefault‚Äù approach with Java development simply would not ‚Äútake out‚Äù - neither in speed, nor in terms of volume. random access memory.  In the native code, we can do almost the same functional application as on a regular desktop computer, and run it even on a budget phone sample of 2011. <br><br>  <i><b>Are you and your users satisfied with the performance of existing ARM versions of applications?</b></i>  <i><b>Is there a performance margin to extend the functionality?</b></i> <br>  Yes, it does, for modern devices and tops of 2012 :) Budget phones of the past years and even older flagships, unfortunately, work on the verge of possibilities, and the performance in some places really leaves much to be desired.  At the same time, there are practically no opportunities for optimization with this application functionality for many obsolete devices. <br>  It will be very good for us if Intel really strengthens the competition and accelerates the expansion of the user audience towards more powerful devices! <br><br>  <i><b>Why was it decided to release the x86 version?</b></i> <br>  Because it was really easy to do!  And it was not cool that the application works bad on excellent devices with Intel processors. <br>  We are now busy, among other things, with a systematic expansion of support for devices and platforms, so it fits well with our plans. <br>  And thanks to Intel for providing the devices, without them it would have been more difficult to get the subject off the ground :) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i><b>What exactly was the addition of x86 support - how many files / lines of code did you need to change?</b></i> <br>  Code in the application - almost at all.  The Qt build configuration has been modified to enable it to support x86.  I had to patch the macros in a pair of third-party libraries, which until then had been convinced that ‚ÄúAndroid means ARM‚Äù.  Then our build scripts for the x86 build were modified - this took most of the time.  Proof-of-concept was made in 1 day, and in general, about 1 man-week was spent on embedding x86 into the process, not counting testing.  For such a huge project it is very fast! <br>  The fact is that our codebase is used both on desktops and servers, and the development of the mobile version itself is mainly done under normal Linux and Windows desktops (not in the emulator, but in the usual build for these OS - thanks to Qt, we can do this very easily), so all the code is initially debugged for x86. <br><br>  <i><b>How technically implemented support for x86 and ARM versions = i.e.</b></i>  <i><b>you have separate apk or one general, how is the compilation going on (are both versions automatically compiled or is there a choice?) The same question about testing.</b></i> <br>  Separate APK.  By the way, since we switched to such a scheme, then at the same time we implemented packages optimized for ARMv7, so we got 3 packages: ARMv5, ARMv7 and x86. <br>  The auto-assembly system assembles either one version of your choice (to quickly get a fresh build), or all three at once (for acceptance testing and publishing). <br>  Acceptance testing must be carried out on at least two platforms, and the third can then be checked quickly ("smk-testing").  In fact, we have never faced the fact that some bugs were specific for some CPU ABI :) Android on x86 behaves the same way as on ARM, no incompatibilities have been found yet. <br><br>  <i><b>What does the comparison of x86 performance and power consumption with an ARM version running on the same device through a binary translator show?</b></i> <br>  We did not make a numerical comparison, because the difference is too great.  Since our application even draws the UI from the native code itself, in the broadcast mode everything worked just barely, and the power consumption just went off scale - the phone warmed up like a stove.  After compilation, 2GIS "flew", as it should - the program "rests" already in reading data from memory and screen frames (vsync), and there is now even a margin for processor power.  The gain in speed and energy consumption compared to the translator is about an order of magnitude. </div><p>Source: <a href="https://habr.com/ru/post/205622/">https://habr.com/ru/post/205622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../205608/index.html">Why switch to DDR4?</a></li>
<li><a href="../205612/index.html">How SmartTV forgot about the main thing</a></li>
<li><a href="../205614/index.html">How to "send" the client</a></li>
<li><a href="../205616/index.html">Stop being cute and smart</a></li>
<li><a href="../205620/index.html">Using SQLite in Android development. Tips and tricks</a></li>
<li><a href="../205626/index.html">Python for microcontrollers</a></li>
<li><a href="../205636/index.html">Central Bank of Russia approved the official sign of the ruble</a></li>
<li><a href="../205638/index.html">Xperia and KitKat</a></li>
<li><a href="../205642/index.html">Barack Obama calls on all Americans to learn programming</a></li>
<li><a href="../205644/index.html">Nokia DVLUP comes to Habrahabr</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>