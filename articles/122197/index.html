<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>2d on unity3d</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At one time, at the beginning of the development of a two-dimensional game on Unity3d, I had to search through a bunch of documentation, websites, rea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>2d on unity3d</h1><div class="post__text post__text-html js-mediator-article">  At one time, at the beginning of the development of a two-dimensional game on Unity3d, I had to search through a bunch of documentation, websites, <a href="http://answers.unity3d.com/">read the answers.unity3d.com</a> and <a href="http://forum.unity3d.com/">forum.unity3d.com</a> on the topic: how to make a 2d game on this 3d engine.  The very first questions were: how to properly configure the camera, how to make a 2d sprite so that it displays the texture ‚Äúpixel to pixel‚Äù.  At that time, <i><a href="http://www.unifycommunity.com/wiki/index.php%3Ftitle%3DSpriteManager">SpriteManager</a></i> (hereinafter <i>SM</i> ) and even <i><a href="http://www.anbsoft.com/middleware/sm2">SM2</a></i> with its powerful editor support already existed.  The fate was such that I could not buy it then, and there was no trial version either.  As a result, I had to write some useful scripts for implementing 2d on <i>Unity3d myself</i> .  How to do this will be discussed in this article. <br><br><img src="https://habrastorage.org/storage2/825/b1e/b10/825b1eb10be6c0ab8bad3e642e4307ae.png">  " <br><a name="habracut"></a><br><h1>  Information sources </h1><br>  Immediately I will write about some useful information sources on <i>Unity3d</i> for those who are not familiar with the engine at all, or are just starting to get acquainted with it. <br><ul><li>  <a href="http://unity3d.com/">Unity3d.com</a> - the official website of the engine.  Here pages will be useful: <br><ul><li>  <a href="http://unity3d.com/support/documentation/Manual/index.html">Unity User Manual</a> - the official user manual.  Start exploring here. </li><li>  <a href="http://unity3d.com/support/documentation/Components/index.html">Unity Reference Manual</a> - more in-depth study. </li><li>  <a href="http://unity3d.com/support/documentation/ScriptReference/index.html">Scripting Reference</a> - here everything is in the <i>Unity3d</i> library for all three supported languages ‚Äã‚Äã(Boo, JavaScript and C #). </li><li>  <a href="http://unity3d.com/support/resources/">Unity Resources</a> - here you can find video tutorials, examples, presentations. </li><li>  <a href="http://answers.unity3d.com/">Unity Answers</a> - here they will answer your questions, or you can find a ready answer.  Often used this resource. </li><li>  <a href="http://forum.unity3d.com/">Unity Community</a> - forum. </li></ul></li><li>  <a href="http://unity3d.ru/">Unity3d in Russian</a> - site of Unity3d developers in Russian.  If you do not care with English, there are manuals in Russian, and on the forum you can get answers to your questions. </li><li>  <a href="http://www.unifycommunity.com/wiki/index.php%3Ftitle%3DMain_Page">The Unity3d Wiki</a> is a very useful resource.  There are many recommendations, free useful scripts. </li></ul>  Also, after installing <i>Unity3d</i> , local versions of manuals and videos will appear on your computer.  When you first start, you can select them from the welcome window or find them in the <b>Help</b> menu. <br><br><img src="https://habrastorage.org/storage2/442/aff/f26/442afff262b702272e2aab29ea6f28d7.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  What is needed </h1><br>  The version of the engine used is 3.3, all code is written in C # and will work on all Unity licenses.  Just <a href="http://unity3d.com/unity/download/">download the free version of Unity</a> .  Included is <i><a href="http://www.monodevelop.com/">MonoDevelop</a></i> - a free .NET development environment (in case you do not have <i>Visual Studio</i> ).  The environment is easily customizable, it has everything you need for development, supports convenient features such as autocompletion, code substitution patterns, and much more.  I myself use <i>Visual Studio</i> in conjunction with <i><a href="http://www.jetbrains.com/resharper/">Resharper</a></i> - it's more convenient.  Unity Editor supports both environments. <br><br><h4>  Code Terms </h4><br>  I wrote the code from scratch right at the time of writing this article, so you should have no problems repeating my steps.  The code can be freely used, edited, improved. <br><br>  <i><b>The condition is only one thing</b></i> : when using a code (including a modified one) in a commercial project, you must specify a link to the author (that is, <a href="https://habrahabr.ru/users/fischer/" class="user_link">fischer</a> - me). <br><br>  The code of the example used in the article can be downloaded <a href="">from here</a> . <br><br><h1>  Camera setup </h1><br>  First, create an empty scene with no objects.  Remove the <b>default</b> added <b>MainCamera</b> object. <br><br>  You need to configure the camera so that it becomes "suitable" for 2d.  In Unity, a camera is the class <i><a href="http://unity3d.com/support/documentation/ScriptReference/Camera.html">Camera</a></i> .  In order to use it, you need: <br><ol><li>  Create an empty object ( <b>GameObject -&gt; Create Empty</b> ). </li><li>  Select it and add a <i>Camera</i> component to it ( <b>Component -&gt; Rendering -&gt; Camera</b> ). </li></ol>  Initially, the camera is perpendicular to the XOY plane and directed along the Z axis in the positive direction.  In the future, for simplicity, the sprites will lie in the XOY plane and towards the camera, so place the camera in the center of coordinates and move it along the Z axis at the required distance into the negative half-space (say, at the point [0, 0, -100]). <br><br>  For 2d-graphics, the position of the sprites in space is not important.  Much more important, how sprites overlap each other.  The camera supports two modes (types of projection): perspective ( <b>Perspective</b> ) and orthogonal ( <b>Orthographic</b> ).  The first is used in all 3d games: objects located farther from the camera look smaller.  This is almost the way we see our world.  We need the second mode, <b>Orthographic</b> - objects are always drawn real size and overlap depending on the distance to the camera.  Perfect camera mode for 2d and isometric.  In the <b>Inspector</b> window in the <b>Camera</b> component of the newly created object, in the <b>Projection</b> field, select <b>Orthographic</b> .  However, some parameters (corresponding to the <b>Perspective</b> mode) will disappear, but the <b>Size</b> parameter will appear - the size of the orthogonal camera. <br><br><img src="https://habrastorage.org/storage2/365/dc9/f33/365dc9f33d6f781a2363af7071774193.png"><br><br>  Now we will configure the camera so that each pixel on the screen corresponds to one unit (unit) of space in Unity.  In the future, it will be convenient when moving sprites and setting their sizes in pixels.  For this, the size of the orthogonal camera ( <b>Size</b> parameter) must be equal to half the height of the screen in pixels.  For example, if this is an iPhone 3G screen in portrait mode, the screen resolution of which is 320x480, then <i>Size = h / 2 = 480/2 = 240</i> . <br><br>  In order not to do all this manually each time, we will write a script: <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [ExecuteInEditMode] [RequireComponent(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Camera))] <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Ortho2dCamera</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> uniform = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> autoSetUniform = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { camera.orthographic = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uniform) SetUniform(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LateUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (autoSetUniform &amp;&amp; uniform) SetUniform(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetUniform</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> orthographicSize = camera.pixelHeight/<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (orthographicSize != camera.orthographicSize) camera.orthographicSize = orthographicSize; } }</code> </pre> <br>  If you add this script to any game object ( <b>GameObject</b> ), then: <br><ol><li>  Automatically this object will be added to the <b>Camera</b> component.  The <i><a href="http://unity3d.com/support/documentation/ScriptReference/RequireComponent.html">RequireComponent</a></i> attribute is responsible for this. </li><li>  The <i><a href="http://unity3d.com/support/documentation/ScriptReference/MonoBehaviour.Awake.html">Awake</a></i> function will execute.  The attribute responsible for this is the <i><a href="http://unity3d.com/support/documentation/ScriptReference/ExecuteInEditMode.html">ExecuteInEditMode</a></i> attribute, which forces the execution of scripts directly in the editor. </li><li>  As a result of calling this function, the camera will become orthogonal. </li><li>  Its size will be set so that one pixel on the screen corresponds to one Unity unit (a call to the <i>SetUniform</i> function).  This will be done automatically for any screen. </li></ol>  Now the camera should look like this: <br><br><img src="https://habrastorage.org/storage2/c49/c3f/fb6/c49c3ffb68d8bf1d20766cac3fc17009.png"><br><br><h4>  Improvements </h4><br><ol><li>  If the screen size can change at run time (rotate the screen of the smartphone, change the resolution of the user), it would be nice to automatically resize the camera.  This can be done in the <i><a href="http://unity3d.com/support/documentation/ScriptReference/MonoBehaviour.LateUpdate.html">LateUpdate</a></i> function. </li><li>  If the lighting will not be used (as happens in most 2d games), I recommend setting the <b>Rendering Path</b> parameter to <b>Vertex Lit</b> in the settings of the project ( <b>File-&gt; Build Settings-&gt; Player Settings-&gt; Other Settings</b> ).  This is the easiest way to draw objects (each object in one step for all light sources), supported by most devices.  In my case for iOS devices, this gave a performance leap.  The same can be done for a particular camera.  By default, the camera uses the value from the <b>Player Settings</b> . </li></ol><br><h1>  Sprite </h1><br>  Sprite - a rectangle with a texture superimposed on it.  We agree that it will by default be located in the XOY plane.  Then for the mutual arrangement of the sprites (layers) will be responsible for the Z coordinate. <br><br>  <b><i>Hint</i></b> : in order to make it easier to see the sprites, you can rotate the coordinate axis by clicking on the axes of the scene, in the upper right, until they take their proper form (in our case, the position is <b>Back</b> ). <br><br><img src="https://habrastorage.org/storage2/15d/9d8/280/15d9d8280953f32e7ecd667aebb20979.png"><br><br>  The sprite will be set by several parameters: <br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">SerializeField</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector2 size = Vector2.one; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector2 zero = Vector2.one / <span class="hljs-number"><span class="hljs-number">2</span></span>; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Rect textureCoords = Rect.MinMaxRect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> pixelCorrect = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</code> </pre><br>  Decipher them: <br><ul><li>  <i>zero</i> - the position of the zero point of the sprite relative to its lower left corner.  Measured in fractions of a sprite, i.e.  (0.5, 0.5) is the center of the sprite.  It is necessary for the correct displacement of the sprite, regardless of how it is located on the texture. <br>  <b><i>Hint</i></b> : in order to see the rotation / movement axes on the sprite in the editor at the zero point, and not in the center (by default), you need to select <b>Pivot</b> on the <b>Transform Gizmo Toggles control</b> toolbar. <br><br><img src="https://habrastorage.org/storage2/b5f/e91/c94/b5fe91c944b35ee4dfd264f3472a5d13.png"></li><li>  <i>textureCoords</i> - texture coordinates.  These are the coordinates of the upper left corner and the size of the area on the texture.  Measured in the same way as in OpenGL - in fractions of texture.  For each texture, a parameter is set that indicates whether the coordinates will be trimmed when exiting the [0, 1] segment, or the texture will be repeated (texture import parameter <b>Wrap Mode</b> ). </li><li>  <i>pixelCorrect</i> - a boolean value, means whether the sprite will be displayed ‚Äúpixel to pixel‚Äù, so that each pixel on the sprite corresponds to a pixel on the screen. </li></ul>  To display the rectangle, we will use an object of the <i><a href="http://unity3d.com/support/documentation/ScriptReference/Mesh.html">Mesh</a></i> class.  In the simplest case, it is initialized: <br><ol><li>  list of vertices </li><li>  a list of indexes of the vertices that make up the vertices of the triangles that make up the rectangle, </li><li>  a list of texture coordinates corresponding to the vertices. </li></ol><br>  Given the parameters of the sprite mentioned above, an object of the <i>Mesh</i> class will be created as follows: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Mesh </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateMesh</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 size, Vector2 zero, Rect textureCoords</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vertices = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-comment"><span class="hljs-comment">// 1 ___ 2 new Vector3(0, size.y, 0), // | | new Vector3(size.x, size.y, 0),// | | new Vector3(size.x, 0, 0) // 0 ---- 3 }; Vector3 shift = Vector2.Scale(zero, size); for (int i = 0; i &lt; vertices.Length; i++) { vertices[i] -= shift; } var uv = new[] { new Vector2(textureCoords.xMin, 1 - textureCoords.yMax), new Vector2(textureCoords.xMin, 1 - textureCoords.yMin), new Vector2(textureCoords.xMax, 1 - textureCoords.yMin), new Vector2(textureCoords.xMax, 1 - textureCoords.yMax) }; var triangles = new[] { 0, 1, 2, 0, 2, 3 }; return new Mesh { vertices = vertices, uv = uv, triangles = triangles }; }</span></span></code> </pre><br>  To draw a mesh, you need the <i><a href="http://unity3d.com/support/documentation/ScriptReference/MeshRenderer.html">MeshRenderer</a></i> and <i><a href="http://unity3d.com/support/documentation/ScriptReference/MeshFilter.html">MeshFilter components</a></i> .  The first component contains links to the material textures for the sprite.  The second one contains the <i><a href="http://unity3d.com/support/documentation/ScriptReference/MeshFilter-mesh.html">MeshFilter.mesh</a></i> object, which it draws.  To change the sprite, you need to change this object accordingly.  The sprite itself is implemented through the <i>SampleSprite</i> component.  In order for the sprite to always have these two components, add the corresponding <i><a href="http://unity3d.com/support/documentation/ScriptReference/RequireComponent.html">RequireComponent</a></i> attributes to <i><a href="http://unity3d.com/support/documentation/ScriptReference/RequireComponent.html">it</a></i> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [ExecuteInEditMode] [AddComponentMenu(<span class="hljs-string"><span class="hljs-string">"Sprites/Sample Sprite"</span></span>)] [RequireComponent (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(MeshFilter))] [RequireComponent (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(MeshRenderer))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SampleSprite</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { ‚Ä¶ }</code> </pre><br>  The <i><a href="http://unity3d.com/support/documentation/ScriptReference/AddComponentMenu.html">AddComponentMenu</a></i> attribute adds <b>Sprites-&gt; Sample Sprite to the</b> <b>Component</b> menu of the editor.  Using it you can add our <b>SampleSprite</b> component to any Unity object. <br><br><img src="http://habrastorage.org/storage2/3bd/f45/f63/3bdf45f63cc21141c754c288c4280e38.png"><br><br>  In order to be able to see the sprite during editing, the <i><a href="http://unity3d.com/support/documentation/ScriptReference/ExecuteInEditMode.html">ExecuteInEditMode</a></i> attribute allows <i><a href="http://unity3d.com/support/documentation/ScriptReference/ExecuteInEditMode.html">you</a></i> to call the <i>Awake</i> and <i><a href="http://unity3d.com/support/documentation/ScriptReference/MonoBehaviour.Start.html">Start</a></i> functions of the <i>SampleSprite</i> class directly in the editor.  A mesh is created inside these functions: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MeshFilter meshFilter; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MeshRenderer meshRenderer; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> Unity messages // Use this for initialization private void Awake() { meshFilter = GetComponent&lt;MeshFilter&gt;(); meshRenderer = GetComponent&lt;MeshRenderer&gt;(); } private void Start() { // NOTE: initializing mesh here because our camera is initialized in Awake() InitializeMesh(); } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span></span></code> </pre><br>  When initializing the mesh, the <i>pixelCorrect</i> flag must be taken into account.  Check how many times the screen height differs from the size of the camera ‚Äî we need to increase the mesh so many times, considering that in the normal version (the screen height is twice the size of the orthogonal camera), the mesh size is equal to the size of the texture area for the sprite: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeMesh</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Camera cam = Camera.main; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pixelCorrect &amp;&amp; cam != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ratio = cam.pixelHeight / (<span class="hljs-number"><span class="hljs-number">2</span></span> * cam.orthographicSize); size.x = NonNormalizedTextureCoords.width * ratio; size.y = NonNormalizedTextureCoords.height * ratio; } meshFilter.mesh = CreateMesh(size, zero, textureCoords); }</code> </pre><br>  <i>NonNormalizedTextureCoords</i> - texture coordinates in pixels.  Determined by the normalized texture coordinates (sprite parameter) and the size of the <i>textureSize itself</i> : <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Rect NonNormalizedTextureCoords { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { Rect coords = textureCoords; Vector2 texSize = TextureSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (texSize != Vector2.zero) { coords.xMin *= texSize.x; coords.xMax *= texSize.x; coords.yMin *= texSize.y; coords.yMax *= texSize.y; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> coords; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector2 TextureSize { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (meshRenderer == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Vector2.zero; Material mat = meshRenderer.sharedMaterial; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mat == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Vector2.zero; Texture tex = mat.mainTexture; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tex == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Vector2.zero; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(tex.width, tex.height); } }</code> </pre><br>  Notice that the mesh is initialized in the <i>Start</i> function, because when it is initialized, information from the camera is used, and it is initialized by us in <i>Awake</i> , i.e.  in <i>Start,</i> such information is already available for other objects (in Unity, all <i>Awake is</i> called first, then all <i>Start</i> , but the order of calling the same function for different objects is not defined).  Also in this example, <i><a href="http://unity3d.com/support/documentation/ScriptReference/Camera-main.html">Camera.main</a></i> is used - the main camera on the scene.  Those.  Our camera should be tagged with <b>MainCamera</b> . <br><br><img src="http://habrastorage.org/storage2/60c/c12/1d7/60cc121d77b1a54561fe5fff21b8fe5f.png"><br><br>  In principle, at this stage it is already possible to work with the sprite.  To do this, you need to attach a <b>SampleSprite</b> component to any object (for example, through the <b>Component</b> menu or by dragging a script file to it).  <b>MeshFilter</b> and <b>MeshRenderer</b> components will automatically be added to it.  Now if you drag a texture material (or texture, and the material is created automatically) to this object, and adjust the parameters, then you can see the finished 2D image. <br><br><img src="http://habrastorage.org/storage2/a82/8a7/b08/a828a7b0881604fcdb67b98298a7c500.png"><br><br><h4>  Texture Settings </h4><br>  To correctly display the sprite, you need to change the following parameters in the texture properties: <br><ol><li>  to make the sprite's movement smooth, so that when resizing the sprite looks smooth, you need to set the texture export parameter <b>Filter Mode</b> to <b>Bilinear</b> or <b>Trilinear</b> ); </li><li>  set <b>Texture Type</b> to <b>GUI</b> ; </li><li>  do not forget to remove compression by setting the value of the <b>Format</b> parameter to <b>Truecolor</b> . </li></ol><br><img src="http://habrastorage.org/storage2/279/f2c/062/279f2c0622f099c25e631daa7d729001.png"><br><br><h4>  Lighting </h4><br>  Usually lighting is not used in 2d games.  These effects are predefined by texture artists, particle systems, and other means.  In addition, the lighting affects the rendering speed.  Therefore, in the case of sprites for the materials used, you must select the appropriate shader: <br><ol><li>  In version 3.3 there is a group of <b>Unlit</b> shaders with disabled lighting.  For sprites with transparency, the <b>Unlit-&gt; Transparent</b> shader is <b>suitable</b> ; for the background, <b>Unlit-&gt; Texture</b> . </li><li>  In older versions of Unity, you can use the <b>Transparent-&gt; Diffuse</b> shader.  But then you need not to forget in <b>Edit-&gt; Render Settings to</b> put down <b>Ambient Light</b> in white so that all the sprites are of natural color.  Otherwise they will be blacked out, because by default <b>Ambient Light has a</b> shade of gray. </li><li>  You can write your shader in which the lighting will be turned off.  How to do this can be found in the <a href="http://unity3d.com/support/documentation/Components/SL-Reference.html">official manual on Unity shaders</a> . </li></ol><br><h1>  Using editor features </h1><br>  Unity allows you to extend the editor.  For this purpose, for example: <br><ol><li>  <b>EditorOnly</b> tag. </li><li>  Creating game object editors in the <b>Component Inspector</b> by inheriting from the <i><a href="http://unity3d.com/support/documentation/ScriptReference/Editor.html">Editor</a></i> class. </li><li>  Creating editor windows by inheriting from the class <i><a href="http://unity3d.com/support/documentation/ScriptReference/EditorWindow.html">EditorWindow</a></i> . </li></ol><br>  You can allow the user to set some parameters of the sprite in more convenient units and immediately see the result.  For example, the zero point is best kept normalized, because  if the size of the object on the texture changes, then it will not need to be corrected with pens.  But it is more convenient to set it in the editor in pixels in order to represent how it will be located relative to the size of the sprite.  For all these needs, this is the implementation of the <i>Editor</i> class: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEditor; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [CustomEditor(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(SampleSprite))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SampleSpriteEditor</span></span> : <span class="hljs-title"><span class="hljs-title">Editor</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnInspectorGUI</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Target.Size = EditorGUILayout.Vector2Field(<span class="hljs-string"><span class="hljs-string">"Size"</span></span>, Target.Size); Target.Zero = EditorGUILayout.Vector2Field(<span class="hljs-string"><span class="hljs-string">"Zero Point"</span></span>, Target.Zero); Target.TextureCoords = EditorGUILayout.RectField(<span class="hljs-string"><span class="hljs-string">"Texture Coordinates"</span></span>, Target.TextureCoords); Target.PixelCorrect = EditorGUILayout.Toggle(<span class="hljs-string"><span class="hljs-string">"Pixel Correct"</span></span>, Target.PixelCorrect); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GUI.changed) { Target.UpdateMesh(); EditorUtility.SetDirty(target); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SampleSprite Target { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> SampleSprite; } } [MenuItem(<span class="hljs-string"><span class="hljs-string">"Sprites/Create/Sample"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateSprite</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gameObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GameObject(<span class="hljs-string"><span class="hljs-string">"New Sample Sprite"</span></span>); gameObject.AddComponent&lt;SampleSprite&gt;(); Selection.activeObject = gameObject; } }</code> </pre>  <b><i>Note</i></b> : all scripts associated with the editor should be located in the <b>Assets / Editor</b> folder. <br><br>  The <i><a href="http://unity3d.com/support/documentation/ScriptReference/CustomEditor.html">CustomEditor</a></i> attribute says that this class will be used in the <b>Component Inspector</b> as an editor for the <i>SampleSprite</i> component <i>class</i> .  The <i>Target</i> property is entered for easy reference to the fields of the edited object, since  the default <i><a href="http://unity3d.com/support/documentation/ScriptReference/Editor-target.html">target</a></i> object is of type <i><a href="http://unity3d.com/support/documentation/ScriptReference/Object.html">Object</a></i> .  In the overridden <i><a href="http://unity3d.com/support/documentation/ScriptReference/Editor.OnInspectorGUI.html">OnInspectorGUI</a></i> function, a list of <i>SampleSprite</i> component <i>parameters</i> is displayed that are displayed in the <b>Inspector</b> .  If at least one of these parameters changes ( <i><a href="http://unity3d.com/support/documentation/ScriptReference/GUI-changed.html">GUI.changed</a></i> ), the sprite will be updated, and we will see the result of the change on the screen, and the modified parameters of the sprite will be saved ( <i><a href="http://unity3d.com/support/documentation/ScriptReference/EditorUtility.SetDirty.html">EditorUtility.SetDirty</a></i> ). <br><br>  Editable parameters will be added to the <i>SampleSprite</i> class and we will make them conditionally compiled (so that this code does not get into the final product, but only works in the editor): <br><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_EDITOR public Vector2 Size { get { return size; } set { size = value; } } public Vector2 Zero { get { return Vector2.Scale(zero, size); } set { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (size.x != 0 &amp;&amp; size.y != 0) { zero = new Vector2(value.x / size.x, value.y / size.y); } } } public Rect TextureCoords { get { return NonNormalizedTextureCoords; } set { textureCoords = value; Vector2 texSize = TextureSize; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (texSize != Vector2.zero) { textureCoords.xMin /= texSize.x; textureCoords.xMax /= texSize.x; textureCoords.yMin /= texSize.y; textureCoords.yMax /= texSize.y; } } } public bool PixelCorrect { get { return pixelCorrect; } set { pixelCorrect = value; } } public void UpdateMesh() { InitializeMesh(); } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre><br>  In this case, the <i>Zero</i> parameter is measured in the same units as <i>size</i> , and <i>TextureCoords</i> is <i>measured</i> in pixels of the texture. <br><br><h1>  Optimization, improvements and more </h1><br><h4>  Reduce Draw Calls </h4><br>  There are several ways to do this. <br><ol><li>  <i>Static batching</i> .  If the object never changes, then it can be marked as static (the <b>Static</b> checkbox in the <b>Inspector</b> ).  All such objects will be combined into one large and will be drawn for one Draw Call.  Unfortunately, the <i>static batching feature</i> is only available in the Unity Pro version. </li><li>  <i>Dynamic batching</i> .  If several objects use the same material, Unity combines them into one before drawing, and all of them will be drawn in one Draw Call.  To achieve this effect, textures need to be combined into an atlas ‚Äî one large texture.  Use atlases - they allow you to reduce both the amount of Draw Call (due to <i>dynamic batching</i> ) and the amount of memory occupied by textures (which is very important for mobile platforms). <br>  <b><i>Tip</i></b> : enabling / disabling <i>batching views</i> for some platforms is done in <b>File-&gt; Build Settings-&gt; Player Settings</b> . </li><li>  Sprite manager.  One of the implementations is <i><a href="http://www.unifycommunity.com/wiki/index.php%3Ftitle%3DSpriteManager">SpriteManager</a></i> .  The sprite is added to the sprite manager, which uses one atlas texture (in the <i>MeshRenderer</i> component), and creates a mesh (in the <i>MeshFilter</i> component) for the sprites, consisting of many rectangles, one for each sprite (for this implementation, the author screwed the convenience of the editor and got <i><a href="http://www.anbsoft.com/middleware/sm2">SM2</a></i> ).  You can also improve the sprite manager by setting the sprite to refer to the material used, store all materials in the <i>MeshRenderer</i> component of the <i>sprites</i> manager, and draw the mesh as a collection of smaller meshes (one per material) using the capabilities of <i><a href="http://unity3d.com/support/documentation/ScriptReference/Mesh.CombineMeshes.html">Mesh.CombineMeshes</a></i> , <i><a href="http://unity3d.com/support/documentation/ScriptReference/Mesh.SetTriangles.html">Mesh.SetTriangles</a></i> , <i><a href="http://unity3d.com/support/documentation/ScriptReference/Mesh.GetTriangles.html">Mesh. GetTriangles</a></i> , <i><a href="http://unity3d.com/support/documentation/ScriptReference/Mesh-subMeshCount.html">Mesh.subMeshCount</a></i> .  This will allow not to start for each material on the manager of the sprites. </li></ol><h4>  Some code improvements </h4><ol><li>  Of course, it is better to get rid of the constant call to the <i>CreateMesh</i> function, which leads to the creation of a new mesh (in this case, this is not essential, since everything happens in the editor, but in a real application a sprite will be created once and will not change anymore).  Instead, it is enough to change the parameters <i><a href="http://unity3d.com/support/documentation/ScriptReference/Mesh-vertices.html">Mesh.vertices</a></i> , <i><a href="http://unity3d.com/support/documentation/ScriptReference/Mesh-uv.html">Mesh.uv</a></i> , <i><a href="http://unity3d.com/support/documentation/ScriptReference/Mesh-triangles.html">Mesh.triangles</a></i> .  Do not forget to call <i><a href="http://unity3d.com/support/documentation/ScriptReference/Mesh.RecalculateBounds.html">mesh.RecalculateBounds ()</a></i> if the vertices <i>vertices</i> array has been modified.  If the <i>triangles</i> array is changed, this function will be called automatically. </li><li>  Instead of <i>Camera.main,</i> it is better to set the camera as a script parameter. </li></ol><br><h4>  How to do animations </h4><br>  How to make full sprite animations can be seen on the example of <a href="http://www.unifycommunity.com/wiki/index.php%3Ftitle%3DSpriteManager"><i>SpriteManager</i></a> . <br>  There were no sprite animations in our game <a href="http://www.ideal-b.ru/russian/">Papa Penguin</a> .  Instead, for example, the penguin was fastened from the parts at the zero points of the sprites, and the movement of these parts was carried out using the <b><a href="http://unity3d.com/support/documentation/ScriptReference/Animation.html">Animation</a></b> component.  That was enough.  Unity is a very powerful tool.  In the animation, for example, you can even insert function calls from scripts. <br><br><img src="http://habrastorage.org/storage2/545/072/da5/545072da500256af4fbb4ecc16980b75.png"><br><br><h4>  2d physics </h4><br>  You can attach a <i><a href="http://unity3d.com/support/documentation/ScriptReference/Collider.html">Collider</a></i> component to any sprite: <b>Component-&gt; Physics-&gt; BoxCollider</b> for rectangular objects and <b>Component-&gt; Physics-&gt; SphereCollider</b> for spherical objects.  These components can be used for two purposes: <br><ol><li>  Make an object a trigger (checkbox <b>Is Trigger</b> ). </li><li>  Allow the object to be physically affected.  To do this, you can additionally attach the <b>Component-&gt; Physics-&gt; Rigidbody</b> component to the object. </li></ol>  Using <b>Rigidbody,</b> you can limit the physics of an object to two dimensions: the component has the parameter <b>Constraints</b> .  It is necessary to limit the movement of the object along the Z axis by <b>ticking the Rigidbody-&gt; Constraints-&gt; Freeze Position-&gt; Z</b> , and limit the rotation along the X and Y axes ( <b>Freeze Rotation-&gt; X</b> and <b>Freeze Rotation-&gt; Y</b> ). <br><br><img src="http://habrastorage.org/storage2/4a3/497/0fd/4a34970fd9470c0d788726ca2b2b83a8.png"><br><br>  Physics <i>Unity3d</i> also offers other rich features: forces applied to specific points of an object, gravity, and fixed points ( <b>Fixed Joint</b> , <b>Spring Joint</b> ).  Using all this, you can create a good game based on physics. <br><br><h1>  Alternatives </h1><br><ol><li>  <a href="http://ezsprite.com/">EZSprite</a> is a simple paid system for creating 2d animations in Unity (at the time of this writing, the plugin was $ 35). </li><li>  <a href="http://www.unifycommunity.com/wiki/index.php%3Ftitle%3DSpriteManager">SpriteManager</a> - class system for creating sprite animations.  Supports drawing sprites for one Draw Call, the manager of sprites, animations and atlases.  Pretty inconvenient to set up, but if the budget is limited, it is quite suitable for use. </li><li>  <a href="http://www.anbsoft.com/middleware/sm2">SM2</a> (Sprite Manager 2) - paid sprite manager with editor support.  It supports many useful features in addition to the free version: creating atlases, using the features of the editor to highlight the texture area, automatically creating animations, and more.  If you do not want to implement sprites manually, then SM2, in my opinion, is the best choice.  Worth $ 150 with a 60-day opportunity to get money back if you don't like it. </li><li>  <a href="http://forum.unity3d.com/threads/86772-RageSpline-Create-smooth-2D-graphics-inside-Unity-Editor-RELEASED%3Fhighlight%3D2d%2Bsprite">RageSpline</a> , $ 50.  This plugin is not really sprite, but rather a vector.  The plugin has many interesting features: <br><ul><li>  creating 2d meshes and lines based on Bezier curves; </li><li>  contours of objects of various widths; </li><li>  single color fill / gradient; </li><li>  textured objects; </li><li>  and much more. </li></ul></li></ol><br><h1>  Conclusion </h1><br>  All that I have written about is quite enough for writing my 2d system and its subsequent use in creating a two-dimensional game.  The three-dimensionality of the engine and the support of physics offer us new rich possibilities, and the high speed of development at Unity (which is a great advantage of the engine) will reduce costs. <br><br>  PS Who cares, read my previous posts: <a href="http://habrahabr.ru/blogs/gdev/117564/">Playing for two days</a> and <a href="http://habrahabr.ru/blogs/gdev/120361/">How to make a promo video of the game with small forces</a> .  My next article will be about <a href="http://habrahabr.ru/post/169451/">optimization in Unity</a> .  When developing games for Unity, I have repeatedly encountered the need for optimization and want to share with you my experience in this matter. </div><p>Source: <a href="https://habr.com/ru/post/122197/">https://habr.com/ru/post/122197/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122189/index.html">The site of the governor of the Sverdlovsk region is available at Creative Commons Attribution</a></li>
<li><a href="../122190/index.html">Online project environment: solution. Part 1</a></li>
<li><a href="../122191/index.html">Ruble sign on the website: express method</a></li>
<li><a href="../122192/index.html">Three weeks with Acer Iconia Smart</a></li>
<li><a href="../122195/index.html">Symfony in Russian</a></li>
<li><a href="../122198/index.html">Group work with the project and task manager 42tasks.com. Visually</a></li>
<li><a href="../122199/index.html">20 years in Russia. Report from Skolkovo</a></li>
<li><a href="../122200/index.html">Experienced trivia-5, or "Group joy!"</a></li>
<li><a href="../122205/index.html">Brain computer interface. Part Three Weekdays</a></li>
<li><a href="../122209/index.html">Streaming is increasing in the US</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>