<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I participated in the competition of small games js13kGames</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Programming contests are widely accepted and welcome to write post-amtems. No funeral: in fact, this essay on "What I learned while participating in t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I participated in the competition of small games js13kGames</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b42/c18/8cd/b42c188cdf2548ed8d0693e8796d0c1a.png"><br><br>  Programming contests are widely accepted and welcome to write post-amtems.  No funeral: in fact, this essay on "What I learned while participating in the competition." <br>  Contest of small games on javascript <a href="http://js13kgames.com/">js13kGames is</a> not an exception, and I would like to share with Habr the accumulated feelings of a novice igrodel. <br><br>  <i>(For those who want to play, but do not want to read revelations, here is a <a href="http://js13kgames.com/entries/quintessence">link to the game</a> .)</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h2>  To start the contest itself </h2><br>  Habrayuser <a href="https://habrahabr.ru/users/printf/" class="user_link">printf</a> in <a href="http://habrahabr.ru/post/236713/">his post-mortem</a> already described it, but for completeness I will repeat: <br>  You need to write a game on js, which after packing in zip will take no more than 13 kilobytes (more precisely ‚Äúkibibayt‚Äù will be, but not everyone is used to this unit).  Of course, no resources connected from the outside. <br><br>  By the way, it turned out that 13 kb in zip for lovers of <a href="http://habrahabr.ru/post/202944/">code golf</a> is just a huge amount of space.  Looking ahead, I can say that out of 13 kb, I managed to use only a little more than 8, which is why I still have a very unpleasant sediment - the <i>game is unfinished, it was necessary to try better, the place allows, me-me-me! ...</i>  But that was later, and now to the very beginning. <br><br><h2>  Month before the contest </h2><br>  Yes, the work began already then.  But rather, research and coordination.  I (Russia), Maxime Euziere (France) and Jim Herrero (USA) had previously worked together on small golf projects.  Well, they decided to cut the game together. <br><br>  Neither the format of the game, nor the subject is known yet.  It is only known that the game will be zipped, and the ZIP can be compressed better or worse.  Were sluggish tests of the effectiveness of various ways of archiving, on which platforms and in which unpackers they are supported, and how to write code under zip in general.  A summary of the work done is on <a href="https://gist.github.com/subzey/b18c482922cd17693d65">gist.github.com</a> <i>(in English)</i> .  In short: Deflate compression is normally supported. <br><br>  And now a little about the fact that the report did not fall (but lay on the surface).  With a deflate, you can turn to the full and attach <a href="https://code.google.com/p/zopfli/">zopfli</a> !  I generally like to apply zopfli to different things.  As it turned out, I didn‚Äôt even have to write my bikes to optimize the zip (although I wrote them essno) - there is a chic, ready-made AdvZip repacker.  Only ts-ss! <br><br>  So, we armed ourselves in advance waiting for the start of the competition and the announcement of the topic. <br><br><h2>  "Elements: earth, water, air and fire" </h2><br>  That was the theme.  In skype began brainstorm.  Various options were offered - from running with obstacles ( <a href="http://js13kgames.com/entries/turtles-cant-skate">Turtles Can't Skate is</a> strikingly similar in mechanics to what was discussed) to a game like Lemming ( <a href="http://js13kgames.com/entries/pest-control-weasels">again, we were not alone with this idea</a> ).  But in the end (on day 3 or 4) it was decided to do something like Bejeweled. <br><br>  And then the seams: Maxim decided to quit his job and move to another city.  He could not take an active part in writing the code, and it was assumed that he would help in golfing - reducing the size of the code.  Which, by the way, was not even useful.  But his thoughts, suggestions and algorithms helped me a lot, and he fully deserves the mention in ‚Äúcredits‚Äù.  All the same, one head is good, but two is better.  ‚ÄúTwo‚Äù - because Jim dumped immediately after the brainstorm in an unknown direction for reasons unknown to me. <br><br>  Managing programmers is the same as feeding cats.  And if they are on different sides of the globe - here finally can pipets. <br><br><h2>  Development </h2><br>  So, the idea is simple: there are tiles on the board (tiles) that can be combined.  We unite Water and Earth, we receive Dirt.  We collect at a tile with dirt in a row, they disappear, and points are added.  Further, the mud can not be combined again with water and earth, otherwise the number of options just rolls over, and the player is unlikely to figure out sometime in this table of alchemical elements. <br><br><h3>  Tiles </h3><br>  To begin with, we generate the tiles ourselves: a form, a light sandy <code>Math.random()</code> from <code>Math.random()</code> out.  For each tile, this texture is created anew so that there is no ‚Äúbattery effect‚Äù when the eye subconsciously begins to find similar elements.  By the way, tiles and favykon after each page load are slightly different. <br><br>  This all turned out to be much easier to do by manipulating the raw canvas data: <code>createImageData</code> / <code>putImageData</code> .  True, the corners of the tiles are not completely rounded - it was an early basting, when I did not know that I fit into an accessible place with a margin.  But later it seemed to me that it was even more interesting. <br><br>  From above it is drawn by Bezier curves of the icon, already by the forces and means of the API of the canvas. <br><br>  From the resulting image is created ( <code>new Image()</code> ).  It would be possible to leave it as a canvas, but it is easier to debug, and the operation of copying pixels into the canvas is faster. <br><br>  The backdrop is also generated by procedural manipulation of raw pixels.  The backdrop is a little bluish, and the tiles are yellowish, this is an old joke, widely used in pixel art: yellow seems closer.  This backdrop is placed on the canvas element as a background in css: there is no need to re-render the whole thing manually, let the browser suffer.  By the way, the Chrome debugger just suffered.  Tip: do not put in the background-image huge images in the <code>data:image/*</code> , debugger hangs well, just indecent. <br><br><h3>  Cursor Coordinate Processing </h3><br>  Well, everything is simple.  If you have ever written drag-n-drop manually, then everything is the same.  And because of the extreme dolbouty of the browser zoo, the coordinates have to be calculated as "coordinates relative to the screen minus the coordinates of the upper left corner of the element."  And this is in 2014. <br><br>  The handling of mouse and finger events is basically the same.  The only thing was that I had to silence Pointer Events so that everything worked on Windows Phone.  Yes, Windows Phone, the game was originally designed for mobile devices, and a mobile device is not just an iPad. <br><br><h3>  Render and animation </h3><br>  In simple toys, usually redrawing usually occurs via <code>setTimeout</code> / <code>setInterval</code> .  With this approach, the frame rate is low and almost constant, and the ‚Äúphysics‚Äù is processed frame by frame.  Yes, in js the timers can slip under load on the event cycle, but this can be ignored. <br><br>  But I decided to make it ‚Äúlike big boys‚Äù, and use <code>requestAnimationFrame</code> (where it is).  And this put the process of rendering and animation upside down - the frame worked at all anytime and as often as you like from 60 times per second to a couple of times per hour.  But gentlemen, this is cool.  The results are much nicer. <br><br>  The engine (if you can call it that) works as follows: there is an array of the playing field, ‚Äúmodel‚Äù.  When something in the model changes, it happens instantly, but an object defining the animation is put into the <code>blockingAnimations</code> array.  Until all the animations have completed, requestAnimationFrame is spinning constantly.  When completed, it checks whether the tiles can fall under the action of gravity, explode or disappear.  If not - do not request requestAnimationFrame, there is no need to burn the processor without the need. <br><br>  Here I want to make a small remark (if someone else is reading me): the game was calculated as casual, and the case when the user played and left it open in another tab is more than real.  And in some old Opera under Windows 98, a permanent re-render in the next tab does not cause anything but the desire to close the game.  Take care of your users, even if they are not users, but players! <br><br>  During the blocking animations, the user can not do anything - so that he does not suddenly change the state of the model.  It's simple. <br><br><h3>  Beta.  Rather, Alpha </h3><br>  Then I matured to the first public test.  Got a lot of feedback and suggestions. <br><br>  The first request is to enter points as soon as possible.  That was done. <br><br>  The second is to make all animations non-blocking.  Then I had to refuse, I am not a magician, I just learn. <br><br>  But the main thing that struck me was playing the game!  Seriously!  I gave the link to two people, and played five.  It inspired me not to quit. <br><br>  Added points, fixed terrible bugs when drawing.  It's beta time.  I spent it honestly - in people who had not seen it before.  And they all said they did not understand what to do.  I had to file "how to play" (which, it seems, was unintelligible).  This in turn added bugs when drawing.  In short, working out as it is. <br><br>  But even after ‚Äúhow to play‚Äù there were questions: explanations in English!  I had to go for a decisive step - localization.  As a result, the game has three languages ‚Äã‚Äã- English, Russian and French. <br><br><h3>  Mobile devices </h3><br>  What was ‚Äúoriginally laid‚Äù is time to pull out.  With the code, everything is gorgeous, but with the display - not very. <br><br>  First of all, meta-viewport.  This bastard does not work.  Rather, it works, but not at all as it should.  To say with it that the eran should display an area of ‚Äã‚Äãat least 750 √ó 770 is possible, but no browser will do this.  I had to specify <code>width=device-width,height=device-height</code> , and emulate it all via CSS transform (where it is supported). <br><br>  And here I was pleased with the iPad - it turns out that <code>document.documentElement.clientHeight</code> / <code>.clientWidth</code> there is always 1024. That, you see, is absolutely useless.  I had to tuck crutches specifically for the iPhone / iPad and determine through <code>window.innerHeight</code> . <br><br>  Again, another problem has surfaced - while reducing the canvas, everything looks cool, but when you increase ... ghm ... at least, so-so.  Everything is blurred and careless.  Another crutch, and the increase is made only with a factor of a multiple of 2 (decrease - with any).  And a note for the future: fixed-size canvass is the way to nowhere. <br><br><h3>  Sounds </h3><br>  A few days left.  That time was already the limiting factor, not size.  What if you add sounds? <br><br>  I did not want to take the finished lib.  Unfortunately, I am not able to do a trekker, and I am not particularly capable of writing music.  And why background music on a web page? <br><br>  Sounds are another matter.  As a basis, I took <a href="http://www.p01.org/releases/140bytes_music_softSynth/">the wav generator from p01</a> .  So that the sounds were not like Dandy or special effects from Sci-Fi of the eighties, I modified it to 16 bits and 44100 Hz.  And he began to experiment. <br><br>  For the timbre to be natural, I used <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B1%25D0%25B5%25D1%2580%25D1%2582%25D0%25BE%25D0%25BD">harmonics</a> .  It turned out to be boring, so for the amplitude of the overtones, I began to introduce hellish coefficients - sines, logarithms, exponents, and watch what comes of it.  There were funny things - from deaf clicks to the bell.  And sometimes <a href="http://codepen.io/anon/pen/gFmEI">this</a> . <br><br>  The result was something more or less adequate, and I stuck it into the game.  According to the style, sounds are not very well combined with sand-stone graphics, but I confess honestly - to choose from tons of sounds that are suitable, you need a lot of patience, and most importantly, turn off the player.  And as such a music lover, I just could not make such sacrifices. <br><br><h2>  Total </h2><br>  You know, gentlemen, indie-igrodel is interesting!  As a result, a month spent with interest, a lot of experience (and basically the format ‚Äúhad to be done differently‚Äù) and, most importantly, a working game. <br><br>  Here it is, by the way: <a href="http://js13kgames.com/entries/quintessence">Quintessence on js13kGames</a> . </div><p>Source: <a href="https://habr.com/ru/post/237127/">https://habr.com/ru/post/237127/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../237109/index.html">From analog to digital, or do it yourself IP camera</a></li>
<li><a href="../237111/index.html">Stephen Fry Pro New iPhone 6</a></li>
<li><a href="../237117/index.html">Bringing to mind the website hosting: 10 tips</a></li>
<li><a href="../237121/index.html">Libgdx: Loading Screen and Loading Encrypted Resources</a></li>
<li><a href="../237125/index.html">5 million security startup</a></li>
<li><a href="../237129/index.html">Traffic from social networks: the most modern methods of attraction, return and analysis</a></li>
<li><a href="../237131/index.html">Welcome to HadoopKitchen</a></li>
<li><a href="../237133/index.html">Why is the grass green and programmers cool</a></li>
<li><a href="../237135/index.html">Tomorrow at 10:00, see the first technology talk show about clouds - Azure Business Talks</a></li>
<li><a href="../237137/index.html">Coachman, do not drive horses or why fast backup is not always good?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>