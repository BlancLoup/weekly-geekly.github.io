<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating an interactive grass in the Unreal Engine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Until recently, grass in games was usually marked by texture on the ground, rather than by rendering individual stems. But with the increase in iron p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating an interactive grass in the Unreal Engine</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/dg/d_/sg/dgd_sg8pss1hh54majrmgysw5fi.gif"></div><br>  Until recently, grass in games was usually marked by texture on the ground, rather than by rendering individual stems.  But with the increase in iron power, it became possible to render grass.  Remarkable examples of such rendering can be seen in games like <i>Horizon Zero Dawn</i> and <i>The Legend of Zelda: Breath of the Wild</i> .  In these games, the player can roam grassy meadows, and, more importantly, the grass <i>reacts</i> to the player‚Äôs actions. <br><br>  Fortunately, creating such a system is not very difficult.  Actually, the article will teach you exactly that!  In this tutorial you will learn the following: <br><br><ul><li>  Create a vector field using scene capture and particle systems </li><li>  Bend the grass from the player based on the vector field </li></ul><a name="habracut"></a><blockquote>  <em>Note:</em> in this tutorial it is assumed that you already know the basics of working with the Unreal Engine.  If you are new to the Unreal Engine, then learn our series of tutorials from ten parts of the <a href="https://habr.com/post/344394/">Unreal Engine for beginners</a> .  In particular, look at the <a href="https://habr.com/post/345110/">particle system</a> tutorial to know how to use Cascade in this tutorial. </blockquote><blockquote>  <em>Note:</em> this tutorial belongs to a series of three tutorials on working with render targets: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <a href="https://habr.com/post/420031/">Part 1: Drawing with Render Targets</a> </li><li>  <a href="https://habr.com/post/416703/">Part 2: Warped Snow</a> </li><li>  Part 3: interactive grass </li></ul></blockquote><h2>  Getting Started </h2><br>  Let's start by downloading materials for this tutorial (you can download them <a href="">from here</a> ).  Unzip them, go to <em>InteractiveGrassStarter</em> and open <em>InteractiveGrass.uproject</em> .  You will see a small field of grass that will be the topic of this tutorial.  I also created a widget to display the render target scene capture. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fa/004/60f/8fa00460f2e914dedb752443b566d226.gif"></div><br><br>  Before you begin, you should study the tutorial <a href="https://habr.com/post/416703/">on creating footprints in the snow</a> , because I will skip some of the information.  It is worth considering that in this tutorial is also used capture and projection.  To save time, I prepared a blueprint of capture, similar to the blueprint of the tutorial on the trail in the snow. <br><br>  First, let's look at another way to create interactive grass.  The most common way is to transfer the player‚Äôs coordinates to the grass material and to use a spherical mask to bend the grass within a certain radius from the player. <br><br>  Although this approach is quite good, it doesn‚Äôt scale well when we want to add more actors to the grass.  For each actor being added to the material, you will have to add one more coordinate parameter and a spherical mask.  A more scalable method is to use a <em>vector field</em> . <br><br><h2>  What is a vector field? </h2><br>  A vector field is simply a texture, each pixel of which corresponds to a direction.  If you have previously worked with stream maps, they are similar.  But instead of moving the UV, we‚Äôll use the <a href="https://docs.unrealengine.com/en-us/Resources/ContentExamples/MaterialNodes/1_10">World Position Offset</a> contact to move the vertices.  Unlike the solution with a spherical mask, to obtain the direction of bending, it is sufficient to sample the vector field only <i>once</i> . <br><br>  Let's find out how you can save directions in a texture.  Look at this grid: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/553/651/6d2/5536516d26f67d5e2e5928db30b1608a.jpg"></div><br>  Suppose a red dot is an object that we want to move.  If we move it to the lower right corner, which vector will represent this movement?  If you answered <em>(1, 1)</em> , then you are right!  As you probably know, you can also represent the vectors as flowers, and thus save them to a texture.  Let's insert this vector into the Unreal color picker and see what color it returns. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b21/5d6/59b/b215d659be2f7f813add96b32fcabae4.jpg"></div><br>  As you can see, the direction <em>(1, 1)</em> returns yellow.  This means that if we want to bend the grass in the direction of the positive XY axes, then we will have to use this texture color.  Let's now look at the colors of all vectors. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fbf/302/8bd/fbf3028bd6456dac8ca27a9c1bf2146d.jpg"></div><br>  The lower right square looks pretty good because it has gradients along both axes.  This means that we can store any vector in the color of this quadrant, because each vector has a unique color. <br><br>  But with the other three quadrants a problem arises.  We have a gradient along only one axis, or no gradient at all.  This means that several vectors will have the same color.  For example, we can not distinguish between the vectors <em>(-1, 1)</em> and <em>(0, 1)</em> . <br><br>  These three quadrants do not have unique colors for each vector because we can only represent colors using values ‚Äã‚Äãfrom 0 to 1. However, these three quadrants use negative values ‚Äã‚Äãoutside this interval. <br><br>  The solution is to redistribute the vectors so that they all fit in the interval from 0 to 1. This can be done by multiplying the vector by <em>0.5</em> and adding <em>0.5</em> .  Here is a visualization of what we get: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c6/334/31a/1c633431aa88cde88b2f2af01ede9f89.gif"></div><br>  Now each vector has a unique color.  When we need to use it for calculations, we simply redistribute it back to the interval from -1 to 1. Here are a few colors, and the corresponding directions after the redistribution: <br><br><ul><li>  <em>(0, 0):</em> Negative X and Y </li><li>  <em>(0.5, 0.5):</em> no movement </li><li>  <em>(0, 1):</em> Negative X and Positive Y </li><li>  <em>(1, 0):</em> positive X and negative Y </li></ul><br>  Now let's learn how to create a vector field in Unreal. <br><br><h3>  Creating a vector field </h3><br>  Unlike creating tracks in the snow, we will not capture the shape of objects.  Instead, we will paint on the render target using ‚Äúbrushes‚Äù.  These will be just the images of the selected vector field.  I will call them <em>directions brushes</em> . <br><br>  Instead of drawing on the render target using blueprints, we can use <em>particles</em> .  Particles will display brush directions and be emitted from the player.  To create a vector field, we just need to use scene capture and capture only particles.  The advantage of this method is that creating traces is very simple.  In addition, it allows you to easily manage such properties as the duration of the preservation of traces and their size.  In addition, the particles create temporarily remaining traces, because they exist after leaving the capture area and returning to it. <br><br>  Below are a few examples of brush patterns that we can use, as well as their influence on the grass.  Notice that in the example shown below the particles are invisible. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/06a/7ac/976/06a7ac9766e63da84aec88bca2338b9a.gif"></div><br>  To begin, let's create a material that will display a brush of directions. <br><br><h2>  Creating material for referrals </h2><br>  There are two ways to create brush directions: <br><br><ol><li>  <em>Mathematical:</em> Directions and shape are defined inside the material.  Its advantage is that it does not require third-party software and is convenient for simple forms. </li><li>  <em>Transformation of the normal map:</em> creating a normal map of the desired directions and shape.  To convert the map into a suitable vector field, we just need to remove the blue channel.  The advantage of this method is that you can very easily create complex shapes.  Below is an example of a brush that will be difficult to create mathematically. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ddd/e44/0e5/ddde440e52ce5e3bbc6cdece65815265.jpg"></div><br>  For this tutorial we will create a brush mathematically.  Go to the <em>Materials</em> folder and open <em>M_Direction</em> .  Note that the shading model <em>Unlit is</em> selected for this material.  This is important because it allows the capture of a scene to capture particles without affecting them. <br><br>  In order not to complicate things, we will create a material that will force the grass to move away from the center of the particle.  To do this, create the following scheme: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/826/06f/fc1/82606ffc1df0425a75ef17c334a23470.jpg"></div><br>  Now we need to perform a redistribution.  To do this, add the selected nodes and connect everything as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02b/eb0/98a/02beb098a304fb3b9ff13a3852c664cd.jpg"></div><br>  Now let's make the brush round.  To do this, add the selected nodes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b97/4bf/702/b974bf7024f3487a8161e279ad3fb350.jpg"></div><br>  <em>RadialGradientExponential</em> controls the size and sharpness of a circle's circumference.  Multiplying it by <em>Particle Color</em> allows you to control the opacity of particles from a particle system.  I will talk more about this in the next section. <br><br>  Here is what the brush looks like: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/529/d6e/349/529d6e34937588676b1a20d03fdac107.jpg"></div><br>  Click <em>Apply</em> and close the material.  Now that we have created the material, it is time to start on the particle trail system. <br><br><h2>  Creating a trace particle system </h2><br>  Go to the <em>ParticleSystems</em> folder and open <em>PS_GrassTrail</em> .  To save time, I have already created all the necessary modules. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6aa/008/5ee/6aa0085ee0867456e29f574511b43ec2.jpg"></div><br>  Here is how each module affects traces on the grass: <br><br><ul><li>  <em>Spawn: the</em> frequency of creation affects the smoothness of the tracks.  If the traces look intermittent, then it is worth increasing the frequency of creation.  In this tutorial we will leave the default value (20). </li><li>  <em>Lifetime:</em> the lifetime of the track until the grass returns to its original state </li><li>  <em>Initial Size:</em> track size </li><li>  <em>Color Over Life:</em> as we use in the Particle Color material, here you can control the opacity.  You can also change the alpha curve to control the disappearance of the trace.  For example, you can choose linear loss, easing in and / or easing out.  In this tutorial, we will leave the default setting, that is, linear disappearance. </li><li>  <em>Lock Axis:</em> used to direct particles toward the scene. </li><li>  <em>Initial Rotation:</em> used to ensure that the particles are oriented along the correct axes (more on this below) </li></ul><br>  First we need to set the material.  Select the <em>Required</em> module and set the <em>Material</em> to <em>M_Direction</em> .  Also set the <em>Sort Mode</em> to <em>PSORTMODE Age Newest First</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb0/a43/fa3/bb0a43fa369abea85bc7a9ff6a80b06e.jpg"></div><br>  This sorting mode allows you to render new particles on top of old ones.  If this is not done, then the grass will be affected not by new, but by old particles. <br><br>  Next is the duration of the trace.  Select the <em>Lifetime</em> module and set the <em>Constant</em> value to <em>5</em> .  Due to this, the trail will disappear within five seconds. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/505/d9d/b73/505d9db732f69d4b68b4079bd330553c.jpg"></div><br>  We now turn to the size of the track.  Select the <em>Initial Size</em> module and set the <em>Constant</em> value to <em>(150, 150, 0)</em> .  Due to this, each particle will cover an area of ‚Äã‚Äã150 √ó 150. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/231/dba/9c5/231dba9c5421f8bdd79aba23f8def0cd.jpg"></div><br>  Now we need to make it look in the direction of the capture scene.  Since the scene capture will be executed from a top view, the particles should look in the direction of the positive Z axis. To do this, select the <em>Lock Axis</em> module and set the <em>Lock Axis Flags</em> value to <em>Z.</em> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b74/b2b/69c/b74b2b69c7d38785c7ad78d8ec6f250e.jpg"></div><br>  Finally, we need to set the rotation of the particles.  Currently, brush colors are not aligned with the direction they represent.  It happened because the default particle system is applied with a rotation of 90 degrees.  To fix this, select the <em>Initial Rotation</em> module and set the <em>Constant</em> value to <em>-0.25</em> .  This will rotate the particles 90 degrees counterclockwise. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/41d/a09/000/41da09000032c1023438b15a3a74f341.jpg"></div><br>  And that's all we need for a particle system, so let's close it. <br><br>  Next, we need to attach a particle system to what should create traces.  In our case, you need to attach it to the player's character. <br><br><h3>  Attaching a particle system </h3><br>  Go to <em>Characters \ Mannequin</em> and open <em>BP_Mannequin</em> .  Next, create the <em>Partice System</em> component and name it <em>GrassParticles</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b72/9e0/811/b729e08111d25a301682968f1d878da0.jpg"></div><br>  Next we need to set the particle system.  Go to the Details panel and set the <em>Particles \ Template</em> value to <em>PS_GrassTrail</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/491/45d/7d3/49145d7d362eb92443a8cfe93bd8a023.jpg"></div><br>  It would be strange if the player could see the trail in the game, so it's worth hiding it.  To do this, turn on <em>Rendering \ Owner No See</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad4/de5/7a8/ad4de57a8d9f0eeee254a58c0de8e8d6.jpg"></div><br>  Since the particle system is attached to the player (owner), the player will not see it, but it will be visible to the rest. <br><br>  Click <em>Compile</em> , and then click <em>Play</em> .  Note that particles do not appear for the player‚Äôs camera, but are mapped to the render target. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c9d/4d5/4ac/c9d4d54ac998a6aa80da5887dc199b23.gif"></div><br>  While the capture scene is set to capture <i>everything</i> .  Obviously, this does not suit us, because only particles affect the grass.  In the next section, we will learn how to capture particles only. <br><br><h2>  Particle trapping </h2><br>  If we capture particles now, then bending that we do not need will be performed in areas without particles.  This is because the render target background color is black.  Bending occurs because black denotes movement towards the negative XY axes (after redistribution).  In order for the empty areas to contain no movement, we need to make the render target background color <em>(0.5, 0.5, 0)</em> .  The easiest way to do this is to create a huge plane and attach it to the player. <br><br>  First create the material for the background.  Return to the Content Browser and open the <em>Materials \ M_Background</em> .  Then connect the constant <em>(0.5, 0.5, 0)</em> with <em>Emissive Color</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31b/46f/306/31b46f306ba4f2a0df310d36e54a000b.jpg"></div><br><blockquote>  <em>Note:</em> As with the particle material, any material that we will capture must have an <em>unlit</em> shading <em>model</em> . </blockquote><br>  Click <em>Apply</em> and close the material.  Go back to <em>BP_Mannequin</em> , and then create a new <em>Plane</em> component.  Call it <em>Background</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc4/0aa/1ff/bc40aa1ffbb655e576ce999318f4342b.jpg"></div><br>  Next, set the following properties: <br><br><ul><li>  <em>Location:</em> (0, 0, -5000).  We place the plane so low that it does not overlap any particles. </li><li>  <em>Scale:</em> (100, 100, 1).  So we will scale to a size sufficient to cover the entire capture area. </li><li>  <em>Material:</em> M_Background </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6d/824/d3b/e6d824d3b427cff5e136a2861eb02bed.jpg"></div><br>  As in the case of particles, it would be strange if the player saw a huge yellow plane under him.  To hide it, turn on <em>Rendering \ Owner No See</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cad/164/7df/cad1647dfe62bb1e29733ac8e6d6b712.jpg"></div><br>  Now that we‚Äôve set up the background, it‚Äôs time to grab the particles.  We can do this by adding a particle system to the <em>show-only list</em> of the scene capture.  This is a list of components that will capture a scene. <br><br><h3>  Using the Show-Only List </h3><br>  Before we get the opportunity to add to the show-only list, we need a way to get all the actors that influence the grass.  One way to get them is to use <em>tags</em> .  Tags are simple strings that can be assigned to actors and components.  Then you can use the node <em>Get all Actors With Tag</em> to get all the actors with the corresponding tag. <br><br>  Since the player's actor must influence the grass, it needs a tag.  To add a tag, click on the <em>Class Defaults</em> button.  Then create a new tag in <em>Actor \ Tags</em> and name it <em>GrassAffector</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/759/df5/711/759df57115fd0a2172f9c9c4c5b0505d.jpg"></div><br>  Since only <i>components</i> can be transferred to the show-only list, we need to add tags to the grass-affecting components.  Select the <em>GrassParticles</em> component and add a new tag located in the <em>Tags</em> section.  Call it <em>GrassAffector</em> too (it is <i>not necessary to</i> use this particular tag).  Repeat the same for the <em>Background</em> component. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f4/3f4/05a/8f43f405a8cf96083d5df56e54d21576.jpg"></div><br>  Now we need to add the grass-affecting components to the show-only list of the scene capture.  Click <em>Compile</em> and close <em>BP_Mannequin</em> .  Then open <em>Blueprints \ BP_Capture</em> .  Go to <em>Event BeginPlay</em> and add highlighted nodes.  Also ensure that the indicated pins are connected. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7d9/e82/3cf/7d9e823cffefede4f0273a81b9363ecb.jpg"></div><br>  This scheme will bypass in the loop all the actors with the <em>GrassAffector</em> tag.  After that, it will check if the actor has components with such a tag, and add them to the show-only list. <br><br>  Next, we need to tell the capture scene to use only the show-only list.  Select the <em>SceneCapture</em> component and go to the <em>Scene Capture</em> section.  Set <em>Primitive Render Mode</em> to <em>Use ShowOnly List</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/675/ecd/6eb/675ecd6eb2a1c867734b920bbeaeedd4.jpg"></div><br>  Click <em>Compile</em> and close the blueprint.  If you click on <em>Play</em> , you will see that the render target now only captures particles and the background plane. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee0/a1f/3d7/ee0a1f3d7bb9687f81ec2e7d0faaf61b.gif"></div><br>  In the next section, we will get to what we expected.  It is time to teach the grass to bend! <br><br><h2>  Bend the grass </h2><br>  First we need to project the render target to the grass.  Go to the <em>Materials</em> folder and open <em>M_Grass</em> .  Then create the nodes shown below.  Set <em>RT_Capture</em> as your texture. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ec0/fd7/4e6/ec0fd74e6e18c21da2d9b647c878613c.jpg"></div><br>  Since we redistributed the colors in the interval from 0 to 1, before using them, you need to redistribute back to the interval from -1 to 1. To do this, add the selected nodes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/25d/dc7/0be/25ddc70be17e726bd3089c21ee5be21e.jpg"></div><br>  Now that we have a bending direction, we need some way to turn the grass in that direction.  Fortunately, for this there is a node called <em>RotateAboutAxis</em> .  Let's create it. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a92/4a0/127/a924a0127868686cf2616c8d994e9b5a.jpg"></div><br>  Let's start with the <em>NormalizedRotationAxis</em> contact.  As the name implies, this is the axis around which the vertex will turn.  To calculate, we just need the <a href="https://www.mathsisfun.com/algebra/vectors-cross-product.html">vector product of the</a> direction of flexion by <em>(0, 0, -1)</em> .  To do this, we need to add highlighted nodes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5c3/898/ece/5c3898ecee9d7a4fd9ea75e53072acd1.jpg"></div><br>  We also need to specify the <em>RotationAngle</em> , that is, the amount of rotation of the vertex relative to the point of rotation.  By default, the value should be in the range of 0 to 1, where 0 is 0 degrees and 1 is 360 degrees.  To obtain the angle of rotation, we can use the length of the direction of flexion multiplied by the maximum rotation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d4/171/800/6d417180067018db8df09f878251f6e8.jpg"></div><br>  Multiplying by a maximum rotation of <em>0.2</em> means that the maximum rotation angle is <em>72</em> degrees. <br><br>  Calculating <em>PivotPoint</em> is a bit more difficult, because one mesh of grass contains several stems.  This means that we cannot use something like the <em>Object Position</em> node, because it will return a single point for all the grass stems. <br><br>  Ideally, use a third-party 3D editor to maintain the rotation points inside the UV channels.  But for this tutorial we just approximate the pivot point.  This can be done by moving from the top <em>down</em> to a certain offset. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f47/6ac/cdf/f476accdf57bca37d5bd7994f53b6b47.jpg"></div><br>  To do this, add the selected nodes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/05a/1bd/208/05a1bd2082b7044a1535aaf38cf33264.jpg"></div><br>  In this tutorial, the grass is about <em>80</em> units tall, so I set this value for <em>PivotOffset</em> . <br><br>  Next we need to perform two masks.  The first mask ensures that the stem root will not move.  The second mask ensures that the vector field does not act on the grass outside the capture area. <br><br><h3>  Masking </h3><br>  For this tutorial, I set the colors of the grass tops in such a way that the bottom peaks are black and the top ones are white. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/199/0ff/45b/1990ff45be26b99bf5330a0d2817e102.jpg"></div><br>  To mask the roots, we simply multiply the result of <em>RotateAboutAxis</em> by the <em>Vertex Color</em> node. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/522/568/0fc/5225680fcb4fd4bedf2f7ec7a49ebb58.jpg"></div><br>  To mask the grass outside the capture area, we multiply the previous result by the selected node: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/37b/da2/e95/37bda2e954f8e160ab3b0c80d5269acf.jpg"></div><br>  Click <em>Apply</em> and close the material.  Click <em>Play</em> and run on the grass to leave traces on it! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1dc/058/185/1dc058185c158d1ef243b04f5d041174.gif"></div><br><h2>  Where to go next? </h2><br>  The finished project can be downloaded <a href="">from here</a> . <br><br>  Although the method shown in the tutorial works fine for such simple objects as grass, it is not enough when using objects that require more dynamism.  A partial solution to the problem is to use physical versions of foliage.  More information is in <a href="https://forums.unrealengine.com/development-discussion/content-creation/115468-interactive-foliage-in-ue4">this post</a> about interactive foliage. <br><br>  Finally, I want to thank Deathrey from the Unreal Engine community for suggesting this method with particles! </div><p>Source: <a href="https://habr.com/ru/post/420079/">https://habr.com/ru/post/420079/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../420069/index.html">Richard Hamming: Chapter 20. Modeling - III</a></li>
<li><a href="../420071/index.html">Different prices for warehouses in multistore. Revision 1C-Bitrix</a></li>
<li><a href="../420073/index.html">The art of driving: a review of the best reports with Teamlead Conf 2018. Part 2</a></li>
<li><a href="../420075/index.html">This ingenious map explains how everything in physics fits together.</a></li>
<li><a href="../420077/index.html">New online trading opportunities</a></li>
<li><a href="../420081/index.html">Installing Archlinux with full system and LVM encryption on LUKS</a></li>
<li><a href="../420083/index.html">Perfect Action for Google Assistant - 8 lessons of the Moscow hackathon</a></li>
<li><a href="../420085/index.html">Recognizing objects and human emotions using the Firebase ML Kit</a></li>
<li><a href="../420087/index.html">This is a post with reports and videos on MS SQL Server</a></li>
<li><a href="../420089/index.html">Robomobili: Platooning and Bavarian sausages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>