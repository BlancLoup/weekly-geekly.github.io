<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unity's Forgotten Secret Weapon - UnityEvents</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Our brave hero, who accidentally wandered into the forbidden region of the venomous venus jungle, is surrounded by a swarm of ten thousand hungry semi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unity's Forgotten Secret Weapon - UnityEvents</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/getpro/habr/post_images/5c7/1a5/922/5c71a59220f3deb2d9182e1d57e64216.jpg" alt="Terrible Venus mosquito (photo by Richard Jones)" align="left">  Our brave hero, who accidentally wandered into the forbidden region of the venomous venus jungle, is surrounded by a swarm of ten thousand hungry semi-intelligent mosquitoes.  The question of human edibility for alien organisms, from a scientific point of view, is generally quite controversial - but Venusian mosquitoes, as is well known, sincerely share Marx‚Äôs position that experiment is a criterion of truth.  It would seem that the situation is hopeless - but the hero, without being taken aback, removes a marching thermonuclear fumigator from the wide leg of his inventory, turns him on with a beautiful movement, and ... </p><br><p>  And at this point, the development of the game seriously stalled, rapidly gathering crutches and props, since the game developer was not familiar with one small, but extremely important engine mechanism. </p><br><p>  The mechanism that the developer did not know, sleeping on the keyboard after a long programming sprint of an absolutely unnecessary in essence mosquito control manager, is an <b>embedded event system</b> . </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Wait, but I know what an event system is!</b> <div class="spoiler_text"><p>  As shown by a survey conducted recently in the Russian-speaking segment of the Unity-community, a frighteningly large percentage of domestic developers do not even suspect that such a thing as events was once crafted by the human mind.  In part, this general lacuna in knowledge was contributed by official documentation, which circumvented the practical application of events in Unity with a cunning anti-submarine zigzag, in part, the overall intricacy of the architecture of this part of a simple and convenient engine. </p><br><p>  In addition, you probably use one of the most well-known mechanisms provided by C # tools.  This is a good choice - but, perhaps, it will be interesting for you to learn about the capabilities of the built-in Unity system and its own "buns"? </p></div></div><br><h2>  Likbez, or "Alarm against timer" </h2><br><p>  <i>(if you are familiar with what game events are, quietly skip this section)</i> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ae6/a8a/b58/ae6a8ab58a3dd2e8dea15ae6e3663be7.jpg" alt="image" align="right">  Most modern game engines are somewhat similar to conventional mechanical watches.  The objects of the engine are the gears of the large clock mechanism of the game world.  And, as the clockwork functions due to the fact that the gears are cleverly interconnected, so the life and movement of the game world are carried out due to the interaction of objects with each other. </p><br><p>  The metaphor is not entirely accurate - however, it is obvious that every object must have data not only about its own internal state, but also to have some information about the world around it.  Methods for obtaining this information are divided into two groups: </p><br><ul><li>  <b>Active</b> - the initiative to receive new data comes from the object itself, i.e.  the object itself sends a request. </li><li>  <b>Passive</b> - information comes as a result of an external (in relation to the object) event - the object did not really do anything to get it. </li></ul><br><p>  Consider an example from the real world.  Imagine that we are hungry, and put on this occasion on the fire to cook a large pan of dumplings.  The algorithm of this action is simple - throw a pack of dumplings into hot salted water, turn on the fire, leave for ten minutes <em>(sit on the Internet for half an hour)</em> , remove the <s>coals of</s> dumplings from the fire. </p><br><p>  Imagine that this is a game, and we are in it - a game object.  How do we determine when the time comes to go off the dumplings? </p><br><p>  You can use the active way to get information about the time - put a timer / clock in front of your nose - and regularly ask them for time by casting oblique views on the dial.  Once, looking again, we will see that the clock has finally counted ten minutes since the start of cooking, we run to remove the pan from the fire. </p><br><p>  You can use the passive method - set the alarm by setting it at the time when dumplings should be cooked according to our estimates.  When the alarm clock is ringing, we respond to this <u><b>event</b></u> and go to take action with regard to food. </p><br><p>  Definitely, the second method is more convenient - you do not need to constantly break away from current affairs, look for the ‚Äúclock‚Äù object around you, and then find out from him the data we are interested in.  In addition, home ones who are not indifferent to the fate of a close dinner can also <i>subscribe to the ‚Äúalarm clock rang‚Äù event</i> and go about their business, freed from the need to regularly approach and lift our favorite watches to their eyes, or ask us personally about dinner. </p><br><p>  <i>In turn, the first method - the method of regular active circulation to get some information - is called <b>polling</b> (from the English. <b>"Poll"</b> ).</i>  <i>The object that triggers an event is called the <b>sender</b> , the object that perceives it as the <b>receiver</b> , the event tracking process is called a <b>listen</b> , and the function called by the receiver when an event is received is called the <b>handler</b> .</i> </p><br><h3>  Clock?  Dumplings?  Eh? </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e9/3e0/f7b/8e93e0f7b4c7c8de229c68b73f90c906.jpg" alt="image"></div><br><p>  Good, good, another example.  We watched the second "Shrek"? </p><br><div class="spoiler">  <b class="spoiler_title">YouTube scene</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/QSaSF--YgMs%3Ffeature%3Doembed&amp;xid=17259,15700021,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh3djdKXwW8QseJrJYjn3qDnbgbPA" frameborder="0" allowfullscreen=""></iframe></div></div><br><p>  Remember the moment when the three heroes ride in a carriage to the Distant-Distant Kingdom.  Wonderful humorous scene where restless Donkey gets heroes, regularly interested in: </p><br><p>  -We already arrived? <br>  -Not. <br>  - ... we have already arrived? <br>  -No, did not come! <br>  - ... we have already arrived? <br>  - Nooooo! </p><br><p>  What the Donkey does is a good example of pure <b>polling</b> .  As you can see, it is great tires :) <br>  The remaining heroes, in their turn, are conditionally signed for the ‚Äúarrival‚Äù event, and therefore do not waste system time, resources, and also do not require additional programmer efforts to implement an additional hard link between objects. </p><br><h2>  A secret that everyone can see </h2><br><p>  So how to implement events on Unity?  Let's look at a simple example.  Let's create two objects in the new scene - we want one to generate a message by clicking on it (or past it, or not the mouse at all), and the second to react to the event and, say, repaint.  Let's call the objects appropriately and create the necessary scripts - <b>Sender</b> (generating event) and <b>Receiver</b> (receiving event): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/737/a0f/8be/737a0f8beb0231ac9ebbd0be0c01edba.png" alt="image"></p><br><h5>  <b>Sender.js</b> script <b>code:</b> </h5><br><pre><code class="javascript hljs">public <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> testEvent : Events.UnityEvent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Events.UnityEvent (); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     //   (  ) if (Input.anyKeyDown &amp;&amp; testEvent != null) testEvent.Invoke (); }</span></span></code> </pre> <br><p>  <i>Pay special attention to the line:</i> </p><blockquote>  <i><b>public var testEvent: Events.UnityEvent = new Events.UnityEvent ();</b></i> </blockquote><p></p><br><h5>  And the script code Receiver.js: </h5><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ } <span class="hljs-comment"><span class="hljs-comment">//       function Recolor() { renderer.material.color = Color(Random.value, Random.value, Random.value); }</span></span></code> </pre> <br><p>  Now look at the <b>Sender</b> object, and see: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/comment_images/e53/0ce/cc6/e530cecc6ce978e2205e459740e65692.png" alt="image"></div><br><p>  Aha  Our event, declared as a public variable - an object of type <b>UnityEvent</b> - was not slow to appear in the property editor.  True, while it looks lonely and lost, since not one of the objects has been signed on it.  We fix this flaw by specifying <b>Receiver</b> as an object listening to an event, and as a handler called upon receiving an event, our <i><b>Recolor ()</b></i> function: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d84/c57/e74/d84c57e7405e87a55653d36a539434b4.png" alt="image"></div><br><p>  Let's launch, press any button a couple of times ... there is, the <b>result is achieved</b> - the object obediently repainted in the most unexpected colors: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/64f/f62/5bc/64ff625bcbbbd2d126a63c981bb001b1.jpg" alt="image"></div><br><p>  "Hey!  Stop stop!  But we already used it when we worked with <b>Unity UI</b> ! ‚Äù- you will say ... and you will be suddenly right. </p><br><p>  The UI that ships with Unity version 4.6 uses <b>the same</b> event mechanism.  Here only the set of UI events is limited to the invoked user input, while the engine allows the programmer to create them for any reason and call them on any convenient occasion. </p><br><p>  But let's move on! </p><br><h2>  ‚ÄúAdd a second recipient?  You can't, you're lying all! ‚Äù </h2><br><p>  Ok, works.  Works!  But from the hall there are already voices of people who launched the environment, tested, and begin to incriminate the author in ... inaccuracies.  And the truth is - after a short study, the inquisitive reader finds out that the Unity editor allows you to associate the event with only one instance of <b>Receiver</b> , and begins to swear.  The second copy simply has nowhere to enter - the field of the object receiving the signal does not provide for a plurality of records. <br>  <i>( <b>upd:</b> as it turned out later, actually provides, see <a href="https://habrahabr.ru/post/308570/">comment</a> )</i> </p><br><p>  And this is a failure, it would seem. </p><br><p>  However, everything is not so bad.  Putting <i>‚Äúprogramming with the mouse‚Äù</i> aside, we dive into the code.  It turns out that at the code level everything is easy, and it is quite possible to make several objects listeners of one event. </p><br><p>  The command syntax for this is simple: </p><blockquote>  <i>Event copy</i> .  <b>AddListener</b> ( <b>function handler</b> ); </blockquote><p></p><br><p>  If, looking ahead, there is a desire to stop listening to the event during the execution of the code, the function will help: </p><blockquote>  <i>Event copy</i> .  <b>RemoveListener</b> ( <b>Handler function</b> ); </blockquote><p></p><br><p>  Well, now the power of events in our hands, and, it would seem, the addition of a second recipient is a resolved question. </p><br><p>  But there is a nuance - a copy of the event is stored in the <b>Sender</b> , and <b>Receiver</b> knows nothing about it.  What to do?  Do not drag the pointer to <b>Sender</b> inside <b>Receiver</b> ? </p><br><p>  Smart books on this site are often limited to formulations like: " <i>And we leave the solution of this issue to the reader for independent study</i> ."  However, I will show here one tricky, not quite obvious (and not the most elegant) solution.  It is not always suitable and not everywhere, but if you can get to a situation where you need something more, then by this time you probably already have enough knowledge to cope with this problem yourself. </p><br><p>  <u><b>So, the solution: an</b></u> event, like any self-respecting variable, can be made <b>static</b> ... without any problems <b>!</b> </p><br><p>  Change the <b>Sender</b> code as follows: </p><blockquote>  <i>public <b>static</b> var testEvent: Events.UnityEvent = new Events.UnityEvent ();</i> </blockquote><p></p><br><p>  The variable naturally disappeared from the editor, since now it does not belong to any instance of the class.  But now it is available globally.  To use it, change the <b>Receiver</b> code: </p><br><div class="spoiler">  <b class="spoiler_title">Receiver.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ OnEnabled(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recolor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ renderer.material.color = Color(Random.value, Random.value, Random.value); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnabled</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Sender.testEvent.AddListener(Recolor); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDisable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Sender.testEvent.RemoveListener(Recolor); }</code> </pre> </div></div><br><p>  Multiply the <b>Receiver</b> object and launch the game: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a33/a01/390/a33a013904f6d71bab8a8f9c392873cc.jpg" alt="image"></div><br><p>  Yes, now the ensemble of <b>Receivers is</b> repainted in different colors at any keystroke.  But what did we do inside the script? </p><br><p>  Everything is very simple - since the variable is static, we now turn not to a specific object instance, but by the class name.  Another point of interest is the <i><b>OnEnabled</b></i> and <i><b>OnDisable functions</b></i> .  Objects, as the game progresses, tend to turn off or be removed from the level altogether.  Unity, on the other hand, reacts quite nervously when someone has signed up to the event before, but now no object is listening anymore.  Like, hey, where is everyone? </p><br><p>  And when an object is inactive, it usually does not have a real need to continue to continue to catch events - <i>this, if implemented, could lead to interesting consequences</i> .  Accordingly, at least it is reasonable to bind / untie the functions at the moment when the object is turned on / off.  And when an object is deleted, the <i><b>OnDisable</b></i> function is automatically called in <i><b>advance</b></i> ‚Äî so you can and do not worry about it. </p><br><h4>  Bonus Level - deleting an object in the handler </h4><br><p>  It would seem that everything is elementary - in the same <b><i>Recolor we</i></b> now call <b>Destroy (this.gameObject)</b> - and it's done?  Let's try, and ... </p><br><p>  And it does not work.  <b>Only the very first</b> (sometimes two) of the objects receiving the event are deleted, and for some reason the rest does not reach the rest for some reason.  Strange?  Strange and inexplicable.  Maybe someone from the Unity guru will tell me the ideologically correct approach, but since I <s>like to invent bicycles</s> until I found a more elegant solution, I will share my own, again. </p><br><p>  If the deletion of an event-handling object in the handler hinders further processing, <i>then let's not delete the object in the handler</i> .  We delete it in a <b>coroutine</b> that runs after the event has been processed - for which, by the way, the engine has a standard method.  We will delete the object using the <b>Destroy</b> command <b>(this.gameObject, 0.0001)</b> .  Removal will occur, but not immediately, but will be delayed by <b>0.0001 seconds</b> .  With the naked eye this pause will not be noticed, but the process of processing the event will not get stuck on the object and calmly continue further. </p><br><h2>  Parameter passing </h2><br><p>  Sometimes it is necessary to transfer an event, accompanying it with some characteristic of what happened - radius, damage, quantity, subtype, obscene comment of the player, and so on.  For these purposes, varieties of <b>UnityEvent</b> with the number of arguments from one to four are invented.  Their practical application is not more difficult than the above. </p><br><div class="spoiler">  <b class="spoiler_title">Sender.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyIntEvent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Events</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnityEvent</span></span></span><span class="hljs-class">.&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">&gt; </span></span>{} public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> testEvent : MyIntEvent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyIntEvent (); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     //   (  ) if (Input.anyKeyDown &amp;&amp; testEvent != null) testEvent.Invoke (15); }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Receiver.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs">public <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> health : int = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ OnEnabled(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recolor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">damage: int</span></span></span><span class="hljs-function">) </span></span>{ health = health - damage; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (health &lt;=<span class="hljs-number"><span class="hljs-number">0</span></span>) Destroy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gameObject, <span class="hljs-number"><span class="hljs-number">0.0001</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> renderer.material.color = Color(<span class="hljs-number"><span class="hljs-number">1.0</span></span>f, health/<span class="hljs-number"><span class="hljs-number">100.0</span></span>, health/<span class="hljs-number"><span class="hljs-number">100.0</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnabled</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Sender.testEvent.AddListener(Recolor); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDisable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Sender.testEvent.RemoveListener(Recolor); }</code> </pre> </div></div><br><p>  Works - here are a few stuck together in one frame: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d9c/090/d6a/d9c090d6a42ce2e6e3be921f9ef2f349.jpg" alt="image"></div><br><p>  As you can see, nothing particularly tricky to do. </p><br><h2>  Practical application of the event system </h2><br><p>  It often happens that an object needs to constantly have information about whether a certain action has happened or whether a certain condition has been fulfilled.  A monster in ambush checks if any of the characters have crossed the line beyond which he is allowed to see and attack.  Venus mosquitoes are checking whether the fumigator has turned on, during the operation of which they are supposed to scatter with all their squeals in all directions?  An impotent and intangible trigger on the map checks whether the player has already destroyed a dozen of the gophers assigned to him on the quest? </p><br><p>  If you start to implement all similar conditions in the game with active <b>poling</b> - that is, through regular checks of the values ‚Äã‚Äãby the object itself - here the developer is waiting for a set of the most interesting difficulties.  A monster in ambush must regularly ‚Äúask‚Äù each item on this side of the line ‚Äî isn‚Äôt he supposedly a character?  Mosquitoes should ‚Äúknow by sight‚Äù a player with a fumigator (get a pointer to it when they are created?) And periodically specify whether he has turned on this terrible weapon.  The trigger is even more difficult to live - it must keep / complete set of all gophers / and regularly check how many are still alive. </p><br><p>  Of course, the proposed examples offer a very primitive implementation.  Mosquitoes, for example, can be driven at birth into an array of special / mosquito manager /, and the player has a pointer to the mosquito manager.  When you turn on the fumigator, the manager's method will be invoked, which will go through the array and cause each mosquito the ‚Äúscare-and-fly‚Äù method ... but redundant managers - do we really need it? </p><br><h2>  How is UnityEvent better alternative options?  And by the way, what about performance? </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0c1/e9f/765/0c1e9f765abd6781669c565482b57521.jpg" alt="image" align="right">  If you work not the first year in Unity, then for certain already somehow implemented events in the projects.  Now you know about <b><em>another</em></b> event mechanism in Unity.  What better <b>UnityEvent</b> similar tools, for example, from among the standard functionality of C #? </p><br><p>  There are developers who write in <b>JavaScript</b> .  Yes, it is for them, first of all, in the article the code is given in this lightweight language.  For obvious reasons, the tools provided by C # are not available to them.  For them, <b>UnityEvent</b> is a decent and convenient mechanism available <b>out of the box</b> - take it and use it. </p><br><p>  It is also convenient that <b>UnityEvent</b> is the same for JS code and C #.  An event can be created in C # code and listen to JS code - which, again, is not directly possible with standard C # delegates.  Consequently, these events can, without shame of conscience, link fragments of code in different languages, if such obscenity started in your project (for example, after purchasing a particularly important and complex asset in the Unity Store). </p><br><p>  <a href="http://jacksondunstan.com/articles/3335">Analysis of the speed of</a> events of different types in Unity showed that <b>UnityEvent</b> can be from <b>2</b> to <b>40</b> times slower <i>(in terms of time spent on calling the handler)</i> than the same C # delegate system.  Well, the difference is not so great, because it is still <b>VERY QUICKLY</b> , if not abused. </p><br><p>  <i>Compare with the <a href="http://forum.unity3d.com/threads/is-sendmessage-really-that-bad.38094/">built-in SendMessage</a> and be horrified :)</i> </p><br><h2>  Conclusion </h2><br><p>  I hope that this article was able to add another tool to someone's piggy bank of techniques and approaches, and another secret of a good, in essence, engine became a little less mysterious for someone.  Events are extremely powerful tools in your hands. </p><br><p>  Of course, this is <b>not a ‚Äúsilver bullet‚Äù</b> that solves all the problems of architecture, but they are a convenient tool that solves <i>‚Äúone of the primary tasks of developing an application's architecture ‚Äî searching for such fragmentation into components and such interaction so that the number of links is minimal.</i>  <i>Only in this case, it will be possible to further refine the components separately</i> . <i>"</i> </p><br><p>  <b>Events are a powerful mechanism in your hands</b> .  Never forget its existence.  Use it wisely - and the development of your projects will be <b>faster, more pleasant and successful</b> . </p><br><h3>  Links </h3><br><p>  In compiling the article were, in addition to those indicated directly in the text, in a variety used various materials of publications. </p><br><p>  Here are the most interesting of them, as well as simply useful links on the topic: </p><br><ul><li>  <a href="https://www.youtube.com/watch%3Fv%3DgefnPTCFeIc">Soft gut event system (reverse engineering)</a> </li><li>  <a href="http://www.sebaslab.com/whats-wrong-with-sendmessage-and-broadcastmessage-and-what-to-do-about-it/">What is bad SendMessage</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3DScRe5crmsWE">Using delegates in Unity</a> </li><li>  <a href="http://www.everyday3d.com/blog/index.php/2010/10/04/c-events-and-unity3d/">C # Event System in Unity</a> </li><li>  <a href="https://unity3d.com/ru/learn/tutorials/topics/scripting/events">Official lesson showing how to work with delegates</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3D0AqG1fDhPT8">The author builds on the built-in message system and just makes interesting.</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/308570/">https://habr.com/ru/post/308570/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308558/index.html">Apple has released an emergency update for iOS</a></li>
<li><a href="../308560/index.html">iOS 9.3.5: security fixes and unsuccessful attack against a human rights defender from the United Arab Emirates</a></li>
<li><a href="../308562/index.html">Scala vs Kotlin (translation)</a></li>
<li><a href="../308564/index.html">Development of the game using plasticine animation</a></li>
<li><a href="../308566/index.html">Reverse engineering test crackme from Kaspersky Lab v2.0</a></li>
<li><a href="../308574/index.html">Webinar: FreePBX. Office telephony: quick start</a></li>
<li><a href="../308578/index.html">Big Data hackathon from Innopolis University and Provectus</a></li>
<li><a href="../308586/index.html">What is big data, part 2</a></li>
<li><a href="../308588/index.html">KUKU.io SMM application case: the path from a sprint of 4 months to sensible planning</a></li>
<li><a href="../308590/index.html">How we taught Facebook to make websites or Plan ‚ÄúEnvelope‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>