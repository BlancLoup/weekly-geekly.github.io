<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Rspamd Spam Filtering System</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Rspamd system is being developed as the main spam filtering system in Rambler-Mail. However, initially I planned to make a system that would not b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Rspamd Spam Filtering System</h1><div class="post__text post__text-html js-mediator-article">  The Rspamd system is being developed as the main spam filtering system in Rambler-Mail.  However, initially I planned to make a system that would not be inferior in terms of Spamassassin‚Äôs capabilities, flexibility and quality of work, but I would be deprived of its main disadvantages: excessive use of regular expressions, poor optimization and general thoughtfulness of work, and relatively inaccurate statistics.  So the idea of ‚Äã‚Äãrspamd ripened - a system whose core would be optimized for filtering a large stream of letters, which would be easily expandable and use more advanced statistics algorithms.  The rspamd kernel is written in C and uses an event-based message handling model (based on libevent).  Rspamd is expanded by writing plugins and rules in lua.  The project itself from the very beginning was Open Source (under the BSD license) and is now located on <a href="https://bitbucket.org/vstakhov/rspamd/">bitbucket</a> . <br><a name="habracut"></a><br><h4>  Preamble </h4><br>  Projects such as nginx, crm114 and, of course, spamassassin greatly influenced rspamd.  From nginx rspamd took the data processing model, as well as the principles of processing various information - the most optimal algorithms, such as finite automata, suffix trees, and so on, are used to the maximum.  In my opinion, crm114 implements the largest number of various statistical algorithms and approaches, which are then slowly introduced into other systems.  For example, rspamd for statistical analysis of messages uses an algorithm for analyzing bigrams from words rather than unigrams, like SA and many other spam filters.  This allows us to estimate the probability (or frequency) of not just words, but a spectrum from combinations of words.  On the one hand, this increases the size of the statistics, and on the other, increases its accuracy.  But, of course, most of all rspamd took from SpamAssassin'a, which served as the prototype and the reference point for the creation of the project.  The ideology of evaluating a message based on many factors ‚Äî regular expressions, DNS blocklists, various lists, statistics, signatures, phishing, and others ‚Äî was taken from SpamAssassin.  In addition, the assessment was expanded to the concept of "metric", which may allow to evaluate the message according to different sets of rules. <br><br><h4>  Who is Rspamd for? </h4><br>  Rspamd can be suitable for systems of various scales, both large mail systems, and small, processing several letters per hour.  The first ones will find in rspamd such features as easy horizontal scaling, master-slave synchronization of statistics, built-in commands for monitoring work, high speed of work and the ability to withstand sudden bursts of loading (by disabling complex checks), as well as a flexible extensible architecture.  For small systems, rspamd is quite suitable with out-of-box settings.  I also plan to organize the distribution of statistics, so that users can put rspamd and have a ready system for spam filtering.  Rspamd can integrate into various MTAs, as well as work in the SMTP proxy mode (for more information, see this <a href="https://bitbucket.org/vstakhov/rspamd/wiki/Rspamd_Integration">documentation</a> in this <a href="https://bitbucket.org/vstakhov/rspamd/wiki/Rspamd_Integration">article</a> ). <br><br><h4>  Receiving, installing and configuring the system </h4><br>  Rspamd now works only on Unix-like systems (working on various types of Linux, FreeBSD and OpenSolaris has been tested).  In FreeBSD, rspamd is in the form of a port (mail / rspamd), the owners of the rest of the system, unfortunately, will have to collect rspamd from source.  This process, as well as the initial configuration, is described in the ‚Äú <a href="https://bitbucket.org/vstakhov/rspamd/wiki/Quick_Start">quick start</a> ‚Äù.  The rspamd configuration can be done in two ways: through the xml file and through lua.  The first method is designed to set the basic parameters, for example, this is how weights and thresholds for various actions for a message are set: <br><pre><code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- Metrics section --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">metric</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>default<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">required_score</span></span></span><span class="hljs-tag">&gt;</span></span>14.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">required_score</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Sample actions --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span>reject<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span>greylist:4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span>add_header:8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Weights for symbols --&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Subject is missing inside message --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">symbol</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2.00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Subject is missing inside message"</span></span></span><span class="hljs-tag">&gt;</span></span>MISSING_SUBJECT<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">symbol</span></span></span><span class="hljs-tag">&gt;</span></span> ...</code> </pre> <br>  The second method is used to write rules and a more ‚Äúfine" setting rspamd.  For example, you can make a function that selects the "appropriate" statistics files for the message (in the base package this function is supplied for the selection of statistics according to the language of the message).  Here is an example of determining the presence of an empty letter with a picture in the letter: <br><pre> <code class="lua hljs">reconf[<span class="hljs-string"><span class="hljs-string">'R_EMPTY_IMAGE'</span></span>] = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(task)</span></span></span></span> parts = task:get_text_parts() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> parts <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _,part <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ipairs</span></span>(parts) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> part:is_empty() <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> images = task:get_images() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> images <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  You can use the rspamc console client for training, checking letters and monitoring rspamd. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Current project status </h4><br>  Not so long ago, I did a little performance testing of rspamd and SA (I checked it with a stream of 30 simultaneous connections using approximately the same rules).  Approximate results were as follows: <br><br>  Rspamd: <br><img src="https://habrastorage.org/getpro/habr/post_images/03c/b11/15c/03cb1115ca0dd4cff110bfe6be75f4b1.png" alt="rspamd stat"><br><br>  SpamAssassin: <br><img src="https://habrastorage.org/getpro/habr/post_images/9ef/49d/d35/9ef49dd3587e751169d0b931706669c9.png" alt="spamassassin stat"><br>  Now rspamd users are, in addition to Rambler-Mail, several large providers.  The project is the only developer, so I am interested in new users to improve the quality of the project and implement new ideas.  In addition, in the latest version (0.4.0) I put a lot of effort into stabilizing, simplifying and improving the quality of my project.  Therefore, if someone gets less spam thanks to rspamd, then I wrote the code and this article for good reason. <br><br><h4>  Links </h4><br><ol><li>  <a href="https://bitbucket.org/vstakhov/rspamd">https://bitbucket.org/vstakhov/rspamd</a> - Project Home Page </li><li>  <a href="https://bitbucket.org/vstakhov/rspamd/wiki/Quick_Start">https://bitbucket.org/vstakhov/rspamd/wiki/Quick_Start</a> - Quick Start </li><li>  <a href="http://wiki.opennet.ru/Rspamd">http://wiki.opennet.ru/Rspamd</a> - Quick start in Russian </li><li>  <a href="https://bitbucket.org/vstakhov/rspamd/downloads/">https://bitbucket.org/vstakhov/rspamd/downloads/</a> - Downloads </li><li>  <a href="https://bitbucket.org/vstakhov/rspamd/wiki/Documentation">https://bitbucket.org/vstakhov/rspamd/wiki/Documentation</a> - Basic Documentation </li><li>  <a href="http://highsecure.ru/rspamd_statistics/">http://highsecure.ru/rspamd_statistics/</a> - Example of separate statistics for the Russian language </li></ol></div><p>Source: <a href="https://habr.com/ru/post/125007/">https://habr.com/ru/post/125007/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../124997/index.html">Willet: find out the most influential visitors to your site</a></li>
<li><a href="../124998/index.html">What is the first thing that comes to mind when you say "Linux on the phone"?</a></li>
<li><a href="../124999/index.html">The final version of LightSwitch 2011 has been released.</a></li>
<li><a href="../125000/index.html">Free centralized code library: Microsoft All-In-One Code Framework</a></li>
<li><a href="../125006/index.html">Ticks. We receive information</a></li>
<li><a href="../125008/index.html">Windows Workflow Foundation - for what and in what cases to apply</a></li>
<li><a href="../125011/index.html">Jumio service suggests using a webcam as a POS terminal.</a></li>
<li><a href="../125013/index.html">Leakage of confidential data through the eyes of 96%</a></li>
<li><a href="../125015/index.html">Canon has released a hybrid mouse and calculator</a></li>
<li><a href="../125016/index.html">Standard anti-virus software for non-standard purposes.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>