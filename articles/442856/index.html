<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Two in one: Wi-Fi programmable air quality monitor and analogue clock</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At one time, I liked the air quality monitor from Sergey Silnov ‚Äôs publication ‚ÄúCompact home air monitor (CO2, temperature, humidity, pressure) with W...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Two in one: Wi-Fi programmable air quality monitor and analogue clock</h1><div class="post__text post__text-html js-mediator-article"><p>  At one time, I liked the air quality monitor from Sergey Silnov <a href="https://habr.com/ru/post/400975/">‚Äôs</a> publication <a href="https://habr.com/ru/post/400975/">‚ÄúCompact home air monitor (CO2, temperature, humidity, pressure) with Wi-Fi and a mobile interface‚Äù</a> . </p><br><p>  In the air quality monitor (hereinafter referred to as the monitor) from Sergey‚Äôs project, information from temperature, humidity, pressure, CO2 content in the air is processed by the ESP8266 controller and displayed on a monochrome screen in several frames.  In addition, the Blynk service identification key is stored in the monitor through the form in the browser in the ESP8266 memory and the data is automatically sent to Blynk. </p><br><p>  The monitor had one serious problem: it hung on the starting frame when turning off / on or even flashing the monitor supply voltage. </p><br><p>  I repeated the project with insignificant changes, and to eliminate the freezing of the monitor, I added alternative power to the circuit.  Simple as a rake: the relay coil was energized with an AC / DC adapter, and its contacts switched power from the adapter to batteries when the supply voltage of 220V disappeared. </p><br><p>  My imaginary success lasted until the first long-term power outage in the house (this happens with us).  Cheap batteries were discharged before the voltage in the sockets appeared, and I returned to the starting point. </p><br><p>  After stepping on his own rake, I decided not to look for simple solutions. </p><a name="habracut"></a><br><p>  What is changed or added to the project S. Silnova: </p><br><ul><li>  Automatically switch the monitor to offline mode 90 seconds after turning off and then turning on the monitor supply voltage if there is no Wi-Fi at this time. </li><li>  The boundary values ‚Äã‚Äãof temperature, CO2 content, air humidity, as well as time zone and winter / summer time are entered into the memory of ESP8266, like the Blynk key, from the form in the browser. </li><li>  Radically simplified change of boundary values.  If earlier this procedure was performed through the code compiler, now it is enough to change the record in one of the form fields from ‚Äú0‚Äù to ‚Äú1‚Äù.  This job has become feasible even for an advanced user. </li><li>  Information about the operation of the monitor is displayed on a color screen 1.44 ‚Äù, 128x128 in one frame.  The exit of air parameters beyond the boundary values ‚Äã‚Äãis displayed in the frame in color. </li><li>  The heat index is calculated and displayed on the screen (heat index, humindex). </li><li>  Notifications are sent from the monitor to an e-mail if the temperature, CO2 content or air humidity are outside the thresholds set by the user. </li><li>  The monitor can work without connecting to the Blynk service and email address. </li><li>  An analog real-time clock has been added to the monitor, which is synchronized via the Internet with the time server. </li></ul><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/dp/hc/ba/dphcba8d2lt2ihdpvatv2m_a0pu.gif"></div><br><p>  I apologize in advance for the ‚Äúunkempt‚Äù layout - this is just one of the tasks of my project <a href="https://habr.com/ru/post/440978/">‚ÄúWireless Wi-Fi programmable room thermostat with an air quality monitor and other useful functions‚Äù</a> .  I decided to issue this task as a separate article, because nowadays many people are interested in air quality in housing. </p><br><h2>  Assembly </h2><br><p>  To assemble the device, you will need components, a list of which and their estimated cost at the prices of the <a href="https://ru.aliexpress.com/">AliExpress</a> website are given in the table. </p><br><p></p><table border="1"><tbody><tr><td>  <strong>Component</strong> </td><td>  <strong>Price ($)</strong> </td></tr><tr><td>  Wi-Fi fee NodeMCU CP2102 ESP8266 </td><td>  2.53 </td></tr><tr><td>  Temperature and humidity sensor DHT22 </td><td>  2.34 </td></tr><tr><td>  CO2 content sensor MH Z-19 </td><td>  18.50 </td></tr><tr><td>  Screen TFTLCD 1.44 "SPI 128x128 </td><td>  2.69 </td></tr><tr><td>  RTC DS3231 Watch </td><td>  1.00 </td></tr><tr><td>  Transistor 2N2222A, capacitor 0.22 microfarad, resistor 22 kOhm, resistor 10 kOhm, resistor 390 Ohm, other trifles </td><td>  3.00 </td></tr><tr><td>  <strong><em>Total:</em></strong> </td><td>  <strong><em>30.06</em></strong> </td></tr></tbody></table><br><p>  The brain of the monitor is an ESP8266 controller on the NodeMCU CP2102 module board.  It receives signals from sensors, clocks and generates a screen control signal, synchronizes clocks, and also sends information to Blynk and an e-mail. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/dn/io/sw/dnioswmr26e_idbcejacqd7zd4c.png"></a> </p><br><p>  Unfortunately, I did not find the Fritzing'a library for the 1.44 ‚Äùcolor screen, 128x128 with a pinout of 8 pins, so the screen with an 11 pins is in the diagram.  When installing, pay attention not to the location of the screen output relative to others, but to its functional load. </p><br><p>  Many do not like to assemble the layout on the wiring diagram.  For them, the monitor connection table: </p><br><p></p><table border="1"><tbody><tr><td>  <strong>NodeMCU (GPIO)</strong> </td><td>  <strong>Sensors, pin</strong> </td></tr><tr><td>  D0 (GPIO 16) </td><td>  displ_1.44, CS </td></tr><tr><td>  D1 (GPIO 5) </td><td>  DS3231, SCL </td></tr><tr><td>  D2 (GPIO 4) </td><td>  DS3231, SDA </td></tr><tr><td>  D3 (GPIO 0) </td><td></td></tr><tr><td>  D4 (GPIO 2) </td><td>  displ_1.44, AO </td></tr><tr><td>  D5 (GPIO 14) </td><td>  displ_1.44, SCK </td></tr><tr><td>  D6 (GPIO 12) </td><td>  displ_1.44, RESET </td></tr><tr><td>  D7 (GPIO 13) </td><td>  displ_1.44, SDA </td></tr><tr><td>  D8 (GPIO 15) </td><td>  DHT22, DATA </td></tr><tr><td>  Tx </td><td>  MH-Z19, Rx </td></tr><tr><td>  Rx </td><td>  MH-Z19, Tx </td></tr><tr><td>  Vin (5V) </td><td>  displ_1.44, Vcc;  DHT22;  MH-Z19 </td></tr><tr><td>  3.3V </td><td>  displ_1.44, LED;  DS3231, Vcc </td></tr><tr><td>  GND </td><td>  Sensors, GND </td></tr></tbody></table><br><p>  As can be seen from the connection table, all digital outputs except GPIO0 ESP8266 are busy, Tx, Rx outputs are too.  This is understandable, because only for controlling the color screen uses 5 digital outputs of the controller. </p><br><p>  To solve the problem of the lack of digital outputs, a key is used on the transistor VT1.  Initially, when power is applied, the output of the GPIO15 ESP8266 key is pulled to GND.  A few seconds after the power is turned on, the key opens and GPT15 receives a signal from the DHT22.  A non-standard solution allows you to start ESP8266 first and then use the same output as digital one to receive information from the DHT22 sensor.  Perhaps this is not the best solution, but thanks to him the problem of the lack of digital pins was solved. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/oc/t0/_0/oct0_0kxxowmzm7asv8n-uc9ahk.png"></div><br><p>  If you use a battery instead of a battery in the clock module, do not forget to break the battery charge circuit, otherwise the battery will swell up after several weeks of working under voltage.  With self-powered watches, the accuracy of 2 sec / year is provided to you. </p><br><p>  The power supply voltage of 5V to the <em>NodeMCU CP2102</em> module can be <em>supplied</em> from the computer's USB port with a standard <em>USB - microUSB</em> cable. </p><br><p>  A monitor sketch for loading into the ESP8266 is located under the spoiler. </p><br><p>  Before downloading the sketch to the module, do not forget to correct the I2C embedded driver for the Arduino ESP8266 core.  Instructions are <a href="https://github.com/enjoyneering/ESP8266-I2C-Driver">here</a> . </p><br><div class="spoiler">  <b class="spoiler_title">monitor sketch</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* *   :   Wi-Fi       */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;FS.h&gt; #include &lt;Arduino.h&gt; #include &lt;ESP8266WiFi.h&gt; //https://github.com/esp8266/Arduino // Wifi Manager #include &lt;DNSServer.h&gt; #include &lt;ESP8266WebServer.h&gt; #include &lt;WiFiManager.h&gt; //https://github.com/tzapu/WiFiManager //OLED #include &lt;SPI.h&gt; #include &lt;Adafruit_GFX.h&gt; #include &lt;TFT_ILI9163C.h&gt; //clock #include &lt;pgmspace.h&gt; #include &lt;TimeLib.h&gt; #include &lt;ESP8266WiFi.h&gt; #include &lt;WiFiUdp.h&gt; #include &lt;Wire.h&gt; #include &lt;RtcDS3231.h&gt; RtcDS3231&lt;TwoWire&gt; Rtc(Wire); #define countof(a) (sizeof(a) / sizeof(a[0])) //e-mail #include &lt;ESP8266WiFiMulti.h&gt; #include &lt;ESP8266HTTPClient.h&gt; #define USE_SERIAL Serial ESP8266WiFiMulti WiFiMulti; //e-mail, address char address[64] {"e-mail"}; // HTTP requests #include &lt;ESP8266HTTPClient.h&gt; // OTA updates #include &lt;ESP8266httpUpdate.h&gt; // Blynk #include &lt;BlynkSimpleEsp8266.h&gt; // Debounce #include &lt;Bounce2.h&gt; //https://github.com/thomasfredericks/Bounce2 // JSON #include &lt;ArduinoJson.h&gt; //https://github.com/bblanchon/ArduinoJson // Debounce interval in ms #define DEBOUNCE_INTERVAL 10 Bounce hwReset {Bounce()}; // Humidity/Temperature #include &lt;DHT.h&gt; #define DHTPIN 15 //D8 gpio15, DHT22 DATA #define DHTTYPE DHT22 // DHT 22 DHT dht(DHTPIN, DHTTYPE); // Blynk token char blynk_token[33] {"Blynk token"}; // Setup Wifi connection WiFiManager wifiManager; // Network credentials String ssid { "am180206" }; String pass { "vb654321" }; //flag for saving data bool shouldSaveConfig = false; // Sensors data float t {-100}, t_old{-100}; float hic {-1}, hic_old{-1}; int h {-1}, h_old{-1}; int co2 {-1}, co2_old{-1}; char Tmn[5]{}, Tmx[5]{}, Hmn[5]{}, Cmx[7]{}, tZ[5]{}, timeSW[4]{}, formFS[]{"0"}; //  t, h  co2, .  float Tmin, Tmax, Hmin, Cmax, tZone, timeSummerWinter, formatingFS; float trp = 0; int crbn, bl, ml=18000; int md; // : 1 - , 2 -  int blnk; // Color definitions #define BLACK 0x0000 #define BLUE 0x001F #define RED 0xF800 #define GREEN 0x07E0 #define CYAN 0x07FF #define MAGENTA 0xF81F #define YELLOW 0xFFE0 #define WHITE 0xFFFF #define GRAY 0x9999 #define __CS 16 //D0 gpio16, 1.44 CS #define __DC 2 //D4 gpio2, 1.44 AO #define __RST 12 // D6 gpio12, 1.44 RESET //char datestring[20]; char time_r[9]; char date_r[12]; //analog clock uint16_t ccenterx = 64,ccentery = 70;//center x,y of the clock clock const uint16_t cradius = 40;//radius of the clock const float scosConst = 0.0174532925; float sx = 0, sy = 1, mx = 1, my = 0, hx = -1, hy = 0; float sdeg=0, mdeg=0, hdeg=0; uint16_t osx,osy,omx,omy,ohx,ohy; uint16_t x0 = 0, x1 = 0, yy0 = 0, yy1 = 0; //uint32_t targetTime = 0;// for next 1 second timeout uint8_t hh,mm,ss; //containers for current time TFT_ILI9163C display = TFT_ILI9163C(__CS, __DC, __RST); String utf8(String source) { int i,k; String target; unsigned char n; char m[2] = { '0', '\0' }; k = source.length(); i = 0; while (i &lt; k) { n = source[i]; i++; if (n &gt;= 0xC0) { switch (n) { case 0xD0: { n = source[i]; i++; if (n == 0x81) { n = 0xA8; break; } if (n &gt;= 0x90 &amp;&amp; n &lt;= 0xBF) n = n + 0x30; break; } case 0xD1: { n = source[i]; i++; if (n == 0x91) { n = 0xB8; break; } if (n &gt;= 0x80 &amp;&amp; n &lt;= 0x8F) n = n + 0x70; break; } } } m[0] = n; target = target + String(m); } return target; } // NTP Servers: //static const char ntpServerName[] = "us.pool.ntp.org"; static const char ntpServerName[] = "time.nist.gov"; //const int timeZone = 2; // , , , , ,  //const int timeSummer = 1; WiFiUDP Udp; unsigned int localPort = 2390; // local port to listen for UDP packets time_t getNtpTime(); void digitalClockDisplay(); void printDigits(int digits); void sendNTPpacket(IPAddress &amp;address); void readCO2(){ #define mySerial Serial static byte cmd[9] = {0xFF,0x01,0x86,0x00,0x00,0x00,0x00,0x00,0x79}; //  byte response[9]; byte crc = 0; while (mySerial.available())mySerial.read();//  UART   memset(response, 0, 9);//   mySerial.write(cmd,9);//    CO2 mySerial.readBytes(response, 9);// 9    //   crc = 0; for (int i = 1; i &lt;= 7; i++) { crc += response[i]; } crc = ((~crc)+1); { // CRC if ( !(response[0] == 0xFF &amp;&amp; response[1] == 0x86 &amp;&amp; response[8] == crc) ) { Serial.println("CRC error"); } else { //  CO2 co2 = (((unsigned int) response[2])&lt;&lt;8) + response[3]; Serial.println("CO2: " + String(co2) + "ppm"); } } } void sendMeasurements() { float t1 {-100}, hic1 {-1}; float h1 {-1}; // Temperature t1 = dht.readTemperature(); //! // t1 = 25.3; //!!! if ((t1 &gt; -1) and (t1 &lt; 100)) t = t1; Serial.println("T: " + String(t) + "*C"); // Humidity h1 = dht.readHumidity(); //! if ((h1 &gt; -1) and (h1 &lt; 100)) h = h1; Serial.println("H: " + String(h) + "%"); // Humindex hic1 = dht.computeHeatIndex(t, h, false); hic = t; if (t &gt;= 21.0) hic = hic1; Serial.println("Ti: "+String(hic)+"*C"); // CO2 crbn++; if (crbn &gt; 110) {readCO2(); crbn = 0; Serial.println("CO2: " + String(co2) + "ppm"); } } void drawConnectionDetails() { display.clearScreen(); display.setTextSize(1); display.setCursor(12,24); display.setTextColor(WHITE); display.println(utf8("Connect to WiFi:")); display.setCursor(12,36); display.println(utf8("net: " + String(ssid))); display.setCursor(12,48); display.println(utf8("pass: " + String(pass))); display.setCursor(12,60); display.println(utf8("Open browser:")); display.setCursor(12,72); display.println(utf8("http://192.168.4.1")); display.setCursor(2,84); display.setTextColor(RED); display.println(utf8(" Enter your personal information!")); } void digitalClockDisplay() { // digital clock display of the time Serial.print(hour()); printDigits(minute()); printDigits(second()); Serial.print(" "); Serial.print(day()); Serial.print("."); Serial.print(month()); Serial.print("."); Serial.print(year()); Serial.println(); } void printDigits(int digits) { // utility for digital clock display: prints preceding colon and leading 0 Serial.print(":"); if (digits &lt; 10) Serial.print('0'); Serial.print(digits); } // NTP code const int NTP_PACKET_SIZE = 48; // NTP time is in the first 48 bytes of message byte packetBuffer[NTP_PACKET_SIZE]; //buffer to hold incoming &amp; outgoing packets time_t getNtpTime() { int tZoneI, timeSummerWinterI; tZoneI = (int)tZone; timeSummerWinterI = (int)timeSummerWinterI; IPAddress ntpServerIP; // NTP server's ip address while (Udp.parsePacket() &gt; 0) ; // discard any previously received packets Serial.println("Transmit NTP Request"); // get a random server from the pool WiFi.hostByName(ntpServerName, ntpServerIP); Serial.print(ntpServerName); Serial.print(": "); Serial.println(ntpServerIP); sendNTPpacket(ntpServerIP); uint32_t beginWait = millis(); while (millis() - beginWait &lt; 1500) { int size = Udp.parsePacket(); if (size &gt;= NTP_PACKET_SIZE) { Serial.println("Receive NTP Response"); Udp.read(packetBuffer, NTP_PACKET_SIZE); // read packet into the buffer unsigned long secsSince1900; // convert four bytes starting at location 40 to a long integer secsSince1900 = (unsigned long)packetBuffer[40] &lt;&lt; 24; secsSince1900 |= (unsigned long)packetBuffer[41] &lt;&lt; 16; secsSince1900 |= (unsigned long)packetBuffer[42] &lt;&lt; 8; secsSince1900 |= (unsigned long)packetBuffer[43]; return secsSince1900 - 2208988800UL + tZoneI * SECS_PER_HOUR + timeSummerWinterI * SECS_PER_HOUR; } } Serial.println("No NTP Response :-("); return 0; // return 0 if unable to get the time } // send an NTP request to the time server at the given address void sendNTPpacket(IPAddress &amp;address) { // set all bytes in the buffer to 0 memset(packetBuffer, 0, NTP_PACKET_SIZE); // Initialize values needed to form NTP request // (see URL above for details on the packets) packetBuffer[0] = 0b11100011; // LI, Version, Mode packetBuffer[1] = 0; // Stratum, or type of clock packetBuffer[2] = 6; // Polling Interval packetBuffer[3] = 0xEC; // Peer Clock Precision // 8 bytes of zero for Root Delay &amp; Root Dispersion packetBuffer[12] = 49; packetBuffer[13] = 0x4E; packetBuffer[14] = 49; packetBuffer[15] = 52; // all NTP fields have been given values, now // you can send a packet requesting a timestamp: Udp.beginPacket(address, 123); //NTP requests are to port 123 Udp.write(packetBuffer, NTP_PACKET_SIZE); Udp.endPacket(); } void draw(){ //temperature display.setTextSize(1); display.setCursor(1,6); display.setTextColor(CYAN); display.println(utf8("T: CO2:")); String t_p; t_p = String(t); char t_p_m [12]; t_p.toCharArray(t_p_m, 5); if (t != t_old) { display.fillRect(1,15,48,18,BLACK); display.setTextSize(2); display.setCursor(1,15); display.setTextColor(GREEN); if(t &lt; Tmin) display.setTextColor(RED); if(t &gt; Tmax) display.setTextColor(RED); if ((t &gt; -100) and (t &lt; 100)) display.println(utf8(String(t_p_m))); else display.println(utf8("----"));} //heat index display.setTextSize(1); display.setCursor(2,98); display.setTextColor(CYAN); display.println(utf8("H: Ti:")); String hic_p; hic_p = String(hic); char hic_p_m [12]; hic_p.toCharArray(t_p_m, 5); if (hic != hic_old) { display.fillRect(80,108,48,18,BLACK); display.setTextSize(2); display.setCursor(80,108); display.setTextColor(GREEN); // if(t &lt; Tmin) display.setTextColor(RED); if(hic &gt; 27.0) display.setTextColor(YELLOW); if(hic &gt; 31.0) display.setTextColor(RED); if ((hic &gt; 0) and (hic &lt; 100)) display.println(utf8(String(t_p_m))); else display.println(utf8("----"));} //CO2 if (co2 != co2_old) { display.fillRect(80,15,48,18,BLACK); display.setTextSize(2); display.setCursor(80,15); display.setTextColor(GREEN); if (co2 &gt; Cmax) display.setTextColor(RED); if (co2 &gt; 600) display.setTextColor(CYAN); if ((co2 &gt; -1) and (co2 &lt;= 2000)) display.println(utf8(String(co2))); else display.println(utf8("---")); } //humidity if (h != h_old) { display.fillRect(1,108,49,18,BLACK); display.setTextSize(2); display.setCursor(1,108); display.setTextColor(GREEN); if (h &lt; Hmin) display.setTextColor(RED); if (h &gt; 60) display.setTextColor(RED); if ((h &gt; -1) and (h &lt; 100)) display.println(utf8(String(h))); else display.println(utf8("--")); } //date if (hh==0) display.fillRect(28,1,60,10,BLACK); display.setCursor(28,1); display.setTextSize(1); display.setTextColor(CYAN); display.println(utf8(date_r)); //OFFLINE if (md == 2) { display.fillRect(106,44,18,8,RED); display.setCursor(106,44); display.setTextSize(1); display.setTextColor(CYAN); display.println(" A"); } //OFF BLYNK if (blnk == 1) { display.fillRect(106,44,18,8,RED); display.setCursor(106,44); display.setTextSize(1); display.setTextColor(CYAN); display.println(" B"); } } void synchronClockA() { Rtc.Begin(); Serial.print("IP number assigned by DHCP is "); Serial.println(WiFi.localIP()); Serial.println("Starting UDP"); Udp.begin(localPort); Serial.print("Local port: "); Serial.println(Udp.localPort()); Serial.println("waiting for sync"); setSyncProvider(getNtpTime); //setSyncInterval(300); if(timeStatus() != timeNotSet){ digitalClockDisplay(); Serial.println("here is another way to set rtc"); time_t t = now(); char date_0[12]; snprintf_P(date_0, countof(date_0), PSTR("%s %02u %04u"), monthShortStr(month(t)), day(t), year(t)); Serial.println(date_0); char time_0[9]; snprintf_P(time_0, countof(time_0), PSTR("%02u:%02u:%02u"), hour(t), minute(t), second(t)); Serial.println(time_0); Serial.println("Now its time to set up rtc"); RtcDateTime compiled = RtcDateTime(date_0, time_0); // printDateTime(compiled); Serial.println(""); if (!Rtc.IsDateTimeValid()) { // Common Cuases: // 1) first time you ran and the device wasn't running yet // 2) the battery on the device is low or even missing Serial.println("RTC lost confidence in the DateTime!"); // following line sets the RTC to the date &amp; time this sketch was compiled // it will also reset the valid flag internally unless the Rtc device is // having an issue } Rtc.SetDateTime(compiled); RtcDateTime now = Rtc.GetDateTime(); if (now &lt; compiled) { Serial.println("RTC is older than compile time! (Updating DateTime)"); Rtc.SetDateTime(compiled); } else if (now &gt; compiled) { Serial.println("RTC is newer than compile time. (this is expected)"); } else if (now == compiled) { Serial.println("RTC is the same as compile time! (not expected but all is fine)"); } // never assume the Rtc was last configured by you, so // just clear them to your needed state Rtc.Enable32kHzPin(false); Rtc.SetSquareWavePin(DS3231SquareWavePin_ModeNone); } } void synchronClock() { Rtc.Begin(); // WiFi.begin(lnet, key); wifiManager.autoConnect(ssid.c_str(), pass.c_str()); while (WiFi.status() != WL_CONNECTED) { delay(500); Serial.print("."); } Serial.println(" "); Serial.print("IP number assigned by DHCP is "); Serial.println(WiFi.localIP()); Serial.println("Starting UDP"); Udp.begin(localPort); Serial.print("Local port: "); Serial.println(Udp.localPort()); Serial.println("waiting for sync"); setSyncProvider(getNtpTime); if(timeStatus() != timeNotSet){ digitalClockDisplay(); Serial.println("here is another way to set rtc"); time_t t = now(); char date_0[12]; snprintf_P(date_0, countof(date_0), PSTR("%s %02u %04u"), monthShortStr(month(t)), day(t), year(t)); Serial.println(date_0); char time_0[9]; snprintf_P(time_0, countof(time_0), PSTR("%02u:%02u:%02u"), hour(t), minute(t), second(t)); Serial.println(time_0); Serial.println("Now its time to set up rtc"); RtcDateTime compiled = RtcDateTime(date_0, time_0); Serial.println(""); if (!Rtc.IsDateTimeValid()) { // Common Cuases: // 1) first time you ran and the device wasn't running yet // 2) the battery on the device is low or even missing Serial.println("RTC lost confidence in the DateTime!"); // following line sets the RTC to the date &amp; time this sketch was compiled // it will also reset the valid flag internally unless the Rtc device is // having an issue } Rtc.SetDateTime(compiled); RtcDateTime now = Rtc.GetDateTime(); if (now &lt; compiled) { Serial.println("RTC is older than compile time! (Updating DateTime)"); Rtc.SetDateTime(compiled); } else if (now &gt; compiled) { Serial.println("RTC is newer than compile time. (this is expected)"); } else if (now == compiled) { Serial.println("RTC is the same as compile time! (not expected but all is fine)"); } // never assume the Rtc was last configured by you, so // just clear them to your needed state Rtc.Enable32kHzPin(false); Rtc.SetSquareWavePin(DS3231SquareWavePin_ModeNone); } } void Clock(){ RtcDateTime now = Rtc.GetDateTime(); //Print RTC time to Serial Monitor hh = now.Hour(); mm = now.Minute(); ss = now.Second(); sprintf(date_r, "%d.%d.%d", now.Day(), now.Month(), now.Year()); if (mm &lt; 10) sprintf(time_r, "%d:0%d", hh, mm); else sprintf(time_r, "%d:%d", hh, mm); Serial.println(date_r); Serial.println(time_r); } //analog void drawClockFace(){ display.fillCircle(ccenterx, ccentery, cradius, BLUE); display.fillCircle(ccenterx, ccentery, cradius-4, BLACK); // Draw 12 lines for(int i = 0; i&lt;360; i+= 30) { sx = cos((i-90)*scosConst); sy = sin((i-90)*scosConst); x0 = sx*(cradius)+ccenterx; yy0 = sy*(cradius)+ccentery; x1 = sx*(cradius-8)+ccenterx; yy1 = sy*(cradius-8)+ccentery; display.drawLine(x0, yy0, x1, yy1, 0x0377); } // Draw 4 lines for(int i = 0; i&lt;360; i+= 90) { sx = cos((i-90)*scosConst); sy = sin((i-90)*scosConst); x0 = sx*(cradius+6)+ccenterx; yy0 = sy*(cradius+6)+ccentery; x1 = sx*(cradius-11)+ccenterx; yy1 = sy*(cradius-11)+ccentery; display.drawLine(x0, yy0, x1, yy1, 0x0377); } } //analog static uint8_t conv2d(const char* p) { uint8_t v = 0; if ('0' &lt;= *p &amp;&amp; *p &lt;= '9') v = *p - '0'; return 10 * v + *++p - '0'; } //analog void drawClockHands(uint8_t h,uint8_t m,uint8_t s){ // Pre-compute hand degrees, x &amp; y coords for a fast screen update sdeg = s * 6; // 0-59 -&gt; 0-354 mdeg = m * 6 + sdeg * 0.01666667; // 0-59 -&gt; 0-360 - includes seconds hdeg = h * 30 + mdeg * 0.0833333; // 0-11 -&gt; 0-360 - includes minutes and seconds hx = cos((hdeg-90)*scosConst); hy = sin((hdeg-90)*scosConst); mx = cos((mdeg-90)*scosConst); my = sin((mdeg-90)*scosConst); sx = cos((sdeg-90)*scosConst); sy = sin((sdeg-90)*scosConst); // Erase just old hand positions display.drawLine(ohx, ohy, ccenterx+1, ccentery+1, BLACK); display.drawLine(omx, omy, ccenterx+1, ccentery+1, BLACK); display.drawLine(osx, osy, ccenterx+1, ccentery+1, BLACK); // Draw new hand positions display.drawLine(hx*(cradius-20)+ccenterx+1, hy*(cradius-20)+ccentery+1, ccenterx+1, ccentery+1, WHITE); display.drawLine(mx*(cradius-8)+ccenterx+1, my*(cradius-8)+ccentery+1, ccenterx+1, ccentery+1, WHITE); display.drawLine(sx*(cradius-8)+ccenterx+1, sy*(cradius-8)+ccentery+1, ccenterx+1, ccentery+1, RED); display.fillCircle(ccenterx+1, ccentery+1, 3, RED); // Update old x&amp;y coords osx = sx*(cradius-8)+ccenterx+1; osy = sy*(cradius-8)+ccentery+1; omx = mx*(cradius-8)+ccenterx+1; omy = my*(cradius-8)+ccentery+1; ohx = hx*(cradius-20)+ccenterx+1; ohy = hy*(cradius-20)+ccentery+1; } void FaceClock(){ display.clearScreen(); display.setTextColor(WHITE, BLACK); // ccenterx = display.width()/2; // ccentery = display.height()/2; osx = ccenterx; osy = ccentery; omx = ccenterx; omy = ccentery; ohx = ccenterx; ohy = ccentery; drawClockFace();// Draw clock face } void drawSynchron() { display.clearScreen(); display.setTextSize(2); display.setCursor(2,48); display.setTextColor(WHITE); display.println(utf8(" Clock")); display.setTextSize(1); display.setCursor(2,68); display.setTextColor(WHITE); display.println(utf8("synchronization...")); } void drawWiFi() { display.clearScreen(); display.setTextSize(2); display.setCursor(2,48); display.setTextColor(RED); display.println(utf8("Connection to Wi-Fi")); } void drawBlynk() { display.clearScreen(); display.setTextSize(2); display.setCursor(2,48); display.setTextColor(RED); display.println(utf8("Connection to Blynk")); } void mailer() { // wait for WiFi connection if((WiFiMulti.run() == WL_CONNECTED)) { HTTPClient http; Serial.print("[HTTP] begin...\n"); http.begin("http://skorovoda.in.ua/php/wst41.php?mymail="+String(address)+"&amp;t="+String(t) +"&amp;h="+String(h)+"&amp;co2="+String(co2)+"&amp;ID="+String(ESP.getChipId())); Serial.print("[HTTP] GET...\n"); // start connection and send HTTP header int httpCode = http.GET(); // httpCode will be negative on error if(httpCode &gt; 0) { // HTTP header has been send and Server response header has been handled Serial.printf("[HTTP] GET... code: %d\n", httpCode); // file found at server if(httpCode == HTTP_CODE_OK) { String payload = http.getString(); Serial.println(payload); } } else { Serial.printf("[HTTP] GET... failed, error: %s\n", http.errorToString(httpCode).c_str()); } http.end(); } } //callback notifying the need to save config void saveConfigCallback() { Serial.println("Should save config"); shouldSaveConfig = true; } void factoryReset() { Serial.println("Resetting to factory settings"); wifiManager.resetSettings(); SPIFFS.format(); ESP.reset(); } void printString(String str) { Serial.println(str); } bool loadConfigS() { Blynk.config(address); Serial.print("e-mail: "); Serial.println( address ); Blynk.config(tZ); Serial.print("T_Zone: "); Serial.println( tZ ); Blynk.config(Tmx); Serial.print("T max: "); Serial.println( Tmx ); Blynk.config(Cmx); Serial.print("CO2 max: "); Serial.println( Cmx ); Blynk.config(Tmn); Serial.print("T min: "); Serial.println( Tmn ); Blynk.config(Hmn); Serial.print("H min: "); Serial.println( Hmn ); Blynk.config(timeSW); Serial.print("Time Summer/Winter: "); Serial.println( timeSW ); Blynk.config(formFS); Serial.print("format FS: "); Serial.println( formFS ); Blynk.config(blynk_token, "blynk-cloud.com", 8442); Serial.print("token: " ); Serial.println( blynk_token ); } bool loadConfig() { Serial.println("Load config..."); File configFile = SPIFFS.open("/config.json", "r"); if (!configFile) { Serial.println("Failed to open config file"); return false; } size_t size = configFile.size(); if (size &gt; 1024) { Serial.println("Config file size is too large"); return false; } // Allocate a buffer to store contents of the file. std::unique_ptr&lt;char[]&gt; buf(new char[size]); // We don't use String here because ArduinoJson library requires the input // buffer to be mutable. If you don't use ArduinoJson, you may as well // use configFile.readString instead. configFile.readBytes(buf.get(), size); StaticJsonBuffer&lt;200&gt; jsonBuffer; JsonObject &amp;json = jsonBuffer.parseObject(buf.get()); if (!json.success()) { Serial.println("Failed to parse config file"); return false; } // Save parameters strcpy(blynk_token, json["blynk_token"]); strcpy(address, json["address"]); strcpy(tZ, json["tZ"]); strcpy(Tmx, json["Tmx"]); strcpy(Cmx, json["Cmx"]); strcpy(Tmn, json["Tmn"]); strcpy(Hmn, json["Hmn"]); strcpy(timeSW, json["timeSW"]); strcpy(formFS, json["formFS"]); } void configModeCallback (WiFiManager *wifiManager) { String url {"http://192.168.4.1"}; printString("Connect to WiFi:"); printString("net: " + ssid); printString("pw: "+ pass); printString("Open browser:"); printString(url); printString("to setup device"); drawConnectionDetails(); } void setupWiFi() { //set config save notify callback wifiManager.setSaveConfigCallback(saveConfigCallback); // Custom parameters WiFiManagerParameter custom_blynk_token("blynk_token", "Blynk token", blynk_token, 34); wifiManager.addParameter(&amp;custom_blynk_token); WiFiManagerParameter custom_address("address", "E-mail", address, 64); wifiManager.addParameter(&amp;custom_address); WiFiManagerParameter custom_tZ("tZ", "Time Zone", tZ, 5); wifiManager.addParameter(&amp;custom_tZ); WiFiManagerParameter custom_Tmn("Tmn", "T min", Tmn, 5); wifiManager.addParameter(&amp;custom_Tmn); WiFiManagerParameter custom_Tmx("Tmx", "T max", Tmx, 5); wifiManager.addParameter(&amp;custom_Tmx); WiFiManagerParameter custom_Cmx("Cmx", "C max", Cmx, 7); wifiManager.addParameter(&amp;custom_Cmx); WiFiManagerParameter custom_Hmn("Hmn", "H min", Hmn, 5); wifiManager.addParameter(&amp;custom_Hmn); WiFiManagerParameter custom_timeSW("timeSW", "Time Summer(1)/Winter(0)", timeSW, 4); wifiManager.addParameter(&amp;custom_timeSW); WiFiManagerParameter custom_formFS("formFS", "formating FS", formFS, 4); wifiManager.addParameter(&amp;custom_formFS); wifiManager.setAPCallback(configModeCallback); wifiManager.setTimeout(60); if (!wifiManager.autoConnect(ssid.c_str(), pass.c_str())) { md = 2; Serial.println("mode OffLINE :("); loadConfigS(); } //save the custom parameters to FS if (shouldSaveConfig) { Serial.println("saving config"); DynamicJsonBuffer jsonBuffer; JsonObject &amp;json = jsonBuffer.createObject(); json["blynk_token"] = custom_blynk_token.getValue(); json["address"] = custom_address.getValue(); json["tZ"] = custom_tZ.getValue(); json["Tmx"] = custom_Tmx.getValue(); json["Cmx"] = custom_Cmx.getValue(); json["Tmn"] = custom_Tmn.getValue(); json["Hmn"] = custom_Hmn.getValue(); json["timeSW"] = custom_timeSW.getValue(); json["formFS"] = custom_formFS.getValue(); File configFile = SPIFFS.open("/config.json", "w"); if (!configFile) { Serial.println("failed to open config file for writing"); } json.printTo(Serial); json.printTo(configFile); configFile.close(); //end save } //if you get here you have connected to the WiFi Serial.println("WiFi connected"); Serial.print("IP address: "); Serial.println(WiFi.localIP()); } void connectBlynk(){ if(String(blynk_token)== "Blynk token"){ blnk = 0; Serial.println("! Off Blynk!"); } else { Serial.println("Connecting to blynk..."); while (Blynk.connect() == false) { delay(500); Serial.println("Connecting to blynk..."); } } } void sendToBlynk(){ Blynk.virtualWrite(V1, t); Blynk.virtualWrite(V2, h); Blynk.virtualWrite(V3, co2); Blynk.virtualWrite(V5, hic); } void formatFS(){ SPIFFS.format(); SPIFFS.begin(); } void setup() { // factoryReset(); // RAM Serial.begin(115200); display.begin(); // Init filesystem if (!SPIFFS.begin()) { Serial.println("Failed to mount file system"); ESP.reset(); } md = 1; // Setup WiFi drawWiFi(); //"Connecting to Wi-Fi..." setupWiFi(); if(md == 1){ // Load configuration if (!loadConfig()) { Serial.println("Failed to load config"); // factoryReset(); } else { Serial.println("Config loaded"); } Blynk.config(address); Serial.print("e-mail: "); Serial.println( address ); Blynk.config(tZ); Serial.print("T_Zone: "); Serial.println( tZ ); Blynk.config(Tmx); Serial.print("T max: "); Serial.println( Tmx ); Blynk.config(Cmx); Serial.print("CO2 max: "); Serial.println( Cmx ); Blynk.config(Tmn); Serial.print("T min: "); Serial.println( Tmn ); Blynk.config(Hmn); Serial.print("H min: "); Serial.println( Hmn ); Blynk.config(timeSW); Serial.print("Time Summer/Winter: "); Serial.println( timeSW ); Blynk.config(formFS); Serial.print("format FS: "); Serial.println( formFS ); Blynk.config(blynk_token, "blynk-cloud.com", 8442); Serial.print("token: " ); Serial.println( blynk_token ); Tmax = atof (Tmx); Cmax = atof (Cmx); Tmin = atof (Tmn); Hmin = atof (Hmn); tZone = atof (tZ); timeSummerWinter = atof (timeSW); formatingFS = atof (formFS); drawSynchron(); synchronClock(); connectBlynk(); FaceClock(); if (formatingFS == 1) { formatFS(); } } else if(md == 2) { Tmax = atof (Tmx); Cmax = atof (Cmx); Tmin = atof (Tmn); Hmin = atof (Hmn); tZone = atof (tZ); timeSummerWinter = atof (timeSW); formatingFS = atof (formFS); synchronClockA(); FaceClock(); if (formatingFS == 1) { formatFS(); } } } void loop() { if (md == 2) Serial.println(":( OffLINE"); else if (md == 1) Serial.println(":) OnLINE"); sendMeasurements(); draw(); Clock(); drawClockHands(hh,mm,ss); if (ml &gt;= 480000) ml = 0; //  if ((ml &gt;= 20000) and ((t &gt; Tmax) or (co2 &gt; Cmax) or (t &lt; Tmin) or (h &lt; Hmin))) { mailer(); ml = 0; } Blynk.run(); if (bl &gt; 210){ // 30 sec sendToBlynk(); Serial.println("   Blynk"); bl = 0; } bl++; ml++; // delay(1000); //   delay(100); t_old = t; hic_old = hic; h_old = h; co2_old = co2; Serial.println(" "); }</span></span></span></span></code> </pre> </div></div><br><p>  If at least one of the air parameters is outside the limits of the programmed threshold values, then the device sends an e-mail message about once per hour to the following e-mail: </p><br><p> <a href=""><img src="https://habrastorage.org/webt/sb/s7/e5/sbs7e5g0boyq3gqvnyos8vhgpic.png"></a> </p><br><p>  Emails are sent by a php script.  The script is uploaded to my mail server.  You will need it if you plan to send messages from another resource. </p><br><div class="spoiler">  <b class="spoiler_title">php script</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//  - http://skorovoda.in.ua/php/aqm42.php?mymail=my_login@my.site.net&amp;t=22.2&amp;h=55&amp;co2=666 $EMAIL=0; $TEMPER=0; $vlaga=0; $carbon=0; $device=0; $EMAIL=$_GET["mymail"]; $device=$_GET["ID"]; echo $EMAIL; $TEMPER=$_GET["t"]; $vlaga=$_GET["h"]; $carbon=$_GET["co2"]; $mdate = date("H:i dmy"); echo &lt;&lt;&lt;END &lt;p&gt;: $TEMPER ¬∞&lt;p&gt; &lt;p&gt;: $vlaga %&lt;p&gt; &lt;p&gt;  : $carbon ppm&lt;p&gt; &lt;p&gt;--------------------&lt;p&gt; &lt;p&gt; ‚Ññ: $device&lt;p&gt; END; echo &lt;&lt;&lt;END &lt;p&gt;$mdate&lt;/p&gt; END; mail($EMAIL, "Air Quality Monitor " .$device. " v.051018","       ‚Ññ" .$device. " .        (,     )      . === : ".$TEMPER."¬∞C === ".": ".$vlaga."% === "."  : ".$carbon." ppm === "." ! === , : ".$mdate,"From: my_sensors@air-monitor.info \n") </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> </div></div><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/8w/7n/el/8w7nelwjfe3b2wumssuerp3o3pm.png"></div><br><p>  Turn on the monitor. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/75/wk/lw/75wklw7on-_tir_swognf_fsmoq.png"></div><br><p>  The device picked up the am180206 access point.  Find this point in the list of available networks and connect to it, the password is on the screen.  Try to connect to this point within a minute and a half, otherwise the monitor will automatically switch to stand-alone mode.  On offline mode - a little later.  Then open the page http://192.168.4.1 in the browser. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/0x/xs/8d/0xxs8da7p7nxulfkzh3c6k4ysvw.png"></div><br><p>  Click the <em>Configure WiFi</em> button <em>(No Scan)</em> .  A page with the thermostat settings form will open: </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/u6/k_/qn/u6k_qn1o6venw84_jnfvrq5bwe4.png"></div><br><p>  Let us indicate in the form the name and password of your home network, the BLynk identification key, your e-mail, time zone, summer / winter time, as well as threshold values ‚Äã‚Äãfor temperature, humidity and CO2 content. </p><br><p>  When choosing the threshold values ‚Äã‚Äãof air, you can focus on the indicators that I found on the Internet: </p><br><p>  1. Comfortable temperature at night during sleep is 19 ... 21 ¬∞ C, in the daytime - 22 ... 23 ¬∞ C. </p><br><p>  2. The optimum relative humidity in the cold season is considered to be 30 ... 45% humidity, and in the warm season - 30 ... 60%.  Maximum maximum humidity: in winter it should not exceed 60%, and in summer - 65%. </p><br><p>  3. The maximum level of carbon dioxide in the premises should not exceed 1000 ppm.  The recommended level for bedrooms, children's rooms - no more than 600 ppm.  Mark 1400 ppm - the limit of permissible CO2 content in the room.  If it is more, the air quality is considered low. </p><br><p>  The <em>e-mai</em> field can be left blank.  Then the opportunity to receive emails about the exit of air parameters beyond the boundary values ‚Äã‚Äãwill be lost.  Without the Blynk key entered, you will lose the ability to receive information about the parameters of the air at a distance.  However, the monitor is not "confused" if the fields with the limiting values ‚Äã‚Äãof air parameters remain empty. </p><br><p>  Fill out without thinking, all fields of the form with numbers in floating point format, for example, time zone - <em>2.0</em> .  The sketch provides subsequent conversions of numbers to the desired format. </p><br><p>  After saving the settings in ESP8266 memory ( <em>Save</em> button), the monitor will connect to the network and start working. </p><br><p>  Consider the picture on the screen. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/nr/d3/b-/nrd3b-zotfdmjlxuo4pxlsg98c0.png"></div><br><p>  Date, time, measured temperature, CO2 content and air humidity do not require explanation.  I‚Äôll clarify that if the air parameters go beyond the limits you set, then their display on the screen will change color from green to red. </p><br><p>  The letter ‚ÄúB‚Äù on a red background indicates that the monitor is working without connecting to Blynk, and if the letter ‚ÄúA‚Äù appears, the power disappeared and at the time of its appearance there was no Wi-Fi (the device went offline). </p><br><p>  In general, the appearance of red on the screen should alert - there are deviations from the normal functioning of the device. </p><br><p>  In the lower right corner on the screen we see the heat index (heat index, humindex). </p><br><p>  <em>‚ÄúHumidex is a dimensionless quantity based on the dew point.</em>  <em>This index is widely used in Canadian weather reports in the summer.</em> <em><br></em>  <em>According to the Canadian Meteorological Service, Humidex values ‚Äã‚Äãabove 30 cause some discomfort, above 40 - great discomfort, and values ‚Äã‚Äãabove 45 are dangerous.</em>  <em>If humidex reaches 54, heat stroke is inevitable.</em>  <em>The wind effect does not take this index into account. ‚Äù</em> (Wikipedia, <a href="https://ru.wikipedia.org/wiki/Humidex">humidex</a> ). </p><br><p>  It should be clarified that the heat index is calculated only for relatively high temperatures when the measured air temperature is above 21 ¬∞ C.  Figuratively, the heat index is the perceived temperature on a hot, windless day. <br></p><br><p>  In accordance with the table of the same article on Wikipedia, the measured temperature of 25 ¬∞ C at 30% humidity is felt as 24 ¬∞ C, at 50% - 28 ¬∞ C, and at 90% - 35 ¬∞ C (10 ¬∞ C higher than the thermometer reading).  Indoors, this figure can be reduced by arranging a "draft" or turning on the fan.  The air conditioner will turn on automatically if you set the air conditioning temperature no higher than 25 ¬∞ C.  The heat index, in my opinion, is a more relevant parameter of air quality than, say, pressure, which we cannot influence in any way. </p><br><p>  The DHT22 sensor, like the DHT11, along with the ‚Äúminus‚Äù - low accuracy of humidity measurement has an undeniable ‚Äúplus‚Äù: there is information about the heat index on the data bus of this sensor.  I used this "plus" and displayed the heat index on the device screen. <br></p><br><p>  On the Internet, there are many complaints about the low accuracy of moisture measurement and the ‚Äúinadequacy‚Äù of the DHT22 sensor.  For those who are determined to abandon the use of this sensor in their projects, please look in the direction of more modern temperature and humidity sensors HTU21D, Si7021 or SHT21. <br></p><br><p>  It's time to launch the Blynk app on your smartphone. </p><br><p>  Set up an application.  Variables for Blynk (in order not to look for them in the sketch): temperature - <em>V1</em> , humidity - <em>V2</em> , CO2 content - <em>V3</em> , heat index - <em>V5</em> . </p><br><p>  On my smartphone, the Blynk interface looks like: </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/dw/3e/zd/dw3ezdbdzpghvmnmsmt6lsazvia.png"></div><br><p>  On the graph - measured temperature (yellow), humidity (blue), heat index (violet).  The first peak on the graph is the heating of the pressure-humidity sensor in the palm of the hand: the heat index curve is located above the temperature curve.  The second peak is heating the sensor with a hair dryer.  The humidity of the air when the sensor heats up with a hair dryer drops, and the heat index curve in some areas repeats or is below the temperature line.  (see callout). </p><br><p>  Do not worry if the temperature line has disappeared on the graph: at a temperature below the 21 ¬∞ C mark, the heat index curve repeats the measured temperature curve. </p><br><p>  Now let's test the e-mail alert system.  Let's enter into the address bar of the browser a commented line with the http-address from the code of the php-script.  If you did not forget to specify your e-mail in the settings, and in the browser window - information, as in the picture below, then there will most likely not be any problems with receiving notifications.  The test is especially useful when transferring a php script from my server to another. </p><br><p></p><p><img src="https://habrastorage.org/webt/lq/mc/8q/lqmc8qgoywmrc9t5ogsv3oravhk.png"></p><br><br><h2>  findings </h2><br><p>  I will not repeat what has been done, but will focus on ambiguous points. </p><br><p>  Logical, for example, the question "Why is the clock here?".  Answer: The clock is needed to fill the screen.  Although at present the digital clock is built into almost every household appliance, the hands have one advantage: the time scale, thanks to the dial, makes it easy to estimate the time to any event.  I will not argue - you can do without hours. </p><br><p>  What needs to be worked on: </p><br><p>  ‚Ä¢ Organize the power of the monitor from two AA batteries for a long time - not less than a year. </p><br><p>  ‚Ä¢ Appearance is not worth discussing - here everyone has their own views and possibilities.  For example, I like the <a href="https://habr.com/ru/users/avs24rus/" class="user_link">avs24rus</a> option, <a href="https://habr.com/ru/post/388449/">it used a 7 "display in a frame with 3D printing as a screen</a> . You can replace an expensive frame with a cheap baguette. And you can also see a portrait or a photo of children on the display in standby mode - you will also have original photo frame to boot </p><br><p>  If you are not very demanding on the aesthetic side of the question, then perhaps you are satisfied with something similar: </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/t9/mc/ad/t9mcadjmxmqqiseaztnhsj_odyw.png"></div><br><p>  Successes! </p><br><h2>  My bookmarks on the topic with Habra </h2><br><p>  1. <a href="https://habr.com/ru/post/252481/">Wi-Fi thermometer on ESP8266 + DS18B20 for only $ 4</a> </p><br><p>  2. <a href="https://habr.com/post/400975/">Compact home air monitor (CO2, temperature, humidity, pressure) with Wi-Fi and mobile interface</a> </p><br><p>  3. <a href="https://habr.com/ru/post/122601/">Practical experience using Blynk for CO2 sensor.</a>  <a href="https://habr.com/ru/post/122601/">Part 1</a> </p><br><p>  4. <a href="https://habr.com/ru/post/388449/">Using SPI Flash Display Memory to store graphic resources or display a home weather station</a> </p><br><p>  5. <a href="https://habr.com/ru/post/395755/">We measure the concentration of CO2 in the apartment with the help of MH-Z19</a> </p><br><p>  6. The <a href="https://habr.com/ru/post/401363/">dark side of the MH-Z19</a> </p><br><p>  7. <a href="https://habr.com/ru/post/395755/">We measure the concentration of CO2 in the apartment with the help of MH-Z19</a> </p><br><p>  Finally, thank <a href="https://habr.com/ru/users/kumekay/">@kumekay</a> for valuable advice. <br>  <a href="https://habr.com/ru/post/122601/">‚ÄúThe practical experience of using Blynk for a CO2 sensor</a> helped me to solve the problem of re-entering variables into the monitor‚Äôs memory <a href="https://habr.com/ru/post/122601/">.</a>  <a href="https://habr.com/ru/post/122601/">Part 1 ‚Äù</a> , <a href="https://habr.com/ru/users/a3x/">@ a3x</a> .  Deep diverse article! <br></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/442856/">https://habr.com/ru/post/442856/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442840/index.html">Backend United 3: Jelly</a></li>
<li><a href="../442844/index.html">Kapitan at the helm Kubernetes</a></li>
<li><a href="../442846/index.html">Our space industry. A look at the problems of the industry from the perspective of an ordinary developer</a></li>
<li><a href="../442852/index.html">Dell 6000 or hello from 2005</a></li>
<li><a href="../442854/index.html">How did we make the metro scheme of Minsk</a></li>
<li><a href="../442858/index.html">Are there too many elephants in Africa? How peaceful coexistence with human communities can help</a></li>
<li><a href="../442862/index.html">Proof-of-Stake: Inside View</a></li>
<li><a href="../442864/index.html">How old is your liege?</a></li>
<li><a href="../442866/index.html">AI, trained on the basis of decades of culinary experiments, creates new dishes</a></li>
<li><a href="../442868/index.html">A brief excursion into the data center cooling system. Advantages and disadvantages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>