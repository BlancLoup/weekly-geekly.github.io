<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Phalcon PHP freymork. Work with annotations</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""Vivo, presto, prestissimo ..." 

 About Phalcon is still not enough materials, but the framework is quite interesting and worthy of attention. One of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Phalcon PHP freymork. Work with annotations</h1><div class="post__text post__text-html js-mediator-article">  "Vivo, presto, prestissimo ..." <br><br>  About Phalcon is still not enough materials, but the framework is quite interesting and worthy of attention.  One of Phalcon's interesting solutions is its advanced annotation usage.  The parser is written in C, it works very fast.  Allows you to easily and naturally transfer part of the settings (almost most) from the configuration files to the code. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Part I. Vivo (Fast). </h4><br>  Assigning routes to Phalcon is quite a ‚Äúcreative‚Äù task. <br>  Many examples are full of different route assignments. <br>  On Habr√© even skipped an example of using xml files ... <br>  And this is at a time when many frameworks offer routing through annotations. <br>  And what about Phalcon? <br>  Phalcon modestly and quietly indicates in the documentation that routing on annotations is possible. <br>  And for this, the Phalcon authors simply created an annotation parser in C. <br>  First! <br>  What do you need to include annotations? <br>  Nothing at all. <br>  In the bootstrap file we implement the annotation service, just a few lines of code.  And that's all. <br><pre><code class="php hljs">... <span class="hljs-comment"><span class="hljs-comment">//set routers $di-&gt;set('router', function() { $router = new \Phalcon\Mvc\Router\Annotations(false); $router-&gt;removeExtraSlashes(true); $router-&gt;setUriSource(\Phalcon\Mvc\Router::URI_SOURCE_SERVER_REQUEST_URI); $router-&gt;addResource('Index', "/"); $router-&gt;notFound([ "controller" =&gt; "index", "action" =&gt; "page404" ]); return $router; }); ...</span></span></code> </pre> <br>  Now in the routes (including prefixes), we indicate directly in the controller. <br><pre> <code class="php hljs">... <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Post</span></span></span><span class="hljs-comment">("create") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ /... } ...</code> </pre><br>  For more details on routing (request types, parameters), see the documentation. <br><br><h4>  Part II.  Presto (Fast as possible) </h4><br>  Routing on annotations is, of course, good.  But we still have to deal with data in projects.  And here you can see one feature of Phalcon. <br>  When working with a database, it usually makes 3 requests. <br>  The 1st checks the presence of a table in the database. <br>  The 2nd gets the table metadata. <br>  3rd request directly. <br>  I do not know how it is right, I will not argue.  But somewhat uncomfortable. <br>  We do not need 3 requests.  We would like to have table metadata somewhere in store. <br>  In the cache, for example. <br>  And Phalcon is of the same opinion.  Therefore, it suggests storing metadata in the cache.  In this case, you can use annotations. <br>  Again DI, again botstrap: <br><pre> <code class="php hljs">... <span class="hljs-comment"><span class="hljs-comment">//Set a models manager $di-&gt;set('modelsManager', new \Phalcon\Mvc\Model\Manager()); //Set the models cache service $di-&gt;set('modelsCache', function() { //Cache data for one day by default $frontCache = new \Phalcon\Cache\Frontend\Data([ "lifetime" =&gt; 86400 ]); $cache = new \Phalcon\Cache\Backend\Memcache($frontCache, [ "host" =&gt; "localhost", "port" =&gt; "11211", 'persistent' =&gt; TRUE, ]); return $cache; }); $di-&gt;set('modelsMetadata', function() { // Create a meta-data manager with APC //$metaData = new \Phalcon\Mvc\Model\MetaData\Apc([ // "lifetime" =&gt; 86400, // "prefix" =&gt; "general-phsql" //]); $metaData = new \Phalcon\Mvc\Model\MetaData\Memory([ 'prefix' =&gt; 'general', ]); $metaData-&gt;setStrategy(new StrategyAnnotations()); return $metaData; }); ...</span></span></code> </pre><br>  After that, metadata, read only once, is stored in the cache. <br>  At the time of development, we can switch to storage in memory. <br><br>  Here, in principle, everything.  Again, more detail in the documentation. <br><br>  Well, there is nothing surprising in these mechanisms.  Except that it works very fast.  As quickly as it can be achieved in a component created in C. That is, almost imperceptibly. <br>  But these mechanisms also exist in other frameworks. <br>  We want something tasty, some raisin ... <br><br><h4>  Part III.  Prestissimo (Even faster). </h4><br>  Probably, it is no secret that when designing a site, you have to write admin panel. <br>  And these are forms, forms, and once again forms.  Many forms.  And this is tiring ... <br>  I want automation. <br>  What does the form consist of?  Of course, the key element is the input tag. <br>  It is usually of type type, length length, pattern fill pattern, etc. <br>  And all this for each form must be specified ... For each field of the table ... <br>  I want automation.  You do not want to write a lot of code. <br>  And describe the universal form for any entity. <br>  And here again we will need annotations.  Parser, again, on C. <br>  Phalcon offers the Phalcon \ Forms \ Form component. <br>  Take the simplest Users table.  Her model: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Frontend</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Users</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Phalcon</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mvc</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Primary</span></span></span><span class="hljs-comment"> * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Identity</span></span></span><span class="hljs-comment"> * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Column</span></span></span><span class="hljs-comment">(type="integer", nullable=false) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@FormOptions</span></span></span><span class="hljs-comment">(type=hidden) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $id; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Column</span></span></span><span class="hljs-comment">(type="string", nullable=false) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@FormOptions</span></span></span><span class="hljs-comment">(type=text, length=32) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $name; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Column</span></span></span><span class="hljs-comment">(type="integer", nullable=false) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@FormOptions</span></span></span><span class="hljs-comment">(type=email) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $email; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Column</span></span></span><span class="hljs-comment">(type="integer", nullable=false) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@FormOptions</span></span></span><span class="hljs-comment">(type=text, length=9, pattern='[0-9]{9}') */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $indcode; }</code> </pre><br>  Here we apply our own annotation, where we specify the options we need to build the form. <br>  Yes, we have invented this annotation now, ourselves, for use in a particular case. <br>  We have this @FormOptions.  In the type attribute, we specify the type of field we need for input. <br>  Phalcon offers the following types of <i>Phalcon \ Forms \ Element</i> : <br>  <b>Phalcon \ Forms \ Element \ Check</b> <b><br></b>  <b>Phalcon \ Forms \ Element \ Date</b> <b><br></b>  <b>Phalcon \ Forms \ Element \ Email</b> <b><br></b>  <b>Phalcon \ Forms \ Element \ File</b> <b><br></b>  <b>Phalcon \ Forms \ Element \ Hidden</b> <b><br></b>  <b>Phalcon \ Forms \ Element \ Numeric</b> <b><br></b>  <b>Phalcon \ Forms \ Element \ Password</b> <b><br></b>  <b>Phalcon \ Forms \ Element \ Select</b> <b><br></b>  <b>Phalcon \ Forms \ Element \ Submit</b> <b><br></b>  <b>Phalcon \ Forms \ Element \ Text</b> <b><br></b>  <b>Phalcon \ Forms \ Element \ TextArea</b> <br>  More than enough. <br>  It remains the case for small ... <br>  We need to somehow ‚Äúteach‚Äù Phalcon to recognize our annotations ... <br>  Nothing is easier! <br>  bootstrap - enable annotation parser. <br><pre> <code class="php hljs">... <span class="hljs-comment"><span class="hljs-comment">//Annotations $di-&gt;set('annotations', function() { return new \Phalcon\Annotations\Adapter\Memory(); }); ...</span></span></code> </pre><br>  During the development process, you can use a memory adapter, <br>  in production, you can switch to storage in files, APC, XCache. <br>  Now create a form class for any entity. <br><div class="spoiler">  <b class="spoiler_title">Form class</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phalcon</span></span>\<span class="hljs-title"><span class="hljs-title">Forms</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>, \<span class="hljs-title"><span class="hljs-title">Phalcon</span></span>\<span class="hljs-title"><span class="hljs-title">Forms</span></span>\<span class="hljs-title"><span class="hljs-title">Element</span></span>\<span class="hljs-title"><span class="hljs-title">Submit</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">Submit</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityForm</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $fields = []; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $classprefix = <span class="hljs-string"><span class="hljs-string">'\\Phalcon\\Forms\\Element\\'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $action; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> object $model, action */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($model, $action)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;action = $action; <span class="hljs-comment"><span class="hljs-comment">//      $object = $model; $this-&gt;setEntity($object); //   $attributes = $this-&gt;modelsMetadata-&gt;getAttributes($object); //     $metadata = $this-&gt;annotations-&gt;get($object); //   @FormOptions foreach ( $attributes as $attribute ) { $this-&gt;fields[$attribute] = $metadata -&gt;getPropertiesAnnotations()[$attribute] -&gt;get('FormOptions') -&gt;getArguments(); } //       foreach ($this-&gt;fields as $field =&gt; $type) { $fieldtype = array_shift($type); //  type       $fieldclass = $this-&gt;classprefix.$fieldtype; $this-&gt;add(new $fieldclass($field, $type)); // label     if ( $fieldtype !== 'hidden') { $this-&gt;get($field)-&gt;setLabel($this-&gt;get($field)-&gt;getName()); } } //    $this-&gt;add(new Submit('submit',[ 'value' =&gt; 'Send', ])); } public function renderform() { echo $this-&gt;tag-&gt;form([ $this-&gt;action, 'id' =&gt; 'actorform', ]); //fill form tags foreach ($this as $element) { // collect messages $messages = $this-&gt;getMessagesFor($element-&gt;getName()); if (count($messages)) { // each element render echo '&lt;div class="messages"&gt;'; foreach ($messages as $message) { echo $message; } echo '&lt;/div&gt;'; } echo '&lt;div&gt;'; echo '&lt;label for="', $element-&gt;getName(), '"&gt;', $element-&gt;getLabel(), '&lt;/label&gt;'; echo $element; echo '&lt;/div&gt;'; } echo $this-&gt;tag-&gt;endForm(); } }</span></span></code> </pre><br></div></div><br>  Here, when we initialize the EntityForm class, we read the metadata of the passed object and its annotation. <br>  After that we implement all the necessary fields in the form. <br>  The renderform function simply displays our form in a browser. <br><br>  Let's go back to the controller, and create a form output action: <br><pre> <code class="php hljs">... <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Get</span></span></span><span class="hljs-comment">("form") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $myform = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EntityForm(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Users(), <span class="hljs-string"><span class="hljs-string">'create'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;setVars([ <span class="hljs-string"><span class="hljs-string">'myform'</span></span> =&gt; $myform, ]); } ...</code> </pre><br>  and recipient: <br><pre> <code class="php hljs">... <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Post</span></span></span><span class="hljs-comment">("create") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;pre&gt;'</span></span>; var_dump($_POST); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;/pre&gt;'</span></span>; } ...</code> </pre><br>  It remains only to display the form in the output template (Volt): <br> <code><b>{{ myform.renderform() }}</b></code> <br>  That's all. <br>  Of course, you need to add to the class form CSRF protection, data validation, preservation. <br>  But the task of this article is to show the simplicity and usability of annotations in Phalcon. <br>  These features are provided to us through the powerful and fast annotation parser PhalconPHP. <br>  And when you start using Phalcon, you understand that it is really fast. <br>  And not only in the output ‚ÄúHello, world!‚Äù. <br>  The speed and convenience of working with Phalcon is really amazing. <br><div class="spoiler">  <b class="spoiler_title">index.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phalcon</span></span>\<span class="hljs-title"><span class="hljs-title">Mvc</span></span>\<span class="hljs-title"><span class="hljs-title">View</span></span>\<span class="hljs-title"><span class="hljs-title">Engine</span></span>\<span class="hljs-title"><span class="hljs-title">Volt</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phalcon</span></span>\<span class="hljs-title"><span class="hljs-title">Mvc</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">MetaData</span></span>\<span class="hljs-title"><span class="hljs-title">Strategy</span></span>\<span class="hljs-title"><span class="hljs-title">Annotations</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">StrategyAnnotations</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">//Register an autoloader $loader = new \Phalcon\Loader(); $loader-&gt;registerDirs([ '../app/controllers/', '../app/models/', '../app/forms/' ]); $loader-&gt;registerNamespaces([ 'Frontend\\Model' =&gt; __DIR__.'/../app/models/', ]); $loader-&gt;register(); //Create a DI $di = new \Phalcon\DI\FactoryDefault(); //Set a models manager $di-&gt;set('modelsManager', new \Phalcon\Mvc\Model\Manager()); //Set the models cache service $di-&gt;set('modelsCache', function() { //Cache data for one day by default $frontCache = new \Phalcon\Cache\Frontend\Data([ "lifetime" =&gt; 86400 ]); $cache = new \Phalcon\Cache\Backend\Memcache($frontCache, [ "host" =&gt; "localhost", "port" =&gt; "11211", 'persistent' =&gt; TRUE, ]); return $cache; }); $di-&gt;set('modelsMetadata', function() { // Create a meta-data manager with APC //$metaData = new \Phalcon\Mvc\Model\MetaData\Apc([ // "lifetime" =&gt; 86400, // "prefix" =&gt; "general-phsql" //]); $metaData = new \Phalcon\Mvc\Model\MetaData\Memory([ 'prefix' =&gt; 'general', ]); $metaData-&gt;setStrategy(new StrategyAnnotations()); return $metaData; }); //SQL profiler $di-&gt;set('profiler', function(){ return new \Phalcon\Db\Profiler(); }, true); //set database connection $di-&gt;set('db', function() use ($di) { $eventsManager = new \Phalcon\Events\Manager(); //Get a shared instance of the DbProfiler $profiler = $di-&gt;getProfiler(); //Listen all the database events $eventsManager-&gt;attach('db', function($event, $connection) use ($profiler) { if ($event-&gt;getType() == 'beforeQuery') { $profiler-&gt;startProfile($connection-&gt;getSQLStatement()); } if ($event-&gt;getType() == 'afterQuery') { $profiler-&gt;stopProfile(); } }); $connection = new \Phalcon\Db\Adapter\Pdo\Mysql([ "host" =&gt; "localhost", "username" =&gt; "root", "password" =&gt; "12345", "dbname" =&gt; "general" ]); //Assign the eventsManager to the db adapter instance $connection-&gt;setEventsManager($eventsManager); return $connection; }); //Register Volt as a service $di-&gt;set('voltService', function($view, $di) { $volt = new Volt($view, $di); $volt-&gt;setOptions([ "compiledPath" =&gt; "../app/cache/", ]); return $volt; }); //Setting up the view component $di-&gt;set('view', function(){ $view = new \Phalcon\Mvc\View(); $view-&gt;setViewsDir('../app/views/'); $view-&gt;registerEngines([ ".volt" =&gt; 'voltService' ]); return $view; }); //Create Form manager $di-&gt;set('forms', function() { $forms = new \Phalcon\Forms\Manager(); return $forms; }); $di-&gt;set('session', function() use($di) { $session = new Phalcon\Session\Adapter\Files(); $session-&gt;setoptions([ 'uniqueId' =&gt; 'privatRsc', ]); $session-&gt;start(); return $session; }); //set routers $di-&gt;set('router', function() { $router = new \Phalcon\Mvc\Router\Annotations(false); $router-&gt;removeExtraSlashes(true); $router-&gt;setUriSource(\Phalcon\Mvc\Router::URI_SOURCE_SERVER_REQUEST_URI); $router-&gt;addResource('Index', "/"); $router-&gt;notFound([ "controller" =&gt; "index", "action" =&gt; "page404" ]); return $router; }); //Annotations $di-&gt;set('annotations', function() { return new \Phalcon\Annotations\Adapter\Memory(); }); //Handle the request $application = new \Phalcon\Mvc\Application($di); echo $application-&gt;handle()-&gt;getContent(); } catch(\Phalcon\Exception $e) { echo "PhalconException: ", $e-&gt;getMessage(); }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">IndexController.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> \<span class="hljs-title"><span class="hljs-title">Frontend</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">Users</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">Users</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@RoutePrefix</span></span></span><span class="hljs-comment">("/") **/</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IndexController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Phalcon</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mvc</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Get</span></span></span><span class="hljs-comment">("") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> &lt;h3&gt;Index Action&lt;/h3&gt;; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Get</span></span></span><span class="hljs-comment">("form") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $myform = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EntityForm(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Users(), <span class="hljs-string"><span class="hljs-string">'create'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;setVars([ <span class="hljs-string"><span class="hljs-string">'myform'</span></span> =&gt; $myform, ]); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Post</span></span></span><span class="hljs-comment">("create") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;pre&gt;'</span></span>; var_dump($_POST); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;/pre&gt;'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Get</span></span></span><span class="hljs-comment">("page404") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">page404Action</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'404 - route not found'</span></span>; } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">EntityForm.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phalcon</span></span>\<span class="hljs-title"><span class="hljs-title">Forms</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>, \<span class="hljs-title"><span class="hljs-title">Phalcon</span></span>\<span class="hljs-title"><span class="hljs-title">Forms</span></span>\<span class="hljs-title"><span class="hljs-title">Element</span></span>\<span class="hljs-title"><span class="hljs-title">Submit</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">Submit</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityForm</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $fields = []; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $classprefix = <span class="hljs-string"><span class="hljs-string">'\\Phalcon\\Forms\\Element\\'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $action; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> object $model, action */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($model, $action)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;action = $action; <span class="hljs-comment"><span class="hljs-comment">//Set fields options from annotations $object = $model; $this-&gt;setEntity($object); $attributes = $this-&gt;modelsMetadata-&gt;getAttributes($object); $metadata = $this-&gt;annotations-&gt;get($object); foreach ( $attributes as $attribute ) { $this-&gt;fields[$attribute] = $metadata -&gt;getPropertiesAnnotations()[$attribute] -&gt;get('FormOptions') -&gt;getArguments(); } foreach ($this-&gt;fields as $field =&gt; $type) { $fieldtype = array_shift($type); $fieldclass = $this-&gt;classprefix.$fieldtype; $this-&gt;add(new $fieldclass($field, $type)); if ( $fieldtype !== 'hidden') { $this-&gt;get($field)-&gt;setLabel($this-&gt;get($field)-&gt;getName()); } } $this-&gt;add(new Submit('submit',[ 'value' =&gt; 'Send', ])); } public function renderform() { echo $this-&gt;tag-&gt;form([ $this-&gt;action, 'id' =&gt; 'actorform', ]); //fill form tags foreach ($this as $element) { // collect messages $messages = $this-&gt;getMessagesFor($element-&gt;getName()); if (count($messages)) { // each element render echo '&lt;div class="messages"&gt;'; foreach ($messages as $message) { echo $message; } echo '&lt;/div&gt;'; } echo '&lt;div&gt;'; echo '&lt;label for="', $element-&gt;getName(), '"&gt;', $element-&gt;getLabel(), '&lt;/label&gt;'; echo $element; echo '&lt;/div&gt;'; } echo $this-&gt;tag-&gt;endForm(); } }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Users.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Frontend</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Users</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Phalcon</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mvc</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Primary</span></span></span><span class="hljs-comment"> * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Identity</span></span></span><span class="hljs-comment"> * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Column</span></span></span><span class="hljs-comment">(type="integer", nullable=false) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@FormOptions</span></span></span><span class="hljs-comment">(type=hidden) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $id; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Column</span></span></span><span class="hljs-comment">(type="string", nullable=false) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@FormOptions</span></span></span><span class="hljs-comment">(type=text, length=32) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $name; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Column</span></span></span><span class="hljs-comment">(type="integer", nullable=false) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@FormOptions</span></span></span><span class="hljs-comment">(type=email) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $email; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Column</span></span></span><span class="hljs-comment">(type="integer", nullable=false) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@FormOptions</span></span></span><span class="hljs-comment">(type=text, length=9, pattern='[0-9]{9}') */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $indcode; }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">form.volt</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Test form in Volt<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag">&gt;</span></span> {{ myform.renderform() }} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div></div><p>Source: <a href="https://habr.com/ru/post/197254/">https://habr.com/ru/post/197254/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../197232/index.html">Why i left google</a></li>
<li><a href="../197234/index.html">Ru-Center was fined 239 million rubles for frauds with. rf domains</a></li>
<li><a href="../197238/index.html">Latent semantic analysis and python search</a></li>
<li><a href="../197250/index.html">DIY: plastic for 3d printer</a></li>
<li><a href="../197252/index.html">Video demo of Steam Controller</a></li>
<li><a href="../197258/index.html">Never Gonna Give Your Terminal</a></li>
<li><a href="../197262/index.html">Using Lua Scripts in .NET with LuaInterface</a></li>
<li><a href="../197266/index.html">The file to be committed before leaving work</a></li>
<li><a href="../197268/index.html">In space, discovered a strange lonely planet without a star</a></li>
<li><a href="../197270/index.html">IStruct - evolution continues</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>