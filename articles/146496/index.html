<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write the emulator prefix P2, or a little about CHIP16</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my previous short note, I described the principle of building an emulator of the old gaming platform CHIP-8 from the distant 70s. Here we will talk...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write the emulator prefix P2, or a little about CHIP16</h1><div class="post__text post__text-html js-mediator-article">  In my previous short <a href="http://habrahabr.ru/post/100907/">note,</a> I described the principle of building an emulator of the old gaming platform CHIP-8 from the distant 70s.  Here we will talk about a kind of heiress - CHIP16.  So what is CHIP16? <br><br><img src="https://habrastorage.org/storage2/76e/9c3/622/76e9c36222f5fe612d68dcc8a2779f2a.png" align="right">  CHIP16 - ‚Äúfictional‚Äù game console, which has never existed in the ‚Äúhardware‚Äù.  All the specifications for it were developed by enthusiasts from <a href="http://forums.ngemu.com/showthread.php%3Ft%3D145620">one English-speaking forum</a> .  The point is to make emulator writing as simple as possible, to have good documentation and community support.  Thereby allowing even beginners in programming to create a fully working emulator from scratch in virtually any programming language.  At once I will make a reservation that here I will not give examples of the code of the emulator, the goal is just to tell about this platform.  And yes, of course, all Just for fun! <br><br><a name="habracut"></a><br><h4>  Prehistory </h4><br><img src="https://habrastorage.org/storage2/378/735/bff/378735bff7957d5ec7462c1b2ebfe3a6.png" align="left">  It all started <a href="http://forums.ngemu.com/showthread.php%3Ft%3D138170">somewhere in 2010</a> , since the specification has acquired the version number 1.1, the main shortcomings were eliminated, the main tools were written to create games and other programs for this platform (assembler, debugger, image converter, etc.).  The main difference from the same CHIP-8 is the presence of a larger screen resolution, more colors, more arithmetic and other instructions, improved support for sound and no undocumented features. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The prefix has a 16-bit processor, memory, two input devices (joysticks such as Dendy), an audio and video subsystem.  Consider the whole bunch in more detail. <br><br><h5>  CPU </h5><br>  The processor includes: <br><ul><li>  One 16-bit command counter (PC) </li><li>  One 16-bit stack pointer (SP) </li><li>  Sixteen 16-bit general purpose registers (R0 - RF) </li><li>  One 8-Bit Flag Register </li></ul><br>  The execution of each opcode (processor command) takes exactly one cycle, the processor runs at a frequency of 1 Mhz.  Here I will make a reservation that, in fact, as long as the frequency is not clear to the end, and each team performs faster on the emulator than 1 Mhz.  Sometimes with maximum emulation speed.  In general, while you can not bother about this. <br><br><h5>  Memory </h5><br>  Total 64Kb (65536 bytes).  The memory is distributed as follows: <br>  0x0000 - Start of binary data <br>  0xFDF0 - Start of the stack (512 bytes). <br>  0xFFF0 - I / O ports (I / O, to track the status of joysticks). <br><br><h5>  Video </h5><br>  The screen resolution is 320x240 pixels.  The number of colors displayed at one time is 16 from the standard palette. <br><table><tbody><tr><th>  Index in the palette </th><th>  Sixteen.  value </th><th>  Colour </th></tr><tr><td>  0x0 </td><td>  0x000000 </td><td>  Black, transparent on the background layer </td></tr><tr><td>  0x1 </td><td>  0x000000 </td><td>  The black </td></tr><tr><td>  0x2 </td><td>  0x888888 </td><td>  Gray </td></tr><tr><td>  0x3 </td><td>  0xBF3932 </td><td>  Red </td></tr><tr><td>  0x4 </td><td>  0xDE7AAE </td><td>  Pink </td></tr><tr><td>  0x5 </td><td>  0x4C3D21 </td><td>  Dark brown </td></tr><tr><td>  0x6 </td><td>  0x905F25 </td><td>  Brown </td></tr><tr><td>  0x7 </td><td>  0xE49452 </td><td>  Orange </td></tr><tr><td>  0x8 </td><td>  0xEAD979 </td><td>  Yellow </td></tr><tr><td>  0x9 </td><td>  0x537A3B </td><td>  Green </td></tr><tr><td>  0xA </td><td>  0xABD54A </td><td>  Light green </td></tr><tr><td>  0xB </td><td>  0x252E38 </td><td>  Navy blue </td></tr><tr><td>  0xC </td><td>  0x00467F </td><td>  Blue </td></tr><tr><td>  0xD </td><td>  0x68ABCC </td><td>  Light blue </td></tr><tr><td>  0xE </td><td>  0xBCDEE4 </td><td>  Sky blue </td></tr><tr><td>  0xF </td><td>  0xFFFFFF </td><td>  White </td></tr></tbody></table><br><img src="https://habrastorage.org/storage2/c43/f00/f2f/c43f00f2f4f9584c3e31a6a42e912f35.png" align="right">  It is possible to set your own color palette.  The refresh rate of the screen is 60 frames per second, with each frame being set to an internal Vblank flag (every ~ 16ms).  The processor has the opportunity to wait for the completion of frame rendering using the <b>VBLNK</b> instruction.  The image is formed from sprites, there is no direct access to the video memory.  In addition to the main layer where sprites are drawn, there is a background layer that fills the entire screen with one of 16 colors. <br><br>  The screen is not mirrored, so everything that does not fit into the physical coordinates remains behind the screen and is not displayed.  From this it follows that sprites may have negative coordinates (or exceeding 320x200).  If you take a 4x4 pixel sprite and, for example, give the command to draw it according to the coordinates (-2, -2), then in the upper left corner of the screen a part of the sprite with a size of 2x2 pixels will be displayed. <br><br>  So, as all possible colors in a palette 16, then 4 bits are necessary to encode one point on the screen.  One byte is a block of two points.  The minimum sprite consists of one byte - it is a sprite of 2x1 (two points).  Let's take a look at how to encode an 8x5 pixel sprite, considering that the white color in the standard palette is the color with the index 0xFh, and the black color with the index 0x1h <br><img src="https://habrastorage.org/storage2/406/faa/4b8/406faa4b8d7537396fd3471746077e7b.png"><br>  Total, 20 bytes.  That is (8 x 5) / 2 = 20 <br><br>  If the new sprite overlaps any already existing pixels on the screen (with the exception of pixels with zero color - they are transparent), then the carry flag is set.  Thus, it is possible to track collisions and collisions of objects on the screen in games. <br>  To assign your own color palette instead of the standard, there is a special <b>PAL</b> processor command.  Each color palette consists of 3 bytes, in RGB format.  Since only 16 colors are used, the PAL command reads an array of 48 bytes from memory and assigns RGB components to colors with indices 0x0, 0x1, .., 0xF.  The palette is replaced after the processor <b>receives the VBLNK command</b> . <br><br><h5>  Sound </h5><br>  In the initial versions there was an opportunity to play only three fixed tones (500Hz, 1000Hz, 1500Hz) for a certain number of milliseconds, but then the ability to use an <a href="http://ru.wikipedia.org/wiki/ADSR-%25D0%25BE%25D0%25B3%25D0%25B8%25D0%25B1%25D0%25B0%25D1%258E%25D1%2589%25D0%25B0%25D1%258F">ADSR</a> sound generator was added <br><br><h5>  Input Devices (Joysticks) </h5><br>  Access to information from the joysticks is carried out by means of memory-mapped I / O ports.  The first joystick at 0xFFF0, the second - 0xFFF2. <br>  Bit [0] - Up (Up) <br>  Bit [1] - Down (Down) <br>  Bit [2] - Left (Left) <br>  Bit [3] - Right (Right) <br>  Bit [4] - Select <br>  Bit [5] - Start (Start) <br>  Bit [6] - A <br>  Bit [7] - B <br>  Bit [8 - 15] - Not used, always zero. <br><br>  Thus, by reading the value from the memory at 0xFFF0 into the register and checking the corresponding bits set, you can track which buttons are currently pressed on the first joystick. <br><br><h5>  Image file format (ROM files) </h5><br>  The ROM file (standard .c16 extension) contains the header and binary data immediately after the header.  Information from the header can be used to determine the version of the specification, etc. The header has a constant size of 16 bytes.  Its format is: <br><table><tbody><tr><th>  Bias </th><th>  Purpose </th></tr><tr><td>  0x00 </td><td>  Magic number 'CH16' </td></tr><tr><td>  0x04 </td><td>  Reserved </td></tr><tr><td>  0x05 </td><td>  The specification version (the first 4 bits = the main version, the second 4 bits = a sub version, that is, 0.7 = 0x07 and 1.0 = 0x10) </td></tr><tr><td>  0x06 </td><td>  ROM file size (not including header, in bytes) </td></tr><tr><td>  0x0A </td><td>  Start Address (PC Command Counter Value) </td></tr><tr><td>  0x0C </td><td>  CRC32 checksum (not including header, polynomial = 0x04c11db7) </td></tr></tbody></table><br>  Immediately behind him begin binary data, which must always be read into memory starting at address 0x0000.  The command counter must be set according to the value in the header.  As a rule, this is 0x0000. <br><br>  ROM files may not have a header at all, since it was introduced into the specification relatively recently. <br><br><h5>  Flag register </h5><br><table><tbody><tr><td>  Bit [0] </td><td>  Reserved </td></tr><tr><td>  Bit [1] </td><td>  c - carry flag (unsigned overflow) </td></tr><tr><td>  Bit [2] </td><td>  z - zero flag </td></tr><tr><td>  Bit [3] </td><td>  Reserved </td></tr><tr><td>  Bit [4] </td><td>  Reserved </td></tr><tr><td>  Bit [5] </td><td>  Reserved </td></tr><tr><td>  Bit [6] </td><td>  o - Overflow (overflow of signed numbers) </td></tr><tr><td>  Bit [7] </td><td>  n - negative (flag of a negative sign) </td></tr></tbody></table><br><br><h5>  Condition types for conditional jump instructions </h5><br>  Conditions are used for conditional jump (jumps) commands or conditional subroutine call commands.  For example: ‚Äújle label‚Äù or ‚Äúcno some_label2‚Äù.  In brackets is the state of the flags when the condition is triggered. <br><table><tbody><tr><td>  Z </td><td>  0x0 </td><td>  [z == 1] </td><td>  Equal (Zero) </td></tr><tr><td>  Nz </td><td>  0x1 </td><td>  [z == 0] </td><td>  Not Equal (Non-Zero) </td></tr><tr><td>  N </td><td>  0x2 </td><td>  [n == 1] </td><td>  Negative </td></tr><tr><td>  Nn </td><td>  0x3 </td><td>  [n == 0] </td><td>  Not-Negative (Positive or Zero) </td></tr><tr><td>  P </td><td>  0x4 </td><td>  [n == 0 &amp;&amp; z == 0] </td><td>  Positive </td></tr><tr><td>  O </td><td>  0x5 </td><td>  [o == 1] </td><td>  Overflow </td></tr><tr><td>  NO </td><td>  0x6 </td><td>  [o == 0] </td><td>  No overflow </td></tr><tr><td>  A </td><td>  0x7 </td><td>  [c == 0 &amp;&amp; z == 0] </td><td>  Above (Unsigned Greater Than) </td></tr><tr><td>  AE </td><td>  0x8 </td><td>  [c == 0] </td><td>  Above Equal (Unsigned Greater Than or Equal) </td></tr><tr><td>  B </td><td>  0x9 </td><td>  [c == 1] </td><td>  Below (Unsigned Less Than) </td></tr><tr><td>  BE </td><td>  0xA </td><td>  [c == 1 ||  z == 1] </td><td>  Below Equal (Unsigned Less Than or Equal) </td></tr><tr><td>  G </td><td>  0xB </td><td>  [o == n &amp;&amp; z == 0] </td><td>  Signed Greater Than </td></tr><tr><td>  Ge </td><td>  0xC </td><td>  [o == n] </td><td>  Signed Greater Than or Equal </td></tr><tr><td>  L </td><td>  0xD </td><td>  [o! = n] </td><td>  Signed less than </td></tr><tr><td>  LE </td><td>  0xE </td><td>  [o! = n ||  z == 1] </td><td>  Signed Less Than or Equal </td></tr></tbody></table><br><br>  You can also use alternative mnemonics: <br><table><tbody><tr><td>  NC </td><td>  0x8 </td><td>  [c == 0] </td><td>  Not Carry (Same as AE) </td></tr><tr><td>  C </td><td>  0x9 </td><td>  [c == 1] </td><td>  Carry (Same as B) </td></tr></tbody></table><br><br><h5>  Processor commands </h5><br>  Any CHIP16 opcode takes exactly 4 bytes (32 bits). <br>  HH - high byte. <br>  LL - Junior Fight. <br>  N - nibble (4-bit value). <br>  X, Y, Z - 4-bit register identifier. <br><br><table cellpadding="2" cellspacing="1"><tbody><tr><th> Opcode </th><th>  Mnemonics </th><th>  Using </th></tr><tr><td>  00 00 00 00 </td><td>  NOP </td><td>  No operation, just one processor cycle </td></tr><tr><td>  01 00 00 00 </td><td>  CLS </td><td>  Cleaning the screen (the main layer is cleared, the background color is set to the color with index 0) </td></tr><tr><td>  02 00 00 00 </td><td>  VBLNK </td><td>  Wait for vertical sync.  If the frame did not have time to draw, then PC- = 4 </td></tr><tr><td>  03 00 0N 00 </td><td>  BGC N </td><td>  Set the background color with the index N. If the index is 0, then the background color is black </td></tr><tr><td>  04 00 LL HH </td><td>  SPR HHLL </td><td>  Set the size of the sprite: width (LL) and height (HH) </td></tr><tr><td>  05 YX LL HH </td><td>  DRW RX, RY, HHLL </td><td>  Draw a sprite from the address in the HHLL memory on the coordinates specified in the registers X and Y. The result affects the carry flag </td></tr><tr><td>  06 YX 0Z 00 </td><td>  DRW RX, RY, RZ </td><td>  Draw a sprite from the address in memory, which is indicated by the Z register according to the coordinates specified in the X and Y registers. The result affects the carry flag </td></tr><tr><td>  07 0X LL HH </td><td>  RND RX, HHLL </td><td>  Put a random number in register X. The maximum value is set to HHLL </td></tr><tr><td>  08 00 00 00 </td><td>  FLIP 0, 0 </td><td>  Set the display orientation of the sprite.  Horizontal flip = NO, vertical flip = NO </td></tr><tr><td>  08 00 00 01 </td><td>  FLIP 0, 1 </td><td>  Set the display orientation of the sprite.  Horizontal flip = NO, vertical flip = YES </td></tr><tr><td>  08 00 00 02 </td><td>  FLIP 1, 0 </td><td>  Set the display orientation of the sprite.  Horizontal flip = YES, vertical flip = NO </td></tr><tr><td>  08 00 00 03 </td><td>  FLIP 1, 1 </td><td>  Set the display orientation of the sprite.  Horizontal coup = YES, vertical coup = YES </td></tr><tr><td>  09 00 00 00 </td><td>  Snd0 </td><td>  Stop playing sound </td></tr><tr><td>  0A 00 LL HH </td><td>  SND1 HHLL </td><td>  Play 500Hz HHLL tone milliseconds </td></tr><tr><td>  0B 00 LL HH </td><td>  Snd2 hhll </td><td>  Play 1000Hz HHLL tone milliseconds </td></tr><tr><td>  0C 00 LL HH </td><td>  SND3 HHLL </td><td>  Play 1500Hz HHLL tone milliseconds </td></tr><tr><td>  0D 0X LL HH </td><td>  SNP RX, HHLL </td><td>  Play a sound tone for HHLL milliseconds, in accordance with the current sound generator, set at HHLL </td></tr><tr><td>  0E AD SR VT </td><td>  SNG AD, VTSR </td><td>  ADSR Sound Generator <br><table><tbody><tr><td>  A = attack (0..15) </td></tr><tr><td>  D = decay (0..15) </td></tr><tr><td>  S = sustain (0..15, volume) </td></tr><tr><td>  R = release (0..15) </td></tr><tr><td>  V = volume (0..15) </td></tr><tr><td>  T = type of sound: </td></tr><tr><td><ul><li>  00 = triangle wave </li><li>  01 = sawtooth wave </li><li>  02 = pulse wave (is just square for now) </li><li>  03 = noise </li><li>  If the values ‚Äã‚Äãare incorrect, no sound is played. </li></ul><br></td></tr></tbody></table><br></td></tr><tr><td>  10 00 LL HH </td><td>  JMP HHLL </td><td>  Go to the specified address HHLL </td></tr><tr><td>  12 0x LL HH </td><td>  Jx hhll </td><td>  Go to the specified HHLL address subject to the condition 'x'.  (see Condition Types) </td></tr><tr><td>  13 YX LL HH </td><td>  JME RX, RY, HHLL </td><td>  Go to the specified address HHLL if the register X is equal to the register Y </td></tr><tr><td>  16 0X 00 00 </td><td>  Jmp rx </td><td>  Go to address specified in register X </td></tr><tr><td>  14 00 LL HH </td><td>  CALL HHLL </td><td>  Call a subroutine at HHLL.  Saves PC to [SP], increases SP by 2 </td></tr><tr><td>  15 00 00 00 </td><td>  RET </td><td>  Return from subroutine.  Decreases SP by 2 and recovers PC from [SP] </td></tr><tr><td>  17 0x LL HH </td><td>  Cx hhll </td><td>  If the 'x' condition is met, then the subroutine call.  (see Condition Types) </td></tr><tr><td>  18 0X 00 00 </td><td>  CALL RX </td><td>  Call the subroutine at the address in register X. Saves the PC to [SP], increases the SP by 2 </td></tr><tr><td>  20 0X LL HH </td><td>  LDI RX, HHLL </td><td>  Put the immediate HHLL value in register X </td></tr><tr><td>  21 00 LL HH </td><td>  LDI SP, HHLL </td><td>  Set stack pointer to HHLL address.  Does not move the old values ‚Äã‚Äãin the stack to the new address </td></tr><tr><td>  22 0X LL HH </td><td>  LDM RX, HHLL </td><td>  Put in the register X 16-bit value from the memory at the address HHLL </td></tr><tr><td>  22 YX 00 00 </td><td>  LDM RX, RY </td><td>  Put in the register X 16-bit value from memory at the address pointed to by the register Y </td></tr><tr><td>  24 YX 00 00 </td><td>  MOV RX, RY </td><td>  Copy the value of the register Y to the register X </td></tr><tr><td>  30 0X LL HH </td><td>  STM RX, HHLL </td><td>  Store X register in memory at HHLL </td></tr><tr><td>  31 YX 00 00 </td><td>  STM RX, RY </td><td>  Store the value of register X in memory at the address in the register Y </td></tr><tr><td>  40 0X LL HH </td><td>  ADDI RX, HHLL </td><td>  Add the immediate HHLL value to the X register. Affects the flags [c, z, o, n] </td></tr><tr><td>  41 YX 00 00 </td><td>  ADD RX, RY </td><td>  Add the value of the register Y to the register X. The result is placed in the register X. Affects the flags [c, z, o, n] </td></tr><tr><td>  42 YX 0Z 00 </td><td>  ADD RX, RY, RZ </td><td>  Add the value of the register Y to the register X. The result is placed in the register Z. Affects the flags [c, z, o, n] </td></tr><tr><td>  50 0X LL HH </td><td>  SUBI RX, HHLL </td><td>  Subtract the immediate HHLL value from the X register. The result is in the X register. Affects the flags [c, z, o, n] </td></tr><tr><td>  51 YX 00 00 </td><td>  SUB RX, RY </td><td>  Subtract the value of the register Y from the register X. The result is placed in the register X. Affects the flags [c, z, o, n] </td></tr><tr><td>  52 YX 0Z 00 </td><td>  SUB RX, RY, RZ </td><td>  Subtract the value of the register Y from the register X. The result is placed in the register Z. Affects the flags [c, z, o, n] </td></tr><tr><td>  53 0X LL HH </td><td>  CMPI RX, HHLL </td><td>  Subtract the immediate HHLL value from register X. The result is not saved.  Affects flags [c, z, o, n] </td></tr><tr><td>  54 YX 00 00 </td><td>  CMP RX, RY </td><td>  Subtract the value of register Y from register X. The result is not saved.  Affects flags [c, z, o, n] </td></tr><tr><td>  60 0X LL HH </td><td>  ANDI RX, HHLL </td><td>  Logical operation 'And' immediate values ‚Äã‚Äãof HHLL to the register X. The result in the register X. Affects the flags [z, n] </td></tr><tr><td>  61 YX 00 00 </td><td>  AND RX, RY </td><td>  Logical operation 'And' values ‚Äã‚Äãin the register Y to the register X. The result is placed in the register X. Affects the flags [z, n] </td></tr><tr><td>  62 YX 0Z 00 </td><td>  AND RX, RY, RZ </td><td>  Logical operation 'And' values ‚Äã‚Äãin the register Y to the register X. The result is placed in the register Z. Affects the flags [z, n] </td></tr><tr><td>  63 0X LL HH </td><td>  TSTI RX, HHLL </td><td>  Logical operation 'And' direct value HHLL to register X. The result is not saved.  Affects flags [z, n] </td></tr><tr><td>  64 YX 00 00 </td><td>  TST RX, RY </td><td>  Logical operation 'And' values ‚Äã‚Äãin the register Y to the register X. The result is not saved.  Affects flags [z, n] </td></tr><tr><td>  70 0X LL HH </td><td>  ORI RX, HHLL </td><td>  Logical operation 'OR' immediate HHLL values ‚Äã‚Äãto the register X. The result in the register X. Affects the flags [z, n] </td></tr><tr><td>  71 YX 00 00 </td><td>  OR RX, RY </td><td>  Logical operation 'OR' values ‚Äã‚Äãin register Y to register X. The result is placed in register X. Affects flags [z, n] </td></tr><tr><td>  72 YX 0Z 00 </td><td>  OR RX, RY, RZ </td><td>  Logical operation 'OR' values ‚Äã‚Äãin the register Y to the register X. The result is placed in the register Z. Affects the flags [z, n] </td></tr><tr><td>  80 0X LL HH </td><td>  XORI RX, HHLL </td><td>  The logical operation 'XOR' of the immediate value of the HHLL to the register X. The result in the register X. Affects the flags [z, n] </td></tr><tr><td>  81 YX 00 00 </td><td>  XOR RX, RY </td><td>  The logical operation 'XOR' values ‚Äã‚Äãin the register Y to the register X. The result is placed in the register X. Affects the flags [z, n] </td></tr><tr><td>  82 YX 0Z 00 </td><td>  XOR RX, RY, RZ </td><td>  The logical operation 'XOR' values ‚Äã‚Äãin the register Y to the register X. The result is placed in the register Z. Affects the flags [z, n] </td></tr><tr><td>  90 0X LL HH </td><td>  MULI RX, HHLL </td><td>  Multiply the immediate HHLL value by the X register. The result is in the X register. It affects the flags [c, z, n] </td></tr><tr><td>  91 YX 00 00 </td><td>  MUL RX, RY </td><td>  Multiplying the value in the Y register by the X register. The result is placed in the X register. Affects the flags [c, z, n] </td></tr><tr><td>  92 YX 0Z 00 </td><td>  MUL RX, RY, RZ </td><td>  The multiplication of the value in the register Y by the register X. The result is placed in the register Z. Affects the flags [c, z, n] </td></tr><tr><td>  A0 0X LL HH </td><td>  DIVI RX, HHLL </td><td>  Division of register X by the immediate value of HHLL.  Result in register X. Affects flags [c, z, n] </td></tr><tr><td>  A1 YX 00 00 </td><td>  DIV RX, RY </td><td>  Division of register X by value in register Y. The result is placed in register X. Affects flags [c, z, n] </td></tr><tr><td>  A2 YX 0Z 00 </td><td>  DIV RX, RY, RZ </td><td>  Division of register X by value in register Y. The result is placed in register X. Affects flags [c, z, n] </td></tr><tr><td>  B0 0X 0N 00 </td><td>  SHL RX, N </td><td>  The logical shift of value in register X to the left is N times.  Affects flags [z, n] </td></tr><tr><td>  B1 0X 0N 00 </td><td>  SHR RX, N </td><td>  The logical shift of value in register X to the right is N times.  Affects flags [z, n] </td></tr><tr><td>  B0 0X 0N 00 </td><td>  SAL RX, N </td><td>  The arithmetic shift of the value in register X to the left is N times.  Affects flags [z, n].  Same as SHL </td></tr><tr><td>  B2 0X 0N 00 </td><td>  SAR RX, N </td><td>  The arithmetic shift of the value in register X to the right is N times.  Affects flags [z, n] </td></tr><tr><td>  B3 YX 00 00 </td><td>  SHL RX, RY </td><td>  The logical shift of the value in the X register to the left by the value in the Y register. Affects the flags [z, n] </td></tr><tr><td>  B4 YX 00 00 </td><td>  SHR RX, RY </td><td>  The logical shift of the value in the register X to the right by the value in the register Y. Affects the flags [z, n] </td></tr><tr><td>  B3 YX 00 00 </td><td>  SAL RX, RY </td><td>  Arithmetic shift of the value in the register X to the left by the value in the register Y. Affects the flags [z, n].  Same as SHL </td></tr><tr><td>  B5 YX 00 00 </td><td>  SAR RX, RY </td><td>  Arithmetic shift of the value in the register X to the right by the value in the register Y. Affects the flags [z, n] </td></tr><tr><td>  C0 0X 00 00 </td><td>  Push rx </td><td>  Put the value of the register X on the stack.  Increases SP by 2. </td></tr><tr><td>  C1 0X 00 00 </td><td>  Pop rx </td><td>  Decreases SP by 2. Restore the value of the X register from the stack. </td></tr><tr><td>  C2 00 00 00 </td><td>  Pushhall </td><td>  Save the values ‚Äã‚Äãof all general purpose registers (r0-rf) in the stack.  Increases SP by 32. </td></tr><tr><td>  C3 00 00 00 </td><td>  Popall </td><td>  Decreases SP by 32. Restore the values ‚Äã‚Äãof all general registers (r0-rf) from the stack. </td></tr><tr><td>  C4 00 00 00 </td><td>  Pushhf </td><td>  Save the state of the register flags in the stack.  Bits 0-7 main flags, bits 8-15 are empty (always zero).  Increases SP by 2. </td></tr><tr><td>  C5 00 00 00 </td><td>  Pushhf </td><td>  Decreases SP by 2. Restore the state of the flag register from the stack. </td></tr><tr><td>  D0 00 LL HH </td><td>  Pal hhll </td><td>  Download the palette located at HHLL, 16 * 3 bytes, RGB-format;  will take effect immediately after the last VBlank </td></tr><tr><td>  D1 0x 00 00 </td><td>  PAL Rx </td><td>  Download the palette located at the address in the register X, 16 * 3 bytes, RGB-format;  will take effect immediately after the last VBlank </td></tr></tbody></table><br><br><h5>  Where to read more, how to "touch"? </h5><br>  You can read more, as I said, on the English-speaking forum. <br>  - <a href="http://forums.ngemu.com/showthread.php%3Ft%3D138170">The first</a> (and already outdated and closed) topic with a discussion of CHIP16 <br>  - <a href="http://forums.ngemu.com/showthread.php%3Ft%3D145620">The second</a> topic with the discussion (main).  Here all the information is collected in the first post of the topic.  There is a specification, tools, examples of programs.  Registration is required to download something from the forum. <br><br><img src="https://habrastorage.org/storage2/255/19c/227/25519c22713ee507c73a10c1db4c6bfb.png" align="right">  A good RefCHIP16 emulator: <a href="http://code.google.com/p/refchip16/downloads/list">code.google.com/p/refchip16/downloads/list</a> C ++ sources, there is a possibility of both simple interpretation and AOT (Ahead Of Time) compilation, which undoubtedly delivers.  Perhaps the only normal emulator that correctly processes specification 1.1 (especially ADSR sound). <br><br>  A bit outdated set of games, demos and test images for CHIP16.  In the same place source codes on the assembler for the majority of programs: <a href="http://rghost.ru/38862474">rghost.ru/38862474</a> New games and programs are laid out in the thread on the forum. <br><br><h5>  Development </h5><br>  Programs and games for CHIP16 are overwhelmingly written in assembler.  You can download it here: <a href="http://code.google.com/p/tchip16/downloads/list">code.google.com/p/tchip16/downloads/list</a> For example, take our sprite from this topic (arrow) and display it on the screen.  To do this, open any text editor, create an empty <b>habr.asm</b> file and write commands to it: <br><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">spr</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#0504</span></span> ;    8<span class="hljs-selector-tag"><span class="hljs-selector-tag">x5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ldi</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span>,10 ;   <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">X</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">ldi</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span>,10 ;   <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Y</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">drw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">arrow</span></span> ;       (10,10) <span class="hljs-selector-tag"><span class="hljs-selector-tag">end</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">jmp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">end</span></span> ;   ;  <span class="hljs-selector-tag"><span class="hljs-selector-tag">arrow</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">db</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#f1</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#11</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#11</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#ff</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">db</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#f1</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#1f</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#ff</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#ff</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">db</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#f1</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#f1</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#ff</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#ff</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">db</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#f1</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#ff</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#1f</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#ff</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">db</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#f1</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#ff</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#f1</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#ff</span></span></code> </pre> <br><br>  Then we compile the program using this command: <br> <code>tchip16.exe habr.asm -o habr.c16</code> <br>  Then open the resulting <b>habr.c16</b> file in the emulator and enjoy the view of the black arrow on a white background :) <br><br>  To debug complex algorithms, you can use my debugger chip16debugger: <a href="http://code.google.com/p/chip16debugger/downloads/list">code.google.com/p/chip16debugger/downloads/list</a> <br><img src="https://habrastorage.org/storage2/0d6/500/39b/0d650039ba61c18c79da7f04792bd340.png" alt="image"><br>  While the alpha version, govnokod, certainly with bugs, but better than nothing.  Sometimes it really helps to catch a bug. <br><br><h5>  Emulator ... And what else can you stir up? </h5><br>  Well, for example, some compiler (or translator) from a high-level language.  For example, I tried to write a translator from an Pascal-like language.  Of course, something happened, but it is clearly not enough for a full-fledged language.  Here such programs could write on it: <br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xPixels, yPixels, xStart, yStart, Xsize, YSize, maxiter : integer; xStep, yStep : integer; ix,iy,x,y,x0,y0,iteration,xtemp : integer; dist : byte; temp : byte; xx,yy : byte; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> XPixels := <span class="hljs-number"><span class="hljs-number">160</span></span>; YPixels := <span class="hljs-number"><span class="hljs-number">100</span></span>; XStart := $FF9c; YStart := $FFce; XSize := <span class="hljs-number"><span class="hljs-number">160</span></span>; YSize := <span class="hljs-number"><span class="hljs-number">100</span></span>; MaxIter := <span class="hljs-number"><span class="hljs-number">16</span></span>; XStep := XSize <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> XPixels; YStep := YSize <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> YPixels; yy := <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> iy := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> yPixels <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> xx := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> ix := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> xPixels <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> x := xStart + ix * xStep; y := yStart + iy * yStep; x0 := x; y0 := y; iteration := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">Repeat</span></span> xtemp := ((x*x) <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span>) - ((y*y) <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span>) + x0; y := <span class="hljs-number"><span class="hljs-number">2</span></span>*((x*y) <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span>) + y0; x := xtemp; iteration := iteration + <span class="hljs-number"><span class="hljs-number">1</span></span>; dist := ((x*x) <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span>) + ((y*y) <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> iteration = maxiter <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> dist := <span class="hljs-number"><span class="hljs-number">4000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">Until</span></span> dist &gt; <span class="hljs-number"><span class="hljs-number">192</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> iteration &lt;&gt; maxiter <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> iteration &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> temp := ((iteration <span class="hljs-keyword"><span class="hljs-keyword">shl</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> iteration) <span class="hljs-keyword"><span class="hljs-keyword">shl</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>; temp := temp <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ((iteration <span class="hljs-keyword"><span class="hljs-keyword">shl</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> iteration); DrawSprite(xx,yy,$<span class="hljs-number"><span class="hljs-number">0201</span></span>,^temp); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; xx := xx + <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; yy := yy + <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre><br><br>  The output was a ton of assembler govnokod, which was compiled by the above assembler tchip16.  In the end, it somehow worked and gave the following picture: <br><img src="https://habrastorage.org/storage2/b6e/704/5dc/b6e7045dcc0a29eb8d79ad92bc0252e5.png"><br><br>  Unfortunately, I scored, I didn‚Äôt have enough skill to bring everything to release or at least beta. <br><br><img src="https://habrastorage.org/storage2/0ed/3be/c70/0ed3bec706741866a338f1fcf968d305.png" align="left">  What else ... Oh yes, there was an interesting case - they wanted to stir up the CHIP16 demo component, such as writing demos for a subject.  Well, what, old school, resources are limited, this is not a shooter with gigami operatives.  In theory, you can completely spin the old effects, as though there is no frame buffer, but there are 32Kb operatives under the sprite the size of the whole screen.  And 32Kb per code remains.  It will be even without blinking the screen.  My small <a href="http://rghost.ru/38863708">demo sinedots</a> (such points are spinning in space, it turns out to be three-dimensional).  The truth is, I stepped here, and I‚Äôd output the dots exactly with dots (sprites of one byte) because of what the blink is. <br><br>  You can also create the entire platform in hardware (for fans of FPGAs and other transistors).  And I might write my emulator for this piece of iron: <br><img src="https://habrastorage.org/storage2/355/de3/781/355de3781eb14df25cbc66f6fde9da65.jpg"><br>  And let it not quite hardware in terms of hardware (there is a normal MIPS processor), but it is still interesting. <br><br>  Good luck to all! </div><p>Source: <a href="https://habr.com/ru/post/146496/">https://habr.com/ru/post/146496/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146489/index.html">I despise Arduino</a></li>
<li><a href="../146490/index.html">MySQL Master-Master Operating Experience - How to Survive a Data Center Accident</a></li>
<li><a href="../146492/index.html">Introducing Google Developers Live</a></li>
<li><a href="../146494/index.html">HP Virtual Connect replaces storage network</a></li>
<li><a href="../146495/index.html">Erlang decorators</a></li>
<li><a href="../146497/index.html">Infographics - the danger of wireless networks in terms of security</a></li>
<li><a href="../146499/index.html">How to grow an IT manager in high school?</a></li>
<li><a href="../146500/index.html">What happens on the Internet in 1 minute? (infographics)</a></li>
<li><a href="../146501/index.html">Speech Recognition on STM32F4-Discovery</a></li>
<li><a href="../146502/index.html">Nikon Hand Strap II wrist strap as alternative to neck strap</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>