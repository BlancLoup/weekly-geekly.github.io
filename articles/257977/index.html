<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Wiren Board 4 - controller for automation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A year ago, we released the Wiren Board Smart Home controller. Due to the low price and wide opportunities, he was a success among enthusiasts. 

 The...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Wiren Board 4 - controller for automation</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/c21/709/7a5/c217097a58c492720f018abf5503db2a.png" alt="image"><br><br>  A year ago, we released the Wiren Board Smart Home controller.  Due to the low price and wide opportunities, he was a success among enthusiasts. <br><br>  Therefore, we decided not to stop and released a new version - a controller for the automation of Wiren Board 4, to which we also wrote a new software. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Despite the name, customers often used Wiren Board Smart Home for non-domestic tasks: collecting climatic parameters, polling meters and sensors, and remotely controlling equipment ‚Äî that is, as a universal logic controller. <br><br>  Wiren Board 4 (both in hardware and software) is better suited for such tasks.  Home users have this also touched - the controller has become more reliable. <br><a name="habracut"></a><br><h1>  Iron </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/b8c/1c1/4f9/b8c1c14f97735f7e2205cf88774fdf53.png" alt="image"><br><br>  Electronics controller has undergone deep processing.  At the same time, where possible, compatibility with the previous version remained. <br>  The changes are mainly related to the elimination of the identified deficiencies: <br><br><ul><li>  Input protection and general noise immunity.  All inputs are protected against accidental voltage up to 24V. </li><li>  The input voltage range has been extended to 9‚Äì24 V, i.e. two common standards in automation, 12 and 24V, are supported. </li><li>  Added hardware watchdog timer.  This is an important thing if the controller is far away from you. </li><li>  One of the RS-485 ports is galvanically isolated. </li><li>  Protection against battery charge at low temperatures. </li><li>  Added inputs for ‚Äúdry contacts‚Äù.  Connection of meters with pulse outputs, external switches, etc. </li><li>  Removed CAN from the main board. </li><li>  And, of course, multi-colored push terminals!  Installation is now faster and more reliable. </li></ul><br><br>  Production of the controller even with minimal modifications is very expensive, both in time and in money. <br><br>  Therefore, in order to make it more flexible, we left room for expansion scarves, and allocated 3 terminals for it.  Power, UART, I2C, SPI are output to the extension connector.  Now there are scarves with RS-232, also planned with CAN and DAC (0-10V). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/678/f4b/099/678f4b0997db2d92805fe0ef07e2d93f.png" alt="expansion" width="550"><br><br><a name="Software"></a><br><h1>  Web interface </h1><br><br><img src="https://habrastorage.org/getpro/habr/post_images/806/51d/8da/80651d8da08b123fc329a7b8c4379269.png" alt="web interface" width="600"><br><br>  For the release of Wiren Board 4, we have released a new web interface. <br>  Initially, we assumed that the controller will be used with third-party interfaces.  It turned out that existing systems are poorly suited - their capabilities are either not enough, or they are slow, or they cannot be expanded. <br><br>  In our local HomeUI web interface, the standard automation concepts are supported: ‚Äúrooms‚Äù, dashboards, and the view is detached from the physical connection.  The interface is written in Angular using web sockets and Bootstrap, it works quickly, does not load the controller and looks decent on mobile devices. <br><br>  Of course, the existing options for connecting to third-party systems Majordomo and OpenHAB continue to work. <br><br><h1>  Rule engine </h1><br>  We also made a powerful wb-rules rule system.  The rule engine deserves a separate story, and we will soon write an article about it.  The engine allows you to write rules and scripts, create virtual devices, schedule actions for a specified time, handle events. <br><br>  The rules are written in JavaScript, and a person with no programming skills can easily figure it out. <br><div class="spoiler">  <b class="spoiler_title">Rule example</b> <div class="spoiler_text"><pre><code class="javascript hljs">defineRule(<span class="hljs-string"><span class="hljs-string">"motion_detector"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">whenChanged</span></span>: <span class="hljs-string"><span class="hljs-string">"wb-gpio/D1_IN"</span></span>, <span class="hljs-attr"><span class="hljs-attr">then</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newValue, devName, cellName</span></span></span><span class="hljs-function">) </span></span>{ dev[<span class="hljs-string"><span class="hljs-string">"wb-gpio"</span></span>][<span class="hljs-string"><span class="hljs-string">"Relay_2"</span></span>] = newValue; dev[<span class="hljs-string"><span class="hljs-string">"wb-mrm2_6"</span></span>][<span class="hljs-string"><span class="hljs-string">"Relay 1"</span></span>] = newValue; } });</code> </pre> <br><br><pre> <code class="javascript hljs">defineRule(<span class="hljs-string"><span class="hljs-string">"crontest_hourly"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">when</span></span>: cron(<span class="hljs-string"><span class="hljs-string">"@hourly"</span></span>), <span class="hljs-attr"><span class="hljs-attr">then</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ log(<span class="hljs-string"><span class="hljs-string">"@hourly rule fired"</span></span>); } });</code> </pre><br></div></div><br><br><h1>  Peripherals </h1><br>  A lot of work has been done in the system software - in the drivers for embedded devices and external peripherals: <br><ul><li>  driver for Modbus-RTU.  Modbus is a standard for wired peripheral actuators and sensors.  For many devices with which we tested the work, all the parameters are already wired into the driver.  It remains for the user to connect devices ( <a href="http://habrahabr.ru/company/contactless/blog/255657/">for example, ours</a> ) to add two lines to the config file: the device model and its address. </li><li>  We added support for pulse counters to the driver of digital inputs and outputs.  Now you can connect inexpensive metering devices directly to the digital inputs of Wiren Board.  The user must specify the type of meter (water, gas, electricity), a constant (written on the meter), and this is enough to watch liters or watts in the web interface. </li><li>  ordinary digital signals are also supported: connecting reed switches, motion sensors, etc.  Reaction to events is now instantaneous thanks to the use of interrupts. </li><li>  Improved driver analog inputs.  Now it supports direct measurement of resistance, which allows you to connect resistive sensors. </li><li>  With the help of the user community, the support of Oregon weather sensors has improved in the 433 MHz radio module driver, new devices and new commands for nooLite are supported. </li></ul><br>  In beta testing (testers are invited): <br><br><ul><li>  Z-wave support.  Z-wave is supported by USB sticks from z-wave.me, using their certified core.  Devices are integrated into our standard infrastructure. </li><li>  SmartBus G4 and HDL driver.  These are quite expensive wired home automation systems. Wiren Board 4 allows devices of these standards to be used in conjunction with cheaper projects where possible. </li></ul><br><h1>  Cloud Wiren Board Cloud </h1><br>  The local web interface is good, but very often you need access via the Internet.  To do this, we made a cloudy web interface that runs on our servers. <br><br>  With the server, the Wiren Board controllers exchange only data, so everything works quickly and even over GPRS. <br><br>  Additionally, you can connect several controllers to one interface, which for example allows you to make ‚Äúmini-SCADA‚Äù systems for dispatching. <br><br>  See in action here: <a href="http://demo.contactless.ru/"><b>demo.contactless.ru</b></a> . <br><br><h1>  Developer Discount </h1><br>  We made a 20% discount on samples of all our production devices for developers.  The discount applies to 1 copy of each device for individuals. <br><br>  All the details are on the <a href="http://contactless.ru/">website</a> and in <a href="http://contactless.ru/wiki/index.php/Wiren_Board_4">the documentation center</a> . <br><br>  We welcome comments! </div><p>Source: <a href="https://habr.com/ru/post/257977/">https://habr.com/ru/post/257977/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257965/index.html">Adobe has released a set of updates for its products.</a></li>
<li><a href="../257967/index.html">Bug fixes - phppgadmin</a></li>
<li><a href="../257969/index.html">No need to host static sites on Heroku</a></li>
<li><a href="../257971/index.html">Books and educational resources on algorithmic trading</a></li>
<li><a href="../257975/index.html">Messaging in Microsoft Azure, or How to communicate in the clouds</a></li>
<li><a href="../257979/index.html">How I started working with nRF24LE or another way to program this chip</a></li>
<li><a href="../257981/index.html">Automatically Testing JavaFX Applications</a></li>
<li><a href="../257985/index.html">Development of MMO RPG - a practical guide. Server (Part 1)</a></li>
<li><a href="../257991/index.html">Features of API development on symfony2</a></li>
<li><a href="../258003/index.html">Artificial Intelligence in Wolfram Language: Image Identification Project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>