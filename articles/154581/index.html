<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yandex Maps: Search for arbitrary objects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, it was necessary to write a script that, according to a given list, searches for stores on Yandex Maps and shows those available depending o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yandex Maps: Search for arbitrary objects</h1><div class="post__text post__text-html js-mediator-article"><img src="http://zeroflip.com/maps_yandex.jpg" alt="image" align="left">  Recently, it was necessary to write a script that, according to a given list, searches for stores on Yandex Maps and shows those available depending on the user's location. <br>  For example, you need to find all the Herbs and Seasonings stores located in the user's city, while not using the database of exact addresses and coordinates of the stores. <br>  A thorough study of the API did not produce results, so it was decided to invent its own search method. <br>  Interested please under the cat. <br><a name="habracut"></a><br>  The <a href="">documentation</a> states that the search on the map can be performed using the <b>geocode</b> function, passing it a toponym corresponding to the task.  For example, to find a street you need to pass the toponym <b>street</b> and so on.  more <a href="">here</a> . <br>  In studying the table of possible values, the value <b>other</b> was found.  But checking the response of the geodecoder revealed that he did not know how to look for objects like 'Moscow Herb shop seasoning'. <br><br>  Request: <br><br>  'http://geocode-maps.yandex.ru/1.x/?geocode=Moscow, Novy Arbat Street, 24' 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      will give the correct information, but this: <br><br>  'http://geocode-maps.yandex.ru/1.x/?geocode=Moscow, Herbs and Condiments Store' <br><br>  will give a bunch of information that is not relevant to the subject of the search <br><br>  It was decided to look at what can be pulled from the <a href="http://maps.yandex.ru/">Yandex Maps</a> page, since it is possible to search for almost any objects there. <br>  When parsing the page was found JSON, it begins with the line <b>{"request": {"args":</b> <br>  ends with the tag <b>'&lt;/ script&gt;'</b> .  It contains all the necessary data, including all found objects, their coordinates, routes, addresses, tags, and so on.  It remains to obtain the necessary data so that in the future it can be used.  We will do this using PHP. <br>  So, as a result, we obtain an array containing the coordinates, the address and the names of the objects of the search.  Then, convert it to JSON, which will then request the script with the map. <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $array_shops=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'_1'</span></span>,<span class="hljs-string"><span class="hljs-string">'_2'</span></span>); $coords_file=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $geo_objects=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i=<span class="hljs-number"><span class="hljs-number">0</span></span>;$i&lt;count($array_shops);$i++) { $coords_file[$i]=file_get_contents(<span class="hljs-string"><span class="hljs-string">"http://maps.yandex.ru/?text="</span></span>.urlencode($_GET[<span class="hljs-string"><span class="hljs-string">'town'</span></span>].<span class="hljs-string"><span class="hljs-string">"  "</span></span>.$array_shops[$i])); $start=strpos($coords_file[$i],<span class="hljs-string"><span class="hljs-string">'{"request":{"args":'</span></span>); $end=strpos($coords_file[$i],<span class="hljs-string"><span class="hljs-string">'&lt;/script&gt;'</span></span>,$start); $lenght=$end-$start; $js=json_decode(substr($coords_file[$i],$start,$lenght),<span class="hljs-number"><span class="hljs-number">1</span></span>); $js=$js[<span class="hljs-string"><span class="hljs-string">'vpage'</span></span>][<span class="hljs-string"><span class="hljs-string">'data'</span></span>][<span class="hljs-string"><span class="hljs-string">'businesses'</span></span>][<span class="hljs-string"><span class="hljs-string">'GeoObjectCollection'</span></span>][<span class="hljs-string"><span class="hljs-string">'features'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($js <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $value) { $geo_objects[]=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'coordinates'</span></span> =&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($value[<span class="hljs-string"><span class="hljs-string">'geometry'</span></span>][<span class="hljs-string"><span class="hljs-string">'coordinates'</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>], $value[<span class="hljs-string"><span class="hljs-string">'geometry'</span></span>][<span class="hljs-string"><span class="hljs-string">'coordinates'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]), <span class="hljs-string"><span class="hljs-string">'address'</span></span>=&gt;$value[<span class="hljs-string"><span class="hljs-string">'properties'</span></span>][<span class="hljs-string"><span class="hljs-string">'CompanyMetaData'</span></span>][<span class="hljs-string"><span class="hljs-string">'address'</span></span>], <span class="hljs-string"><span class="hljs-string">'name_shop'</span></span>=&gt;$array_shops[$i] ); } } $js_array=json_encode($geo_objects); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $js_array; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br><br>  I will not describe in detail the code for the card itself, you can read in detail <a href="">here</a> . <br><br><pre> <code class="javascript hljs">ymaps.ready(init); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> myMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ymaps.Map(<span class="hljs-string"><span class="hljs-string">"map"</span></span>, { <span class="hljs-comment"><span class="hljs-comment">//   center: [ymaps.geolocation.latitude, ymaps.geolocation.longitude], zoom: 12}) //   var town=ymaps.geolocation.city; var data_send=new Object(); data_send.town = town; var coords=[]; var address=[]; var names_shop=[]; var json_array; jQuery.ajax( { url:"json_response.php", data: data_send, dataType: 'json', success: function(data){ json_array=data; for(key in json_array){ coords.push(json_array[key].coordinates); address.push(json_array[key].address); names_shop.push(json_array[key].name_shop); } //  var myCollection = new ymaps.GeoObjectCollection({}, {preset: 'twirl#shopIcon'}); for (var i = 0; i &lt; coords.length; i++){ myCollection.add(new ymaps.Placemark(coords[i], { balloonContentHeader:names_shop[i], balloonContent: address[i], })); } myMap.geoObjects.add(myCollection); } }); //  myMap.controls.add(new ymaps.control.ZoomControl()); myMap.controls.add('mapTools'); myMap.controls.add('typeSelector'); }</span></span></code> </pre><br><br>  <b>Total:</b> <br>  we can search for objects by name, without a database with coordinates and addresses that must be maintained and updated. <br><br>  The result can be found <a href="http://zeroflip.com/maps.php">here</a> .  Hopefully, the ability to search for arbitrary objects will be added to the Yandex Maps API. <br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/154581/">https://habr.com/ru/post/154581/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../154571/index.html">Kyocera - applications and tools. Part 2 - admins</a></li>
<li><a href="../154573/index.html">Installing Gitorious on Centos 6</a></li>
<li><a href="../154575/index.html">Office Ozon.ru</a></li>
<li><a href="../154577/index.html">What you need to know about the promotion of mobile applications in iOS 6</a></li>
<li><a href="../154579/index.html">Tt eSPORTS Level 10 M - just a mouse?</a></li>
<li><a href="../154583/index.html">16 ways to choose the perfect name for a startup</a></li>
<li><a href="../154587/index.html">File upload via FileReader</a></li>
<li><a href="../154589/index.html">NewSQL - a new milestone in the evolution of BigData, taking the best from SQL and NoSQL</a></li>
<li><a href="../154591/index.html">Creating a "non-standard" custom object for AutoCAD that works without Object Enabler</a></li>
<li><a href="../154593/index.html">Lego will release your designer if 10,000 fans vote for him</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>