<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Tips for engineers": a review of Huawei S5720-52X-PWR-SI V2R9SPC500</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! Huawei blog is back in touch! 

 In the air the next issue of the heading "Tips for engineers". 
 And today our guest is the honored switch ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Tips for engineers": a review of Huawei S5720-52X-PWR-SI V2R9SPC500</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/970/370/0da/9703700da401492e8e81c00d94d22c1d.png"><br><br>  Hi, Habr!  Huawei blog is back in touch! <br><br>  In the air the next issue of the heading "Tips for engineers". <br>  And today our guest is the honored switch of China, the holder of the honorary title ‚ÄúWorthy Replacement of the Cisco 2960S-24-PWR Model‚Äù, the leader of the Huawei line in the ‚Äúfunctional / price‚Äù ratio - the Huawei S5720-52X-PWR-SI switch V2R9SPC500. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/web/71c/9f6/26c/71c9f626cb274f358ec228fa5dfa8c68.png"></div><br>  Short dossier on our hero: <br><blockquote>  48GE PoE +, 4 * 10GE ports. <br>  SI version supports L3 routing, including RIP and OSPF. <br>  Software version V200R009C00SPC500. <br>  Power supply 500W, for PoE 370 is available. <br>  Stacking is possible through 1 / 10GE Uplinks. <br>  The 10GE interfaces support almost any transceiver, including SNR. <br>  It supports web-based management and CLI (telnet, ssh v2), SNMP v2c / v3, centralized via eSight. </blockquote><br>  And today we will talk about our experience of using the S5720 as an access switch for connecting workstations and IP phones. <br><br>  Initially, we laid a certain redundancy, because  For this task, a cheaper S5700-LI switch line is sufficient, but with an eye to future use, this model was taken, and this was justified - by the end of testing, routing was suddenly needed. <br><br>  But, let's get to the point - what did you manage to find out about the S5720 and test it in practice? <a name="habracut"></a><br><br><h3>  First experience.  VLAN </h3><br>  Created VLAN for office network and for phones.  Configured "trunks" and user ports.  LLDP enabled. <br><br>  For Voice VLAN operation, ports are configured in the hybrid mode.  Yealink IP phones have the ability to receive settings via LLDP, which we successfully used. <br><br>  After configuration, user traffic remained in the office network, and voice traffic moved to the Voice VLAN.  At the same time, additional configuration of telephones and jobs was not required, which is very convenient during migration. <br><br>  The inclusion of LLDP allows you to allocate PoE in accordance with the requirements of the connected device and economically consumes the power budget of the switch. <br><br>  There were no questions when setting up routing - everything works.  Basic routing settings: <br><br> <code>router id 192.168.30.4 <br> # <br> ospf 1 <br> area 0.0.0.0 <br> network 10.0.50.0 0.0.0.255 <br> # <br> interface Vlanif50 <br> mtu 9198 <br> ospf timer hello 1 <br> ospf timer dead 3</code> <br> <br>  Peer authentication was not verified.  In order to accelerate convergence, non-standard timings were set up (the so-called ‚ÄúLAN-based design‚Äù).  ASA5512 is successfully used as a ‚Äúneighbor‚Äù - it works. <br><br>  Not without nuances: despite the fact that the SI series supports dynamic routing, it is possible only between Vlan interfaces (Vlanif).  Those.  the port cannot be switched to L3 mode and assign it an IP address.  This is only possible for the EI, HI series. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/33d/003/37d/33d00337dcd14526b626346c70e0b7e0.png"></div><br><br><h3>  Experience the second.  Security </h3><br>  As a protection against the most common types of threats, we configured DHCP snooping, IP Source Guard, ARP security - all together, this avoids some types of attacks that are most common in the office network, including unintended ones. <br><br>  It is no secret that for administrators it becomes a headache that an illegal DHCP server appears on the network.  DHCP snooping is designed to solve this problem because  distribution of addresses in this case is possible only from a trusted port, on the rest it is blocked. <br><br>  On the basis of DHCP snooping, IP Source Guard and ARP security functions that protect against IP and MAC falsification.  Here the essence is that work is possible only with the address obtained by DHCP, and the link ‚Äúport ‚Äî IP ‚Äî MAC‚Äù is created and checked automatically. <br><br>  This setting will save us if someone wants to use someone else's IP-MAC, or to organize an attack such as MITM-attack ("Man-in-the-Middle"). <br><br>  The third type of possible threat is an attack on STP.  Here, BPDU filtering is enabled as protection on user ports (that is, no STP frames are sent to the user or accepted from it). <br><br>  In addition, control of the appearance of extraneous BPDU stp bpdu-protection is carried out, which is possible when another switch is connected or an attack on stp root is launched. <br><br>  The activated ‚Äústp edge-port enable‚Äù option excludes the port from STP calculation, reducing convergence time and load on the switch. <br><br>  The combination of stp bpdu-protection and stp edge-port enable, is similar to Cisco spanning-tree portfast. <br><br>  Actually, configuration examples: <br><br> <code>dhcp enable <br> # <br> dhcp snooping enable <br> dhcp snooping alarm dhcp-rate enable <br> dhcp snooping user-bind autosave flash:/dhcp-bind.tbl write-delay 6000 <br> arp dhcp-snooping-detect enable <br> dhcp server detect <br> <br> vlan 2 <br> name office <br> dhcp snooping enable <br> dhcp snooping check dhcp-request enable <br> dhcp snooping check dhcp-rate enable <br> arp anti-attack check user-bind enable <br> ip source check user-bind enable <br> <br> vlan 3 <br> name guest <br> dhcp snooping enable <br> dhcp snooping check dhcp-request enable <br> dhcp snooping check dhcp-rate enable <br> arp anti-attack check user-bind enable <br> ip source check user-bind enable <br> <br> vlan 4 <br> name voice <br> dhcp snooping enable <br> dhcp snooping check dhcp-request enable <br> dhcp snooping check dhcp-rate enable <br> arp anti-attack check user-bind enable <br> ip source check user-bind enable <br> <br> interface GigabitEthernet0/0/1 <br> port link-type hybrid <br> voice-vlan 4 enable <br> port hybrid pvid vlan 2 <br> port hybrid tagged vlan 4 <br> port hybrid untagged vlan 2 <br> stp root-protection <br> stp bpdu-filter enable <br> stp edged-port enable <br> trust dscp <br> <br> stp instance 0 root primary <br> stp bpdu-protection</code> <br> <br><h3>  Experience the third.  Administration </h3><br>  You have configured the administrative part, which includes NTP, SNMP, AAA, Radius. <br><br>  It turned out that you can activate up to 16 lines of VTY, while the default is only 5. <br><br>  And, in fact, some convenience of administration. <br><br> <code>user-interface maximum-vty 15 <br> user-interface con 0 <br> authentication-mode aaa <br> history-command max-size 20 <br> screen-length 40 <br> user-interface vty 0 14 <br> authentication-mode aaa <br> history-command max-size 20 <br> idle-timeout 30 0 <br> screen-length 40</code> <br> <br>  What is important to note more? <br><br>  For SSH access, it is necessary to add SSH users, except for the user in the AAA section. <br><br>  RSA keys have already been generated, but if you change the name and domain on the switch, we recommend that you generate the keys again. <br><br>  By default, ssh v1 is disabled, but you can enable it if necessary (although we do not recommend doing this). <br><br> <code>stelnet server enable <br> [HUAWEI] aaa <br> [HUAWEI-aaa] local-user admin123 password irreversible-cipher Huawei@123 <br> [HUAWEI-aaa] local-user admin123 service-type ssh <br> [HUAWEI-aaa] local-user admin123 privilege level 15 <br> [HUAWEI-aaa] quit <br> [HUAWEI] ssh user admin123 authentication-type password</code> <br> <br>  We also managed to set up authentication of administrators through Radius. <br><br>  It should be noted that for administrators use a scheme called domain default_admin! <br><br> <code>domain default_admin <br> authentication-scheme default <br> accounting-scheme Radius <br> service-scheme Admin <br> radius-server Radius</code> <br> <br><h3>  Experience the fourth.  Replacing the device certificate with a valid one </h3><br>  "To the heap" we decided to replace the factory self-signed certificate with a valid one (the benefit is our valid certificate for signing). <br><br>  The certificate can be imported only from the CLI. <br><br>  Faced with the fact that the keys and the certificate must be separate, despite the fact that the "pfx" format allows you to export the private key as part of the certificate. <br><br>  Moreover, if you are trying to import a chain of certificates, then the device certificate must be recorded first, and then all the others (for example, intermediate CAs). <br><br>  With standard export to pem, first in the file are CA certificates and only at the end the device certificate. <br><br>  For the import to work, the certificate files on the device must be placed in the security folder on the flash.  This default folder is missing it needs to be created. <br><br>  We present to your attention a step-by-step algorithm: <br><br>  1. Generate a certificate on an external CA. <br>  2. Export a separate certificate or chain and private key. <br>  3. If this is a chain, open the certificate file with a notepad and transfer the last block (device certificate) to the beginning of the file, save. <br>  4. On the switch, create a folder <b>mkdir flash: / security</b> <br>  5. Put the certificate file and the <b>tftp 192.168.0.1</b> key in the folder. <b>Chain-servercert.pem /security/chain-servercert.pem</b> <br>  After that, according to the instructions, create a policy and perform the import. <br><br>  <b>system view</b> <br>  [HUAWEI] <b>ssl policy http_server</b> <br>  [HUAWEI-ssl-policy-http_server] <b>certificate load pfx-cert servercert.pfx key-pair rsa key-file serverkey.pfx auth-code cipher 123456</b> <br>  # Load a PEM certificate chain for the SSL policy. <br><br>  <b>system view</b> <br>  [HUAWEI] <b>ssl policy http_server</b> <br>  [HUAWEI-ssl-policy-http_server] <b>certificate load pem-chain chain-servercert.pem key-pair rsa key-file chain-servercertkey.pem auth-code cipher 123456</b> <br><br>  To apply the policy, you must restart the https server, but it will not restart separately.  Therefore, it is necessary to restart the entire web service. <br><br>  <b>http server disable</b> <br>  <b>http server enable</b> <br><br>  As a result, the export was successful, and the web-interface uses a valid certificate. <br><br><h3>  Summing up </h3><br>  As a result - a few figures and conclusions: <br><br><ul><li>  The switch CPU load even at idle is about 20%, and in periods increases to 30%.  Effects on traffic not seen. <br>  CPU utilization for five seconds: 25%: one minute: 25%: five minutes: 24% <br>  TaskName CPU Runtime (CPU Tick High / Tick Low) Task Explanation <br>  VIDL 75% 2 / 187119ff DOPRA IDLE <br>  OS 12% 0 / 55d4a7fe Operation System <br>  POE 4% 0 / 204e4380 POE Power Over Ethernet <br></li></ul><br><ul><li>  When migrating virtual machines between connected ESX, the load on the interface was 804 Mbit / s and 999 Mbit / s, without packet loss. <br><br>  Input peak rate 804556024 bits / sec, Record time: 2016-08-15 15:09:17 <br>  Output peak rate 999957528 bits / sec, Record time: 2016-08-12 12:20:09 <br></li></ul><br><ul><li>  One of the phones refused to connect at a speed of 1000 Mbit / s, only at 100 Mbit / s.  AUTO settings on both sides.  Direct connection to the switch 1m patch cord, switch port change did not help.  At the same time, the Cisco 2960 phone was connected to 1G stably.  This is one of 20 similar phones.  The issue has not been resolved. </li></ul><br><ul><li>  Very modest web interface, the most basic functions are available. </li></ul><br>  PS See you in the next issues, gentlemen, Engineers! </div><p>Source: <a href="https://habr.com/ru/post/334910/">https://habr.com/ru/post/334910/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334896/index.html">How to survive hardfork and not lie down in the hospital</a></li>
<li><a href="../334898/index.html">R from H2O to Spark in HDInsight</a></li>
<li><a href="../334900/index.html">What does a retired NATO general teach students at Innopolis University</a></li>
<li><a href="../334902/index.html">Can drone buy beer? (Question for thought)</a></li>
<li><a href="../334904/index.html">RADIUS authentication of trusted domain users</a></li>
<li><a href="../334912/index.html">Rusty IP Camera: Rust Firmware</a></li>
<li><a href="../334914/index.html">10 types of data structures you need to know + videos and exercises</a></li>
<li><a href="../334916/index.html">Where is the logic? Learn to think systemically. Part 2</a></li>
<li><a href="../334918/index.html">Laracon 2017 - a brief overview and a bunch of useful links</a></li>
<li><a href="../334920/index.html">And again Huawei Cloud Fabric: what is SDN-architecture and what does it eat with?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>