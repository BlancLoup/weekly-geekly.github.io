<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Working with image metadata in WPF</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently I decided to familiarize myself with the .NET platform, the C # language and the Windows Presentation Foundation. 
 In the process of studyin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Working with image metadata in WPF</h1><div class="post__text post__text-html js-mediator-article"><img src="http://lr.gameimg.ru/netwpf.jpg" alt="image" align="left"><br>  Recently I decided to familiarize myself with the .NET platform, the C # language and the Windows Presentation Foundation. <br>  In the process of studying (and I am learning languages ‚Äã‚Äãand technologies, I am always in the process of developing a pilot project) I encountered quite a few pitfalls and subtle points.  I would like to share it with the habrasoobshchestvo (I suppose that many beginning WPF developers would be interested in this) all at once, but the volume of the resulting habratopik would be too large, so I decided to start with image metadata, because  on this topic of information, even in the English-language Internet is not enough. <br><br><a name="habracut"></a><br><br>  In general, metadata may be available for images of various formats, however, I will be telling on the example of a JPEG, since  worked with him.  I think for other formats the difference will be small. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Types of metadata </h4><br><br>  First, let's look at what types of metadata can be in the image.  All the most likely it is so know, but just in case I will tell: <br><ul><li>  EXIF (Exchangeable Image File Format) is a standard for storing metadata in an image that is used by digital cameras to store information about shutter speed, aperture, and other shooting parameters.  EXIF metadata can be stored in JPEG, TIFF and RIFF WAV files.  According to the standard, only description (Description tag) and comment (User Comment tag) can be stored in the EXIF ‚Äã‚Äãuser descriptive metadata, but Windows Explorer also uses several additional tags (XPTitle, XPSubject, XPAuthor, XPComment, XPKeywords).  Windows Explorer ignores the XPTitle tag when there is a standard Description tag. </li><li>  IPTC (International Press Telecommunications Council) - the name rather of the organization that developed the standard.  The metadata standard itself is called the Information Interchange Model (IIM).  The oldest of the described standards.  In the original version of the standard, the metadata was stored in such a way that software that was not aware of the existence of IPTC could not work with image files that contained such metadata.  However, later Adobe expanded the standard by transferring metadata to an APP13 block of a JPEG file, which allowed software that does not know about the standard to successfully read a JPEG file, ignoring unknown metadata.  Descriptive fields such as ObjectName (title), Keywords (keywords), Caption (description, there are several tag variations) can be stored in IPTC metadata. </li><li>  XMP (eXtensible Metadata Platform) is a standard developed by Adobe.  The metadata is stored in the RDF model in XML format, allowing you to include any necessary information in the image file.  This format prefers to use WIC (Windows Imaging Component) in Windows Vista / 7. </li></ul><br><br><h4>  Principles of working with metadata in WPF </h4><br><br>  WPF uses the BitmapEncoder, BitmapDecoder, BitmapSource, BitmapFrame, BitmapMetadata, InPlaceMetadataWriter classes to work with metadata. <br>  The BitmapEncoder and BitmapDecoder classes have descendants that allow you to work with specific image formats.  In my case - JpegBitmapEncoder and JpegBitmapDecoder. <br>  The InPlaceMetadataWriter class is used to modify metadata on the spot, without recoding a file. <br>  Data can be read and written by two methods ‚Äî either using the GetQuery / SetQuery functions, which operate with hierarchical metadata tag names, or using the BitmapMetadata class fields, which make it easy to access metadata. <br>  When accessing metadata through the fields of the BitmapMetadata class, the WIC tries to find the corresponding fields in the metadata of different standards in the following order: first XMP, then IPTC and EXIF.  When writing tags through the fields of the BitmapMetadata class, WIC records them in XMP format. <br><br><h4>  Read metadata </h4><br><br>  Here is a ready-made example of a function with which you can read metadata from a file: <br><br><blockquote><ol><li> <code><font color="black"><font color="#2b91af">FileStream</font> f = <font color="#2b91af">File</font> .Open( <font color="#A31515">"test.jpg"</font> , FileMode.Open); BitmapDecoder decoder = JpegBitmapDecoder.Create(f, BitmapCreateOptions.IgnoreColorProfile, BitmapCacheOption.Default); BitmapMetadata metadata = (BitmapMetadata)decoder.Frames[ <font color="#A31515">0</font> ].Metadata; <font color="#008000">//     </font> <font color="#0000ff">string</font> title = metadata.Title; <font color="#008000">//    XMP</font> <font color="#0000ff">string</font> xmptitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/xmp/&lt;xmpalt&gt;dc:title"</font> ); <font color="#008000">//    EXIF</font> <font color="#0000ff">string</font> exiftitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app1/ifd/{ushort=40091}"</font> ); <font color="#008000">//    IPTC</font> <font color="#0000ff">string</font> iptctitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app13/irb/8bimiptc/iptc/object name"</font> );</font></code> </li> <li> <code><font color="black"><font color="#2b91af">FileStream</font> f = <font color="#2b91af">File</font> .Open( <font color="#A31515">"test.jpg"</font> , FileMode.Open); BitmapDecoder decoder = JpegBitmapDecoder.Create(f, BitmapCreateOptions.IgnoreColorProfile, BitmapCacheOption.Default); BitmapMetadata metadata = (BitmapMetadata)decoder.Frames[ <font color="#A31515">0</font> ].Metadata; <font color="#008000">//     </font> <font color="#0000ff">string</font> title = metadata.Title; <font color="#008000">//    XMP</font> <font color="#0000ff">string</font> xmptitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/xmp/&lt;xmpalt&gt;dc:title"</font> ); <font color="#008000">//    EXIF</font> <font color="#0000ff">string</font> exiftitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app1/ifd/{ushort=40091}"</font> ); <font color="#008000">//    IPTC</font> <font color="#0000ff">string</font> iptctitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app13/irb/8bimiptc/iptc/object name"</font> );</font></code> </li> <li> <code><font color="black"><font color="#2b91af">FileStream</font> f = <font color="#2b91af">File</font> .Open( <font color="#A31515">"test.jpg"</font> , FileMode.Open); BitmapDecoder decoder = JpegBitmapDecoder.Create(f, BitmapCreateOptions.IgnoreColorProfile, BitmapCacheOption.Default); BitmapMetadata metadata = (BitmapMetadata)decoder.Frames[ <font color="#A31515">0</font> ].Metadata; <font color="#008000">//     </font> <font color="#0000ff">string</font> title = metadata.Title; <font color="#008000">//    XMP</font> <font color="#0000ff">string</font> xmptitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/xmp/&lt;xmpalt&gt;dc:title"</font> ); <font color="#008000">//    EXIF</font> <font color="#0000ff">string</font> exiftitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app1/ifd/{ushort=40091}"</font> ); <font color="#008000">//    IPTC</font> <font color="#0000ff">string</font> iptctitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app13/irb/8bimiptc/iptc/object name"</font> );</font></code> </li> <li> <code><font color="black"><font color="#008000"><font color="#2b91af">FileStream</font> f = <font color="#2b91af">File</font> .Open( <font color="#A31515">"test.jpg"</font> , FileMode.Open); BitmapDecoder decoder = JpegBitmapDecoder.Create(f, BitmapCreateOptions.IgnoreColorProfile, BitmapCacheOption.Default); BitmapMetadata metadata = (BitmapMetadata)decoder.Frames[ <font color="#A31515">0</font> ].Metadata; //      <font color="#0000ff">string</font> title = metadata.Title; <font color="#008000">//    XMP</font> <font color="#0000ff">string</font> xmptitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/xmp/&lt;xmpalt&gt;dc:title"</font> ); <font color="#008000">//    EXIF</font> <font color="#0000ff">string</font> exiftitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app1/ifd/{ushort=40091}"</font> ); <font color="#008000">//    IPTC</font> <font color="#0000ff">string</font> iptctitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app13/irb/8bimiptc/iptc/object name"</font> );</font></font></code> </li> <li> <code><font color="black"><font color="#2b91af">FileStream</font> f = <font color="#2b91af">File</font> .Open( <font color="#A31515">"test.jpg"</font> , FileMode.Open); BitmapDecoder decoder = JpegBitmapDecoder.Create(f, BitmapCreateOptions.IgnoreColorProfile, BitmapCacheOption.Default); BitmapMetadata metadata = (BitmapMetadata)decoder.Frames[ <font color="#A31515">0</font> ].Metadata; <font color="#008000">//     </font> <font color="#0000ff">string</font> title = metadata.Title; <font color="#008000">//    XMP</font> <font color="#0000ff">string</font> xmptitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/xmp/&lt;xmpalt&gt;dc:title"</font> ); <font color="#008000">//    EXIF</font> <font color="#0000ff">string</font> exiftitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app1/ifd/{ushort=40091}"</font> ); <font color="#008000">//    IPTC</font> <font color="#0000ff">string</font> iptctitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app13/irb/8bimiptc/iptc/object name"</font> );</font></code> </li> <li> <code><font color="black"><font color="#008000"><font color="#2b91af">FileStream</font> f = <font color="#2b91af">File</font> .Open( <font color="#A31515">"test.jpg"</font> , FileMode.Open); BitmapDecoder decoder = JpegBitmapDecoder.Create(f, BitmapCreateOptions.IgnoreColorProfile, BitmapCacheOption.Default); BitmapMetadata metadata = (BitmapMetadata)decoder.Frames[ <font color="#A31515">0</font> ].Metadata; <font color="#008000">//     </font> <font color="#0000ff">string</font> title = metadata.Title; //    XMP <font color="#0000ff">string</font> xmptitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/xmp/&lt;xmpalt&gt;dc:title"</font> ); <font color="#008000">//    EXIF</font> <font color="#0000ff">string</font> exiftitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app1/ifd/{ushort=40091}"</font> ); <font color="#008000">//    IPTC</font> <font color="#0000ff">string</font> iptctitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app13/irb/8bimiptc/iptc/object name"</font> );</font></font></code> </li> <li> <code><font color="black"><font color="#2b91af">FileStream</font> f = <font color="#2b91af">File</font> .Open( <font color="#A31515">"test.jpg"</font> , FileMode.Open); BitmapDecoder decoder = JpegBitmapDecoder.Create(f, BitmapCreateOptions.IgnoreColorProfile, BitmapCacheOption.Default); BitmapMetadata metadata = (BitmapMetadata)decoder.Frames[ <font color="#A31515">0</font> ].Metadata; <font color="#008000">//     </font> <font color="#0000ff">string</font> title = metadata.Title; <font color="#008000">//    XMP</font> <font color="#0000ff">string</font> xmptitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/xmp/&lt;xmpalt&gt;dc:title"</font> ); <font color="#008000">//    EXIF</font> <font color="#0000ff">string</font> exiftitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app1/ifd/{ushort=40091}"</font> ); <font color="#008000">//    IPTC</font> <font color="#0000ff">string</font> iptctitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app13/irb/8bimiptc/iptc/object name"</font> );</font></code> </li> <li> <code><font color="black"><font color="#008000"><font color="#2b91af">FileStream</font> f = <font color="#2b91af">File</font> .Open( <font color="#A31515">"test.jpg"</font> , FileMode.Open); BitmapDecoder decoder = JpegBitmapDecoder.Create(f, BitmapCreateOptions.IgnoreColorProfile, BitmapCacheOption.Default); BitmapMetadata metadata = (BitmapMetadata)decoder.Frames[ <font color="#A31515">0</font> ].Metadata; <font color="#008000">//     </font> <font color="#0000ff">string</font> title = metadata.Title; <font color="#008000">//    XMP</font> <font color="#0000ff">string</font> xmptitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/xmp/&lt;xmpalt&gt;dc:title"</font> ); //    EXIF <font color="#0000ff">string</font> exiftitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app1/ifd/{ushort=40091}"</font> ); <font color="#008000">//    IPTC</font> <font color="#0000ff">string</font> iptctitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app13/irb/8bimiptc/iptc/object name"</font> );</font></font></code> </li> <li> <code><font color="black"><font color="#2b91af">FileStream</font> f = <font color="#2b91af">File</font> .Open( <font color="#A31515">"test.jpg"</font> , FileMode.Open); BitmapDecoder decoder = JpegBitmapDecoder.Create(f, BitmapCreateOptions.IgnoreColorProfile, BitmapCacheOption.Default); BitmapMetadata metadata = (BitmapMetadata)decoder.Frames[ <font color="#A31515">0</font> ].Metadata; <font color="#008000">//     </font> <font color="#0000ff">string</font> title = metadata.Title; <font color="#008000">//    XMP</font> <font color="#0000ff">string</font> xmptitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/xmp/&lt;xmpalt&gt;dc:title"</font> ); <font color="#008000">//    EXIF</font> <font color="#0000ff">string</font> exiftitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app1/ifd/{ushort=40091}"</font> ); <font color="#008000">//    IPTC</font> <font color="#0000ff">string</font> iptctitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app13/irb/8bimiptc/iptc/object name"</font> );</font></code> </li> <li> <code><font color="black"><font color="#008000"><font color="#2b91af">FileStream</font> f = <font color="#2b91af">File</font> .Open( <font color="#A31515">"test.jpg"</font> , FileMode.Open); BitmapDecoder decoder = JpegBitmapDecoder.Create(f, BitmapCreateOptions.IgnoreColorProfile, BitmapCacheOption.Default); BitmapMetadata metadata = (BitmapMetadata)decoder.Frames[ <font color="#A31515">0</font> ].Metadata; <font color="#008000">//     </font> <font color="#0000ff">string</font> title = metadata.Title; <font color="#008000">//    XMP</font> <font color="#0000ff">string</font> xmptitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/xmp/&lt;xmpalt&gt;dc:title"</font> ); <font color="#008000">//    EXIF</font> <font color="#0000ff">string</font> exiftitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app1/ifd/{ushort=40091}"</font> ); //    IPTC <font color="#0000ff">string</font> iptctitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app13/irb/8bimiptc/iptc/object name"</font> );</font></font></code> </li> <li> <code><font color="black"><font color="#2b91af">FileStream</font> f = <font color="#2b91af">File</font> .Open( <font color="#A31515">"test.jpg"</font> , FileMode.Open); BitmapDecoder decoder = JpegBitmapDecoder.Create(f, BitmapCreateOptions.IgnoreColorProfile, BitmapCacheOption.Default); BitmapMetadata metadata = (BitmapMetadata)decoder.Frames[ <font color="#A31515">0</font> ].Metadata; <font color="#008000">//     </font> <font color="#0000ff">string</font> title = metadata.Title; <font color="#008000">//    XMP</font> <font color="#0000ff">string</font> xmptitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/xmp/&lt;xmpalt&gt;dc:title"</font> ); <font color="#008000">//    EXIF</font> <font color="#0000ff">string</font> exiftitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app1/ifd/{ushort=40091}"</font> ); <font color="#008000">//    IPTC</font> <font color="#0000ff">string</font> iptctitle = ( <font color="#0000ff">string</font> )metadata.GetQuery( <font color="#A31515">@"/app13/irb/8bimiptc/iptc/object name"</font> );</font></code> </li> </ol></blockquote><br><br>  Everything is quite simple and transparent, so we will go straight to the record. <br><br><h4>  Metadata Recording </h4><br><br><blockquote><ol><li>  <font color="#2b91af">BitmapMetadata</font> md = <font color="#0000ff">new</font> <font color="#2b91af">BitmapMetadata</font> ( <font color="#A31515">"jpg"</font> ); </li><li>  md.SetQuery ( <font color="#A31515">@ "/ xmp / &lt;xmpalt&gt; dc: title"</font> , xmptitle); </li><li>  md.SetQuery ( <font color="#A31515">@ "/ app1 / ifd / {ushort = 40091}"</font> , exiftitle); </li><li>  md.SetQuery ( <font color="#A31515">@ "/ app13 / irb / 8bimiptc / iptc / object name"</font> , iptctitle); </li><li>  BitmapFrame frame = BitmapFrame.Create (decoder.Frames [ <font color="#A31515">0</font> ], decoder.Frames [ <font color="#A31515">0</font> ] .Thumbnail, md, decoder.Frames [ <font color="#A31515">0</font> ] .ColorContexts); </li><li>  BitmapEncoder encoder = <font color="#0000ff">new</font> <font color="#2b91af">JpegBitmapEncoder</font> (); </li><li>  encoder.Frames.Add (frame); </li><li>  <font color="#2b91af">FileStream</font> of = <font color="#2b91af">File</font> .Open ( <font color="#A31515">"test2.jpg"</font> , FileMode.Create, FileAccess.Write); </li><li>  encoder.Save (of); </li><li>  of.Close (); </li></ol></blockquote><br><br>  The code goes like a continuation of a fragment reading metadata.  We create a copy of the original file by writing in its metadata titles in all three metadata formats. <br><br><h4>  Editing in-place metadata </h4><br><br>  So far I have told in general fairly well-documented and simple things, but everything is more complicated here.  The example in the official documentation (MSDN) is incorrect and generally opposite in meaning to the real state of things. <br>  To edit metadata in place, you need to create an object of the InPlaceBitmapMetadataWriter class: <br><br><blockquote><ol><li>  InPlaceBitmapMetadataWriter writer; </li><li>  writer = decoder.Frames [ <font color="#A31515">0</font> ] .CreateInPlaceBitmapMetadataWriter (); </li></ol></blockquote><br><br>  After that, you can work with it as with ordinary BitmapMetadata, by calling SetQuery to set the necessary metadata. <br>  To save changes, you need to call the TrySave () method, which tries to save the changes to the original stream.  Attempting to write may or may not be successful.  If successful, the method returns true; on error, it returns false. <br>  The most common mistake that can prevent you from writing changes is that there is not enough free space in the metadata.  As a rule, all the freshly photographed photos do not contain enough space in the metadata, therefore, in order to start using metadata editing in place, you should make a copy of the file once, adding metadata in it with special padding fields that leave space for subsequent changes.  To do this, the file is opened, the necessary frame and its metadata are cloned, and several queries are executed: <br><br><blockquote><ol><li>  BitmapFrame frame = (BitmapFrame) decoder.Frames [ <font color="#A31515">0</font> ] .Clone (); </li><li>  BitmapMetadata metadata = (BitmapMetadata) decoder.Frames [ <font color="#A31515">0</font> ] .Metadata.Clone (); </li><li>  metadata.SetQuery ( <font color="#A31515">"/ app1 / ifd / PaddingSchema: Padding"</font> , <font color="#A31515">2048</font> ); </li><li>  metadata.SetQuery ( <font color="#A31515">"/ app1 / ifd / exif / PaddingSchema: Padding"</font> , <font color="#A31515">2048</font> ); </li><li>  metadata.SetQuery ( <font color="#A31515">"/ xmp / PaddingSchema: Padding"</font> , <font color="#A31515">2048</font> ); </li><li>  BitmapFrame newframe = BitmapFrame.Create (frame, frame.Thumbnail, metadata, original.Frames [ <font color="#A31515">0</font> ] .ColorContexts); </li></ol></blockquote><br><br>  After that, the frame is sufficient to encode the encoder and write to the desired stream, with the result that in the image there will be free space for editing the metadata on the spot afterwards. <br>  A padding value of 2048 bytes is usually sufficient.  If you need more - you can specify a larger value. <br><br><h4>  Query strings </h4><br><br>  I think everyone has a reasonable question when studying SetQuery / GetQuery methods - where do you get all these query strings that you can't call simple and intuitive? <br>  After a long search in MSDN found the appropriate <a href="http://msdn.microsoft.com/en-us/library/bb643802.aspx">list</a> .  There are probably all the necessary requests.  Missing ones can in principle be made up by analogy, there are plenty of examples :) <br><br><h4>  Subtleties and pitfalls </h4><br><br><ul><li>  WIC versions in Windows XP and Windows Vista can be buggy if the STAThread attribute is not specified for the calling JpegBitmapEncoder.Save () stream (by default, all threads created in the application receive the MTAThread attribute if not specified otherwise). </li><li>  The WIC version in Windows 7 saves the EXIF ‚Äã‚ÄãUserComment tag's default values ‚Äã‚Äãin Unicode, while in Windows XP and Windows Vista it is in the encoding of the current system language (CP1251 for Russian).  The format for writing UTF-8 parameters is as follows: the tag value itself is not stored as a string, but as an array of bytes.  The first 7 bytes is the ASCII string "UNICODE", after which the Unicode-encoded tag character sequence begins. </li><li>  The BitmapCacheOptions parameter should be treated carefully.  The OnLoad value caches all uncompressed image data in RAM, so if you open 20 large format JPEGs with this option, the free memory will be eaten very quickly.  This memory is <b>not released</b> when deleting the image classes themselves (BitmapFrame, BitmapDecoder, etc.) and processing them by the garbage collector.  In addition, to use the InPlaceBitmapMetadataWriter, open the image with BitmapCacheOptions = OnDemand or Default. </li><li>  In the example, I open the image with the IgnoreColorProfile flag, because  without it, on some images, BitmapDecoder throws an exception. </li></ul><br><br><h4>  Conclusion </h4><br><br>  In general, working with metadata using WPF seemed to me rather complicated and confusing.  Almost all of the described pitfalls cost me several hours of debugging and googling, information about this is nowhere, and the symptoms are sometimes very strange.  Official documentation (MSDN) covers this issue badly, and in some places is completely wrong. <br>  I hope that this collected information will help those who need to work with metadata through WPF, and save them a few hours of time :) <br><br>  PS I would be happy to see comments in comments (if I was mistaken somewhere) and descriptions of pitfalls that I haven‚Äôt met or forgot to mention. <br><br>  PPS Should I continue to write about WPF, or am I writing long-known things? </div><p>Source: <a href="https://habr.com/ru/post/93119/">https://habr.com/ru/post/93119/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../93108/index.html">"Call me, call", or how to get a job in an IT company</a></li>
<li><a href="../93109/index.html">What do you notice when applying for a job at an equal technical level of applicants?</a></li>
<li><a href="../93114/index.html">The keyboard is smaller and easier to enter - new touch screen features (tap & drag)</a></li>
<li><a href="../93117/index.html">A selection of useful repositories on GitHub</a></li>
<li><a href="../93118/index.html">CSS preprocessing on client</a></li>
<li><a href="../93121/index.html">Garmin-Asus n√ºvifone M10 Review</a></li>
<li><a href="../93123/index.html">Video under arrest</a></li>
<li><a href="../93126/index.html">Urban dead</a></li>
<li><a href="../93127/index.html">Alternative media advertising - in the style of Hollywood</a></li>
<li><a href="../93128/index.html">Open PBXs occupy 18% of the North American telephony market</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>