<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>From jQuery to Backbone</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will show you how to reorganize code written in a ‚Äúsimple‚Äù jQuery style into Backbone code, using views, models, collections, and events....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>From jQuery to Backbone</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage2/c2e/33c/52e/c2e33c52ea21a44b8a770920d1806191.jpg" alt="image">  This article will show you how to reorganize code written in a ‚Äúsimple‚Äù jQuery style into Backbone code, using views, models, collections, and events.  The reorganization will be gradual, so that this process gives a clear understanding of the basic abstractions in Backbone.  The article is designed for those who use jQuery and would like to get acquainted with the MVC scheme for client code. <br><a name="habracut"></a><br>  <i>This article is a translation of <a href="">material from github</a> .</i> <br><hr><br>  Let's start with the application code, which we will actually reorganize. <br><pre><code class="javascript hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>).find(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val() }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + data.text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>).find(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); } }); }); });</code> </pre> <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"new-status"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>New monolog<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Post"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"statuses"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Monologs<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <a href="http://monologue-js.herokuapp.com/">Here</a> you can look at the code in action.  The application allows you to enter text, when you click on "Post", this text is sent to the server and displayed below in the history. <br>  The application waits for the page to load, adds a wait for the submission of the form in which all the logic is located.  But what's the problem?  This code does many things at once.  It listens to page events, user events, network events, processes user input, analyzes the response, and manipulates the DOM.  And this is all in 16 lines of code.  Next, we reorganize this code so that it meets the <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">principle of common responsibility</a> , so that it is easy to test, maintain, reuse and extend. <br>  Here are three beliefs we want to achieve: <br><ul><li>  We want to extract as much code from <b>$ (document) .ready</b> .  In its current state, the code is almost impossible to test. </li><li>  We want to adhere to the single principle of responsibility, and make the code more usable and verifiable. </li><li>  We want to break the link between DOM and Ajax. </li></ul><br><h4>  DOM and Ajax separation </h4><br>  DOM manipulations need to be separated from working with Ajax, and the first step is to create the <b>addStatus</b> function: <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 1</b> <div class="spoiler_text"><br><pre> <code class="javascript hljs">+<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addStatus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ + $.ajax({ + url: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, + type: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, + dataType: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, + data: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val() }, + success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ + $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + data.text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); + $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); + } + }); +} + $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); - $.ajax({ - url: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, - type: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, - dataType: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, - data: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val() }, - success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ - $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + data.text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); - $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); - } - }); + addStatus(); }); });</code> </pre><br></div></div><br>  <i>Hereinafter, ‚Äú+‚Äù marks added lines, and ‚Äú-‚Äù marks deleted.</i> <br><br>  Of course, in both <b>data</b> and <b>success,</b> we still work with the DOM.  We must break this connection by passing them as arguments: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Change No. 2</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addStatus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, - data: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val() }, - success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ - $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + data.text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); - $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); - } + data: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: options.text }, + success: options.success }); } $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); - addStatus(); + addStatus({ + text: $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(), + success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ + $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + data.text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); + $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); + } + }); }); });</code> </pre><br></div></div><br>  Next, you need to wrap these statuses in an object, so that you can write <b>statuses.add</b> instead of <b>addStatus</b> . <br>  To do this, use the <a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/">constructor pattern</a> with the prototype, and create a <b>Statuses</b> "class": <br><br><div class="spoiler">  <b class="spoiler_title">Change number 3</b> <div class="spoiler_text"><pre> <code class="javascript hljs">-<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addStatus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ +<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ +}; +Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: options.text }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: options.success }); -} +}; $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); + $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); - addStatus({ + statuses.add({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(), <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + data.text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); } }); }); });</code> </pre><br></div></div><br><h4>  Creating a view </h4><br>  Our form handler now has one dependency on the <b>statuses</b> variable, and everything inside the handler only works with the DOM.  Let's move the form handler and everything inside to a separate ‚Äúclass‚Äù of <b>NewStatusView</b> : <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 4</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: options.text }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: options.success }); }; +<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = options.statuses; + + $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ + e.preventDefault(); + + statuses.add({ + text: $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(), + success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ + $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + data.text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); + $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); + } + }); + }); +}; + $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); - $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ - e.preventDefault(); - - statuses.add({ - text: $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(), - success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ - $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + data.text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); - $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); - } - }); - }); + <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); });</code> </pre><br></div></div><br>  Now we only initialize the application when the DOM is loaded, and everything else is rendered for <b>$ (document) .ready</b> .  The steps we have done so far have separated from the code two components that are easier to test and have clearer responsibilities.  But still there is work to do.  Let's start by removing the form handler from the view to a separate <b>addStatus</b> method: <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 5</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: options.text }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: options.success }); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = options.statuses; + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; - $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ - e.preventDefault(); - statuses.add({ - text: $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(), - success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ - $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + data.text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); - $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); - } - }); - }); + $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus); }; +NewStatusView.prototype.addStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ + e.preventDefault(); + + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add({ + text: $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(), + success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ + $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + data.text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); + $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); + } + }); +}; $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); });</code> </pre><br></div></div><br>  But when running in Chrome, we will see an error: <br><blockquote>  Uncaught TypeError: Cannot call method 'add' of undefined </blockquote><br>  We get this error because <b>this</b> has different values ‚Äã‚Äãin the constructor and the <b>addStatus</b> method.  (If you do not fully understand why this is happening, I recommend reading the <a href="http://yehudakatz.com/2011/08/11/understanding-javascript-function-invocation-and-this/">Understanding JavaScript Function Invocation and ‚Äúthis‚Äù</a> ).  To solve this problem, we can use <b>$ .proxy</b> , which creates a function in which <b>this</b> has the context we need. <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 6</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: options.text }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: options.success }); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; - $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus); + <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); + $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(add); }; NewStatusView.prototype.addStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(), <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + data.text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); } }); }; $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); });</code> </pre><br></div></div><br>  Let's make <b>success a</b> separate method that will work with the DOM, which will make the code more readable and flexible: <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 7</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: options.text }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: options.success }); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(add); }; NewStatusView.prototype.addStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); + <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> that = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(), <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ - $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + data.text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); - $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); + that.appendStatus(data.text); + that.clearInput(); } }); }; +NewStatusView.prototype.appendStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ + $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); +}; +NewStatusView.prototype.clearInput = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ + $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); +}; $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); });</code> </pre><br></div></div><br>  It is much easier to test and support the project as it develops.  We have also become closer to using Backbone. <br><br><h4>  Adding events </h4><br>  For the next step, we will need to use our first Backbone module - events.  Events are just a way of saying ‚ÄúHi, I want to know when some action will happen‚Äù and ‚ÄúHi, do you know what action you were waiting for just happened?‚Äù.  This is the same idea as jQuery events when working with the DOM, such as waiting for a click or submission. <br>  The Backbone documentation explains about Backbone.Events like this: ‚ÄúEvents are a module that can be mixed with any object, which gives an object the ability to associate and trigger custom events.‚Äù  The documentation also tells us how we can use Underscore.js to create an event manager: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = _.clone(Backbone.Events);</code> </pre><br>  With this little functionality, we can allow <b>success to</b> notify instead of calling functions.  We can also declare in the constructor which methods we want to notify when the event occurs: <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 8</b> <div class="spoiler_text"><pre> <code class="javascript hljs">+<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = _.clone(Backbone.Events); + <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: options.text }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: options.success }); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; + events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); + events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); + <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(add); }; NewStatusView.prototype.addStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); - <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> that = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(), <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ - that.appendStatus(data.text); - that.clearInput(); + events.trigger(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, data.text); } }); }; NewStatusView.prototype.appendStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); }; NewStatusView.prototype.clearInput = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); }; $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); });</code> </pre><br></div></div><br>  Now in the constructor we can declare what we want to call when a new status is added, instead of <b>addStatus</b> calling the desired function.  The only responsibility of <b>addStatus</b> is feedback, not manipulation of the DOM. <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 9</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = _.clone(Backbone.Events); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; -Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ +Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, - data: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: options.text }, - success: options.success + data: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: text }, + success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ + events.trigger(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, data.text); + } }); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(add); }; NewStatusView.prototype.addStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add({ - text: $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(), - success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ - events.trigger(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, data.text); - } - }); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add($(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val()); }; NewStatusView.prototype.appendStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); }; NewStatusView.prototype.clearInput = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); }; $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); });</code> </pre><br></div></div><br><h4>  Submission Duties </h4><br>  Looking at <b>appendStatus</b> and <b>clearInput</b> in <b>NewStatusView</b> , we see that these methods work with two different DOM elements, #statuses and # new-status, respectively.  This is not consistent with the principle of shared responsibility  Let's take responsibility for working with #statuses into a separate <b>StatusesView</b> view from <b>NewStatusView</b> .  This separation does not require much effort from us, since now we are using the event dispatcher, and with hard callbacks of functions this would be much more difficult. <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 10</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = _.clone(Backbone.Events); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: text }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ events.trigger(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, data.text); } }); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; - events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(add); }; NewStatusView.prototype.addStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add($(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val()); }; -NewStatusView.prototype.appendStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ - $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); -}; NewStatusView.prototype.clearInput = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); }; +<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ + events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); +}; +StatusesView.prototype.appendStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ + $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); +}; + $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); + <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView(); });</code> </pre><br></div></div><br>  Now, since views are responsible for only one HTML element, we can specify them in the constructor: <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 11</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = _.clone(Backbone.Events); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: text }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ events.trigger(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, data.text); } }); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>); events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); - $(<span class="hljs-string"><span class="hljs-string">'#new-status form'</span></span>).submit(add); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).submit(add); }; NewStatusView.prototype.addStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add($(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val()); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val()); }; NewStatusView.prototype.clearInput = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ - $(<span class="hljs-string"><span class="hljs-string">'#new-status textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>); + events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }; StatusesView.prototype.appendStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ - $(<span class="hljs-string"><span class="hljs-string">'#statuses ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); }; $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView(); });</code> </pre><br></div></div><br>  Our views, <b>NewStatusView</b> and <b>StatusesView</b> are still difficult to test because they depend on the availability of the HTML element.  To fix this, we will define these elements when creating views: <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 12</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = _.clone(Backbone.Events); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: text }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ events.trigger(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, data.text); } }); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = options.el; events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).submit(add); }; NewStatusView.prototype.addStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val()); }; NewStatusView.prototype.clearInput = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); }; -<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>); +<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = options.el; events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }; StatusesView.prototype.appendStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); }; $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); - <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); - <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView(); + <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>), <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); + <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>) }); });</code> </pre><br></div></div><br>  Now the code is easy to test.  With this change, we can use the following jQuery trick to test views.  Instead of initializing the view using for example <b>$ ('# new-status')</b> , we can pass the necessary jQuery HTML wrapper, for example <b>$ (' <code>‚Ä¶'</code> )</b> .  jQuery will create the necessary elements on the fly.  This provides incredibly fast tests, since there are no DOM manipulations. <br><br>  Our next step is to introduce an assistant to clear our views a bit.  Instead of writing <b>this.el.find</b> we can create a simple helper function so that we can write <b>this. $</b> .  With this small change, it looks like we are saying, ‚ÄúI want to use jQuery to search for something locally in the view, and not globally in all HTML‚Äù.  And it is so easy to add: <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 13</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = _.clone(Backbone.Events); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: text }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ events.trigger(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, data.text); } }); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = options.el; events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).submit(add); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).submit(add); }; NewStatusView.prototype.addStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val()); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val()); }; NewStatusView.prototype.clearInput = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); }; +NewStatusView.prototype.$ = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">selector</span></span></span><span class="hljs-function">) </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(selector); +}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = options.el; events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }; StatusesView.prototype.appendStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); }; +StatusesView.prototype.$ = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">selector</span></span></span><span class="hljs-function">) </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(selector); +}; $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>), <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>) }); });</code> </pre><br></div></div><br>  However, adding this function to each view looks silly.  This is one of the reasons to use Backbone views - to reuse functionality in views. <br><br><h4>  Getting started with views </h4><br>  In the current state of our code, you only need to write a couple of lines to add Backbone views: <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 14</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = _.clone(Backbone.Events); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: text }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ events.trigger(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, data.text); } }); }; -<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = options.el; - - events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); - - <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).submit(add); -}; +<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = Backbone.View.extend({ + initialize: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = options.el; + + events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); + + <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).submit(add); + } +}); NewStatusView.prototype.addStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val()); }; NewStatusView.prototype.clearInput = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); }; NewStatusView.prototype.$ = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">selector</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(selector); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = options.el; events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }; StatusesView.prototype.appendStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); }; StatusesView.prototype.$ = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">selector</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(selector); }; $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>), <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>) }); });</code> </pre><br></div></div><br>  As you can see from the code, we use <b>Backbone.View.extend</b> to create a new Backbone view.  In the successor we can specify methods, such as initialization, which is a constructor. <br>  Now that we have started using Backbone views, let's translate the second view to Backbone: <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 15</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = _.clone(Backbone.Events); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: text }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ events.trigger(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, data.text); } }); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = options.el; events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).submit(add); - } + }, + + addStatus: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ + e.preventDefault(); + + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val()); + }, + + clearInput: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); + }, + + $: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">selector</span></span></span><span class="hljs-function">) </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(selector); + } }); -NewStatusView.prototype.addStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ - e.preventDefault(); - - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val()); -}; -NewStatusView.prototype.clearInput = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); -}; -NewStatusView.prototype.$ = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">selector</span></span></span><span class="hljs-function">) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(selector); -}; -<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = options.el; - - events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); -}; -StatusesView.prototype.appendStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); -}; -StatusesView.prototype.$ = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">selector</span></span></span><span class="hljs-function">) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(selector); -}; +<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = Backbone.View.extend({ + initialize: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = options.el; + + events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); + }, + + appendStatus: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); + }, + + $: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">selector</span></span></span><span class="hljs-function">) </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(selector); + } +}); $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>), <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>) }); });</code> </pre><br></div></div><br>  Now, since we only use Backbone views, we can remove the function helper <b>this. $</b> Because it already exists in Backbone.  We also no longer need to save <b>this.el</b> , since Backbone does this automatically when the view is initialized by the HTML element. <br><br><div class="spoiler">  <b class="spoiler_title">Change ‚Ññ16</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = _.clone(Backbone.Events); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: text }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ events.trigger(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, data.text); } }); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = options.el; events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).submit(add); }, <span class="hljs-attr"><span class="hljs-attr">addStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val()); }, <span class="hljs-attr"><span class="hljs-attr">clearInput</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); }, - - $: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">selector</span></span></span><span class="hljs-function">) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(selector); - } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el = options.el; - events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">appendStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); }, - - $: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">selector</span></span></span><span class="hljs-function">) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(selector); - } }); $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>), <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>) }); });</code> </pre><br></div></div><br><h4>  Using models </h4><br>  The next step is to introduce models that are responsible for communicating with the server, that is, for Ajax requests and responses.  Since Backbone abstracts Ajax well, we no longer need to specify the type of request, data type and data.  Now we only need to specify the URL and call the save model.  The save method takes the data we want to save as the first parameter and parameters, such as callback, as the second parameter. <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 17</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = _.clone(Backbone.Events); +<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Status = Backbone.Model.extend({ + url: <span class="hljs-string"><span class="hljs-string">'/status'</span></span> +}); + <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ - $.ajax({ - url: <span class="hljs-string"><span class="hljs-string">'/status'</span></span>, - type: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, - dataType: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, - data: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: text }, - success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ - events.trigger(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, data.text); - } - }); + <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> status = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Status(); + status.save({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: text }, { + success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">model, data</span></span></span><span class="hljs-function">) </span></span>{ + events.trigger(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, data.text); + } + }); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).submit(add); }, <span class="hljs-attr"><span class="hljs-attr">addStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val()); }, <span class="hljs-attr"><span class="hljs-attr">clearInput</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ events.on(<span class="hljs-string"><span class="hljs-string">'status:add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">appendStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); } }); $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>), <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>) }); });</code> </pre><br></div></div><br><h4>  Handling multiple models </h4><br>  Now that we have introduced the models, we need the concept of a list of models, such as the list of statuses in our application.  In Backbone, this concept is called a collection. <br>  One of the great things about collections is that they have an area of ‚Äã‚Äãevents.  Basically, this simply means that we can bind and trigger events, directly on the collection, instead of using our event variables.  If we now start generating events directly on statuses, then there is no need for the word ‚Äústatus‚Äù in the name of the event, so we will rename it from ‚Äústatus: add‚Äù to ‚Äúadd‚Äù. <br><br><div class="spoiler">  <b class="spoiler_title">Change No. 18</b> <div class="spoiler_text"><pre> <code class="javascript hljs">-<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = _.clone(Backbone.Events); - <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Status = Backbone.Model.extend({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span> }); -<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ -}; -Statuses.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> status = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Status(); - status.save({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: text }, { - success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">model, data</span></span></span><span class="hljs-function">) </span></span>{ - events.trigger(<span class="hljs-string"><span class="hljs-string">"status:add"</span></span>, data.text); - } - }); -}; +<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = Backbone.Collection.extend({ + add: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> that = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; + <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> status = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Status(); + status.save({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: text }, { + success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">model, data</span></span></span><span class="hljs-function">) </span></span>{ + that.trigger(<span class="hljs-string"><span class="hljs-string">"add"</span></span>, data.text); + } + }); + } +}); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; - events.on(<span class="hljs-string"><span class="hljs-string">"status:add"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.on(<span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).submit(add); }, <span class="hljs-attr"><span class="hljs-attr">addStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val()); }, <span class="hljs-attr"><span class="hljs-attr">clearInput</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; + - events.on(<span class="hljs-string"><span class="hljs-string">"status:add"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.on(<span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">appendStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); } }); $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>), <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); - <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>) }); + <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>), <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); });</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can simplify this code using the Backbone creation method. </font><font style="vertical-align: inherit;">He creates a new instance of the model, adds it to the collection and stores it on the server. </font><font style="vertical-align: inherit;">Therefore, we must specify which type of model we will use for the collection. </font><font style="vertical-align: inherit;">There are two things we need to change to use the Backbone collection:</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> When creating a new status, we must transfer the name of the attribute we want to save, not just the text. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When creating, the ‚Äúadd‚Äù event is automatically triggered, but instead of transmitting only text, as it has been until now, the entire model will be sent. </font><font style="vertical-align: inherit;">We can get the text from the model by calling </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">model.get ("text")</font></font></b> </li></ul><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Change No. 19</font></font></b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Status = Backbone.Model.extend({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = Backbone.Collection.extend({ - add: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> that = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; - <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> status = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Status(); - status.save({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: text }, { - success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">model, data</span></span></span><span class="hljs-function">) </span></span>{ - that.trigger(<span class="hljs-string"><span class="hljs-string">"add"</span></span>, data.text); - } - }); - } + model: Status }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.on(<span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).submit(add); }, <span class="hljs-attr"><span class="hljs-attr">addStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val()); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.create({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val() }); }, <span class="hljs-attr"><span class="hljs-attr">clearInput</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.on(<span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, - appendStatus: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ + appendStatus: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">status</span></span></span><span class="hljs-function">) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + text + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + status.get(<span class="hljs-string"><span class="hljs-string">"text"</span></span>) + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); } }); $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>), <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>), <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); });</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As with </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> earlier, Backbone will automatically set </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this.collection</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> when the collection is transferred. </font><font style="vertical-align: inherit;">Therefore, we will rename the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">statuses</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collection</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in our views:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Change No. 20</font></font></b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Status = Backbone.Model.extend({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = Backbone.Collection.extend({ <span class="hljs-attr"><span class="hljs-attr">model</span></span>: Status }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = Backbone.View.extend({ - initialize: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ + initialize: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; - - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.on(<span class="hljs-string"><span class="hljs-string">'add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.collection.on(<span class="hljs-string"><span class="hljs-string">'add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).submit(add); }, <span class="hljs-attr"><span class="hljs-attr">addStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.add({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val() }); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.collection.create({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val() }); }, <span class="hljs-attr"><span class="hljs-attr">clearInput</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = Backbone.View.extend({ - initialize: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ + initialize: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses = options.statuses; - - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.statuses.on(<span class="hljs-string"><span class="hljs-string">'add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.collection.on(<span class="hljs-string"><span class="hljs-string">'add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">appendStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">status</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + status.get(<span class="hljs-string"><span class="hljs-string">'text'</span></span>) + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); } }); $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); - <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>), <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); + <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>), <span class="hljs-attr"><span class="hljs-attr">collection</span></span>: statuses }); - <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>), <span class="hljs-attr"><span class="hljs-attr">statuses</span></span>: statuses }); + <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>), <span class="hljs-attr"><span class="hljs-attr">collection</span></span>: statuses }); });</code> </pre><br></div></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Events in views </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now, let's finally get rid of </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ .proxy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">We can do this by delegating Backbone event management. </font><font style="vertical-align: inherit;">It looks like this: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{'event selector': 'callback'}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Change No. 21</font></font></b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Status = Backbone.Model.extend({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = Backbone.Collection.extend({ <span class="hljs-attr"><span class="hljs-attr">model</span></span>: Status }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = Backbone.View.extend({ + events: { + <span class="hljs-string"><span class="hljs-string">'submit form'</span></span>: <span class="hljs-string"><span class="hljs-string">'addStatus'</span></span> + }, + initialize: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.collection.on(<span class="hljs-string"><span class="hljs-string">'add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); - - <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).submit(add); }, <span class="hljs-attr"><span class="hljs-attr">addStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.collection.create({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val() }); }, <span class="hljs-attr"><span class="hljs-attr">clearInput</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.collection.on(<span class="hljs-string"><span class="hljs-string">'add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">appendStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">status</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + status.get(<span class="hljs-string"><span class="hljs-string">'text'</span></span>) + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); } }); $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>), <span class="hljs-attr"><span class="hljs-attr">collection</span></span>: statuses }); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>), <span class="hljs-attr"><span class="hljs-attr">collection</span></span>: statuses }); });</code> </pre><br></div></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Screen it </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Our final step is to prevent XSS attacks. </font><font style="vertical-align: inherit;">Instead of using </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">model.get ('text'),</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we will use the built-in screening function, it looks like </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">model.escape ('text')</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">If you use Handlebars, Mustache, or other template engines, you can get protection out of the box.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Change No. 22</font></font></b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Status = Backbone.Model.extend({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = Backbone.Collection.extend({ <span class="hljs-attr"><span class="hljs-attr">model</span></span>: Status }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">events</span></span>: { <span class="hljs-string"><span class="hljs-string">"submit form"</span></span>: <span class="hljs-string"><span class="hljs-string">"addStatus"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.collection.on(<span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">addStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.collection.create({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val() }); }, <span class="hljs-attr"><span class="hljs-attr">clearInput</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.collection.on(<span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">appendStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">status</span></span></span><span class="hljs-function">) </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + status.get(<span class="hljs-string"><span class="hljs-string">"text"</span></span>) + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + status.escape(<span class="hljs-string"><span class="hljs-string">"text"</span></span>) + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); } }); $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>), <span class="hljs-attr"><span class="hljs-attr">collection</span></span>: statuses }); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>), <span class="hljs-attr"><span class="hljs-attr">collection</span></span>: statuses }); });</code> </pre><br></div></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We are done! </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This is the final version of the code: </font></font><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Status = Backbone.Model.extend({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/status'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Statuses = Backbone.Collection.extend({ <span class="hljs-attr"><span class="hljs-attr">model</span></span>: Status }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewStatusView = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">events</span></span>: { <span class="hljs-string"><span class="hljs-string">'submit form'</span></span>: <span class="hljs-string"><span class="hljs-string">'addStatus'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.collection.on(<span class="hljs-string"><span class="hljs-string">'add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearInput, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">addStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.collection.create({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val() }); }, <span class="hljs-attr"><span class="hljs-attr">clearInput</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-string"><span class="hljs-string">''</span></span>); } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StatusesView = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.collection.on(<span class="hljs-string"><span class="hljs-string">'add'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendStatus, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">appendStatus</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">status</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'ul'</span></span>).append(<span class="hljs-string"><span class="hljs-string">'&lt;li&gt;'</span></span> + status.escape(<span class="hljs-string"><span class="hljs-string">'text'</span></span>) + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>); } }); $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statuses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Statuses(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewStatusView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#new-status'</span></span>), <span class="hljs-attr"><span class="hljs-attr">collection</span></span>: statuses }); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatusesView({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#statuses'</span></span>), <span class="hljs-attr"><span class="hljs-attr">collection</span></span>: statuses }); });</code> </pre><br> <a href="http://monologue-js.herokuapp.com/%3Fstep%3D22"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> you can look at the application after the reorganization. </font><font style="vertical-align: inherit;">Yes, of course from the user's point of view, it looks exactly like the first version. </font><font style="vertical-align: inherit;">And besides, the code has grown from 16 lines to more than 40, so why do I think that the code is better? </font><font style="vertical-align: inherit;">Yes, because now we are working at a higher level of abstraction. </font><font style="vertical-align: inherit;">This code is easier to maintain, easier to reuse and expand, and easier to test. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we have seen, Backbone has significantly improved the code structure of the application, and in my experience the end result is less complex and has less code than my ‚Äúvanilla javascript‚Äù. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for convenience, hid the sources of changes in spoilers</font></font></div><p>Source: <a href="https://habr.com/ru/post/170563/">https://habr.com/ru/post/170563/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../170551/index.html">Hours on gas-discharge indicators</a></li>
<li><a href="../170553/index.html">APT1: resistant intrusion pattern</a></li>
<li><a href="../170557/index.html">Attempt to translate and voice acting video at home</a></li>
<li><a href="../170559/index.html">And about the clock</a></li>
<li><a href="../170561/index.html">Mozilla introduced the commercial version of Firefox OS and plans to promote its OS</a></li>
<li><a href="../170565/index.html">Emmet v1.0 released</a></li>
<li><a href="../170569/index.html">ASUS MeMO Pad ME172V Tablet Review</a></li>
<li><a href="../170571/index.html">Yarr - dataflow framework (image processing) on ‚Äã‚ÄãHaskell</a></li>
<li><a href="../170575/index.html">ZTE Open - the first official phone on Firefox OS</a></li>
<li><a href="../170577/index.html">HTML5 standards logo or How to put a vector image on a web page</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>