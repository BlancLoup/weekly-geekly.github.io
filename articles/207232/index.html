<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cards for all, for nothing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Programmers are rare people. We can do absolutely everything, but the Internet responds with a gaping void, where you have to do absolutely everything...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cards for all, for nothing</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/a26/051/f33/a26051f33a2e99e33eae62c4513cbcd8.png" align="right">  Programmers are rare people.  We can do absolutely everything, but the Internet responds with a gaping void, where <i>you have</i> to do absolutely everything.  Especially if you live in non-core communities.  Requests from all sides, here you need to patch, there is a plugin to finish, and no one but you.  This story is about one of these spaces, which I had hoped to close in a week, and that week everything goes on.  In the program: road construction and cyclists, a site for exchanging maps is better than Yandex, osmery without osma, plugin architecture in forum engines and interactive maps right in Habr√©. <br><br><a name="habracut"></a><br><h1>  Fifty fourth kilometer </h1> I am interested in many.  Once I drove Friday night bike rides, now I am helping people understand that OpenStreetMap is the best map in the world, and I also follow the ‚ÄúProjects of St. Petersburg‚Äù <a href="http://spb-projects.ru/forum/">forum</a> for road construction in the city and region.  The federal budget means news every day: they blocked and unearthed there, an inconvenient transition was erected there, VAD again built an ideal outcome again.  The forum participants quickly mastered OSM, so on the map of the Leningrad Region roads open exactly on the day of ribbon cutting, and all plans are so accurate that OpenStreetMap prints hang in the offices of construction companies. <br><br>  One uncomfortable: no cards at hand.  In the city, you can still attach yourself to the streets in words (everyone knows where Solunskaya Street intersects with Tbilisi), and outside the city either ‚Äúthey will restrict traffic on the highway from 54 to 81 km‚Äù or ‚Äúthe base of builders stands behind the junction in Skotny, six kilometers to the north and one to the west ‚Äù: everything is incomprehensible.  Therefore, participants take pictures of Yandex.Maps and attach a picture.  This is at best, otherwise just give a link.  Placing photographing points on the map is generally a special street magic.  I made a photo report from the construction of the railway from Losev to Kamennogorsk on a <a href="http://textual.ru/lk130518/">separate website</a> so that the map was at hand, but the openness and simplicity of the <a href="https://github.com/Zverik/geoalbum">tool</a> will help anyone: many do not even have their own page.  We need a real map, full-featured and simple. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the spring, I realized that 1) the Leaflet library makes embedding a card elementary, 2) no one except me will write a normal map plugin.  Because the main principle of open source: who needs it - he writes.  Immediately came up with <a href="http://mapbbcode.org/ru/bbcode.html">the code format</a> .  Basic prerequisite: maps are inseparable from the text, like pictures and links, so they must be expressed in the usual bb-code, of course, <code>[map]</code> .  Inside the tag, the objects expressed by a sequence of coordinates are listed in a semicolon.  One pair of "latitude, longitude" - will be a marker, two or more separated by a gap - a line, the first point is equal to the last - a polygon.  After the coordinates in brackets can go signature.  Like this: <br><br> <code>[map]59.939,30.316(); 59.937,30.3127 59.9312,30.36[/map]</code> <br> <br>  The target forum works on the engine of 2006 (that was the time of IE 7 and Opera 9), so it‚Äôs unwise to be tied to it.  I decided to bring all the functionality, including the parser, to the library in JavaScript, in order to later connect it to different engines.  Thanks to Leaflet.draw, my job has come down to developing an API and a plugin.  The case was arguing: a comment to the commit from October 1 reports ‚Äúalmost final‚Äù.  But the technological demo is one thing, and the pro-exploitation requires refinement: combing and breaking the source into modules, checking in a heap of browsers, adding important functions, polishing formats and parameters.  A week after the start of development, the source code moved from a personal svn to a <a href="https://github.com/MapBBCode/mapbbcode">githab</a> , and an unusually long gitkhabovsky streak began: as many as 23 days (before that there were 5).  The game of maintaining the chain of days is fascinating: after a couple of weeks, sometimes you just want to add a ticket so that participation is registered. <br><br>  On October 28, the plugin was installed on the forum, on October 31, release 1.0.0 <a href="http://shtosm.ru/all/karty-dlya-vseh-darom/">was</a> released. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/51c/6fd/09f/51c6fd09f8368142f666af48082423f3.png"><br><br>  After graduation, I realized that storing documentation on a githaba is not the case: how to translate it?  <a href="http://mapbbcode.org/ru/index.html">Mapbbcode.org</a> appeared with a library demonstration, a link to plug-ins and, for today, 80 kilobytes of documentation in English and 50 in Russian.  The library, meanwhile, learned how to connect the proprietary layers of the Google Index, because it was the second question for all administrators (the first one - ‚Äúwhy is the layer not stored in bb code?‚Äù).  Immediately comment from the OpenStreetMap forum: ‚Äúit started as an OSM tool, and you‚Äôll get another gugloplagin‚Äù.  FURY.  Added to the relevant classes to check whether the library does not use a google plugin.  Another osmer: "in my opinion, it is somehow petty."  Everything is wrong for them. <br><br>  The format of the bb-code provides for expansion through the parameters, and it is answered in the library.  Processing signatures and color parameters, counting the length of lines and thinning broken points - everything can be done through <a href="https://github.com/MapBBCode/mapbbcode/tree/master/src/handlers">handlers</a> .  With the advent of tasks, their APIs quickly outgrew the API for library users: there is both the modification of objects, the management of the map, and the fine tuning of the editor.  Through them, it‚Äôs quite possible to embed another editor into the editor, or to cut holes from bagels. <br><br>  When, a month and a half after the release, no one translated a word into new languages, I suspected that translation by pull-requests was hopeless.  After removing the script from the repository of the iD editor, I sent all the lines to <a href="https://www.transifex.com/projects/p/mapbbcode/">Transifex</a> , and download them before building the release.  ‚ÄúWell, let's go fucking live now‚Äù - rubbing his hands, satisfied someone's request to add German to the project.  Then another added French.  I can add a lot more - only to sense, when even that German escaped somewhere.  Apparently, the problem was not in pull requests. <br><br><h1>  Make a wanted iron - an elephant turned out suddenly </h1>  Custom maps are regular strings.  And what if they are stored in a database?  MapBBCode + DB = a simple service for exchanging maps, <a href="http://share.mapbbcode.org/">MapBBCode Share</a> .  The source code of the map is available - it can be copied to a forum or blog.  Inspired by openstreetmap.ru, I made the issuance of two links after saving: to view and to change.  And here on the forum the organizer of the Moscow kartovstrechi posted a link to edit the plan, breaking the template for me.  Suddenly it turned out that I had written a wonderful tool for joint planning of routes and meetings. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/932/a74/aa4/932a74aa41bc393b8d5f8174589f6dcf.png"><br><br>  The site is anonymous and does not require anything: I went in, drew lines with markers, clicked "Save", got a link.  In order not to clutter up browser bookmarks with links to editing, I made an entry through OAuth: the resulting identifier is hashed so that even the administrator does not know who draws the cards, and the API does not allow linking hashes and maps, so even indirect recognition is excluded.  This is not Google, which writes every sneeze into the database: in some way I wanted to make an absolutely safe service. <br><br>  Then - import and export buttons.  I love to process data, so the site supports about 11 main formats, including CSV, GPX, GeoJSON (where can I go without it), OziExplorer formats and HTML.  Unlike all other sites, MapBBCode Share produces absolutely self-sufficient HTML (apart from Leaflet dependencies): no links to MapBBCode, no conditions.  And considering the other formats, the service can be used for conversions: CSV ‚Üí HTML for table visualization, or PLT ‚Üí GPX. <br><br>  Well, the API.  Having made the key <code>?format=raw</code> , it dawned on me once again, which epic website I wrote.  The MapBBCode class has a new method: by the banal <code>showExternal('divid', '')</code> call <code>showExternal('divid', '')</code> you can load and display an external map.  For example, having seen how great the Olympic infrastructure is drawn in OSM, I made a <a href="http://osmz.ru/ZOI4/">postcard about Sochi</a> in this way.  In all forum plugins, the code <code>[mapid]</code> , the same map can be inserted wherever the code is supported, you can edit it together, and you can download the track directly with a button from the forum.  Without any &lt;iframe&gt;.  Of course, the <a href="">source code of the</a> server is open, and plugins allow the administrator to send requests to himself. <br><br><h1>  Your plugin is very important to us, stay on line. </h1>  It quickly became clear that, despite the simplicity of the <a href="http://mapbbcode.org/api.html">API</a> (in reality, an object with two methods, show and editor) and a detailed integration <a href="http://mapbbcode.org/embedding.html">guide</a> , no one will write plugins for forums.  The first principle is open source, you remember.  And Napoleon‚Äôs plans: to seize a bicycle rider (FUDForum), a bicycle route (local marathon runners, phpBB 3), an OSM forum (FluxBB), a superman (vBulletin), the Pskov off-road club (SMF).  Later, the forums included the Citygide (IP.Board) and Krasnodar jeepers (PunBB) forums.  Christmas trees, sticks, why so many different engines?  This is some kind of hell. <br><br>  The programming process is not interesting: well, I sat down, well, about ... 4-5 days, got the plugin and experience.  I'll tell you about the system modifications. <br><br>  The forums are divided into two types: which need to be changed line by line (plug-ins are called modifications and are ennobled diffs) and which are hooked (plug-ins are divided into small functions called from different points).  The first are terrible.  Just dark.  This is phpBB3, SMF and FluxBB - a unique engine, lauding for its speed, and reviewers tactfully skip the system of modifications.  No wonder: it is not.  Totally.  The engine is conceptually minimalist, even without bb-code buttons in the editor (and for the MapBBCode editor open button is important: the user will not write coordinates with his hands), while there is absolutely no way to install extensions except to climb into the wilds of the code and manually edit the lines.  Madness. <br><br>  At the same time, writing plug-ins under its other branch, PunBB, is a continuous pleasure.  Hundreds of hooks, everything is clean and clear, simplicity follows from minimalism, from simplicity - an understanding of how everything works, and where to embed.  Installing plug-ins is elementary: unpack the archive, click the ‚Äúinstall‚Äù button in the admin panel.  And, of course, there is a delete button with which the forums of the first type have a problem.  But life is cruel: PunBB had the last release two years ago, and it slowly dies, and on the FluxBB forum, life boils over.  FUDForum, also fast and with hooks, barely breathes, supported by one person. <br><br>  Today I have released plugins for phpBB 2, phpBB 3 (they are very different), FUDForum, PunBB and FluxBB.  Waiting: ‚ÄúThank you for the plugin, we installed it and use everything!‚Äù Reality: ‚ÄúThank you, but I don‚Äôt want to touch anything,‚Äù ‚ÄúI will install, only a little later‚Äù, ‚Äúthe inscriptions in Georgia are not translated and the time stamps are not saved in the tracks, better in the old manner.  At one of the forums on phpBB 3, the administrator enthusiastically started to install, but AutoMOD suddenly crashed, unable to copy files in a banal manner, and there is no more news from there.  Forum administrator OpenStreetMap does not respond.  Nobody needs maps: on the construction forum they were useful, and bicyclists and jeepers are easier to use GPSies and Osik. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d7f/c9b/417/d7fc9b417ef66803ab17f5af8d1dfda4.png"><br><br><h2>  Everyone is paying </h2><br>  Somewhere on the horizon looms the grail, a forum that will give meaning to all this endless work.  SkyscraperCity is also dedicated to the construction, but on the scale of the entire planet.  It is included in all the dozens of the largest forums of the network.  The administrator is <a href="http://www.skyscrapercity.com/showthread.php%3Ft%3D1672944">interested</a> in the plugin.  One ‚Äúbut‚Äù: the forum, like the first hundred of the other largest, works on vBulletin.  And this engine is closed all around: no source, no documentation, no code on the user forum (!), Until you buy a license (from $ 250).  Even if you are not going to install it, but you only want to expand the plugin catalog.  The support service answers in monosyllables: <br><br>  - You would need a license to get access to the vBulletin code. <br>  - We do not offer any sort of development license, sorry. <br><br>  On the other hand, requests to roll up IP.Board are multiplying.  Which is all so beautiful, friendly and with documentation, that's just also paid and "sorry, goodbye."  I suppose the sellers of these engines believe that administrators let plugins write and third-party developers are so few that they can be neglected.  Although ... It must be true. <br><br><h1>  Violent penetration </h1>  Finally, the engine of my news blog "SHTOSM" tightly closed.  Enough of this: to hell with the integration guide, I have 100 kilobytes of code behind me, I can bypass this problem too.  And smog.  <a href="https://github.com/MapBBCode/mapbbcode-loader">MapBBCode Loader</a> is a small script that quietly views the page and barely envies the bb-code of the map, connects all the necessary libraries and turns the codes (preferably wrapped in <code>&lt;div class="mapbbcode"&gt;</code> ) into interactive maps, and into buttons with <code>class="mapbbcode_edit"</code> hangs up the editor.  In fact, it is a plugin for anything on one line. <br><br>  Why explain when you can show?  Copy the following line in the browser's address field.  In IE and Chrome, you need to restore the ‚Äújavascript:‚Äù prefix, in Firefox, you need to press Shift + F4, copy to the window and press Ctrl + R.  Thank you <a href="http://www.jsdelivr.com/">jsDelivr</a> for the responsive CDN. <br><br> <code>javascript:(function(){document.body.appendChild(document.createElement('script')).src = '//cdn.jsdelivr.net/mapbbcode-loader/1.2.0/MapBBCodeLoader.plain.js';})();</code> <br> <br>  [map] 56.4077,40.44374 (B);  56.12384, 40.38076 (R);  57.61273.39.83042 (R);  57.75955.40.9372 (A);  56.31796.38.12943 (H);  57.18758.39.41592 (B);  56.73446.38.85856 (A);  57.51117,41.23761 (H);  55.7574,37.6623 58.0721,40.5286 57.439,41.3635 56.0414,40.188 55.9247.39.4626 (black |);  56.9995,40.9675 (A) [/ map] <br><br>  And a victory: maps <a href="http://shtosm.ru/all/mapbbcode-triumphant/">appeared</a> in the patrol, and the modification for FluxBB was reduced to four edits: one per bootloader, two per bb code and one per editor button.  Anyone can add a map to the site, and some engines allow you to do this without touching the files at all (for example, phpBB 3 and, theoretically, vBulletin). <br><br><h1>  So close and so far </h1><img src="https://habrastorage.org/getpro/habr/post_images/44d/953/d65/44d953d65e986b9bf7024d5083e59fc4.jpg"><br>  <sub>(drawing by <a href="http://instagram.com/fevrony">Tanya Zadorozhnaya</a> )</sub> <br><br>  The project is exhausting.  For three months, every day, several hours in the evenings, I close library tickets, I suddenly write important functions, I fight with forum engines and IE, I write documentation in English and translate into Russian.  The project eats away the time from the rest: movies, mapping, friends, sex.  I finished one function - I invented two others, wrote a plugin for the forum - nobody needs it, but three people asked for another engine.  Versioning and milestones help: when 90% of tickets for the next version are closed, there is no incentive to add work to yourself.  Always need a goal, the achievement of which is tangible and does not cause a feeling of incompleteness. <br><br>  This night there was another release, <a href="http://mapbbcode.org/ru/index.html">MapBBCode 1.2</a> .  All important tasks are finally done, the documentation is almost complete: there is a step-by-step developer guide left (no task).  Transifex is waiting for translators, plug-ins are waiting for administrators.  I unsuccessfully struggle with the desire to drown in programming, to close absolutely all tickets, to cover all the engines, including Joomla and Drupal (bitrix? ..).  Development can not be completed, you can only stop, and it's time to take up other ideas, waiting for the pages of a notebook.  MapBBCode is not going anywhere: I am responsible for what I wrote, and minor versions with corrected errors are inevitable, and vBulletin will sooner or later submit. </div><p>Source: <a href="https://habr.com/ru/post/207232/">https://habr.com/ru/post/207232/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../207216/index.html">Qadars - a new banking Trojan with the ability to bypass two-factor authentication</a></li>
<li><a href="../207220/index.html">December distribution of servers: voting</a></li>
<li><a href="../207224/index.html">Is it possible to centrally manage language settings?</a></li>
<li><a href="../207228/index.html">How to raise the average check?</a></li>
<li><a href="../207230/index.html">Android 4.3 for Z series devices</a></li>
<li><a href="../207234/index.html">Dremel. How does Google think in real-time?</a></li>
<li><a href="../207236/index.html">Launch of the project GeeksLab and the announcement of the conference ‚ÄúHappu New Front-End! On the frontend in a new way! "January 18 in Odessa</a></li>
<li><a href="../207238/index.html">Download Reveal SDK with any applications.</a></li>
<li><a href="../207242/index.html">Ultra-high-frequency power supplies for laptops: 4 times smaller and 6 times lighter than usual</a></li>
<li><a href="../207250/index.html">Escalation alerts. Typical scenarios</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>