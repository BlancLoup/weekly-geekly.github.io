<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tons of garbage and a minimum of useful work or scrolling in Idea</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="More recently, when I switched to a new project, I decided to switch from Eclipse to Idea for a change. I already had experience with the idea from ve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tons of garbage and a minimum of useful work or scrolling in Idea</h1><div class="post__text post__text-html js-mediator-article">  More recently, when I switched to a new project, I decided to switch from Eclipse to Idea for a change.  I already had experience with the idea from version 6, I liked it, but it had a lot of problems.  Then I refused it in view of periodic glitches with long work.  When I saw that the 11th version was already in the yard, I was delighted and decided to try my luck again, because the interface is a much nicer idea for me ... <br><br>  About a month ago, I noticed that during active development, when 768 MB of memory allocated for a heap are filled under 80%, any action, such as mouse movement, focus switching, just scrolling with the mouse wheel or directly scrolling in the window causes a large memory consumption and the remaining 20% ‚Äã‚Äãof memory is eaten in a few seconds of work.  Then, of course, you can forget about comfortable work and have to overload the environment due to the constant response of the collector.  Today this situation finally got me and I decided to find out - what is the actual problem? <br><br>  Intuitively, I understood that most likely every movement of the mouse and any action, like scrolling, generates certain events that are then processed, but I did not expect so many of these events.  For the seed - 2 screenshots of memory consumption when moving the mouse in the editor window and scrolling inside the open class for 1000 lines: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Motion: <img src="https://habrastorage.org/storage2/59c/58f/a24/59c58fa2466518208cece265bd31d863.png" alt="mouse move"><br>  Scrolling: <img src="https://habrastorage.org/storage2/7ac/cfe/ab5/7accfeab57953073a9a7ed643f49451c.png" alt="scrolling"><br><br>  Normal scrolling in the code editing window at the peak eats up almost 100mb of memory in a few seconds ... Any mouse movement generates objects for dozens of megabytes ... The only positive point in all this is that all these objects are then collected. <br><br><a name="habracut"></a><br>  Naturally, I wondered what this idea generates with such simple actions.  So, repeat the experiment: <br><img src="https://habrastorage.org/storage2/206/226/039/206226039f98a2609ccdb20fcb49d903.png"><br>  1.5 million objects for scrolling a little expensive, is not it?  But now it became more or less clear where the problem lies.  This is a kind of class IntervalTreeImpl and its inner class NodeCachedOffsets.  Now we have as many as 2 ways to research: 1) download the IntervalTreeImpl source code and see where and how NodeCachedOffsets are created and why there are so many of them (by the way, many thanks to the developers for the open source codes);  2) Analyze the call stack when scrolling. <br><br>  I went first in the first way, and then having an idea of ‚Äã‚Äãwhat was happening, I analyzed the call stack in order to finally be convinced of the correctness of the conclusions ... So, who cares, you can find the source <a href="http://git.jetbrains.org/%3Fp%3Didea/community.git%3Ba%3Dblob%3Bf%3Dplatform/core-impl/src/com/intellij/openapi/editor/impl/IntervalTreeImpl.java%3Bh%3Dd288d7cbe9a665a0841e85c7006a9f7409fa5177">here</a> .  Try to figure it out yourself by looking at the code where the problem lies. <br><br>  After analyzing the code, it becomes more or less clear what to expect from the call stack, here is its most interesting part: <br><img src="https://habrastorage.org/storage2/d86/293/305/d8629330567e80a54433d517d52f5805.png"><br>  and <br><img src="https://habrastorage.org/storage2/4a3/32f/12f/4a332f12f1efa91f4cb3dc5494e502d0.png"><br><br>  Pay attention to the computeDeltaUpToRoot () method at the very end of the stack and besides it is called quite often and in different ramifications of the stack.  In general, having a code, an error on the face - this method is called very often and in many places and at the same time it constantly generates new objects of the problem NodeCachedOffsets class.  Obviously, to solve the problem, you just need to get rid of the constant creation of these objects and replace them, for example, with just a large primitive (as an option) or change the approach to drawing the editing window (it requires a lot of refactoring). <br><br>  In general, here I wanted to beautifully solve the problem and demonstrate its solution, but ... What was my surprise when downloading the latest sources to correct the problem (git: //git.jetbrains.org/idea/community.git), I found that this error has already been fixed, and even 5 months ago ... You can see the fix itself <a href="http://git.jetbrains.org/%3Fp%3Didea/community.git%3Ba%3Dcommitdiff%3Bh%3Df9c3e955664fa72d1d4149aeebff0286ff633d05">here</a> .  It is strange that in the latest version of the idea (11.1.2) there is still no this fix.  I would like to get it as soon as possible ... Nevertheless, it is rather pleasant that the guys care about the product. </div><p>Source: <a href="https://habr.com/ru/post/147552/">https://habr.com/ru/post/147552/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147546/index.html">Custom ExpandableListView in Android</a></li>
<li><a href="../147547/index.html">Tablet on Android with a diagonal of 21.5 inches</a></li>
<li><a href="../147548/index.html">Stay in space extends the life of worms</a></li>
<li><a href="../147549/index.html">Geomagnetic positioning as an addition to GPS</a></li>
<li><a href="../147551/index.html">On the bill number 89417-6</a></li>
<li><a href="../147553/index.html">Kickstarter is gradually becoming international - England is the first</a></li>
<li><a href="../147554/index.html">Google close to paying $ 22.5 million fine</a></li>
<li><a href="../147555/index.html">Low blood count</a></li>
<li><a href="../147556/index.html">Motorola Atrix HD Smartphone Officially Announced</a></li>
<li><a href="../147557/index.html">Ouya - a new gaming console on Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>