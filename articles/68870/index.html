<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Image recognition. Algorithm Eigenface</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 

 I continue a series of articles on pattern recognition, computer vision and machine learning. Today I present to you an overview of th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Image recognition. Algorithm Eigenface</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br><br>  I continue a <a href="http://indalo.habrahabr.ru/blog/">series of</a> articles on pattern recognition, computer vision and machine learning.  Today I present to you an overview of the algorithm, which is called eigenface. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5bb/958/80a/5bb95880afb0aec2572a74177ef442c4.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The algorithm is based on the use of fundamental statistical characteristics: averages ( <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B0%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0%25D1%2582%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B5_%25D0%25BE%25D0%25B6%25D0%25B8%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">mat. Expectation</a> ) and <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25B2%25D0%25B0%25D1%2580%25D0%25B8%25D0%25B0%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BC%25D0%25B0%25D1%2582%25D1%2580%25D0%25B8%25D1%2586%25D0%25B0">covariance matrix</a> ;  using <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D0%25B3%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25BD%25D1%258B%25D1%2585_%25D0%25BA%25D0%25BE%25D0%25BC%25D0%25BF%25D0%25BE%25D0%25BD%25D0%25B5%25D0%25BD%25D1%2582">the principal component method</a> .  We will also touch upon such concepts of linear algebra as eigenvalues ‚Äã‚Äã(eigenvalues) and eigenvectors (eigenvectors) (wiki: <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BE%25D0%25B1%25D1%2581%25D1%2582%25D0%25B2%25D0%25B5%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B5_%25D0%25B2%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580%25D1%258B,_%25D0%25B7%25D0%25BD%25D0%25B0%25D1%2587%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F_%25D0%25B8_%25D0%25BF%25D1%2580%25D0%25BE%25D1%2581%25D1%2582%25D1%2580%25D0%25B0%25D0%25BD%25D1%2581%25D1%2582%25D0%25B2%25D0%25B0">ru</a> , <a href="http://en.wikipedia.org/wiki/Eigenvalue,_eigenvector_and_eigenspace">eng</a> ).  And in addition, we will work in multidimensional space. <br>  No matter how scary it all sounds, this algorithm is probably one of the simplest ones I have examined, its implementation does not exceed several dozen lines, at the same time it shows quite good results in a number of tasks. <br><br><a name="habracut"></a><br>  For me, eigenface is interesting because for the last 1.5 years I have been developing, including statistical algorithms for processing various data arrays, where very often we have to deal with all the above ‚Äúpieces‚Äù. <br><br><h2>  Tools </h2><br><br>  According to the current methodology, after thinking about an algorithm, but before implementing it in C / C ++ / C # / Python etc., it is necessary to quickly (as far as possible) create a mathematical model and test it, count something.  This allows you to make the necessary adjustments, correct errors, to detect what was not taken into account when thinking about the algorithm.  For all this I use <a href="http://ru.wikipedia.org/wiki/Mathcad">MathCAD</a> .  The advantage of MathCAD is that along with a huge number of built-in functions and procedures, it uses classical mathematical notation.  Roughly speaking, it is enough to know mathematics and be able to write formulas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/737/218/ac9/737218ac9e6cb39d8b6208a9adb32be2.png"><br><br><h2>  Brief description of the algorithm </h2><br><br>  Like any algorithm from the machine learning series, the eigenface must first be trained; for this, a training set is used, which is an image of the people we want to recognize.  After the model is trained, we will submit some image to the input and as a result we will get an answer to the question: which image from the training set most likely corresponds to an example at the input, or does not correspond to any. <br><br>  The task of the algorithm is to present the image as the sum of the basis components (images): <br><img src="https://habrastorage.org/getpro/habr/post_images/c25/6ea/ab4/c256eaab46e6a6b00a457c8ffd484a16.png"><br><br>  Where Œ¶ <sub>i</sub> is the centered (i.e. minus the average) i-th image of the original sample, w <sub>j</sub> are weights and u <sub>j are</sub> eigenvectors (eigenvectors or, within this algorithm, eigenfaces). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ac2/281/a85/ac2281a85952fccaedd26ffb9e99060d.jpg"><br><br>  In the picture above, we get the original image by weighted summation of the eigenvectors and by adding the average.  Those.  with w and u, we can restore any original image. <br><br>  The training set needs to be projected into a new space (and the space, as a rule, is much more dimension than the original 2-dimensional image), where each dimension will make a certain contribution to the overall presentation.  The method of principal components allows one to find a basis for a new space so that the data in it are located, in a sense, optimally.  To understand, just imagine that in the new space some dimensions (aka main components or eigenvectors or eigenfaces) will ‚Äúcarry‚Äù more general information, while others will only carry specific information.  As a rule, higher-order dimensions (corresponding to smaller eigenvalues) carry much less useful (in our case, useful means something that gives a generalized view of the whole sample) information than the first dimensions corresponding to the largest eigenvalues.  Leaving the dimensions with only useful information, we obtain a feature space in which each image of the original sample is represented in a generalized form.  This is very simplistic, and the idea of ‚Äã‚Äãthe algorithm consists. <br>  Further, having on hand some image, we can map it to the space created in advance and determine to which image of the training set our example is located the closest.  If it is located at a relatively large distance from all data, then this image with a high probability does not belong to our database at all. <br><br>  For a more detailed description, I advise you to refer to the list of <a href="http://en.wikipedia.org/wiki/Eigenface">External links on</a> Wikipedia. <br><br>  A small digression.  The method of principal components is quite widespread.  For example, in my work I use it to select components of a certain scale (temporal or spatial), direction or frequency in an array of data.  It can be used as a method for data compression or a method for reducing the original dimension of a multidimensional sample. <br><br><h2>  Creating a model </h2><br><br>  The <a href="http://www.cl.cam.ac.uk/research/dtg/attarchive/facedatabase.html">Olivetti Research Lab's (ORL) Face Database was</a> used to compile the training sample.  There are 10 photos of 40 different people: <br><img src="https://habrastorage.org/getpro/habr/post_images/fc6/8d3/cb6/fc68d3cb61808ef07b5e413ff561270a.png"><br><br>  To describe the implementation of the algorithm, I will insert here screenshots with functions and expressions from MathCAD and comment on them.  Go. <br><br>  one. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5e8/e5d/33b/5e8e5d33bbc2088af935646af2ee7180.png"><br><br>  faceNums sets the vector of numbers of persons to be used in training.  varNums sets the version number (according to the database description, we have 40 directories each with 10 image files of the same person).  Our training sample consists of 4 images. <br>  Next, we call the ReadData function.  It implements sequential data reading and image transfer to a vector (TwoD2OneD function): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f2c/fd3/4e0/f2cfd34e0e51c82c7808fdd83c3c6f5a.png"><br><br>  Thus, at the output we have a matrix Œì, each column of which is an image ‚Äúexpanded‚Äù into a vector.  Such a vector can be considered as a point in multidimensional space, where the dimension is determined by the number of pixels.  In our case, images with a size of 92x112 give a vector of 10304 elements or set a point in 10304-dimensional space. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f47/bd9/691/f47bd9691a8f2814aeab25fb718be29b.png"><br><br>  2. It is necessary to normalize all the images in the training set, taking away the average image.  This is done in order to leave only unique information, removing the elements common to all images. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1c5/7e7/41a/1c57e741ad20499a4933773f2e34bc69.png"><br><br>  The AverageImg function counts and returns the mean vector.  If we ‚Äúturn‚Äù this vector into an image, we will see ‚Äúaveraged face‚Äù: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d89/b04/b48/d89b04b480e7f60949d68e98dfd4cd9b.png"><br><br>  The Normalize function subtracts the average vector from each image and returns the average sample: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6da/c8a/a56/6dac8aa56f6841173a51717a66220fc6.png"><br><br>  3. The next step is the calculation of eigenvectors (they are also eigenfaces) u and weights w for each image in the training sample.  In other words, it is a transition to a new space. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/74f/e05/50f/74fe0550fe7b4b193b36adf5556a2624.png"><br><br>  We calculate the covariance matrix, then we find the main components (they are also eigenvectors) and count the weights.  Those who are closer to the algorithm will enter the mathematics.  The function returns the weights matrix, eigenvectors and eigenvalues.  These are all necessary to display data in a new space.  In our case, we work with 4-dimensional space, by the number of elements in the training sample, the remaining 10304 - 4 = 10300 dimensions are degenerate, we do not take them into account. <br><br>  We, on the whole, do not need eigenvalues, but we can trace some useful information from them.  Let's take a look at them: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/168/613/cd9/168613cd94f154fa2f7ad3ebd02ac73a.png"><br><br>  The eigenvalues ‚Äã‚Äãactually show the dispersion along each of the axes of the principal components (each component corresponds to one dimension in space).  Look at the right expression, the sum of this vector = 1, and each element shows the contribution to the total variance of the data.  We see that 1 and 3 main components give a total of 0.82.  Those.  1 and 3 dimensions contain 82% of all information.  The second dimension is collapsed, and the fourth carries 18% of the information and we do not need it. <br><br><h2>  Recognition </h2><br><br>  The model is made up.  We will test. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f15/31d/52b/f1531d52b3c20c1e3cab7c033e18b889.png"><br><br>  We are creating a new sample of 24 items.  The first 4 elements of the element are the same as in the training sample.  The rest are different versions of the images from the training sample: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/88e/6a0/01a/88e6a001a8f942488aaddb1234f4231a.png"><br><br>  Next, load the data and transfer it to the Recognize procedure.  In it, each image is averaged, displayed in the space of the main components, weights w are.  After the vector w is known, it is necessary to determine which of the existing objects it is closest to.  For this, the dist function is used (instead of the classical Euclidean distance in pattern recognition problems, it is better to use another metric: <a href="http://en.wikipedia.org/wiki/Mahalanobis_distance">Mahalanobis distance</a> ).  The minimum distance and the index of the object to which this image is located closest. <br><br>  On a sample of 24 objects shown above, the efficiency of the classifier is 100%.  But there is one nuance.  If we submit an image to the input that is not in the original database, then the vector w will still be calculated and the minimum distance will be found.  Therefore, the criterion O is introduced, if the minimum distance &lt;O means the image belongs to the class of recognizable, if the minimum distance is&gt; O, then there is no such image in the database.  The value of this criterion is chosen empirically.  For this model, I chose O = 2.2. <br><br>  Let's make a sample of people who are not in the training and see how effectively the classifier will eliminate false samples. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ff3/5d8/423/ff35d842312b3b72f8b91c3483a004c4.png"><br><br>  Of the 24 samples, we have 4 false positives.  Those.  efficiency was 83%. <br><br><h2>  Conclusion </h2><br><br>  In general, a simple and original algorithm.  Once again, he proves that in spaces of higher dimension there is a ‚Äúhidden‚Äù set of useful information that can be used in various ways.  ÔÅä Coupled with other advanced techniques, eigenface can be used to improve the efficiency of solving tasks. <br><br>  For example, we use a simple distance classifier as a classifier.  However, we could apply a more advanced classification algorithm, for example, the <a href="http://en.wikipedia.org/wiki/Support_vector_machine">Support Vector Machine</a> or the neural network. <br><br>  The next article focuses on the Support Vector Machine.  A relatively new and very interesting algorithm, in many problems it can be used as an alternative to NA. <br><br>  When writing the article materials were used: <br>  <a href="http://onionesquereality.wordpress.com/">onionesquereality.wordpress.com</a> <br>  <a href="http://www.cognotics.com/">www.cognotics.com</a> <br><br>  Materials: <br>  <a href="http://multi-up.com/138047">Calculation sheet for MathCAD 14</a> <br><br>  <b>UPD:</b> <br>  I see many incomprehensible and frightened mathematics.  There are two ways. <br>  1. If you want to understand the whole point of all the actions of the algorithm, then you should start by understanding the basic things: Cove.  matrices, the method of principal components, the meaning and meaning of eigenvectors and values.  If you know what it is, then everything becomes clear. <br>  2. If you want to simply implement and use the algorithm, then take the list of calculations for MathCAD'a.  Run, look, change the parameters.  There are calculations on the floor of the screen and there is nothing more difficult in them than multiplying matrices (well, except for the built-in functions for calculating eigenvectors, but it is not necessary to delve into this).  This is to help with the implementation in <a href="http://code.google.com/p/pyfaces/">python</a> , <a href="http://www.cs.ait.ac.th/~mdailey/matlab/">matlab</a> , <a href="">C ++</a> . <br><br></div><p>Source: <a href="https://habr.com/ru/post/68870/">https://habr.com/ru/post/68870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../68856/index.html">Build Ruby, RubyGems and Ruby on Rails in the new Snow Leopard</a></li>
<li><a href="../68857/index.html">Steering Wheel for iPhone and iPod Touch</a></li>
<li><a href="../68860/index.html">Snow Leopard: About Licenses and Pricing</a></li>
<li><a href="../68861/index.html">We wanted the best, but it turned out as always</a></li>
<li><a href="../68867/index.html">We program for Windows 7. The progress indicator on the taskbar</a></li>
<li><a href="../68871/index.html">Do we really need a photo-realistic picture in games?</a></li>
<li><a href="../68877/index.html">ATL - UserJS script for habrakhabra</a></li>
<li><a href="../68879/index.html">Android Market Update</a></li>
<li><a href="../68880/index.html">Kings and cabbage, but rather music and mobile phones</a></li>
<li><a href="../68883/index.html">Easy way to get familiar with Ubuntu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>