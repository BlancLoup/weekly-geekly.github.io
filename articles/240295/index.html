<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Triggers, access rights and versioning at the SPARQL access point</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anyone who tries to use the SPARQL access point as a replacement for a database in an industrial project will have to face several troubles. One of th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Triggers, access rights and versioning at the SPARQL access point</h1><div class="post__text post__text-html js-mediator-article">  Anyone who tries to use the SPARQL access point as a replacement for a database in an industrial project will have to face several troubles.  One of them is the lack of access control, triggers, and versioning capabilities in the arsenal of such a product.  Having studied everything that is offered on the market today, we came to the need to implement such functionality on our own. <br>  Apache Fuseki is the ‚Äúguinea pig‚Äù, although the same principle can be applied to any other SPARQL endpoint. <br><a name="habracut"></a><br><h5>  Architecture and functionality </h5><br>  The only way to implement the conceived, if not to go inside the product itself, is to create a proxy layer above the software interface of the access point.  This we have done.  All SPARQL queries addressed to the service go through a proxy, where they are analyzed and further processed. <br>  When accessing a proxy, the application can authenticate under a specific user account - for this, the standard program interface had to be slightly expanded - and it can be contacted anonymously, while remaining within the standard. <br>  The proxy has its own back-end, which provides the ability to configure user access rights (user groups) to the ontology classes.  Rights are inherited.  The access level can be set to the following values: <br><br><ul><li>  no access rights; </li><li>  reading; </li><li>  moderation change; </li><li>  change. </li></ul><br>  It is clear that each ontology object can be simultaneously an instance of any number of classes (including with regard to inheritance).  Of all the options applicable to parent classes, the rights are chosen the most stringent. <br>  The ability to edit class definitions and properties is regulated by granting access rights to standard types, such as owl: Class. <br><br>  In our case, it was important to ensure the possibility of collective work on the ontology.  The ‚Äúchange with moderation‚Äù rights level allows the user to execute DELETE / INSERT requests, but their result is not applied immediately to the database, but is submitted for approval by users who have appropriate rights.  Once a day, the back-end informs such users about the changes received, and they have the opportunity to apply them, or reject them. <br>  All changes made by users to the ontology are stored in the log, which lies in the back-end service database (relational; the access rights settings are stored in it).  As a result, it is possible to build a history of changes for all properties of each ontology object, with the date and author of each change. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Returning to the rights of access: any request received on a proxy, passes the verification of rights, either before execution or after it.  If the query is aimed at sampling data (SELECT, ASK, CONSTRUCT), then solutions containing those objects to which the current user does not have access rights are excluded from the set of its results (if the query was anonymous, only solutions that consist entirely of instances of classes on which there are no restrictions of rights).  If the request has the DELETE / INSERT / UPLOAD type, then the set of triplets that it will affect is determined first, and if at least one of them has no editing access rights, the entire request is canceled.  Of course, the front-end'y, which work with our proxy, had to "teach" to interpret error messages, as well as warnings that the changes went to moderation. <br>  Paired DELETE / INSERT requests are detected, and if the INSERT request is canceled (what if?), The DELETE pair is also canceled.  In general, when writing a proxy, I had to use some interesting workarounds;  for example, the response to a SELECT query may not include objects that are not accessible, but they will be involved in the calculation of the solution.  Such a situation will arise, for example, when executing a query <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ?prop <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> { ?<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> &lt;has_property_1&gt; <span class="hljs-string"><span class="hljs-string">"some value"</span></span>. ?<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> &lt;has_property_2&gt; ?prop }</code> </pre> <br><br>  in case the user does not have access rights to a part of objects? object.  Our proxy expands such requests, and returns the properties? Prop only available objects.  Similar processing had to be applied to queries that return a COUNT (*) value. <br><br>  After all of the above, it was quite easy to implement the functionality of the triggers.  A trigger is a procedure that is executed after a data change request, in case it affects instances of certain classes.  In our project, triggers are used to notify external systems of changes ‚Äî messages are sent to the bus;  however, the same mechanism can be used for, for example, cascading changes in the database itself. <br><br><h5>  Results and performance </h5><br><br>  In terms of functionality, we have achieved all the intended results.  The system provides control of access rights regardless of which application sends a request to the access point, and also sends notifications about changes in data.  The change log allows you to restore the state of any object to an arbitrary point in time.  The ‚Äúedit with confirmation‚Äù functionality provides full moderation of changes in ontology. <br>  It remains to find out how much additional processing will affect the speed of query execution.  First of all, we were interested in the fact that the speed of SELECT queries was not affected, since our product functions as a catalog of master data for several other information systems. <br>  After analyzing the incoming SELECT queries, as well as those queries to the real SPARQL access point that the proxy itself performs, we found out that more than half of them are simple expressions like ‚ÄúA is a subclass of B‚Äù, and ‚ÄúA is a member of class B ".  Of course, such requests are easy to cache, and update the cache when the content of the real database changes with the help of our trigger mechanism.  As a result, the proxy responds to requests of this kind (as well as some more complex ones) without accessing the real access point, and also makes extensive use of the cache in access rights calculation algorithms.  The result exceeded our expectations: under real load, the system works only 13% slower than with a direct access to a real endpoint without rights control. <br><br>  With requests for changing data, the situation is not so optimistic: their execution has become 6 times slower, since the processing on DELETE / INSERT (and, moreover, UPLOAD) is much more complicated and cannot be optimized.  Well, I had to accept this on the working system, losing some of the performance in exchange for functionality. </div><p>Source: <a href="https://habr.com/ru/post/240295/">https://habr.com/ru/post/240295/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../240283/index.html">Initial setup of Raspberry Pi without monitor</a></li>
<li><a href="../240285/index.html">Developing an AS3 game (Part 1: introduction, utilities)</a></li>
<li><a href="../240287/index.html">Its 2-stroke engine. CR620</a></li>
<li><a href="../240291/index.html">Brutforsim EFI with Arduino</a></li>
<li><a href="../240293/index.html">Project Dronecode: free platform for unmanned vehicles</a></li>
<li><a href="../240297/index.html">Flexible project and product management</a></li>
<li><a href="../240299/index.html">Hi, table!</a></li>
<li><a href="../240301/index.html">New timezone - new problems</a></li>
<li><a href="../240303/index.html">Added Android x64 support to the Android emulator.</a></li>
<li><a href="../240305/index.html">A set of network equipment developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>