<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Access to SOAP web services 1C from JavaScript and Html</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The described method allows you to access 1C web services from an html page via JavaScript. As an example, a list of directories. Clicking on any dire...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Access to SOAP web services 1C from JavaScript and Html</h1><div class="post__text post__text-html js-mediator-article"> The described method allows you to access 1C web services from an html page via JavaScript.  As an example, a list of directories.  Clicking on any directory displays the first letters of the items.  Clicking on a letter displays data with names beginning with this letter. <br><br>  The method is applicable for cases when the web service and html-page are published on the same server.  In this case, there are no cross-domain problems.  For example, if the domains are different, then Chrome will give the error: <br><br> <code><a href="http://localhost/"></a> Failed to load resource: Origin localhost:3299 is not allowed by Access-Control-Allow-Origin</code> <br> <br>  Without going into details of publishing web services, suppose that, on the side of 1C, the web service catalogs has been created and published with the operation Execute.  At the input is the script parameter of the string type, and the output is the string type.  The operation launches on the side any script code from the parameter and returns JSON serialization from the result variable. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="1c hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExecuteCommands</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">script</span></span></span></span>) result = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Execute(script); return JSON(result); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span></span></code> </pre><br><br>  It is convenient to work with JavaScript tools with JSON serialization and convert a string to an object / array with one eval command (resultText).  On the Internet you can find several JSON serializers for 1C. <br><br>  Make sure the web service responds by typing its address: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/29d/752/0ed/29d7520ede3c7a583a909f1719d0a823.jpg" alt="Web service response"><br><a name="habracut"></a><br><br>  It is better to start the project of the HTML file with a ready-made template, where styles are written for all browsers.  A very decent template is located at <a href="http://html5boilerplate.com/">html5boilerplate.com</a> The template includes jQuery 1.9.1. <br><br>  On the form above, we place the web server configuration elements: wsUrl is the web service address, wsUser is the login, wsPassword is the password.  On the side of the web service 1C enabled the backgrounddrirization.  Login and password correspond to the user registered in 1C. <br><br>  The left panel is responsible for displaying the available catalogsList directories, the right panel is responsible for displaying letters (letters) and data (catalogRecords). <br><br><h2>  Javascript </h2><br><br>  The function to access the SOAP web service is defined as follows: <br><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">executeSoap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">script, successHandler</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wsUrl = $(<span class="hljs-string"><span class="hljs-string">"#wsUrl"</span></span>).val(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> soapRequest = <span class="hljs-string"><span class="hljs-string">'&lt;?xml version="1.0" encoding="utf-8"?&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;soapenv:Envelope '</span></span> + <span class="hljs-string"><span class="hljs-string">'xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" '</span></span> + <span class="hljs-string"><span class="hljs-string">'xmlns:api="http://www.1cbit.ru/dominicana/soap-html-js" '</span></span> + <span class="hljs-string"><span class="hljs-string">'xmlns:xsd="http://www.w3.org/2001/XMLSchema" '</span></span> + <span class="hljs-string"><span class="hljs-string">'xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;soapenv:Body&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;api:Execute soapenv:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'script xsi:type="xsd:string"&gt;'</span></span> + script + <span class="hljs-string"><span class="hljs-string">'&lt;/'</span></span> + <span class="hljs-string"><span class="hljs-string">'script&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;/api:Execute&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;/soapenv:Body&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;/soapenv:Envelope&gt;'</span></span>; $.ajax({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: wsUrl, <span class="hljs-attr"><span class="hljs-attr">contentType</span></span>: <span class="hljs-string"><span class="hljs-string">"text/xml"</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">"xml"</span></span>, <span class="hljs-attr"><span class="hljs-attr">username</span></span>: $(<span class="hljs-string"><span class="hljs-string">"#wsUser"</span></span>).val(), <span class="hljs-attr"><span class="hljs-attr">password</span></span>: $(<span class="hljs-string"><span class="hljs-string">"#wsPassword"</span></span>).val(), <span class="hljs-attr"><span class="hljs-attr">data</span></span>: soapRequest, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: successHandler, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: processError }); }</code> </pre><br><br>  At the entrance to the executeSoap, a 1C script is supplied, which is executed on the 1C side, and a handler for successful execution.  In case of an error, a processError handler will be called, which will display an error message. <br><br>  Code 1C is written in html-code via script-tag.  You can get the text of each piece of code for execution via jQuery $ ("# enumerate1CCatalogs"). Text (). <br><br>  Getting a list of directory names. <br><br><pre> <code class="1c hljs"> &lt;script id=<span class="hljs-string"><span class="hljs-string">"enumerate1CCatalogs"</span></span> type=<span class="hljs-string"><span class="hljs-string">"text/1c"</span></span>&gt; result = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type"></span></span>(); <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-built_in"><span class="hljs-built_in"></span></span>.<span class="hljs-built_in"><span class="hljs-built_in"></span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type"></span></span> = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type"></span></span>(<span class="hljs-string"><span class="hljs-string">"name, synonym"</span></span>); <span class="hljs-type"><span class="hljs-type"></span></span>.name = .; <span class="hljs-type"><span class="hljs-type"></span></span>.synonym = .; result.(<span class="hljs-type"><span class="hljs-type"></span></span>); <span class="hljs-keyword"><span class="hljs-keyword"></span></span>; &lt;/script&gt;</code> </pre><br><br>  Getting the first letters of directory names {catalog} <br><br><pre> <code class="1c hljs"> &lt;script id=<span class="hljs-string"><span class="hljs-string">"getFirstLetters"</span></span> type=<span class="hljs-string"><span class="hljs-string">"text/1c"</span></span>&gt; <span class="hljs-type"><span class="hljs-type"></span></span> = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type"></span></span>(); <span class="hljs-type"><span class="hljs-type"></span></span>. = <span class="hljs-string"><span class="hljs-string">"  (, 0, 1)  letter  .{catalog}   (, 0, 1)"</span></span>; result = <span class="hljs-type"><span class="hljs-type"></span></span>.<span class="hljs-keyword"><span class="hljs-keyword"></span></span>().(); &lt;/script&gt;</code> </pre><br><br>  Getting data for the catalog {catalog}, where the first letter is in the condition {condition}. <br><br><pre> <code class="1c hljs"> &lt;script id=<span class="hljs-string"><span class="hljs-string">"getCatalogData"</span></span> type=<span class="hljs-string"><span class="hljs-string">"text/1c"</span></span>&gt; <span class="hljs-type"><span class="hljs-type"></span></span> = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type"></span></span>(); <span class="hljs-type"><span class="hljs-type"></span></span>. = <span class="hljs-string"><span class="hljs-string">"  as ref,  as name  .{catalog}  (, 0, 1)  ({condition})"</span></span>; result = <span class="hljs-type"><span class="hljs-type"></span></span>.<span class="hljs-keyword"><span class="hljs-keyword"></span></span>().(); &lt;/script&gt;</code> </pre><br><br>  Clicking on the Refresh button calls the function. <br><br> <code>executeSoap($("#enumerate1CCatalogs").text(), processSuccess);</code> <br> <br>  and if successful, the processSuccess handler is called <br><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processSuccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data, status, req</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resultText = $(req.responseText).find(<span class="hljs-string"><span class="hljs-string">"m\\:return"</span></span>).html(); result = <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(resultText); $(<span class="hljs-string"><span class="hljs-string">"#catalogRecords"</span></span>).empty(); catalogsList = $(<span class="hljs-string"><span class="hljs-string">"#catalogsList"</span></span>); catalogsList.empty(); $(result).each(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index, item</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> li = <span class="hljs-string"><span class="hljs-string">'&lt;li catalog="'</span></span> + item.name + <span class="hljs-string"><span class="hljs-string">'"&gt;'</span></span> + item.synonym + <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>; catalogsList.append( $(li).addClass(<span class="hljs-string"><span class="hljs-string">"catalogTitle"</span></span>) ); }); }</code> </pre><br><br>  The web service returns xml, where the contents of the m: return tag - JSON serialization are significant.  You can translate it into JavaScript objects via an eval call.  The handler clears the list of directories and re-forms it through li-tags with the catalog attribute.  Each element is assigned a class catalogTitle. <br><br>  The web service returns xml, where the contents of the m: return tag - JSON serialization are significant.  You can translate it into JavaScript objects via an eval call.  The handler clears the list of directories and re-forms it through li-tags with the catalog attribute.  Each element is assigned a class catalogTitle. <br><br>  Similarly handles all controls are handled.  Clicking on the directory clears the letters and data, refills the letters.  Pressing the letter refills the data from the directory.  For processing the code on 1C, pieces of code in script blocks with the type ‚Äútext / 1c‚Äù are responsible. <br>  The application looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/475/172/7ce/4751727cedd086f78c6c7c6844cd3e19.jpg" alt="Appearance example"><br><br><h2>  Unsolved authorization issue on IE browser </h2><br><br>  There is an authorization problem on IE.  On IE 8/9, the problem of basic authorization could not be solved by a method similar for other browsers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a83/c19/654/a83c1965407c8862dcca4e78197418d3.jpg" alt="Error accessing via Internet Explorer"><br>  On IE, Ajax does not work using the user / password properties of $ .ajax.  On FF and Chrome everything is working fine.  For some reason, the header is not transmitted to the server in the case of IE <br><br> <code>Authorization: Basic 0JHQsNGF0YjQuNC10LLQn9CYICjRgNGD0LrQvtCy0L7QtNC40YLQtdC70YwpOg==</code> <br>  <strong>If someone knows the reason and how to get around, please write in the comments.</strong> <br><br><h2>  findings </h2><br><br>  The proposed SOAP-based approach has the right to exist for simple tasks, as it is accompanied by a sufficiently large number of JavaScript code.  Perhaps in the future it will be possible to create a JavaScript framework to simplify the process of creating applications. <br><br>  The developers in this way are independently responsible for security.  It is necessary to check the input parameters when writing, not to allow the launch of arbitrary scripts transmitted from the client.  The article shows the execution of arbitrary code for example only.  You can unify arbitrary query execution, but this is due to the danger of SQL injections. <br><br>  External components of the Native API from 1C will not work in this environment.  This means that you need to further solve the problem with writing drivers for hardware. <br><br>  Example website: <a href="">web-site.zip (81,76 kb)</a> </div><p>Source: <a href="https://habr.com/ru/post/184756/">https://habr.com/ru/post/184756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184746/index.html">Runetology (202): Denis Imshenetsky, founder of Nethouse.ru</a></li>
<li><a href="../184748/index.html">(Video) Booth Demos: VMware vCenter Operations Manager and VMware Horizon Suite</a></li>
<li><a href="../184750/index.html">[ANNOUNCEMENT] External battery case [CC-XPERIAZ] 3000mAh for Sony Xperia Z</a></li>
<li><a href="../184752/index.html">Web studio development trajectory: agency, production, conveyor, product</a></li>
<li><a href="../184754/index.html">Old-Hard communication, or ‚Äúfile transfer via COM and LPT ports‚Äù</a></li>
<li><a href="../184758/index.html">Service - how much sense in this word ... but is there such a word?</a></li>
<li><a href="../184762/index.html">Taist: sharpen the "clouds" by yourself</a></li>
<li><a href="../184766/index.html">The evolution of racing cars on javascript</a></li>
<li><a href="../184770/index.html">Where is my post office? - search post office DoubleGis index</a></li>
<li><a href="../184772/index.html">USB flash drive Leef Bridge with micro USB connectors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>