<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sync vs Async on the example of Firebird</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this publication I set myself several goals: 



- Compare different styles of programming work with Firebird databases in NodeJS; 
- Find the most...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sync vs Async on the example of Firebird</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/92c2afed/fbe9ac70/bdf984b2/2c191ebb.png" alt="image"><br><br>  In this publication I set myself several goals: <br><br><ul><li>  Compare different styles of programming work with Firebird databases in NodeJS; </li><li>  Find the most productive option; </li><li>  Get as a result a guide to action for those who start using Firebird in NodeJS. </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Further a lot of code ... <br><a name="habracut"></a><br><br>  The test task looks very simple: <br>  return query result <br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rdb$relations</code> </pre> <br>  in json format.  On my test base, this will be a response of about 19 kb in size. <br><br>  Let's write various options for the implementation of this task and, using Apache Benchmark, we will find the best option.  Test performance will be the following command: <br><pre>  <i>ab -n 10000 -c 5 http: // localhost: 1337 /</i> </pre><br><br>  I will not give the entire conclusion of the benchmark, so as not to overload the article.  An indicator of the average number of processed requests per second (RPS) will be enough to draw conclusions in most cases. <br><br>  So, let's start with the simplest option, when all calls to the access library are synchronous: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cfg = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"../config"</span></span>).cfg; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fb = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../firebird'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> util = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'util'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>); http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ res.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, {<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> con = fb.createConnection(); con.connectSync(cfg.db, cfg.user, cfg.password, cfg.role); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rs = con.querySync(<span class="hljs-string"><span class="hljs-string">'select * from rdb$relations'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rows = rs.fetchSync(<span class="hljs-string"><span class="hljs-string">"all"</span></span>,<span class="hljs-literal"><span class="hljs-literal">true</span></span>); con.disconnect(); res.write(<span class="hljs-string"><span class="hljs-string">'['</span></span>); rows.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span>{ res.write(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(r)+<span class="hljs-string"><span class="hljs-string">','</span></span>); }); res.end(<span class="hljs-string"><span class="hljs-string">']'</span></span>); }).listen(<span class="hljs-number"><span class="hljs-number">1337</span></span>, <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Server running at http://127.0.0.1:1337/'</span></span>);</code> </pre><br><br>  <b>Total transferred: 199310000 bytes</b> <b><br></b>  <b>HTML transferred: 198670000 bytes</b> <b><br></b>  <b>Requests per second: 52.47 [# / sec] (mean)</b> <br><br>  I left the number of bytes transferred to ensure that all variants of the scripts generate the same result. <br>  The Firebird library allows you to replace all calls with asynchronous ones.  Here is what it will look like: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cfg = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"../config"</span></span>).cfg; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fb = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../firebird'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> util = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'util'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>); http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ res.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, {<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> con = fb.createConnection(); con.connect(cfg.db, cfg.user, cfg.password, cfg.role,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ con.query(<span class="hljs-string"><span class="hljs-string">'select * from rdb$relations'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err,rs</span></span></span><span class="hljs-function">)</span></span>{ res.write(<span class="hljs-string"><span class="hljs-string">'['</span></span>); rs.fetch(<span class="hljs-string"><span class="hljs-string">"all"</span></span>,<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span>{ res.write(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(r)+<span class="hljs-string"><span class="hljs-string">','</span></span>); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">)</span></span>{ con.disconnect(); res.end(<span class="hljs-string"><span class="hljs-string">']'</span></span>); }); }); }); }).listen(<span class="hljs-number"><span class="hljs-number">1337</span></span>, <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Server running at http://127.0.0.1:1337/'</span></span>);</code> </pre><br><br>  <b>Total transferred: 199310000 bytes</b> <b><br></b>  <b>HTML transferred: 198670000 bytes</b> <b><br></b>  <b>Requests per second: 129.26 [# / sec] (mean)</b> <br><br>  Simple replacement of synchronous calls to asynchronous gave a performance boost up to <br>  129 requests per second versus 52. The asynchronous approach allows you to execute requests in parallel by establishing separate connections for each client.  In addition, in the synchronous version, the entire result of the request is first written to the memory, and then given to the client.  In the asynchronous, the result lines are given to the client as they are sampled from the database on the fly. <br><br>  However, in this code there are still non-optimal moments that can be optimized.  For example, this is what each client connection creates a new database connection.  As an extreme case, we try to do a single connection.  First for the synchronous version: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cfg = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"../config"</span></span>).cfg; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fb = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../firebird'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> util = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'util'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> con = fb.createConnection(); con.connectSync(cfg.db, cfg.user, cfg.password, cfg.role); http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ res.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, {<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!con.inTransaction) con.startTransactionSync(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rs = con.querySync(<span class="hljs-string"><span class="hljs-string">'select * from rdb$relations'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rows = rs.fetchSync(<span class="hljs-string"><span class="hljs-string">"all"</span></span>,<span class="hljs-literal"><span class="hljs-literal">true</span></span>); res.write(<span class="hljs-string"><span class="hljs-string">'['</span></span>); rows.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span>{ res.write(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(r)+<span class="hljs-string"><span class="hljs-string">','</span></span>); }); res.end(<span class="hljs-string"><span class="hljs-string">']'</span></span>); con.commitSync(); }).listen(<span class="hljs-number"><span class="hljs-number">1337</span></span>, <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Server running at http://127.0.0.1:1337/'</span></span>);</code> </pre><br><br>  <b>Total transferred: 199310000 bytes</b> <b><br></b>  <b>HTML transferred: 198670000 bytes</b> <b><br></b>  <b>Requests per second: 159.55 [# / sec] (mean)</b> <br><br>  As you can see, this option is faster than the previous asynchronous.  Establishing a connection to the database is a rather time consuming operation.  Connection reuse is a well-known and long-used technique.  It is worth taking on board. <br><br>  Now we will try to add asynchrony.  The following code is obviously not optimal - the use of a single connection and asynchrony will not allow us to execute requests in parallel.  However, for the purity of the experiment ... <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cfg = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"../config"</span></span>).cfg; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fb = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../firebird'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> util = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'util'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> con = fb.createConnection(); con.connectSync(cfg.db, cfg.user, cfg.password, cfg.role), busy = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, next = []; http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ res.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, {<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>}); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doReq</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ con.query(<span class="hljs-string"><span class="hljs-string">'select * from rdb$relations'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err,rs</span></span></span><span class="hljs-function">)</span></span>{ res.write(<span class="hljs-string"><span class="hljs-string">'['</span></span>); rs.fetch(<span class="hljs-string"><span class="hljs-string">"all"</span></span>,<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span>{ res.write(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(r)+<span class="hljs-string"><span class="hljs-string">','</span></span>); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">)</span></span>{ res.end(<span class="hljs-string"><span class="hljs-string">']'</span></span>); con.commit(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ busy = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = next.pop(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(n) n(); }); }); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ busy = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!con.inTransaction) con.startTransaction(doReq); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> doReq(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(busy) next.push(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ process(); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> process(); }).listen(<span class="hljs-number"><span class="hljs-number">1337</span></span>, <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Server running at http://127.0.0.1:1337/'</span></span>);</code> </pre><br><br>  <b>Total transferred: 199310000 bytes</b> <b><br></b>  <b>HTML transferred: 198670000 bytes</b> <b><br></b>  <b>Requests per second: 129.85 [# / sec] (mean)</b> <br><br>  The asynchronous version looks rather cumbersome.  And gives a total of 129 requests per second.  The problem is that the use of a single connection does not give a win for asynchronous sampling, because the Firebird client library does not support asynchronous calls by design.  The Firebird module for NodeJS starts all asynchronous calls in parallel threads using the built-in libuv pool.  You cannot use a single connection to perform parallel queries.  Therefore, the code contains checks for busy connections and organizes a queue of calls.  Apparently, the organization of the queue was in this case a retarding factor.  After all, the synchronous version was faster.  But using a separate database connection for each client is also not always optimal.  The logical solution would be to use a pool of connections. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cfg = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"../config"</span></span>).cfg; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fb = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../firebird'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> util = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'util'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'events'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConnectionPool</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ events.EventEmitter.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.conns = []; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.busy = []; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.MaxConns = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.newConn = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = fb.createConnection(); c.connectSync(cfg.db, cfg.user, cfg.password, cfg.role); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.conns.push(c); }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.get = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cb</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.conns.pop(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(c) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.busy.push(c); cb(c); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.busy.length) &gt;= <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.MaxConns){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.once(<span class="hljs-string"><span class="hljs-string">'release'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ self.get(cb); }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.newConn(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.get(cb); } }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.release = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">con</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.busy.length;i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.busy[i] == con){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.conns.push(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.busy[i]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.busy.splice(i,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; process.nextTick(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ self.emit(<span class="hljs-string"><span class="hljs-string">'release'</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } }; } util.inherits(ConnectionPool, events.EventEmitter); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pool = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConnectionPool(); pool.setMaxListeners(<span class="hljs-number"><span class="hljs-number">2000</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exec</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">con,res</span></span></span><span class="hljs-function">)</span></span>{ con.query(<span class="hljs-string"><span class="hljs-string">'select * from rdb$relations'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err,rs</span></span></span><span class="hljs-function">)</span></span>{ res.write(<span class="hljs-string"><span class="hljs-string">'['</span></span>); rs.fetch(<span class="hljs-string"><span class="hljs-string">"all"</span></span>,<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span>{ res.write(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(r)+<span class="hljs-string"><span class="hljs-string">','</span></span>); },<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">)</span></span>{ res.end(<span class="hljs-string"><span class="hljs-string">']'</span></span>); con.commit(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ pool.release(con); }); }); }); }; http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ res.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, {<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>}); pool.get(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">con</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!con.inTransaction) con.startTransaction(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!err) exec(con,res); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> exec(con,res); }); }).listen(<span class="hljs-number"><span class="hljs-number">1337</span></span>, <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Server running at http://127.0.0.1:1337/'</span></span>);</code> </pre><br><br>  <b>Total transferred: 199310000 bytes</b> <b><br></b>  <b>HTML transferred: 198670000 bytes</b> <b><br></b>  <b>Requests per second: 187.82 [# / sec] (mean)</b> <br><br>  There was a lot of code, but the performance gain is obvious.  Moreover, the connection pooling code can be put into a separate module for reuse, and the database operation code will remain simple and compact. <br><br>  But you can go further.  When multiple clients use the same request, Firebird allows you to prepare resources for a request and use it many times without having to repeat the resource allocation and parsing of the request.  So, the use of a pool of prepared queries seems to be more optimal: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cfg = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"../config"</span></span>).cfg; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fb = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../firebird'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> util = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'util'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'events'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StatementPool</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ events.EventEmitter.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.conns = []; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.busy = []; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.MaxConns = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.newConn = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c ={ <span class="hljs-attr"><span class="hljs-attr">conn</span></span>: fb.createConnection() }; c.conn.connectSync(cfg.db, cfg.user, cfg.password, cfg.role); c.stmt = c.conn.prepareSync(<span class="hljs-string"><span class="hljs-string">'select * from rdb$relations'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.conns.push(c); }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.get = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cb</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.conns.pop(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(c) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.busy.push(c); cb(c); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.busy.length) &gt;=<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.MaxConns){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.once(<span class="hljs-string"><span class="hljs-string">'release'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ self.get(cb); }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.newConn(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.get(cb); } }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.release = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">con</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.busy.length;i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.busy[i] == con){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.conns.push(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.busy[i]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.busy.splice(i,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; process.nextTick(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ self.emit(<span class="hljs-string"><span class="hljs-string">'release'</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } }; } util.inherits(StatementPool, events.EventEmitter); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pool = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatementPool(); pool.setMaxListeners(<span class="hljs-number"><span class="hljs-number">2000</span></span>); http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ res.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, {<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>}); pool.get(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">con</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> exec = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ con.stmt.exec(); con.stmt.once(<span class="hljs-string"><span class="hljs-string">'result'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">)</span></span>{ res.write(<span class="hljs-string"><span class="hljs-string">'['</span></span>); con.stmt.fetch(<span class="hljs-string"><span class="hljs-string">"all"</span></span>,<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span>{ res.write(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(r)+<span class="hljs-string"><span class="hljs-string">','</span></span>); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">)</span></span>{ res.end(<span class="hljs-string"><span class="hljs-string">']'</span></span>); con.conn.commit(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ pool.release(con); }); }); }); }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!con.conn.inTransaction) con.conn.startTransaction(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!err) exec(); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> exec(); }); }).listen(<span class="hljs-number"><span class="hljs-number">1337</span></span>, <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Server running at http://127.0.0.1:1337/'</span></span>);</code> </pre><br><br>  <b>Total transferred: 199310000 bytes</b> <b><br></b>  <b>HTML transferred: 198670000 bytes</b> <b><br></b>  <b>Requests per second: 214.37 [# / sec] (mean)</b> <br><br>  Despite the large amount of code, this option gives more than 210 requests per second. <br><br>  Using multiple connections simultaneously, prepared requests and asynchronous calls gives a gain of at least 4 times compared with the fully synchronous option.  However, this figure is true only for my test environment.  It should also be understood that the asynchrony itself in NodeJS does not allow to increase the performance of the database server, it only helps to load it in full.  In this case, the database server was allocated 256MB of memory and 1 processor core - this is how I explain the overall small RPS performance.  However, the memory load did not exceed 3%.  Also, the asynchronous approach allows parallel processing of other requests not related to database requests.  There were no such requests in these tests.  The most influential factor in the number of RPS was the sample size of the request.  So, while limiting the sample to 10 entries (about 1kb in the resulting JSON) and allocating 4 processor cores to the database server, we managed to get about 1000 RPS, but the synchronous version in this case produced about 200 RPS.  It is worth considering that the asynchronous version, fulfilling 1000 queries to the database per second, is able to simultaneously draw HTML from them using templates, while there is no synchronous one. <br>  All test scripts are part of the <a href="http://habrahabr.ru/post/133633/">Firebird</a> access module <a href="http://habrahabr.ru/post/133633/">for NodeJS</a> <br>  And available on <a href="https://github.com/xdenser/node-firebird-libfbclient/tree/master/tests/perf">github</a> . </div><p>Source: <a href="https://habr.com/ru/post/139708/">https://habr.com/ru/post/139708/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139703/index.html">Google may launch a tablet with ASUS</a></li>
<li><a href="../139704/index.html">Comparative test of programs that prevent attacks on ARP-table</a></li>
<li><a href="../139705/index.html">X server for Android</a></li>
<li><a href="../139706/index.html">Work with large Excel files</a></li>
<li><a href="../139707/index.html">Twitter has turned on SPDY support</a></li>
<li><a href="../139710/index.html">Google Thumbnail: Getting Thumbnails of Websites</a></li>
<li><a href="../139711/index.html">Right to be forgotten</a></li>
<li><a href="../139713/index.html">How to search for programmers in the regions? We found an effective way. Sharing ...</a></li>
<li><a href="../139717/index.html">Android SDK: struggling with image memory size limits</a></li>
<li><a href="../139718/index.html">Prosto in Google Web Fonts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>