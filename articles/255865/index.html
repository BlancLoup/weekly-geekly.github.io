<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mixins for ‚Äúclasses‚Äù in javascript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The same code in several places is a pain. Today I‚Äôll write a few words about repeating classes. People have come up with a solution a long time ago -...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mixins for ‚Äúclasses‚Äù in javascript</h1><div class="post__text post__text-html js-mediator-article">  The same code in several places is a pain.  Today I‚Äôll write a few words about repeating classes.  People have come up with a solution a long time ago - you can put the same methods and properties into a common base class, and if there is none, use impurities.  There are a million implementations of this pattern for JavaScript, I want to elaborate on the approach when the mixin falls into the inheritance chain. <br><br><h2>  Problem in pictures </h2><br>  Let's start with the visualization of our problem.  Suppose we have two base classes and two child classes inherit from them. <br><br><img src="https://habrastorage.org/files/ec0/5af/d32/ec05afd3229e49c39d67f94593796684.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At some point in the child classes there is a need for the same functionality.  Normal copy-paste will look like this on our scheme: <br><br><img src="https://habrastorage.org/files/42d/f8d/023/42df8d02325d4231a7e8ca8905acf501.png"><br><br>  It often happens that this functionality has nothing to do with the parent classes, therefore, it is illogical and wrong to bring it into some base class.  We put it in a separate place - mixin.  In terms of language, mixin can be a regular object. <br><br><img src="https://habrastorage.org/files/79c/cc7/90e/79ccc790e44e46e8b4bffd58d98ef95d.png"><br><br>  And now let's discuss the moment for which the entire article is written - how to mix our mixin in classes correctly. <br><a name="habracut"></a><br>  Based on my own experience, I can say that the most convenient way is to create a temporary class based on a mixin and substitute it into the inheritance queue. <br><br><img src="https://habrastorage.org/files/a9a/eb6/e01/a9aeb6e01f0e4376a5fac9c96d2641b0.png"><br><br><h3>  Advantages of this approach </h3><br><ul><li>  ease of implementation; </li><li>  ease of redefining the code contained in the mixin; </li><li>  flexibility of connecting mixins, the ability to create dependent mixins without much difficulty; </li><li>  using another pattern in the code does not complicate its understanding and support, because the existing inheritance mechanism is used; </li><li>  intervening speed ‚Äî a single cycle is not required to mix my mixin in this way; </li><li>  optimal memory usage - you copy nothing </li></ul><br><h2>  Write the code </h2><br>  <sup>All subsequent examples will use the specific implementation - the <a href="">Backbone.Mix</a> library.</sup>  <sup>By looking at the code, you will find that it is extremely simple, so you can easily adapt it to your favorite framework.</sup> <br><br>  Let's take a look at how to apply mixins that are embedded in the chain of inheritance in real life and experience the advantages of this approach in practice.  Imagine that you are writing a site)) and there are different things on your site that can be closed - pop-ups, hints, etc.  All of them have to listen to click on the element with the CSS class <code>close</code> and hide the element.  Mixin for this might look like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Closable = { <span class="hljs-attr"><span class="hljs-attr">events</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-string"><span class="hljs-string">'click .close'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onClickClose }; }, <span class="hljs-attr"><span class="hljs-attr">_onClickClose</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$el.hide(); } };</code> </pre><br><h3>  We intervene !!! </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Popup = Backbone.View.mix(Closable).extend({ <span class="hljs-comment"><span class="hljs-comment">// -   });</span></span></code> </pre><br>  Pretty simple, isn't it?  Now our inheritance chain looks like this: <br><br><img src="https://habrastorage.org/files/db1/88e/f72/db188ef72c224f79b3c69c11517b4e19.png"><br><br><ul><li>  first comes the base class <code>Backbone.View</code> </li><li>  an anonymous class is inherited from it, the prototype of which is the <code>Closable</code> </li><li>  completes our <code>Popup</code> chain </li></ul><br>  Such a scheme makes it very easy to redefine and pre-define methods from mixin in the class to which it is mixed.  For example, you can make <code>Popup</code> write something to the console when it is closed: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Popup = Backbone.View.mix(Closable).extend({ <span class="hljs-attr"><span class="hljs-attr">_onClickClose</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._super(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Popup closed'</span></span>); } });</code> </pre><br>  <sup>Here and below, the examples use the <a href="https://github.com/lukasolson/backbone-super">backbone-super</a> library.</sup> <br><br><h3>  Impurities that do not interfere .. </h3><br>  ... and help.  Sometimes the batch is not frail, and one mixin is indispensable.  For example, imagine that we are cool guys and write a log in IndexedDB, and we also have our own <code>Loggable</code> - <code>Loggable</code> :) <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Loggable = { <span class="hljs-attr"><span class="hljs-attr">_log</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   IndexedDB } };</span></span></code> </pre><br>  Then to the popup, we will interfere with two mixins: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Popup = Backbone.View.mix(Closable, Loggable).extend({ <span class="hljs-attr"><span class="hljs-attr">_onClickClose</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._super(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._log(<span class="hljs-string"><span class="hljs-string">'Popup closed'</span></span>); } });</code> </pre><br>  The syntax seems to be not complicated.  On the diagram, it will look like this: <br><br><img src="https://habrastorage.org/files/f99/0ba/020/f990ba0201cc4483b025af73140d2c99.png"><br><br>  As you can see, the chain of inheritance will line up depending on the order of connection of mixins. <br><br><h3>  Dependent mixins </h3><br>  Now imagine a situation that our analyst approaches us and says that he wants to collect statistics on all closures of pop-ups, hints - everything that can be closed.  Of course, we have long been Trackback <code>Trackable</code> for such cases, from the time we did the registration on the site. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Trackable = { <span class="hljs-attr"><span class="hljs-attr">_track</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    -    } };</span></span></code> </pre><br>  No wonder that we want to link <code>Trackable</code> and <code>Closable</code> , or rather, <code>Closable</code> should depend on <code>Trackable</code> .  In our diagram, it will look like this: <br><br><img src="https://habrastorage.org/files/4f7/7db/121/4f77db12128744119a40e299c11bd9da.png"><br><br>  And in the inheritance chain, the <code>Trackable</code> should be earlier than <code>Closable</code> : <br><br><img src="https://habrastorage.org/files/e78/de2/588/e78de2588992453e9047369bf399bfa2.png"><br><br>  The code for mixin with dependencies will be a bit more complicated: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Closable = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mixin({ <span class="hljs-attr"><span class="hljs-attr">dependencies</span></span>: [Trackable] }, { <span class="hljs-attr"><span class="hljs-attr">events</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-string"><span class="hljs-string">'click .close'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onClickClose }; }, <span class="hljs-attr"><span class="hljs-attr">_onClickClose</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$el.hide(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._track(<span class="hljs-string"><span class="hljs-string">'something closed'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// &lt;-   } });</span></span></code> </pre><br>  But it became not so much more difficult, just now we have a place where we can write dependencies.  For this we had to introduce an additional wrapper class - <code>Mixin</code> , and the <code>Mixin</code> itself is now not just an object, but an instance of this class.  It should be noted that the mixin connection itself does not change in this case: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Popup = Backbone.View.mix(Closable, Loggable).extend({ ‚Ä¶ });</code> </pre><br><h2>  Document mixins correctly </h2><br>  WebStorm has excellent mixin support.  It is enough just to write <a href="http://usejsdoc.org/">JSDoc</a> correctly, and the autocomplete hints, understanding by the environment of the general structure of the code will noticeably improve.  The medium understands the <code>@mixin</code> and <code>@mixes</code> .  Let's look at an example of the documented mixin <code>Closable</code> and class <code>Popup</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * @mixin Closable * @mixes Trackable * @extends Backbone.View */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Closable = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mixin({ <span class="hljs-attr"><span class="hljs-attr">dependencies</span></span>: [Trackable] }, <span class="hljs-comment"><span class="hljs-comment">/**@lends Closable*/</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * @returns {object.&lt;function(this: Closable, e: jQuery.Event)&gt;} */</span></span> events: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-string"><span class="hljs-string">'click .close'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onClickClose }; }, <span class="hljs-comment"><span class="hljs-comment">/** * @protected */</span></span> _onClickClose: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$el.hide(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._track(<span class="hljs-string"><span class="hljs-string">'something closed'</span></span>); } }); <span class="hljs-comment"><span class="hljs-comment">/** * @class Popup * @extends Backbone.View * @mixes Closable * @mixes Loggable */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Popup = Backbone.View.mix(Closable, Loggable).extend({ <span class="hljs-comment"><span class="hljs-comment">/** * @protected */</span></span> _onClickClose: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._super(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._log(<span class="hljs-string"><span class="hljs-string">'Popup closed'</span></span>); } });</code> </pre><br>  Very often, mixin is written for classes that have a specific ancestor.  Our <code>Closable</code> , written for classes inherited from <code>Backbone.View</code> is by no means an exception.  In such a situation, the environment will not understand where the calls of the given ancestor methods occur in the mixin code, unless it explicitly specifies <code>@extends</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * @mixin Closable * @mixes Trackable * @extends Backbone.View */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Closable = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mixin(...);</code> </pre><br>  On this, perhaps all, happy intervention! <br><br>  <a href="http://jifeon.blogspot.ru/2015/04/mixins-for-javascript-classes.html">English version in my blog</a> <br>  <a href="">Backbone.Mix</a> library <br>  More code from the same authors: <a href="https://github.com/backbonex">backbonex</a> <br>  <a href="http://habrahabr.ru/post/249373/">What to do with jQuery noodles to bring it to mind when you can think of mixins?</a>  <a href="http://jifeon.blogspot.ru/2015/02/how-to-refactor-spaghetti.html">In english</a> <a href="https://github.com/backbonex/backbone.view.elements">Immediately code</a> <br>  <a href="https://twitter.com/jifeon">My twitter</a> (only about the code) </div><p>Source: <a href="https://habr.com/ru/post/255865/">https://habr.com/ru/post/255865/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255851/index.html">SAP Forum: New Opportunities for Developers and Startups</a></li>
<li><a href="../255853/index.html">New Ruby Book</a></li>
<li><a href="../255859/index.html">1 year in ABBYY: Part 1 - Job Search and First Impressions</a></li>
<li><a href="../255861/index.html">Octodon again became collapsible</a></li>
<li><a href="../255863/index.html">Encryption GOST 28147-89 on x86 and GPU-processors</a></li>
<li><a href="../255867/index.html">Smart Home and MySensors: Part 0</a></li>
<li><a href="../255869/index.html">Simple tasks in Java. Weakly solve everything?</a></li>
<li><a href="../255871/index.html">Obfuscation programs</a></li>
<li><a href="../255873/index.html">Free training for students at the end of April</a></li>
<li><a href="../255875/index.html">Microsoft Developer Tour - ¬æ ways, ahead of Siberia and Kazakhstan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>