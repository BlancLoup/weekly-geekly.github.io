<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SMT Solver on iPhone</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Why buy an expensive PC if your iPhone solves SMT faster? 

 The problem of the satisfiability of formulas in theories (satisfiability modulo theories...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SMT Solver on iPhone</h1><div class="post__text post__text-html js-mediator-article">  <b>Why buy an expensive PC if your iPhone solves SMT faster?</b> <br><br>  <font color="gray">The problem of the satisfiability of formulas in theories (satisfiability modulo theories, SMT) is the problem of solvability for logical formulas taking into account the theories underlying them.</font>  <font color="gray">- <i>Wikipedia</i></font> <br><br>  A few days ago I <a href="https://twitter.com/siderealed/status/1057682481334218752">tweeted</a> : ‚ÄúA curious experiment: on the new iPhone, the Z3 prover runs faster than on my (fairly expensive) Intel desktop.  It's time to transfer all the formal research methods to the phone. ‚Äù 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: absolute; visibility: hidden; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;"></twitter-widget><blockquote class="twitter-tweet" data-lang="en_US" data-twitter-extracted-i1550907224809889816="true"><p lang="en" dir="ltr">  fun experiment: my new iPhone runs Z3 faster than my (rather expensive) Intel desktop! <br><br>  time to start <a href="https://t.co/9Faz9qNvAI">pic.twitter.com/9Faz9qNvAI</a> </p>  - James Bornholt (@siderealed) <a href="https://twitter.com/siderealed/status/1057682481334218752%3Fref_src%3Dtwsrc%255Etfw">October 31, 2018</a> </blockquote><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  I read about the incredible progress that <a href="https://www.bloomberg.com/graphics/2018-apple-custom-chips/">Apple developers</a> have made, and that Macs will soon be transferred to <a href="https://www.bloomberg.com/news/articles/2018-04-02/apple-is-said-to-plan-move-from-intel-to-own-mac-chips-from-2020/">Apple</a> 's <a href="https://www.bloomberg.com/news/articles/2018-04-02/apple-is-said-to-plan-move-from-intel-to-own-mac-chips-from-2020/">own ARM processors</a> .  These reports usually refer to some cross-platform tests, such as <a href="https://www.geekbench.com/">Geekbench,</a> to demonstrate that Apple's mobile processors are not inferior to Intel's mobile and desktop processors.  But I was always a bit skeptical about these cross-platform tests (as well as <a href="https://www.realworldtech.com/forum/%3Fthreadid%3D136526%26curpostid%3D136666">others</a> ) - do they really reflect the speed of the actual tasks for which I use my Macs? <br><a name="habracut"></a><br>  As a formal method researcher, I regularly have to run an SMT solver, usually the <a href="https://github.com/z3prover/z3">Z3 prover</a> .  I spent a lot of time studying the performance characteristics of the Z3.  It has some features that are not counted in tests (Z3 is usually single-threaded).  I recently bought a new <a href="https://www.apple.com/iphone-xs/">iPhone XS</a> with the latest <a href="https://en.wikipedia.org/wiki/Apple_A12">A12</a> processor from Apple.  And somehow, having nothing to do, I decided to compile Z3 in iOS and see how fast the new phone works (or a hypothetical future Mac). <br><br><h1>  First test </h1><br>  The cross-compilation of Z3 was surprisingly simple, you only need to change a few lines of code.  I posted the sources for <a href="https://github.com/jamesbornholt/z3-ios">running Z3 on your own iOS device</a> .  For the test, I took a few queries from my recent work on <a href="https://unsat.cs.washington.edu/projects/sympro">profiling symbolic calculations</a> : for each case, the SMT output generated by <a href="https://emina.github.io/rosette">Rosette is</a> extracted. <br><br>  In the first test, I compared the iPhone XS with one of the desktops that runs on the Intel Core i7-7700K - the best Intel chip for the consumer market at the time when I collected the car 18 months ago.  Intel was supposed to win without any problems, but it turned out otherwise: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2a/hf/xx/2ahfxxitzxvvmqtwelezih3nako.png"></div><br><br>  In this 23-second test, the iPhone XS was about 11% faster!  I tweeted about this, but twitter does not leave much room for details, so I‚Äôll present them here: <br><br><ul><li> This benchmark is a fragment of <code>QF_BV</code> from SMT, therefore Z3 solves this part with the help of bit-blasting and SAT-solver. </li><li>  The result is quite stable, even if you run the cycle ten times: the iPhone supports this performance and does not seem to start to slow down due to overheating.  <a href="https://habr.com/ru/post/429318/"><sup>one</sup></a> <a name="1_1"></a>  .  Nevertheless, the benchmark is still quite fleeting. </li><li>  Several people asked if this was due to non-determinism.  Perhaps on different platforms the solver goes a different way due to the use of random numbers or for another reason?  But I rather thoroughly checked the detailed issue of the Z3, and the results can hardly be explained by this. </li><li>  Both systems ran Z3 4.8.1, which I compiled using Clang with the same optimization settings.  I also ran tests on the i7-7700K with ready Z3 binaries (which are compiled by GCC), but they are even slower. </li></ul><br><h1>  What's happening? </h1><br>  How is this possible?  Core i7-7700K is the same desktop processor.  On a single-threaded task, it consumes about 45 watts and operates at a frequency of 4.5 GHz.  On the other hand, an unplugged iPhone.  It probably does not consume 10% of this power and works (we hope) somewhere in the 2 GHz band.  Moreover, after a comparative test, I checked the report on the use of the iPhone battery: it said that Slack used 4 times more energy than the Z3 application, despite the shorter time on the screen. <br><br>  Apple does not provide enough information to understand the performance of the Z3 on the iPhone, but fortunately, Intel provides this information for its processor.  I rummaged in <a href="https://software.intel.com/en-us/vtune">VTune for a</a> while to find performance bottlenecks when running Z3 on the desktop.  As <a href="https://www.msoos.org/">Mait Soos</a> noted, the SAT-solver <a href="https://www.msoos.org/2010/07/propagating-faster/">spends</a> most of his time <a href="https://www.msoos.org/2010/07/propagating-faster/">on distribution</a> , which is <a href="https://www.msoos.org/2010/04/optimisations/">very sensitive to the cache</a> .  VTune agrees and says that Z3 spends a lot of time waiting in memory when iterating through the observed literals.  Thus, the key to performance seems to be cache size and memory latency.  This effect may explain why the iPhone is so strong in this test: the A12 chip has a <a href="https://www.anandtech.com/show/13392/the-iphone-xs-xs-max-review-unveiling-the-silicon-secrets/3">giant L2 cache with low latency</a> , and also seems to have better memory latency after a cache miss compared to 7700K. <br><br><h1>  The rapid progress of Apple processors </h1><br>  To confirm the results, I conducted a more extensive experiment, collecting all the Apple devices I could get.  I also chose about 10 times longer benchmark (i.e., 4 minutes on the desktop) to allay concerns about the spikes in mobile CPU performance. <br><br>  Here are the results for these devices (with their release dates) regarding the A7, Apple's first 64-bit user processor: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gp/up/8x/gpup8x1j4svvnf1oxk1uitesnc4.png"></div><br><br>  Immediately it should be noted that the i7-7700K desktop processor is superior to the iPhone XS on this longer test.  But the iPhone is incredibly competitive, showing results between the i7-7700K and its predecessor, the i7-6700K, which was the fastest consumer desktop processor a little less than two years ago. <br><br>  As a joke, I added another processor Core m7-6Y75 from my MacBook 2016.  In the Z3 test, my phone is about 50% faster than a laptop. <br><br>  The really remarkable thing here is the trend: a fairly consistent improvement of 30% per year for this benchmark Z3.  Obviously, one should not draw far-reaching conclusions from one stupid test, but it seems that after a couple of iterations, Apple processors will become quite suitable for workloads.  <a href="https://habr.com/ru/post/429318/"><sup>2</sup></a> <a name="2_2"></a>  .  I honestly did not expect that we are already so close: the modern architecture of smartphones are incredible! <br><br>  <i>Thanks to <a href="https://cowanmeg.github.io/">Megan Cowan</a> , <a href="https://mwillsey.com/">Max Wills</a> and <a href="https://homes.cs.washington.edu/~eqy/">Eddie Jan</a> for helping us test on other devices.</i> <br><br><hr><br><a name="1"></a>  <sup>1</sup> .  <a href="https://mwillsey.com/">Max</a> noticed that the iPhone is waterproof, so the theory can be tested by immersing it in an ice bath.  But I paid a lot of money for the phone and do not want to voluntarily conduct such an experience.  <a href="https://habr.com/ru/post/429318/">‚Üë</a> <br><br><a name="2"></a>  <sup>2</sup>  I bet that the A12X in the new <a href="https://www.apple.com/ipad-pro/">iPad Pro is</a> even faster due to the larger <abbr title="structural elements that limit the conditioned space and regulate the transfer of heat">thermal envelope</abbr> that the tablet gives.  <a href="https://habr.com/ru/post/429318/">‚Üë</a> </div><p>Source: <a href="https://habr.com/ru/post/429318/">https://habr.com/ru/post/429318/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429308/index.html">How I left a startup in a big company</a></li>
<li><a href="../429310/index.html">Hiring, hunting, training and development of rubists. HR-corner at the conference RubyRussia-2018</a></li>
<li><a href="../429312/index.html">General game logic on the client and server</a></li>
<li><a href="../429314/index.html">Overview of the popular crypto airdrop platforms</a></li>
<li><a href="../429316/index.html">Operations on complex numbers</a></li>
<li><a href="../429320/index.html">Sberbank Data Science Day live stream November 10</a></li>
<li><a href="../429322/index.html">nanoCAD Mechanics 9.0: The Basics of Modern Design</a></li>
<li><a href="../429324/index.html">Unreal Engine 4.21 release</a></li>
<li><a href="../429326/index.html">App Store will not call. Or how I made my application, but it will not get to users</a></li>
<li><a href="../429328/index.html">Software module for digitizing damaged documents</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>