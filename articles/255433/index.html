<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OSSIM - we deploy a comprehensive open source security management system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="OSSIM (Open Source Security Information Management) - a system for managing, controlling and ensuring information security. 
 OSSIM "out of the box" i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OSSIM - we deploy a comprehensive open source security management system</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ddc/648/b54/ddc648b54536462b8db7b3795d3f5bfc.gif"><br><br>  OSSIM (Open Source Security Information Management) - a system for managing, controlling and ensuring information security. <br>  OSSIM "out of the box" includes such functionality as: <br><ul><li>  Collecting, analyzing and correlating events - SIEM </li><li>  Host Intrusion Detection System (HIDS) - <a href="http://ossec.net/">OSSEC</a> </li><li>  Network Intrusion Detection System (NIDS) - <a href="http://suricata-ids.org/">Suricata</a> </li><li>  Wireless Intrusion Detection System (WIDS) - <a href="https://www.kismetwireless.net/">Kismet</a> </li><li>  Monitoring network nodes - <a href="http://www.nagios.org/">Nagios</a> </li><li>  Analysis of network anomalies - <a href="http://lcamtuf.coredump.cx/p0f3/">P0f</a> , <a href="http://passive.sourceforge.net/about.php">PADS</a> , <a href="http://fprobe.sourceforge.net/">FProbe</a> , <a href="http://ee.lbl.gov/">Arpwatch</a> , etc. </li><li> Vulnerability Scanner - <a href="http://www.openvas.org/">OpenVAS</a> </li><li>  The most powerful system for the exchange of information about threats between OSSIM users - <a href="https://www.alienvault.com/open-threat-exchange">OTX</a> </li><li>  More than 200 plugins for parsing and correlation of logs from various external devices and services </li></ul><br><a name="habracut"></a><br><h4>  Foreword </h4><br>  This article will focus primarily on the installation, initial configuration and configuration of OSSIM, all the information about the features and functionality can be taken from the <a href="https://www.alienvault.com/">official site</a> , or look in this video: <br><br><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://player.vimeo.com/video/63875626&amp;xid=17259,15700022,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiFCs02QZeGX5Cj2GxpJ_EdyBpcyA" width="560" height="315" frameborder="0" title="AlienVault USM Platform Overview" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is worth noting that AlienVault has 2 products, free OSSIM and a more advanced version - USM, the differences can be found at <a href="https://www.alienvault.com/products/compare-ossim-to-alienvault-usm">this link</a> . <br>  As a bonus, the last chapter of the article posted information about the integration of OSSIM with the SIEM system <a href="http://www8.hp.com/ru/ru/software-solutions/siem-security-information-event-management/">ArcSight</a> . <br><br><h4>  Table of contents </h4><br>  <a href="https://habr.com/ru/post/255433/">Install OSSIM</a> <br><ul><li>  <a href="https://habr.com/ru/post/255433/">ESXi Setup</a> </li><li>  <a href="https://habr.com/ru/post/255433/">Installation</a> </li></ul><br>  <a href="https://habr.com/ru/post/255433/">OSSIM Setup</a> <ul><li>  <a href="https://habr.com/ru/post/255433/">Setup Wizard</a> </li><li>  <a href="https://habr.com/ru/post/255433/">Configure email notifications</a> </li><li>  <a href="https://habr.com/ru/post/255433/">HIDS setup</a> <br><ul><li>  <a href="https://habr.com/ru/post/255433/">Windows</a> </li><li>  <a href="https://habr.com/ru/post/255433/">Ubuntu</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/255433/">WIDS setting</a> <br><ul><li>  <a href="https://habr.com/ru/post/255433/">Virtual Machine Configuration</a> </li><li>  <a href="https://habr.com/ru/post/255433/">Install and configure Debian</a> </li><li>  <a href="https://habr.com/ru/post/255433/">OpenVPN setup</a> </li><li>  <a href="https://habr.com/ru/post/255433/">Kismet setup</a> </li><li>  <a href="https://habr.com/ru/post/255433/">Setting up import XML logs</a> </li><li>  <a href="https://habr.com/ru/post/255433/">Sensor Setup</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/255433/">Configuring the collection of system logs</a> <br><ul><li>  <a href="https://habr.com/ru/post/255433/">VMware</a> </li><li>  <a href="https://habr.com/ru/post/255433/">Windows server</a> </li><li>  <a href="https://habr.com/ru/post/255433/">Ubuntu</a> </li><li>  <a href="https://habr.com/ru/post/255433/">Note</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/255433/">ArcSight integration</a> </li></ul><br>  <a href="https://habr.com/ru/post/255433/">Used sources</a> <br><br><h4><a name="1"></a>  Install OSSIM </h4><br>  Installing the open source SIEM system is accomplished using a ready-made installation image containing the Debian operating system and all the necessary pre-installed components and modules. <br>  To install OSSIM, you need <a href="http://downloads.alienvault.com/c/download%3Fversion%3Dcurrent_ossim_iso">to open the link</a> , and then immediately begin downloading the latest version of the OSSIM distribution. <br>  We will be installing on <a href="http://www.vmware.com/ru/products/vsphere/features/esxi-hypervisor">VMware ESXi</a> . <br><br><h5><a name="11"></a>  ESXi Setup </h5><br>  First you need to configure ESXi itself, namely to configure the interface that works in <a href="https://ru.wikipedia.org/wiki/Promiscuous_mode">"promiscuous" mode (Promiscuous mode)</a> .  We need this mode to configure network monitoring.  In OSSIM, this role is performed by <a href="http://suricata-ids.org/">Suricata</a> . <br><br>  To do this, open the host settings, and do everything as in the animation below: <br><br><img src="https://habrastorage.org/files/3b9/91d/e1b/3b991de1b2bf4e36ab8f245aa7af343f.gif"><br><br>  At this setting is completed, now add a virtual machine.  In the screenshots below, only those settings that we change. <br><br><img src="https://habrastorage.org/files/340/295/fbf/340295fbff0a4c1ba63a5bbec6b65e63.png"><br><img src="https://habrastorage.org/files/552/08e/32a/55208e32a02348d9b9de1d853dfc5ebb.png"><br><img src="https://habrastorage.org/files/46d/655/b42/46d655b42216494eb772ce04c35980d3.png"><br><br>  Many services in OSSIM can work in multi-threaded mode, so it is desirable to install multiple cores. <br><br><img src="https://habrastorage.org/files/f23/469/1eb/f234691ebc6a4a4c90de5734c75a0092.png"><br><br>  RAM, it is desirable to put more.  The minimum size to which everything works is more or less stable and without slowdowns - 3GB. <br><br><img src="https://habrastorage.org/files/687/349/4bd/6873494bdd1c402ba58d3c0ceeaf258e.png"><br><br>  1 interface for managing OSSIM, 1 for Network IDS Suricata, one for OpenVAS (optional). <br><br><img src="https://habrastorage.org/files/14d/cea/370/14dcea3703314a15894cbdeea93d1233.png"><br><br>  This completes the virtual machine configuration. <br><br><h5><a name="12"></a>  Installation </h5><br>  Let's turn on the virtual machine and connect to it, the previously downloaded OSSIM installation image. <br><br><img src="https://habrastorage.org/files/961/d13/804/961d138040e444249de4d3810d74e223.png"><br><br>  Now install OSSIM.  Installation is no different than installing Debian, only the items in the installation are much smaller. <br><br><img src="https://habrastorage.org/files/236/168/2f9/2361682f96374d61a386129fbe0f5e0f.gif"><br><br>  Setting is very simple, so for brevity, some screenshots in the animation are omitted. <br>  After entering all the settings, the installation will begin. <br><br><img src="https://habrastorage.org/files/c5e/aa6/45e/c5eaa645e0ee450db469519819f69981.png"><br><br>  At the ‚ÄúRunning cdsetup ...‚Äù stage, the installation may hang for a while, as it should be. <br><br>  At the end, the console will appear: <br><br><img src="https://habrastorage.org/files/83f/ea8/2cc/83fea82cc22542279029612509e9e965.png"><br><br>  Go to the link specified in the console and enter the credentials: <br><br><img src="https://habrastorage.org/files/4fb/c9e/559/4fbc9e559b9b473cab949b2f4e191984.png"><br><br>  This completes the installation. <br><br><h4><a name="2"></a>  OSSIM Setup </h4><br>  To configure OSSIM, 3 operating systems were configured: Windows server 2008 R2, Windows 7 SP1, Ubuntu 14.04 LTS, which we will directly connect to the monitoring.  In addition, we will configure a wireless IDS system based on <a href="https://www.kismetwireless.net/">Kismet</a> , using a host with a pre-installed Debian 6 OS as a ‚Äúsensor‚Äù. <br><br><h5><a name="21"></a>  Setup Wizard </h5><br>  Enter the credentials specified in the previous configuration item: <br><br><img src="https://habrastorage.org/files/db7/2d8/142/db72d8142915463fb1e4fad8600842d3.png"><br><br>  And the wizard window opens before us: <br><br><img src="https://habrastorage.org/files/968/25f/5da/96825f5da85544fca2b85263538d3e7e.png"><br><br>  Configuring interfaces: <br><br><img src="https://habrastorage.org/files/27f/ec1/71d/27fec171dae5452c835df8574346e837.png"><br><br>  On the next paragraph, OSSIM will automatically scan the network and prompt you to specify the type of nodes found, in our case everything that does not belong to the test bench is deleted: <br><br><img src="https://habrastorage.org/files/574/cc3/523/574cc352334844019af1bccc57df6e6e.png"><br><br>  In the next step, you can automatically install a host intrusion detection system (OSSEC).  Let's try to install it for Windows Server.  Enter your credentials and click "DEPLOY": <br><br><img src="https://habrastorage.org/files/aea/ab0/a16/aeaab0a16ee246d2b396155ca4f14498.gif"><br><br>  I do not recommend doing the same for Linux, since  in this case, OSSEC will work without an agent ( <a href="http://ossec-docs.readthedocs.org/en/latest/manual/agent/agentless-monitoring.html">Agentless</a> ). <br><br>  At the next stage, we are offered to set up monitoring of logs, we skip this point and return to it later, in the relevant chapter: <br><br><img src="https://habrastorage.org/files/33b/d7d/376/33bd7d376a8241d789a5c65908b136e0.png"><br><br>  On the last paragraph, we will be offered to join the OTX, if you wish, register via the link <a href="https://www.alienvault.com/my-account/customer/signup/">www.alienvault.com/my-account/customer/signup</a> and enter the token: <br><br><img src="https://habrastorage.org/files/807/0d8/1d7/8070d81d7f1b452682249e91ad0b434c.png"><br><img src="https://habrastorage.org/files/080/398/f6e/080398f6e51b4bacb1902113f186c1ad.png"><br><br>  Further we see a pop-up window with the following content: <br><br><img src="https://habrastorage.org/files/417/153/6b6/4171536b68894b3a855cee84e9341417.png"><br><br>  Click Explore Alienvault OSSIM and this is the end of the configuration manager. <br><br><h5><a name="22"></a>  Configure email notifications </h5><br>  OSSIM has an ‚ÄúAlarm‚Äù section in which correlated security events are displayed, however, no notification will be received for such events.  But in the system there is a section ‚ÄúTickets‚Äù in which for each event or events you can open a task. <br><br>  ‚ÄúTickets‚Äù can be created manually by a specialist or automatically when events from the ‚ÄúSecurity Events (SIEM)‚Äù log in ‚ÄúAlarms‚Äù, in case of an automatic opening of the ‚Äúticket‚Äù, OSSIM can automatically send notifications, which we will now configure. <br><br>  Setting up email notifications takes place in 2 stages, first you need to configure postfix, and secondly, enable sending notifications. <br><br>  Open SSH and connect to OSSIM: <br><br><img src="https://habrastorage.org/files/43c/08d/6a3/43c08d6a312f448b9651af19eea8eb0d.png"><br><br>  Select the item Jailbreak System and get into the console, enter: <br><br><pre><code class="bash hljs">sed -i -e <span class="hljs-string"><span class="hljs-string">"s@mailserver_relay=no@mailserver_relay=my.corporate.mail.server@"</span></span> /etc/ossim/ossim_setup.conf <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> relayhost = my.corporate.mail.server:25 &gt;&gt; /etc/postfix/main.cf service postfix restart</code> </pre> <br>  <i>Note: instead of my.corporate.mail.server, specify your mail server, if necessary, configure any other postfix parameters (authorization, secure connection, etc.) - see the <a href="http://www.postfix.org/documentation.html">documentation on postfix</a> .</i> <br><br>  Now we open the settings and in the administration section we enable automatic sending of notifications: <br><br><img src="https://habrastorage.org/files/595/07b/ee2/59507bee2560401db399bb5736438649.png"><br><br>  After this manipulation, any correlated event will automatically create a ticket and notify the administrator. <br><br><h5><a name="23"></a>  HIDS setup </h5><br>  The role of the host intrusion prevention system in OSSIM is not unknown <a href="http://ossec.net/">OSSEC</a> , the configuration of which we will examine further. <br><br>  To configure HIDS, go to Environment -&gt; Detection -&gt; HIDS -&gt; Agents and see 2 hosts, the first is directly AlienVault itself, the second is the Windows Server, which we installed on the ‚ÄúDeploy HIDS‚Äù item in the ‚ÄúConfiguration Wizard‚Äù section.  Go to the HIDS agent menu: <br><br><img src="https://habrastorage.org/files/a4d/737/8e1/a4d7378e183c461b977a65bbee685ee4.png"><br><br>  Add Windows 7 and Ubuntu: <br><br><img src="https://habrastorage.org/files/1cd/f04/274/1cdf042741124e038d1c0cc65f390151.png"><br><br><h6><a name="231"></a>  Windows </h6><br>  To install HIDS, you can use the automatic installation mode. <img src="https://habrastorage.org/files/4f3/871/4d6/4f38714d6c0b44acad58b3aa5fbdd78d.png">  or download the finished exe file <img src="https://habrastorage.org/files/a06/105/951/a061059515d3405e9b42a72e186121c7.png">  . <br><br>  Installation in automatic mode is no different from what we have already done: <br><br><img src="https://habrastorage.org/files/2f9/89d/45a/2f989d45abc84acc838b77875341e665.png"><br><br>  When installing in manual mode, using the exe file, the OSSEC agent is set to ‚Äú1 click‚Äù, without entering any additional parameters: <br><br><img src="https://habrastorage.org/files/979/0bf/c9d/9790bfc9d2de40618a83fd1f08e0b4a1.png"><br><br>  If successful, we will see: <br><br><img src="https://habrastorage.org/files/3a0/5bc/817/3a05bc8173294d9699ec6f969ebe5ea6.png"><br><br><h6><a name="232"></a>  Ubuntu </h6><br>  Now we will configure Ubuntu, connect via SSH and install OSSEC: <br><br><pre> <code class="bash hljs">sudo -s apt-get install curl curl --header <span class="hljs-string"><span class="hljs-string">'Host: www.ossec.net'</span></span> --header <span class="hljs-string"><span class="hljs-string">'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:31.0) Gecko/20100101 Firefox/31.0'</span></span> --header <span class="hljs-string"><span class="hljs-string">'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span></span> --header <span class="hljs-string"><span class="hljs-string">'Accept-Language: en-US,en;q=0.5'</span></span> --header <span class="hljs-string"><span class="hljs-string">'DNT: 1'</span></span> --header <span class="hljs-string"><span class="hljs-string">'Referer: http://www.ossec.net/?page_id=19'</span></span> --header <span class="hljs-string"><span class="hljs-string">'Connection: keep-alive'</span></span> <span class="hljs-string"><span class="hljs-string">'http://www.ossec.net/files/ossec-hids-2.8.tar.gz'</span></span> -o <span class="hljs-string"><span class="hljs-string">'ossec-hids-2.8.1.tar.gz'</span></span> ‚ÄìL</code> </pre> <br>  <i>Note: loading does not work through wget, on the server side ossec.net is checked by the User-Agent.</i> <br><br><pre> <code class="bash hljs">tar xzf ossec-hids-2.8.1.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ossec-hids-2.8/ /bin/bash ./install.sh</code> </pre> <br><img src="https://habrastorage.org/files/14a/cbf/770/14acbf77068146fbb3aee5e79dabbc9f.png"><br><br><img src="https://habrastorage.org/files/2b0/495/999/2b04959994d14bcfa643b888f8b2b45a.png"><br>  <i>Note: clause 3.4, active protection mode (IPS instead of IDS) turn on carefully, in this case we use only the detection mode, so it leaves ‚Äún‚Äù instead of ‚Äúy‚Äù.</i> <br><br>  Now we will get the key, to do this, go back to the HIDS agent menu and click on <img src="https://habrastorage.org/files/4f9/576/744/4f9576744e1442ed902a51c3e65bddd5.png">  : <br><br><img src="https://habrastorage.org/files/d6a/0dd/7be/d6a0dd7bedb54ef8a799ff1904c58f49.png"><br><br>  Run the configuration using the / var / ossec / bin / manage_agents utility, press I, enter the key and exit (Q): <br><br><img src="https://habrastorage.org/files/94d/d5e/d17/94dd5ed17c1e4821a376934faab8fe2a.png"><br><br>  Reboot OSSEC: <br><br><pre> <code class="bash hljs">service ossec restart</code> </pre><br>  If successful, we will see "Active" in front of the host: <br><br><img src="https://habrastorage.org/files/9e3/cdb/f80/9e3cdbf8042746afb028468285e361d3.png"><br><br>  If any agent does not appear as active in the list, you can restart OSSEC, for this we connect via SSH to OSSIM and perform the following actions: <br><br><img src="https://habrastorage.org/files/3ef/625/5f2/3ef6255f24834ea886ae8b6a7c0eb6f8.gif"><br><br>  This completes the HIDS installation, now on the Environment -&gt; Detection tab you can see the OSSEC logs: <br><br><img src="https://habrastorage.org/files/6ab/fb7/bf7/6abfb7bf71a2454f980f50dbd98fc1a0.png"><br><br><h5><a name="24"></a>  WIDS setting </h5><br>  We will install WIDS as follows: <br><ol><li>  Let's create a host with Debian 6 OS </li><li>  Connect to it and configure the Wi-Fi card </li><li>  Install and configure kismet </li><li>  Configure on OSSIM OpenVPN server </li><li>  Configure the connection between OSSIM and Debian 6 </li><li>  Configure sending and writing logs to rsyslog </li><li>  Enable the kismet plugin </li><li>  Set up crown import logs in XML format from kismet </li><li>  Add a new sensor to OSSIM </li><li>  Check the performance of the solution </li></ol><br><br><h6><a name="241"></a>  Virtual Machine Configuration </h6><br>  To install a wireless IDS system, we need a host with Debian 6 preinstalled. <br>  Create a new virtual machine on ESXi and add a USB controller and a USB Wi-Fi card: <br><br><img src="https://habrastorage.org/files/0b6/f39/8bd/0b6f398bd4b44a858c4e7c9bb78ea1c9.gif"><br><br>  This example uses a USB Wi-Fi TOTOLink N500UD card. <br><br><h6><a name="242"></a>  Install and configure Debian </h6><br>  Install <a href="http://www.debian.org/releases/squeeze/debian-installer/">Debian 6</a> .  All settings are at your discretion, the Debian installation is standard, so this tutorial is omitted. <br><br>  After installing the OS, connect to SSH and install the <a href="http://totolink.ru/items/view/20">network card</a> drivers: <br><br><pre> <code class="bash hljs">wget http://totolink.ru/files/soft/N500UD_Linux_V2.6.1.3.zip apt-get install unzip unzip N500UD_Linux_V2.6.1.3.zip apt-get install build-essential apt-get install linux-headers-$(uname -r) make make install aptitude install wireless-tools apt-get install ssh openvpn kismet ntp reboot</code> </pre><br>  After that, we check the availability of a new interface in iwconfig: <br><br><img src="https://habrastorage.org/files/107/bff/4ea/107bff4eab4a48c79df8317049a9c0b8.png"><br><br>  Set up logging from Debian to OSSIM: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"*.* @10.67.68.1"</span></span> &gt; /etc/rsyslog.d/wids_alienvault.conf</code> </pre><br>  Do not change the IP address, it should be so.  This is the IP address of the OpenVPN server, which will be subsequently raised in OSSIM. <br>  Now create a script <b>/etc/init.d/wids_alienvault.sh with the</b> following content: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh /usr/bin/kismet_server -l xml -t kismet -f /etc/kismet/kismet.conf 2&gt;&amp;1 | logger -t kismet -p local7.1</span></span></code> </pre><br>  Give him the right to run: <br><br><pre> <code class="bash hljs">chmod 755 /etc/init.d/wids_alienvault.sh</code> </pre><br>  And we will enter it on autoload in /etc/rc.local to exit 0: <br><br><img src="https://habrastorage.org/files/22b/30c/83f/22b30c83fb4e4391a5b0884d8bc6298f.png"><br><br>  Now let's set up kismet. <br>  In the <b>/etc/kismet/kismet.conf</b> file <br>  First, configure the adapter: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">source</span></span>=rt2500,ra0,ra0-wids</code> </pre><br>  The name of the chipset can be viewed with the command: <br><br><pre> <code class="bash hljs">lsmod | grep ^usbcore</code> </pre><br>  Set up the time for creating the XML report: <br><br><pre> <code class="bash hljs">logexpiry=3600</code> </pre><br>  Configure the name of the generated logs in order for OSSIM to correctly determine which files to import and clean: <br><br><pre> <code class="bash hljs">logdefault=10.67.68.10 logtemplate=/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/kismet/%n_%D-%i.%l</code> </pre><br>  After reboot: <br><br><pre> <code class="bash hljs">reboot</code> </pre><br><h6><a name="243"></a>  OpenVPN setup </h6><br>  Connect to OSSIM via SSH, select ‚ÄúJailbreak system‚Äù and enter the command: <br><br><pre> <code class="bash hljs">alienvault-reconfig --add_vpnnode=WIDS-Sensor</code> </pre><br>  Go back to Debian and copy the configured OpenVPN archive with the settings: <br><br><pre> <code class="bash hljs">scp root@10.1.193.123:/etc/openvpn/nodes/WIDS-Sensor.tar.gz ~</code> </pre><br>  Apply config: <br><br><pre> <code class="bash hljs">tar xzf WIDS-Sensor.tar.gz rm -f WIDS-Sensor.tar.gz mv * /etc/openvpn/</code> </pre><br>  Check OpenVPN: <br><br><pre> <code class="bash hljs">/etc/init.d/openvpn restart Ifconfig tun0</code> </pre><br><img src="https://habrastorage.org/files/190/33b/3b9/19033b3b903d43d499a0b74935537c0c.png"><br><br><h6><a name="244"></a>  Kismet setup </h6><br>  Go back to OSSIM. <br>  Configure rsyslog: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> \<span class="hljs-variable"><span class="hljs-variable">$programname</span></span> contains \<span class="hljs-string"><span class="hljs-string">'ismet\'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/kismet.log &gt;&gt; /etc/rsyslog.d/kismet.conf <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> \&amp; \~ &gt;&gt; /etc/rsyslog.d/kismet.conf service rsyslog restart</code> </pre><br>  Change the path to the file from which the plugin will take logs: <br><br><pre> <code class="bash hljs">sed ‚Äìi ‚Äìe <span class="hljs-string"><span class="hljs-string">"s@/var/log/syslog@/var/log/kismet.log@"</span></span> /etc/ossim/agent/plugins/kismet.cfg</code> </pre><br>  Now we will turn on the plugin that will process the kismet logs, for this we use the exit command to exit to the OSSIM menu and turn on the plugin: <br><br><img src="https://habrastorage.org/files/7ab/8ad/7e3/7ab8ad7e3241442387d259c37b2c97c4.gif"><br><br>  If everything is done correctly, we will see logs in ‚ÄúAnalysis -&gt; Security Events (SIEM)‚Äù: <br><br><img src="https://habrastorage.org/files/2ee/a5b/e00/2eea5be00ddf4405baf24136b2a6011c.png"><br><br><h6><a name="245"></a>  Setting up import XML logs </h6><br>  Now it remains to set up importing XML logs from Debian. <br>  This is necessary so that OSSIM can receive not only alerts, but all available data on Wi-Fi clients and networks in the vicinity, which will subsequently be reflected in Environment -&gt; Detection -&gt; Wireless IDS. <br>  Configure SSH authentication without a password so that the script that receives XML reports and cleans them from the sensor works correctly. <br><br>  In OSSIM we will execute: <br><br><pre> <code class="bash hljs">ssh-keygen ssh-copy-id root@10.67.68.10</code> </pre><br><img src="https://habrastorage.org/files/2e9/305/9be/2e93059beeb7466cb8869c9f893a24c7.png"><br><br>  Now we will create the <b>/etc/cron.hourly/kismet</b> file with the following content: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash /usr/bin/perl /usr/share/ossim/www/wireless/fetch_kismet.pl</span></span></code> </pre><br>  Copy the script itself: <br><br><pre> <code class="bash hljs">cp /usr/share/ossim/www/wireless/kismet_sites.pl /var/ossim/kismet/kismet_sites.pl</code> </pre><br>  And correct the address in it: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> \<span class="hljs-variable"><span class="hljs-variable">$sites</span></span>{\<span class="hljs-string"><span class="hljs-string">'10.67.68.10\'</span></span>}=\<span class="hljs-string"><span class="hljs-string">'/var/log/kismet\'</span></span>\; &gt;&gt; /var/ossim/kismet/kismet_sites.pl</code> </pre><br><br><h6><a name="246"></a>  Sensor Setup </h6><br>  Now let's go to the web interface: <br><br><img src="https://habrastorage.org/files/38b/0d2/894/38b0d289400246558ca9dda8d7f1f403.png"><br><br>  Add a new sensor: <br><br><img src="https://habrastorage.org/files/6a3/302/8f5/6a33028f533b473ea11f7f0e4640d450.png"><br><br>  Sensor status will be with a red cross, and it should be: <br><br><img src="https://habrastorage.org/files/824/a0b/d3e/824a0bd3e2044316a73dfe0998052448.png"><br><br>  Now go to Environment -&gt; Detection -&gt; Wireless IDS and add the location and sensor: <br><br><img src="https://habrastorage.org/files/4b1/196/15e/4b119615ec094ca39c22cf93734fbb1e.png"><br><img src="https://habrastorage.org/files/3f8/ced/82e/3f8ced82e264468e9023131a1e1e3952.png"><br><img src="https://habrastorage.org/files/e51/b12/19f/e51b1219f6a9433a8e8202e292aec085.png"><br><img src="https://habrastorage.org/files/a51/349/1d5/a513491d57a54e1883fafdd4840cca27.png"><br><br>  After we execute the command: <br><br><pre> <code class="bash hljs">/usr/bin/perl /usr/share/ossim/www/wireless/fetch_kismet.pl</code> </pre><br>  And if successful, we get: <br><br><img src="https://habrastorage.org/files/7ee/d66/5d1/7eed665d16984bd3971329e38fd24fb6.png"><br><br>  And after this action in the Environment -&gt; Detection -&gt; Wireless IDS item, the following data will appear: <br><br><img src="https://habrastorage.org/files/857/c9a/5bf/857c9a5bf4af4c2882411a64f7513e86.png"><br><br><h5><a name="25"></a>  Configuring the collection of system logs </h5><br>  Configure log collection from VMware ESXi, Windows server and Ubuntu. <br><br>  To collect logs, we need to do the following: <br><ol><li>  Configure sending logs from hosts to OSSIM </li><li>  See from which file the OSSIM plugin that handles events reads logs </li><li>  Configure logging from hosts to separate files through the rsyslog configuration </li><li>  Enable plugin </li><li>  Check the performance </li></ol><br><br><h6><a name="251"></a>  VMware </h6><br>  First, we configure sending logs to ESXi, for this we open advanced settings: <br><br><img src="https://habrastorage.org/files/bd5/fd9/7ed/bd5fd97ed32c4768b60e02490e6f977c.png"><br><br>  And turn on sending logs via UDP: <br><br><img src="https://habrastorage.org/files/8c5/853/71f/8c585371f0e14b1fb895b4b8dbe4d6e7.png"><br><br>  After that, see where the ESXi plugin will pick up logs. <br><br><pre> <code class="bash hljs">cat /etc/ossim/agent/plugins/vmware-esxi.cfg | grep location</code> </pre><br><img src="https://habrastorage.org/files/c26/80f/b85/c2680fb85cc34946bb4f4d5d01c51ec8.png"><br><br>  Configure rsyslog: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> \<span class="hljs-variable"><span class="hljs-variable">$fromhost</span></span>-ip == \<span class="hljs-string"><span class="hljs-string">'10.1.193.76\'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> -/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/vmware-esxi.log &gt;&gt; /etc/rsyslog.d/esxi.conf service rsyslog restart</code> </pre><br>  Now turn on the plugin, connect via SSH to OSSIM: <a name="2511"></a><br><br><img src="https://habrastorage.org/files/f48/4d0/706/f484d0706be642d1b353cd26e43e4a90.gif"><br><br>  Open Analysis -&gt; Security Events (SIEM) and check: <br><br><img src="https://habrastorage.org/files/c68/28a/e6b/c6828ae6bed84241b486148bb28b3c58.png"><br><br><h6><a name="252"></a>  Windows server </h6><br>  To send logs from Windows, we need the <a href="http://sourceforge.net/projects/snare/">Snare</a> program, which allows you to send system logs in syslog format. <br><br>  Download and run: <br><br><img src="https://habrastorage.org/files/1f1/2b9/125/1f12b91258a145c3b914273829850b98.png"><br><br>  Enable web access: <br><br><img src="https://habrastorage.org/files/659/c48/4d8/659c484d842948c6b3af827ce742bbe7.png"><br><br>  Finish the installation: <br><br><img src="https://habrastorage.org/files/b95/d30/909/b95d309091d54ed5a30395c43dcbed0e.png"><br><br>  We open in the browser the address: <a href="http://localhost/">localhost</a> : 6161 <br><br>  Enter the login snare, the password that was specified during the installation, go to the "Network configuration" and specify: <br><br><img src="https://habrastorage.org/files/d92/842/fd7/d92842fd71cc406f84d0a14d11f6d739.png"><br><img src="https://habrastorage.org/files/914/494/260/914494260438407db4f8a414a1da7741.png"><br><br>  After saving the settings, open the console and reboot snare: <br><br><pre> <code class="bash hljs">net stop snare net start snare</code> </pre><br><img src="https://habrastorage.org/files/2c1/018/2c4/2c10182c48cf4f9897513c2ae04f6248.png"><br><br>  Check where the plugin gets the logs: <br><br><pre> <code class="bash hljs">cat /etc/ossim/agent/plugins/snare.cfg | grep location</code> </pre><br><br><img src="https://habrastorage.org/files/ce5/9a4/7d1/ce59a47d11ca43f3869353c003858bec.png"><br><br>  Now configure rsyslog.  In the rsyslog settings, there is already a pre-installed snare config (zzzzz_snare.conf), which we will now correct a little, <a href="https://www.alienvault.com/forums/discussion/2371/snare-logs-show-up-in-syslog-but-not-the-siem-gui">following the OSSIM forum</a> , replacing only 1 parameter: <br><br><pre> <code class="bash hljs">sed -i -e <span class="hljs-string"><span class="hljs-string">"s@msg@rawmsg@"</span></span> /etc/rsyslog.d/zzzzz_snare.conf service rsyslog restart</code> </pre><br>  Now we will configure the plugin, by analogy with the <a href="https://habr.com/ru/post/255433/">VMware</a> configuration, except for the choice of the plugin itself: <br><br><img src="https://habrastorage.org/files/b6c/838/949/b6c8389498b34c63aad667d88fad13b0.png"><br><br>  After restarting, check in Analysis -&gt; Security Events (SIEM): <br><br><img src="https://habrastorage.org/files/1bb/d27/9aa/1bbd279aa9fc44628a25519010a9af8b.png"><br><br><h6><a name="253"></a>  Ubuntu </h6><br>  To configure Ubuntu, we will use rsyslog.  Connect to Ubuntu via SSH and configure sending logs to OSSIM: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> *.* @10.1.193.123 &gt; /etc/rsyslog.d/alienvault.conf service rsyslog restart</code> </pre><br>  Check where the plugin takes the logs: <br><br><img src="https://habrastorage.org/files/44c/b34/f83/44cb34f83d6b48d594a4c2a949bd110d.png"><br><br><pre> <code class="bash hljs">cat /etc/ossim/agent/plugins/syslog.cfg</code> </pre><br>  Change the path to the log file: <br><br><pre> <code class="bash hljs">sed ‚Äìi ‚Äìe <span class="hljs-string"><span class="hljs-string">"s@/var/log/syslog@/var/log/ubuntusyslog.log@"</span></span> /etc/ossim/agent/plugins/syslog.cfg</code> </pre><br>  Now configure rsyslog in OSSIM: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> \<span class="hljs-variable"><span class="hljs-variable">$fromhost</span></span>-ip == \<span class="hljs-string"><span class="hljs-string">'10.1.193.77\'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> -/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/ubuntusyslog.log &gt;&gt; /etc/rsyslog.d/ubuntu.conf service rsyslog restart</code> </pre><br>  We include the plugin, by analogy with the <a href="https://habr.com/ru/post/255433/">previous paragraphs</a> , only in the list of plug-ins we choose the right one: <br><br><img src="https://habrastorage.org/files/3d6/dce/7b4/3d6dce7b472c4a17ae70d616973e2305.png"><br><br>  We apply and check: <br><br><img src="https://habrastorage.org/files/aef/a95/1fb/aefa951fbf96493d983a4a00fd5995c1.png"><br><br><h6><a name="254"></a>  Note </h6><br>  If you didn‚Äôt see the AlienVault Reconfig window after selecting ‚ÄúApply changes‚Äù <br><br><img src="https://habrastorage.org/files/66e/604/efb/66e604efbbed4a108db2beeba18a681a.png"><br><br>  Reboot OSSIM (in the latest version 4.15.2, such a bug periodically appears) <br><br>  To solve problems with parsing logs in cp1251 (Cyrillic) encoding, you need to do the following: <br>  In the <b>/usr/share/alienvault/ossim-agent/ParserDatabase.py</b> file at line 288 after: <br><pre> <code class="bash hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(ret) &gt; 0: <span class="hljs-comment"><span class="hljs-comment">#We have to think about event order when processing cVal = ret[len(ret) - 1][ref] for e in ret:</span></span></code> </pre><br>  Paste: <br><pre> <code class="bash hljs"> e=list(e) x=[x.decode(<span class="hljs-string"><span class="hljs-string">'cp1251'</span></span>).encode(<span class="hljs-string"><span class="hljs-string">'utf8'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(x, basestring) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> e] <span class="hljs-comment"><span class="hljs-comment">## change for encoding cp1251 e=x e=tuple(e)</span></span></code> </pre><br>  In the <b>/usr/share/alienvault/ossim-agent/TailFollowBookmark.py</b> file on line 163 after: <br><pre> <code class="bash hljs"> def _open_file(self, fromrotate=False): <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">" Opens the file and seeks to the specified position based on the keyword arguments: offset and whence. Furthermore, the _current_file attribute is set as a side-effect. fromrotate: Indicates if the file is opened when a log rotation is detected "</span></span><span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre><br>  Paste: <br><pre> <code class="bash hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ¬´alerts.log¬ª <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.filename: self.encode=<span class="hljs-string"><span class="hljs-string">'cp1251'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.encode=<span class="hljs-string"><span class="hljs-string">'utf8'</span></span></code> </pre><br>  <a href="https://www.alienvault.com/forums/discussion/2143/russian-charcter-in-my-sql-database">Link to the forum</a> , where there was a discussion of the problem with the encoding. <br>  For information about solving this bug, many thanks to <a href="https://habrahabr.ru/users/dolph2005/" class="user_link">dolph2005</a> <br><br><h5><a name="26"></a>  ArcSight integration </h5><br>  Now we will try to configure the integration of OSSIM with the SIEM system <a href="http://www8.hp.com/ru/ru/software-solutions/siem-security-information-event-management/">ArcSight</a> . <br><br>  Such a bundle can save tens of millions on ArcSight licenses if, in addition to the main office, the company has dozens of small branches that need to be protected and monitored. <br>  The purpose of this section is to send already correlated OSSIM logs to ArcSight, and not to correlate them on the ArcSight side, increasing the load. <br><br>  To do this, you need to install a connector (Syslog connector type), add the following FlexAgent: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># FlexAgent Regex Configuration File do.unparsed.events=true regex=\\D+ AV-FREE-FEED (\\D+) DST_IP -- SRC_IP: (\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}) , DST_IP: (\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}), Alarm: directive_event: AV-FREE-FEED \\D+ (\\d) (.*) token.count=5 token[0].name=Event_Name token[0].type=String token[1].name=SRC_IP token[1].type=IPAddress token[2].name=DST_IP token[2].type=IPAddress token[3].name=Dev_Severity token[3].type=String token[4].name=Event_Message token[4].type=String event.name=Event_Name event.sourceAddress=SRC_IP event.destinationAddress=DST_IP event.deviceSeverity=Dev_Severity event.message=Event_Message event.deviceVendor=__getVendor(AlienVault) event.deviceProduct=__stringConstant(OSSIM)</span></span></code> </pre><br>  In the folder of the connector and then in the " <b>user \ agent \ flexagent \ syslog</b> ".  File name to make " <b>ossim.sdkrfilereader.properties</b> " <br>  In the agent.properties file, change the line of agents [0] .customsubagentlist, adding ‚Äúossim‚Äù there, for example: <br>  agents [0] .customsubagentlist = ossim | ciscopix_syslog | netscreen_syslog | ... <br>  And the line of agents [0] .usecustomsubagentlist put true. <br>  Next, go to the OSSIM settings: <br><br><img src="https://habrastorage.org/files/6fa/dfb/a40/6fadfba40ca842479de7d50fdd6d7751.png"><br><br>  And enable sending alarm to syslog: <br><br><img src="https://habrastorage.org/files/e1f/cf2/24a/e1fcf224acf045d39f3bcfb74b0e9a87.png"><br><br>  After you configure send logs to rsyslog OSSIM. <br>  Add the line in the /etc/rsyslog.conf file: <br>  *. * ip.your.Flex.agent <br><br><img src="https://habrastorage.org/files/946/e2b/46a/946e2b46a3ae4fe4989b67d20a6a11c8.png"><br><br>  After that, the already correlated logs will appear in the ArcSight connector: <br><br><img src="https://habrastorage.org/files/198/605/f59/198605f591de4e3eab5f00595451d77d.png"><br><br><h4><a name="3"></a>  Used sources </h4><br><ul><li>  <a href="http://en.wikipedia.org/wiki/OSSIM">en.wikipedia.org/wiki/OSSIM</a> </li><li>  <a href="https://alienvault.bloomfire.com/">alienvault.bloomfire.com</a> </li><li>  <a href="https://www.alienvault.com/forums">www.alienvault.com/forums</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/255433/">https://habr.com/ru/post/255433/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255419/index.html">Configuring volume replication in Windows Server vNext</a></li>
<li><a href="../255423/index.html">Motion Blur Effect with SVG</a></li>
<li><a href="../255425/index.html">PODAM Java Objects for Unit Testing</a></li>
<li><a href="../255427/index.html">Features of working with virtual disks VirtualBox</a></li>
<li><a href="../255429/index.html">Hello, SaaS | PR and marketing Dental Cloud</a></li>
<li><a href="../255435/index.html">Google removed scandalous photo to avoid ban</a></li>
<li><a href="../255437/index.html">Use the built-in firewall in InfoboxCloud</a></li>
<li><a href="../255439/index.html">Intel Summer School 0x7DF. Time to apply</a></li>
<li><a href="../255443/index.html">Git for Windows Alternatives</a></li>
<li><a href="../255445/index.html">RTOS should simplify the development of IoT devices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>