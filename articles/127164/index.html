<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Protection and hacking of the database on the example of the program "Parts Catalog"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you want to protect the database that is used in your program, this information will be useful to you. You may need to improve security, for exampl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Protection and hacking of the database on the example of the program "Parts Catalog"</h1><div class="post__text post__text-html js-mediator-article">  If you want to protect the database that is used in your program, this information will be useful to you.  You may need to improve security, for example, by encrypting database values ‚Äã‚Äãand decrypting them during output. <br><br>  So.  There is a program with a folder DATA, the data from which I really want to get. <br><br>  There are several options. <br><ul><li>  The first option.  You can go the hard way by taking screenshots and exporting applications one by one to excel.  But it is a long and uninteresting way. </li><li>  The second option.  Think and decode the data. </li></ul><br>  First you need to know in what format the data is stored in the program.  You can use the free program <a href="http://mark0.net/soft-trid-e.html">TrID</a> . <a name="habracut"></a>  We try ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/7c0/c67/d86/7c0c67d869f328f3f04b1fdc6d15e92c.png" alt="image"><br><br>  Sadness  Something not known.  It looks like some kind of proprietary format based on ole datastore.  If this is indeed the case and the developers decided to bother and write their own DBMS, then it will be very difficult to extract data for a long time.  It will be easier to use option 1. <br><br>  But, all programmers are lazy and most likely this is some known format.  For example Access or Firebird.  I would do that.  Looked in the catalog with the program, there are no libraries. <br><br>  We investigate further.  We download a very useful free utility with <a href="http://technet.microsoft.com/ru-ru/sysinternals/bb896653">Process explorer</a> , which shows all program access to the registry, files and everything else possible. <br>  We start, we configure, that only one catalog.exe process is motivated, which is the main executable file of the program. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c7f/43f/75f/c7f43f75f8dc885e1295a73bdf521bda.png" alt="image"><br><br>  Run the program and see where it goes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d2/d3d/464/4d2d3d46436d45a725113a04dae6080c.png" alt="image"><br><br>  ABOUT!  It uses an ODBC data source.  Most likely used db is access!  Set yourself a plus sign.  We look further.  There is an interesting key in the TraceSQLMode registry.  Googling it turns out that all requests can be written to the file.  Change the key and look for the file.  Found: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/80e/ec3/1dd/80eec31dd8177fb18d0c546872da3741.png" alt="image"><br><br>  We look requests: <br> <code>SELECT <br> ‚Ä¶ <br> FROM spare LEFT JOIN photo ON photo.serial = spare.serial</code> <br> <br>  The plate is called spare, which means a spare part.  So this is not an auxiliary database and the names of the parts are really stored there.  Fine.  We look further. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/77b/469/c6b/77b469c6b1e82d57466b0070ec6da409.png" alt="image"><br><br>  Accessing the database file is not in the program directory.  So it is temporarily copied there.  We try to open in access - without result, it does not understand. <br><br>  We make an action in the program, switch to another position in the directory, look more closely at the log: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c23/e06/708/c23e06708d68207f81521ecad4d48acb.png" alt="image"><br><br>  Before the request, the file is modified, something is written to it.  Probably it either decrypts or changes the file header.  Now it is no longer important, because we understand that if prior to a request to copy this file, then it is more likely to be working. <br><br>  So you need to somehow suspend the execution of the program until the request, while the file is working.  That's right, tracing in debagger.  Download debugger, for example, free <a href="http://www.ollydbg.de/">OllyDbg</a> weighing 1.3MB. <br><br>  Run in admin mode if you have windows vista and above. <br>  Join the running process (attach) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4da/995/616/4da995616ca3f1207350c8a90209093e.png" alt="image"><br><br>  Choose our process: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db3/30c/9e8/db330c9e8cb74b4e85c2ac79dc32f814.png" alt="image"><br><br>  We return to Process Explorer and watch the function call stack (in the context menu of the event): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/00d/e2b/ddb/00de2bddbb6c8a6434ccccfeb469c98a.png" alt="image"><br><br>  The breakpoint can be put on the call to close the CloseHandle file in the kernel32.dll system module. <br><br>  Go to this module in debugger: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/65c/f9a/3d5/65cf9a3d5efd02f5c0c290c03cdef404.png" alt="image"><br><br>  Find the desired function: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d1/bb4/2f4/2d1bb42f47b84997804f420bd662f92a.png" alt="image"><br><br>  Set a breakpoint (F2). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d91/1a3/20c/d911a320c30af3f215132d4db262c978.png" alt="image"><br><br>  Next, run the program execution by pressing F9.  And do any action in the experimental program.  The program will stop at the breakpoint. <br><br>  We trace (F8) in debaggrere until records of access to the registry appear before the execution of the request.  This will mean that the database file has been modified to connect to it and is readable. <br><br>  After that, go to the file and copy it to another location: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c79/0d8/97b/c790d897b3eb325db7125c3c7b0ebd8c.png" alt="image"><br><br>  We look at the file now: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba1/428/84c/ba142884c8602c84bf7def0b9061664d.png" alt="image"><br><br>  100% mdb!  This is an MS Access file.  Rename, open, make sure that all is well. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/50f/ed4/e71/50fed4e71ac60921a07f149b4bacf03d.png" alt="image"><br><br>  We have successfully obtained a database suitable for further modifications or converting to another format. <br><br>  Since I started writing, I‚Äôll post a script on <a href="http://groovy.codehaus.org/Download">groovy</a> to convert data from MS Access to a PostgreSQL database. <br><br>  here he is: <br> <code>import groovy.sql.Sql <br> java.util.Properties prop = new java.util.Properties(); <br> prop.put(‚ÄúcharSet‚Äù, ‚Äúcp1251‚Äù); <br> sourceSql = Sql.newInstance('jdbc:odbc:catalog2',prop) <br> targetSql = Sql.newInstance(‚Äújdbc:postgresql://localhost:5432/catalog‚Äù,‚Äùcatalog‚Äù,‚Äùcatalog‚Äù, ‚Äúorg.postgresql.Driver‚Äù) <br> def images = targetSql.dataSet(‚Äúimage‚Äù); <br> sourceSql.eachRow('select * from image') { <br> def id = it.id <br> images.add(id:id,block:it.block); <br> def image=it.getProperty(‚Äúimage‚Äù) <br> if (image) { <br> File f = new File(‚ÄúD:/trid_w32/images/‚Äù + id + ‚Äú.png‚Äù); <br> f.append(image); <br> } <br> } <br> def coords = targetSql.dataSet(‚Äúcoord‚Äù); <br> sourceSql.eachRow('select * from coord') { <br> coords.add(id:it.id,block:it.block,x:it.x,y:it.y,r:it.r); <br> } <br> def spares = targetSql.dataSet(‚Äúspare‚Äù); <br> sourceSql.eachRow('select * from spare') { <br> spares.add(id:it.id,parent:it.parent,num:it.num,serial:it.serial,count:it.count,spec:it.spec,apply:it.apply,ru:it.ru,cn:it.cn); <br> }</code> <br> <br>  It is started by the interpreter: <br><br> <code>groovy _.groovy</code> <br> <br>  Conclusions: To protect the database, you need either (the most reliable) to write data in a proprietary format, or encrypt the values ‚Äã‚Äãin the database and unzip it directly on display, as well as use auxiliary protection methods, such as encrypt the file itself, change the file signature, use the built-in encryption bd <br><br>  PS The author of this article is Alexander Surovtsev.  If you liked the material, help him please get an invite to Habr.  I, unfortunately, distributed all my invites.  His email address is surovtsev.alex on gmail.com, twitter is <a href="http://twitter.com/mobal1">mobal1</a> Thank you very much! </div><p>Source: <a href="https://habr.com/ru/post/127164/">https://habr.com/ru/post/127164/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127151/index.html">iLab announces autumn call for ideas</a></li>
<li><a href="../127154/index.html">How the programmers of the times ‚ÄúWord about Igor's Regiment‚Äù wrote</a></li>
<li><a href="../127157/index.html">"Reading some articles of Habr, tears from indignation come to my eyes" or impartial revolutions in Russian</a></li>
<li><a href="../127161/index.html">Video analytics demonstration in Minsk</a></li>
<li><a href="../127163/index.html">kedDroid - S04E07. Video review software for Android</a></li>
<li><a href="../127165/index.html">We catch the horizon with Arduino</a></li>
<li><a href="../127167/index.html">Apple Developers Community # 8. School iOs first release</a></li>
<li><a href="../127168/index.html">Diamond Dash again</a></li>
<li><a href="../127169/index.html">TURNKEY INTRODUCTION: mutual understanding of the parties</a></li>
<li><a href="../127170/index.html">Record labels are suing a site that allows you to download videos from YouTube</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>