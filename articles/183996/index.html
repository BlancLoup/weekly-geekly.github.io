<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Address book on OpenLDAP for Outlook</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 The company has a file with contacts of employees, filled by the hands of the manager. You need to make it a synchronized address book ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Address book on OpenLDAP for Outlook</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  The company has a file with contacts of employees, filled by the hands of the manager.  You need to make it a synchronized address book with addresses and attendances for your email program - MS Outlook, The Bat, Mozilla Thunderbird, etc. <br><br>  I really want it to be compatible with ‚Äúshow the entire list‚Äù in Outlook, without a filter. <br><a name="habracut"></a><br>  Cut the task into 4 parts: <br><ul><li>  Configure OpenLDAP </li><li>  Get XLS from server </li><li>  Convert to digestible format, parse </li><li>  Remove old contacts from the book, put modules there </li></ul><br><br><h4>  Openldap </h4><br>  Due to the frivolous handling of standards by Microsoft, we have an incompatibility of displaying all the addresses in the address book.  Since the mountain doesn‚Äôt go to Muhammad, you‚Äôll have to tweak OpenLDAP a bit. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Victor Sudakov did a great job with the patch <a href="http://victor-sudakov.livejournal.com/124269.html">here</a> , for which he thanks a lot for admin. <br><br>  As an OS on the server, which can easily be virtual, say, with an 8Gb disk and 64Mb of memory, there is CSS - Calculate Linux Scratch (Gentoo, in one word), for which you can make your patch easily and naturally. <br><br><h4>  Pachim </h4><br>  Retreat for those who do not want to engage in bloody patching - just connect my test turnips (not the fact that I will update it): Add overlay to /etc/layman/layman.cfg: <br><br><pre><code class="bash hljs">overlays : http://www.gentoo.org/proj/en/overlays/repositories.xml https://raw.github.com/arrrght/openldap-outlook/master/overlay.xml</code> </pre> <br><br>  Activate and sync: <br><pre> <code class="hljs sql"><span class="hljs-comment"><span class="hljs-comment"># layman -S # layman -a openldap-outlook</span></span></code> </pre><br><br>  We write the keys in /etc/portage/package.use: <br> <code>net-nds/openldap experimental icu slp perl overlays ms-sssvlv</code> <br> <br>  Install OpenLDAP <br><pre> <code class="bash hljs">emerge openldap</code> </pre><br><br>  For those who love to do everything with their hands, here is the patch (taken <a href="http://victor-sudakov.livejournal.com/124269.html">here</a> ): <br><pre> <code class="diff hljs"><span class="hljs-comment"><span class="hljs-comment">--- ./openldap-2.4.33/servers/slapd/schema_prep.c.orig 2012-12-07 09:54:56.000000000 +0700 +++ ./openldap-2.4.33/servers/slapd/schema_prep.c 2012-12-07 09:58:10.000000000 +0700 @@ -908,6 +908,7 @@ "DESC 'RFC4519: common supertype of name attributes' " "EQUALITY caseIgnoreMatch " "SUBSTR caseIgnoreSubstringsMatch " + "ORDERING caseIgnoreOrderingMatch " "SYNTAX 1.3.6.1.4.1.1466.115.121.1.15{32768} )", NULL, SLAP_AT_ABSTRACT, NULL, NULL,</span></span></code> </pre><br><br><h4>  Customization </h4><br>  The most correct setting is written <a href="http://sysadminblog.ru/ldap/2009/10/26/pravilnaya-incializaciya-openldap-servera-s-dinamicheskoy-konfiguraciey.html">here</a> - this is just for those who decide to seriously engage in LDAP.  In my case, everything is easier - I just need an address book.  I left almost everything by default in the /etc/openldap/slapd.conf file.  Here it is, entirely, without any indexes, and in general, a lot of extras: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span> /etc/openldap/<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>/core.<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> /etc/openldap/<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>/cosine.<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> /etc/openldap/<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>/inetorgperson.<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> /etc/openldap/<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>/java.<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> /etc/openldap/<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>/openldap.<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> /etc/openldap/<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>/nis.<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> /etc/openldap/<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>/corba.<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> /etc/openldap/<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>/dyngroup.<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> /etc/openldap/<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>/misc.<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> /etc/openldap/<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>/pmi.<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span> pidfile /var/run/openldap/slapd.pid argsfile /var/run/openldap/slapd.args modulepath /usr/lib64/openldap/openldap moduleload back_passwd.so moduleload back_ldap.so moduleload sssvlv.so <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> hdb overlay sssvlv suffix "dc=org,dc=com" <span class="hljs-keyword"><span class="hljs-keyword">checkpoint</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> rootdn "cn=Manager,dc=org,dc=com" rootpw secret directory /var/lib/openldap-data <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> objectClass eq   ,  ,    LDAP   entry.ldif: dn: dc=org,dc=com objectClass: dcObject objectClass: organization o: org.com&lt;/code&gt;   ldif  : &lt;code&gt;slapadd &lt; entry.ldif&lt;/code&gt;    LdapAdmin     ou=ab,dc=org,dc=com. ,  ,      . &lt;h4&gt;XLS&lt;/h4&gt;      smbget,    samba,   xls2csv.          getfile.sh: &lt;source lang="bash"&gt; #!/bin/sh SMBGET=/usr/bin/smbget LDAPSEARCH=/usr/bin/ldapsearch LDAPDELETE=/usr/bin/ldapdelete rm "temp.xls" ${SMBGET} "smb://domain;user:password@192.168.1.1/Share/Telephones.xls" -o <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>.xls xls2csv -c~ -b\<span class="hljs-string"><span class="hljs-string">' temp.xls &gt; temp.csv # delete all from ou=ab,dc=org,dc=com ${LDAPSEARCH} -b "ou=ab,dc=org,dc=com" "(uid=*)" | grep dn: | awk '</span></span>{print <span class="hljs-meta"><span class="hljs-meta">$2</span></span>}<span class="hljs-string"><span class="hljs-string">' | ${LDAPDELETE} -Dcn=Manager,dc=org,dc=com -wsecret</span></span></code> </pre><br><br>  Further the pearl-barley script transforming csv into the necessary ldif file, approximately such (it is written in a hurry): <br><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl use strict; use encoding 'utf8'; open my $fh, "&lt;temp.csv" or die 'Can\'t open file'; open my $fout, "&gt;temp.ldif" or die 'Can\'t write to file'; my $org = ''; my $orgNum = 0; my $div = ''; my $userNum = 1000; my $ouDcDc = 'ou=ab,dc=org,dc=com'; while (my $line = &lt;$fh&gt;) { my $isNowOrg = 0; my $email = ''; chomp $line; my @f = split /~/, $line; if (!$org || $f[0]=~/\'/){ $org = clean($f[0]); $org =~s/^(.+)\"(.+)\"$/$2/; $org = firstUp($org); $isNowOrg = 1; $orgNum++; } $email = clean($f[5]) if $f[5]=~/@/; $div = firstUp(clean($f[0])) unless $f[1] || $email; my $name = clean($f[1]); my $post = clean($f[0]); my $telNum = clean($f[4]); $telNum =clean($f[2]) if $orgNum==3; $telNum =~s/\D/ /g; $telNum =~s/^\D*//g; #print "#$telNum#\n"; #$telNum = ~s/\W//g; my %names = givenName($name); if ($name &amp;&amp; $post &amp;&amp; $names{'firstName'}){ ++$userNum; print $fout "dn: uid=user${userNum},${ouDcDc}\n"; print $fout "uid: user${userNum}\n"; print $fout "objectClass: posixAccount\nobjectClass: top\nobjectClass: inetOrgPerson\ngidNumber: 1000\n"; print $fout "uidNumber: ${userNum}\n"; print $fout "givenName: ", $names{'firstName'}, "\n"; print $fout "initials: ", $names{'middleName'}, "\n"; print $fout "sn: ", $names{'lastName'}, "\n"; #print $fout "username: user${userNum}\n"; print $fout "homeDirectory: home_dir\ngecos: gecos\nloginShell: log_shell\n"; print $fout "telephoneNumber: ${telNum}\n" if $telNum; print $fout "physicalDeliveryOfficeName: ${div}\n"; print $fout "ou: ${div}\n"; print $fout "o: $org\n"; #print $fout "organizationName: ACME\n"; print $fout "title: $post\n"; print $fout "mail: $email\n"; print $fout "cn: ", $names{'shortName'},"\n"; print $fout "\n"; # print "ORG: $org, DIV: $div, POST: $post, NAME: $name, EMAIL: $email\n"; } } close $fout; close $fh; sub givenName(){ my $name = shift; my @s=[]; my %names = {}; @s = split ' ', $name; $names{'firstName'} = $s[1]; $names{'lastName'} = $s[0]; $names{'middleName'} = $s[2]; $names{'shortName'} = $s[0] .' '. substr($s[1],0,1) .'.'. substr($s[2],0,1) .'.'; return %names; } sub clean(){ my $name = shift; $name =~s/^\'//; $name =~s/\"\"/\"/g; $name =~s/^\"//; $name =~s/\"$//; $name =~s/\ *$//g; $name =~s/\ +/\ /g; return $name; } sub firstUp(){ my $name = shift; $name = lc($name); return ucfirst($name); }</span></span></code> </pre><br>  After that, the output should be temp.ldif, which we already feed to the command <br><br><pre> <code class="bash hljs">ldapadd -v -Dcn=Manager,dc=org,dc=com -wsecret &lt; ./temp.ldif</code> </pre><br><br>  That somehow with the server part.  On the client, in Outlook, we do: <br><br><pre> <code class="hljs erlang-repl">   --&gt;   --&gt;  --&gt; LDAP--&gt; IP:  IP        --&gt;  --&gt;  : ou=ab,dc=org,dc=com :   (  )</code> </pre><br><br>  Everything.  We check, we register in kroner, we optimize. <br>  PS: In order to display the organization in the Olook address list, you need to patch the /etc/openldap/schema/core.schema file: Add 'company' - thanks to Microsoft for not paying attention to the standard o entry, line 120 <br><pre> <code class="hljs pgsql">attributetype ( <span class="hljs-number"><span class="hljs-number">2.5</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span> <span class="hljs-type"><span class="hljs-type">NAME</span></span> ( <span class="hljs-string"><span class="hljs-string">'company'</span></span> <span class="hljs-string"><span class="hljs-string">'o'</span></span> <span class="hljs-string"><span class="hljs-string">'organizationName'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-string"><span class="hljs-string">'RFC2256: organization this object belongs to'</span></span> SUP <span class="hljs-type"><span class="hljs-type">name</span></span> )</code> </pre><br><br>  ** <a href="http://a3r.me/posts/openldap-outlook.html">Copy-paste</a> from my site <a href="http://a3r.me/posts/openldap-outlook.html">a3r.me/posts/openldap-outlook.html</a> </div><p>Source: <a href="https://habr.com/ru/post/183996/">https://habr.com/ru/post/183996/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../183986/index.html">Generate elevation map</a></li>
<li><a href="../183988/index.html">Review of the monoblock Samsung 300A2A-T01</a></li>
<li><a href="../183990/index.html">Bicycle to generate Excel documents on the template</a></li>
<li><a href="../183992/index.html">The way to protect against unauthorized copying of files to the root of a flash card for users of OS WINDOWS</a></li>
<li><a href="../183994/index.html">What is important for creating an AI?</a></li>
<li><a href="../183998/index.html">Belt conveyor for linear data</a></li>
<li><a href="../184000/index.html">The Ministry of Revenues of Ukraine will undertake other payment systems, including Yandex.Money</a></li>
<li><a href="../184002/index.html">Lumia 925 Presentation: Quick Review and Comparison with Lumia 920</a></li>
<li><a href="../184004/index.html">Microsoft refused to buy Nokia</a></li>
<li><a href="../184008/index.html">Google admitted that interview puzzles are useless</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>