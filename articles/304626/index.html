<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PVS-Studio hurries to the aid of CERN: checking the project Geant4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Geant4 project continues to evolve, so it is interesting to check it again with the help of the PVS-Studio static code analyzer. This time, versio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PVS-Studio hurries to the aid of CERN: checking the project Geant4</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/7e8/7d7/75b/7e87d775bbfecea8768205717677ff78.png" alt="PVS-Studio hurries to the aid of CERN" align="left">  The Geant4 project continues to evolve, so it is interesting to check it again with the help of the PVS-Studio static code analyzer.  This time, version 10.2 will be checked (the previous check was for version 10.0-beta). <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  The Geant4 toolkit was developed at CERN and is designed to simulate and study the behavior of particles passing through a substance, using Monte-Carlo methods.  Earlier versions of the project were written in the Fortran language, and since version 4 the project has been completely translated into object-oriented C ++. <br><br>  More information about the project can be found on the official website of the project <a href="http://geant4.org/">http://geant4.org</a> . <br><br>  A couple of times the project Geant4 has already been tested, and other articles tell about the results.  You can read about checking version 9.4 in the article " <a href="http://www.viva64.com/ru/b/0223/">Copy-Paste and muons</a> ", and about checking version 10.0-beta in the article " <a href="http://www.viva64.com/ru/b/0224/">Continuing to check Geant4</a> ". 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since the last check, a new version of Geant4.10.2 was released.  PVS-Studio has also been updated since that time, and the analyzer version 6.05 was used for testing. <br><br>  In the project, I came across a lot of errors related to conditions and comparisons.  Logical errors are most often made when the code is left for future refinement, or by inaccurate modification with the removal of the previous, controlling transitions, parts of the code.  But simple typographical errors and insufficient forethought of expressions can also lead to errors or redundant code. <br><br><h2>  Piquancy </h2><br>  Additional piquancy of the next project verification is given by the fact that the Geant4 project, as I understand it, is regularly checked by the static Coverity analyzer.  This is evidenced by the multiple ReleaseNotes entries and comments in the code, like: <br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Private copy constructor and assigment operator - copying and // assignment not allowed. Keeps Coverity happy.</span></span></code> </pre> <br>  The Coverity analyzer is considered the market leader, so finding something after it is a good achievement.  Nevertheless, PVS-Studio found a lot of interesting mistakes, which says that it, too, has become a mature and powerful product. <br><br><h2>  Missed 'else' </h2><br><pre> <code class="cpp hljs">G4double G4EmBiasingManager::ApplySecondaryBiasing(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span> == nsplit) { .... } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span> == nsplit) { <span class="hljs-comment"><span class="hljs-comment">//&lt;- .... } else { .... } .... }</span></span></code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0265/">V646</a> Consider inspecting the application's logic.  It's possible that 'else' keyword is missing.  g4embiasingmanager.cc 299 <br><br>  This is one of the most common errors when working with checking several values ‚Äã‚Äãof a single variable using <i>if</i> .  Of course, this may simply be incorrect formatting, but in this example, the analyzer most likely indicates exactly the error. <br><br>  As a result of copying the code, the word else was forgotten.  What in this case will lead to the execution of extra code.  For example, the value will be zero and the code from the advising block will be executed, but due to an error, the code of the <i>else</i> block will also be executed after checking for equality to one.  To correct the error, add the missing <i>else</i> before the <i>if (1 == nsplit) condition</i> . <br><br><h2>  Incorrect handling of possible errors </h2><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> G4GenericPolycone::Create( .... ) { .... G4double rzArea = rz-&gt;Area(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rzArea &lt; -kCarTolerance) rz-&gt;ReverseOrder(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rzArea &lt; -kCarTolerance) <span class="hljs-comment"><span class="hljs-comment">//&lt;- { .... G4Exception("G4GenericPolycone::Create()", "GeomSolids0002", FatalErrorInArgument, message); } .... }</span></span></code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0106/">V517</a> The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 102, 105. g4genericpolycone.cc 102 <br><br>  I can only assume about the purpose of the code.  It is very likely that this fragment is responsible for intercepting and forming an error message, but as a result of an incorrect condition, an error message will not appear.  And it is not known how the program will behave later.  It is possible that the error will be intercepted by the handler elsewhere, or it may be that the program will continue to run without error and will produce an incorrect result.  It is quite difficult to say exactly what the error is, since it can be either in one of the conditional expressions or in the superfluous <i>else</i> .  But judging by the formatting, we can safely assume that both blocks of the conditions are correct and for correction it is enough to remove the <i>else</i> before the second conditional block. <br><br>  Thanks to copying the code, the same error was multiplied and found in three more places of the project: <ul><li>  V517 The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 193, 196. g4polycone.cc 193 </li><li>  V517 The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 219, 222. g4polyhedra.cc 219 </li><li>  V517 The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 207, 211. g4persistencycentermessenger.cc 207 </li></ul><br><h2>  Null pointer dereference </h2><br><pre> <code class="cpp hljs">G4double * theShells; G4double * theGammas; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> G4ParticleHPPhotonDist::InitAngular(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( theGammas != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( i = <span class="hljs-number"><span class="hljs-number">0</span></span> ; i &lt; nDiscrete ; i++ ) { vct_gammas_par.push_back( theGammas[ i ] ); vct_shells_par.push_back( theShells[ i ] ); .... } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( theGammas == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) theGammas = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> G4double[nDiscrete2]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( theShells == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) theShells = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> G4double[nDiscrete2]; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0205/">V595</a> The 'TheShells'  Check lines: 147, 156. g4particlehpphotondist.cc 147 <br><br>  Errors when working with pointers are found in programs quite often.  Here is the case when there is simultaneous work with two objects, and only one of them is checked for correctness.  Such an error may go unnoticed for a long time, but if the pointer to the <i>TheShells</i> object <i>turns</i> out to be zero, this will lead to undefined program behavior.  To correct the error, you need to change the condition as follows: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( theGammas != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> &amp;&amp; theShells != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) ....</code> </pre> <br>  Another fragment with no pointer check: <ul><li>  V595 The 'fCurrentProcess' pointer was used before it was verified against nullptr.  Check lines: 303, 307. g4steppingmanager2.cc 303 </li></ul><br><h2>  Using the null pointer </h2><br><pre> <code class="cpp hljs">G4hhElastic::G4hhElastic(....) : G4HadronElastic(<span class="hljs-string"><span class="hljs-string">"HadrHadrElastic"</span></span>) { .... fTarget = target; <span class="hljs-comment"><span class="hljs-comment">// later vmg fProjectile = projectile; .... fTarget = G4Proton::Proton(); // later vmg fProjectile = 0; //&lt;- fMassTarg = fTarget-&gt;GetPDGMass(); fMassProj = fProjectile-&gt;GetPDGMass(); //&lt;- .... }</span></span></code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0111/">V522</a> Dereferencing of the null pointer 'fProjectile' might take place.  g4hhelastic.cc 184 <br><br>  This fragment is similar to the previous one.  But here the pointer is explicitly assigned a zero value, and after the variable is used to initialize other variables.  Perhaps it was supposed to use the value of the variable from the first assignment, and then the second is just superfluous.  Perhaps you wanted to assign 0 to another variable.  The true reasons for this assignment are known only to the developers of the project.  In any case, such initialization is incorrect, and you should pay attention to such a code fragment. <br><br><h2>  Invalid bitwise operation </h2><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> dependentAxis 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> allowByRegion 2 static enum xDataTOM_interpolationFlag xDataTOM_interpolation_getFromString( .... ) { .... </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">( flag | allowByRegion ) {....} </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//&lt;- if( flag | dependentAxis ) {....} //&lt;- .... }</span></span></span></span></code> </pre> <ul><li>  <a href="http://www.viva64.com/ru/d/0234/">V617</a> Consider inspecting the condition.  The '2' argument of the '|'  bitwise operation contains a non-zero value.  xdatatom_interpolation.cc 85 </li><li>  <a href="http://www.viva64.com/ru/d/0234/">V617</a> Consider inspecting the condition.  The '1' argument of the '|'  bitwise operation contains a non-zero value.  xdatatom_interpolation.cc 88 </li></ul><br>  The analyzer issued a warning to immediately two adjacent lines of the function.  A bitwise OR occurs with a nonzero constant inside the condition.  The result of such an expression will always be a non-zero value, which leads to incorrect logic of the program.  Most often, such errors occur as a result of typos.  And in the condition, instead of bitwise OR, another bitwise operation should be used.  I can assume that in this case there was a bitwise I. meaning. The corrected code will look like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( flag &amp; allowByRegion ) {....} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( flag &amp; dependentAxis ) {....}</code> </pre> <h2>  Extra assignment </h2><br><pre> <code class="cpp hljs">G4ThreeVector G4GenericTrap::SurfaceNormal(....) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( noSurfaces == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { .... sumnorm=apprnorm; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( noSurfaces == <span class="hljs-number"><span class="hljs-number">1</span></span> ) { sumnorm = sumnorm; } <span class="hljs-comment"><span class="hljs-comment">//&lt;- else { sumnorm = sumnorm.unit(); } .... }</span></span></code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0168/">V570</a> The 'sumnorm' variable is assigned to itself.  g4generictrap.cc 515 <br><br>  In this fragment, a logical error is visible, which lies in the redundant branch of the condition.  One of the options that the programmer wanted to do: when checking for equality to one, the variable should have been assigned another variable, the name of which is similar to <i>sumnorm.</i>  But since there were no such variables in the checked part of the code, I would venture to suggest that this is just an extra check.  And to correct the error, I propose to simplify the condition as follows: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( noSurfaces == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { .... sumnorm=apprnorm; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( noSurfaces != <span class="hljs-number"><span class="hljs-number">1</span></span> ) { sumnorm = sumnorm.unit(); }</code> </pre> <br>  Another suspicious place. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> G4UImanager::StoreHistory(G4bool historySwitch,....) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(historySwitch) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(saveHistory) { historyFile.close(); } historyFile.open((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)fileName); saveHistory = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { historyFile.close(); saveHistory = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } saveHistory = historySwitch; }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0108/">V519</a> The 'saveHistory' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 541, 543. g4uimanager.cc 543 <br><br>  There is also a logical error.  The code inside the function, depending on the <i>historySwitch</i> value, changes the value of the <i>saveHistory</i> flag and performs an operation with the file, the result of which is reported by the flag.  But after performing all the operations, the <i>saveHistory</i> variable <i>is</i> simply assigned the value <i>historySwitch</i> .  This is a strange operation, since the value inside the condition has already been established, and we only spoil it.  Most likely, the last assignment is superfluous and must be deleted. <br><br>  A similar error exists elsewhere: <ul><li>  V519 The 'lvl' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 277, 283. g4iontable.cc 283 </li></ul><br><h2>  Multiple check of one expression </h2><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( (word0==<span class="hljs-string"><span class="hljs-string">"line_pattern"</span></span>) || (word0==<span class="hljs-string"><span class="hljs-string">"line_pattern"</span></span>) ) { .... } .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0090/">V501</a> There are identical sub-expressions' (word0 == "line_pattern")  operator.  style_parser 1172 <br><br>  Most often, this error occurs when checking the set of variables of the same type within a single condition and using the Copy-Paste method to generate it. <br><br>  The example contains a rather small code snippet, where the error is clearly visible.  In this case, it's just a typo and it is most likely caused by the copying of the code.  But this does not mean that it is easy to detect during a routine check.  This condition was taken from a long tree of various checks.  It is such constructions that helps to identify the analyzer and prevent errors when refactoring code. <br><br>  Even if this is not an error, the code still needs to be fixed so that a double check does not embarrass the person who will support this code. <br><br>  Similar fragments were found in other places of the project. <ul><li>  V501 There are identical to the left and the right of the | ||  operator: ITTU-&gt; size ()! = np ||  ITTU-&gt; size ()! = Np g4peneloperayleighmodel.cc 11563 </li><li>  V501 There are identical sub-expressions '(ptwXY1-&gt; interpolation == ptwXY_interpolationFlat)' to the left |  operator.  ptwxy_binaryoperators.cc 301 </li></ul><br><h2>  Inaccurate refactoring </h2><br><pre> <code class="cpp hljs">G4ReactionProduct * G4ParticleHPLabAngularEnergy::Sample(....) { .... <span class="hljs-comment"><span class="hljs-comment">//if ( it == 0 || it == nEnergies-1 ) if ( it == 0 ) { if(it==0) .... .... } .... }</span></span></code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0169/">V571</a> Recurring check.  The 'if (it == 0)' condition was already verified in line 123. g4particlehplabangularenergy.cc 125 <br><br>  Sometimes in the process of refactoring the code, not completely modified fragments remain.  It happened in the example.  The old condition was commented out, and the new one became exactly the same as an additional check inside.  To correct the error, it is necessary to better consider the corrections of the code block or simply remove the additional check inside the condition. <br><br>  Fragments with similar defects: <ul><li>  V571 Recurring check.  The 'if (proj_momentum&gt; = 10.)' condition was already verified in line 809. g4componentgghadronnucleusxsc.cc 815 </li><li>  V571 Recurring check.  The 'if (proj_momentum&gt; = 10.)' condition was already verified in line 869. g4componentgghadronnucleusxsc.cc 875 </li><li>  V571 Recurring check.  The 'if (proj_momentum&gt; = 10.)' condition was already verified in line 568. g4componentggnuclnuclxsc.cc 574 </li><li>  V571 Recurring check.  The 'if (proj_momentum&gt; = 10.)' condition was already verified in line 1868. g4nuclnucldiffuseelastic.cc 1875 </li></ul><br><h2>  Already checked expression </h2><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> GFlashHitMaker::make(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( gflashSensitive ) { gflashSensitive-&gt;Hit(&amp;theSpot); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (!gflashSensitive ) &amp;&amp; ( pSensitive ) &amp;&amp; (....) ){....} .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0153/">V560</a> A part of the conditional expression is always true: (! GflashSensitive).  gflashhitmaker.cc 102 <br><br>  In the above block, the condition in the <i>else</i> section is redundant.  The condition for entering the <i>else</i> block is, therefore, a false value for the variable <i>gflashSensitive</i> and it is not required to check it a second time. <br><br>  Another similar place: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UseWorkArea</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( T* newOffset )</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( offset &amp;&amp; offset!=newOffset ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( newOffset != offset ) {....} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {....} } .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0169/">V571</a> Recurring check.  The 'newOffset! = Offset' condition was already verified in line 154. g4geomsplitter.hh 156 <br><br>  The same variable is re-checked in the internal condition block.  This test will always produce a positive result, since it was a condition for entering the internal condition block.  And as a result, the code in the internal block <i>else</i> will never be executed. <br><br>  As a result of copying the code, this same extra check is present in other places of the project.  Oh, this Copy-Paste: <ul><li>  V571 Recurring check.  The 'newOffset! = Offset' condition was already verified in line 113. g4pdefsplitter.hh 115 </li><li>  V571 Recurring check.  The 'newOffset! = Offset' condition was already verified in line 141. g4vuplsplitter.hh 143 </li></ul><br><h2>  Useless condition </h2><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> G4XXXStoredViewer::DrawView() { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (kernelVisitWasNeeded) { DrawFromStore(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { DrawFromStore(); } .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0112/">V523</a> The 'then' statement is equivalent to the 'else' statement.  g4xxxstoredviewer.cc 85 <br><br>  The code inside the two branches of the condition is identical, which makes the condition itself useless, since the same code will be executed independently of it.  Similar messages from the analyzer can signal an unfinished code or typos when copying various constants or functions that are similar in name.  In this case, it is not known why this block was made, but it clearly needs to be improved. <br><br>  A similar fragment is found in another place of the project. <ul><li>  V523 The 'then' statement is equivalent to the 'else' statement.  g4xxxsgviewer.cc 84 </li></ul><br><h2>  Excess condition </h2><br><pre> <code class="cpp hljs">Void G4VTwistSurface::CurrentStatus::ResetfDone(....) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (validate == fLastValidate &amp;&amp; p &amp;&amp; *p == fLastp) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!v || (v &amp;&amp; *v == fLastv)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0375/">V728 Anonymous</a> check can be simplified.  The '||'  operator is surrounded by opposite expressions '! v' and 'v'.  g4vtwistsurface.cc 1198 <br><br>  This snippet is not an error.  But the condition can be simplified as follows: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!v || *v == fLastv) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br>  There are similar fragments in other places. <ul><li>  V728 Anonymous check can be simplified.  The '||'  operator is surrounded by opposite expressions '! a_cut' and 'a_cut'.  array 168 </li><li>  V728 Anonymous check can be simplified.  The '||'  operator is surrounded by opposite expressions '! a_cut' and 'a_cut'.  array 180 </li><li>  V728 Anonymous check can be simplified.  The '||'  operator is surrounded by opposite expressions '! a_cut' and 'a_cut'.  array 240 </li><li>  V728 Anonymous check can be simplified.  The '||'  operator is surrounded by opposite expressions '! a_cut' and 'a_cut'.  array 287 </li><li>  V728 Anonymous check can be simplified.  The '||'  operator is surrounded by opposite expressions 'p == 0' and 'p! = 0'.  g4emmodelactivator.cc 216 </li></ul><br><h2>  Invalid constructor call </h2><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">G4PhysicsModelCatalog</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: .... G4PhysicsModelCatalog(); .... <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> modelCatalog* catalog; .... }; G4PhysicsModelCatalog::G4PhysicsModelCatalog() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!catalog) { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> modelCatalog catal; catalog = &amp;catal; } } G4int G4PhysicsModelCatalog::Register(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> G4String&amp; name) { G4PhysicsModelCatalog(); .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0215/">V603</a> The object was not used.  If you wish to call the constructor, 'this-&gt; G4PhysicsModelCatalog :: G4PhysicsModelCatalog (....)' should be used.  g4physicsmodelcatalog.cc 51 <br><br>  Instead of referring to the current object, a new temporary object is created, which will be immediately destroyed.  As a result, the object fields will not be initialized.  When it is required to use field initialization outside the constructor, it is better to create a separate function for this and access it.  But if you want to call just the constructor, you must refer to the constructor using the word <i>this</i> .  If C ++ 11 is used, the most beautiful solution would be to use a delegating constructor.  Such errors and the way to correct them are discussed in more detail in this <a href="http://www.viva64.com/ru/b/0391/">book</a> (see Section 19 ‚ÄúHow to correctly call one constructor from another‚Äù). <br><br><h2>  Typo during initialization </h2><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> G4String name[numberOfMolecula] = { .... <span class="hljs-string"><span class="hljs-string">"(CH_3)_2S"</span></span>, <span class="hljs-string"><span class="hljs-string">"N_2O"</span></span>, <span class="hljs-string"><span class="hljs-string">"C_5H_10O"</span></span> <span class="hljs-string"><span class="hljs-string">"C_8H_6"</span></span>, <span class="hljs-string"><span class="hljs-string">"(CH_2)_N"</span></span>, .... };</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0273/">V653</a> A suspicious string of two parts is used for array initialization.  It is possible that a comma is missing.  Consider inspecting this literal: ‚ÄúC_5H_10O‚Äù ‚ÄúC_8H_6‚Äù.  g4hparametrisedlossmodel.cc 324 <br><br>  There is an error in initializing the array using constants.  As a result of typographical errors, a comma was omitted.  There are several troubles here: <ul><li>  There will be a concatenation of two string constants into one.  And we get as one of the formulas "C_5H_10OC_8H_6".  Unprecedented type of alcohol. </li><li>  Turning to an array by index, we can get the name of the wrong formula. </li><li>  And the last - it is possible to go beyond the border of the array. </li></ul><br><h2>  Forgotten throw </h2><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">G4HadronicException</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception {....} <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> G4CrossSectionDataStore::ActivateFastPath( ....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( requests.insert( { key , min_cutoff } ).second ) { .... G4HadronicException(__FILE__,__LINE__,msg.str()); } }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0206/">V596</a> The object was not used.  The 'throw' keyword could be missing: throw G4HadronicException (FOO);  g4crosssectiondatastore.cc 542 <br><br>  Most of the function code deals with generating a message to create an exception.  But because of a missing <i>throw</i> , an unused exception will be created.  And the program will continue to work, which can lead to indefinite program behavior or incorrect calculations. <br><br>  The error was repeated in other places of the project. <ul><li>  V596 The object was not used.  The 'throw' keyword could be missing: throw G4HadronicException (FOO);  g4generalphasespacedecay.hh 126 </li><li>  V596 The object was not used.  The 'throw' keyword could be missing: throw G4HadronicException (FOO);  g4particlehpthermalscattering.cc 515 </li><li>  V596 The object was not used.  The 'throw' keyword could be missing: throw G4HadronicException (FOO);  g4particlehpthermalscattering.cc 574 </li><li>  V596 The object was not used.  The 'throw' keyword could be missing: throw G4HadronicException (FOO);  g4particlehpthermalscattering.cc 585 </li><li>  V596 The object was not used.  The 'throw' keyword could be missing: throw G4HadronicException (FOO);  g4particlehpthermalscattering.cc 687 </li></ul><br><h2>  Output error </h2><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> G4GMocrenIO::storeData2() { .... ofile.write(<span class="hljs-string"><span class="hljs-string">"GRAPE "</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>); .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0291/">V666</a> Consider inspecting second argument of the function 'write'.  It is possible that it‚Äôs not passed on.  g4gmocrenio.cc 1351 <br><br>  This error is related to the discrepancy between the actual length of the line and the argument that specifies the length inside the function.  In this case, the error occurred due to the formation of a certain indent using spaces, and at first glance it is not visible how many of them there actually are.  Perhaps that is why this error has not been given due attention, and it has been in the project since the time of the first check.  This error was included in the <a href="http://www.viva64.com/ru/examples/v666/">database of examples for the diagnosis of V666</a> . <br><br><h2>  Conclusion </h2><br>  Probably, not all given errors are dangerous, but many seemingly minor errors may lead to more serious consequences in the future.  Therefore, projects need to be checked regularly in order to detect errors in the early stages before they lead to serious consequences.  The analyzer will help not only to find and fix the most intricate errors, but also to detect dangerous places in the project before they become errors.  I suggest to download and try the PVS-Studio analyzer in my project. </div><p>Source: <a href="https://habr.com/ru/post/304626/">https://habr.com/ru/post/304626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304616/index.html">A polynomial algorithm for a combinatorial problem (P = NP?)</a></li>
<li><a href="../304618/index.html">OctoberCMS Stable Release</a></li>
<li><a href="../304620/index.html">The digest of interesting materials for the mobile developer # 160 (June 27-July 3)</a></li>
<li><a href="../304622/index.html">Refactoring with Cleisley Composition</a></li>
<li><a href="../304624/index.html">The digest of interesting events from the world of Java, and around it # 5 (06/20/2016 - 07/03/2016)</a></li>
<li><a href="../304628/index.html">Everything you wanted to know about BPM, but were afraid to ask</a></li>
<li><a href="../304630/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ218 (July 27 - 3, 2016)</a></li>
<li><a href="../304632/index.html">Creation of the minimap on Unity</a></li>
<li><a href="../304634/index.html">HTML :: Phl module for processing HTML documents containing Perl code instructions</a></li>
<li><a href="../304636/index.html">How I changed the main domain in Google Apps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>