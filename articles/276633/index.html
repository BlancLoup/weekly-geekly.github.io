<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Compact OS for ARM processors</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúIt seems that perfection is achieved not when there is nothing more to add, but when there is nothing more to remove." 

 (Antoine de Saint-Exupery) ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Compact OS for ARM processors</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  ‚ÄúIt seems that perfection is achieved not when there is nothing more to add, but when there is nothing more to remove." <br><br>  (Antoine de Saint-Exupery) <br></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4dd/a8e/7ec/4dda8e7ec5fab50718ccb39397b5f4c6.jpg" alt="image" width="50%"></div><br><br>  On the topic of learning programming embedded systems, real-time OS, Assembler and C, let me introduce a very simple operating system StartOS. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Purpose: <br><br>  - if you need to create a device that starts working 1-2 seconds after power on and is able to respond to signals from the outside world within microseconds; <br>  - for quick creation of object management systems with data output to the Internet; <br>  - working out ideas, algorithms, making prototype devices; <br>  - gaining experience in programming embedded systems in the C and Assembler languages; <br>  - obtaining full access to the "hardware" of a computer device, for example, to develop self-modifying programs. <br><br>  Some properties of the system: <br><br>  Ready time after power on: &lt;1 s <br>  The amount of binary program code: &lt;40 kB <br><a name="habracut"></a><br>  The system occupies a small amount in the upper addresses of the RAM, providing the user with a standard program load in the lower addresses of the RAM.  The autostart of the user program is present, if the system detects the file START.BIN on the memory card, it starts automatically. <br><br>  The main functions of the system: <br><br>  Initialization of SoC (System on Chip, systems on a chip) and other external devices.  Loading user programs into memory and providing them with an interface to system functions: <br><br>  - work with LCD in text and graphic modes (text output, pixels, lines, BMP images, save / restore screen area ...); <br>  - input coordinates X, Y pen from the touch screen; <br>  - work with real time clock (RTC); <br>  - reading data from analog-to-digital converters (ADC); <br>  - reading data from digital ports; <br>  - read / write characters and lines in the COM port; <br>  - output to pulse-width modulators (PWM, PWM) and piezo-dynamics; <br>  - input-output packets of the Ethernet network using the built-in controller; <br>  - reading and writing files; <br>  - server-client for the Internet; <br>  - work with a video camera. <br><br>  The system is implemented on boards of Samsung or FriendlyARM developers with Samsung processors.  Full documentation is available on these processors and boards. <br><br>  So, a little more visual.  It is better to see once, so the link to the video: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Q2mjBy_Yor4%3Ffeature%3Doembed&amp;xid=25657,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgt8P1NXNMnETYz_bu3Mi2zm--xug" frameborder="0" allowfullscreen=""></iframe><br><br>  The system is a bit more complicated for ARM Cortex-A8: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/z9cYu7sYwV0%3Ffeature%3Doembed&amp;xid=25657,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgGoO-ws-jI0bgJsNkNbUULl1DItA" frameborder="0" allowfullscreen=""></iframe><br><br>  And, of course, the ‚ÄúHello, World!‚Äù Code (with the creeping line to the same): <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> txt [ ]={<span class="hljs-string"><span class="hljs-string">"Hello"</span></span>}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( i = <span class="hljs-number"><span class="hljs-number">134</span></span>; i &gt; <span class="hljs-number"><span class="hljs-number">8</span></span>; --i ) { <span class="hljs-comment"><span class="hljs-comment">// X Y String Print_String ( i, 150, "Hello, World!"); Print_String ( i, 170, txt); Delay (20); // Delay 20 mS } Exit (); // Exit to OS }</span></span></code> </pre> <br>  Same on the Assembler: <br><br><pre> <code class="cpp hljs">;    , Hello.s.     <span class="hljs-number"><span class="hljs-number">100</span></span>  (!) ;       StartOS.c _Exit EQU <span class="hljs-number"><span class="hljs-number">7</span></span> ; SysTrap _Exit _Delay EQU <span class="hljs-number"><span class="hljs-number">10</span></span> ; SysTrap _Delay _Print_String EQU <span class="hljs-number"><span class="hljs-number">122</span></span> ; SysTrap _Print_String PRESERVE8 ;   <span class="hljs-number"><span class="hljs-number">8</span></span>  AREA INIT, CODE, READONLY ; . ,   ENTRY ;    ;______     __________ LDR r0, =<span class="hljs-number"><span class="hljs-number">0x33ffff08</span></span> ;    LDR r1, [r0,#<span class="hljs-number"><span class="hljs-number">0xE8</span></span>] ; STR r1, [r0] ; ;    ,  . <span class="hljs-number"><span class="hljs-number">4</span></span>  ; MRS r0,cpsr ; BIC r0,r0,#<span class="hljs-number"><span class="hljs-number">0xDF</span></span> ; ORR r1,r0,#<span class="hljs-number"><span class="hljs-number">0x13</span></span> ; MSR cpsr_cxsf,r1 ;___     ;   ... ; -           ;----   LDR r2, text1 ;    <span class="hljs-number"><span class="hljs-number">1</span></span>   r2 MOV r1,#<span class="hljs-number"><span class="hljs-number">30</span></span> ;  Y     r1 MOV r0,#<span class="hljs-number"><span class="hljs-number">25</span></span> ;  X    r0 SWI _Print_String ;   (Print_String(<span class="hljs-number"><span class="hljs-number">25</span></span>,<span class="hljs-number"><span class="hljs-number">30</span></span>,text1)) ;----   ---- ADR r2, text2 ;    text <span class="hljs-number"><span class="hljs-number">2</span></span>  r2 MOV r1,#<span class="hljs-number"><span class="hljs-number">70</span></span> ; Y  r1 MOV r0,#<span class="hljs-number"><span class="hljs-number">25</span></span> ; X r0 SWI _Print_String ;  (Print_String(<span class="hljs-number"><span class="hljs-number">25</span></span>,<span class="hljs-number"><span class="hljs-number">70</span></span>,<span class="hljs-string"><span class="hljs-string">"Hello, ARM Assembler!"</span></span>)) LDR r0, millis ;      <span class="hljs-number"><span class="hljs-number">5000</span></span>  r0 ;     (, <span class="hljs-number"><span class="hljs-number">500</span></span>ms)  : MOV r0,#<span class="hljs-number"><span class="hljs-number">500</span></span> SWI _Delay ;  (Delay <span class="hljs-number"><span class="hljs-number">5</span></span>s) SWI _Exit ;      ,    text1 DCD txt ;   <span class="hljs-string"><span class="hljs-string">"Hello"</span></span> text2 DCB <span class="hljs-string"><span class="hljs-string">"Hello, ARM Assembler!"</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span> ;      DCB <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span> ;    <span class="hljs-number"><span class="hljs-number">32</span></span>-  (*<span class="hljs-number"><span class="hljs-number">4</span></span> ) millis DCD <span class="hljs-number"><span class="hljs-number">5000</span></span> ;  <span class="hljs-number"><span class="hljs-number">5000</span></span>   <span class="hljs-number"><span class="hljs-number">5</span></span>  DCB <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span> ;  txt DCB <span class="hljs-string"><span class="hljs-string">"Hello"</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span> ;   H, e, l, l, o  <span class="hljs-number"><span class="hljs-number">0</span></span> END ;   - !</code> </pre><br>  The background to the creation of the system is as follows.  The author is aware that writing "home" operating systems is a very responsible, risky business (and doesn‚Äôt promise the creators anything but criticism).  But as they say, life made.  So how did this happen? <br><br>  It was like this: a board was found for the developers of FriendlyARM Mini2440, very cheap and with a large selection of peripherals.  After using Atmel AVR controllers in the applicator of self-adhesive labels, I wanted to continue the development of the latter. <br><br>  At that time (2010), the Mini2440 cost $ 80, about 2,400 rubles, which was comparable to the cost of the sensors in the applicator.  The Mini2440 was demonstrated to the head of one company, who approved its application and assured that ‚Äúif we succeed in programming it, we will make orders‚Äù.  Success in programming meant using the device in real time, when signals from the sensors are processed in microseconds, and did not take long to wait.  After 2 months, the program, which was wired into NAND, successfully controlled the stepper motor and was loaded 1 second after power up.  But here, as it happens, the manager had already fallen into a stupor and just stopped.  While he was silent, time passed, and the author decided to use the moment for some development. <br><br>  In order not to insert the initialization code into the project each time, it was decided to do this once and for all, and load the application programs into the memory from the SD card directly into the memory and run from there. <br><br>  There is an approach, for example, in ARM7 STM32 controllers, when a user program is compiled along with a proprietary library for working with external devices.  In this case, the company does not disclose its proprietary source code, the user program calls the proprietary subroutines at the addresses in memory. <br><br>  At the same time, the author knew the "insides" of the operating systems, such as DEC's RT-11, we used on Electronics-60, DVK-2 ... 4 and others.  Were well studied BIOS IBM PC AT, MS DOS, Palm OS.  All of these systems used the classic approach - the use of software interrupts.  That is, the OS is located in the upper memory addresses, and the user program is from the beginning of the memory and called the operating system subroutines, passing the number of the program interrupt in the command that actually causes the interrupt. <br><br>  Thus, in the developed system, the program interrupt mechanism is applied via the SWI command (SVC).  The system code is located at the top addresses, and user programs are loaded directly to the beginning of the memory and run.  We will not compare with existing systems, suffice it to say that the system turned out with the minimum volume, the maximum possible speed and "hard" real time.  We can always know very precisely at what point in time which team is running and what is happening. <br><br>  The name of the system was conceived as an entry-level system, starting.  After Google search, the choice fell on StartOS and this name was registered (sadly, some time later, a Linux clone on some part of the planet was also renamed StartOS). <br><br>  At the request of users, a TCP IP Stack was added to the system and the Server and Client were made.  And added a program to work with a video camera.  By the way, after powering on the board, after two seconds a picture from the camera appears on the screen. <br><br>  Examples of programs are presented to work with almost all external devices mounted on the board.  You can create programs in ADS1.2 (Metrowerks CodeWarrior), IAR, Keil, and others. <br><br>  Documentation, examples and more can be found <a href="http://code.google.com/p/startos">here</a> and <a href="http://www.physicalcomputing.ru/">here</a> . <br><br>  Since the FriendlyARM Mini2440 developer board is already outdated (although it is suitable for many projects), the author has ported the system to a more modern Mini210s board.  By the way, many users used StartOS on Samsung boards and successfully. <br><br>  Regards to the community <br>  Anatoly Poplemenov, engineer <br><br>  PS: I ask you to take real-time systems seriously, for example, if the system controlling the train hangs, the watchdog will work, it will restart and will work again after 1 second.  Not for nothing, the rover Curiosity plows the expanses of Mars under the control of the RT system uCOS company Micrium. </div><p>Source: <a href="https://habr.com/ru/post/276633/">https://habr.com/ru/post/276633/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276619/index.html">Analysis of Android Malvari Matryoshka</a></li>
<li><a href="../276621/index.html">Mitap SPB .NET Community # 9</a></li>
<li><a href="../276623/index.html">Through a filtering proxy using a script in the name of the moon</a></li>
<li><a href="../276629/index.html">Security Week 05: difficult numbers in socat, Virustotal checks the BIOS for bookmarks, the secret life of WiFi modules</a></li>
<li><a href="../276631/index.html">Game Designer Skills</a></li>
<li><a href="../276635/index.html">Building a glass of quotes (FullOrderBook) based on historical data</a></li>
<li><a href="../276637/index.html">We start and we emulate Windows on Raspberry Pi by means of QEMU</a></li>
<li><a href="../276641/index.html">nopCommerce CMS on ASP.NET MVC: review of the functionality of the new version</a></li>
<li><a href="../276643/index.html">Controller for T-SDN</a></li>
<li><a href="../276645/index.html">Improving education in universities on information security / IT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>