<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Java Performance Conversations</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Every year at the JPoint, experts deliver hardcore Java performance reports. And it has never been boring - the question remains relevant for many yea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Java Performance Conversations</h1><div class="post__text post__text-html js-mediator-article">  Every year at the <a href="http://javapoint.ru/">JPoint,</a> experts deliver hardcore Java performance reports.  And it has never been boring - the question remains relevant for many years.  About where the legs of myths grow from, what the JVM does, how to measure performance, what‚Äôs the business requirements of the customer, and how to get around the rake, we talked to experts for whom Java performance is not a problem, but work. <br><img src="https://habrastorage.org/files/517/09c/744/51709c7445304c37baa6a111219343e9.png"><br><a name="habracut"></a><br><h2>  Java Performance and all-powerful JVM </h2><br><img src="https://habrastorage.org/files/670/57a/800/67057a800ed2417a85a31c3d9bd9ebc5.png" height="200" align="left">  What happens on the Java Virtual Machine (JVM) side, how does it affect performance?  About this and a little about Java performance in general, we talked with JVM Engineer at SAP <b>Volker Simonis</b> .  Volker answered questions in English, here we publish the translation. <br><br>  <i>- Why say that Java is slow and performance problems are critical?</i> <br><br>  - I think that the perception of Java as something slow is in the past.  Currently, Java virtual machines have really cool JIT compilers and garbage collection algorithms that provide very good performance for regular applications.  Of course, you can always find examples where Java is slower than native C / C ++ applications.  But systems such as Hadoop, Neo4j, or H20 are examples of the fact that even large, complex, high-loaded applications can be written in Java.  That is, Java performance is very high and, as a Java technology, is highly competitive. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In my experience, people today complain more about the performance of "alternative" languages ‚Äã‚Äãfor JVMs, such as Ruby (JRuby), Clojure, or Scala.  I think the JVM can optimize them as well as pure Java code.  It is only a matter of time. <br><br>  <i><b>-</b> <b>How to evaluate and measure Java performance?</b></i> <br><br>  ‚ÄúMeasuring Java performance is real science.  There is nothing surprising in the fact that companies such as Oracle, Google, Twitter or Odnoklassniki have dedicated performance teams consisting of very experienced and qualified employees. <br>  The familiar approaches to profiling Java application performance are likely to always fail. <br><br>  Currently, <a href="http://openjdk.java.net/projects/code-tools/jmh/">Java Microbenchmark Harness</a> or, for short, JMH Alexei Shipilev (note through ‚Äú‚Äù, he insists on this, at least in Russian-language publications), which is part of OpenJDK, has established itself as a standard for measuring and analyzing performance small and medium java applications.  The complexity and ingenuity of the JMH implementation will give you an idea of ‚Äã‚Äãwhat JMH does to accurately measure the performance of a Java application.  His blog at <a href="http://shipilev.net/">http://shipilev.net/</a> is an indispensable source of information on performance and optimization of Java. <br><br>  And while JMH is mainly responsible for measuring and optimizing the performance of Java code, the problem of improving GC performance continues to exist.  And this is another story that requires its own, different set of tools and expertise. <br><br>  <i><b>- Where are the most frequent performance problems?</b></i> <br><br>  ‚ÄúThis, of course, largely depends on the type of your Java application.‚Äù  If we are talking about data-bound applications (that is, if you are running simple code on huge data), it is probably more important to choose and configure your GC algorithm correctly.  And even in this case, you first have to choose, whether you want to optimize the application for maximum throughput, or you consider the application latency to be more important. <br><br>  On the other hand, if your application is computationally dependent, you can use tools like JMH and / or native profilers to verify that the virtual machine really fully embeds and optimizes all the loaded executable branches. <br>  For tightly parallel applications, it is better to choose the correct synchronization / blocking policy (which may vary depending on the hardware / platform on which your application is running) and for input / output related applications, it is important to choose the right abstraction (i.e., blocking vs non-blocking) and API . <br><br>  But the main golden rule: most efforts should be directed to the correctness of your algorithms, because no virtual machine can ever turn badly written code into a high-performance program.  Fine-tuning and fine tuning at the JVM level, as explained above, should always be just the last step of the development cycle. <br><br>  <i><b>- You are a JVM expert.</b></i>  <i><b>How often does a JVM cause poor performance?</b></i>  <i><b>What are the main problems and how to deal with them?</b></i> <br><br>  ‚ÄúIdeally, after a certain number of iterations, a Java application should reach a state in which JIT compiled code runs at least 95% of the time.  In this case, there are regular, but rather short GC-pauses.  This can be easily verified using tools such as JConsole, JITwatch or Flight Recorder.  If this is not the case, then you need to find out which part of the virtual machine is causing the problem and zatyunit (or optimize) the corresponding component of the VM. <br><br>  You may know that the HotSpot JVM product version offers about 600 so-called advanced options (these are options that start with -XX), and the debug build includes more than 1200 such options (you can use the key for a complete list). -XX: + PrintFlagsFinal).  With these options, you can get detailed information about what is happening inside the virtual machine.  But the most important thing is that these options can be used to fine-tune almost any subsystem of a virtual machine.  The bad news is that these options are not well documented, so you will probably have to look at the sources to understand what is really going on. <br><br>  Some problems with garbage collection can be solved by choosing the right Garbage Collector (in the current version of HotSpot there are full of them) and the correct configuration of the heap.  Performance problems in generated code are often caused by the wrong choice of what needs to be inline.  Again, this affects to a certain extent, but, alas, this is a very difficult topic and it is difficult to achieve improvement in one part of the code without compromising the performance of other parts. <br><br>  Locks, thread waiting, and various cache effects are another source of frequent problems.  But to solve them requires a deep knowledge of the virtual machine, as well as knowledge of the insides of the hardware platform and operating system. <br><br>  Finally, I want to note that lately we have increasingly seen problems with the work of Java <i>in virtual environments</i> .  The JVM performs a large number of ‚Äúself-configurations‚Äù at startup in order to optimally adapt to the environment.  But if the information on real resources (such as the number of CPUs or the amount of available memory) does not correspond to what the JVM received, this can lead to very poor performance. <br><br>  For example, if the operating system reports a large number of available logical CPUs, the virtual machine will create multiple threads for garbage collection and for JIT.  But if the host operating system distributes these threads to a very small number of physical CPUs, then the user threads of the Java application can be completely superseded by the system threads of the virtual machine.  A similar problem arises if the guest operating system allocates a large amount of memory for some JVM, but this memory is fumbled (shared) between other guest OSs. <br><br>  <i><b>- How are the memory management algorithms implemented in the JVM, what is being done to ensure that developers get less performance problems?</b></i> <br><br>  ‚ÄúIn fact, the HotSpot virtual machine uses different memory management systems and strategies.  The biggest and probably most known for a regular Java programmer is, of course, heap, plus the heap-based garbage collection algorithms that work on it. <br><br>  However, the JVM still works with many other memory pools.  There is a metaspace that stores the loaded classes and the cache for storing the code generated by the virtual machine (the most probably well-known type of code is methods compiled by JIT, as well as generated interpreter chunks and various code stubs). <br>  Finally, various virtual machine subsystems, such as the GC or JIT compiler, may for some time require a substantial part of the native memory in order to do their work.  This memory is usually allocated on the fly and is maintained in different segments, resource zones or subsystem caches.  For example, JIT compilation of a large method may temporarily require more gigabytes of native memory.  All these memory pools can be customized to the requirements of a particular application. <br><br>  <i><b>- Please tell an interesting story from your practice when there was a Java performance problem.</b></i>  <i><b>How was it resolved?</b></i> <br><br>  ‚ÄúOur SAP JVM runs on many different platforms, including HP-UX on PARISC and Itanium CPUs.  HP-UX on Itanium provides software emulation for PARISC binary files, making it possible to run PARISC applications easily and transparently.  True, an order of magnitude slower than native applications. <br><br>  After we received too many customer complaints about the very poor performance of our JVM on HP-UX / Itanium, we began to figure out what was wrong.  It turned out that clients used PARISC binaries to run on HP-UX / Itanium.  Since we couldn‚Äôt explain the complexity of emulation to each client, we simply added a check to the next version of our JVM, which prohibits the execution of code for PARISC in the mode of program emulation. <br><br><h2>  Java Performance for Enterprise </h2><br><img src="https://habrastorage.org/files/87c/b0b/570/87cb0b5706c9400392a5f9fed126efd8.png" height="200" align="left">  Agree, an unpleasant moment when the application came out in production and returned with the indignant remarks of the client about the braking and freezing.  Java performance issues are critical primarily for Enterprise solutions.  That is why for hardcore practical advice we went to the expert, Performance Architect at NetCracker (telecom solutions company), <b>Vladimir Sitnikov</b> . <br><br>  ‚ÄúWe can hear about possible performance problems in Java in both training and professional environments.  In every joke there is a joke share.  Part of the slowness of Java is a myth, especially since the performance of the platform changes with time, and what caused criticism 10 years ago now works completely differently.  To talk about Java performance at the level ‚Äúslows down - does not slow down‚Äù imprudently. <br><br>  In practice, the main problems in industrial applications are associated with the presence of unnecessary code, when actions are performed more than is necessary to solve the problem.  Somewhere the developer has become too smart, and somewhere the business requirements are so complicated that you can‚Äôt write quickly the first time.  Sometimes there is enough iron performance, and sometimes the solution is slower than expected.  The main recommendation here is one - do not execute unnecessary code, or at least part of it. <br><br>  Another reason for the decline in performance lies in the algorithms;  when, for example, they use brute force instead of finding a record by an algorithmic attribute.  But in practice, ingenious (smarter than HashMap) data structures are rarely used to improve performance. <br><br>  May have an impact on performance and third-party development tools, such as libraries and frameworks.  In practice, problems can occur at all levels - and they happen.  Developers usually identify them on tests, they are analyzed using different profiling techniques (at the browser level, application server, database).  Problems with third-party code occur frequently, and the only way to catch them is to take measurements and carefully monitor the development of this third-party code.  In my practice, no month, then a godsend.  <i>It happens, the replacement of <a href="https://github.com/pgjdbc/pgjdbc/pull/380">one line of code</a> speeds up the insertion of data into the database 10 times.</i> <br><br>  In general, the main thing in measuring and working with Java performance is not to forget about load testing.  Accordingly, the business requirements for enterprise development are so great, and so huge are the tests that check them and help them to notice unpleasant issues related to performance.  For example, it must be taken into account that the load in the corporate environment is uneven: in the morning everyone came, logged in, the peak load, then the lunchtime went down, the load was the smallest at lunchtime, and after lunch the users increased the load to high values ‚Äã‚Äãwith a new power.  Of course, in the first analysis such nuances may be missed.  And in fact, they can have a very strong effect on where to expect a massive load and how to write code to avoid performance problems. <br><br>  You ask me about the most common mistakes and rakes.  Everyone has their own.  For example, the choice of a particular processor or memory model rarely changes.  Of course, if samples of 2006 and 2016 are compared, then the model matters.  Many questions lie in the plane of scalability.  Many are in search of the holy grail of enterprise development: everyone wants, after making a single measurement, to predict how many servers are needed and how much power is needed to deploy the application.  Here the only way out is to test on a live server, take into account the resources for fault tolerance. <br><br>  In general, probably, there is a universal optimization tool - the inevitability of testing.  We have specialists in load testing and analysis of results, but the main effect is achieved when the developer himself is responsible for the speed of the code.  Performance is not something that can be taken and added after the fact.  It‚Äôs hard to predict where the problem will be. It‚Äôs not enough to suspect every line of the source code.  A common problem is that the test was conducted either wrong, or on the wrong amount of data, or on the wrong load and configuration.  For example, when testing the library was not updated, and the customer took and updated - consider, the problem is missed. <br><br>  In my memory there were projects that tried to get around the performance issue, but they were either small demo projects or those that returned very quickly with complaints from customers about the slow operation of the application. <br><br>  Often, not a single global error, but a combination of two or three problems, each of which, at first glance, does not pose a threat, leads to a decrease in performance or a fall in the entire application.  And the worst thing is that the developer may not know about the problems that have arisen in his code.  If the problem can be solved by technical support engineers, they rarely seek the author of the code in order to ‚Äúreward‚Äù him. <br><br>  By the way, about the complaints.  If the customer is indignant, to understand where to look for the problem, there is a simple algorithm.  You need to ask the customer‚Äôs representative how it should be.  If everything works out slowly and it seems to you that it is a matter of subjective sensations, specify how long it should work.  Such requirements, of course, are also best collected in advance (during development, or before it starts).  We split the requirements by component: for example, if the user wants the page to open in 5 seconds, we allocate the budget to the browser - 1 s, to the server part - 3.5 s, the network - 0.5 s, and so on.  Often, the breakdown goes right down to the components of the system itself, which, by the way, log the runtime, and the developers, by opening the profiler, can check if their code fits within the acceptable limits. <br><br>  So, there are problems.  Where to look, where do legs grow from? <br><br><ul><li>  Look at the CPU load and the contents of the GC logs.  If the system is loaded, and at the same time the load is caused by the operation of the GC, then either there is little memory (you need to increase -Xmx), or "someone eats too much." <br><br></li><li>  By itself, a 50‚Äì100% load is already indicative of the fact that response times can be the most inconceivable. <br><br></li><li>  Sometimes, the fault lies with third-party applications.  A harmless update can bring a pack of brakes "as a gift."  A canonical example is the story of RedHat Linux: the huge pages mechanism causes performance problems.  This is a ‚Äúfeature‚Äù of Red Hat Linux, due to which ‚Äúsuddenly‚Äù both java-applications and databases start to slow down.  The problem is subject to Red Hat Linux 6+ (CentOS 6+).  Under the <a href="https://blogs.oracle.com/linux/entry/performance_issues_with_transparent_huge">link</a> <a href="">you can</a> read more.  THP mode must be disabled.  If such adjustment of hardware and programs is performed manually, then the human factor is not excluded, and as a result - brakes. <br><br></li><li>  To ask classic questions ‚Äúdid it work before‚Äù and ‚Äúwhat changed‚Äù.  Ask what was done on the client side, whether updates were rolled into the system components.  If rolled - the search vector becomes clearer.  If there is no clarity, the memory is free, then we look into the profiler what activity takes up the resources.  Well, then everyone has their own story with their own code. <br></li></ul><br>  Now let's look at the problem of performance closer to real conditions, to the client.  Often the application behaves completely unexpectedly in production, although on tests everything was perfect.  And there is an explanation.  If the situation is reproduced only at the client, then this may indicate a problem with the original data.  For example, we know that an application has to perform operations with 1,000,000 clients.  We generate 1'000'000 random names and surnames, the tests pass well, the search for the client's full name flies.  We leave in production - users are indignant.  We take a closer look at the problem search - and it turns out that Ivanov Ivanov Ivanovich is a thousand.  If the load tests do not take into account such a number of repetitions, then it is not surprising that in the tests a couple of the found lines are displayed instantly, and in the search operation it works through time. <br><br>  Generate the correct data set for tests - the whole science.  It is necessary to create not just meaningful, say, 100 GB of data, but also to take into account the interaction between the data - it should be as similar as possible to what will be in operation. <br><br><ul><li>  The ideal case is the presence of a client base dump.  It can be used directly or pre-encrypted.  Moreover, encryption should take into account the existing relationships and links between objects and ensure data security at the same time.  <i>For example, simply replacing all values ‚Äã‚Äãwith MD5 is not safe enough.</i>  <i>Even a Google search on MD5 can find the ‚Äúoriginal‚Äù value.</i>  <i>It is more correct to use HMAC so that, on the one hand, identical data is hashed into identical hashes, but decryption will not be possible.</i> <br><br></li><li>  It also happens that there is no dump.  In this case, the parameters of the future system are studied and scripts are written that generate test data based on these parameters.  At the same time, it is necessary to avoid even distributions, because, in reality, it is rare when distributions are even. <br></li></ul><br>  What else can you say about Java performance for an enterprise?  Collect non-functional customer requirements: a breakdown of the work scenarios, the frequency of user interactions with a particular application module, the number of users and the expected time of work.  Correcting performance problems in the later stages can be very expensive, and an extra second while the call center operator is waiting leads to serious losses. ‚Äù <br><br><hr><br>  If you have any questions about the statements of experts or you want to tell us about your position on Java performance, welcome to <s>comments</s> at the <a href="http://javapoint.ru/">JPoint 2016</a> conference on April 22-23.  All will be there! </div><p>Source: <a href="https://habr.com/ru/post/280420/">https://habr.com/ru/post/280420/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280408/index.html">Microsoft fixed multiple bugs in the system components of Windows 8.1 and Server 2012</a></li>
<li><a href="../280410/index.html">Testing in F #</a></li>
<li><a href="../280412/index.html">Visualizing data processing tools with Github</a></li>
<li><a href="../280414/index.html">Microsoft Connect webinars: partnership opportunities with Microsoft</a></li>
<li><a href="../280416/index.html">IBM and Hilton have developed a robot-concierge based on the cognitive system Watson</a></li>
<li><a href="../280422/index.html">Apple Pay will be available on mobile websites, and will also be fully launched in Russia by the end of this year.</a></li>
<li><a href="../280426/index.html">Python programming - a course for those who want to learn more about it or learn another programming language</a></li>
<li><a href="../280428/index.html">The benefits of the OpenStack cloud concept and its difference from traditional architecture</a></li>
<li><a href="../280434/index.html">Palantir and money laundering</a></li>
<li><a href="../280436/index.html">IB start-up Palantir helps Credit Suisse investment bank create a system for identifying unscrupulous traders</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>