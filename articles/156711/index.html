<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interception of HTTPS traffic between an Android device and an external server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes it is curious to see that various Android applications are being sent back and forth via HTTP and HTTPS protocols. Sometimes, even when deve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interception of HTTPS traffic between an Android device and an external server</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/eab/f81/f07/eabf81f07022334db8d0f2b9ca9e08e1.png"><br>  Sometimes it is curious to see that various Android applications are being sent back and forth via HTTP and HTTPS protocols.  Sometimes, even when developing your own software, it is convenient to see all traffic in real time.  To accomplish these tasks, many good programs have long been invented, such as, for example, <a href="http%253A%252F%252Fwww.charlesproxy.com%252F%26ei%3D0qGPUPbVMYvR4QTik4C4AQ%26usg%3DAFQjCNG_O70VsRrfb_q7F66Nkb9ZK6MNMA">Charles</a> or <a href="http%253A%252F%252Fwww.fiddler2.com%252F%26ei%3D5KGPUJz-C4aG4gTFsYDoBw%26usg%3DAFQjCNGyVxcKeoiBFf3LsfsM8apoKVxKLQ">Fiddler2</a> .  In fact, there are many more of them, only the two above give the opportunity to view not only HTTP, but also HTTPS. <br><br>  Difficulties begin when it comes to intercepting traffic between an Android device and an external server.  In the case of unencrypted (HTTP-protocol) traffic, everything is very trivial (here is the <a href="http-proxy-tool/">instruction</a> ) - we allow Fiddler2 external connections, in Android we set the proxy server address of our machine with Fiddler2 - and voila, everything works.  But it took me a little longer to set up HTTPS traffic interception. <br><a name="habracut"></a><br><h4>  Theory </h4><br>  So what is the difficulty?  The fact that when using the HTTPS protocol, the client by default checks whether the server to which it is connected is really necessary.  For this purpose certificates are used.  And now, at the real server, this certificate, of course, is also real and corresponds to the open URL, but our proxy does not.  To solve this problem in desktop operating systems in such cases it is possible to generate a fake certificate into Fiddler2, import it into trusted ones - and now the client will always believe that the connection with Fiddler2 is completely safe.  Unfortunately, with a mobile device such a light earmuffs did not pass. <br><br>  First, there is no possibility to import an external certificate in Android versions younger than 4.0.  There are some non-trustworthy options with rutted devices - but this is not our way. <br>  Secondly, even Android version 4.0 cannot import the Fiddler2 certificate.  The fact is that the certificate generated by default does not meet any kind of Android security criteria and is not installed.  It needs to be generated in a special way. <br>  Thirdly, it‚Äôs not even the fact that all programs in a row will immediately trust a fake certificate.  There are nuances. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Practice </h4><br><ol><li>  We take the device with Android version 4.0 or higher.  No, a device with 2.3 will not work.  Yes, emulator version 4.0 will work. </li><li>  Install the latest version of <a href="http://www.fiddler2.com/fiddler2/version.asp">Fiddler2</a> on your computer. </li><li>  We install special libraries generating Android-compatible security certificate <a href="">from here</a> . </li><li>  We export the security certificate from Fiddler2 (‚ÄúTools-&gt; Fiddler Options-&gt; HTTPS-&gt; Export root certificate to Desktop‚Äù).  We put on the flash drive, in the root (well, or on the emulator, if you use it). </li><li>  On Android, we add a security certificate to the trusted ones (‚ÄúSettings&gt; Security&gt; Install from SD card‚Äù) <br><img src="https://habrastorage.org/storage2/9a4/1e5/8d6/9a41e58d6357bcbaf2e08eb72b507a6f.png"><br><br></li><li>  We start Fiddler2, we allow external connections in settings <br><img src="https://habrastorage.org/storage2/7d8/091/1e3/7d80911e35aab73b48cdf4c76d98aced.png">  . <br><br></li><li>  On Android, in the settings of the network, we register the address of our desktop machine with Fiddler2 as a proxy. <br><img src="https://habrastorage.org/storage2/b6a/8a7/50c/b6a8a750ce4a2db529105f427e8d158c.png"><br><br></li><li>  On Android, open the browser, enter <a href="https://google.com/">google.com</a> - and see the request with the answer in the Fiddler2 window. <br></li></ol><br><img src="https://habrastorage.org/storage2/3fb/d7c/f5b/3fbd7cf5bc222a6e22ebd4859525239a.png"><br><br>  So, with the browser turned out.  Unfortunately, not all programs are as trusting as the browser.  For example, in my own software, where I use the <a href="httpclient-3.x/">Apache HTTP Client</a> , the method did not work - the <a href="httpclient-3.x/">Apache client</a> spat on trusted OS certificates.  In this case, I had to disable this check manually, in this way: <br><br><pre><code class="java hljs">Protocol.registerProtocol(<span class="hljs-string"><span class="hljs-string">"https"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Protocol(<span class="hljs-string"><span class="hljs-string">"https"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EasySSLProtocolSocketFactory(), <span class="hljs-number"><span class="hljs-number">443</span></span>));</code> </pre> <br><br>  where <i>EasySSLProtocolSocketFactory is</i> taken <a href="httpclient/contrib/ssl/EasySSLProtocolSocketFactory.html">from here</a> and allows trust to any certificates. <br>  <b>Not safe, just for debugging!</b> <br><br>  After that, the traffic of my program was also successfully displayed in Fiddler2. </div><p>Source: <a href="https://habr.com/ru/post/156711/">https://habr.com/ru/post/156711/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../156697/index.html">Problems of remote work at home and their solutions</a></li>
<li><a href="../156699/index.html">About how we came up with a live online translator Nitro and did</a></li>
<li><a href="../156705/index.html">Review of the Bluetooth speakerphone Parrot MINIKIT Neo: talk "without hands" in the car</a></li>
<li><a href="../156707/index.html">How to gather developers together: Mobile Developer Day. Interview with Misha Denisov and Yulya Basyrova</a></li>
<li><a href="../156709/index.html">How to create a working landing pages</a></li>
<li><a href="../156715/index.html">Windows Azure: Queues and Service Bus Queues - Similarities and Differences</a></li>
<li><a href="../156717/index.html">Big: Sony Xperia ion review</a></li>
<li><a href="../156719/index.html">I will give the project in good hands</a></li>
<li><a href="../156723/index.html">What book to read to make reports better?</a></li>
<li><a href="../156725/index.html">Accelerator or business incubator?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>