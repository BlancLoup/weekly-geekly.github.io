<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Let's beat Ruby together! Drop thirteen</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we will get acquainted with such a powerful and useful Ruby tool and RoR component, like Active Record. As part of RoR, we know Active Record fr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Let's beat Ruby together! Drop thirteen</h1><div class="post__text post__text-html js-mediator-article"> Today we will get acquainted with such a powerful and useful Ruby tool and RoR component, like Active Record.  As part of RoR, we know Active Record from the <a href="http://habrahabr.ru/blogs/starting_programming/49700/">first step of</a> articles on rails (something this series didn‚Äôt go very well, really).  Consider the practical use of the component in Ruby, which is very useful in RoR. <br><br>  Active Record adheres to the principles of <a href="http://ru.wikipedia.org/wiki/ORM">ORM</a> : databases can be represented as object-oriented code, where tables are classes, rows of a table are objects, and fields are object attributes.  However, Active Record differs from other ORM libraries, for example, from <code>Hibernate</code> from <code>Java</code> , in that there is no need for an initial configuration - everything works out of the box.  Active Record is written in pure Ruby, which allows us to work with it as with a normal class: use inheritance, rewrite methods, use metaprogramming, etc. Yes, object attributes are mostly filled with SQL queries and the attributes are also written back to the table.  But all that happens between these two processes is the usual work with the Ruby object.  It is necessary to understand the "separate" existence of database records and Ruby objects: sometimes the database will be different from the Ruby class. <br><a name="habracut"></a><br>  When you create a new record in the database, update an existing one or simply read the data, everything goes in three steps: creating an Active Record object, accessing and manipulating the object's attributes, and saving the attributes as records in the database. <br><br><h4>  Installing Active Record </h4><br>  As usual in Ruby, installation is a trifling matter; it is enough to install the necessary jam: <code>gem install activerecord</code> .  Connecting to the database occurs with the help of adapters, most of which are already embedded ( <code>DB2, Firebird, FrontBase, MySQL, Open-Base, Oracle, PostgreSQL, SQLite, SQL Server</code> and <code>Sybase</code> ), you only need to transfer the connection parameters to the database.  You should also make sure that you have installed / running a database server and installed the necessary jam ( <code>mysql</code> or <code>sqlite3-ruby</code> , for example). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  In use </h4><br><br>  Let's start with the following <code>Accounts: <br> id (integer; auto-incremented; primary key) <br> username (text) <br> password (text)</code> table <code>Accounts: <br> id (integer; auto-incremented; primary key) <br> username (text) <br> password (text)</code> <code>Accounts: <br> id (integer; auto-incremented; primary key) <br> username (text) <br> password (text)</code> <br> <br>  First of all, we connect to the database: <br><br><blockquote> <code><font color="black"><font color="#CC0066">require</font> <font color="#996600">"rubygems"</font> <br> <font color="#CC0066">require</font> <font color="#996600">"activerecord"</font> <br> <br> <font color="#6666ff">ActiveRecord::Base</font> . <font color="#9900CC">establish_connection</font> <font>(</font> <br> <font color="#ff3333">:adapter</font> <font color="#006600">=&gt;</font> <font color="#996600">"mysql"</font> , <br> <font color="#ff3333">:host</font> <font color="#006600">=&gt;</font> <font color="#996600">"localhost"</font> , <br> <font color="#ff3333">:username</font> <font color="#006600">=&gt;</font> <font color="#996600">"user"</font> , <br> <font color="#ff3333">:password</font> <font color="#006600">=&gt;</font> <font color="#996600">"pass"</font> , <br> <font color="#ff3333">:database</font> <font color="#006600">=&gt;</font> <font color="#996600">"project_development"</font> <font>)</font></font></code> <br> </blockquote><br><br>  As you can see, to do this, you must pass the parameters in the form of a hash to the <code>establish_connection</code> method.  For SQLite, only <code>:adapter =&gt; "sqlite"</code> and <code>:database</code> are needed. <br><br>  In accordance with the table we create a class-successor: <br><br><blockquote> <code><font color="black"><font color="#9966CC">Class</font> Account <font color="#006600">&lt;</font> <font color="#6666ff">ActiveRecord::Base</font> <br> <font color="#9966CC">end</font></font></code> <br> </blockquote><br><br>  Here you should pay special attention to the name of the class.  As usual, the principle of conventions over configuration, according to which the name of the table in the plural, the name of the class - in the singular, works here.  You can, of course, bypass this limitation, but you should not do it - work in the Ruby / Rails way, and you will understand how convenient it is. <br><br>  So, as we know, to create an entry in the table, we have to work with Ruby objects.  To create a new row in the <code>Accounts</code> database, create an instance of the <code>Account</code> class using the standard <code>new</code> method: <br><br><blockquote> <code><font color="black">acc1 = Account. <font color="#9900CC">new</font> <br> acc1. <font color="#9900CC">username</font> = <font color="#996600">"maxelc"</font> <br> acc1. <font color="#9900CC">password</font> = <font color="#996600">"maxspassword"</font></font></code> <br> </blockquote><br><br>  Here we see one of the key advantages of Ruby - metaprogramming.  For us, methods with the same table columns were created for us to edit the attributes of the instance.  Very convenient, but this is only the beginning, more - more.  However, this is only an instance of a class, the table has not yet changed (as mentioned above).  To ‚Äúsynchronize‚Äù the instance with the table, creating a new line, use the <code>save</code> method: <br><br><blockquote> <code><font color="black">acc1. <font color="#9900CC">save</font></font></code> <br> </blockquote><br><br>  Another way to make an entry: <br><br><blockquote> <code><font color="black">acc2 = Account. <font color="#9900CC">new</font> <font>(</font> <br> <font color="#ff3333">:username</font> <font color="#006600">=&gt;</font> <font color="#996600">"hbuser"</font> , <br> <font color="#ff3333">:password</font> <font color="#006600">=&gt;</font> <font color="#996600">"habrapass"</font> <font>)</font> <br> acc2. <font color="#9900CC">save</font></font></code> <br> </blockquote><br><br>  We have learned to keep records, now we need to extract them.  We understand that in this case we must create an instance of the class and fill it with attributes from the row of the table.  In fact, it is easier.  If we know the <code>id</code> string, we use the built-in (core) method of <code>find</code> : <br><br><blockquote> <code><font color="black">result1 = Account. <font color="#9900CC">find</font> <font>(</font> <font>1</font> <font>)</font> <br></font> <br></code> </blockquote><br><br>  Quite trivial, but what if we want to search by columns / attributes?  Here Ruby‚Äôs metaprogramming framework comes to our rescue again - we use dynamic search methods: <br><br><blockquote> <code><font color="black">result2 = Account. <font color="#9900CC">find_by_username</font> <font>(</font> <font color="#996600">"hbuser"</font> <font>)</font></font></code> <br> </blockquote><br><br>  This is a small piece of the magic that Active Record provides for us - again the methods were generated for us on the fly.  I think that the structure of their names is clear.  Example more abruptly: <br><br><blockquote> <code><font color="black">result3 = Account. <font color="#9900CC">find_or_create_by_username</font> <font>(</font> <font color="#996600">"superuser"</font> <font>)</font></font></code> <br> </blockquote><br><br>  And in this case the name of the method speaks for itself: ‚Äúfind or create a username‚Äù.  Accordingly, if an element is searched for (we say an element - we mean a table row, but in fact it is), the search condition will not be found, then it will be created and saved in a table ( <code>save</code> not needed in this case). <br><br>  So, we created the necessary instance / line, found it, and now we are looking at how to update the data and delete it completely: <br><br><blockquote> <code><font color="black">Account. <font color="#9900CC">update</font> <font>(</font> <font>1</font> , <font>{</font> :password <font color="#006600">=&gt;</font> <font color="#996600">'newpass'</font> <font>}</font> <font>)</font> <br> <font color="#CC0066">puts</font> <font color="#996600">" "</font> <br> Account. <font color="#9900CC">delete</font> <font>(</font> <font>2</font> <font>)</font></font></code> <br> </blockquote><br><br>  It is worth noting here that, despite the fact that we have deleted a row from the database, the instance continues to exist read-only until the instance itself is directly deleted or goes out of scope (scope is a separate topic). <br><br><h4>  Active Record Connections </h4><br><br>  Communication between objects is not only an incredibly important part of the Active Record functionality, it is simply necessary in real applications.  There are several types of links, we will consider one. <br><br>  Now we want to associate with each user a specific group, like Administrator or Guest.  To begin with, we will create a <code>Groups</code> table containing <code>id</code> and <code>name</code> (groups).  You also need to add a new <code>group_id</code> column to the <code>Accounts</code> table for use as a foreign key (the naming conventions work again).  In our case, you can think of the connection as ‚Äúeach account has a role‚Äù.  For this kind of links, the <code>belongs_to</code> method is <code>belongs_to</code> .  But first, create a new class for <code>Groups</code> in our script: <br><br><blockquote> <code><font color="black"><font color="#9966CC">class</font> Group <font color="#006600">&lt;</font> <font color="#6666ff">ActiveRecord::Base</font> <br> <font color="#9966CC">end</font></font></code> <br> </blockquote><br><br>  We must define the connection in the class <code>Account</code> , by adding the class like this: <br><br><blockquote> <code><font color="black"><font color="#9966CC">class</font> Account <font color="#006600">&lt;</font> <font color="#6666ff">ActiveRecord::Base</font> <br> belongs_to <font color="#ff3333">:group</font> <br> <font color="#9966CC">end</font></font></code> <br> </blockquote><br><br>  Now we have one-way communication - the account knows that it has a group, and the group does not know about its accounts.  Let's create a group of administrators and assign an account to it: <br><br><blockquote> <code><font color="black">admin_group = Group. <font color="#9900CC">find_or_create_by_name</font> <font>(</font> <font color="#996600">"admin"</font> <font>)</font> <br> account. <font color="#9900CC">group</font> = admin_group <br> account. <font color="#9900CC">save</font></font></code> <br> </blockquote><br><br>  As you can see, for the class Account, a new method has emerged that records a group for it.  We simply ‚Äúequated‚Äù the attribute (not really an attribute, but for the end user it looks like this) of the account to the entire group instance, Active Record understands this by doing what we need. <br><br><h4>  Epilogue </h4><br><br>  Here is an introduction to this powerful system.  First of all, it will, of course, be used when working with web applications, Rails, in particular.  If you have a desire, then we can go deeper into Active Record or, for example, Rake.  As usual - comments and comments are welcome at the highest level;) </div><p>Source: <a href="https://habr.com/ru/post/51943/">https://habr.com/ru/post/51943/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../51937/index.html">Site about special gadgets for geeks</a></li>
<li><a href="../51938/index.html">The collision of satellites in Google Earth</a></li>
<li><a href="../51939/index.html">Protection list of private trackers</a></li>
<li><a href="../51940/index.html">in the circle of friends and property rights</a></li>
<li><a href="../51941/index.html">Twitter ruined his life :)</a></li>
<li><a href="../51945/index.html">Program user</a></li>
<li><a href="../51946/index.html">Microsoft promises reward for "heads" of developers of the worm Conficker / Downadup</a></li>
<li><a href="../51948/index.html">How would you react to the appearance of music podcasts on Habr√©?</a></li>
<li><a href="../51949/index.html">What would you like to see in Habr√©? Or articles that people would like to read.</a></li>
<li><a href="../51951/index.html">Crossite dos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>