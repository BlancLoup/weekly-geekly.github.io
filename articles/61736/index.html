<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Memcached - cache strategy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to greet the habrosocommunity. From pleasant impressions when registering at Habr√© - this is the atmosphere of fabulousness, which only happens...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Memcached - cache strategy</h1><div class="post__text post__text-html js-mediator-article">  I want to greet the habrosocommunity.  From pleasant impressions when registering at Habr√© - this is the atmosphere of fabulousness, which only happens in good old fairy tales from the Soviet Film. <br>  So, the tears of emotion are gone, proceed.  Below is the topic that led to the invite to Habr. <br><br>  Memcached is used to cache data.  This is done in order to avoid unnecessary database calls, i.e.  in memcached save query results.  This speeds up the work of the site and reduces the time of issuance of pages. <br>  Kesh besides the advantages has its drawbacks.  One of the cache problems is its relevance.  In the ‚Äúread only‚Äù mode of operation there are no difficulties.  If we are dealing with data that changes, or changes often, the efficiency of caching drops sharply. <a name="habracut"></a>  The more often the data changes, the less efficient the cache.  Usually, the cache is reset after the first change.  And there is a reset at once all cached data.  After a reset, requests go to the database and a new cache is filled.  If there is one more change, the cache is reset again.  Often it turns out that such a good thing as memcached does not bring any benefit to the server's performance, and also entails additional costs for memory, processor time. <br>  One of the methods for solving this problem is a logical division of the cache into independent parts.  If a cache reset occurs, then only for the part that has changed. <br><br>  Consider one of these approaches in a bunch of Memcached - DB 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If we make a logical separation on requests, then the question arises of how and what to divide, how often to update.  Here it is necessary to give hints for each request, since the purpose of requests is different and it is not clear which requests to update and under what events.  It requires a lot of effort to implement - and I, as a lazy programmer, are not interested. <br><br>  Let's separate all references to the database by tables. <br><br>  Suppose we have a query with reference to several tables.  We take a query, analyze which tables in it, see if the data in the table has changed.  If the data has changed, then the cache for the request is also updated.  It sounds a bit complicated, the questions arise - how to do it all, but ultimately the implementation is quite simple. <br><br>  Let's start the sketches: <br><br>  * Each table we have will have a counter that changes every time the data in the table changes. <br>  * When we perform the deletion and insertion of rows, when the records change - we increase these counters. <br>  * Before executing a query, a list of affected tables is taken from it.  On these tables we find the values ‚Äã‚Äãof the counter.  We form these values ‚Äã‚Äãin one line and add as a comment to the request. <br><br>  That's all the difficulties with this approach.  To move to a new caching policy, we just need to make small changes to the code.  An example demonstrating this approach is provided below.  This example is completely independent and can be executed if you have PHP with support for the mysql and memcache extensions. <br>  This approach increases the efficiency of data caching.  When you flush the cache, only the data that belongs to the changed tables is deleted.  To be more specific, the words ‚Äúflush the cache‚Äù lose their meaning, the changed data becomes inaccessible and the cache continues to be filled with new keys for the same requests.  If you have a ‚Äúnasty‚Äù table, because of which the entire cache is often reset, then now such a table will not spoil the whole picture for you. <br><br>  The method is viable, it was tested on one of the sites ( <a href="http://www.skachatreferat.ru/">http://www.skachatreferat.ru</a> ).  Experience has shown that you should not neglect other methods of caching.  That for data whose relevance is not critical at a refresh rate of every 5 minutes, it is better to use the simplest caching with setting the cache lifetime for a given period, in this case it is 5 minutes. <br><br>  Take habrahabr, which provides access to articles.  Here each article is a text field and a set of some attributes.  Text changes rarely, while article attributes change frequently.  For this reason, it makes sense to put only the text of the article in the cache, and to choose the attributes independently from the tables.  As a result, the speed of access to data increases by an order of magnitude. <br><br>  The fewer columns we choose, the better for performance.  MySQL works with columns with data of a simple type an order of magnitude faster than with columns of type TEXT (where the text of the article is stored here).  Through the use of these features achieved a significant performance gain. <br><br>  Below is a script to demonstrate the method of dividing the cache into tables, the source code of which was promised to you.  The script is completely independent and does not require any additional modules.  Do not forget to specify the data for mysql and memcache at the beginning of the script: <br><blockquote><ol><li> <code><font color="black"><font color="#000000"><b>&lt;? <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</b></font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#666666"><i><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> //   ,        <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</i></font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li></li><li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li></li><li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> { <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> } <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> { <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> } <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> { <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> } <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> { <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> } <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> { <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> } <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> { <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> { <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> } <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li> <code><font color="black"><font color="#b1b100"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> else <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> { <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> } cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> } <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> ?&gt; &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</b></font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; &lt;? sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</b></font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#666666"><i><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> //    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",            <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</i></font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> ?&gt; &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</b></font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; &lt;? sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</b></font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> ?&gt; &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</b></font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; &lt;? sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</b></font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> <li> <code><font color="black"><font color="#000000"><b><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> ?&gt; &lt;h3&gt;:      ,  .      &lt;/h3&gt;</b></font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b>&lt;?</b></font> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">'Content-type: text/html; charset=UTF-8'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$mysql_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$mysql_username</font> <font color="#339933">=</font> <font color="#0000ff">'root'</font> <font color="#339933">;</font> <font color="#000088">$mysql_password</font> <font color="#339933">=</font> <font color="#0000ff">'12345'</font> <font color="#339933">;</font> <font color="#000088">$mysql_database</font> <font color="#339933">=</font> <font color="#0000ff">'test'</font> <font color="#339933">;</font> <font color="#666666"><i>//   ,       </i></font> <font color="#000088">$mysql_table1</font> <font color="#339933">=</font> <font color="#0000ff">'table1'</font> <font color="#339933">;</font> <font color="#000088">$mysql_table2</font> <font color="#339933">=</font> <font color="#0000ff">'table2'</font> <font color="#339933">;</font> <font color="#000088">$memcache_host</font> <font color="#339933">=</font> <font color="#0000ff">'localhost'</font> <font color="#339933">;</font> <font color="#000088">$memcache_port</font> <font color="#339933">=</font> <font color="#cc66cc">11211</font> <font color="#339933">;</font> <font color="#000088">$mysql</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#000088">$mysql_host</font> <font color="#339933">,</font> <font color="#000088">$mysql_username</font> <font color="#339933">,</font> <font color="#000088">$mysql_password</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$mysql</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   MySQL: <font color="#006699"><b>$mysql_username</b></font> @ <font color="#006699"><b>$mysql_host</b></font> / <font color="#006699"><b>$mysql_password</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">mysql_select_db</font> <font color="#009900">(</font> <font color="#000088">$mysql_database</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"    : <font color="#006699"><b>$mysql_database</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$memcache</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Memcache <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">pconnect</font> <font color="#009900">(</font> <font color="#000088">$memcache_host</font> <font color="#339933">,</font> <font color="#000088">$memcache_port</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"Memcached  : <font color="#006699"><b>$memcache_host</b></font> : <font color="#006699"><b>$memcache_port</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#3A00FF"><b>function</b></font> cacheGet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> cacheSet <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">global</font> <font color="#000088">$memcache</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$memcache</font> <font color="#339933">-&gt;</font> <font color="#004000">set</font> <font color="#009900">(</font> <font color="#000088">$key</font> <font color="#339933">,</font> <font color="#000088">$data</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$delay</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlExtractTables <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#339933">,</font> <font color="#000088">$tables</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">"   ,     '&lt;&lt;table_name&gt;&gt;': <font color="#006699"><b>$query</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/\\&lt;\\&lt;([A-Za-z0-9\\_]+)\\&gt;\\&gt;/"</font> <font color="#339933">,</font> <font color="#0000ff">"\ <font color="#660099"><b>\1</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$tables</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$resource</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">" : <font color="#006699"><b>$query</b></font> &lt;br&gt; "</font> <font color="#339933">.</font> <font color="#990000">mysql_error</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$resource</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlSet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> cacheSet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#339933">,</font> <font color="#990000">uniqid</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">24</font> <font color="#339933">*</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#3A00FF"><b>function</b></font> sqlGet <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$tables</font> <font color="#339933">=</font> sqlExtractTables <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$tables</font> <font color="#b1b100">as</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#000088">$appendix</font> <font color="#339933">.=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$table</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$appendix</font> <font color="#339933">=</font> <font color="#0000ff">"/*"</font> <font color="#339933">.</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$appendix</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">"*/"</font> <font color="#339933">;</font> <font color="#000088">$query</font> <font color="#339933">=</font> <font color="#000088">$query</font> <font color="#339933">.</font> <font color="#000088">$appendix</font> <font color="#339933">;</font> <font color="#000088">$cache_key</font> <font color="#339933">=</font> <font color="#990000">md5</font> <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> cacheGet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$result</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#0000ff">"&lt;b&gt;  :&lt;/b&gt; <font color="#006699"><b>$query</b></font> &lt;br&gt;"</font> <font color="#339933">;</font> <font color="#000088">$resource</font> <font color="#339933">=</font> sqlQuery <font color="#009900">(</font> <font color="#000088">$query</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#000088">$row</font> <font color="#339933">=</font> <font color="#990000">mysql_fetch_assoc</font> <font color="#009900">(</font> <font color="#000088">$resource</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000088">$result</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$row</font> <font color="#339933">;</font> <font color="#009900">}</font> cacheSet <font color="#009900">(</font> <font color="#000088">$cache_key</font> <font color="#339933">,</font> <font color="#000088">$result</font> <font color="#339933">,</font> <font color="#cc66cc">3600</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">return</font> <font color="#000088">$result</font> <font color="#339933">;</font> <font color="#009900">}</font> <font color="#000000"><b>?&gt;</b></font> &lt;h2&gt;.     &lt;/h2&gt; &lt;h3&gt; 2 &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666"><i>//    "select * from &lt;&lt;$mysql_table1&gt;&gt; where id=1",           </i></font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;   &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlSet <font color="#009900">(</font> <font color="#0000ff">"delete from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; where 1=0"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;    &lt;/h3&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table1</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;br&gt; <font color="#000000"><b>&lt;?</b></font> sqlGet <font color="#009900">(</font> <font color="#0000ff">"select * from &lt;&lt; <font color="#006699"><b>$mysql_table2</b></font> &gt;&gt; limit 1"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000"><b>?&gt;</b></font> &lt;h3&gt;:      ,  .      &lt;/h3&gt;</font></code> </li> </ol><br></blockquote><br><br>  the source is here: <a href="http://www.skachatreferat.ru/demo.txt">www.skachatreferat.ru/demo.txt</a> </div><p>Source: <a href="https://habr.com/ru/post/61736/">https://habr.com/ru/post/61736/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../61726/index.html">The prevalence of "social networks" in the world</a></li>
<li><a href="../61730/index.html">Changing the background image on the Ubuntu 9.04 login screen</a></li>
<li><a href="../61732/index.html">AdWords and old accounts</a></li>
<li><a href="../61734/index.html">Declarative event handlers on a web page</a></li>
<li><a href="../61735/index.html">Each note remembers its place</a></li>
<li><a href="../61737/index.html">Retro: Apple Macintosh Powerbook G3. Back to the past</a></li>
<li><a href="../61738/index.html">Long term contract with employer</a></li>
<li><a href="../61739/index.html">wTorrent - web-based bittorrent client for Linux \ BSD</a></li>
<li><a href="../61740/index.html">Keyboard Solo for Linux</a></li>
<li><a href="../61744/index.html">Adding ‚Äúcustom action‚Äù to the model administration interface in Django</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>