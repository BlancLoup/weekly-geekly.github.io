<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Linux mail server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How to improve the work of a mail server that can receive and send e-mail, fight spam, interact with customers? In fact, everything is quite simple. 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Linux mail server</h1><div class="post__text post__text-html js-mediator-article">  How to improve the work of a mail server that can receive and send e-mail, fight spam, interact with customers?  In fact, everything is quite simple. <br><br>  Today we will talk about mail servers on Linux.  We will talk about how to configure the server, about the widely used Internet protocol SMTP, as well as about other protocols, such as POP and IMAP.  As a result, you will be the owner of a complete system for working with e-mail. <br><br> <a href="https://habrahabr.ru/company/ruvds/blog/325356/"><img src="https://habrastorage.org/files/366/27c/f49/36627cf49b1246b3a5c8ed6e09bd324e.jpg"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's start with the SMTP server on Linux <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">SMTP server</font> </h2><br>  The Simple Mail Transfer Protocol (SMTP) protocol defines the rules for sending mail between computers, and does not specify the rules for storing or visualizing messages.  This system-independent protocol, that is, the sender and recipient of mail can have different operating systems. <br><br>  SMTP only requires the server to be able to send plain ASCII text to another server using <b>port 25</b> , which is the standard SMTP port. <br><br>  Today, two of the most common SMTP implementations are built into most Linux distributions: <b>sendmail</b> and <b>postfix</b> . <br><br>  Sendmail is a popular open source mail server used in many Linux distributions.  Its disadvantages include a somewhat complicated architecture and an insufficiently high level of protection. <br><br>  Postfix - the system is a bit more advanced, while developing this mail server, special attention was paid to security issues. <br><br><h2>  <font color="#3AC1EF">Components of the postal service</font> </h2><br>  A typical postal service consists of three main components: <br><br>  <b>Mail client</b> , which is also called the mail agent (Mail User Agent, MUA).  It is with him that the user interacts, for example, these are Thunderbird or Microsoft Outlook email clients.  They allow the user to read mail and write emails. <br><br>  <b>Mail Server</b> , or Message Transfer Agent (Mail Transport Agent, MTA).  This component is responsible for moving email between systems, such as Sendmail and Postfix, for example. <br><br>  Mail Delivery Agent (MDA).  This component is responsible for distributing received messages to user mailboxes.  For example, Postfix-maildrop and Procmail. <br><br><h2>  <font color="#3AC1EF">Install mail server</font> </h2><br>  To configure our server was selected package Postfix.  This is a popular choice among system administrators, the standard mail server in most modern Linux distributions. <br><br>  Let's start by checking whether Postfix is ‚Äã‚Äãinstalled on the system: <br><br><pre><code class="hljs swift">$ rpm -qa | grep <span class="hljs-keyword"><span class="hljs-keyword">postfix</span></span></code> </pre> <br>  If you cannot detect Postfix, you can install it, for example, in distributions based on Red Hat, using the following command: <br><br><pre> <code class="hljs swift">$ dnf -y install <span class="hljs-keyword"><span class="hljs-keyword">postfix</span></span></code> </pre> <br>  Then we start the postfix service and organize its autorun when the system boots: <br><br><pre> <code class="hljs swift">$ systemctl start <span class="hljs-keyword"><span class="hljs-keyword">postfix</span></span> $ systemctl enable <span class="hljs-keyword"><span class="hljs-keyword">postfix</span></span></code> </pre> <br>  On Debian-based distributions like Ubuntu, you can install Postfix like this: <br><br><pre> <code class="hljs swift">$ apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> -y install <span class="hljs-keyword"><span class="hljs-keyword">postfix</span></span></code> </pre> <br>  During installation, you will be prompted to select a server configuration.  Among the four options available (No configuration, Internet site, Internet system, Satellite system and Local system), we will select <b>No configuration</b> , which will create the necessary user and group accounts for Postfix. <br><br><h2>  <font color="#3AC1EF">Server Tuning</font> </h2><br>  After installing Postfix mail server, you need to configure it.  Most of the configuration files are located in the <b>/ etc / postfix /</b> directory. <br><br>  The main Postfix configuration file can be found at <b>/etc/postfix/main.cf</b> .  There are many options, consider the most important. <br><br>  <b>myhostname</b> <br><br>  This parameter is used to specify the hostname of the mail system.  This is the name of the host on the Internet for which Postfix will receive mail. <br><br>  Typical examples of mail server host names are mail.example.com and smtp.example.com. <br><br>  Adjust this parameter as follows: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">myhostname</span></span> = mail.example.com</code> </pre> <br>  <b>mydomain</b> <br><br>  This setting allows you to specify the mail domain serviced by the server, for example, example.com: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">mydomain</span></span> = example.com</code> </pre> <br>  <b>myorigin</b> <br><br>  This parameter allows you to specify the domain name used in mail sent from the server.  Give it the value of $ mydomain: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">myorigin</span></span> = <span class="hljs-variable"><span class="hljs-variable">$mydomain</span></span></code> </pre> <br>  In the settings you can refer to the parameters by adding a <code>$</code> sign in front of the variable name. <br><br>  <b>mydestination</b> <br><br>  This parameter contains a list of domains that the Postfix server will consider as final destinations for incoming mail. <br><br>  In our case, here will be the server‚Äôs hostname and domain name, but this parameter may contain other names: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">mydestination</span></span> = <span class="hljs-variable"><span class="hljs-variable">$myhostname</span></span>, localhost.<span class="hljs-variable"><span class="hljs-variable">$mydomain</span></span>, <span class="hljs-variable"><span class="hljs-variable">$mydomain</span></span>, mail.<span class="hljs-variable"><span class="hljs-variable">$mydomain</span></span>, www.<span class="hljs-variable"><span class="hljs-variable">$mydomain</span></span></code> </pre> <br>  <b>mail_spool_directory</b> <br><br>  The Postfix mail server can use two modes of mail delivery: <br><br><ul><li>  Directly to the user's mailbox. </li><li>  In the central directory of queues, while mail falls into the <b>/ var / spool / mail</b> folder, where there is a file for each user. </li></ul><br><pre> <code class="hljs swift">mail_spool_directory = /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/spool/mail</code> </pre> <br>  <b>mynetworks</b> <br><br>  This variable is an important setting parameter.  It allows you to specify which servers can forward mail through the Postfix server. <br><br>  Typically, only mail from local client computers is allowed.  Otherwise, spammers may be interested in your server. <br><br>  If you incorrectly configure the <b>mynetworks</b> parameter, spammers can easily use the server as a mail relay.  This will very quickly cause some anti-spam system to put it on one of the blacklists, like the DNS Blacklist (DNSBL), or the Realtime Blackhole List (RBL).  As soon as the server gets into the similar list, very few will be able to receive the letters sent with its help. <br><br>  Here is what the setting of this parameter might look like: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">mynetworks</span></span> = <span class="hljs-number"><span class="hljs-number">127.0.0.0</span></span>/<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">192.168.1.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span></code> </pre> <br>  <b>smtpd_banner</b> <br><br>  This variable allows you to specify a response that the server returns when clients connect. <br><br>  It is best to change this value so that it does not indicate exactly which mail server is used. <br><br>  <b>inet_protocols</b> <br><br>  This variable allows you to specify the version of IP that Postfix will use when establishing connections. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">inet_protocols</span></span> = ipv4</code> </pre> <br>  In order for the changes made in the configuration files to take effect, the Postfix service must be restarted: <br><br><pre> <code class="hljs swift">$ systemctl reload <span class="hljs-keyword"><span class="hljs-keyword">postfix</span></span></code> </pre> <br>  In fact, you can configure a lot more in the Postfix configuration file.  For example, to manage security levels, set debugging options and other parameters. <br><br>  You may have made a mistake when setting up a server by entering parameter values.  You can verify the settings using the following command: <br><br><pre> <code class="hljs swift">$ <span class="hljs-keyword"><span class="hljs-keyword">postfix</span></span> check</code> </pre> <br>  With this tool you can find the line in which the error was made, and correct it. <br><br><h2>  <font color="#3AC1EF">Message Queuing Check</font> </h2><br>  Sometimes the mail queue is full.  This can be caused by many factors, such as a network error, or for any reason that may delay the sending of mail. <br><br>  To check the message queue, use the following command: <br><br><pre> <code class="hljs ruby">$ mailq</code> </pre> <br>  It will display the messages in the queue.  If the queue is full and it takes several hours to send a message, you can initiate the process of sending messages with the following command: <br><br><pre> <code class="hljs swift">$ <span class="hljs-keyword"><span class="hljs-keyword">postfix</span></span> flush</code> </pre> <br>  If you now check the queue, it should be empty. <br><br><h2>  <font color="#3AC1EF">Mail Server Testing</font> </h2><br>  After setting up the server on Postfix, it needs to be tested.  The first step in testing is to use a local email client, such as <b>mailx</b> or <b>mail</b> (this is a symbolic link to mailx). <br><br>  Try sending a letter to someone whose address is served on the same server, and if it works, send an email to an address that is located somewhere else. <br><br><pre> <code class="hljs pgsql">$ echo "This is message body" | mailx -s "This is Subject" -r "likegeeks&lt;likegeeks@example.com&gt;" -a /<span class="hljs-type"><span class="hljs-type">path</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>/attachment someone@example.com</code> </pre> <br>  Then try to accept a letter sent from another server. <br><br>  If you run into problems, check the logs.  For Red Hat-based distributions, what you need can be found at <b>/ var / log / maillog</b> .  In the Debian distributions, the required file can be found here: <b>/var/log/mail.log</b> , or along the path specified in the rsyslogd settings.  <a href="https://likegeeks.com/linux-syslog-server-log-management/">Here</a> , if necessary, a material on logging in Linux, and how to configure rsyslogd. <br><br>  If the problems are still not resolved, try checking the DNS settings, take a look at the MX records using <a href="https://likegeeks.com/linux-network-commands/">Linux network commands</a> . <br><br><h2>  <font color="#3AC1EF">Spam fighting</font> </h2><br>  There are quite a few solutions for detecting unwanted emails - spam.  One of the best is the open source project SpamAssassin. <br>  You can install it like this: <br><br><pre> <code class="hljs sql">$ dnf -y <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> spamassassin</code> </pre> <br>  Then you need to start the corresponding service and add it to autoload: <br><br><pre> <code class="hljs pgsql">$ systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> spamassassin $ systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> spamassassin</code> </pre> <br>  After installing SpamAssassin, take a look at its settings in the <b>/etc/mail/spamassassin/local.cf</b> file. <br><br>  SpamAssassin is able to distinguish regular letters from spam, based on the results of the study of correspondence using various scripts.  The results of the checks are scored. <br><br>  The higher the final mark of the letter, the higher the probability that it is spam. <br><br>  In the configuration file, the parameter <b>required_hits 5</b> indicates that SpamAssassin will mark the message as spam if its rating is 5 or higher. <br><br>  The <b>report_safe</b> parameter accepts values ‚Äã‚Äãof 0, 1, or 2. Setting it to 0 means that the messages marked as spam are sent as they are, but their header is modified indicating that they are spam. <br><br>  If this parameter is set to 1 or 2, SpamAssassin will generate a report and send it to the recipient. <br><br>  The difference between values ‚Äã‚Äã1 and 2 is that in the first case the spam message will be encoded in the message / rfc822 format, and in the second case - in the text / plain format. <br><br>  Text / plain encoding is safer because some email clients execute message / rfc822 messages, which under certain conditions can lead to infection of a client computer with a virus. <br><br>  After installing and configuring SpamAssassin, you need to integrate it with Postfix.  Perhaps the easiest way to do this is through the use of procmail. <br><br>  Create the <b>/ etc / procmailrc</b> file and add the following to it: <br><br><pre> <code class="hljs javascript">:<span class="hljs-number"><span class="hljs-number">0</span></span> hbfw | <span class="hljs-regexp"><span class="hljs-regexp">/usr/</span></span>bin/spamc</code> </pre> <br>  Then edit the Postfix configuration file - <b>/etc/postfix/main.cf</b> , setting the <b>mailbox_command</b> parameter as follows: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">mailbox_command</span></span> = /usr/bin/procmail</code> </pre> <br>  And finally, we restart the Postfix and SpamAssassin services: <br><br><pre> <code class="hljs pgsql">$ systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> postfix $ systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> spamassassin</code> </pre> <br>  I must say that SpamAssassin does not always recognize spam, which leads to the filling of mailboxes with unnecessary letters. <br><br>  Fortunately, messages can be filtered using Realtime Blackhole Lists (RBLs) before they reach the Postfix mail server.  This will reduce the load on the mail server and help keep it clean. <br><br>  Open the Postfix configuration file <b>/etc/postfix/main.cf</b> , change the <b>smtpd_recipient_restrictions</b> parameter and configure other parameters as follows: <br><br><pre> <code class="hljs dos">strict_rfc821_envelopes = yes relay_domains_reject_code = <span class="hljs-number"><span class="hljs-number">554</span></span> unknown_address_reject_code = <span class="hljs-number"><span class="hljs-number">554</span></span> unknown_client_reject_code = <span class="hljs-number"><span class="hljs-number">554</span></span> unknown_hostname_reject_code = <span class="hljs-number"><span class="hljs-number">554</span></span> unknown_local_recipient_reject_code = <span class="hljs-number"><span class="hljs-number">554</span></span> unknown_relay_recipient_reject_code = <span class="hljs-number"><span class="hljs-number">554</span></span> unverified_recipient_reject_code = <span class="hljs-number"><span class="hljs-number">554</span></span> smtpd_recipient_restrictions = reject_invalid_hostname, reject_unknown_recipient_domain, reject_unauth_pipelining, permit_mynetworks, permit_sasl_authenticated, reject_unauth_destination, reject_rbl_client dsn.rfc-ignorant.org, reject_rbl_client dul.dnsbl.sorbs.<span class="hljs-built_in"><span class="hljs-built_in">net</span></span>, reject_rbl_client list.dsbl.org, reject_rbl_client sbl-xbl.spamhaus.org, reject_rbl_client bl.spamcop.<span class="hljs-built_in"><span class="hljs-built_in">net</span></span>, reject_rbl_client dnsbl.sorbs.<span class="hljs-built_in"><span class="hljs-built_in">net</span></span>, permit</code> </pre> <br>  Then restart the Postfix server: <br><br><pre> <code class="hljs swift">$ systemctl restart <span class="hljs-keyword"><span class="hljs-keyword">postfix</span></span></code> </pre> <br>  The above blacklists are used most often, but you can find other similar servers. <br><br><h2>  <font color="#3AC1EF">SMTP Security</font> </h2><br>  It is best to send SMTP traffic over TLS to protect it from an attack through an intermediary. <br>  First you need to generate a certificate and key using the <b>openssl</b> command: <br><br><pre> <code class="hljs ruby">$ openssl genrsa -des3 -out mail.key $ openssl req -new -key mail.key -out mail.csr $ cp mail.key mail.key.original $ openssl rsa -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> mail.key.original -out mail_secure.key $ openssl x509 -req -days <span class="hljs-number"><span class="hljs-number">365</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> mail.csr -signkey mail_secure.key -out mail_secure.crt $ cp mail_secure.crt /etc/postfix/ $ cp mail_secure.key /etc/postfix/</code> </pre> <br>  Then add the following to the Postfix <b>/etc/postfix/main.cf</b> configuration file: <br><br><pre> <code class="hljs ruby">smtpd_use_tls = yes smtpd_tls_cert_file = <span class="hljs-regexp"><span class="hljs-regexp">/etc/postfix</span></span><span class="hljs-regexp"><span class="hljs-regexp">/mail_secure.crt smtpd_tls_key_file = /etc</span></span><span class="hljs-regexp"><span class="hljs-regexp">/postfix/mail</span></span>_secure.key smtp_tls_security_level = may</code> </pre> <br>  And finally, you need to restart the Postfix service: <br><br><pre> <code class="hljs swift">$ systemctl restart <span class="hljs-keyword"><span class="hljs-keyword">postfix</span></span></code> </pre> <br>  Now, when connecting the client to the server, you need to select TLS.  Here you, when you first send mail after changing the settings, you will see a warning, because the certificate is not signed. <br><br><h2>  <font color="#3AC1EF">Basics of POP3 and IMAP Protocols</font> </h2><br>  So, we have established the process of sending and receiving e-mails via SMTP, but the organization of a full-fledged postal service does not end there.  Consider the following situations: <br><br><ul><li>  Users need local copies of emails to view them without being connected to the Internet. <br><br></li><li>  User mail clients do not support the mbox file format.  This is a simple text format that many console mail clients can read, such as mailx and mutt. <br><br></li><li>  Users can not always use the fast connection to access the server's file system and work with mbox-files, as a result, you need to make a local copy to work with them without connecting to the network. <br><br></li><li>  Security restrictions indicate that users do not have direct access to the email gateway, for example, it is not allowed to work with public message queue folders. <br></li></ul><br>  In order to accommodate all these special cases, other protocols were created.  They can be described as protocols for accessing e-mail. <br><br>  The two most popular mail access protocols are the POP (Post Office Protocol) and the Internet Message Access Protocol (IMAP). <br><br>  POP is based on a very simple idea.  The central mail server on Linux is always connected to the Internet, it receives and stores letters for all users.  All received letters remain in the queue on the server until the user connects to it via the POP protocol and downloads the letters. <br><br>  When a user wants to send an email, the email client usually sends it through a central server via SMTP. <br><br>  Please note that the SMTP server and POP server can work on the same machine without any problems.  These days it is a common practice. <br><br>  Features such as storing the original copies of user letters on the server, storing only cached copies on the client, are absent in the POP.  This led to the development of the IMAP protocol. <br><br>  Using IMAP, the server will support three mail access modes: <br><br><ul><li>  Online mode is similar to direct access to the file system on the mail server. <br></li><li>  Offline mode is similar to how POP works when a client disconnects from the network after receiving its emails.  In this mode, the server usually does not store copies of letters. <br></li><li>  Offline mode allows users to store cached copies of their letters, and the server also stores copies of these letters. <br></li></ul><br>  There are various implementations of IMAP and POP, in this area Dovecot server is very popular, which allows you to work with both protocols. <br><br>  POP3, POP3S, IMAP, and IMAPS servers listen on ports 110, 995, 143, and 993, respectively. <br><br><h2>  <font color="#3AC1EF">Dovecot installation</font> </h2><br>  Most Linux distributions contain Dovecot pre-installed, however, you can install it yourself.  On systems based on Red Hat, this is done like this: <br><br><pre> <code class="hljs sql">$ dnf -y <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> dovecot</code> </pre> <br>  On Debian-based systems, IMAP and POP3 functionality is provided in two different packages: <br><br><pre> <code class="hljs swift">$ apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> -y install dovecot-imapd dovecot-pop3d</code> </pre> <br>  Here you will be prompted to create a self-signed certificate for working with IMAP and POP3 over SSL / TLS.  Answer the question <b>yes</b> and, when prompted, enter the host name of your system. <br><br>  Then you can start the corresponding service and add it to autoload: <br><br><pre> <code class="hljs pgsql">$ systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> dovecot $ systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> dovecot</code> </pre> <br><h2>  <font color="#3AC1EF">Dovecot setup</font> </h2><br>  The main Dovecot configuration file is located at <b>/etc/dovecot/dovecot.conf</b> .  In some Linux distributions, this file is located in the <b>/etc/dovecot/conf.d/</b> folder and, for <b>including</b> configuration files, the include directive is used. <br><br>  Here are some of the parameters used to configure Dovecot. <br><br>  <b>protocols</b> : protocols to support. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">protocols</span></span> = imap pop3 lmtp</code> </pre> <br>  Here <b>lmtp</b> means Local Mail Transfer Protocol.  <b>listen</b> : The IP address that the server will listen to. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">listen</span></span> = *, ::</code> </pre> <br>  Here, an asterisk means all IPv4 interfaces, a double colon means all IPv6 interfaces. <br><br>  <b>userdb</b> : user database for authentication. <br><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">userdb</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">driver</span></span> = pam }</code> </pre><br>  <b>mail_location</b> : this is an entry in the <b>/etc/dovecot/conf.d/10-mail.conf</b> file.  It looks like this: <br><br><pre> <code class="hljs javascript">mail_location = mbox:~<span class="hljs-regexp"><span class="hljs-regexp">/mail:INBOX=/</span></span><span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/mail/%u</code> </pre> <br>  Dovecot comes with standard SSL certificates and key files that are used in the <b>/etc/dovecot/conf.d/10/ssl.conf</b> file. <br><br><pre> <code class="hljs ruby">ssl_cert = &lt;<span class="hljs-regexp"><span class="hljs-regexp">/etc/pki</span></span><span class="hljs-regexp"><span class="hljs-regexp">/dovecot/certs</span></span><span class="hljs-regexp"><span class="hljs-regexp">/dovecot.pem ssl_key = &lt;/etc</span></span><span class="hljs-regexp"><span class="hljs-regexp">/pki/dovecot</span></span><span class="hljs-regexp"><span class="hljs-regexp">/private/dovecot</span></span>.pem</code> </pre> <br>  When a user tries to connect to Dovecot, the server will display a warning because the certificates are not signed.  If necessary, signed certificates can be purchased at a suitable certificate authority. <br><br>  Do not forget to open the Dovecot server ports on the firewall. <br><br><pre> <code class="hljs matlab">$ iptables  -A INPUT -p tcp --dport <span class="hljs-number"><span class="hljs-number">110</span></span> -<span class="hljs-built_in"><span class="hljs-built_in">j</span></span> ACCEPT $ iptables  -A INPUT -p tcp --dport <span class="hljs-number"><span class="hljs-number">995</span></span> -<span class="hljs-built_in"><span class="hljs-built_in">j</span></span> ACCEPT $ iptables  -A INPUT -p tcp --dport <span class="hljs-number"><span class="hljs-number">143</span></span> -<span class="hljs-built_in"><span class="hljs-built_in">j</span></span> ACCEPT $ iptables  -A INPUT -p tcp --dport <span class="hljs-number"><span class="hljs-number">993</span></span> -<span class="hljs-built_in"><span class="hljs-built_in">j</span></span> ACCEPT</code> </pre> <br>  And do not forget about the SMTP port. <br><br><pre> <code class="hljs pgsql">$ iptables -A <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span> -p tcp <span class="hljs-comment"><span class="hljs-comment">--dport 25 -j ACCEPT</span></span></code> </pre> <br>  Then save the rules.  If you want to refresh the memory of the work with iptables in Linux, take a look at <a href="https://likegeeks.com/linux-iptables-firewall-examples/">this</a> material. <br>  Or, if you are using firewalld, you can do this: <br><br><pre> <code class="hljs cs">$ firewall-cmd --permanent --<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>-port=<span class="hljs-number"><span class="hljs-number">110</span></span>/tcp --<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>-port=<span class="hljs-number"><span class="hljs-number">995</span></span> $ firewall-cmd --permanent --<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>-port=<span class="hljs-number"><span class="hljs-number">143</span></span>/tcp --<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>-port=<span class="hljs-number"><span class="hljs-number">993</span></span> $ firewall-cmd --reload</code> </pre> <br>  And if something went wrong, look at the log files <b>/ var / log / messages</b> , <b>/ var / log / maillog,</b> and <b>/var/log/mail.log</b> . <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  Now you can set up mail service on your Linux server.  As you can see, it will not take long.  Of course, the packages reviewed here, like Postfix, have a lot of settings, but if you have mastered the sequence of actions described here and sorted out the basics, then everything you need will be easy to find out from the documentation. <br><br>  Dear readers!  How do you set up mail servers on Linux? </div><p>Source: <a href="https://habr.com/ru/post/325356/">https://habr.com/ru/post/325356/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325346/index.html">ITMO University will start developing unbreakable storage systems</a></li>
<li><a href="../325348/index.html">What devices today is the market of "Internet of things" in Russia</a></li>
<li><a href="../325350/index.html">Programmer Identity</a></li>
<li><a href="../325352/index.html">Guide to creating a simple photo editor</a></li>
<li><a href="../325354/index.html">AP Failover and AP Fallback in Cisco Unified Wireless Implementation</a></li>
<li><a href="../325358/index.html">Why do you need containerd and why it was separated from Docker</a></li>
<li><a href="../325360/index.html">Comparing OpenMP on different platforms</a></li>
<li><a href="../325362/index.html">Do not stay in the cold on April 1st - make a backup</a></li>
<li><a href="../325364/index.html">Making a spell checker on phonetic algorithms with your own hands</a></li>
<li><a href="../325366/index.html">Intel processors will triple</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>