<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What to do if Instagram did not give access to the API? Addition</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello again! I read it and it seemed to me that it could be continued. 


 It's no secret that the most popular and profitable platform for advertisin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What to do if Instagram did not give access to the API? Addition</h1><div class="post__text post__text-html js-mediator-article">  Hello again!  I read <a href="https://habrahabr.ru/post/302150/">it</a> and it seemed to me that it could be continued. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52e/758/d2d/52e758d2d25dbc08aac63948d34924cd.jpg" alt="image"></div><br>  It's no secret that the most popular and profitable platform for advertising, business and other things is Instagram.  Why they became just a service, in which at first it was possible to upload only pictures of a certain size (the aspect ratio means) and there was absolutely nothing that was on the social networks of that time - it is completely incomprehensible, but fact is a fact.  Because of this, everyone is trying to get on the Instagram site and grab the largest number of audience from there, and they do it, of course, not manually.  And it follows that Instagram rigidly blocks access for bots, spammers and so on, so that the network remains clean. <br><br><ol><li>  The most useful functions (posting and deleting posts) are available only from the Instagram mobile application, the emulation of requests is complicated, as you need to pull out the key from the application, which is updated with each new version. </li><li>  The web version is cut off, but I am glad that it has the ability to like, comment and delete comments. </li><li>  There is an API, but the procedure for obtaining it is depressingly long and for spammers and bots this way just does not shine.  Plus, there were many moments when API agreements changed, which is not always convenient. </li></ol><a name="habracut"></a><br>  Although I contacted Instagram not to make another spam bot that can subscribe and like, but I really didn‚Äôt want to bother with getting the Instagram API, so I had to write my own <a href="https://github.com/OlegYurchik/pyInstaParser">library</a> for interacting with Instagram. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I would like to say that working with the Instagram web version is very pleasant for two reasons: <br><br>  1. On any page you can get brief information if you send a GET request of the form: <br><br><pre><code class="plaintext hljs">https://instagram.com/zuck/?__a=1</code> </pre> <br>  And the answer is JSON with available information, the first 10 posts of the page and so on.  Very nice. <br><br>  2. If there is not enough brief information, then there is one more good news.  You can upload photos, subscriptions, comments using a specific query of the form <br><br><pre> <code class="plaintext hljs">https://www.instagram.com/graphql/query/?query_id=17888483320059182&amp;variables=...</code> </pre> <br>  where variables are passed variables for processing in JSON format.  The answer is also JSON.  And in general, it is obvious that this all works in GraphQL, so you can even google it in order to understand how requests are processed. <br><br>  Based on knowledge data and built the entire library.  I will briefly describe how it can be used, maybe someone will come in handy.  By the way, I indicated the BSD 3 license in the repository. Tell me, maybe I should change it so that there are no difficulties? <br><br><h2>  Installation </h2><br>  Install it is not necessary.  More precisely, I was too lazy to prescribe all sorts of setup.py or package when the library consists of just one file.  Therefore, there is just an instagram.py file, which is connected as follows: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> instaparser</code> </pre> <br><h2>  How to use it? </h2><br>  Interaction with Instagram is possible either with authorization or without.  Without authorization, there are no functions for viewing subscriptions and subscribers, and it is obviously impossible to like something, comment something, and so on.  The only restrictions with authorization: it is impossible to lay out posts and delete them. <br><br>  I will give an example of interaction without authorization: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> instaparser.agents <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Agent <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> instaparser.entities <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Account agent=Agent() account=Account(<span class="hljs-string"><span class="hljs-string">"zuck"</span></span>) agent.update(account) media=agent.get_media(account, count=<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> m <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> media: print(m)</code> </pre><br>  As you understand, this script downloads information about Mark Zuckerberg‚Äôs page, loads the last 100 posts from his page and displays them on the screen. <br><br>  I want to say that if I had not written <br><br><pre> <code class="python hljs">agent.update(account)</code> </pre> <br>  then it would not work to download posts, since no information about the Zuckerberg page was known. <br><br>  Here is an example with authorization: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> instaparser.agents <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AgentAccount <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> instaparser.entities <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Account agent=AgentAccount(<span class="hljs-string"><span class="hljs-string">"oleg_yurchik"</span></span>, <span class="hljs-string"><span class="hljs-string">"imasuperpassword"</span></span>) agent.update() account=Account(<span class="hljs-string"><span class="hljs-string">"zuck"</span></span>) agent.update(account) <span class="hljs-comment"><span class="hljs-comment"># and etc.</span></span></code> </pre><br>  This is the so-called <i>Hello, world!</i>  .  Or a quick start. <br><br>  And now I will tell you more: <br><br>  Instagram, in fact, has only 6 entities: <br><br><ol><li>  Account </li><li>  Fast </li><li>  Geolocation </li><li>  Comment </li><li>  Hashtag </li><li>  Storys </li></ol><br>  Everything else is just lists of these entities, such as likes, subscriptions, subscribers, and more.  And for each entity there is a class.  For accounts - Account, posts - Media, geolocations - Location, comments - Comment, hashtags - Tag, stories - Story.  And each of them (except comments) need to be updated before you work with it.  That is, if you want to download all your posts, go through them and get a list of geolocations, then you need to do the following: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> instaparser.agents <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AgentAccoun agent=AgentAccount(<span class="hljs-string"><span class="hljs-string">'oleg.yurchik'</span></span>, <span class="hljs-string"><span class="hljs-string">'anothersuperpassword'</span></span>) agent.update() media=agent.get_media(count=agent.media_count) locations=[] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> m <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> media: agent.like(m) agent.update(m) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> m.location: locations.append(m.location)</code> </pre><br>  And if you later need to get the last 10 posts on a specific geolocation, then you will need to do the following: <br><br><pre> <code class="python hljs">agent.update(location) media=agent.get_media(location, count=<span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre><br>  I had to take out the function of updating the account from initialization, because if you need to get all the subscribers, for example, the program would update each of the accounts, but this is not good. <br><br>  The library is based on the requests library, and I consider that one of the tokens is that you can also pass additional parameters for requests to the methods.  This idea came to me when I first got a 429 error from Instagram.  It was necessary to use a proxy. <br><br>  For example, you can do this: <br><br><pre> <code class="python hljs">media=agent.get_media(count=agent.media_count, settings={<span class="hljs-string"><span class="hljs-string">'proxies'</span></span>: {<span class="hljs-string"><span class="hljs-string">'https'</span></span>: <span class="hljs-string"><span class="hljs-string">'127.0.0.1:80'</span></span>}})</code> </pre><br>  where 127.0.0.1:80 - you can specify your proxy <br><br>  Also, another chip, I think, may be intercepting errors. <br><br>  In the Agent and AgentAccount classes (the ones that communicate with Instagram) there is a dictionary organized as a tree, it is called <b>exception_actions</b> .  It stores exception classes in the form of keys, and functions in the form of values.  If any error occurs, it is intercepted and the function is executed from the dictionary.  This function is passed an exception object and parameters with which the request was executed.  It can perform some action and return the changed (or not) query parameters.  The request will be repeated again.  And it will be repeated as many times as indicated in the parameter Agent.repeats.  The default is 1. <br><br>  And you can not worry about memory overflow. <br><br>  The class of each entity has a dictionary in which all objects of this class are stored (or even objects of the subclass).  Thus, if you accidentally create, for example, an account that has already been created, the designer will return a link to the previously created account to you. <br><br>  If you accidentally missed the link to the repository in the text, <a href="https://github.com/OlegYurchik/pyInstaParser">then here it is again</a> . <br><br>  And finally, I will say that due to some decisions some problems have appeared: <br><br><ol><li>  For example, the problem when re-creating the object.  If suddenly you want to use the account as a worker and interact through it, and it has already been created as a normal account, then create it again does not work.  I don‚Äôt know how to solve it yet. </li><li>  Error trapping sometimes behaves very strange and is not fully tested. </li></ol><br>  I really hope that maybe this solution will be useful to someone, I hope for any useful comments and help in finishing this thing.  In the article I mentioned, I gave an example of such a script in PHP, but it was only collecting information and, in my opinion, it worked only with the old version of the Instagram web interface. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/339620/">https://habr.com/ru/post/339620/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339610/index.html">Translation of two articles: ‚ÄúHow to commit changes to a Docker image‚Äù and ‚ÄúGuide for Moving Docker Containers‚Äù</a></li>
<li><a href="../339612/index.html">PGP offline key storage strategies</a></li>
<li><a href="../339614/index.html">Migrating business critical applications to the cloud: VMware tools overview</a></li>
<li><a href="../339616/index.html">At the bottom: what threatens underwater internet cables</a></li>
<li><a href="../339618/index.html">Aftertaste from Kotlin, part 3. Korutiny - we divide the processor time</a></li>
<li><a href="../339624/index.html">10 famous logos drawn from memory</a></li>
<li><a href="../339626/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ283 (October 2 - 8, 2017)</a></li>
<li><a href="../339628/index.html">We unite Websockets, Lisp and functional programming</a></li>
<li><a href="../339630/index.html">PHP Digest number 118 - the latest news, materials and tools (September 24 - October 9, 2017)</a></li>
<li><a href="../339636/index.html">Kali Linux: Types of Information Systems Checks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>