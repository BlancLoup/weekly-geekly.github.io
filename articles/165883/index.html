<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Voice informer via Skype for 1C: Enterprise</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Processing for 1C in the article allows you to receive an audio file with a speech generated by a computer based on a text line, call the other person...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Voice informer via Skype for 1C: Enterprise</h1><div class="post__text post__text-html js-mediator-article">  Processing for 1C in the article allows you to receive an audio file with a speech generated by a computer based on a text line, call the other person via Skype and say it.  The functionality is based on the .Net framework and API for Skype.  The development will be useful not only for serious business applications, but also for home experiences and jokes to friends.  For calls to real numbers, you need a refilled balance on Skype. <br><img src="https://habrastorage.org/getpro/habr/post_images/ba1/fbd/5e9/ba1fbd5e943ed865f546f12c33f44220.png"><br><h2>  Presetting </h2><br>  If the Russian voice is not provided in the system, then it must be installed.  By default, Windows 7 can only read English texts.  For the Russification of voice, you need to install an additional Russian voice.  Only the voice of ScanSoft Katerina Full 22kHz was found on the Internet (the legal possibility of using this voice is not completely understood).  Many may find the voice slow.  To speed it up, you need to make an entry in the registry: <br><pre><code class="hljs tex">[HKEY_LOCAL_MACHINE<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SOFTWARE</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Microsoft</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Speech</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Voices</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Tokens</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ScanSoftKaterina</span></span></span></span>_Full_22kHz] "pp type"="email"</code> </pre> <br>  Skype allows you to interact with yourself through <a href="http://developer.skype.com/accessories/skype4com">the skype4COM library</a> . <br><a name="habracut"></a>  You need to download this library and register it in the registry via <code>regsvr32 skype4COM.dll</code> .  This operation may require administrator privileges. <br>  After trying to use Skype for the first time, a query will appear in Skype.  You need to give permission to the program 1cv8c.exe to use Skype.  You can control the programs that have access through Settings-Advanced-Advanced Settings-Control other programs' access to Skype. <br>  To access the .Net framework from 1C, you must install .Net Bridge.  Now the latest version is 4.0.4. <br><br><h2>  C # Code Description </h2><br>  The SkypeSpeech class code is divided into 2 parts: sound generation through the SpeechSynthesizer class and working with Skype via SKYPE4COMLib. <br><br>  Sound generation: <br><pre> <code class="hljs javascript">SpeechSynthesizer reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpeechSynthesizer(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.IsNullOrEmpty(voiceName)) {    <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> voice = reader.GetInstalledVoices().Where(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m</span></span></span><span class="hljs-function"> =&gt;</span></span> m.VoiceInfo.Name == voiceName).FirstOrDefault();    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (voice != <span class="hljs-literal"><span class="hljs-literal">null</span></span>)        reader.SelectVoice(voiceName); } reader.SetOutputToWaveFile(tempFilePath, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpeechAudioFormatInfo(    <span class="hljs-number"><span class="hljs-number">16000</span></span>,    AudioBitsPerSample.Sixteen,    AudioChannel.Mono )); reader.Speak(text); reader.SetOutputToNull(); reader.Dispose();</code> </pre> <br>  The features of the code are as follows.  At the entrance to Skype you need to submit a wav-file with certain parameters, so the parameters are set explicitly.  GetInstalledVoices and SelectVoice methods are used to control SpeechSynthesizer voices. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Work with Skype is carried out through Skype4COM.  There are many examples on the Web, for example: <a href="http://habrahabr.ru/post/139319/">http://habrahabr.ru/post/139319/</a> .  All the examples that I looked at differ, in my opinion, with a complicated structure: the logic does not fit into one method, but is distributed between different methods and events.  I wanted to fit all the logic in one procedure for clarity. <br><br>  Connect to Skype.  The second parameter in skype.Attach is replaced by true.  This means that Skype will return control when the connection occurs. <br><pre> <code class="hljs pgsql">Skype skype = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Skype(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!skype.Client.IsRunning)    skype.Client.<span class="hljs-keyword"><span class="hljs-keyword">Start</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); skype.Attach(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre><br>  Call via Skype: <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> = skype.PlaceCall(target); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> {     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>.Status == TCallStatus.clsBusy        || <span class="hljs-keyword"><span class="hljs-keyword">call</span></span>.Status == TCallStatus.clsCancelled        || <span class="hljs-keyword"><span class="hljs-keyword">call</span></span>.Status == TCallStatus.clsFailed)        break;    <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Threading.Thread.Sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>.Status != TCallStatus.clsInProgress); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>.Status != TCallStatus.clsInProgress)    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br>  Playing a sound file.  An attempt was made to determine the time of sounding by the time when the file is busy and not available for recording. <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">call</span></span>.set_InputDevice(TCallIoDeviceType.callIoDeviceTypeFile, waveFilePath); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> {    <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Threading.Thread.Sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (IsBusy(waveFilePath));</code> </pre><br>  The IsBusy method looks like this: <br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {    using (FileStream stream = File.OpenWrite(filePath))    {        stream.Close();        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException) {    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><h2>  Description of 1C code </h2><br>  Initialization occurs in the event of the Opening Form form.  Creating an object .Net Bridge. <br><pre> <code class="1c hljs"><span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-string"><span class="hljs-string">"Elisy.NetBridge4"</span></span>); AddIn = New(<span class="hljs-string"><span class="hljs-string">"AddIn.ElisyNetBridge4"</span></span>); net = AddIn.GetNet();</code> </pre> <br>  Load assembly from GAC: <br><pre> <code class="1c hljs">net.LoadAssembly(<span class="hljs-string"><span class="hljs-string">"System.Speech, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"</span></span>);</code> </pre> <br>  Loading the assembly from the layout for processing: <br><pre> <code class="1c hljs"> = (<span class="hljs-string"><span class="hljs-string">"Elisy_SkypeSpeech_dll"</span></span>); <span class="hljs-type"><span class="hljs-type"></span></span> = Base64String(); assemblyBytes = net.CallStatic(<span class="hljs-string"><span class="hljs-string">"System.Convert"</span></span>, <span class="hljs-string"><span class="hljs-string">"FromBase64String"</span></span>, <span class="hljs-type"><span class="hljs-type"></span></span>); net.CallStatic(<span class="hljs-string"><span class="hljs-string">"System.Reflection.Assembly"</span></span>, <span class="hljs-string"><span class="hljs-string">"Load"</span></span>, assemblyBytes);</code> </pre> <br>  For the generation of sound and sending a voice message via Skype, the Elisy.SkypeSpeech.SkypeSpeech class is responsible.  Therefore, an object of this type must be created to access it. <br><pre> <code class="1c hljs">skypeSpeech = net.New(<span class="hljs-string"><span class="hljs-string">"Elisy.SkypeSpeech.SkypeSpeech"</span></span>);</code> </pre> <br>  The command to generate an audio file skypeSpeech.CreateSpeech.  The first parameter is the name of the file with the full path, the second parameter is the text of the message.  The third parameter is the name of the voice. <br><pre> <code class="1c hljs">skypeSpeech.CreateSpeech(tempFilePath, ., <span class="hljs-string"><span class="hljs-string">"ScanSoft Katerina_Full_22kHz"</span></span>);</code> </pre> <br>  The command to send a Skype voice message skypeSpeech.SendAudioMessage.  The first parameter is a phone number or Skype name.  The second parameter is the name of the audio file. <br><pre> <code class="1c hljs">skypeSpeech.SendAudioMessage(., tempFilePath);</code> </pre> <br><h2>  Known problems and solutions </h2><br>  The recorded audio file pronounces only words written in Latin letters, for example, Skype.  This means that the required Russian voice is not installed in the system or is not selected.  It must be installed.  If this voice is not ScanSoft Katerina Full 22kHz, then you need to correct the skypeSpeech.CreateSpeech call (PathFile, Object.Message, ‚ÄúScanSoft Katerina_Full_22kHz‚Äù) to the desired voice name. <br><br>  When you click "Call Skype TargetInvokationException with the message" Retrieving the class with the component {CLSID} {830690FC-BF2F-47A6-AC2D-330BCB402664} the class is not registered (Exception from HRESULT: 0x80040154 (REGDE_EE ). ".  This means that the library for accessing Skype skype4COM.dll is not properly registered.  It needs to be downloaded and registered with administrator rights through the regsvr32 skype4COM.dll. <br><br><h2>  What is not implemented </h2><br>  Processing works on the assumption that the transmission of a voice message will be carried out in the standard way: call - answer - message transfer - end of the call.  In the current version of processing there is no status analysis: delivered or not delivered.  For example, the phone at the subscriber may be busy or the subscriber began to listen to the message and independently interrupted the conversation. <br><br>  In 1C, the temporary file could not be deleted at the end of processing.  This is a strange phenomenon that could not be overcome, because in a test application through C # the temporary file was normally deleted. <br><br>  Example of the received audio file for ScanSoft Katerina_Full_22kHz: <a href="">audio.wav (180.78 kb)</a> <br>  Example of the received audio file for RHVoice Elena (Russian): <a href="">audio-rhvoice.wav (159.42 kb)</a> <br>  Example of the received audio file for RHVoice Aleksandr (Russian): <a href="">audio-rhvoice-alexandr.wav (196,76 kb)</a> <br><br><br>  Processing for 1C: Enterprise: <a href="">SkypeSpeech.epf (14,21 kb)</a> <br></div><p>Source: <a href="https://habr.com/ru/post/165883/">https://habr.com/ru/post/165883/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165873/index.html">IT specialists focus their resume on teamwork, hard work and analytical mind</a></li>
<li><a href="../165875/index.html">Tactile transforming keyboard for touchscreen displays presented at CES 2013</a></li>
<li><a href="../165877/index.html">Testing in Mail.Ru Group</a></li>
<li><a href="../165879/index.html">Algorithms for the struggle of Ukrainian IT specialists with VAT</a></li>
<li><a href="../165881/index.html">System of automatic assembly of mobile applications Alawar Build System</a></li>
<li><a href="../165887/index.html">Shield and sword in RBS systems. Applied solution</a></li>
<li><a href="../165893/index.html">The brightest events of the gaming industry 2012-2013 | Video digest Geek Week, special issue</a></li>
<li><a href="../165895/index.html">Extra join in SQL queries</a></li>
<li><a href="../165897/index.html">Substitution DSDT via GRUB2</a></li>
<li><a href="../165899/index.html">Metadata for organizing photo archive storage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>