<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>[Arch Linux] Configuring a bunch of Apache, Nginx, PHP and Percona DB</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After moving from Ubuntu to Arch, there was a need to configure this bundle, however, unlike Ubuntu, under Arch there wasn‚Äôt such a manual. Having col...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>[Arch Linux] Configuring a bunch of Apache, Nginx, PHP and Percona DB</h1><div class="post__text post__text-html js-mediator-article">  After moving from Ubuntu to Arch, there was a need to configure this bundle, however, unlike Ubuntu, under Arch there wasn‚Äôt such a manual.  Having collected ideas from various manuals, including those that were written under Ubuntu, and decided to write such a solid guide for Habr. <br><br>  Just want to say that this is a basic installation, without virtual hosts in the number of n-pieces, just setting up for local development. <br><br>  XAMPP didn't suit me just for ideological reasons. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  So let's get started. </h4><br><br>  It is assumed that <a href="https://wiki.archlinux.org/index.php/Yaourt_%2528%25D0%25A0%25D1%2583%25D1%2581%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9%2529">yaourt is</a> already installed and you know how to use it at least a little, and also the execution of root commands from your user is set up (set <a href="https://wiki.archlinux.org/index.php/Sudo">sudo</a> package, then uncomment the line "% wheel ALL = (ALL) ALL" in the file / etc / sudoers and relogin; when executing commands with sudo, we enter the password from our user, not from root). <br><br>  Also, before installing directly, make sure that you have connected extra-and community-repositories. <br>  For this: <br><br> <code>sudo nano /etc/pacman.conf</code> <br> <br>  And we check that the sections of these repositories look the same. <br><br> <code>[extra]</code> <br> <code>#SigLevel = PackageOptional</code> <br> <code>Include = /etc/pacman.d/mirrorlist</code> <br> <code>[community]</code> <br> <code>#SigLevel = PackageOptional</code> <br> <code>Include = /etc/pacman.d/mirrorlist</code> <br> <br>  And synchronize the package lists. <br><br> <code>sudo pacman -Sy</code> <br> <br><a name="habracut"></a><br><br><h5>  First we install Apache and PHP and, accordingly, fix the configs a bit. </h5><br><br> <code>sudo pacman -S apache php-apache</code> <br> <code>yaourt mod-rpaf</code> <br> <br>  Now we need to edit /etc/httpd/conf/httpd.conf: include 2 modules for apache - rpaf and php5, plus add configuration for rpaf and a few more details. <br><br> <code>sudo nano /etc/httpd/conf/httpd.conf</code> <br> <br><ol><li>  We change ‚ÄúListen 80‚Äù to ‚ÄúListen 81‚Äù, since port 80 will listen to nginx. </li><li>  Add 2 lines to the LoadModule section. <br> <code>LoadModule rpaf_module modules/mod_rpaf-2.0.so</code> <br> <code>LoadModule php5_module modules/libphp5.so</code> <br> </li><li>  You can change the email in the ‚ÄúServerAdmin‚Äù line, although this is an optional item.  I usually change out of habit. </li><li>  Just below is the commented line "ServerName" - uncomment and replace with "ServerName 127.0.0.1:81" </li><li>  We check that the "TypesConfig conf / mime.types" line is not commented out in the "&lt;IfModule mime_module&gt;" section </li><li>  Let's also comment on the line ‚ÄúMIMEMagicFile conf / magic‚Äù </li><li>  In the section "&lt;IfModule dir_module&gt;" we replace the line with the parameter "DirectoryIndex" to the following form: <br> <code>DirectoryIndex index.php</code> </li> <li>  And finally, at the end of the file we add. <br> <code>Include conf/extra/php5_module.conf</code> <br> <code>RPAFenable On</code> <br> <code>RPAFproxy_ips 127.0.0.1 10.0.0.1</code> <br> <code>RPAFsethostname On</code> <br> <code>RPAFheader X-Forwarded-For</code> <br> </li></ol><br><br>  Save the file (Ctrl + O) and exit (Ctrl + X). <br><br>  Now we have the second Apache configuration file left a little bit to change. <br><br> <code>sudo nano /etc/httpd/conf/ports.conf</code> <br> <br>  Change "Listen 80" to "Listen 81". <br><br><h5>  On this with the setting of Apache, we are finished.  Go to PHP. </h5><br><br> <code>sudo nano /etc/php/php.ini</code> <br> <br><ol><li>  Customize ‚Äúpost_max_size‚Äù.  Usually, 60M is quite enough, and even a lot less - look at the situation.  Similarly, we configure ‚Äúupload_max_filesize‚Äù and ‚Äúmax_file_uploads‚Äù. </li><li>  Turn on the modules.  There can be no single solution, but my option for most needs should be enough ( <a href="http://pastebin.com/cZwepL0T">http://pastebin.com/cZwepL0T</a> ).  If any additional modules are needed that are not in the list, first of all we are looking at yaourt. </li><li>  I advise you to uncomment and configure "date.timezone" ( <a href="http://php.net/date.timezone">http://php.net/date.timezone</a> ). </li><li>  Uncomment the line ‚Äúsession.save_path =‚Äû / tmp ‚Äú. </li></ol><br><br>  Save the file (Ctrl + O) and exit (Ctrl + X). <br><br>  Restart apache. <br> <code>sudo rc.d restart httpd</code> <br> <br>  Next to check create a file index.php.  (Here we enter the password not from our user, but from root.) <br><br> <code>su -c "echo '&lt;?php phpinfo(); ?&gt;' &gt; /srv/http/index.php"</code> <br> <br>  After that, if you go to <a href="http://localhost:81/">http: // localhost: 81 /</a> , you should see a page with full information about PHP and Apache.  Something like that. <br><br><img src="https://habrastorage.org/storage2/d9f/7a1/bdb/d9f7a1bdb6937c833b7a05c2762217aa.png"><br><br><h5>  Moving on to installing and configuring NGINX </h5><br><br>  Install the latest (dev-branch) version.  If you want a stable one, simply write ‚Äûsudo pacman -S nginx‚Äú instead of the command below. <br><br> <code>yaourt nginx-devel</code> <br> <br>  And we will bring the config view to the following form. <br><br> <code>sudo nano /etc/nginx/conf/nginx.conf</code> <br> <br>  Erase everything and copy everything from here - <a href="http://pastebin.com/2S8KnqkH">http://pastebin.com/2S8KnqkH</a> . <br><br>  And restart nginx. <br><br> <code>sudo rc.d restart nginx</code> <br> <br>  Now, you can go on port 80 and you should also see information about php, as it was before ( <a href="http://localhost/">http: // localhost</a> ). <br><br><h5>  And the last step - installing PerconaDB </h5><br><br>  As you know, MySQL itself is far from being the smartest database, so I usually install a fork - PerconaDB.  In more detail about features you can read on the <a href="http://www.percona.com/software/percona-server/benchmarks/">official site</a> , from myself unless I can say that MySQL has backward compatibility, so there will be no unexpected problems. <br><br> <code>sudo pacman -S percona-server</code> <br> <br>  And set up a password for the administrative user PerconaDB. <br><br> <code>mysql_secure_installation</code> <br> <br><h4>  That's how we got a fairly smart config of the local web server.  I hope this topic will be useful to someone. </h4><br><br>  ps if there are any suggestions for improving the material - write in the comments. <br>  pps does not leave me feeling that the section "gzip_types" in the nginx config is not quite optimal - so I will also listen to the suggestions. <br><br><h5>  Forgot to write about autoloading services at OS startup </h5><br><br> <code>sudo nano /etc/rc.conf</code> <br> <br>  And at the very bottom of the file in the array "DAEMONS" we add: <br><br> <code>@nginx @httpd @mysqld</code> </div><p>Source: <a href="https://habr.com/ru/post/140537/">https://habr.com/ru/post/140537/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140529/index.html">AlsaMixer for Android</a></li>
<li><a href="../140532/index.html">Review of the beta version of Adobe Photoshop CS6</a></li>
<li><a href="../140533/index.html">New robot from DARPA</a></li>
<li><a href="../140535/index.html">Cardsharing: Transmission of DW codes over the network</a></li>
<li><a href="../140536/index.html">Debugging C programs for beginners</a></li>
<li><a href="../140538/index.html">Alternative ending Mass Effect 3 - a dangerous example for the gaming industry</a></li>
<li><a href="../140539/index.html">NoName Podcast S04E05</a></li>
<li><a href="../140540/index.html">Virtual round table</a></li>
<li><a href="../140543/index.html">Meet the release of Django 1.4</a></li>
<li><a href="../140545/index.html">What to expect from WordPress 3.4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>