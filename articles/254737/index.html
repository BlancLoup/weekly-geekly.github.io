<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Talking panda or what can be done with FFmpeg and OpenCV on Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This publication is about how you can compile a library for processing video and audio FFmpeg for Android in Eclipse using NDK in Windows. You will le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Talking panda or what can be done with FFmpeg and OpenCV on Android</h1><div class="post__text post__text-html js-mediator-article">  This publication is about how you can compile a library for processing video and audio FFmpeg for Android in Eclipse using NDK in Windows.  You will learn how to associate FFmpeg with the OpenCV image processing library and how this can all be used in the Java code of an Android application.  All this will be described in the context of the process of creating an Android application, the main functionality of which is precisely tied to the use of these libraries and their interaction.  So, I ask those interested under the cat. <br><a name="habracut"></a><br><h2>  Disclaimer </h2><br>  Some of the things described will surely seem obvious to many, however, for me, as a developer for Windows, these tasks turned out to be new and their solution was not obvious, so I tried to make the description of technical details as simple and understandable for people who do not have much experience. work with Android NDK and everything connected with it.  Some solutions were found intuitively, and therefore, most likely, they are not quite ‚Äúbeautiful‚Äù. <br><br><h2>  Prehistory </h2><br>  The idea of ‚Äã‚Äãan Android application, where FFmpeg and OpenCV would be used, appeared after watching a single ad for Vitituas mineral water (you can search on Youtube).  In this video, sometimes flashed photos of various animals that rotated with human eyes, moved their lips and persuaded the viewer to buy this water.  It looked pretty funny.  In general, the thought arose: what if you give the user the opportunity to make such videos himself, and not from a computer, but with the help of his phone? <br><br>  Of course, they first looked for analogues.  Something more or less similar was found in the AppStore for the iPhone, and there the process of creating a video was not very successful: you choose a picture, mark one area on it, and then you shoot something in that area, that is, to put on the picture in different places at least two eyes and no mouth at all.  On Google Play, there was nothing like that at all.  The closest programs with similar functionality were those where the photo can be superimposed animated elements from limited sets. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In a word, there are few competitors, so the decision was made to make the application. <br><br><h2>  Choice of technology </h2><br>  Immediately a logical question arose: ‚ÄúHow can we do all this?‚Äù.  After spending two days studying all sorts of libraries for video and image processing, I stopped at FFmpeg and OpenCV. <br><br>  Of the benefits you can list the following: <br><ul><li>  both libraries are written in C / C ++, that is, it is theoretically possible to combine them; </li><li>  Free open source: FFmpeg can be built under the LGPL, and OpenCV is generally distributed under the BSD license; </li><li>  very fast, and generally cool on which side do not look. </li></ul><br>  Of the minuses: <br><ul><li>  written in C / C ++; </li><li>  yet FFmpeg is complicated in order to quickly figure out in its code and understand where it is necessary what to change. </li></ul><br>  The usage pattern loomed like this: OpenCV forms each frame of a video series (for example, places it on a picture, eyes and mouth), transmits this frame in some way to FFmpeg, and that in turn forms a video stream from these frames, simultaneously not forgetting about audio. <br><br>  I have to admit that since there was little development experience under Android, and a lot under Windows, before starting to tinker with Eclipse and NDK, I made a small program in Visual Studio, which proved that the very idea of ‚Äã‚Äãusing FFmpeg and OpenCV has the right to life and, most importantly, there is a way to realize their interaction.  But the implementation of the interaction of these libraries will be written a little later, and this is rather an easy recommendation on the fact that it is better to spend time and test some idea on technologies that you understand best than to immediately go into something new. <br><br>  As for compiling FFmpeg in Visual Studio - it was surprisingly easy to do, but this article is still about Android, so if the FFmpeg topic in Visual Studio is interesting, write about it and I will try to find time and write instructions on how to do it. to do. <br><br>  So, having checked that the idea to integrate FFmpeg and OpenCV is working, I started developing the Android application directly. <br><br>  The plan was: <br><ol><li>  Compile and build FFmpeg and OpenCV for Android. </li><li>  We write the code of their interaction. </li><li>  We use this all in Java application code. </li></ol><br><br>  I decided to do all this in Eclipse, and not in Android Studio - at the time of its development, it somehow seemed damp and not very convenient to me. <br><br><h2>  FFmpeg, Android, NDK, Eclipse, Windows </h2><br>  First of all, like all normal people, I began to search the Internet for instructions on how to cross-compile FFmpeg for Android on Windows.  There are articles, even some make-files are offered, there is something on the githaba, but according to them I could not do it.  Perhaps because of the lack of experience with this all, perhaps because of errors in these instructions and makefiles.  Usually such instructions are written by a person who is well versed in the technologies being described and therefore omits some ‚Äúobvious‚Äù nuances, and it turns out that it is impossible for a beginner to use it. <br><br>  In general, I had to do everything myself from scratch.  The following is an approximate sequence of actions. <br><br><h3>  0. Presets </h3><br>  Download and install: Eclipse with CDT, Android SDK, NDK, cygwin and OpenCV Android SDK.  If there is a need to support Android on x86, then you should also download yasm - you need it to cross-compile * .asm files, but more on that later. <br><br>  Instructions for installing and configuring this are all on the sites from where they are actually downloaded, and there is a great article on google opencv.org about installing and configuring NDK in Eclipse, which is issued in Google on the request ‚ÄúOpenCV Introduction into Android Development‚Äù, be sure on her. <br><br><h3>  1. Prepare the project </h3><br>  Create a new Android application project in Eclipse and convert it to a C / C ++ project (see the article ‚ÄúOpenCV Introduction into Android Development‚Äù).  In fact, the Android project will not convert completely to C / C ++, and it will simply add the ability to work with C / C ++. <br><br>  Download and unpack the archive with the code FFmpeg from the site ffmpeg.org.  The folder with the code of the form ‚Äúffmpeg-2.6.1‚Äù is thrown into the ‚Äújni‚Äù folder of the project (if it is not there, create it in the same place where ‚Äúres‚Äù, ‚Äúscr‚Äù, etc. are located). <br><br>  Now you need to create configuration files (the most important of them is ‚Äúconfig.h‚Äù) and makefiles for FFmpeg.  Here comes the first nuance: there are three platforms for Android devices - Arm, x86, MIPS.  For each of these architectures, you need to build your * .so library files (similar to * .dll in Windows).  NDK allows you to do this - it includes a compiler and linker for each platform. <br><br>  In order to generate configuration files in FFmpeg there is a special script, to run which we needed to install cygwin.  So, run the Cygwin Terminal command line and enter the following command sets. <br><br><div class="spoiler">  <b class="spoiler_title">Bash scripts with explanations</b> <div class="spoiler_text">  For ARM devices: <br><pre><code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> D: $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> MyProject/jni/ffmpeg-2.1.3/ $ PREBUILT=D:/ndk/android-ndk-r9c/toolchains/arm-linux-androideabi-4.6/prebuilt/windows-x86_64 $ PLATFORM=D:/ndk/android-ndk-r9c/platforms/android-8/arch-arm $ TMPDIR=D:/ $ ./configure --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-version3 --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-shared --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-static --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-ffmpeg --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-ffplay --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-ffprobe --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-ffserver --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-network --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-cross-compile --target-os=linux --arch=arm --cross-prefix=<span class="hljs-variable"><span class="hljs-variable">$PREBUILT</span></span>/bin/arm-linux-androideabi- --cc=<span class="hljs-variable"><span class="hljs-variable">$PREBUILT</span></span>/bin/arm-linux-androideabi-gcc --ld=<span class="hljs-variable"><span class="hljs-variable">$PREBUILT</span></span>/bin/arm-linux-androideabi-ld --tempprefix=D:/</code> </pre> <br>  For x86 devices: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> D: $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> MyProject/jni/ffmpeg-2.1.3/ $ PREBUILT=D:/ndk/android-ndk-r9c/toolchains/x86-4.6/prebuilt/windows-x86_64 $ PLATFORM=D:/ndk/android-ndk-r9c/platforms/android-9/arch-x86 $ TMPDIR=D:/ $ ./configure --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-version3 --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-shared --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-static --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-ffmpeg --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-ffplay --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-ffprobe --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-ffserver --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-network --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-cross-compile --target-os=linux --arch=x86 --cross-prefix=<span class="hljs-variable"><span class="hljs-variable">$PREBUILT</span></span>/bin/i686-linux-android- --cc=<span class="hljs-variable"><span class="hljs-variable">$PREBUILT</span></span>/bin/i686-linux-android-gcc --ld=<span class="hljs-variable"><span class="hljs-variable">$PREBUILT</span></span>/bin/i686-linux-android-ld --tempprefix=D:/</code> </pre><br>  For MIPS devices: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> D: $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> MyProject/jni/ffmpeg-2.1.3/ $ PREBUILT=D:/ndk/android-ndk-r9c/toolchains/mipsel-linux-android-4.6/prebuilt/windows-x86_64 $ PLATFORM=D:/ndk/android-ndk-r9c/platforms/android-9/arch-mips $ TMPDIR=D:/ $ ./configure --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-version3 --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-shared --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-static --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-ffmpeg --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-ffplay --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-ffprobe --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-ffserver --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-network --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-cross-compile --target-os=linux --arch=mips --cross-prefix=<span class="hljs-variable"><span class="hljs-variable">$PREBUILT</span></span>/bin/mipsel-linux-android- --cc=<span class="hljs-variable"><span class="hljs-variable">$PREBUILT</span></span>/bin/mipsel-linux-android-gcc --ld=<span class="hljs-variable"><span class="hljs-variable">$PREBUILT</span></span>/bin/mipsel-linux-android-ld --tempprefix=D:/</code> </pre><br>  Explanations: <br><ol><li>  The first two commands - go to the folder with the FFmpeg code, where the ‚Äúconfigure‚Äù file is located - this is the bash script that generates the files we need, including the ‚Äúconfig.h‚Äù, which is used during compilation; </li><li>  Next, we create three temporary environment variables PREBUILT, PLATFORM, TMPDIR, the first two record the paths to the folders in the NDK, where the utilities for cross-compiling for different platforms are located, if you enter these folders, there will be a folder among the many folders bin ‚Äù, the compiler and linker lie in it.  TMPDIR - path to a temporary folder where the script will keep its temporary files while working; </li><li>  The last command is actually launching the ‚Äúconfigure‚Äù script from the ‚Äúffmpeg-2.6.1‚Äù folder with parameters.  A list of all possible script parameters with explanations is displayed using the ‚Äú./configure -h‚Äù command.  Below is a description of the parameters we use: <br><ul><li>  --enable-version3 parameter - we tell the script to generate such a configuration file so that it can be used to compile the FFmpeg libraries that will be licensed under the LGPL 3.0; </li><li>  --enable-shared and --disable-static parameters - we tell the script that we want to get * .so files on the output.  Having done this, then in theory, coupled with the LGPL, we will be able to link them to our code to which the LGPL will not apply; </li><li>  parameters --disable-ffmpeg --disable-ffplay --disable-ffprobe --disable-ffserver --disable-network - with these parameters we tell the script that we do not need to create console programs (in other words, ffmpeg.exe, ffplay.exe other); </li><li>  the remaining parameters are clear in their names - we say that we want to do cross-compilation, assign the platform (linux arm, mips or x86), prescribe the script path to the compiler and linker, set the path to the temporary folder. </li></ul></li></ol></div></div><br>  The script will generate in the jni / ffmpeg-2.1.3 folder a file ‚Äúconfig.h‚Äù, ‚Äúconfig.asm‚Äù and several make-files. <br><br><h3>  2. Makefiles, compilation and build </h3><br>  So, at this stage, we already have: the Android application project in Eclipse, in the jni / ffmpeg-2.1.3 folder is the code from FFmpeg, and we have just generated the file ‚Äúconfig.h‚Äù we need.  Now you need to make makefiles so that all this can be compiled and get * .so files that we can use in the Android application. <br><br>  I tried to use compile generated script files, but I failed, most likely because of the curvature of the hands.  So I decided to make my own makefiles with comments and inclusions. <br><br>  To compile with NDK, you need at least two makefiles: Android.mk and Application.mk, which should be located in the jni folder of the project.  Application.mk usually contains no more than a dozen parameters and adjusts, so to speak, the ‚Äúglobal‚Äù compilation parameters.  Android.mk is responsible for everything else. <br><br>  There are also a number of points related to some errors at the time of compilation.  They were solved either with the help of Google, or with a correction based on information provided by the NDK in the console (errors are well formulated and fixing them should not be difficult).  Unfortunately, I can‚Äôt give everything here (I forgot to correct it corny), but here‚Äôs a list of some: <br><ul><li>  the compiler swears at the symbol ‚Äúav_restrict‚Äù: you must open the file ‚Äúconfig.h‚Äù in the folder ‚Äúffmpeg-2.1.3‚Äù and replace the line ‚Äú# define av_restrict restrict‚Äù with ‚Äú# define av_restrict __restrict‚Äù; </li><li>  on some machines, the compiler swears at ‚Äúgetenv ()‚Äù: this is solved by commenting the line ‚Äúextern char * getenv (const char *);‚Äù in the file ‚Äúndk \ android-ndk-r9c \ platforms \ android-9 \ arch-arm \ usr \ include \ stdlib.h ".  Pay attention to the path - it has a folder dependent on the target architecture: ‚Äúarch-arm‚Äù if you compile for Arm, ‚Äúarch-mips‚Äù for MIPS and ‚Äúarch-x86‚Äù for x86; </li><li>  to avoid conflicts, it is better to rename the main () function in ffmpeg_main () in the ffmpeg.c file.  We will call it from the Java code of the Android application. </li></ul><br>  When compiling, there were a couple of errors directly in the code of some of the FFmpeg files.  I just commented on this place (of course, more or less making sure that it does not break).  For example, some places where something is displayed on the console.  Maybe there was something else and, unfortunately, I don‚Äôt remember, but in fact compilation errors are easily fixable. <br><br><div class="spoiler">  <b class="spoiler_title">Makefiles and bat-scripts with explanations.</b> <div class="spoiler_text">  Nuances: <br><ul><li>  In addition to the FFmpeg library modules directly, such as libavcodec, libavfilter, and so on, we will also need to compile the code for the ffmpeg.exe program itself as the ffmpeg.so library.  We will call its main () function (which we renamed to ffmpeg_main ()) from the Java code and pass the parameters we need there, and it will do the necessary work for us; </li><li>  NDK cannot compile * .asm files for the x86 architecture, so we need to first compile with the help of yasm * .asm files that are in folders like "jni \ ffmpeg-2.1.3 \ libavcodec \ x86", "jni \ ffmpeg- 2.1.3 \ libavfilter \ x86 "and so on.  Below are the * .bat files that do this.  At the output we will get the object files * .a, the path to which we will indicate the linker when compiling under x86.  This should only be done if you are going to support this architecture; </li><li>  In the makefile for almost every module, another makefile of the form ‚Äúlibavfilter_ignore.mk‚Äù is included.  For each module, they contain * .c files that should not be compiled.  What kind of files: some of them, as I understood from the content, something like test programs (like, for example, mpegaudio_tablegen.c).  Some of them are not intended for compilation, but are simply connected via include (for example, h264qpel_template.c is included in the h264qpel.c file).  Surely in the make-files generated after running the confgiure script (with which I didn‚Äôt work out) they are also ignored; </li><li>  The makefile also includes the assembly of the OpenCV module.  Everything is simple there, read the article on the opencv.org website called ‚ÄúOpenCV Introduction into Android Development‚Äù.  It is necessary for just for the mentioned interaction FFmpeg-OpenCV.  This interaction will be described below; </li><li>  All modules of FFmpeg from scratch I have a half hour.  During development it is simply impossible to work, especially if you often have to change something in some kind of FFmpeg module.  To avoid this, another makefile will be shown below.  In it, only one FFmpeg module will be compiled from scratch, and the rest will be used previously compiled.  For example, you work in the libavfilter module, program something there and change it all the time, you don‚Äôt have to constantly rebuild libavcodec and others, you just have to compile it and specify it in the make-file as necessary; </li><li>  There are explanatory comments in the makefile, but since there are a few modules compiled, and the compilation procedure is similar, the duplicate commands in the makefile are not explained. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Android.mk - from it NDK takes a list of code files to compile</b> <div class="spoiler_text"><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">################################################################################ #    LOCAL_PATH    LOCAL_PATH := $(call my-dir) #    FFMPEG_DIR      FFmpeg FFMPEG_DIR := ffmpeg-2.1.3 #    OPENCVROOT     OpenCV Anroid SDK OPENCVROOT := D:\OpenCV-2.4.7.1-android-sdk #         x86 #   ,   x86         FFmpeg  #   NDK    *.asm ,        yasm #       yasm   *.asm     *.a ,       #   *.asm    bat- ifeq ($(TARGET_ARCH),x86) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := avcodec_asm LIBAVCODEC_ASM_A_FILE_PATH := $(LOCAL_PATH)/../obj/local/x86/objs/avcodec/ffmpeg-2.1.3/libavcodec/x86/libavcodec_asm.a LOCAL_SRC_FILES := $(subst jni/,,$(LIBAVCODEC_ASM_A_FILE_PATH)) include $(PREBUILT_STATIC_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := avfilter_asm LIBAVFILTER_ASM_A_FILE_PATH := $(LOCAL_PATH)/../obj/local/x86/objs/avfilter/ffmpeg-2.1.3/libavfilter/x86/libavfilter_asm.a LOCAL_SRC_FILES := $(subst jni/,,$(LIBAVFILTER_ASM_A_FILE_PATH)) include $(PREBUILT_STATIC_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := avresample_asm LIBAVRESAMPLE_ASM_A_FILE_PATH := $(LOCAL_PATH)/../obj/local/x86/objs/avresample/ffmpeg-2.1.3/libavresample/x86/libavresample_asm.a LOCAL_SRC_FILES := $(subst jni/,,$(LIBAVRESAMPLE_ASM_A_FILE_PATH)) include $(PREBUILT_STATIC_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := avutil_asm LIBAVUTIL_ASM_A_FILE_PATH := $(LOCAL_PATH)/../obj/local/x86/objs/avutil/ffmpeg-2.1.3/libavutil/x86/libavutil_asm.a LOCAL_SRC_FILES := $(subst jni/,,$(LIBAVUTIL_ASM_A_FILE_PATH)) include $(PREBUILT_STATIC_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := swresample_asm LIBSWRESAMPLE_ASM_A_FILE_PATH := $(LOCAL_PATH)/../obj/local/x86/objs/swresample/ffmpeg-2.1.3/libswresample/x86/libswresample_asm.a LOCAL_SRC_FILES := $(subst jni/,,$(LIBSWRESAMPLE_ASM_A_FILE_PATH)) include $(PREBUILT_STATIC_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := swscale_asm LIBSWSCALE_ASM_A_FILE_PATH := $(LOCAL_PATH)/../obj/local/x86/objs/swscale/ffmpeg-2.1.3/libswscale/x86/libswscale_asm.a LOCAL_SRC_FILES := $(subst jni/,,$(LIBSWSCALE_ASM_A_FILE_PATH)) include $(PREBUILT_STATIC_LIBRARY) ################################################################################ endif #   -  FFmpeg ################################################################################ #   FFmpeg avutils.so #         include $(CLEAR_VARS) #          *.asm, *.c  ..    #      "$(TARGET_ARCH)" -            #   ffmpeg       ,      LIBAVUTIL_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/$(TARGET_ARCH)/*.asm) LIBAVUTIL_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/$(TARGET_ARCH)/*.c) LIBAVUTIL_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/$(TARGET_ARCH)/*.S) LIBAVUTIL_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/*.asm) LIBAVUTIL_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/*.c) LIBAVUTIL_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/*.S) LIBAVUTIL_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/*.cpp) # ,             NDK ,       #            "jni/"    LIBAVUTIL_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBAVUTIL_LIB_ARCH_ASM_FILES)) LIBAVUTIL_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBAVUTIL_LIB_ARCH_C_FILES)) LIBAVUTIL_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBAVUTIL_LIB_ARCH_S_FILES)) LIBAVUTIL_LIB_ASM_FILES := $(subst jni/,,$(LIBAVUTIL_LIB_ASM_FILES)) LIBAVUTIL_LIB_C_FILES := $(subst jni/,,$(LIBAVUTIL_LIB_C_FILES)) LIBAVUTIL_LIB_S_FILES := $(subst jni/,,$(LIBAVUTIL_LIB_S_FILES)) LIBAVUTIL_LIB_CPP_FILES := $(subst jni/,,$(LIBAVUTIL_LIB_CPP_FILES)) #    make-,    ,    ,    include $(LOCAL_PATH)/libavutil_ignore.mk #      ,    LIBAVUTIL_FILES        avutils,    LIBAVUTIL_FILES := $(sort $(LIBAVUTIL_LIB_ARCH_ASM_FILES)) $(sort $(LIBAVUTIL_LIB_ARCH_C_FILES)) $(sort $(LIBAVUTIL_LIB_ARCH_S_FILES)) $(sort $(LIBAVUTIL_LIB_ASM_FILES)) $(sort $(LIBAVUTIL_LIB_C_FILES)) $(sort $(LIBAVUTIL_LIB_S_FILES)) $(sort $(LIBAVUTIL_LIB_CPP_FILES)) #       #     LOCAL_SRC_FILES := $(LIBAVUTIL_FILES) #      LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/$(TARGET_ARCH) # -  FFmpeg      zlib  log,      LOCAL_LDLIBS += -lz -llog #   ,      libavutil.so LOCAL_MODULE := avutil #  ,   TARGET_ARCH            #         LOCAL_CFLAGS     #       ,   .. ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fpic -DANDROID #      x86    yasm   LOCAL_STATIC_LIBRARIES += avutil_asm else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif #     make-  NDK,    shared-,  *.so  include $(BUILD_SHARED_LIBRARY) ################################################################################ #   FFmpeg avcodec.so include $(CLEAR_VARS) LIBAVCODEC_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/$(TARGET_ARCH)/*.asm) LIBAVCODEC_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/$(TARGET_ARCH)/*.c) LIBAVCODEC_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/$(TARGET_ARCH)/*.S) LIBAVCODEC_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/*.asm) LIBAVCODEC_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/*.c) LIBAVCODEC_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/*.S) LIBAVCODEC_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/*.cpp) LIBAVCODEC_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBAVCODEC_LIB_ARCH_ASM_FILES)) LIBAVCODEC_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBAVCODEC_LIB_ARCH_C_FILES)) LIBAVCODEC_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBAVCODEC_LIB_ARCH_S_FILES)) LIBAVCODEC_LIB_ASM_FILES := $(subst jni/,,$(LIBAVCODEC_LIB_ASM_FILES)) LIBAVCODEC_LIB_C_FILES := $(subst jni/,,$(LIBAVCODEC_LIB_C_FILES)) LIBAVCODEC_LIB_S_FILES := $(subst jni/,,$(LIBAVCODEC_LIB_S_FILES)) LIBAVCODEC_LIB_CPP_FILES := $(subst jni/,,$(LIBAVCODEC_LIB_CPP_FILES)) include $(LOCAL_PATH)/libavcodec_ignore.mk LIBAVCODEC_FILES := $(sort $(LIBAVCODEC_LIB_ARCH_ASM_FILES)) $(sort $(LIBAVCODEC_LIB_ARCH_C_FILES)) $(sort $(LIBAVCODEC_LIB_ARCH_S_FILES)) $(sort $(LIBAVCODEC_LIB_ASM_FILES)) $(sort $(LIBAVCODEC_LIB_C_FILES)) $(sort $(LIBAVCODEC_LIB_S_FILES)) $(sort $(LIBAVCODEC_LIB_CPP_FILES)) LOCAL_SRC_FILES := $(LIBAVCODEC_FILES) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/$(TARGET_ARCH) LOCAL_LDLIBS += -lz -llog #    ffmpeg   ,              , #  ,      ,     -  LOCAL_SHARED_LIBRARIES += libavutil LOCAL_MODULE := avcodec ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fno-pic -DANDROID LOCAL_STATIC_LIBRARIES += avutil_asm avcodec_asm LOCAL_SHARED_LIBRARIES += libavutil_asm libavcodec_asm else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #   FFmpeg avformat.so include $(CLEAR_VARS) LIBAVFORMAT_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/$(TARGET_ARCH)/*.asm) LIBAVFORMAT_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/$(TARGET_ARCH)/*.c) LIBAVFORMAT_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/$(TARGET_ARCH)/*.S) LIBAVFORMAT_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/*.asm) LIBAVFORMAT_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/*.c) LIBAVFORMAT_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/*.S) LIBAVFORMAT_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/*.cpp) LIBAVFORMAT_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBAVFORMAT_LIB_ARCH_ASM_FILES)) LIBAVFORMAT_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBAVFORMAT_LIB_ARCH_C_FILES)) LIBAVFORMAT_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBAVFORMAT_LIB_ARCH_S_FILES)) LIBAVFORMAT_LIB_ASM_FILES := $(subst jni/,,$(LIBAVFORMAT_LIB_ASM_FILES)) LIBAVFORMAT_LIB_C_FILES := $(subst jni/,,$(LIBAVFORMAT_LIB_C_FILES)) LIBAVFORMAT_LIB_S_FILES := $(subst jni/,,$(LIBAVFORMAT_LIB_S_FILES)) LIBAVFORMAT_LIB_CPP_FILES := $(subst jni/,,$(LIBAVFORMAT_LIB_CPP_FILES)) include $(LOCAL_PATH)/libavformat_ignore.mk LIBAVFORMAT_FILES := $(sort $(LIBAVFORMAT_LIB_ARCH_ASM_FILES)) $(sort $(LIBAVFORMAT_LIB_ARCH_C_FILES)) $(sort $(LIBAVFORMAT_LIB_ARCH_S_FILES)) $(sort $(LIBAVFORMAT_LIB_ASM_FILES)) $(sort $(LIBAVFORMAT_LIB_C_FILES)) $(sort $(LIBAVFORMAT_LIB_S_FILES)) $(sort $(LIBAVFORMAT_LIB_CPP_FILES)) LOCAL_SRC_FILES := $(LIBAVFORMAT_FILES) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/$(TARGET_ARCH) LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil libavcodec LOCAL_MODULE := avformat ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fpic -DANDROID else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #   FFmpeg swscale.so include $(CLEAR_VARS) LIBSWSCALE_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/$(TARGET_ARCH)/*.asm) LIBSWSCALE_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/$(TARGET_ARCH)/*.c) LIBSWSCALE_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/$(TARGET_ARCH)/*.S) LIBSWSCALE_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/*.asm) LIBSWSCALE_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/*.c) LIBSWSCALE_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/*.S) LIBSWSCALE_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/*.cpp) LIBSWSCALE_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBSWSCALE_LIB_ARCH_ASM_FILES)) LIBSWSCALE_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBSWSCALE_LIB_ARCH_C_FILES)) LIBSWSCALE_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBSWSCALE_LIB_ARCH_S_FILES)) LIBSWSCALE_LIB_ASM_FILES := $(subst jni/,,$(LIBSWSCALE_LIB_ASM_FILES)) LIBSWSCALE_LIB_C_FILES := $(subst jni/,,$(LIBSWSCALE_LIB_C_FILES)) LIBSWSCALE_LIB_S_FILES := $(subst jni/,,$(LIBSWSCALE_LIB_S_FILES)) LIBSWSCALE_LIB_CPP_FILES := $(subst jni/,,$(LIBSWSCALE_LIB_CPP_FILES)) include $(LOCAL_PATH)/libswscale_ignore.mk LIBSWSCALE_FILES := $(sort $(LIBSWSCALE_LIB_ARCH_ASM_FILES)) $(sort $(LIBSWSCALE_LIB_ARCH_C_FILES)) $(sort $(LIBSWSCALE_LIB_ARCH_S_FILES)) $(sort $(LIBSWSCALE_LIB_ASM_FILES)) $(sort $(LIBSWSCALE_LIB_C_FILES)) $(sort $(LIBSWSCALE_LIB_S_FILES)) $(sort $(LIBSWSCALE_LIB_CPP_FILES)) LOCAL_SRC_FILES := $(LIBSWSCALE_FILES) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/$(TARGET_ARCH) LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil LOCAL_MODULE := swscale ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fno-pic -DANDROID LOCAL_STATIC_LIBRARIES += avutil_asm swscale_asm else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #   FFmpeg postproc.so include $(CLEAR_VARS) LIBPOSTPROC_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/$(TARGET_ARCH)/*.asm) LIBPOSTPROC_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/$(TARGET_ARCH)/*.c) LIBPOSTPROC_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/$(TARGET_ARCH)/*.S) LIBPOSTPROC_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/*.asm) LIBPOSTPROC_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/*.c) LIBPOSTPROC_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/*.S) LIBPOSTPROC_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/*.cpp) LIBPOSTPROC_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBPOSTPROC_LIB_ARCH_ASM_FILES)) LIBPOSTPROC_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBPOSTPROC_LIB_ARCH_C_FILES)) LIBPOSTPROC_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBPOSTPROC_LIB_ARCH_S_FILES)) LIBPOSTPROC_LIB_ASM_FILES := $(subst jni/,,$(LIBPOSTPROC_LIB_ASM_FILES)) LIBPOSTPROC_LIB_C_FILES := $(subst jni/,,$(LIBPOSTPROC_LIB_C_FILES)) LIBPOSTPROC_LIB_S_FILES := $(subst jni/,,$(LIBPOSTPROC_LIB_S_FILES)) LIBPOSTPROC_LIB_CPP_FILES := $(subst jni/,,$(LIBPOSTPROC_LIB_CPP_FILES)) include $(LOCAL_PATH)/libpostproc_ignore.mk LIBPOSTPROC_FILES := $(sort $(LIBPOSTPROC_LIB_ARCH_ASM_FILES)) $(sort $(LIBPOSTPROC_LIB_ARCH_C_FILES)) $(sort $(LIBPOSTPROC_LIB_ARCH_S_FILES)) $(sort $(LIBPOSTPROC_LIB_ASM_FILES)) $(sort $(LIBPOSTPROC_LIB_C_FILES)) $(sort $(LIBPOSTPROC_LIB_S_FILES)) $(sort $(LIBPOSTPROC_LIB_CPP_FILES)) LOCAL_SRC_FILES := $(LIBPOSTPROC_FILES) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/$(TARGET_ARCH) LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil LOCAL_MODULE := postproc ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fno-pic -DANDROID else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #   FFmpeg swresample.so include $(CLEAR_VARS) LIBSWRESAMPLE_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/$(TARGET_ARCH)/*.asm) LIBSWRESAMPLE_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/$(TARGET_ARCH)/*.c) LIBSWRESAMPLE_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/$(TARGET_ARCH)/*.S) LIBSWRESAMPLE_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/*.asm) LIBSWRESAMPLE_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/*.c) LIBSWRESAMPLE_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/*.S) LIBSWRESAMPLE_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/*.cpp) LIBSWRESAMPLE_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBSWRESAMPLE_LIB_ARCH_ASM_FILES)) LIBSWRESAMPLE_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBSWRESAMPLE_LIB_ARCH_C_FILES)) LIBSWRESAMPLE_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBSWRESAMPLE_LIB_ARCH_S_FILES)) LIBSWRESAMPLE_LIB_ASM_FILES := $(subst jni/,,$(LIBSWRESAMPLE_LIB_ASM_FILES)) LIBSWRESAMPLE_LIB_C_FILES := $(subst jni/,,$(LIBSWRESAMPLE_LIB_C_FILES)) LIBSWRESAMPLE_LIB_S_FILES := $(subst jni/,,$(LIBSWRESAMPLE_LIB_S_FILES)) LIBSWRESAMPLE_LIB_CPP_FILES := $(subst jni/,,$(LIBSWRESAMPLE_LIB_CPP_FILES)) include $(LOCAL_PATH)/libswresample_ignore.mk LIBSWRESAMPLE_FILES := $(sort $(LIBSWRESAMPLE_LIB_ARCH_ASM_FILES)) $(sort $(LIBSWRESAMPLE_LIB_ARCH_C_FILES)) $(sort $(LIBSWRESAMPLE_LIB_ARCH_S_FILES)) $(sort $(LIBSWRESAMPLE_LIB_ASM_FILES)) $(sort $(LIBSWRESAMPLE_LIB_C_FILES)) $(sort $(LIBSWRESAMPLE_LIB_S_FILES)) $(sort $(LIBSWRESAMPLE_LIB_CPP_FILES)) LOCAL_SRC_FILES := $(LIBSWRESAMPLE_FILES) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/$(TARGET_ARCH) LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil LOCAL_MODULE := swresample ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_STATIC_LIBRARIES += avutil_asm swresample_asm else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #   FFmpeg avresample.so include $(CLEAR_VARS) LIBAVRESAMPLE_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/$(TARGET_ARCH)/*.asm) LIBAVRESAMPLE_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/$(TARGET_ARCH)/*.c) LIBAVRESAMPLE_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/$(TARGET_ARCH)/*.S) LIBAVRESAMPLE_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/*.asm) LIBAVRESAMPLE_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/*.c) LIBAVRESAMPLE_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/*.S) LIBAVRESAMPLE_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/*.cpp) LIBAVRESAMPLE_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBAVRESAMPLE_LIB_ARCH_ASM_FILES)) LIBAVRESAMPLE_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBAVRESAMPLE_LIB_ARCH_C_FILES)) LIBAVRESAMPLE_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBAVRESAMPLE_LIB_ARCH_S_FILES)) LIBAVRESAMPLE_LIB_ASM_FILES := $(subst jni/,,$(LIBAVRESAMPLE_LIB_ASM_FILES)) LIBAVRESAMPLE_LIB_C_FILES := $(subst jni/,,$(LIBAVRESAMPLE_LIB_C_FILES)) LIBAVRESAMPLE_LIB_S_FILES := $(subst jni/,,$(LIBAVRESAMPLE_LIB_S_FILES)) LIBAVRESAMPLE_LIB_CPP_FILES := $(subst jni/,,$(LIBAVRESAMPLE_LIB_CPP_FILES)) include $(LOCAL_PATH)/libavresample_ignore.mk LIBAVRESAMPLE_FILES := $(sort $(LIBAVRESAMPLE_LIB_ARCH_ASM_FILES)) $(sort $(LIBAVRESAMPLE_LIB_ARCH_C_FILES)) $(sort $(LIBAVRESAMPLE_LIB_ARCH_S_FILES)) $(sort $(LIBAVRESAMPLE_LIB_ASM_FILES)) $(sort $(LIBAVRESAMPLE_LIB_C_FILES)) $(sort $(LIBAVRESAMPLE_LIB_S_FILES)) $(sort $(LIBAVRESAMPLE_LIB_CPP_FILES)) LOCAL_SRC_FILES := $(LIBAVRESAMPLE_FILES) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/$(TARGET_ARCH) LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil LOCAL_MODULE := avresample ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_STATIC_LIBRARIES += avutil_asm avresample_asm else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #   OpenCV include $(CLEAR_VARS) OPENCV_CAMERA_MODULES := off OPENCV_INSTALL_MODULES := on include $(OPENCVROOT)/sdk/native/jni/OpenCV.mk ################################################################################ #   FFmpeg avfilter.so include $(CLEAR_VARS) LIBAVFILTER_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/$(TARGET_ARCH)/*.asm) LIBAVFILTER_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/$(TARGET_ARCH)/*.c) LIBAVFILTER_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/$(TARGET_ARCH)/*.S) LIBAVFILTER_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/*.asm) LIBAVFILTER_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/*.c) LIBAVFILTER_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/*.S) LIBAVFILTER_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/*.cpp) LIBAVFILTER_LIB_EX_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/libmpcodecs/*.c) LIBAVFILTER_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_ARCH_ASM_FILES)) LIBAVFILTER_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_ARCH_C_FILES)) LIBAVFILTER_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_ARCH_S_FILES)) LIBAVFILTER_LIB_ASM_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_ASM_FILES)) LIBAVFILTER_LIB_C_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_S_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_S_FILES)) LIBAVFILTER_LIB_CPP_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_CPP_FILES)) LIBAVFILTER_LIB_EX_C_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_EX_C_FILES)) include $(LOCAL_PATH)/libavfilter_ignore.mk LIBAVFILTER_FILES := $(sort $(LIBAVFILTER_LIB_ARCH_ASM_FILES)) $(sort $(LIBAVFILTER_LIB_ARCH_C_FILES)) $(sort $(LIBAVFILTER_LIB_ARCH_S_FILES)) $(sort $(LIBAVFILTER_LIB_ASM_FILES)) $(sort $(LIBAVFILTER_LIB_C_FILES)) $(sort $(LIBAVFILTER_LIB_S_FILES)) $(sort $(LIBAVFILTER_LIB_CPP_FILES)) $(sort $(LIBAVFILTER_LIB_EX_C_FILES)) LOCAL_SRC_FILES := $(LIBAVFILTER_FILES) LOCAL_C_INCLUDES += $(OPENCVROOT)/sdk/native/jni/include $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/$(TARGET_ARCH) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/libmpcodecs $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/libmpcodecs/libvo LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil libavcodec libavformat libswresample libpostproc libswscale libavresample libopencv_java LOCAL_MODULE := avfilter ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -fno-pic -DANDROID LOCAL_STATIC_LIBRARIES += avutil_asm avfilter_asm else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #   FFmpeg avdevice.so include $(CLEAR_VARS) LIBAVDEVICE_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/$(TARGET_ARCH)/*.asm) LIBAVDEVICE_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/$(TARGET_ARCH)/*.c) LIBAVDEVICE_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/$(TARGET_ARCH)/*.S) LIBAVDEVICE_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/*.asm) LIBAVDEVICE_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/*.c) LIBAVDEVICE_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/*.S) LIBAVDEVICE_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/*.cpp) LIBAVDEVICE_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBAVDEVICE_LIB_ARCH_ASM_FILES)) LIBAVDEVICE_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBAVDEVICE_LIB_ARCH_C_FILES)) LIBAVDEVICE_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBAVDEVICE_LIB_ARCH_S_FILES)) LIBAVDEVICE_LIB_ASM_FILES := $(subst jni/,,$(LIBAVDEVICE_LIB_ASM_FILES)) LIBAVDEVICE_LIB_C_FILES := $(subst jni/,,$(LIBAVDEVICE_LIB_C_FILES)) LIBAVDEVICE_LIB_S_FILES := $(subst jni/,,$(LIBAVDEVICE_LIB_S_FILES)) LIBAVDEVICE_LIB_CPP_FILES := $(subst jni/,,$(LIBAVDEVICE_LIB_CPP_FILES)) include $(LOCAL_PATH)/libavdevice_ignore.mk LIBAVDEVICE_FILES := $(sort $(LIBAVDEVICE_LIB_ARCH_ASM_FILES)) $(sort $(LIBAVDEVICE_LIB_ARCH_C_FILES)) $(sort $(LIBAVDEVICE_LIB_ARCH_S_FILES)) $(sort $(LIBAVDEVICE_LIB_ASM_FILES)) $(sort $(LIBAVDEVICE_LIB_C_FILES)) $(sort $(LIBAVDEVICE_LIB_S_FILES)) $(sort $(LIBAVDEVICE_LIB_CPP_FILES)) LOCAL_SRC_FILES := $(LIBAVDEVICE_FILES) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/$(TARGET_ARCH) LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil libavcodec libavformat libavfilter LOCAL_MODULE := avdevice ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fpic -DANDROID else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #  ffmpeg.exe   *.so  include $(CLEAR_VARS) LOCAL_SRC_FILES := $(subst jni/,,$(LOCAL_PATH)/$(FFMPEG_DIR)/cmdutils.c) $(subst jni/,,$(LOCAL_PATH)/$(FFMPEG_DIR)/ffmpeg.c) $(subst jni/,,$(LOCAL_PATH)/$(FFMPEG_DIR)/ffmpeg_opt.c) $(subst jni/,,$(LOCAL_PATH)/$(FFMPEG_DIR)/ffmpeg_filter.c) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(OPENCVROOT)/sdk/native/jni/include LOCAL_LDLIBS += -llog -ldl LOCAL_SHARED_LIBRARIES += libavcodec libavfilter libavformat libavresample libavutil libpostproc libswresample libswscale libopencv_java LOCAL_MODULE := ffmpeg ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -DANDROID -DCONFIG_ARM_ARCH -fpic LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -DANDROID -DCONFIG_X86_ARCH -fpic else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY)</span></span></code> LIBPOSTPROC_LIB_ARCH_ASM_FILES)) $ (sort $ (LIBPOSTPROC_LIB_ARCH_C_FILES)) $ (sort $ (LIBPOSTPROC_LIB_ARCH_S_FILES)) $ (sort $ (LIBPOSTPROC_LIB_ASM_FILES)) $ (sort $ (LIBPOSTPROC_LIB_C_FILES)) $ (sort $ (LIBPOSTPROC_LIB_S_FILES) <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">################################################################################ #    LOCAL_PATH    LOCAL_PATH := $(call my-dir) #    FFMPEG_DIR      FFmpeg FFMPEG_DIR := ffmpeg-2.1.3 #    OPENCVROOT     OpenCV Anroid SDK OPENCVROOT := D:\OpenCV-2.4.7.1-android-sdk #         x86 #   ,   x86         FFmpeg  #   NDK    *.asm ,        yasm #       yasm   *.asm     *.a ,       #   *.asm    bat- ifeq ($(TARGET_ARCH),x86) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := avcodec_asm LIBAVCODEC_ASM_A_FILE_PATH := $(LOCAL_PATH)/../obj/local/x86/objs/avcodec/ffmpeg-2.1.3/libavcodec/x86/libavcodec_asm.a LOCAL_SRC_FILES := $(subst jni/,,$(LIBAVCODEC_ASM_A_FILE_PATH)) include $(PREBUILT_STATIC_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := avfilter_asm LIBAVFILTER_ASM_A_FILE_PATH := $(LOCAL_PATH)/../obj/local/x86/objs/avfilter/ffmpeg-2.1.3/libavfilter/x86/libavfilter_asm.a LOCAL_SRC_FILES := $(subst jni/,,$(LIBAVFILTER_ASM_A_FILE_PATH)) include $(PREBUILT_STATIC_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := avresample_asm LIBAVRESAMPLE_ASM_A_FILE_PATH := $(LOCAL_PATH)/../obj/local/x86/objs/avresample/ffmpeg-2.1.3/libavresample/x86/libavresample_asm.a LOCAL_SRC_FILES := $(subst jni/,,$(LIBAVRESAMPLE_ASM_A_FILE_PATH)) include $(PREBUILT_STATIC_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := avutil_asm LIBAVUTIL_ASM_A_FILE_PATH := $(LOCAL_PATH)/../obj/local/x86/objs/avutil/ffmpeg-2.1.3/libavutil/x86/libavutil_asm.a LOCAL_SRC_FILES := $(subst jni/,,$(LIBAVUTIL_ASM_A_FILE_PATH)) include $(PREBUILT_STATIC_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := swresample_asm LIBSWRESAMPLE_ASM_A_FILE_PATH := $(LOCAL_PATH)/../obj/local/x86/objs/swresample/ffmpeg-2.1.3/libswresample/x86/libswresample_asm.a LOCAL_SRC_FILES := $(subst jni/,,$(LIBSWRESAMPLE_ASM_A_FILE_PATH)) include $(PREBUILT_STATIC_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := swscale_asm LIBSWSCALE_ASM_A_FILE_PATH := $(LOCAL_PATH)/../obj/local/x86/objs/swscale/ffmpeg-2.1.3/libswscale/x86/libswscale_asm.a LOCAL_SRC_FILES := $(subst jni/,,$(LIBSWSCALE_ASM_A_FILE_PATH)) include $(PREBUILT_STATIC_LIBRARY) ################################################################################ endif #   -  FFmpeg ################################################################################ #   FFmpeg avutils.so #         include $(CLEAR_VARS) #          *.asm, *.c  ..    #      "$(TARGET_ARCH)" -            #   ffmpeg       ,      LIBAVUTIL_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/$(TARGET_ARCH)/*.asm) LIBAVUTIL_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/$(TARGET_ARCH)/*.c) LIBAVUTIL_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/$(TARGET_ARCH)/*.S) LIBAVUTIL_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/*.asm) LIBAVUTIL_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/*.c) LIBAVUTIL_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/*.S) LIBAVUTIL_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/*.cpp) # ,             NDK ,       #            "jni/"    LIBAVUTIL_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBAVUTIL_LIB_ARCH_ASM_FILES)) LIBAVUTIL_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBAVUTIL_LIB_ARCH_C_FILES)) LIBAVUTIL_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBAVUTIL_LIB_ARCH_S_FILES)) LIBAVUTIL_LIB_ASM_FILES := $(subst jni/,,$(LIBAVUTIL_LIB_ASM_FILES)) LIBAVUTIL_LIB_C_FILES := $(subst jni/,,$(LIBAVUTIL_LIB_C_FILES)) LIBAVUTIL_LIB_S_FILES := $(subst jni/,,$(LIBAVUTIL_LIB_S_FILES)) LIBAVUTIL_LIB_CPP_FILES := $(subst jni/,,$(LIBAVUTIL_LIB_CPP_FILES)) #    make-,    ,    ,    include $(LOCAL_PATH)/libavutil_ignore.mk #      ,    LIBAVUTIL_FILES        avutils,    LIBAVUTIL_FILES := $(sort $(LIBAVUTIL_LIB_ARCH_ASM_FILES)) $(sort $(LIBAVUTIL_LIB_ARCH_C_FILES)) $(sort $(LIBAVUTIL_LIB_ARCH_S_FILES)) $(sort $(LIBAVUTIL_LIB_ASM_FILES)) $(sort $(LIBAVUTIL_LIB_C_FILES)) $(sort $(LIBAVUTIL_LIB_S_FILES)) $(sort $(LIBAVUTIL_LIB_CPP_FILES)) #       #     LOCAL_SRC_FILES := $(LIBAVUTIL_FILES) #      LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavutil/$(TARGET_ARCH) # -  FFmpeg      zlib  log,      LOCAL_LDLIBS += -lz -llog #   ,      libavutil.so LOCAL_MODULE := avutil #  ,   TARGET_ARCH            #         LOCAL_CFLAGS     #       ,   .. ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fpic -DANDROID #      x86    yasm   LOCAL_STATIC_LIBRARIES += avutil_asm else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif #     make-  NDK,    shared-,  *.so  include $(BUILD_SHARED_LIBRARY) ################################################################################ #   FFmpeg avcodec.so include $(CLEAR_VARS) LIBAVCODEC_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/$(TARGET_ARCH)/*.asm) LIBAVCODEC_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/$(TARGET_ARCH)/*.c) LIBAVCODEC_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/$(TARGET_ARCH)/*.S) LIBAVCODEC_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/*.asm) LIBAVCODEC_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/*.c) LIBAVCODEC_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/*.S) LIBAVCODEC_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/*.cpp) LIBAVCODEC_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBAVCODEC_LIB_ARCH_ASM_FILES)) LIBAVCODEC_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBAVCODEC_LIB_ARCH_C_FILES)) LIBAVCODEC_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBAVCODEC_LIB_ARCH_S_FILES)) LIBAVCODEC_LIB_ASM_FILES := $(subst jni/,,$(LIBAVCODEC_LIB_ASM_FILES)) LIBAVCODEC_LIB_C_FILES := $(subst jni/,,$(LIBAVCODEC_LIB_C_FILES)) LIBAVCODEC_LIB_S_FILES := $(subst jni/,,$(LIBAVCODEC_LIB_S_FILES)) LIBAVCODEC_LIB_CPP_FILES := $(subst jni/,,$(LIBAVCODEC_LIB_CPP_FILES)) include $(LOCAL_PATH)/libavcodec_ignore.mk LIBAVCODEC_FILES := $(sort $(LIBAVCODEC_LIB_ARCH_ASM_FILES)) $(sort $(LIBAVCODEC_LIB_ARCH_C_FILES)) $(sort $(LIBAVCODEC_LIB_ARCH_S_FILES)) $(sort $(LIBAVCODEC_LIB_ASM_FILES)) $(sort $(LIBAVCODEC_LIB_C_FILES)) $(sort $(LIBAVCODEC_LIB_S_FILES)) $(sort $(LIBAVCODEC_LIB_CPP_FILES)) LOCAL_SRC_FILES := $(LIBAVCODEC_FILES) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec $(LOCAL_PATH)/$(FFMPEG_DIR)/libavcodec/$(TARGET_ARCH) LOCAL_LDLIBS += -lz -llog #    ffmpeg   ,              , #  ,      ,     -  LOCAL_SHARED_LIBRARIES += libavutil LOCAL_MODULE := avcodec ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fno-pic -DANDROID LOCAL_STATIC_LIBRARIES += avutil_asm avcodec_asm LOCAL_SHARED_LIBRARIES += libavutil_asm libavcodec_asm else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #   FFmpeg avformat.so include $(CLEAR_VARS) LIBAVFORMAT_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/$(TARGET_ARCH)/*.asm) LIBAVFORMAT_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/$(TARGET_ARCH)/*.c) LIBAVFORMAT_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/$(TARGET_ARCH)/*.S) LIBAVFORMAT_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/*.asm) LIBAVFORMAT_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/*.c) LIBAVFORMAT_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/*.S) LIBAVFORMAT_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/*.cpp) LIBAVFORMAT_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBAVFORMAT_LIB_ARCH_ASM_FILES)) LIBAVFORMAT_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBAVFORMAT_LIB_ARCH_C_FILES)) LIBAVFORMAT_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBAVFORMAT_LIB_ARCH_S_FILES)) LIBAVFORMAT_LIB_ASM_FILES := $(subst jni/,,$(LIBAVFORMAT_LIB_ASM_FILES)) LIBAVFORMAT_LIB_C_FILES := $(subst jni/,,$(LIBAVFORMAT_LIB_C_FILES)) LIBAVFORMAT_LIB_S_FILES := $(subst jni/,,$(LIBAVFORMAT_LIB_S_FILES)) LIBAVFORMAT_LIB_CPP_FILES := $(subst jni/,,$(LIBAVFORMAT_LIB_CPP_FILES)) include $(LOCAL_PATH)/libavformat_ignore.mk LIBAVFORMAT_FILES := $(sort $(LIBAVFORMAT_LIB_ARCH_ASM_FILES)) $(sort $(LIBAVFORMAT_LIB_ARCH_C_FILES)) $(sort $(LIBAVFORMAT_LIB_ARCH_S_FILES)) $(sort $(LIBAVFORMAT_LIB_ASM_FILES)) $(sort $(LIBAVFORMAT_LIB_C_FILES)) $(sort $(LIBAVFORMAT_LIB_S_FILES)) $(sort $(LIBAVFORMAT_LIB_CPP_FILES)) LOCAL_SRC_FILES := $(LIBAVFORMAT_FILES) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat $(LOCAL_PATH)/$(FFMPEG_DIR)/libavformat/$(TARGET_ARCH) LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil libavcodec LOCAL_MODULE := avformat ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fpic -DANDROID else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #   FFmpeg swscale.so include $(CLEAR_VARS) LIBSWSCALE_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/$(TARGET_ARCH)/*.asm) LIBSWSCALE_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/$(TARGET_ARCH)/*.c) LIBSWSCALE_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/$(TARGET_ARCH)/*.S) LIBSWSCALE_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/*.asm) LIBSWSCALE_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/*.c) LIBSWSCALE_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/*.S) LIBSWSCALE_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/*.cpp) LIBSWSCALE_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBSWSCALE_LIB_ARCH_ASM_FILES)) LIBSWSCALE_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBSWSCALE_LIB_ARCH_C_FILES)) LIBSWSCALE_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBSWSCALE_LIB_ARCH_S_FILES)) LIBSWSCALE_LIB_ASM_FILES := $(subst jni/,,$(LIBSWSCALE_LIB_ASM_FILES)) LIBSWSCALE_LIB_C_FILES := $(subst jni/,,$(LIBSWSCALE_LIB_C_FILES)) LIBSWSCALE_LIB_S_FILES := $(subst jni/,,$(LIBSWSCALE_LIB_S_FILES)) LIBSWSCALE_LIB_CPP_FILES := $(subst jni/,,$(LIBSWSCALE_LIB_CPP_FILES)) include $(LOCAL_PATH)/libswscale_ignore.mk LIBSWSCALE_FILES := $(sort $(LIBSWSCALE_LIB_ARCH_ASM_FILES)) $(sort $(LIBSWSCALE_LIB_ARCH_C_FILES)) $(sort $(LIBSWSCALE_LIB_ARCH_S_FILES)) $(sort $(LIBSWSCALE_LIB_ASM_FILES)) $(sort $(LIBSWSCALE_LIB_C_FILES)) $(sort $(LIBSWSCALE_LIB_S_FILES)) $(sort $(LIBSWSCALE_LIB_CPP_FILES)) LOCAL_SRC_FILES := $(LIBSWSCALE_FILES) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale $(LOCAL_PATH)/$(FFMPEG_DIR)/libswscale/$(TARGET_ARCH) LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil LOCAL_MODULE := swscale ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fno-pic -DANDROID LOCAL_STATIC_LIBRARIES += avutil_asm swscale_asm else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #   FFmpeg postproc.so include $(CLEAR_VARS) LIBPOSTPROC_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/$(TARGET_ARCH)/*.asm) LIBPOSTPROC_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/$(TARGET_ARCH)/*.c) LIBPOSTPROC_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/$(TARGET_ARCH)/*.S) LIBPOSTPROC_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/*.asm) LIBPOSTPROC_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/*.c) LIBPOSTPROC_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/*.S) LIBPOSTPROC_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/*.cpp) LIBPOSTPROC_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBPOSTPROC_LIB_ARCH_ASM_FILES)) LIBPOSTPROC_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBPOSTPROC_LIB_ARCH_C_FILES)) LIBPOSTPROC_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBPOSTPROC_LIB_ARCH_S_FILES)) LIBPOSTPROC_LIB_ASM_FILES := $(subst jni/,,$(LIBPOSTPROC_LIB_ASM_FILES)) LIBPOSTPROC_LIB_C_FILES := $(subst jni/,,$(LIBPOSTPROC_LIB_C_FILES)) LIBPOSTPROC_LIB_S_FILES := $(subst jni/,,$(LIBPOSTPROC_LIB_S_FILES)) LIBPOSTPROC_LIB_CPP_FILES := $(subst jni/,,$(LIBPOSTPROC_LIB_CPP_FILES)) include $(LOCAL_PATH)/libpostproc_ignore.mk LIBPOSTPROC_FILES := $(sort $(LIBPOSTPROC_LIB_ARCH_ASM_FILES)) $(sort $(LIBPOSTPROC_LIB_ARCH_C_FILES)) $(sort $(LIBPOSTPROC_LIB_ARCH_S_FILES)) $(sort $(LIBPOSTPROC_LIB_ASM_FILES)) $(sort $(LIBPOSTPROC_LIB_C_FILES)) $(sort $(LIBPOSTPROC_LIB_S_FILES)) $(sort $(LIBPOSTPROC_LIB_CPP_FILES)) LOCAL_SRC_FILES := $(LIBPOSTPROC_FILES) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc $(LOCAL_PATH)/$(FFMPEG_DIR)/libpostproc/$(TARGET_ARCH) LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil LOCAL_MODULE := postproc ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fno-pic -DANDROID else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #   FFmpeg swresample.so include $(CLEAR_VARS) LIBSWRESAMPLE_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/$(TARGET_ARCH)/*.asm) LIBSWRESAMPLE_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/$(TARGET_ARCH)/*.c) LIBSWRESAMPLE_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/$(TARGET_ARCH)/*.S) LIBSWRESAMPLE_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/*.asm) LIBSWRESAMPLE_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/*.c) LIBSWRESAMPLE_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/*.S) LIBSWRESAMPLE_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/*.cpp) LIBSWRESAMPLE_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBSWRESAMPLE_LIB_ARCH_ASM_FILES)) LIBSWRESAMPLE_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBSWRESAMPLE_LIB_ARCH_C_FILES)) LIBSWRESAMPLE_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBSWRESAMPLE_LIB_ARCH_S_FILES)) LIBSWRESAMPLE_LIB_ASM_FILES := $(subst jni/,,$(LIBSWRESAMPLE_LIB_ASM_FILES)) LIBSWRESAMPLE_LIB_C_FILES := $(subst jni/,,$(LIBSWRESAMPLE_LIB_C_FILES)) LIBSWRESAMPLE_LIB_S_FILES := $(subst jni/,,$(LIBSWRESAMPLE_LIB_S_FILES)) LIBSWRESAMPLE_LIB_CPP_FILES := $(subst jni/,,$(LIBSWRESAMPLE_LIB_CPP_FILES)) include $(LOCAL_PATH)/libswresample_ignore.mk LIBSWRESAMPLE_FILES := $(sort $(LIBSWRESAMPLE_LIB_ARCH_ASM_FILES)) $(sort $(LIBSWRESAMPLE_LIB_ARCH_C_FILES)) $(sort $(LIBSWRESAMPLE_LIB_ARCH_S_FILES)) $(sort $(LIBSWRESAMPLE_LIB_ASM_FILES)) $(sort $(LIBSWRESAMPLE_LIB_C_FILES)) $(sort $(LIBSWRESAMPLE_LIB_S_FILES)) $(sort $(LIBSWRESAMPLE_LIB_CPP_FILES)) LOCAL_SRC_FILES := $(LIBSWRESAMPLE_FILES) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample $(LOCAL_PATH)/$(FFMPEG_DIR)/libswresample/$(TARGET_ARCH) LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil LOCAL_MODULE := swresample ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_STATIC_LIBRARIES += avutil_asm swresample_asm else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #   FFmpeg avresample.so include $(CLEAR_VARS) LIBAVRESAMPLE_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/$(TARGET_ARCH)/*.asm) LIBAVRESAMPLE_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/$(TARGET_ARCH)/*.c) LIBAVRESAMPLE_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/$(TARGET_ARCH)/*.S) LIBAVRESAMPLE_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/*.asm) LIBAVRESAMPLE_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/*.c) LIBAVRESAMPLE_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/*.S) LIBAVRESAMPLE_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/*.cpp) LIBAVRESAMPLE_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBAVRESAMPLE_LIB_ARCH_ASM_FILES)) LIBAVRESAMPLE_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBAVRESAMPLE_LIB_ARCH_C_FILES)) LIBAVRESAMPLE_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBAVRESAMPLE_LIB_ARCH_S_FILES)) LIBAVRESAMPLE_LIB_ASM_FILES := $(subst jni/,,$(LIBAVRESAMPLE_LIB_ASM_FILES)) LIBAVRESAMPLE_LIB_C_FILES := $(subst jni/,,$(LIBAVRESAMPLE_LIB_C_FILES)) LIBAVRESAMPLE_LIB_S_FILES := $(subst jni/,,$(LIBAVRESAMPLE_LIB_S_FILES)) LIBAVRESAMPLE_LIB_CPP_FILES := $(subst jni/,,$(LIBAVRESAMPLE_LIB_CPP_FILES)) include $(LOCAL_PATH)/libavresample_ignore.mk LIBAVRESAMPLE_FILES := $(sort $(LIBAVRESAMPLE_LIB_ARCH_ASM_FILES)) $(sort $(LIBAVRESAMPLE_LIB_ARCH_C_FILES)) $(sort $(LIBAVRESAMPLE_LIB_ARCH_S_FILES)) $(sort $(LIBAVRESAMPLE_LIB_ASM_FILES)) $(sort $(LIBAVRESAMPLE_LIB_C_FILES)) $(sort $(LIBAVRESAMPLE_LIB_S_FILES)) $(sort $(LIBAVRESAMPLE_LIB_CPP_FILES)) LOCAL_SRC_FILES := $(LIBAVRESAMPLE_FILES) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample $(LOCAL_PATH)/$(FFMPEG_DIR)/libavresample/$(TARGET_ARCH) LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil LOCAL_MODULE := avresample ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_STATIC_LIBRARIES += avutil_asm avresample_asm else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #   OpenCV include $(CLEAR_VARS) OPENCV_CAMERA_MODULES := off OPENCV_INSTALL_MODULES := on include $(OPENCVROOT)/sdk/native/jni/OpenCV.mk ################################################################################ #   FFmpeg avfilter.so include $(CLEAR_VARS) LIBAVFILTER_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/$(TARGET_ARCH)/*.asm) LIBAVFILTER_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/$(TARGET_ARCH)/*.c) LIBAVFILTER_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/$(TARGET_ARCH)/*.S) LIBAVFILTER_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/*.asm) LIBAVFILTER_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/*.c) LIBAVFILTER_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/*.S) LIBAVFILTER_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/*.cpp) LIBAVFILTER_LIB_EX_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/libmpcodecs/*.c) LIBAVFILTER_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_ARCH_ASM_FILES)) LIBAVFILTER_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_ARCH_C_FILES)) LIBAVFILTER_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_ARCH_S_FILES)) LIBAVFILTER_LIB_ASM_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_ASM_FILES)) LIBAVFILTER_LIB_C_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_S_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_S_FILES)) LIBAVFILTER_LIB_CPP_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_CPP_FILES)) LIBAVFILTER_LIB_EX_C_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_EX_C_FILES)) include $(LOCAL_PATH)/libavfilter_ignore.mk LIBAVFILTER_FILES := $(sort $(LIBAVFILTER_LIB_ARCH_ASM_FILES)) $(sort $(LIBAVFILTER_LIB_ARCH_C_FILES)) $(sort $(LIBAVFILTER_LIB_ARCH_S_FILES)) $(sort $(LIBAVFILTER_LIB_ASM_FILES)) $(sort $(LIBAVFILTER_LIB_C_FILES)) $(sort $(LIBAVFILTER_LIB_S_FILES)) $(sort $(LIBAVFILTER_LIB_CPP_FILES)) $(sort $(LIBAVFILTER_LIB_EX_C_FILES)) LOCAL_SRC_FILES := $(LIBAVFILTER_FILES) LOCAL_C_INCLUDES += $(OPENCVROOT)/sdk/native/jni/include $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/$(TARGET_ARCH) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/libmpcodecs $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/libmpcodecs/libvo LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil libavcodec libavformat libswresample libpostproc libswscale libavresample libopencv_java LOCAL_MODULE := avfilter ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -fno-pic -DANDROID LOCAL_STATIC_LIBRARIES += avutil_asm avfilter_asm else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #   FFmpeg avdevice.so include $(CLEAR_VARS) LIBAVDEVICE_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/$(TARGET_ARCH)/*.asm) LIBAVDEVICE_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/$(TARGET_ARCH)/*.c) LIBAVDEVICE_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/$(TARGET_ARCH)/*.S) LIBAVDEVICE_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/*.asm) LIBAVDEVICE_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/*.c) LIBAVDEVICE_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/*.S) LIBAVDEVICE_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/*.cpp) LIBAVDEVICE_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBAVDEVICE_LIB_ARCH_ASM_FILES)) LIBAVDEVICE_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBAVDEVICE_LIB_ARCH_C_FILES)) LIBAVDEVICE_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBAVDEVICE_LIB_ARCH_S_FILES)) LIBAVDEVICE_LIB_ASM_FILES := $(subst jni/,,$(LIBAVDEVICE_LIB_ASM_FILES)) LIBAVDEVICE_LIB_C_FILES := $(subst jni/,,$(LIBAVDEVICE_LIB_C_FILES)) LIBAVDEVICE_LIB_S_FILES := $(subst jni/,,$(LIBAVDEVICE_LIB_S_FILES)) LIBAVDEVICE_LIB_CPP_FILES := $(subst jni/,,$(LIBAVDEVICE_LIB_CPP_FILES)) include $(LOCAL_PATH)/libavdevice_ignore.mk LIBAVDEVICE_FILES := $(sort $(LIBAVDEVICE_LIB_ARCH_ASM_FILES)) $(sort $(LIBAVDEVICE_LIB_ARCH_C_FILES)) $(sort $(LIBAVDEVICE_LIB_ARCH_S_FILES)) $(sort $(LIBAVDEVICE_LIB_ASM_FILES)) $(sort $(LIBAVDEVICE_LIB_C_FILES)) $(sort $(LIBAVDEVICE_LIB_S_FILES)) $(sort $(LIBAVDEVICE_LIB_CPP_FILES)) LOCAL_SRC_FILES := $(LIBAVDEVICE_FILES) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice $(LOCAL_PATH)/$(FFMPEG_DIR)/libavdevice/$(TARGET_ARCH) LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil libavcodec libavformat libavfilter LOCAL_MODULE := avdevice ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -O3 -fpic -DANDROID else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=missing-prototypes -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY) ################################################################################ #  ffmpeg.exe   *.so  include $(CLEAR_VARS) LOCAL_SRC_FILES := $(subst jni/,,$(LOCAL_PATH)/$(FFMPEG_DIR)/cmdutils.c) $(subst jni/,,$(LOCAL_PATH)/$(FFMPEG_DIR)/ffmpeg.c) $(subst jni/,,$(LOCAL_PATH)/$(FFMPEG_DIR)/ffmpeg_opt.c) $(subst jni/,,$(LOCAL_PATH)/$(FFMPEG_DIR)/ffmpeg_filter.c) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(OPENCVROOT)/sdk/native/jni/include LOCAL_LDLIBS += -llog -ldl LOCAL_SHARED_LIBRARIES += libavcodec libavfilter libavformat libavresample libavutil libpostproc libswresample libswscale libopencv_java LOCAL_MODULE := ffmpeg ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -DANDROID -DCONFIG_ARM_ARCH -fpic LOCAL_ARM_MODE := arm else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -DANDROID -DCONFIG_X86_ARCH -fpic else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -DANDROID -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=return-type -Werror=vla endif include $(BUILD_SHARED_LIBRARY)</span></span></code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title">Application.mk -   </b> <div class="spoiler_text"><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment"># ,      STL APP_STL := gnustl_static #     APP_CPPFLAGS := -frtti -fexceptions #      ,   , : "APP_ABI := armeabi x86 mips" #         APP_ABI := armeabi # APP_ABI := x86 # APP_ABI := mips APP_PLATFORM := android-9</span></span></code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title">libavfilter_ignore.mk -         ,    </b> <div class="spoiler_text"><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#   : af_ladspa.c, asrc_flite.c, deshake_opencl.c, f_zmq.c, unsharp_opencl.c, unsharp_opencl_kernel.c, vf_drawtext.c, vf_frei0r.c, vf_libopencv.c, vf_subtitles.c, vf_vidstabdetect.c, vf_vidstabtransform.c, vidstabutils.c LIBAVFILTER_LIB_FILEPATH_af_ladspa_c := $(FFMPEG_DIR)/libavfilter/af_ladspa.c LIBAVFILTER_LIB_C_FILES := $(subst $(LIBAVFILTER_LIB_FILEPATH_af_ladspa_c),,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_FILEPATH_asrc_flite_c := $(FFMPEG_DIR)/libavfilter/asrc_flite.c LIBAVFILTER_LIB_C_FILES := $(subst $(LIBAVFILTER_LIB_FILEPATH_asrc_flite_c),,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_FILEPATH_deshake_opencl_c := $(FFMPEG_DIR)/libavfilter/deshake_opencl.c LIBAVFILTER_LIB_C_FILES := $(subst $(LIBAVFILTER_LIB_FILEPATH_deshake_opencl_c),,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_FILEPATH_f_zmq_c := $(FFMPEG_DIR)/libavfilter/f_zmq.c LIBAVFILTER_LIB_C_FILES := $(subst $(LIBAVFILTER_LIB_FILEPATH_f_zmq_c),,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_FILEPATH_unsharp_opencl_c := $(FFMPEG_DIR)/libavfilter/unsharp_opencl.c LIBAVFILTER_LIB_C_FILES := $(subst $(LIBAVFILTER_LIB_FILEPATH_unsharp_opencl_c),,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_FILEPATH_unsharp_opencl_kernel_c := $(FFMPEG_DIR)/libavfilter/unsharp_opencl_kernel.c LIBAVFILTER_LIB_C_FILES := $(subst $(LIBAVFILTER_LIB_FILEPATH_unsharp_opencl_kernel_c),,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_FILEPATH_vf_drawtext_c := $(FFMPEG_DIR)/libavfilter/vf_drawtext.c LIBAVFILTER_LIB_C_FILES := $(subst $(LIBAVFILTER_LIB_FILEPATH_vf_drawtext_c),,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_FILEPATH_vf_frei0r_c := $(FFMPEG_DIR)/libavfilter/vf_frei0r.c LIBAVFILTER_LIB_C_FILES := $(subst $(LIBAVFILTER_LIB_FILEPATH_vf_frei0r_c),,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_FILEPATH_vf_libopencv_c := $(FFMPEG_DIR)/libavfilter/vf_libopencv.c LIBAVFILTER_LIB_C_FILES := $(subst $(LIBAVFILTER_LIB_FILEPATH_vf_libopencv_c),,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_FILEPATH_vf_subtitles_c := $(FFMPEG_DIR)/libavfilter/vf_subtitles.c LIBAVFILTER_LIB_C_FILES := $(subst $(LIBAVFILTER_LIB_FILEPATH_vf_subtitles_c),,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_FILEPATH_vf_vidstabdetect_c := $(FFMPEG_DIR)/libavfilter/vf_vidstabdetect.c LIBAVFILTER_LIB_C_FILES := $(subst $(LIBAVFILTER_LIB_FILEPATH_vf_vidstabdetect_c),,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_FILEPATH_vf_vidstabtransform_c := $(FFMPEG_DIR)/libavfilter/vf_vidstabtransform.c LIBAVFILTER_LIB_C_FILES := $(subst $(LIBAVFILTER_LIB_FILEPATH_vf_vidstabtransform_c),,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_FILEPATH_vidstabutils_c := $(FFMPEG_DIR)/libavfilter/vidstabutils.c LIBAVFILTER_LIB_C_FILES := $(subst $(LIBAVFILTER_LIB_FILEPATH_vidstabutils_c),,$(LIBAVFILTER_LIB_C_FILES))</span></span></code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title">yasm_compile_asm_libavfilter.bat -  bat-,   *.asm   x86</b> <div class="spoiler_text"><pre> <code class="bash hljs">REM  *.asm  libavfilter,       <span class="hljs-string"><span class="hljs-string">'libavfilter\x86'</span></span> REM <span class="hljs-string"><span class="hljs-string">"-f elf"</span></span> ,   <span class="hljs-string"><span class="hljs-string">"error: binary object format does not support external references"</span></span> REM  -D     config.h <span class="hljs-string"><span class="hljs-string">"D:\yasm\yasm-1.3.0-win64.exe"</span></span> -f elf -D ARCH_X86_64=0 -D HAVE_ALIGNED_STACK=1 -D ARCH_X86_32=1 -D HAVE_CPUNOP=1 -D HAVE_AVX_EXTERNAL=1 -ID:\MyProject\jni\ffmpeg-2.1.3 -o af_volume.o af_volume.asm <span class="hljs-string"><span class="hljs-string">"D:\yasm\yasm-1.3.0-win64.exe"</span></span> -f elf -D ARCH_X86_64=0 -D HAVE_ALIGNED_STACK=1 -D ARCH_X86_32=1 -D HAVE_CPUNOP=1 -D HAVE_AVX_EXTERNAL=1 -ID:\MyProject\jni\ffmpeg-2.1.3 -o vf_gradfun.o vf_gradfun.asm <span class="hljs-string"><span class="hljs-string">"D:\yasm\yasm-1.3.0-win64.exe"</span></span> -f elf -D ARCH_X86_64=0 -D HAVE_ALIGNED_STACK=1 -D ARCH_X86_32=1 -D HAVE_CPUNOP=1 -D HAVE_AVX_EXTERNAL=1 -ID:\MyProject\jni\ffmpeg-2.1.3 -o vf_hqdn3d.o vf_hqdn3d.asm <span class="hljs-string"><span class="hljs-string">"D:\yasm\yasm-1.3.0-win64.exe"</span></span> -f elf -D ARCH_X86_64=0 -D HAVE_ALIGNED_STACK=1 -D ARCH_X86_32=1 -D HAVE_CPUNOP=1 -D HAVE_AVX_EXTERNAL=1 -ID:\MyProject\jni\ffmpeg-2.1.3 -o vf_pullup.o vf_pullup.asm <span class="hljs-string"><span class="hljs-string">"D:\yasm\yasm-1.3.0-win64.exe"</span></span> -f elf -D ARCH_X86_64=0 -D HAVE_ALIGNED_STACK=1 -D ARCH_X86_32=1 -D HAVE_CPUNOP=1 -D HAVE_AVX_EXTERNAL=1 -ID:\MyProject\jni\ffmpeg-2.1.3 -o vf_yadif.o vf_yadif.asm <span class="hljs-string"><span class="hljs-string">"D:\yasm\yasm-1.3.0-win64.exe"</span></span> -f elf -D ARCH_X86_64=0 -D HAVE_ALIGNED_STACK=1 -D ARCH_X86_32=1 -D HAVE_CPUNOP=1 -D HAVE_AVX_EXTERNAL=1 -ID:\MyProject\jni\ffmpeg-2.1.3 -o yadif-10.o yadif-10.asm <span class="hljs-string"><span class="hljs-string">"D:\yasm\yasm-1.3.0-win64.exe"</span></span> -f elf -D ARCH_X86_64=0 -D HAVE_ALIGNED_STACK=1 -D ARCH_X86_32=1 -D HAVE_CPUNOP=1 -D HAVE_AVX_EXTERNAL=1 -ID:\MyProject\jni\ffmpeg-2.1.3 -o yadif-16.o yadif-16.asm <span class="hljs-string"><span class="hljs-string">"D:\ndk\android-ndk-r9c\toolchains\x86-4.6\prebuilt\windows-x86_64\bin\i686-linux-android-ar.exe"</span></span> rvs libavfilter_asm.a af_volume.o vf_gradfun.o vf_hqdn3d.o vf_pullup.o vf_yadif.o yadif-10.o yadif-16.o mkdir <span class="hljs-string"><span class="hljs-string">"D:\MyProject\obj\local\x86\objs\avfilter\ffmpeg-2.1.3\libavfilter\x86"</span></span> move libavfilter_asm.a <span class="hljs-string"><span class="hljs-string">"D:\MyProject\obj\local\x86\objs\avfilter\ffmpeg-2.1.3\libavfilter\x86\" del *.o</span></span></code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title">Android.mk -  make-,      avfilter,  *.so -   </b> <div class="spoiler_text"><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">################################################################################ LOCAL_PATH := $(call my-dir) FFMPEG_DIR := ffmpeg-2.1.3 ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libavutil LOCAL_SRC_FILES := ../prebuild/armeabi/release/libavutil.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libavcodec LOCAL_SRC_FILES := ../prebuild/armeabi/release/libavcodec.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libavformat LOCAL_SRC_FILES := ../prebuild/armeabi/release/libavformat.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libswscale LOCAL_SRC_FILES := ../prebuild/armeabi/release/libswscale.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libpostproc LOCAL_SRC_FILES := ../prebuild/armeabi/release/libpostproc.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libswresample LOCAL_SRC_FILES := ../prebuild/armeabi/release/libswresample.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libavresample LOCAL_SRC_FILES := ../prebuild/armeabi/release/libavresample.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) OPENCV_CAMERA_MODULES := off OPENCV_INSTALL_MODULES := on include $(OPENCVROOT)/sdk/native/jni/OpenCV.mk ################################################################################ #    avfilter.so include $(CLEAR_VARS) LIBAVFILTER_LIB_ARCH_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/$(TARGET_ARCH)/*.asm) LIBAVFILTER_LIB_ARCH_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/$(TARGET_ARCH)/*.c) LIBAVFILTER_LIB_ARCH_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/$(TARGET_ARCH)/*.S) LIBAVFILTER_LIB_ASM_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/*.asm) LIBAVFILTER_LIB_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/*.c) LIBAVFILTER_LIB_S_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/*.S) LIBAVFILTER_LIB_CPP_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/*.cpp) LIBAVFILTER_LIB_EX_C_FILES := $(wildcard $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/libmpcodecs/*.c) LIBAVFILTER_LIB_ARCH_ASM_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_ARCH_ASM_FILES)) LIBAVFILTER_LIB_ARCH_C_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_ARCH_C_FILES)) LIBAVFILTER_LIB_ARCH_S_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_ARCH_S_FILES)) LIBAVFILTER_LIB_ASM_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_ASM_FILES)) LIBAVFILTER_LIB_C_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_C_FILES)) LIBAVFILTER_LIB_S_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_S_FILES)) LIBAVFILTER_LIB_CPP_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_CPP_FILES)) LIBAVFILTER_LIB_EX_C_FILES := $(subst jni/,,$(LIBAVFILTER_LIB_EX_C_FILES)) include $(LOCAL_PATH)/libavfilter_ignore.mk LIBAVFILTER_FILES := $(sort $(LIBAVFILTER_LIB_ARCH_ASM_FILES)) $(sort $(LIBAVFILTER_LIB_ARCH_C_FILES)) $(sort $(LIBAVFILTER_LIB_ARCH_S_FILES)) $(sort $(LIBAVFILTER_LIB_ASM_FILES)) $(sort $(LIBAVFILTER_LIB_C_FILES)) $(sort $(LIBAVFILTER_LIB_S_FILES)) $(sort $(LIBAVFILTER_LIB_CPP_FILES)) $(sort $(LIBAVFILTER_LIB_EX_C_FILES)) LOCAL_SRC_FILES := $(LIBAVFILTER_FILES) LOCAL_C_INCLUDES += $(OPENCVROOT)/sdk/native/jni/include $(LOCAL_PATH)/$(FFMPEG_DIR) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/$(TARGET_ARCH) $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/libmpcodecs $(LOCAL_PATH)/$(FFMPEG_DIR)/libavfilter/libmpcodecs/libvo LOCAL_LDLIBS += -lz -llog LOCAL_SHARED_LIBRARIES += libavutil libavcodec libavformat libswresample libpostproc libswscale libavresample libopencv_java LOCAL_MODULE := avfilter LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -fpic -DANDROID LOCAL_ARM_MODE := arm include $(BUILD_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libavdevice LOCAL_SRC_FILES := ../prebuild/armeabi/release/libavdevice.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_SRC_FILES := $(subst jni/,,$(LOCAL_PATH)/$(FFMPEG_DIR)/cmdutils.c) $(subst jni/,,$(LOCAL_PATH)/$(FFMPEG_DIR)/ffmpeg.c) $(subst jni/,,$(LOCAL_PATH)/$(FFMPEG_DIR)/ffmpeg_opt.c) $(subst jni/,,$(LOCAL_PATH)/$(FFMPEG_DIR)/ffmpeg_filter.c) LOCAL_C_INCLUDES += $(LOCAL_PATH)/$(FFMPEG_DIR) $(OPENCVROOT)/sdk/native/jni/include LOCAL_LDLIBS += -llog -ldl LOCAL_SHARED_LIBRARIES += libavcodec libavfilter libavformat libavresample libavutil libpostproc libswresample libswscale libopencv_java LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -DANDROID -DCONFIG_ARM_ARCH -fpic LOCAL_MODULE := ffmpeg LOCAL_ARM_MODE := arm include $(BUILD_SHARED_LIBRARY)</span></span></code> </pre><br></div></div><br></div></div><br>  make-     ¬´jni¬ª.          : <br><br><img src="https://habrastorage.org/files/259/728/644/2597286446d84bf29dd1967c9a0d17c8.png"><br><br>  .  Project Build,    ,     (   )   ¬´libs¬ª          *.so  (    libopencv_java.so ‚Äî        OpenCV.mk   libffmpeg.so ‚Äì    ffmpeg.exe,     *.so ): <br><br><img src="https://habrastorage.org/files/b77/f4e/6e4/b77f4e6e4fa44995a1ce335f40d65c70.png"><br><br>       *.so ,                 . <br><br><h3> 4.  FFmpeg   Android  </h3><br>      *.so ,       Android .        ,     .       ,    FFmpeg (     ¬´OpenCV Introduction into Android Development¬ª). <br><br>     ,   ,     FFmpeg :     jni,     Android.mk  Application.mk,           C++         *.so .      Java-. <br><br> ,     Activity,    ,           . <br><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//   -      C++      Java  package com.example.myproject; //   -       C++      Java  public class MyActivity { &lt;...&gt; // -       native-,       private static native void nativeFFmpegTest(); &lt;...&gt; public void OnClick() { //  *.so ,  ,   "lib"  ! System.loadLibrary("opencv_java"); System.loadLibrary("avutil"); System.loadLibrary("avcodec"); System.loadLibrary("avformat"); System.loadLibrary("avresample"); System.loadLibrary("postproc"); System.loadLibrary("swresample"); System.loadLibrary("swscale"); System.loadLibrary("avfilter"); System.loadLibrary("ffmpeg"); //  *.so ,      Android.mk   ,    System.loadLibrary("myproject"); //  native-,   C++,         FFmpeg nativeFFmpegTest(); } }</span></span></code> </pre><br></div></div><br><br>    ¬´jni¬ª   myproject.cpp   : <br><br><div class="spoiler"> <b class="spoiler_title">myproject.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;jni.h&gt; #include &lt;string.h&gt; #include &lt;algorithm&gt; #include &lt;android/log.h&gt; //   NDK  ,    ,     Eclipse     ,       FFmpeg extern "C" { #include "libavcodec/avcodec.h" #include "libavformat/avformat.h" #include "libavutil/opt.h" #include "libswscale/swscale.h" #include "libavfilter/avfilter.h" #include "libavutil/log.h" #include "libavutil/imgutils.h" } // Extermal Functions Declaration extern "C" { // ,   main()   ffmpeg.c  ffmpeg_main()      int ffmpeg_main(int argc, char **argv); } // JNI Functions Declarations extern "C" { JNIEXPORT void JNICALL Java_com_example_myproject_MyActivity_nativeFFmpegTest(JNIEnv * _jenv, jclass _this); } JNIEXPORT void JNICALL Java_com_example_myproject_MyActivity_nativeFFmpegTest(JNIEnv * _jenv, jclass _this) { int argc = 5; //      ,    -        // FFmpeg      ,        mp4 char* argv[5] = { "ffmpeg", "-i", "//storage//extSdCard//DCIM//Camera//video.mp4", "-an", "//storage//extSdCard//DCIM//Camera//video_no_audio.mp4"}; //          ,         ffmpeg.exe   : // &gt; ffmpeg.exe -i "storage/extSdCard/DCIM/Camera/video.mp4" -an "storage/extSdCard/DCIM/Camera/video_no_audio.mp4" //  -an  ffmpeg     ,         video_no_audio.mp4 ffmpeg_main(argc, argv); }</span></span></span></span></code> </pre><br></div></div><br><br>     Android.mk  Application.mk: <br><br><div class="spoiler"> <b class="spoiler_title">Application.mk</b> <div class="spoiler_text"><pre> <code class="cmake hljs">APP_STL := gnustl_static APP_CPPFLAGS := -frtti -fexceptions APP_ABI := armeabi <span class="hljs-comment"><span class="hljs-comment"># APP_ABI := x86 # APP_ABI := mips APP_PLATFORM := android-9</span></span></code> </pre><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title">Android.mk</b> <div class="spoiler_text"><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">################################################################################ LOCAL_PATH := $(call my-dir) #     *.so  ################################################################################ include $(CLEAR_VARS) OPENCV_CAMERA_MODULES := off OPENCV_INSTALL_MODULES := on include $(OPENCVROOT)/sdk/native/jni/OpenCV.mk ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libavcodec LOCAL_SRC_FILES := ../prebuild/ffmpeg/$(TARGET_ARCH)/release/libavcodec.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libavfilter LOCAL_SRC_FILES := ../prebuild/ffmpeg/$(TARGET_ARCH)/release/libavfilter.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libavformat LOCAL_SRC_FILES := ../prebuild/ffmpeg/$(TARGET_ARCH)/release/libavformat.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libavresample LOCAL_SRC_FILES := ../prebuild/ffmpeg/$(TARGET_ARCH)/release/libavresample.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libavutil LOCAL_SRC_FILES := ../prebuild/ffmpeg/$(TARGET_ARCH)/release/libavutil.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libpostproc LOCAL_SRC_FILES := ../prebuild/ffmpeg/$(TARGET_ARCH)/release/libpostproc.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libswresample LOCAL_SRC_FILES := ../prebuild/ffmpeg/$(TARGET_ARCH)/release/libswresample.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libswscale LOCAL_SRC_FILES := ../prebuild/ffmpeg/$(TARGET_ARCH)/release/libswscale.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ include $(CLEAR_VARS) LOCAL_MODULE := libffmpeg LOCAL_SRC_FILES := ../prebuild/ffmpeg/$(TARGET_ARCH)/release/libffmpeg.so include $(PREBUILT_SHARED_LIBRARY) ################################################################################ #  myproject.cpp  libmyproject.so include $(CLEAR_VARS) LOCAL_SRC_FILES := myproject.cpp LOCAL_C_INCLUDES += $(LOCAL_PATH) $(FFMPEGANDROIDROOT) $(OPENCVROOT)/sdk/native/jni/include LOCAL_LDLIBS += -llog -ldl LOCAL_SHARED_LIBRARIES += libavcodec libavfilter libavformat libavresample libavutil libpostproc libswresample libswscale libopencv_java libffmpeg LOCAL_CFLAGS += -D__STDC_CONSTANT_MACROS -O3 -DANDROID ifeq ($(TARGET_ARCH),arm) LOCAL_CFLAGS += -DCONFIG_ARM_ARCH -fpic else ifeq ($(TARGET_ARCH),x86) LOCAL_CFLAGS += -DCONFIG_X86_ARCH -fpic else ifeq ($(TARGET_ARCH),mips) LOCAL_CFLAGS += -DCONFIG_MIPS_ARCH -Wfatal-errors -Wno-deprecated -std=c99 -fomit-frame-pointer -mips32r2 -mdsp -mdspr2 -mhard-float -g -Wdeclaration-after-statement -Wall -Wno-parentheses -Wno-switch -Wno-format-zero-length -Wdisabled-optimization -Wpointer-arith -Wredundant-decls -Wno-pointer-sign -Wwrite-strings -Wtype-limits -Wundef -Wmissing-prototypes -Wno-pointer-to-int-cast -Wstrict-prototypes -fno-math-errno -fno-signed-zeros -fno-tree-vectorize -Werror=return-type -Werror=vla endif LOCAL_MODULE := myproject include $(BUILD_SHARED_LIBRARY)</span></span></code> </pre><br></div></div><br><br>         ,     ¬´storage/extSdCard/DCIM/Camera/video.mp4¬ª,      myproject.cpp. <br><br>  Everything! ,  , ,     ,     video.mp4    video_no_audio.mp4   .   ,  FFmpeg  Android ! <br><br><h3> 5.  FFmpeg  OpenCV </h3><br> ,     FFmpeg  ,     Java  Android ,  -    FFmpeg OpenCV. <br><br>  ,     FFmpeg  .  ,       ,     . ,     ,     OpenCV.      . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And suddenly it dawned on me - so there are video filters in FFmpeg! Filters are modules that are connected at the stage of decoding-coding, and they are given for processing each frame from the video stream. Just here and it would be possible to insert frame-by-frame video stream processing. At first I wanted to write my own filter with conversion and OpenCV function calls. It could handle each frame of video. But then I decided to just take some ready-made filter and change its code.</font></font><br><br>      ,     ¬´ffmpeg-2.1.3\libavfilter\vf_scale.c¬ª,    ‚Äî       - ,         . ,      300x300,  ,    ,   640x480.   ‚Äî        .  ,                 ,       . <br><br>   ,    .     ffmpeg_process()    ,   ,         640x480  300x300.       ,    640x480  ,    ,  300x300.            ,          .         OpenCV  FFmpeg. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is solved this way: if you open the file vf_scale.c, then there will be a filter_frame () function. </font><font style="vertical-align: inherit;">This function is the callback that is called when processing video for each frame. </font><font style="vertical-align: inherit;">It has an ‚Äúin‚Äù argument of type AVFrame * - this is the decoded frame from the video. </font><font style="vertical-align: inherit;">We need to convert this frame to the format compatible with OpenCV and process.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code interaction FFmpeg with OpenCV</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  _in -      640x480,  _out -    300x300 void convertFFmpegAVFrameToOpenCVMat(AVFrame* _in, AVFrame* _out) { //     ( 640   ) int videoFrameWidth = _in-&gt;width; //     ( 480   ) int videoFrameHeight = _in-&gt;height; //    ,        AV_PIX_FMT_BGRA,     OpenCV int videoFrameFormat = _in-&gt;format; // SwsContext -    FFmpeg     ,     , //        videoFrameFormat   AV_PIX_FMT_BGRA SwsContext* avFrameToMatConvertContext = NULL; avFrameToMatConvertContext = sws_getCachedContext(avFrameToMatConvertContext, videoFrameWidth, videoFrameHeight, (enum AVPixelFormat) videoFrameFormat, videoFrameWidth, videoFrameHeight, AV_PIX_FMT_BGRA, SWS_BICUBIC, NULL, NULL, NULL); //     AVFrame*       AV_PIX_FMT_BGRA AVFrame* avFrameWithOpenCVCompatibleData = av_frame_alloc(); //       (      ) int avFrameWithOpenCVCompatibleDataBufferSize = avpicture_get_size(AV_PIX_FMT_BGRA, videoFrameWidth, videoFrameHeight); //         avFrameWithOpenCVCompatibleData uint8_t* avFrameWithOpenCVCompatibleDataBuffer = (uint8_t *) av_malloc((uint64_t) (avFrameWithOpenCVCompatibleDataBufferSize * sizeof(uint8_t))); avpicture_fill((AVPicture*) avFrameWithOpenCVCompatibleData, avFrameWithOpenCVCompatibleDataBuffer, AV_PIX_FMT_BGRA, videoFrameWidth, videoFrameHeight); avFrameWithOpenCVCompatibleData-&gt;height = videoFrameWidth; avFrameWithOpenCVCompatibleData-&gt;width = videoFrameHeight; //     _in    AV_PIX_FMT_BGRA     avFrameWithOpenCVCompatibleData sws_scale(avFrameToMatConvertContext, _in-&gt;data, _in-&gt;linesize, 0, _in-&gt;height, avFrameWithOpenCVCompatibleData-&gt;data, avFrameWithOpenCVCompatibleData-&gt;linesize); //     OpenCV Mat      FFmpeg AVFrame cv::Mat* cvVideoFrame = new cv::Mat(avFrameWithOpenCVCompatibleData-&gt;height, avFrameWithOpenCVCompatibleData-&gt;width, CV_8UC4, avFrameWithOpenCVCompatibleData-&gt;data[0]); //   cvVideoFrame    OpenCV, //       Facegood, //     cvVideoFrame        300x300 cvResultFrame = cv::imread("panda_300x300.jpg", -1); &lt;  cvVideoFrame      cvResultFrame&gt; // ,      av_free(avFrameWithOpenCVCompatibleDataBuffer); av_frame_free(&amp;avFrameWithOpenCVCompatibleData); delete cvVideoFrame; //    cvResultFrame  _out //     cvResultFrame  BGRA  YUV_I420 cvtColor(cvResultFrame, cvResultFrame, CV_BGRA2YUV_I420); //       AVFrame* _out size_t imageYPlaneSize = _out-&gt;width * _out-&gt;height; size_t imageUPlaneSize = imageYPlaneSize / 4; size_t imageVPlaneSize = imageUPlaneSize; int imageHalfWidth = _out-&gt;width / 2; int imageHalfHeight = _out-&gt;height / 2; for (int i = 0; i &lt; _out-&gt;height; i++) { memcpy(_out-&gt;data[0] + i * _out-&gt;linesize[0], cvResultFrame.data + i * _out-&gt;width, _out-&gt;width); if (i &lt; imageHalfHeight) { memcpy(_out-&gt;data[1] + i * _out-&gt;linesize[1], cvResultFrame.data + imageYPlaneSize + i * imageHalfWidth, imageHalfWidth); memcpy(_out-&gt;data[2] + i * _out-&gt;linesize[2], cvResultFrame.data + imageYPlaneSize + imageUPlaneSize + i * imageHalfWidth, imageHalfWidth); } } }</span></span></code> </pre><br></div></div><br>  That's all!   vf_scale    _out  ,      ,               (      ): <br><br><img src="https://habrastorage.org/files/f34/a8e/3e7/f34a8e3e7b8b4a99afc4a01e64539adb.jpg"><br><br>    ,    ,        ,             ‚Äî   FFmpeg  OpenCV    . <br><br><h2>  Conclusion </h2><br>         FFmpeg     .       ,   ,   - ,    .     FFmpeg     -  ‚Äî ,            . <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/254737/">https://habr.com/ru/post/254737/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254719/index.html">The Bresenham algorithm in a soldering furnace - theory</a></li>
<li><a href="../254721/index.html">Practical use of a small vocabulary</a></li>
<li><a href="../254727/index.html">Asynchronous work with Tarantool on Python</a></li>
<li><a href="../254731/index.html">Improving xaml: Bindable Converters, Switch Converter, Sets</a></li>
<li><a href="../254733/index.html">Using Asterisk to receive data from security systems</a></li>
<li><a href="../254739/index.html">Techno-Designed Alarm Clock - Arduino Based Desk Clock</a></li>
<li><a href="../254741/index.html">Traffic Inspector: full reboot</a></li>
<li><a href="../254743/index.html">Stepic seeking talents</a></li>
<li><a href="../254747/index.html">Comparison of deep learning libraries on the example of the handwriting numbers classification problem</a></li>
<li><a href="../254749/index.html">Bubot is a very easy Python 3 framework for robot programming and home automation.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>