<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to build an image classifier based on a pre-trained neural network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now there is a process of democratization of artificial intelligence - technology, which has recently been considered the privilege of a limited numbe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to build an image classifier based on a pre-trained neural network</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/532/7e0/d09/5327e0d090ce0b807a46f02b5a72c424.jpg" alt="main image"></div><br>  Now there is a process of democratization of artificial intelligence - technology, which has recently been considered the privilege of a limited number of large companies, is becoming increasingly available to individual professionals. <br><br>  In recent years, a large number of models have appeared, created and trained by professionals using a large amount of data and huge computational power.  Many of these models are in the public domain, and anyone can use them to solve their problems for free. <br><br>  In this article we will analyze how the pre-trained neural networks can be used to solve the problem of image classification, and evaluate the advantages of their use. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Prediction of the class of plants on the photo </h2><br>  As an example, we will consider the problem of classifying images from the <a href="http://www.imageclef.org/2014/lifeclef/plant">LifeCLEF2014 Plant Identification Task</a> contest.  The challenge is to predict the taxonomic class of a plant, based on several of its photographs. <br><a name="habracut"></a><br>  We have 47815 images of plants available for training, each of which belongs to one of 500 classes.  It is necessary to build a model that will return a list of the most likely plant classes.  The position of the correct plant class in the list of predicted classes (rank) determines the quality of the system. <br><br>  This task simulates a real life scenario where a person tries to identify a plant by studying its individual parts (stem, leaf, flower, etc.) <br>  The model receives ‚Äúobservation‚Äù at the entrance - a set of photos of the same plant, made on the same day, using the same device, under the same weather conditions.  As an example, you can take the image provided by the organizers of the competition: <br><br><img src="http://www.imageclef.org/system/files/OnePrunus.png" alt="Imageclef"><br><br>  Since the quality and quantity of photos varies from user to user, the organizers proposed a metric that will take into account the ability of the system to provide accurate predictions for individual users.  Thus, a primary quality indicator is defined as the following average grade S: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>S</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>U</mi></mrow><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>u</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>U</mi></mrow></msubsup><mtext>&amp;#xA0;</mtext><mi>d</mi><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>p</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>u</mi></mrow></msub></mrow><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>p</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>p</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>u</mi></mrow></msub></mrow></msubsup><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>u</mi><mo>,</mo><mi>p</mi></mrow></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="42.614ex" height="3.383ex" viewBox="0 -935.7 18347.8 1456.5" role="img" focusable="false" style="vertical-align: -1.209ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-53" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMAIN-3D" x="923" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-66" x="2229" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-72" x="2780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-61" x="3231" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-63" x="3761" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMAIN-31" x="4194" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-55" x="4695" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-73" x="5712" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-75" x="6182" y="0"></use><g transform="translate(6754,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-55" x="1242" y="510"></use><g transform="translate(878,-308)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-75" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMAIN-3D" x="572" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMAIN-31" x="1351" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-64" x="9292" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-66" x="9815" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-72" x="10366" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-61" x="10817" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-63" x="11347" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMAIN-31" x="11780" y="0"></use><g transform="translate(12281,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-75" x="712" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-73" x="13539" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-75" x="14009" y="0"></use><g transform="translate(14581,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-6D" x="0" y="0"></use><g transform="translate(878,513)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-75" x="712" y="-326"></use></g><g transform="translate(878,-308)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMAIN-3D" x="503" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMAIN-31" x="1282" y="0"></use></g></g><g transform="translate(16820,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-75" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMAIN-2C" x="572" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-70" x="851" y="0"></use></g></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>S</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>U</mi></mrow><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class="MJX-TeXAtom-ORD"><mi>u</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>U</mi></mrow></msubsup><mtext>&nbsp;</mtext><mi>d</mi><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mi>u</mi></mrow></msub></mrow><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class="MJX-TeXAtom-ORD"><mi>p</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mi>u</mi></mrow></msub></mrow></msubsup><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>u</mi><mo>,</mo><mi>p</mi></mrow></msub></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> S = \ frac {1} {U} \ sum_ {u = 1} ^ {U} \ dfrac {1} {p_ {u}} \ sum_ {p = 1} ^ {p_ {u}} s_ {u , p} </script></p><br>  Where <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>U</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.783ex" height="2.057ex" viewBox="0 -780.1 767.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-55" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> U </script>  - the number of users who have at least one photo in the test sample, <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>p</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>u</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.431ex" height="1.817ex" viewBox="-38.5 -520.7 1046.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-75" x="712" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mi>u</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-3"> p_ {u} </script>  - the number of unique plants that the user has photographed <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>U</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.783ex" height="2.057ex" viewBox="0 -780.1 767.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-55" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> U </script>  , <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>u</mi><mo>,</mo><mi>p</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.547ex" height="2.057ex" viewBox="0 -520.7 1527.3 885.9" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-75" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMAIN-2C" x="572" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/344222/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjrK9wmUJ9MA7i6gcMCx07MT7WmwQ#MJMATHI-70" x="851" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>u</mi><mo>,</mo><mi>p</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-5"> s_ {u, p} </script>  - A value from 0 to 1, calculated as the inverse of the rank of the correct class of the plant in the list of the most likely classes. <br><br>  The competition banned the use of any external data sources, including pre-trained neural networks.  We will intentionally ignore this restriction to demonstrate how the classifier can be improved with the help of pre-trained models. <br><br><h2>  Decision </h2><br>  To solve the problem, we will use neural networks that have been trained on 1.2 million images from the ImageNet database.  The images contain objects belonging to 1000 different classes, such as a computer, a table, a cat, a dog, and other objects that we often meet in everyday life. <br><br>  We chose VGG16, VGG19, ResNet50 and InceptionV3 as the base architectures.  These networks were trained on a huge number of images and already know how to recognize the simplest objects, so we can hope that they will help us create a decent model for the classification of plants. <br><br>  So let's start with ... image preprocessing, as without it. <br><br><h3>  Image preprocessing </h3><br>  Image preprocessing is pre-processing of images.  The main purpose of preprocessing, in our case, is to identify the most important part of the image and remove unnecessary noise. <br><br>  We will use the same preprocessing methods as the competition winners ( <a href="http://ceur-ws.org/Vol-1180/CLEF2014wn-Life-ChenEt2014.pdf">IBM Research team</a> ), but with a few changes. <br><br>  All images in the training set can be divided into categories depending on the part of the plant depicted in them: Entire (whole plant), Branch (branch), Flower (flower), Fruit (fruit), LeafScan (scan leaf), Leaf (leaf) , Stem (stem).  For each of these categories was chosen its most suitable method of preprocessing. <br><br>  <b>Entire and Branch image processing</b> <br><br>  We will not change the Entire and Branch images, since often most of the images contain useful information that we don‚Äôt want to lose. <br><br><div class="spoiler">  <b class="spoiler_title">Example of whole images</b> <div class="spoiler_text"><table border="1"><tbody><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/af9/401/d16/af9401d1614ef73fbd46785ec1742165.png" alt="Entire1"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/a3b/f4d/0e0/a3bf4d0e069407a754232f115039df0b.png" alt="Whole2"></td></tr></tbody></table><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Sample Branch Images</b> <div class="spoiler_text"><table border="1"><tbody><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/8e2/9b6/fa9/8e29b6fa9dc1deda9a8e2c8fa92d8aef.png" alt="Branch1"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/4a5/4cf/446/4a54cf4469d0c8a101852e34afe9b4c1.png" alt="Branch2"></td></tr></tbody></table><br></div></div><br>  <b>Processing Flower and Fruit images</b> <br><br>  We will use the same method for processing Flower and Fruit images: <br><br><ul><li>  we convert the image to black and white; </li><li>  apply a Gaussian filter with the parameter a = 2.5; </li><li>  use <a href="http://scikit-image.org/docs/dev/auto_examples/edges/plot_active_contours.html">the active contour method</a> to find the most important part of the image; </li><li> describe a rectangle around the border. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Example of processing a flower image</b> <div class="spoiler_text"><table border="1"><tbody><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/8a9/249/d3a/8a9249d3ad84f6c0e33fe1df21b92598.png" alt="flower1 new"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/7fd/a97/d7d/7fda97d7d648f752be9a2641c26fb33f.png" alt="flower1 old"></td></tr></tbody></table><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Fruit image processing example</b> <div class="spoiler_text"><table border="1"><tbody><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/8d6/1f1/cc3/8d61f1cc38401c56aa4c9fda368283fc.png" alt="fruit1 new"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/019/3a3/d0f/0193a3d0f94e3f873e03084316d6afa3.png" alt="fruit1 old"></td></tr></tbody></table><br></div></div><br>  <b>LeafScan Image Processing</b> <br><br>  Looking at LeafScan photos, you can see that in most cases the sheet is on a light background.  We normalize the image with white: <br><br><ul><li>  First, convert the image to black and white and use the Otsu-method to calculate the threshold value; </li><li>  all pixels whose values ‚Äã‚Äãare less than the threshold value are painted white. </li></ul><br><div class="spoiler">  <b class="spoiler_title">LeafScan Image Processing Example</b> <div class="spoiler_text"><table border="1"><tbody><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/654/1ef/dd6/6541efdd6ba7c619671f4414cf0905ea.png" alt="leafscan1 new"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/662/539/acd/662539acd8f02cb036cea759bb69c4fe.png" alt="leafscan1 old"></td></tr></tbody></table><br></div></div><br>  <b>Leaf Image Processing</b> <br><br>  Usually in Leaf images, the sheet is in the center, and its outline is slightly receding from the edges of the image.  For preprocessing such photos we will use the following method: <br><br><ul><li>  cut out 1/10 of the image on the left, right, bottom and top; </li><li>  we convert the image to black and white; </li><li>  apply a Gaussian filter with the parameter a = 2; </li><li>  use the active contour method to calculate the boundary of the most important area; </li><li>  describe a rectangle around the resulting border. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Leaf image processing example</b> <div class="spoiler_text"><table border="1"><tbody><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/83a/ab1/a88/83aab1a8812e9c59001306826ba84e43.png" alt="leaf1 new"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/4a4/ed8/bf1/4a4ed8bf1ac9c050b11ea6578f8e310e.png" alt="leaf1 old"></td></tr></tbody></table><br></div></div><br>  <b>Stem image processing</b> <br><br>  The stem is usually located in the center of the image.  To process Stem images we will use the following algorithm: <br><br><ul><li>  delete ‚Öï parts of the image on the left, right, bottom and top; </li><li>  we convert the image to black and white; </li><li>  apply a Gaussian filter with the parameter a = 2; </li><li>  use the active contour method to calculate the border of the most important image area; </li><li>  describe a rectangle around the resulting border. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Stem image processing example</b> <div class="spoiler_text"><table border="1"><tbody><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/e8d/117/273/e8d1172735cdd26e4284f782a7fe1235.png" alt="stem1 new"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/fca/dea/c62/fcadeac628ee9d1277364b315e6fac9c.png" alt="stem1 old"><br></td></tr></tbody></table><br></div></div><br>  Now everything is ready for building a classifier. <br><br><h3>  How we built an image classifier based on a pre-trained neural network </h3><br>  We will build the model using <a href="https://keras.io/"><i>Keras</i></a> with <a href="https://www.tensorflow.org/"><i>TensorFlow</i></a> as a back-end.  <i>Keras</i> is a powerful machine learning library designed to work with neural networks, which allows you to build all kinds of models: from simple ones, such as a perceptron, to very complex networks designed for video processing.  And what is very important in our case, Keras allows you to use pre-trained neural networks and optimize models using both the CPU and the GPU. <br><br>  <b>STEP 1</b> <br><br>  First, we load the pre-trained model without fully connected layers and apply the pooling operation to its output.  In our case, the best results were shown by the ‚Äúaverage‚Äù pooling ( <i>GlobalAveragePooling</i> ), and we will take it for building a model. <br><br>  Then we run the images from the training set through the resulting network, and save the received signs to a file.  A little later, you will see why it is needed. <br><br>  <b>STEP 2</b> <br><br>  We could freeze all layers of the pre-trained network, add our fully connected network over it, and then train the resulting model, but we will not do that, because in this case we will have to drive all the images through the pre-trained network at each epoch, a lot of time.  To save time, we use the features that we saved in the previous step in order to train a fully connected network on them. <br><br>  At this stage, do not forget to divide the training set into two parts: the training set in which we will be trained, and the validation set in which we will consider an error in order to correct the weights.  Data can be divided in the ratio of 3 to 1. <br><br>  Let's take a closer look at the full mesh network architecture that we will be teaching.  After a series of experiments, it was found that one of the best architectures has the following structure: <br><br><ul><li>  3 dense layers of 512 neurons.  Behind each dense layer is a <i>dropout</i> layer, with a parameter of 0.5.  This means that in each layer on each pass of the network, we randomly emit signals of about half of the neurons; </li><li>  the output layer is <i>softmax</i> for 500 classes; </li><li>  as a loss function, we use <i>categorical cross-entropy</i> , and we optimize the network with <i>Adam</i> ; </li><li>  It was also noted that using the <a href="https://arxiv.org/pdf/1706.02515.pdf">selu</a> function <i>(scaled exponential unit)</i> instead of <i>relu</i> as an activation function helps the network converge faster. </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/31d/b22/410/31db224100440eae2b231d158404dd8d.png" alt="selu eng"><br><br>  <b><i>Useful information:</i></b> <br><br><ul><li>  with the described learning method, we cannot use augmentation (image transformation: rotations, compression, adding noise, etc.), but since the model obtained at this step is only an intermediate result in the process of creating the final model, for us this limitation is not critical; <br></li><li>  such networks learn very quickly, and we can manually determine the required number of epochs; </li><li>  in our case, the neural network required 40 to 80 epochs for convergence; <br>  retraining or under-training of a model should not worry us much, since we will still have a chance to fix it. </li></ul><br>  <b>STEP 3</b> <br><br>  In this step, we add a trained fully meshed network on top of the pre-trained model.  The loss function is left unchanged, and we will use another optimizer for network training. <br><br>  The pre-trained neural network has already learned a lot of abstract and common features, and in order not to knock down the found weights, we will train the network with a very small learning rate.  Optimizers such as <i>Adam</i> and <i>RMSProp</i> themselves select the learning speed, in our case, the selected speed may be too high, so they do not suit us.  To be able to set the learning speed by ourselves, we will use the classic SGD optimizer. <br><br>  <b><i>To improve the quality of the final classifier, you need to remember the following:</i></b> <br><br><ul><li>  reduce the learning rate on the plateau so as not to go too far towards the minimum ( <i>ReduceLROnPlateau callback</i> ); </li><li>  if over several epochs the error on validation data does not decrease, then it is worth stopping training ( <i>EarlyStopping callback</i> ); </li><li>  Usually, additional training of models takes a lot of time and when we close <i>.ipynb</i> files, all dynamic output is lost.  I recommend saving the training information to a file ( <i>CSVLogger callback</i> ) so that you can further analyze how the model is being trained. </li></ul><br>  Instead of the standard progress bar, I prefer to use <i>TQDMNotebookCallback</i> .  This does not directly affect the result, but it‚Äôs much more pleasant to watch model training with it. <br><br><h3>  Data augmentation </h3><br>  Because in the final step we train the entire network, here we can use augmentation.  But instead of the standard <i>ImageDataGenerator</i> from <i>Keras,</i> we will use <a href="https://github.com/aleju/imgaug">Imgaug</a> - a library that is designed to augment images.  An important feature of <i>Imgaug</i> is that you can explicitly indicate with what probability the transformation should be applied to the image.  In addition, in this library there is a wide variety of transformations, it is possible to combine transformations into groups, and choose which of the groups to apply.  Examples can be found at the link above. <br><br>  For augmentation, we select those transformations that can occur in real life, for example, mirroring photos (horizontally), turns, zoom, noise, change in brightness and contrast.  If you want to use a large number of transformations, it is very important not to apply them at the same time, since it will be very difficult for the network to extract useful information from the photo. <br><br>  I propose to split the transformations into several groups and apply each of them with a given probability (each may have a different probability).  I also recommend augmenting images in 80% of cases, then the network will be able to see the real images.  Given that training takes several dozen epochs, there is a very big chance that the network will see each image in the original. <br><br><h3>  Accounting for user ratings of photos </h3><br>  The metadata for each image contains a quality rating (average user rating, showing how well the image is suitable for classification).  We assumed that images with a score of 1 and 2 are quite noisy, and although they may contain useful information, in the end, they may adversely affect the quality of the classifier.  We tested this hypothesis while training InceptionV3.  There were very few images with a rating of 1 in the training set, only 1966, so we decided not to use them in training.  As a result, the network has been trained better in images with a rating higher than one, so I recommend that you carefully consider the quality of the images in the training set. <br><br>  Below you can see the graphs of additional training ResNet50 and InceptionV3.  Looking ahead a bit, I‚Äôll say that it was these networks that helped us achieve the best results. <br><br>  <i>ResNet50 Advanced Training Schedule</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/686/684/e61/686684e61370ffb759a27b2ddb144520.png" alt="ResNet50 full"><br><br>  <i>InceptionV3 Advanced Training Schedule</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/062/c5d/d83/062c5dd8320f3c9b6aa4adae40c26b03.png" alt="Inception V3 full"><br><br><h3>  Test time augmentation </h3><br>  Another way to help increase the quality of the classifier is prediction on augmented data (test-time augmentation, TTA).  This method consists in making predictions not only for images in the test set, but also for their augmentations. <br>  For example, take the five most realistic transformations, apply them to the images and get the predictions not for just one picture, but for six.  After that, we average the result.  Please note that all augmented images are obtained as a result of one transformation (one image - one transformation). <br><br>  <i>An example of prediction augmentation</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/9bb/daf/23b/9bbdaf23b2e4ed06fbbc69f2f6c7a6d0.png" alt="Augmentation example"><br><br><h3>  results </h3><br>  The results of the work done are presented in the table below. <br><br>  We will use 4 metrics: the main metric proposed by the organizers, as well as 3 top metrics - Top 1, Top 3, Top 5. Top metrics, like the main one, are applied to the observation (a set of photos with the same Observation Id), and not to a separate image. <br><br>  In the process, we tried to combine the results of several models in order to further improve the quality of the classifier (all models were taken with the same weight).  The last three lines in the table show the best results obtained when combining models. <br><br><table><caption>  Comparison of model performance </caption><tbody><tr><th width="90">  Model </th><th width="90">  Network </th><th width="100">  Target metric (rank) </th><th width="100">  Top 1 </th><th width="100">  Top 3 </th><th width="100">  Top 5 </th><th width="70">  Epochs </th><th width="60">  Tta </th></tr><tr><td>  one </td><td>  VGG16 </td><td>  0.549490 </td><td>  0.454194 </td><td>  0.610442 </td><td>  0.665546 </td><td>  49 </td><td>  Not </td></tr><tr><td>  2 </td><td>  VGG16 </td><td>  0.553820 </td><td>  0.458732 </td><td>  0.612600 </td><td>  0.666996 </td><td>  49 </td><td>  Yes </td></tr><tr><td>  3 </td><td>  VGG19 </td><td>  0.559978 </td><td>  0.468980 </td><td>  0.620219 </td><td>  0.671253 </td><td>  62 </td><td>  Not </td></tr><tr><td>  four </td><td>  VGG19 </td><td>  0.563019 </td><td>  0.470534 </td><td>  0.619303 </td><td>  0.676396 </td><td>  62 </td><td>  Yes </td></tr><tr><td>  five </td><td>  ResNet50 </td><td>  0.573424 </td><td>  0.489943 </td><td>  0.627836 </td><td>  0.682585 </td><td>  46 </td><td>  Not </td></tr><tr><td>  6 </td><td>  ResNet50 </td><td>  0.581954 </td><td>  0.495962 </td><td>  0.638806 </td><td>  0.688938 </td><td>  46 </td><td>  Yes </td></tr><tr><td>  7 </td><td>  InceptionV3 </td><td>  0.528063 </td><td>  0.495962 </td><td>  0.666928 </td><td>  0.716630 </td><td>  38 </td><td>  Not </td></tr><tr><td>  eight </td><td>  InceptionV3 </td><td>  0.615734 </td><td>  0.535675 </td><td>  0.671392 </td><td>  0.723992 </td><td>  38 </td><td>  Yes </td></tr><tr><td>  9 </td><td>  Combining models 1, 3, 5, 7 </td><td>  0.63009 </td><td>  0.549993 </td><td>  0.677204 </td><td>  0.721084 </td><td>  - </td><td>  - </td></tr><tr><td>  ten </td><td>  Combining models 2, 4, 6, 8 </td><td>  0.635100 </td><td>  0.553577 </td><td>  0.680857 </td><td>  0.727824 </td><td>  - </td><td>  - </td></tr><tr><td>  eleven </td><td>  Combining models 2, 6, 8 </td><td>  0.632564 </td><td>  0.551064 </td><td>  0.684839 </td><td>  0.730051 </td><td>  - </td><td>  - </td></tr></tbody></table><br><br>  The competition winners model showed a score of 0.471 in the target metric.  It is a combination of statistical methods and a neural network, trained only on those images of plants that were provided by the organizers. <br><br>  Our model, which uses the pre-trained neural network InceptionV3 as the basis, achieves the result of 0.60785 in the target metric, improving the result of the contest winners by 29%. <br><br>  When using augmentation on test data, the result on the target metric increases to 0.615734, but at the same time, the model's speed drops by about 6 times. <br><br>  We can go even further and combine the results of several networks.  This approach allows to achieve the result of 0.635100 on the target metric, but at the same time the speed drops very much, and in real life such a model can be used only where work speed is not a key factor, for example, in various studies in laboratories. <br><br>  Existing models can not always correctly determine the class of the plant, in this case it may be useful to know the list of the most likely plant species.  In order to measure the ability of a model to produce the true class of a plant in the list of the most likely classes, we use top metrics.  For example, according to the Top 5 metric, the InceptionV3 learned network showed a result of 0.716630.  If we combine several models and apply TTA, then we can improve the result to 0.730051. <br><br>  I described how we managed to improve the quality of the model using pre-trained neural networks, but, of course, this article describes only a part of the available methods. <br><br>  <b>I recommend trying other approaches that look quite promising:</b> <br><br><ul><li>  the use of more accurate methods for image processing; </li><li>  modification of the architecture of fully connected layers; </li><li>  change of activation function for dense layers; </li><li>  using only the highest quality images for training (for example, with a rating higher than 2); </li><li>  the study of the distribution of classes in the training set, and the use of the <i>class_weight</i> parameter during training. </li></ul><br><h3>  Total </h3><br>  Additional training of neural networks, which were trained on more than 1 million images, has significantly improved the solution presented by the winners of the competition.  Our approach has shown that pre-trained models can significantly improve the quality of image classification problems, especially in situations where there is not enough data to train.  Even if your basic model has nothing to do with the problem to be solved, it may still be useful, since it already knows how to recognize the simplest objects of the surrounding world. <br><br>  <b>The most important steps that helped achieve these results:</b> <br><br><ul><li>  using <i>Imgaug</i> for image augmentation (this library contains more transformations than the <i>Keras</i> <i>ImageDataGenerator</i> , in addition, it is possible to combine transformations into groups); </li><li>  80% of images were augmented at each training epoch; </li><li>  the use of predictions on augmented data (TTA); </li><li>  decrease in learning rate on the plateau; </li><li>  stop learning if the value of the loss function on validation data does not decrease over several epochs; </li><li>  model training on images with a score greater than 1. </li></ul><br>  I wish you good luck in your experiments! </div><p>Source: <a href="https://habr.com/ru/post/344222/">https://habr.com/ru/post/344222/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344206/index.html">Reflection in C ++ 14</a></li>
<li><a href="../344210/index.html">How to find out what the program for Linux will do without actually doing it?</a></li>
<li><a href="../344214/index.html">Strike iron: hot hardware startups</a></li>
<li><a href="../344216/index.html">What's new in DataGrip 2017.3</a></li>
<li><a href="../344220/index.html">Kubernetes 1.9: a review of major innovations</a></li>
<li><a href="../344224/index.html">How and why to determine voice mail</a></li>
<li><a href="../344226/index.html">Tanchiki in the console, the first article: "From the dispute to writing code"</a></li>
<li><a href="../344228/index.html">‚ÄúIs it a good design or not?‚Äù - how do I answer this question with the help of 3 categories</a></li>
<li><a href="../344230/index.html">Oracle Open World 2017: Announcements of ‚ÄúAutonomous AI‚Äù</a></li>
<li><a href="../344234/index.html">Python Meetup 11/14/2017: Python in Porto, Aiohttp and again tests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>