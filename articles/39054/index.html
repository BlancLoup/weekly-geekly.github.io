<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up viewing and uploading files in FCKeditor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article describes the individual techniques for setting up the FCKeditor editor and its built-in file browser to control the uploading of files t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up viewing and uploading files in FCKeditor</h1><div class="post__text post__text-html js-mediator-article"> This article describes the individual techniques for setting up the FCKeditor editor and its built-in file browser to control the uploading of files to the server.  These techniques will help to better understand the principles of the editor and more closely integrate it into your CMS, at the same time preventing possible security problems when using this editor. <br><a name="habracut"></a><br>  General information about the editor FCKeditor you can find on its official website <a href="http://www.fckeditor.net/">www.fckeditor.net</a> .  In short: this is a WYSIWYG editor written in JavaScript and supporting work with server scripts in various programming languages ‚Äã‚Äã(perl, php, python, asp).  Further everywhere I will have in mind the <b>php</b> language, but everything said can be easily adapted for other languages.  The editor works fine in most modern browsers (IE 6+, FF 1.5+, Opera 9.5), has rich functionality and well-documented code that allows you to edit it to adapt to the specific requirements of the CMS in which it is used.  This is not an advertisement, but an explanation of why I use this editor and decided to write this article :) <br><br>  Among other things, the editor allows you to insert into the editable text various objects: images, Flash-videos, multimedia files, as well as links to arbitrary files from the server.  Two dialogs are used for this: inserts and object properties (for example, an image, see the first slide) and a resource browser (see the second slide).  On the slides, I highlighted the controls that will be mentioned in the text.  The insert dialog is invoked when clicking on the image insertion buttons, it implements two important functions for us: upload the image file to the server and call the resource browser window.  The ability to perform these functions and a number of parameters (location of downloadable files on the server, valid file extensions, etc.) are described in the configuration files. <br><br>  <b>Inserting and editing object properties</b> <br><img src="https://habrastorage.org/getpro/geektimes/post_images/d19/b5e/f77/d19b5ef77e5fee4e6bc6e18b67e11eef.png" width="444" height="365"><br>  <b>Resource Browser Dialog</b> <br><img src="https://habrastorage.org/getpro/geektimes/post_images/708/901/f8e/708901f8e901d757acc3e923dd3a318a.png" width="700" height="450">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next, we define: it will be about FCKeditor version <b>2.6.3</b> , which was the last one at the time of this writing. <br><br>  The main editor configuration file is called <code>fckconfig.js</code> and is located in the root directory of the editor (for definiteness, we assume that the editor is in the / fcke / root directory of the site).  In it, we are interested in lines 284 through 312, which describe the settings for downloading files of various types in a different way.  The LinkBrowser, ImageBrowser, and FlashBrowser fields determine whether the View on Server button is displayed in the corresponding dialog box, which opens the resource browser dialog.  The fields LinkUpload, ImageUpload, FlashUpload determine the presence in the corresponding dialog of the ‚ÄúDownload‚Äù tab for a quick download of the corresponding file.  By setting the required fields to false, you disable the display of the corresponding interface elements. <br><br>  However, as you know, and always have to remember, the user can always change the client settings with due diligence against your will, so I knowingly clarified that the previous settings affect the interface more than the actual restrictions on downloading and viewing files on the server.  Therefore, the basic access settings are controlled through the configuration of server scripts. <br><br>  The scripts controlling viewing and uploading the file to the server are located in the subfolder <code>editor/filemanager/connectors/LANGUAGE</code> , where LANGUAGE is the server scripting language.  We, as I said, will consider the settings on the example of PHP.  It is better to completely erase unused connectors for security reasons and simply reduce the space occupied.  There is a configuration file in the connector directory, in our case it is <code>config.php</code> .  This file contains everything you need to set up file uploads. <br><br>  1. Line 30. Here is the main "switch" of the connector, supplied, as expected, with a stern warning that you can only turn it on by setting everything up correctly, otherwise you will get a big hole in the security of the site.  In order for the connector to work at all, in this line, of course, you need to write = true. <br><br>  2. Line 34. Specifies the relative URL of the folder with the resources managed by this connector. <br><br>  Here it is time to figure out how we manage access to the resource browser in accordance with the rights of visitors to the site.  If we use the editor in a single-user CMS (when everyone who was able to access the editor‚Äôs catalog has the right to upload anything to the site), it‚Äôs enough to configure everything for the site administrator and deny access to others (for example, at the web server level) .  But if the editor will be used to write posts in personal blogs, then you need to firstly prohibit the work of the connector for unauthorized users, and secondly, split the folders for downloading files by different users. <br><br>  The configuration file is used when a resource browser web page is accessed by the connector.  Therefore, the only way out is to include a call to your own script in this file, which will check the user's authorization (by cookie, for example) and turn the connector on and off, and at the same time specify the correct path. <br><br>  Code example: <br><br><pre>  global $ Config;

 require ('my_auth_script.php');
 $ currentUser = GetCurrentUser ();

 if ($ currentUser)
 {
   $ Config ['Enabled'] = true;
   $ Config ['UserFilesPath'] = "/ userfiles / $ currentUser /";
 }
 else
 {
   $ Config ['Enabled'] = false;
   $ Config ['UserFilesPath'] = '';
 } </pre><br><br>  Next in the file ... <br><br>  3. Line 40. Here you can see the path to the same folder with resources, but from the point of view of the file system.  If this path is left blank, it will be determined by calling a function from the web server API (in the case of PHP, it is <a href="http://ru2.php.net/manual/ru/function.apache-lookup-uri.php" title="PHP function reference">apache_lookup_uri</a> , which returns information about the object by the specified URI).  If you have mod_rewrite configured on the server in the directory pointed to by 'UserFilesPath', you need to fill this field because  The request through the web server will be executed with regard to mod_rewrite and may lead completely to the wrong place. <br><br>  4. Line 54. Here are listed the types of resources with which the resource browser can work.  Remember these names, they will be mentioned in the next block of settings. <br><br>  5. Lines 123 - 149. Here are the setting blocks for each type of resource.  The settings are grouped together, the composition of the groups is the same, so we consider only one of them.  The comments before the blocks describe in detail the purpose of the fields, so my description is mostly a translation and retelling of this comment in my own words. <br><ul><li>  'AllowedExtensions' - file extensions that are allowed to upload to the server for this type of resource.  The type of resource, by the way, is selected from the list in the upper left corner of the resource browser (see the second slide). </li><li>  'DeniedExtensions' - a list of file extensions that are prohibited for download.  Only one of these two lists makes sense. </li></ul><br>  It is first checked if the list of allowed extensions is not empty and the extension of the downloadable file is <em>missing</em> in it, the file is not accepted.  Then it is checked if the list of prohibited extensions is not empty and the extension of the downloadable file is <em>present</em> in it, the file is not accepted.  To disable the ability to load any type of resources, you can specify in the 'AllowedExtensions' array of one element "*", because  None of the downloaded files will fit this extension.  You can also configure valid extensions depending on user rights, as already described just above. <br><br>  Next come the path settings for file placement.  We see that directory path settings are formed from global paths (specified in lines 34 and 40) by adding to them the corresponding subdirectory.  But nothing prevents you from specifying these paths directly, with string constants.  By the way, the global path is no longer used for anything, except for the formation of paths for each type of resource (this is just a note so that you are not afraid to change them as you need). <br><br><ul><li>  'FileTypesPath' is the URL of the directory where the file will be uploaded <em>through the resource browser</em> . </li><li>  'FileTypesAbsolutePath' is the same directory in terms of the file system.  The rules for this setting are the same as for the global 'UserFilesAbsolutePath' - automatic search for a path if you do not specify anything in this field. </li><li>  'QuickUploadPath' is the URL of the directory to which the file will be uploaded <em>via the ‚ÄúDownload‚Äù tab of the</em> object's insert dialog (links, images, Flash movie). </li><li>  'QuickUploadAbsolutePath' is the file system path to the same directory. </li></ul><br>  Please note (this is also described in the comments) that by default this directory is different from the one specified by the 'FileTypesPath' field (it is written that for backward compatibility), therefore it is recommended to edit the lines 'QuickUploadPath' and 'QuickUploadAbsolutePath' to specify to the same directory as 'FileTypesPath' and 'FileTypesAbsolutePath' respectively: <br><br><pre>  foreach ($ Config ['ConfigAllowedTypes'] as $ resType)
 {
   $ Config ['QuickUploadPath'] [$ resType] 
     = $ Config ['FileTypesPath'] [$ resType];
   $ Config ['QuickUploadAbsolutePath'] [$ resType] 
     = $ Config ['FileTypesAbsolutePath'] [$ resType];
 } </pre><br>  at the end of the settings file, and simply assigning the assignment lines to the 'QuickUploadPath' and 'QuickUploadAbsolutePath' fields.  Otherwise, you may encounter an unpleasant effect - files uploaded through the ‚ÄúDownload‚Äù tab will not be visible by the ‚ÄúView on server‚Äù button. <br><br>  And finally, a small bonus.  The fact is that the rich functions of the browser built into FCKeditor can be used not only in the editor, but also separately. <br><br>  To view and manage image files, you must create a window (for example, by calling the <code>window.open</code> JavaScript function at the click of a button) by opening a page with the following URL: <code>/fcke/editor/filemanager/browser/default/browser.html?Type=Image&amp;Connector=../../connectors/php/connector.php</code> <br><br>  In the opening window should be a JS-function <br><pre>  function SetUrl (url)
 {
 } </pre><br>  which will be called when the user clicks on the image file, the corresponding URL will be passed to this function. <br><br>  If you want to allow the user to browse all categories of files, not just images, remove the <code>Type=Image</code> parameter from the browser URL above.  Then all the types listed in the connector configuration file will appear in the drop-down list of file types (line 54). <br><br>  I hope the information was helpful.  Ready for constructive dialogue and valid criticism :) </div><p>Source: <a href="https://habr.com/ru/post/39054/">https://habr.com/ru/post/39054/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../390531/index.html">"Hide the matches from the children!" Or what (not) warns the Ministry of Health</a></li>
<li><a href="../390533/index.html">ECG at home: a selection of portable devices</a></li>
<li><a href="../390535/index.html">Sci-One. The most daring scientific scam</a></li>
<li><a href="../390537/index.html">Incredible works of art created by robots</a></li>
<li><a href="../390539/index.html">eBlocker: Anonymity as claimed product. Anonymizer blocker is about to collect half a million Euros on Kickstarter</a></li>
<li><a href="../390541/index.html">Google closes picasa photoservice</a></li>
<li><a href="../390543/index.html">RIAA equates online listening to sales of albums</a></li>
<li><a href="../390545/index.html">Tim Cook's open letter about FBI pressure on Apple</a></li>
<li><a href="../390547/index.html">The absolute record of data transfer rate is set: 1.125 Tbit / s</a></li>
<li><a href="../390549/index.html">Chances of further communication with Phil's satellite are approaching zero.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>