<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Forms and custom input fields in Angular 2+</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My name is Pavel, I am a frontend developer Tinkoff.ru. Our team is developing an online bank for legal entities . The frontend of our projects was im...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Forms and custom input fields in Angular 2+</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/9ff/2a1/15d/9ff2a115d1884838baf26b0de02efd09.png" alt="image" align="left">  My name is Pavel, I am a frontend developer Tinkoff.ru.  Our team is developing an <a href="https://www.tinkoff.ru/business/">online bank for legal entities</a> .  The frontend of our projects was implemented using AngularJS, from which we switched, in part using <a href="https://angular.io/docs/ts/latest/guide/upgrade.html">Angular Upgrade</a> , to the new Angular (previously positioned as Angular 2). <br><br>  Our product is intended for legal entities.  Such a subject requires many forms with complex behavior.  Input fields include not only standard ones implemented in browsers, but also fields with masks (for example, for phone input), fields for working with tags, sliders for entering numeric data, various drop-down lists. <br><br>  In this article, we will look under the hood of the implementation of forms in Angular and figure out how to create custom input fields. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is assumed that the reader is familiar with the basics of Angular, in particular, with <a href="https://angular.io/docs/ts/latest/guide/template-syntax.html">data binding</a> and <a href="https://angular.io/docs/ts/latest/guide/dependency-injection.html">dependency injection</a> (links to official guides in English).  In Russian with data binding and the basics of Angular as a whole, including working with forms, you can find it <a href="https://metanit.com/web/angular2/2.5.php">here</a> .  On Habrahabr, there was already an <a href="https://habrahabr.ru/post/281449/">article</a> about the introduction of dependencies in Angular, but you need to consider that it was written long before the release of the release version. <br><a name="habracut"></a><br><h1>  Introduction to Forms </h1><br>  When working with a large number of forms, it is important to have powerful, flexible and convenient tools for creating and managing forms. <br><br>  The possibilities of working with forms in Angular are much wider than in AngularJS.  Two types of forms are defined: <b>template-based</b> , that is, template-driven (template-based forms) and <b>reactive</b> , model-driven / model-reactive forms. <br><br>  Detailed information can be obtained in the <a href="https://angular.io/docs/ts/latest/guide/forms.html">official guide</a> .  Here we analyze the main points, with the exception of validation, which will be discussed in the next article. <br><br><h2>  Template Forms </h2><br>  In template forms, the behavior of the field is controlled by the attributes set in the template.  As a result, you can interact with the form in ways <a href="https://docs.angularjs.org/api/ng/directive/ngModel">familiar from AngularJS</a> . <br><br>  To use template forms, you need to import the FormsModule module: <br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {FormsModule} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/forms'</span></span>;</code> </pre> <br>  <a href="https://angular.io/docs/ts/latest/api/forms/index/NgModel-directive.html">The NgModel directive</a> from this module makes available for input fields one-way binding of values ‚Äã‚Äãvia <code>[ngModel]</code> , two-sided through <code>[(ngModel)]</code> , and change tracking via <code>(ngModelChange)</code> : <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> [(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngModel</span></span></span><span class="hljs-tag">)]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngModelChange</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"countryModelChange($event)"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  The form is specified <a href="https://angular.io/docs/ts/latest/api/forms/index/NgForm-directive.html">by the NgForm directive</a> .  This directive is created when we simply use the <code>&lt;form&gt;&lt;/form&gt;</code> or the <code>ngForm</code> attribute inside our template (without forgetting to connect the FormsModule). <br><br>  Input fields with NgModel directives that are inside the form will be added to the form and reflected in the <i>form value</i> . <br><br>  The NgForm directive can also be assigned using the <code>#formDir="ngForm"</code> ‚Äî in this way we will create a local variable for the formDir template that will contain an instance of the NgForm directive.  Its value property, inherited from the <a href="https://angular.io/docs/ts/latest/api/forms/index/AbstractControlDirective-class.html">AbstractControlDirective</a> class, contains the value of the form.  This may be necessary to obtain the value of the form (shown in the live example). <br><br>  A form can be structured by adding <i>groups</i> (which will be represented by objects in the form value) using the ngModelGroup directive: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngModelGroup</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"address"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"country"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngModel</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"city"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngModel</span></span></span><span class="hljs-tag"> /&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  After assigning the NgForm directive in any way, you can handle the send event via <code>(ngSubmit)</code> : <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> #</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">formDir</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ngForm"</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngSubmit</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit($event)"</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  <b><a href="http://plnkr.co/edit/eZ1QXKAixPWD0vPHaMax%3Fp%3Dpreview">A live example of a template form.</a></b> <br><br><h2>  Reactive forms </h2><br>  Reactive forms deserve their name for the fact that interaction with them is built on the paradigm of <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B5%25D0%25B0%25D0%25BA%25D1%2582%25D0%25B8%25D0%25B2%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">reactive programming</a> . <br><br>  The structural unit of the reactive form is the <i>control</i> - the model of the input field or a group of fields, the successor of the base class <a href="https://angular.io/docs/ts/latest/api/forms/index/AbstractControl-class.html">AbstractControl</a> .  The <i>control of</i> one input field ( <i>form control</i> ) is represented by the <a href="https://angular.io/docs/ts/latest/api/forms/index/FormControl-class.html">FormControl</a> class. <br><br>  Compose the values ‚Äã‚Äãof template form fields can only be in objects.  In the reactive we also have arrays - <a href="https://angular.io/docs/ts/latest/api/forms/index/FormArray-class.html">FormArray</a> .  Groups are represented by the <a href="https://angular.io/docs/ts/latest/api/forms/index/FormGroup-class.html">FormGroup</a> class.  Both arrays and groups have a controls property, in which the controls are organized into an appropriate data structure. <br><br>  Unlike the template form, to create and manage a reactive one, it is not necessary to represent it in a template, which makes it easy to cover such forms with unit tests. <br><br>  Controls are created either directly through the constructors, or using <a href="https://angular.io/docs/ts/latest/api/forms/index/FormBuilder-class.html">the FormBuilder tool</a> . <br><pre> <code class="hljs axapta">export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OurComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnInit</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">group</span></span>: FormGroup; nameControl: FormControl; constructor(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> formBuilder: FormBuilder) {} ngOnInit() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.nameControl = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FormControl(<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.formBuilder.<span class="hljs-keyword"><span class="hljs-keyword">group</span></span>({ name: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.nameControl, age: <span class="hljs-string"><span class="hljs-string">'25'</span></span>, address: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.formBuilder.<span class="hljs-keyword"><span class="hljs-keyword">group</span></span>({ country: <span class="hljs-string"><span class="hljs-string">''</span></span>, city: <span class="hljs-string"><span class="hljs-string">''</span></span> }), phones: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.formBuilder.array([ <span class="hljs-string"><span class="hljs-string">'1234567'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FormControl(<span class="hljs-string"><span class="hljs-string">'7654321'</span></span>) ]) }); } }</code> </pre> <br>  The this.formBuilder.group method accepts an object whose keys will become control names.  If the values ‚Äã‚Äãare not controls, they will become the values ‚Äã‚Äãof the new form controls, which makes it easy to create groups via FormBuilder.  If they are, they will simply be added to the group.  Array elements in this.formBuilder.array method are handled in the same way. <br><br>  To link the control and the input field in the template, you need to pass a link to the control to the directives formGroup, formArray, formControl.  These directives have ‚Äúbrothers‚Äù who just need to pass a string with the name of the control: formGroupName, formArrayName, formControlName. <br><br>  To use reactive form directives, you must connect the ReactiveFormsModule module.  By the way, it does not conflict with FormsModule, and directives from them can be applied together. <br><br>  The root directive (in this case, the formGroup) should definitely get a link to the control.  For nested controls or even groups, we have the opportunity to get by with the names: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">formGroup</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"personForm"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">formControl</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nameControl"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">formControlName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"age"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">formGroupName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"address"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">formControlName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"country"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">formControlName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"city"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The structure of the form in the pattern is not necessary to repeat.  For example, if an input field is associated with control through a formControl directive, it does not need to be inside an element with a formGroup directive. <br><br>  The formGroup directive handles submit and sends out <code>(ngSubmit)</code> in the same way as ngForm: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">formGroup</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"group"</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngSubmit</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit($event)"</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Interaction with arrays in a template is a little different than with groups.  To display an array, we need to get for each form control either its name or a link.  The number of elements in the array can be any, so you have to <code>*ngFor</code> over it with the <code>*ngFor</code> directive.  We write a getter to get an array: <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phonesArrayControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>): FormArray</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &lt;FormArray&gt;<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">group</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'phones'</span></span>); }</code> </pre> <br>  Now we will display the fields: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"let control of phonesArrayControl.controls"</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">formControl</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"control"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  For an array of fields, the user sometimes requires add and delete operations.  FormArray has corresponding methods, from which we will use deletion by index and insertion into the end of the array.  The corresponding buttons and methods for them can be seen in a live example. <br><br>  Changing the form value is an <a href="http://reactivex.io/documentation/observable.html">Observable</a> to which you can subscribe: <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">group</span></span>.valueChanges.subscribe(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> =&gt; { console.log(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); });</code> </pre> <br>  Each type of control has methods for interacting with it, both inherited from the AbstractControl class and unique.  More information can be found in the descriptions of the respective classes. <br><br>  <b><a href="http://plnkr.co/edit/Bg3MQFqDKJ9NACqXfqU8%3Fp%3Dpreview">Living example of reactive form</a></b> <br><br><h2>  Independent input fields </h2><br>  The input field does not have to be linked to the form.  We can interact with one field in much the same way as with the whole form. <br><br>  For the already created reactive form control, everything is completely simple.  Template: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">formControl</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nameControl"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  In the code of our component, you can subscribe to its changes: <br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.nameControl.valueChanges.subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(value); });</code> </pre> <br>  The template form input field is also independent: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> [(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngModel</span></span></span><span class="hljs-tag">)]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  In reactive forms, you can do this: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">formControl</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nameControl"</span></span></span><span class="hljs-tag"> [(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngModel</span></span></span><span class="hljs-tag">)]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  Everything related to ngModel <a href="">will be processed by the formControl directive</a> , and the ngModel directive will not be used: the input field with the formControl attribute does <a href="">not fall under the last selector</a> . <br><br>  <b><a href="http://plnkr.co/edit/p4JCbkXbUUi0aVNVBa1s%3Fp%3Dpreview">Living example of interaction with independent fields.</a></b> <br><br><h2>  Reactive nature of all forms </h2><br>  Template forms are not a completely separate entity.  When creating any template form <a href="">, a reactive one is actually created</a> .  In the live example of the template form, there is an operation with an instance of the NgForm directive.  We assign it to the local variable of the formDir template and access the value property to get the value.  In the same way, we can get the group that the NgForm directive creates. <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> #</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">formDir</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ngForm"</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngSubmit</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit($event)"</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pre</span></span></span><span class="hljs-tag">&gt;</span></span>{{formDir.form.value | json}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pre</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The form property is an instance of the FormGroup class.  Instances of the same class are created when the NgModelGroup directive is assigned.  The NgModel directive <a href="">creates a FormControl</a> . <br><br>  Thus, all directives assigned to input fields, both ‚Äútemplate‚Äù and ‚Äúreactive‚Äù, serve as an auxiliary mechanism for interacting with the main entities of the forms in Angular - controls. <br><br>  When creating a reactive form, we create the controls ourselves.  If we work with a template form, directives assume this work.  We can get access to the controls, but this way of interacting with them is not the most convenient.  In addition, a template-based, template-based approach does not give complete control over the model: if we take control of the model structure, conflicts will arise.  Nevertheless, it is possible to receive data from controls if necessary, and this is in the living example. <br><br>  Reactive form allows you to create a more complex data structure than the template, provides more ways to interact with it.  Also, reactive forms can be easier and more fully covered with unit tests than template ones.  Our team decided to use only reactive forms. <br><br>  <b><a href="http://plnkr.co/edit/gYVtStKNU0SacCBjY61T%3Fp%3Dpreview">A living example of a reactive nature of patterned form.</a></b> <br><br><h1>  Form Interaction with Fields </h1><br>  Angular has a set of directives that work with most standard (browser) input fields.  They are assigned invisibly to the developer, and it is thanks to them that we can immediately associate any element of input with the model. <br><br>  When the possibilities of the required input field go beyond the standard, or the logic of its work requires reuse, we can create a custom input field. <br><br>  First we need to get acquainted with the features of the interaction of the input field and control. <br><br>  The controls, as mentioned above, are mapped to each input field explicitly or implicitly.  Each control interacts with its field through its ControlValueAccessor interface. <br><br><h2>  ControlValueAccessor </h2><br>  <a href="">ControlValueAccessor</a> (in this text I will call it simply an <i>accessor</i> ) is an interface that describes the interaction of a field component with a control.  At initialization, each input field directive (ngModel, formControl or formControlName) gets all <i>registered</i> accessors.  There can be several of them on one input field - custom and embedded in Angular.  The user accessor has priority over the built-in ones, but there can only be one. <br><br>  To register an accessor, <a href="https://angular.io/docs/ts/latest/guide/dependency-injection.html">a</a> multiplayer <a href="https://angular.io/docs/ts/latest/guide/dependency-injection.html">with the</a> NG_VALUE_ACCESSOR <a href="https://angular.io/docs/ts/latest/guide/dependency-injection.html">token is</a> used.  It should be added to the list of providers of our component: <br><pre> <code class="hljs coffeescript">@Component({ ... providers: [ ... { provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> CustomInputField), multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ] }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomInputField</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControlValueAccessor</span></span></span><span class="hljs-class"> { ... }</span></span></code> </pre> <br>  In the component, we <i>must</i> implement the registerOnChange, registerOnTouched, and writeValue methods, and <i>we can</i> also implement the setDisabledState method. <br><br>  The registerOnChange, registerOnTouched methods register callbacks used to send data from the input field to the control.  Callbacks themselves come to the methods as arguments.  In order not to lose them, references to callbacks are recorded in class properties.  The initialization of the control can occur later than the creation of the input field, so you need to pre-write dummy functions in the properties.  The registerOnChange and registerOnTouched methods when calling should overwrite them: <br><pre> <code class="hljs javascript">onChange = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value: any</span></span></span><span class="hljs-function">) =&gt;</span></span> {}; onTouched = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {}; registerOnChange(callback: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">change: any</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onChange = callback; } registerOnTouched(callback: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onTouched = callback; }</code> </pre> <br>  The onChange function sends a new value to the control when it is called.  The onTouched function is called when the input field loses focus. <br><br>  The writeValue method is called by the control each time its value changes.  The main task of the method is to display the changes in the field.  Note that the value can be null or undefined.  If there is a native field tag inside the template, <a href="https://angular.io/docs/ts/latest/api/core/index/Renderer-class.html">Renderer is</a> used for this (in Angular 4+ - <a href="https://angular.io/docs/ts/latest/api/core/index/Renderer2-class.html">Renderer2</a> ): <br><pre> <code class="hljs cs">writeValue(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: any) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> normalizedValue = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? <span class="hljs-string"><span class="hljs-string">''</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._renderer.setElementProperty(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._elementRef.nativeElement, <span class="hljs-string"><span class="hljs-string">'value'</span></span>, normalizedValue); }</code> </pre> <br>  The setDisabledState method is called by the control each time the disabled state changes, so it should also be implemented. <br><pre> <code class="hljs kotlin">setDisabledState(isDisabled: boolean) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._renderer.setElementProperty(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._elementRef.nativeElement, <span class="hljs-string"><span class="hljs-string">'disabled'</span></span>, isDisabled); }</code> </pre> <br>  It is called only by the reactive form: in template forms for ordinary input fields, the binding is <code>disabled</code> .  Therefore, if our component will be used in a template form, we need to additionally handle the disabled attribute. <br><br>  Thus, work with the input field in the <a href="">DefaultValueAccessor</a> directive is applied, which applies to any, including ordinary, text input fields.  If you want to make a component that works with a native input field within itself, this is the minimum necessary. <br><br>  In the live example, I created the simplest implementation of a rating input component without a built-in native input field: <br><img src="https://habrastorage.org/files/912/6b7/d5e/9126b7d5e29943ecab4ee0b17a1e4b06.png"><br><br>  I will note a few points.  The component template consists of one repeated tag: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"star"</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"let value of values"</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class.star_active</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"value &lt;= currentRate"</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"setRate(value)"</span></span></span><span class="hljs-tag">&gt;</span></span>‚òÖ<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The values ‚Äã‚Äãarray is needed for the correct operation of the <code>*ngFor</code> directive and is formed depending on the <code>maxRate</code> parameter (by default - 5). <br><br>  Since the component does not have an internal input field, the value is simply stored in the class property: <br><pre> <code class="hljs kotlin">setRate(rate: number) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.disabled) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentRate = rate; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onChange(rate); } } writeValue(newValue: number) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentRate = newValue; }</code> </pre> <br><br>  The disabled state can be assigned in both template and reactive form: <br><pre> <code class="hljs java"><span class="hljs-meta"><span class="hljs-meta">@Input</span></span>() disabled: <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ... setDisabledState(disabled: boolean) { this.disabled = disabled; }</span></span></code> </pre> <br><br>  <b><a href="http://plnkr.co/edit/JlOovWDnnINYwQ1edmFR%3Fp%3Dpreview">A live example of a custom input field.</a></b> <br><br><h1>  Conclusion </h1><br>  In the next article we will take a closer look at the statuses and validation of forms and fields, including custom ones.  If you have questions about creating custom input fields, you can write in the comments or in person to my Telegram <a href="https://t.me/tmsy0">@ tmsy0</a> . </div><p>Source: <a href="https://habr.com/ru/post/323270/">https://habr.com/ru/post/323270/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323258/index.html">Motion Detection in FPGA Video Stream</a></li>
<li><a href="../323260/index.html">Women's Day Gift by FPGA</a></li>
<li><a href="../323262/index.html">Implementing HQoS on Juniper MX80 / MX104 fixed ports</a></li>
<li><a href="../323266/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ252 (March 27 - 5, 2017)</a></li>
<li><a href="../323268/index.html">8 best extensions for WordPress to improve the menu on your site</a></li>
<li><a href="../323272/index.html">Deep Learning Libraries Theano / Lasagne</a></li>
<li><a href="../323276/index.html">Discipline, Accuracy, Attention to Detail</a></li>
<li><a href="../323278/index.html">Visual Studio 2017 Launch Live Webcast</a></li>
<li><a href="../323280/index.html">The work of the writer in video games</a></li>
<li><a href="../323284/index.html">Release of 3CX V15 SP5 and client updates for macOS and iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>