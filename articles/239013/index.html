<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Caesar III: game loop</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If I were asked what part of the technical implementation of the Caesar game is more interesting to me than others, I would remember about the calcula...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Caesar III: game loop</h1><div class="post__text post__text-html js-mediator-article">  If I were asked what part of the technical implementation of the Caesar game is more interesting to me than others, I would remember about the calculation of one ‚Äúday‚Äù of city life.  Separate components of the mathematical model of the city are also interesting in implementation, but these ‚Äúgears‚Äù will spin only as an assembly.  Most of the game takes place inside the "game cycle", in which calculations of the parameters of components are carried out, movements of game objects are performed, new events and objects are created.  If you are interested to know how the simulation of the city was arranged in one of the best games of 1998 - welcome under cat.  The descriptions, pseudocode and schematics will help you to better know the algorithms used <br><br><img src="https://habrastorage.org/files/1d4/e42/858/1d4e4285872b4171bb9679b453ae74a6.jpg"><br><a name="habracut"></a><br>  The authors of the game split the steps of one ‚Äúday‚Äù in the city into several steps, the main of which are given below, the simplified code of the function itself can be found under the spoiler: <br><br><img width="800" src="https://habrastorage.org/files/810/6da/b03/8106dab036a74f7e9a773d44c02fe9c2.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Every 50 ticks starts a new day (16 days in the game month), for which several more functions are calculated that do not require such frequent processing, namely: <br><br><ul><li>  on the first and eighth days of the month, the citizens' happiness level and the crime rate in the city are calculated; </li><li>  when changing the month, the festival is checked for the possibility of holding the festival, paying taxes, salaries, calculating the probability of random events and much more; </li><li>  when the year is changed, the parameters of the past year are saved and the ratings are updated. </li></ul><br><br><div class="spoiler">  <b class="spoiler_title">Stages of city parameters calculation</b> <div class="spoiler_text">  1. Calculation of mood: <br>  - gods <br>  - Aboriginal <br>  2. Update the parameters of the invasion of Caesar's troops <br>  3. Calculation of the movement of groups of objects <br>  4. Collection of information on barns <br>  5. Updating data on affordable services for homes <br>  6. Updating warehouse parameters <br>  7. Updating the data of the adviser on population and supply of wheat from Rome <br>  8. Updating the consumption of goods in workshops and materials in mining enterprises <br>  9. Updating the ways to the docks <br>  10. Calculation of production of goods in the workshops <br>  11. Calculation of the availability of the road to Rome <br>  12. Renewal of the population of houses <br>  13. Calculation of the appearance of homeless from overcrowded houses <br>  14. The calculation of the distribution of workers in enterprises, the counting of the unemployed, working enterprises <br>  15. Updating the coverage of fountains and tanks <br>  16. Upgrading access to water for homes <br>  17. Updating the status of groups of objects <br>  18. Calculation of the appearance of citizens from serving buildings <br>  19. Calculation of the appearance of merchants <br>  20. Counting the types and number of buildings in the city, counting the coverage of cultural objects <br>  21. Calculation of the distribution of the treasury of the city between the Senate and the forums <br>  22. The calculation of the decrease of the parameters of culture in homes <br>  23. Calculation of the decrease of services in homes <br>  24. Calculation of the influence of buildings on the desirability of land <br>  25. Upgrading House Levels <br>  26. Deletion of buildings marked for demolition <br>  27. Updating the parameters of burning ruins <br>  28. Updating the status of buildings around fires. <br>  29. Creation of protesting residents <br>  30. Calculation of tax collection parameters <br>  31. Updating the level of entertainment in homes <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Stages of city parameters calculation (code)</b> <div class="spoiler_text"><br><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gameLoop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( game.run ) { gametime.ticks++; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ( gametime.ticks ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: calculateGodHappiness(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: changeBackgroundMusic(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: minimap_redraw = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: tick_updateCaesarInvasion(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>: tick_updateFormations(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>: tick_checkNativeLand(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>: determineRoadNetworkIds(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>: gatherGranaryStorageInfo(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span>: ??? <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>: updateHighestInUseBuildingId(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>: ??? <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>: buildingDecayHousesCovered(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>: tick_resource_recalculateStock(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>: updateAdvisorFoodAndSupplyRomeWheat(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>: tick_updateCityInfoWorkshopRawMaterialsStored(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span>: docksDetermineWaterAccess(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>: tick_updateIndustryProduction(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>: tick_checkPathingAccessToRome(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span>: updatePopulationInHouses(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span>: population(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>: evictPeopleFromOvercrowdedHouses(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span>: calculateWorkersNeededPerCategory(); calculateUnemployment(); setBuildingWorkerPercentage(); setBuildingNumWorkersWater(); setBuildingNumWorkers(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span>: recalculateReservoirAndFountainAccess(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span>: gametick_updateHouseWaterAccess(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span>: updateFormations(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span>: minimap_redraw = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span>: generateWalkersForBuildings(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span>: generateTraders(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span>: countBuildingTypes(); calculateCultureCoverage(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">34</span></span>: distributeTreasuryOverForumsAndSenates(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span>: decayService_culture(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span>: determineHousingServicesForEvolve(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span>: calculateDesirabilityOfBuildings(); calculateDesirabilityOfTerrain(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span>: calculateBuildingDesirability(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span>: evolveDevolveHouses(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span>: clearDeletedBuildings(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">43</span></span>: updateBurningRuin(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">44</span></span>: updateCrimeFireDamage(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span>: generateCriminal(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">46</span></span>: updateDoubleWheatProduction(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">47</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span>: decayService_taxCollector(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span>: gatherEntertainmentInfo(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( gametime.ticks &gt;= <span class="hljs-number"><span class="hljs-number">50</span></span> ) { gametime.ticks = <span class="hljs-number"><span class="hljs-number">0</span></span>; doGameDayTick(); } renderCity(); } }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">The advent of the new day</b> <div class="spoiler_text"><br><pre> <code class="hljs vbscript">void doGameDayTick() { ++gametime.totalDays; ++gametime.<span class="hljs-built_in"><span class="hljs-built_in">day</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( gametime_day &gt; <span class="hljs-number"><span class="hljs-number">15</span></span> ) { gametime.<span class="hljs-built_in"><span class="hljs-built_in">day</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; cityinfo.newcomersThisMonth = <span class="hljs-number"><span class="hljs-number">0</span></span>; ++cityinfo.monthsSinceFestival; monthHandle(); ++gametime.<span class="hljs-built_in"><span class="hljs-built_in">month</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( gametime_month &lt;= <span class="hljs-number"><span class="hljs-number">11</span></span> ) { updateRatings(<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { startNewYear(); } recordMonthlyPopulation(); holdFestival(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !gametime.<span class="hljs-built_in"><span class="hljs-built_in">day</span></span> || gametime.<span class="hljs-built_in"><span class="hljs-built_in">day</span></span> == <span class="hljs-number"><span class="hljs-number">8</span></span> ) calculateCityHappinessAndCrime(); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">New month coming</b> <div class="spoiler_text"><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">monthHandle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { calculateHealthRate(); handleRandomEvents(); collectMonthlyTaxes(); payMonthlyWages(); payMonthlyInterest(); payMonthlySalary(); housesConsumeMonthlyFood(); handleDistantBattleEvent(); handleInvasionEvent(); checkRequestsEvent(); checkDemandChangesEvent(); checkPriceChangesEvent(); decreaseMonthsLeftToGovernAfterWin(); tickMonth_updateLegionMorale(); playerMessages_updateMessageDelay(); determineGraphicIdsForRoads(); determineGraphicIdsForWater(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, setting_map_width - <span class="hljs-number"><span class="hljs-number">1</span></span>, setting_map_height - <span class="hljs-number"><span class="hljs-number">1</span></span>); calculateOpenGroundCitizen(); sortAndCompactPlayerMessages(); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">The coming of the new year</b> <div class="spoiler_text"><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startNewYear</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { gametime.month = <span class="hljs-number"><span class="hljs-number">0</span></span>; handleExpandEmpireEvent(); ++gametime.year; gametick_requestBirthsDeaths_calculateHousingTypes(); copyFinanceTaxesToLastYear(); copyFinanceWagesToLastYear(); copyFinanceImportExportToLastYear(); copyFinanceConstructionToLastYear(); copyFinanceInterestToLastYear(); copyFinanceSalaryToLastYear(); copyFinanceSundriesToLastYear(); calculateAndPayTribute(); resetTradeAmounts(); tick_updateFireSpreadDirection(); updateRatings(<span class="hljs-number"><span class="hljs-number">1</span></span>); cityinfo.blessingNeptuneDoubleTradeActive = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br></div></div><br><br><h2>  Religion </h2><br><img width="300" src="https://habrastorage.org/getpro/habr/post_images/fb7/e81/576/fb7e81576b00967bce347e1688f33edf.jpg"><br><br>  At first the Romans were pagans, worshiped by Greek and to a lesser extent Etruscan gods.  Later, the mythological period was replaced by a passion for pagan cults.  The state, taking on the organization and conduct of rituals, created the official religion, which changed the previous ideas about the gods.  Religion in people's lives has always been of great importance, and computer models have not escaped human prejudices; element of chance when choosing a deity. <br><br><img width="800" src="https://habrastorage.org/getpro/habr/post_images/5bc/578/a5f/5bc578a5f1253d008a3a6a3b5020b494.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Calculation of the mood of the gods and the conditions of anger</b> <div class="spoiler_text"><pre> <code class="hljs bash">void calculateGodHappiness(int includeBlessingsAndCurses) { maxTemples = 0; maxGod = 10; minTemples = 100000; minGod = 10; cityinfo.maxHappinessCeres = pctReligionCoverageCeres; cityinfo.maxHappinessNeptune = pctReligionCoverageNeptune; cityinfo.maxHappinessMercury = pctReligionCoverageMercury; cityinfo.maxHappinessMars = pctReligionCoverageMars; cityinfo.maxHappinessVenus = pctReligionCoverageVenus; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( i = 0; i &lt; 5; ++i ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( i ) { switch ( i ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> 1: numTemples = numLargeTemplesNeptune + numSmallTemplesNeptune; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> 2: numTemples = numLargeTemplesMercury + numSmallTemplesMercury; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> 3: numTemples = numLargeTemplesMars + numSmallTemplesMars; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> 4: numTemples = numLargeTemplesVenus + numSmallTemplesVenus; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { numTemples = numLargeTemplesCeres + numSmallTemplesCeres; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( numTemples &gt;= maxTemples ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( numTemples == maxTemples ) maxGod = 10; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> maxGod = i + 1; maxTemples = numTemples; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( numTemples &lt;= minTemples ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( numTemples == minTemples ) minGod = 10; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> minGod = i + 1; minTemples = numTemples; } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( j = 0; j &lt; 5; ++j ) { monthsGodSinceFestival = cityinfo.monthsGodSinceFestival[j]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( monthsGodSinceFestival &gt; 40 ) monthsGodSinceFestival = 40; cityinfo.maxGodHappiness[j] += 12; cityinfo.maxGodHappiness[j] -= monthsGodSinceFestival; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( maxGod ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( maxGod &lt; 5 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.monthsGodSinceFestival[maxGod + 3] &gt;= 50 ) cityinfo.monthsGodSinceFestival[maxGod + 3] = 100; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cityinfo.monthsGodSinceFestival[maxGod + 3] += 50; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( minGod ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( minGod &lt; 5 ) cityinfo.monthsGodSinceFestival[minGod + 3] -= 25; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.population &gt;= 100 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.population &gt;= 200 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.population &gt;= 300 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.population &gt;= 400 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.population &gt;= 500 ) min = 0; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> min = 10; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { min = 20; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { min = 30; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { min = 40; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { min = 50; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( k = 0; k &lt; 5; ++k ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( cityinfo.maxGodHappiness[k] &gt; 100 ) cityinfo.maxGodHappiness[k] = 100; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( cityinfo.maxHappinessCeres[k] &lt; min ) cityinfo.maxGodHappiness[k] = min; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( includeBlessingsAndCurses ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( l = 0; l &lt; 5; ++l ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.godHappiness[l] &lt;= cityinfo.maxGodHappiness[l] ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.godHappiness[l] &lt; cityinfo.maxGodHappiness[l] ) ++cityinfo.godHappiness[l]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { --cityinfo.godHappiness[l]; } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( m = 0; m &lt; 5; ++m ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( cityinfo.godHappiness[m] &gt; 50 ) cityinfo.godSmallCurseDone[m] = 0; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.godHappiness[m] &lt; 50 ) cityinfo.godBlessingDone[m] = 0; } god = random_7f_1 &amp; 7; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( god &lt;= 4 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.godHappiness[god] &lt; 50 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.godHappiness[god] &lt; 40 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.godHappiness[god] &lt; 20 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.godHappiness[god] &lt; 10 ) cityinfo.numBoltsGod[god] += 5; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cityinfo.numBoltsGod[god] += 2; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ++cityinfo.numBoltsGod[god]; } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { cityinfo.numBoltsGod[god] = 0; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.numBoltsGod[god] &gt;= 50 ) cityinfo.numBoltsGod[god] = 50; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !gametime.day ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( n = 0; n &lt; 5; ++n ) ++cityinfo.monthsGodSinceFestival[n]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( god &gt; 4 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( determineAngriestGod() ) god = cityinfo.religionAngryGod - 1; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( setting.godsOn ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( god &lt;= 4 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( cityinfo.godHappiness[god] &lt; 100 || cityinfo.godBlessingDone[god] ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.numBoltsGod[god] &lt; 20 || cityinfo.godSmallCurseDone[god] || cityinfo.monthsGodSinceFestival[god] &lt;= 3 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.numBoltsGod[god] &gt;= 50 &amp;&amp; cityinfo.monthsGodsSinceFestival[ god ] &gt; 3 ) { cityinfo.numBoltsGod[god] = 0; cityinfo.godHappiness[god] += 30; message.usePopup = 1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( god ) // large curse { switch ( god ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> God_Neptune: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.numOpenSeaTradeRoutes &lt;= 0 ) { postMessageToPlayer(42, 0, 0); <span class="hljs-built_in"><span class="hljs-built_in">return</span></span>; } postMessageToPlayer(81, 0, 0); neptuneSinkAllShips(); cityinfo.seaTradeProblemDuration = 80; cityinfo.godCurseNeptuneSankShips= 1; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> God_Mercury: postMessageToPlayer(43, 0, 0); removeGoodsFromStorageForMercury(1); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> God_Mars: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( largeCurseMarsCurseFort() ) { postMessageToPlayer(82, 0, 0); startLocalUprisingFromMars(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { postMessageToPlayer(44, 0, 0); } <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> God_Venus: postMessageToPlayer(45, 0, 0); setCrimeRiskForAllHouses(40); increaseSentiment(-10); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( cityinfo.healthRate &lt; 80 ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.healthRate &lt; 60 ) changeHealthRate(-20); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> changeHealthRate(-40); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { changeHealthRate(-50); } cityinfo.godCurseVenusActive = 1; alculateCityHappinessAndCrime(); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { postMessageToPlayer(41, 0, 0); ceresWitherCrops(1); } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { // small curse cityinfo.godSmallCurseDone[ god] = 1; cityinfo.numBoltsCeres[god] = 0; cityinfo.godHappiness[god] += 12; message.usePopup = 1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( god ) { switch ( god ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> God_Neptune: postMessageToPlayer(92, 0, 0); neptuneSinkAllShips(); cityinfo.godCurseNeptuneSankShips = 1; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> God_Mercury: postMessageToPlayer(93, 0, 0); removeGoodsFromStorageForMercury(0); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> God_Mars: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( startLocalUprisingFromMars() ) postMessageToPlayer(94, 0, 0); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> postMessageToPlayer(44, 0, 0); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> God_Venus: postMessageToPlayer(95, 0, 0); setCrimeRiskForAllHouses(50); increaseSentiment(-5); hangeHealthRate(-10); calculateCityHappinessAndCrime(); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { postMessageToPlayer(91, 0, 0); ceresWitherCrops(0); } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { cityinfo.godBlessingDone[god] = 1; message_usePopup = 1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( god ) { switch ( god ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> God_Neptune: postMessageToPlayer(97, 0, 0); cityinfo.blessingNeptuneDoubleTradeActive = 1; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> God_Mercury: postMessageToPlayer(98, 0, 0); smallBlessingMercuryFillGranary(); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> God_Mars: postMessageToPlayer(99, 0, 0); cityinfo_blessingMarsEnemiesToKill = 10; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> God_Venus: postMessageToPlayer(100, 0, 0); increaseSentiment(25); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> // ceres { postMessageToPlayer(96, 0, 0); ceresBlessing(); } } } minHappiness = 100; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( ii = 0; ii &lt; 5; ++ii ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.godHappiness[ii] &lt; minHappiness ) minHappiness = cityinfo.godHappiness[ii]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.godAngryMessageDelay ) { --cityinfo_godAngryMessageDelay; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( minHappiness &lt; 30 ) { cityinfo.godAngryMessageDelay = 20; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( minHappiness &gt;= 10 ) postMessageToPlayer(55, 0, 0); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> postMessageToPlayer(101, 0, 0); } } } } } }</code> </pre><br></div></div><br><br><h2>  Moods in the city </h2><br><img width="700" src="https://habrastorage.org/files/937/112/0f5/9371120f538748e8bd4b01b9e5a1866c.png"><br><br>  Residents themselves respond to the wage differences between the city and Rome, the variety of products in the city, the level of taxes and the number of slums.  This parameter is stored for each house and does not change regardless of the neighboring houses. <br><br><img width="600" src="https://habrastorage.org/files/b4f/5c3/692/b4f5c3692af1472f97a0e6ba3668e23d.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">Calculation of mood and degree of migration in the city</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> calculateCityHappinessAndCrime() { totalPop = calculatePeopleInHousingTypes(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( totalPop &lt; cityinfo.population ) removePeopleFromCensus(ciid, cityinfo.population - totalPop); sentimentContributionTents = <span class="hljs-number"><span class="hljs-number">0</span></span>; sentimentContributionFood = <span class="hljs-number"><span class="hljs-number">0</span></span>; sentimentContributionWages = <span class="hljs-number"><span class="hljs-number">0</span></span>; sentimentContributionTaxes = taxrate_happiness_factor[ cityinfo.taxpercentage ]; diffWage = cityinfo.wages - cityinfo.wagesRome; switch( diffWage ) { &gt;= <span class="hljs-number"><span class="hljs-number">7</span></span>: sentimentContributionWages = <span class="hljs-number"><span class="hljs-number">4</span></span>; &gt;= <span class="hljs-number"><span class="hljs-number">4</span></span>: sentimentContributionWages = <span class="hljs-number"><span class="hljs-number">3</span></span>; &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>: sentimentContributionWages = <span class="hljs-number"><span class="hljs-number">2</span></span>; == <span class="hljs-number"><span class="hljs-number">1</span></span>: sentimentContributionWages = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( diffWage &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { sentimentContributionWages = -diffWage / <span class="hljs-number"><span class="hljs-number">2</span></span>; } switch( cityinfo.unemploymentPercentage ) { &gt; <span class="hljs-number"><span class="hljs-number">25</span></span>: sentimentContributionEmployment = <span class="hljs-number"><span class="hljs-number">-3</span></span>; &gt; <span class="hljs-number"><span class="hljs-number">17</span></span>: sentimentContributionEmployment = <span class="hljs-number"><span class="hljs-number">-2</span></span>; &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>: sentimentContributionEmployment = <span class="hljs-number"><span class="hljs-number">-1</span></span>; &lt; <span class="hljs-number"><span class="hljs-number">5</span></span>: sentimentContributionEmployment = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( cityinfo.populationSentiment_includeTents &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { tentPenaltyIfLessTents = getHappinessPenaltyForTentDwellers(); cityinfo.populationSentiment_includeTents = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { tentPenaltyIfLessTents = <span class="hljs-number"><span class="hljs-number">0</span></span>; cityinfo.populationSentiment_includeTents = <span class="hljs-number"><span class="hljs-number">1</span></span>; } housesNeedingFood = <span class="hljs-number"><span class="hljs-number">0</span></span>; housesCalculated = <span class="hljs-number"><span class="hljs-number">0</span></span>; totalSentimentContributionFood = <span class="hljs-number"><span class="hljs-number">0</span></span>; totalTentPenalty = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( building <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> city.buildings ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( building.inUse == <span class="hljs-number"><span class="hljs-number">1</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( building.houseSize ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( building.house_population ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.population &gt;= <span class="hljs-number"><span class="hljs-number">300</span></span> ) { building.house_happiness += sentimentContributionTaxes; building.house_happiness += sentimentContributionWages; building.house_happiness += sentimentContributionEmployment; ++housesCalculated; sentimentContributionFood = <span class="hljs-number"><span class="hljs-number">0</span></span>; sentimentContributionTents = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( model.houses_foodtypes[ building.<span class="hljs-keyword"><span class="hljs-keyword">level</span></span> ] &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) // needs food: &gt;= shack { ++housesNeedingFood; sentimentContributionFood = building.houseNumFoods - building.houseHaveFoods; ++totalSentimentContributionFood; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> // tent dwellers { sentimentContributionTents = tentPenaltyIfLessTents; totalTentPenalty += tentPenaltyIfLessTents; } building.house_happiness += sentimentContributionFood; building.house_happiness += sentimentContributionTents; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { sentimentContributionFood = <span class="hljs-number"><span class="hljs-number">0</span></span>; sentimentContributionEmployment = <span class="hljs-number"><span class="hljs-number">0</span></span>; sentimentContributionTaxes = <span class="hljs-number"><span class="hljs-number">0</span></span>; sentimentContributionWages = <span class="hljs-number"><span class="hljs-number">0</span></span>; sentimentContributionTents = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.population &gt;= <span class="hljs-number"><span class="hljs-number">200</span></span> ) building.house_happiness = <span class="hljs-number"><span class="hljs-number">50</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> building.house_happiness = <span class="hljs-number"><span class="hljs-number">60</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { building.house_happiness = <span class="hljs-number"><span class="hljs-number">60</span></span>; } } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( housesNeedingFood ) sentimentContributionFood = totalSentimentContributionFood / housesNeedingFood; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( housesCalculated ) sentimentContributionTents = totalTentPenalty / housesCalculated; totalHappiness = <span class="hljs-number"><span class="hljs-number">0</span></span>; totalHouses = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( building <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> city.buildings ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( building.inUse == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; building.houseSize &amp;&amp; building.house_population ) { ++totalHouses; totalHappiness += building.happiness; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( totalHouses &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) cityinfo.citySentiment = totalHappiness / totalHouses; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cityinfo.citySentiment = <span class="hljs-number"><span class="hljs-number">60</span></span>; cityinfo.emigrationCause = <span class="hljs-number"><span class="hljs-number">0</span></span>; worstSentiment = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( sentimentContributionFood &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { worstSentiment = sentimentContributionFood; cityinfo.emigrationCause = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( sentimentContributionEmployment &lt; worstSentiment ) { worstSentiment = sentimentContributionEmployment; cityinfo.emigrationCause = <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( sentimentContributionTaxes &lt; worstSentiment ) { worstSentiment = sentimentContributionTaxes; cityinfo.emigrationCause = <span class="hljs-number"><span class="hljs-number">3</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( sentimentContributionWages &lt; worstSentiment ) { worstSentiment = sentimentContributionWages; cityinfo.emigrationCause = <span class="hljs-number"><span class="hljs-number">4</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( sentimentContributionTents &lt; worstSentiment ) cityinfo.emigrationCause = <span class="hljs-number"><span class="hljs-number">5</span></span>; cityinfo.citySentimentLastTime = cityinfo_citySentiment; }</code> </pre><br></div></div><br><br><h2>  Festivals </h2><br><br><img width="400" src="https://habrastorage.org/files/8dc/8a9/c8a/8dc8a9c8a8ed4a51935f3e86a2490cf4.jpg"><br><br>  A significant increase in the mood in the city gives only the first festival for the full 12 months, the second and subsequent only half.  This was done so that in a rich city it was not possible to cheer up only through festivals.  Preparation for the festival itself also takes some time, which imposes a limit on the number of festivals held during the year. <br><br><img width="700" src="https://habrastorage.org/files/b2f/593/7b1/b2f5937b1ee84554b6b513973196deb9.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">Calculation of the influence of the festival on the mood in the city</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">holdFestival</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { --cityinfo.monthsSinceFirstFestival; --cityinfo.monthsSinceSecondFestival; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.plannedFestival_size &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; --cityinfo.plannedFestival_monthsToGo; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( cityinfo.plannedFestival_monthsToGo &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.monthsSinceFirstFestival &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.monthsSinceSecondFestival &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ) { cityinfo.monthsSinceSecondFestival = <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ( cityinfo.plannedFestival_size ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> smallFestival: increaseSentiment(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> middleFestival: increaseSentiment(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> bigFestival: increaseSentiment(<span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { cityinfo.monthsSinceFirstFestival = <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ( cityinf._plannedFestival_size ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> smallFestival: increaseSentiment(<span class="hljs-number"><span class="hljs-number">7</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> middleFestival: increaseSentiment(<span class="hljs-number"><span class="hljs-number">9</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> bigFestival: increaseSentiment(<span class="hljs-number"><span class="hljs-number">12</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } cityinfo.monthsSinceFestival = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ( cityinfo.plannedFestival_size ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> smallFestival: postMessageToPlayer(<span class="hljs-number"><span class="hljs-number">38</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> middleFestival: postMessageToPlayer(<span class="hljs-number"><span class="hljs-number">39</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> bigFestival: postMessageToPlayer(<span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } cityinfo.plannedFestival_size = <span class="hljs-number"><span class="hljs-number">0</span></span>; cityinfo.plannedFestival_monthsToGo = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br></div></div><br><br><h2>  Paying tribute to the emperor </h2><br><br><img src="https://habrastorage.org/files/f26/d81/1c5/f26d811c569f4f86aa772d9c4d805828.jpeg"><br><br>  Payment of tribute to the emperor.  The amount of money that at the end of the year is required to pay from the treasury <br>  depends on the profit of the city and the number of people living.  The first factor means paying a quarter <br>  money received during the year, but no less than a certain amount, which depends on the current population.  If the city <br>  can not pay this money, the ruler pays a decrease in the favor of the emperor, and the past <br>  years of non-payment, so that dissatisfaction accumulates with prolonged non-payment of tribute. <br><br><img src="https://habrastorage.org/files/0f8/d9c/0c0/0f8d9c0c02fe4d80bed27d58be9cc2a2.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">Calculation of the imperial quarter for the last year</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateAndPayTribute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { cityinfo.finance_donated_lastyear = cityinfo.finance_donated_thisyear; cityinfo.finance_donated_thisyear = <span class="hljs-number"><span class="hljs-number">0</span></span>; cityinfo.tributeNotPaid = <span class="hljs-number"><span class="hljs-number">0</span></span>; income = cityinfo.finance_donated_lastyear + cityinfo.finance_taxes_lastyear + cityinfo.finance_exports_lastyear expenses = cityinfo.finance_sundries_lastyear + cityinfo.finance_salary_lastyear + cityinfo.finance_interest_lastyear + cityinfo.finance_construction_lastyear + cityinfo.finance_wages_lastyear + cityinfo.<span class="hljs-function"><span class="hljs-function">finance_imports_lastyear </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> cityinfo.treasury &gt; </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>( cityinfo.population ) { &gt; <span class="hljs-number"><span class="hljs-number">5000</span></span>: cityinfo.finance_tribute_lastyear = <span class="hljs-number"><span class="hljs-number">500</span></span>; &gt; <span class="hljs-number"><span class="hljs-number">3000</span></span>: cityinfo.finance_tribute_lastyear = <span class="hljs-number"><span class="hljs-number">400</span></span>; &gt; <span class="hljs-number"><span class="hljs-number">2000</span></span>: cityinfo.finance_tribute_lastyear = <span class="hljs-number"><span class="hljs-number">300</span></span>; &gt; <span class="hljs-number"><span class="hljs-number">1001</span></span>: cityinfo.finance_tribute_lastyear = <span class="hljs-number"><span class="hljs-number">225</span></span>; &gt; <span class="hljs-number"><span class="hljs-number">501</span></span>: cityinfo.finance_tribute_lastyear = <span class="hljs-number"><span class="hljs-number">150</span></span>; &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: cityinfo.finance_tribute_lastyear = <span class="hljs-number"><span class="hljs-number">50</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( income &gt; expenses ) { cityinfo.tributeNotPaidYears = <span class="hljs-number"><span class="hljs-number">0</span></span>; realTribute = adjustWithPercentage(income - expenses, <span class="hljs-number"><span class="hljs-number">25</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( realTribute &gt; cityinfo.finance_tribute_lastyear ) cityinfo.finance_tribute_lastyear = realTribute; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { cityinfo.tributeNotPaid = <span class="hljs-number"><span class="hljs-number">1</span></span>; ++cityinfo.tributeNotPaidYears; cityinfo.finance_tribute_lastyear = <span class="hljs-number"><span class="hljs-number">0</span></span>; } cityinfo.treasury -= cityinfo.finance_tribute_lastyear; expenses += cityinfo.finance_tribute_lastyear; calculateTributeThisYear(); cityinfo.finance_balance_lastyear = cityinfo.treasury; cityinfo.finance_totalIncome_lastyear = income; cityinfo.finance_totalExpenses_lastyear = expenses; }</code> </pre><br></div></div><br><br><h2>  Random events </h2><br><img src="https://habrastorage.org/files/8c1/1d1/342/8c11d134212a48d392509f9187444c44.png"><br><br>  Random events.  There are 7 random events available in the game, a set of flags that can be changed in the mission editor is responsible for their occurrence.  A random event occurs if the generator has thrown its type and it is allowed in the script.  The developers made the following types: a reduction / increase in wages in Rome, problems with the sale of sea or land, poisoning wells, the collapse of mines and flooding of quarries and clay pits.  An earthquake is set in the editor, it has time and a point of origin, it spreads randomly in four directions. <br><br><div class="spoiler">  <b class="spoiler_title">Random events</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRandomEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> = randomEvent.probability[random_7f_1]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( scn_event_raiseWages ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.wagesRome &lt; <span class="hljs-number"><span class="hljs-number">45</span></span> ) { cityinfo.wagesRome += (random_7f_2 &amp; <span class="hljs-number"><span class="hljs-number">3</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.wagesRome &gt; <span class="hljs-number"><span class="hljs-number">45</span></span> ) cityinfo.wagesRome = <span class="hljs-number"><span class="hljs-number">45</span></span>; message_usePopup = <span class="hljs-number"><span class="hljs-number">1</span></span>; postMessageToPlayer(<span class="hljs-number"><span class="hljs-number">68</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( scn_event_lowerWages ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.wagesRome &gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ) { cityinfo.wagesRome -= (random_7f_2 &amp; <span class="hljs-number"><span class="hljs-number">3</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>; message_usePopup = <span class="hljs-number"><span class="hljs-number">1</span></span>; postMessageToPlayer(<span class="hljs-number"><span class="hljs-number">69</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( scn_event_landTradeProblem ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.numOpenLandTradeRoutes &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { cityinfo.landTradeProblemDuration = <span class="hljs-number"><span class="hljs-number">48</span></span>; message_usePopup = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( scn_climate == Climate_Desert ) postMessageToPlayer(<span class="hljs-number"><span class="hljs-number">65</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> postMessageToPlayer(<span class="hljs-number"><span class="hljs-number">67</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( scn_event_seaTradeProblem ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.numOpenSeaTradeRoutes &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { cityinfo.seaTradeProblemDuration = <span class="hljs-number"><span class="hljs-number">48</span></span>; message_usePopup = <span class="hljs-number"><span class="hljs-number">1</span></span>; postMessageToPlayer(<span class="hljs-number"><span class="hljs-number">66</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( scn_event_contaminatedWater ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.population &gt; <span class="hljs-number"><span class="hljs-number">200</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.healthRate &lt;= <span class="hljs-number"><span class="hljs-number">80</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.healthRate &lt;= <span class="hljs-number"><span class="hljs-number">60</span></span> ) changeHealthRate(<span class="hljs-number"><span class="hljs-number">-25</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> changeHealthRate(<span class="hljs-number"><span class="hljs-number">-40</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { changeHealthRate(<span class="hljs-number"><span class="hljs-number">-50</span></span>); } message_usePopup = <span class="hljs-number"><span class="hljs-number">1</span></span>; postMessageToPlayer(<span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( scn_event_ironMineCollapse ) { gridOffsetIronmine = destroyFirstBuildingOfType(B_IronMine); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( gridOffsetIronmine ) { message_usePopup = <span class="hljs-number"><span class="hljs-number">1</span></span>; postMessageToPlayer(<span class="hljs-number"><span class="hljs-number">71</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, gridOffsetIronmine); } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( scn_event_clayPitFlooded ) { gridOffsetClaypit = destroyFirstBuildingOfType(B_ClayPit); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( gridOffsetClaypit ) { message_usePopup = <span class="hljs-number"><span class="hljs-number">1</span></span>; postMessageToPlayer(<span class="hljs-number"><span class="hljs-number">72</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, gridOffsetClaypit); } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } }</code> </pre><br></div></div><br><br><h2>  Public health </h2><br><img width="400" src="https://habrastorage.org/files/a7c/0a0/426/a7c0a0426f344890aa90cc839e000f48.jpg"><img width="400" src="https://habrastorage.org/files/240/36d/927/24036d9279c246a286f10a91b590dcb7.jpg"><br><br>  Practicing doctors appeared relatively late in Rome.  Up to the II c.  BC  Oe., and in the low-income strata of society and much later the Romans were treated by the wise with the life experience of their relatives by simple means that were passed down from generation to generation.  This traditional medicine was not alien to primitive magic.  Agriculture guidelines were compiled, with a number of instructions on how to treat people and animals, clearly following folk remedies. <br>  In the game, clinics and hospitals provide the same services, but hospitals are also needed for high-level homes for continued growth.  The health of the inhabitants is one of the main indicators of the prosperity of the city: epidemics can mow entire neighborhoods, and with an increase in the city‚Äôs population, the number of people who died during the epidemic will only grow. <br><br><img width="750" src="https://habrastorage.org/files/f4e/10e/c20/f4e10ec206464309a4cb656314499026.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">Calculation of health and the probability of an epidemic in the city</b> <div class="spoiler_text"><pre> <code class="hljs kotlin">void calculateHealthRate() { population = <span class="hljs-number"><span class="hljs-number">0</span></span>; populationWithDoctors = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.population &lt; <span class="hljs-number"><span class="hljs-number">200</span></span> ) { cityinfo.healthRate = <span class="hljs-number"><span class="hljs-number">50</span></span>; cityinfo.calculatedTargetHealthRate = <span class="hljs-number"><span class="hljs-number">50</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( building <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> city.buildings ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( building.inUse == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; building.houseSize &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; building.house_population &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { population += building.house_population; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( building.hasClinicService ) populationWithDoctors += building.house_population; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> populationWithDoctors += building.house_population / <span class="hljs-number"><span class="hljs-number">4</span></span>; } } cityinfo.calculatedTargetHealthRate = getPercentage(populationWithDoctors, population); cityinfo.healthRate += sign( cityinfo.healthRate - cityinfo.calculatedTargetHealthRate ) * <span class="hljs-number"><span class="hljs-number">2</span></span>; cityinfo.healthRate = bound( <span class="hljs-number"><span class="hljs-number">0</span></span>, cityinfo.healthRate, <span class="hljs-number"><span class="hljs-number">100</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.healthRate &gt;= <span class="hljs-number"><span class="hljs-number">40</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; pandemicChance = <span class="hljs-number"><span class="hljs-number">40</span></span> - cityinfo.healthRate; goodHealthPeople = random_7f_1 &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.godCurseVenusActive ) goodHealthPeople = <span class="hljs-number"><span class="hljs-number">0</span></span>; cityinfo.godCurseVenusActive = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( goodHealthPeople &gt; pandemicChance ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; howPeopleCanDie = adjustWithPercentage(populationWithDoctors, (random_7f_1 &amp; <span class="hljs-number"><span class="hljs-number">3</span></span>) + <span class="hljs-number"><span class="hljs-number">7</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( howPeopleCanDie &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { howPeopleCanDie = howPeopleCanDie - cityinfo.numHospitalWorkers; changeHealthRate(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( howPeopleCanDie &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.numHospitalWorkers &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) postMessageToPlayer(<span class="hljs-number"><span class="hljs-number">103</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> postMessageToPlayer(<span class="hljs-number"><span class="hljs-number">104</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( building <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> city.buildings ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( building.inUse == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; building.houseSize &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; building.house_population &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; !building.hasClinicService ) { howPeopleCanDie -= building.house_population; collapseBuildingOnFire(j, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( howPeopleCanDie &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { postMessageToPlayer(<span class="hljs-number"><span class="hljs-number">102</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } }</code> </pre><br></div></div><br><br><h2>  Tax collection </h2><br><br><img src="https://habrastorage.org/files/c19/9d4/7d0/c199d47d0cca4759a8dd91d6a46b51bb.jpg"><br><br>  At first, the city lives at the expense of incoming taxes, although they are quite modest.  The tax collector, as well as, for example, a doctor from the clinic, should pass near residential buildings at regular intervals.  If the apartment house is visited without fail by tax collectors, it will pay tax every month. <br><br>  How much a house will pay per month depends on: <br><br>  - interest rate set by the financial adviser (regulated from 0 to 25%); <br>  - the number of people living in the house at the time of tax collection (i.e., when the month changes); <br>  - the level of development of the house (in the game file ‚Äúc3_model.txt‚Äù, data on residential buildings, the 20th column - this number is a 200 percent tax per month per person living in this level of development of a residential building). <br><br>  After analyzing the function, we can conclude that a smooth increase in taxes is no different from a quick change.  Taxes affect the mood of your people, but it makes no sense to raise the wages of their workers by more than 8 units, in relation to the wages that Rome pays. <br><br>  What is a 200 percent tax is (probably) the desire of developers to save on a reduction operation to a smaller whole, in this block: <br><br><pre> <code class="hljs lisp"> collectedPatricians = adjustWithPercentage( <span class="hljs-name"><span class="hljs-name">cityinfo</span></span>.monthlyCollectedTaxFromPatricians / <span class="hljs-number"><span class="hljs-number">2</span></span>, cityinfo.taxpercentage )<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><br>  the code shows that the collected taxes are divided by 2. In order not to get a situation where the house can pay more than the tax was imposed * 2, and in the calculations we will always get a value less than or equal to the correct one. <br><br>  At higher levels of the city‚Äôs development, it can only live on taxes: <br><br><img width="400" src="https://habrastorage.org/files/171/ec8/4ad/171ec84ad63e414c926d43e432e5b54e.jpg"><img width="400" src="https://habrastorage.org/files/803/995/20b/80399520bebc49138cfe2aa52ca6563e.jpg"><br><br><img src="https://habrastorage.org/files/af2/5e9/9f4/af25e99f422243d8942685286a51e93c.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">Calculation of taxes received during the month</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> __cdecl fun_collectMonthlyTaxes() { cityinfo.numPlebsTaxed = <span class="hljs-number"><span class="hljs-number">0</span></span>; cityinfo.numPatriciansTaxed = <span class="hljs-number"><span class="hljs-number">0</span></span>; cityinfo.numPlebsNotTaxed = <span class="hljs-number"><span class="hljs-number">0</span></span>; cityinfo.numPatriciansNotTaxed = <span class="hljs-number"><span class="hljs-number">0</span></span>; cityinfo.monthlyUncollectedTaxFromPlebs = <span class="hljs-number"><span class="hljs-number">0</span></span>; cityinfo.monthlyCollectedTaxFromPlebs = <span class="hljs-number"><span class="hljs-number">0</span></span>; cityinfo.monthlyUncollectedTaxFromPatricians = <span class="hljs-number"><span class="hljs-number">0</span></span>; cityinfo.monthlyCollectedTaxFromPatricians = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">20</span></span>; ++i ) cityinfo.societyGraph[ i ] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( house <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> city.houses ) { isPatrician = house.<span class="hljs-keyword"><span class="hljs-keyword">level</span></span> &gt;= <span class="hljs-number"><span class="hljs-number">12</span></span>; trm = adjustWithPercentage( model_houses.tax[ house.<span class="hljs-keyword"><span class="hljs-keyword">level</span></span> ], difficulty.moneypct[setting.difficulty] ); cityinfo.societyGraph[ house.<span class="hljs-keyword"><span class="hljs-keyword">level</span></span> ] += house.population; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (house.taxcollector &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( isPatrician ) cityinfo.numPatriciansTaxed += house.population; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cityinfo.numPlebsTaxed += house.population; tax = house.population * trm; house.taxIncomeThisYear += tax; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( isPatrician ) cityinfo.monthlyCollectedTaxFromPatricians += tax; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cityinfo.monthlyCollectedTaxFromPlebs += tax; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( isPatrician ) cityinfo.numPatriciansNotTaxed += house.population; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cityinfo.numPlebsNotTaxed += house.population; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( isPatrician ) cityinfo.monthlyUncollectedTaxFromPatricians += house.population * trm; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cityinfo.monthlyUncollectedTaxFromPlebs += house.population * trm; } } collectedPatricians = adjustWithPercentage( cityinfo.monthlyCollectedTaxFromPatricians / <span class="hljs-number"><span class="hljs-number">2</span></span>, cityinfo.taxpercentage ); cityinfo.yearlyTaxFromPatricians += collectedPatricians; collectedPatricians2 = collectedPatricians; collectedPlebs = adjustWithPercentage( cityinfo.monthlyCollectedTaxFromPlebs / <span class="hljs-number"><span class="hljs-number">2</span></span>, cityinfo.taxpercentage ); cityinfo.yearlyTaxFromPlebs += collectedPlebs; totalCollectedTax = collectedPlebs + collectedPatricians2; cityinfo.yearlyUncollectedTaxFromPatricians += adjustWithPercentage( cityinfo.monthlyUncollectedTaxFromPatricians/ <span class="hljs-number"><span class="hljs-number">2</span></span>, cityinfo.taxpercentage); cityinfo.yearlyUncollectedTaxFromPlebs += adjustWithPercentage( cityinfo.monthlyUncollectedTaxFromPlebs / <span class="hljs-number"><span class="hljs-number">2</span></span>, cityinfo.taxpercentage); cityinfo.treasury += totalCollectedTax; cityinfo.percentagePlebsRegisteredForTax = getPercentage( cityinfo.numPlebsTaxed, cityinfo.numPlebsNotTaxed + cityinfo.numPlebsTaxed ); cityinfo.percentagePatriciansRegisteredForTax = getPercentage( cityinfo.numPatriciansTaxed, cityinfo.numPatriciansNotTaxed + cityinfo.numPatriciansTaxed ); cityinfo.percentageRegisteredForTax = getPercentage( cityinfo.numPlebsTaxed + cityinfo_numPatriciansTaxed, cityinfo.numPlebsNotTaxed + cityinfo.numPlebsTaxed + cityinfo.numPatriciansNotTaxed + cityinfo.numPatriciansTaxed ); }</code> </pre><br></div></div><br><br><h2>  Food consumption </h2><br><br><img width="300" src="https://habrastorage.org/files/f3f/5ed/2a7/f3f5ed2a70bb497182b298b1e598facd.jpg"><br><br>  People eat X quantities of food, no matter how many kinds of food they have.  The amount of food eaten depends only on the number of people living in the house (10 people eat 5 units of food per month) For example: there is a dwelling house of the 20th level, fully populated, that is, 200 people live there they need 3 types of food.  In a month they will eat up the total amount of food equal to 200/10 * 5 = 100 units, these 100 units will be distributed between the three necessary types of food, probably equally, that is, 100/3 = 33. <br><br><div class="spoiler">  <b class="spoiler_title">Calculate consumption for homes</b> <div class="spoiler_text"><pre> <code class="hljs matlab">void housesConsumeMonthlyFood() { gatherFoodInformation(); cityinfo.foodTypesEaten = <span class="hljs-number"><span class="hljs-number">0</span></span>; totalConsumed = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( building in city.houses ) { numTypes = model_houses.foodtypes[ building.level ]; foodToConsumePerType = adjustWithPercentage( building.population, <span class="hljs-number"><span class="hljs-number">50</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( numTypes &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ) foodToConsumePerType /= numTypes; building.houseNumFoods = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( scn_romeSuppliesWheat ) { cityinfo.foodTypesEaten = <span class="hljs-number"><span class="hljs-number">1</span></span>; cityinfo.foodTypesAvailable = <span class="hljs-number"><span class="hljs-number">1</span></span>; building.foodstocks[<span class="hljs-number"><span class="hljs-number">0</span></span>] = foodToConsumePerType; building.houseNumFoods = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( numTypes &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">j</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; ; ++<span class="hljs-built_in"><span class="hljs-built_in">j</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">j</span></span> &lt; <span class="hljs-number"><span class="hljs-number">4</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (building.foodstocks[<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>] &lt; foodToConsumePerType ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( building.foodstocks[<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>] ) { building.foodstocks[<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ++building.houseNumFoods; totalConsumed += foodToConsumePerType; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { building.foodstocks[<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>] -= foodToConsumePerType; ++building.houseNumFoods; totalConsumed += foodToConsumePerType; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( building.houseNumFoods &gt; cityinfo.foodTypesEaten ) cityinfo.foodTypesEaten = building.houseNumFoods; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( building.houseNumFoods &lt; numTypes ) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } } cityinfo.foodConsumedLastMonth = totalConsumed; cityinfo_foodStoredLastMonth = cityinfo_foodStoredSoFarThisMonth; cityinfo_foodStoredSoFarThisMonth = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br></div></div><br><br><h2>  Production of goods </h2><br><img width="400" src="https://habrastorage.org/files/ba6/0b4/7ef/ba60b47efd66449ebd9cc3b1a06f6ce0.png"><br><br>  Sometimes the city needs to import materials to produce goods.  Eight workshops work stably with one warehouse, two more intermittently: imports, depends on the number of workshops and on the number of materials that a trading partner can provide.  Exports can be adjusted numerically, and raw materials are imported in proportion to the demand of the workshops.  Therefore, with a small number of workshops, the warehouse simply will not buy raw materials in reserve. <br><br><h2>  Welfare rating calculation </h2><br><img width="400" src="https://habrastorage.org/files/ccf/0b6/834/ccf0b683430345a08719705f13a640e9.jpg"><br><br>       ¬´¬ª  ,            ,   ‚Äî     2 , ..       50      25 ,     . <br><br><img width="800" src="https://habrastorage.org/files/380/251/486/38025148673a4000bc4242ef08d2f481.jpeg"><br><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><pre> <code class="hljs ruby">void updateProsperityRating() { labor = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.unemploymentPercentage &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.unemploymentPercentage &gt;= <span class="hljs-number"><span class="hljs-number">15</span></span> ) labor = -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> -<span class="hljs-number"><span class="hljs-number">1</span></span> Unemployment rate is above <span class="hljs-number"><span class="hljs-number">15</span></span>% } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { labor = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> +<span class="hljs-number"><span class="hljs-number">1</span></span> Less than <span class="hljs-number"><span class="hljs-number">5</span></span>% unemployment } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.finance_construction_lastyear + cityinfo.treasury &lt;= cityinfo.treasury_lastyear_prosperity ) increase = labor - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> -<span class="hljs-number"><span class="hljs-number">1</span></span> Losing money <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> increase = labor + <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> +<span class="hljs-number"><span class="hljs-number">5</span></span> Making a profit cityinfo.treasury_lastyear_prosperity = cityinfo.treasury; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.foodTypesEaten &gt;= <span class="hljs-number"><span class="hljs-number">2</span></span> )/<span class="hljs-regexp"><span class="hljs-regexp">/ == grand insula or better ++increase; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ +1 There is at least one Grand Insula or better avgWage = cityinfo.wageRatePaid_lastYear /</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( avgWage &lt;= cityinfo.wagesRome + <span class="hljs-number"><span class="hljs-number">1</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( avgWage &lt; cityinfo.wagesRome ) --increase; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> -<span class="hljs-number"><span class="hljs-number">1</span></span> Your wages are below Rome<span class="hljs-string"><span class="hljs-string">'s } else { ++increase; // You pay at least 2 Dn more than Rome'</span></span>s wage } poor = getPercentage(cityinfo_peopleInTentsAndShacks, cityinfo_population); rich = getPercentage(cityinfo_peopleInVillasAndPalaces, cityinfo_population); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( poor &gt; <span class="hljs-number"><span class="hljs-number">30</span></span> ) --increase; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( rich &gt; <span class="hljs-number"><span class="hljs-number">10</span></span> ) ++increase; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> +<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>% <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> more of your population lives <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> villas <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.tributeNotPaid ) --increase; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo_hippodromeShows &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) ++increase; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> +<span class="hljs-number"><span class="hljs-number">1</span></span> Active Hippodrome cityinfo_prosperityRating += increase; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.prosperityRating &gt; cityinfo.maxProsperity ) cityinfo.prosperityRating = cityinfo.maxProsperity; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.prosperityRating &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) cityinfo.prosperityRating = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cityinfo.prosperityRating &gt; <span class="hljs-number"><span class="hljs-number">100</span></span> ) cityinfo.prosperityRating = <span class="hljs-number"><span class="hljs-number">100</span></span>; setProsperityRatingExplanation(); }</code> </pre><br></div></div><br><br><h2>    </h2><br><br><img src="https://habrastorage.org/files/9c5/467/a7f/9c5467a7ff2a4ab29acc2fc7a09194d6.jpg"><br><br> Caesar III    ,   , , ,   . ,           2000,      (, , , )   50.      -      32,        .        ,     . <br><br><div class="spoiler"> <b class="spoiler_title">(Walker)   </b> <div class="spoiler_text"><pre> <code class="hljs pgsql">struct Walker { <span class="hljs-type"><span class="hljs-type">int</span></span> gridOffset; //   (y * mapWidth + x) <span class="hljs-type"><span class="hljs-type">char</span></span> inUse; //   short nextIdOnSameTile; //     unsigned <span class="hljs-type"><span class="hljs-type">char</span></span> actionState; //   (, , , ) <span class="hljs-type"><span class="hljs-type">int</span></span> tradeCityId; //  ,     <span class="hljs-type"><span class="hljs-type">int</span></span> direction; //  <span class="hljs-type"><span class="hljs-type">int</span></span> buildingId; // ,    unsigned <span class="hljs-type"><span class="hljs-type">char</span></span> y; //   unsigned <span class="hljs-type"><span class="hljs-type">char</span></span> x; unsigned <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA360; //dst_x ??? unsigned <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA361; //dst_y ??? <span class="hljs-type"><span class="hljs-type">int</span></span> progressOnTile; //   ,     <span class="hljs-type"><span class="hljs-type">int</span></span> tilePosition_y; //    <span class="hljs-type"><span class="hljs-type">int</span></span> tilePosition_x; <span class="hljs-type"><span class="hljs-type">int</span></span> destination_x; //  <span class="hljs-type"><span class="hljs-type">int</span></span> destination_y; WalkerType <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>; //  <span class="hljs-type"><span class="hljs-type">int</span></span> word_7FA344; <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA34C; <span class="hljs-type"><span class="hljs-type">char</span></span> speed; //  <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA3A6; <span class="hljs-type"><span class="hljs-type">int</span></span> state; //   short baseWorkingBuildingId; //   ,   short formationId; // ,     short word_7FA346; <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA39B; short word_7FA366; short tradeCaravanNextId; //    ,        short itemCollecting; <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA341; short migrantDestinationHome; // ,    short word_7FA374; short destinationpathId; // ,    ,    <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA376; <span class="hljs-type"><span class="hljs-type">char</span></span> lastDirection; //   short word_7FA3B0; short wlk_ID_mm; short word_7FA3B4; short word_7FA3B6; short word_7FA372; short word_7FA35E; <span class="hljs-type"><span class="hljs-type">char</span></span> cartPusherGoodType; //    <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA39C; <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA39D; <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA393; <span class="hljs-type"><span class="hljs-type">char</span></span> reachedLastStep; //   (  <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-type"><span class="hljs-type">char</span></span> maxLevelOrRiskSeen; //  ,      (<span class="hljs-number"><span class="hljs-number">0</span></span>\<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA3B8; <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA342; <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA3A5; <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA3A2; <span class="hljs-type"><span class="hljs-type">char</span></span> isBoat; //  <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA34D; <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA39F; <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA3A7; <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA3A9; short word_7FA384; short wlk_ID_pp; //   ,   ,      <span class="hljs-type"><span class="hljs-type">char</span></span> migrantNumPeopleCarried; //     <span class="hljs-type"><span class="hljs-type">char</span></span> mood; /// <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA389; <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA3A3; <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA370; <span class="hljs-type"><span class="hljs-type">char</span></span> ruler; //  ,        <span class="hljs-type"><span class="hljs-type">char</span></span> simpleDirection; //      (<span class="hljs-number"><span class="hljs-number">0</span></span> - , <span class="hljs-number"><span class="hljs-number">1</span></span> -   ) <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA39A; <span class="hljs-type"><span class="hljs-type">char</span></span> byte_7FA3B9; <span class="hljs-type"><span class="hljs-type">char</span></span> at_dest_x; //     <span class="hljs-type"><span class="hljs-type">char</span></span> at_dest_y; short word_7FA3BA; short word_7FA3BC; <span class="hljs-type"><span class="hljs-type">char</span></span> prevActionState; //   short destinationPathCurrent; //    };</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title">(Building)   </b> <div class="spoiler_text"><pre> <code class="hljs ruby">struct Building { BuildingType type; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  int storageId; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  (, , ) int x; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   int y; unsigned char inUse; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  int house_crimeRisk; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  ,   int house_size; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()    int house_population; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>()  int walkerServiceAccess; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   (<span class="hljs-number"><span class="hljs-number">0</span></span>-<span class="hljs-number"><span class="hljs-number">100</span></span>) int laborCategory; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  (,   ) int word_94BDAC[<span class="hljs-number"><span class="hljs-number">2</span></span>]; char byte_94BDB8; int level_resourceId; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     () int grow_value_house_foodstocks[<span class="hljs-number"><span class="hljs-number">8</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>()   short house_roomForPeople; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>()    short haveRomeroad; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   short house_maxPopEver; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>()   short noContactWithRome; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     char enter_x; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  char enter_y; short walkerId; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> /      short laborSeekerId; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ,     short immigrantId; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()  ,      short towerBallistaId; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()  ,     char walkerSpawnDelay; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()     char byte_94BD6C; char hasFountain; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       char waterDep; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> (, )      short warehouse_prevStorage; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>()   short warehouse_nextStorage; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>()   ( ) short industry_unitsStored; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()     char house_hasWell; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()    short num_workers; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()    short fireRisk; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  short damageRisk; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   short industry_outputGood; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()     short house_theater_amphi_wine; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    short house_amphiGlad_colo; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>()    short house_coloLion_hippo; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()    short house_school_library; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>()  / short house_academy_barber; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()   / short granary_capacity[<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  -   short house_wheat; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()   short gridOffset; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     ( ) short wharf_hasBoat_house_evolveStatusDesir; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  -    /  -   short house_pottery; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()   short house_oil; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()   short house_furniture; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()   short house_wine; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()   short house_vegetables; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()   short size; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    short formationId; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  ,      short placedSequenceNumber; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     (, ) char byte_always<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>??? short cityId; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ,     (   <span class="hljs-number"><span class="hljs-number">2</span></span>) short workersEffectivity; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    short burningRuinStep; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     char house_bathhouse_dock_numships_entert_days; char byte_94BDBB; char haveProblems; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    char house_entertainment; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()   char house_numGods; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()   char house_education; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   char house_clinic; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ()   char house_hospital_entert_days2; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>()       char house_mercury; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>()    char house_neptune; char house_mars; char house_venus; char byte_94BDB9; char hasRoadAccess; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    char haveRoadnet; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   char house_isMerged; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     char desirability; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  (-<span class="hljs-number"><span class="hljs-number">50</span></span>  <span class="hljs-number"><span class="hljs-number">100</span></span>) char adjacentToWater; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    char byte_94BD84; char byte_94BD85; char house_health; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   char house_ceres; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> char house_taxcollector; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    char byte_94BD7D; };</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title">(EmpireObject)     </b> <div class="spoiler_text"><pre> <code class="hljs ruby">struct EmpireObject { char inUse; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   char type; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> (, , , ) char currentAnimationIndex; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  __int16 xCoord; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   __int16 yCoord; __int16 width; __int16 height; __int16 graphicID; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  __int16 graphicID_exp; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  char distBattleTravelMonths; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ ( )         __int16 xCoord_exp; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    __int16 yCoord_exp; char cityType; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ , , ,  char cityNameId; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  char tradeRouteId; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      char tradeRouteOpen; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  __int16 tradeCostToOpen[10]; char citySells[16]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    char ownerCityIndex; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/,     char f990D29[10]; char cityBuys[16]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    char invasionPathId; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  char invasionYears; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   ,      __int16 trade40; __int16 trade25; __int16 trade15; };</span></span></code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title">(TradeRoute)   </b> <div class="spoiler_text"><pre> <code class="hljs ruby">struct TradeRoute { char inUse; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  char cityType; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  char cityNameId; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  char routeId[<span class="hljs-number"><span class="hljs-number">16</span></span>]; char isOpen; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  char buysFlag[<span class="hljs-number"><span class="hljs-number">16</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  char sellsFlag[<span class="hljs-number"><span class="hljs-number">16</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  char sellsFlag_wine; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     __int16 costToOpen; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   __int16 unknown1<span class="hljs-number"><span class="hljs-number">0</span></span>; __int16 walkerEntryDelay; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    __int16 unknown<span class="hljs-number"><span class="hljs-number">0</span></span>; __int16 empireObjectId; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  char isSeaTrade; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  ,      __int16 walkerId1; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  __int16 walkerId2; __int16 walkerId3; int quotas[<span class="hljs-number"><span class="hljs-number">16</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   };</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="hljs ruby">Walker walkers[<span class="hljs-number"><span class="hljs-number">1000</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     Building buildings[<span class="hljs-number"><span class="hljs-number">2000</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    Formation formations[<span class="hljs-number"><span class="hljs-number">50</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  EmpireObject empireObjects[<span class="hljs-number"><span class="hljs-number">100</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    ModelHouse model_houses[<span class="hljs-number"><span class="hljs-number">20</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  Storage storages[<span class="hljs-number"><span class="hljs-number">200</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    TradeRoute tradeRoutes[<span class="hljs-number"><span class="hljs-number">200</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  CityInfo city_inform[<span class="hljs-number"><span class="hljs-number">8</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   <span class="hljs-number"><span class="hljs-number">2</span></span> (     )</code> </pre><br></div></div><br><br><h2>  Thanks </h2><br>       <a href="http://habrahabr.ru/post/235813/">  </a>   <a href="http://steamcommunity.com/sharedfiles/filedetails/%3Fid%3D249746982">¬´ ¬ª  </a> ,         <a href="http://igg.me/at/caesaria-game">IndieGoGo.com</a> .      . <br><br>     Caesar III,            ,   v0.4     .             . <br><br>      ,     <br><img width="400" src="https://habrastorage.org/files/a7c/117/f23/a7c117f234d64d94ba7627fd8efd0c4f.jpg"><img width="400" src="https://habrastorage.org/files/fc4/43a/6e5/fc443a6e5d014291b37fe4106f177bbe.jpg"><br><br>  <a href="http://habrahabr.ru/users/skidanovalex/" class="user_link">SkidanovAlex</a> , <a href="http://habrahabr.ru/users/ununtrium/" class="user_link">Ununtrium</a> , <a href="http://habrahabr.ru/users/bick/" class="user_link">Bick</a>         indiegogo. <br>   <a href="http://habrahabr.ru/users/mennycalavera/" class="user_link">MennyCalavera</a>        <br>        <a href="https://bitbucket.org/dalerank/caesaria/wiki/Reverse%2520engineering%2520Caesar%25203%2520%2528part%25202%2529">1</a>  <a href="https://bitbucket.org/dalerank/caesaria/wiki/Reverse%2520engineering%2520Caesar%25203%2520%2528mathematical%2520model%2520of%2520the%2520city%2529">2</a> . <br><br>          <a href="https://bitbucket.org/dalerank/caesaria/wiki/Home"> </a> .            . <br><br> <a href="http://www.igg.me/at/caesaria-game"><img src="https://habrastorage.org/files/5fd/dbc/d20/5fddbcd20dfd43f3a233d13f2ea499c3.jpg"></a> <br><br> PS        Bianca van Schaik,           . <br><br><h2>     </h2></div><p>Source: <a href="https://habr.com/ru/post/239013/">https://habr.com/ru/post/239013/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../238999/index.html">Microsoft is collecting suggestions for improving Internet Explorer</a></li>
<li><a href="../239001/index.html">BlackEnergy Lite aims at Ukraine and Poland</a></li>
<li><a href="../239005/index.html">Changing the code of system assemblies or "leak". Net Framework 5.0</a></li>
<li><a href="../239009/index.html">Two special models for splitting numbers</a></li>
<li><a href="../239011/index.html">Testing Effort Planning - Report from SQA Days 15</a></li>
<li><a href="../239015/index.html">New Ruby Books</a></li>
<li><a href="../239023/index.html">The FLIR One: What can a thermal imager for a phone?</a></li>
<li><a href="../239025/index.html">WebMarkupMin: Minimize KnockoutJS and AngularJS views</a></li>
<li><a href="../239027/index.html">Lumia SensorCore SDK: new opportunities for developing mobile applications. Part 2: Creating the Application</a></li>
<li><a href="../239029/index.html">Placebo-buttons in everyday life and in web design</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>