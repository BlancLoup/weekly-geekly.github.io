<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Linux wifi from the command line with wpa_supplicant</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will tell how you can configure WiFi using wpa_supplicant , without any Xorg / X11 utilities. This is necessary to ensure that basic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Linux wifi from the command line with wpa_supplicant</h1><div class="post__text post__text-html js-mediator-article"><p>  In this article I will tell how you can configure WiFi using <em>wpa_supplicant</em> , without any Xorg / X11 utilities.  This is necessary to ensure that basic OS services work properly with a minimum set of remote access hardware.  The program will be executed as a service, the settings are made by editing the config file. </p><br><p>  Quickly, you can establish a connection with an open access point in this way. </p><br><pre><code class="bash hljs">[root@home ~]$ wpa_cli &gt; add_network &gt; set_network 0 ssid <span class="hljs-string"><span class="hljs-string">"MYSSID"</span></span> &gt; set_network 0 key_mgmt NONE &gt; enable_network 0</code> </pre> <br><p>  If it is necessary seriously and for a long time, then I ask inside. </p><a name="habracut"></a><br><h2>  Wpa_supplicant Overview </h2><br><p>  What is <em>wpa_supplicant</em> ? </p><br><ul><li>  Cross-platform open implementation of <a href="https://en.wikipedia.org/wiki/IEEE_802.11i">the IEEE 802.11 standard</a> for Linux, * BSD, Windows, Mac OS X and other systems. </li><li>  Full support for WPA2, WPA and older wireless LAN security protocols. </li><li>  A user-space application that performs the functions of a supplicant and <a href="https://wireless.wiki.kernel.org/en/developers/documentation/glossary">SME</a> operator that executes MLME instructions. </li></ul><br><p>  <em>Wpa_supplicant</em> supports </p><br><ul><li>  WPA and fully IEEE 802.11i / RSN / WPA2. </li><li>  WPA-PSK and WPA2-PSK (pre-shared key) ("WPA-Personal"). </li><li>  WPA with EAP (i.e., RADIUS authentication server) ("WPA-Enterprise") key management for CCMP, TKIP, WEP (104/128 and 40/64 bits). </li><li>  Caching RSN, PMKSA: pre-authentication. </li></ul><br><img src="https://habrastorage.org/files/2d0/6b9/8b7/2d06b98b7ba048ffaaa57ac772cb1546.png"><br><p><br></p><br><p>  How does <em>wpa_supplicant</em> communicate with an access point? </p><br><ul><li>  The network interface must function properly with the driver installed before <em>wpa_supplicant</em> starts. </li><li>  <em>Wpa_supplicant</em> requests the kernel driver to scan the available Basic Service Set (BSS). </li><li>  <em>Wpa_supplicant</em> selects the BSS according to the settings. </li><li>  <em>Wpa_supplicant</em> requests the kernel driver to establish a connection with the selected BSS. </li><li>  For WPA-EAP: EAP authentication is performed by the built-in IEEE 802.1X Supplicant, or external Xsupplicant with an authentication server. </li><li>  For WPA-EAP: Master key from IEEE 802.1X Supplicant received. </li><li>  For WPA-PSK, <em>wpa_supplicant</em> uses the PSK password as the session master key. </li><li>  <em>Wpa_supplicant</em> performs 4-step negotiation <a href="https://habr.com/ru/post/315960/"><sup>[1]</sup></a> and group key negotiation with the authenticator of the access point. </li><li>  <em>Wpa_supplicant</em> encrypts the unidirectional and broadcast packets <a href="https://habr.com/ru/post/315960/"><sup>[2]</sup></a> , after which the usual data exchange begins. </li></ul><br><p>  The main and big plus of <em>wpa_supplicant</em> is its <strong>Unixway</strong> , that is, compliance with the <em>Unix Way</em> principle, when the program does one thing, but does it well.  In a sense, the <em>wpa_supplicant is</em> also the <a href="https://habrahabr.ru/post/315048/">Gentoo Way</a> .  It requires some attention and patience at the beginning, but then you can completely forget about it.  After the program is set up and started up, it completely drops out of the event flow, turning into a couple of lines from <code>ps -ef</code> .  It does not sparkle and does not flash in the system tray, does not notify you about the explored, connected and disconnected wireless networks.  It simply is not there until you yourself look for it. </p><br><p>  Of the minuses - the <strong>complexity of configuration and configuration</strong> .  A lot of fuss compared to tyrk-tyrk-tyrk in the <code>Network Manager</code> window, not to mention the WiFi connection from any Android device.  If you are going on a trip with a Linux laptop, you will surely prefer a more friendly front-end wireless setup to quickly connect to free WiFi access points at the airport, hotel or in the work environment.  For the home wireless Internet - the most it. </p><br><h2>  Installation </h2><br><p>  If you do not select a graphical frontend, then the program almost does not pull any dependencies.  For Gentoo Linux, the installation will be fine with the flags set as shown. </p><br><pre> <code class="bash hljs">(5:562)$ equery uses wpa_supplicant [ Legend : U - final flag setting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> installation] [ : I - package is installed with flag ] [ Colors : <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">unset</span></span> ] * Found these USE flags <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> net-wireless/wpa_supplicant-2.6: UI - - ap : Add support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> access point mode + + dbus : Enable dbus support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> anything that needs it (gpsd, gnomemeeting, etc) - - eap-sim : Add support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> EAP-SIM authentication algorithm - - fasteap : Add support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> FAST-EAP authentication algorithm - - gnutls : Add support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> net-libs/gnutls (TLS 1.0 and SSL 3.0 support) + + hs2-0 : Add support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> 802.11u and Passpoint <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> HotSpot 2.0 - - p2p : Add support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Wi-Fi Direct mode - - qt4 : Add support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the Qt GUI/Application Toolkit version 4.x - - qt5 : Add support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the Qt 5 application and UI framework + + readline : Enable support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> libreadline, a GNU line-editing library that almost everyone wants - - smartcard : Add support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> smartcards + + ssl : Add support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Secure Socket Layer connections - - tdls : Add support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Tunneled Direct Link Setup (802.11z) - - uncommon-eap-types : Add support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> GPSK, SAKE, GPSK_SHA256, IKEV2 and EKE - - wps : Add support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Wi-Fi Protected Setup</code> </pre> <br><p>  Install. </p><br><ul><li>  <code>emerge -av wpa_supplicant</code> #Gentoo </li><li>  <code>aptitude install wpasupplicant</code> #Debian </li><li>  <code>yum install wpa_supplicant</code> #Redhat </li><li>  <code>pacman -S wpa_supplicant</code> #Arch </li></ul><br><h2>  Connection without config file </h2><br><p>  If you need to connect only once, then there is no need to create a configuration file and delve into all the details of the settings.  Just type a few instructions from the command line. </p><br><p>  An example for an open network was shown at the very beginning.  For a closed WPA network, the quick connection looks like this: </p><br><p>  In the beginning, you need to run the <em>wpa_supplicant</em> program <em>itself</em> and the associated <code>wpa_cli</code> . </p><br><pre> <code class="hljs scala">[root<span class="hljs-meta"><span class="hljs-meta">@home</span></span> ~]$ wpa_supplicant -<span class="hljs-type"><span class="hljs-type">Dnl80211</span></span> -iwlan0 -<span class="hljs-type"><span class="hljs-type">C</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/run -u &amp; [root<span class="hljs-meta"><span class="hljs-meta">@home</span></span> ~]$ wpa_cli -p/<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/run</code> </pre> <br><p>  Then setup from <code>wpa_cli</code> interactive interface. </p><br><pre> <code class="hljs objectivec">&gt; add_network &gt; set_network <span class="hljs-number"><span class="hljs-number">0</span></span> ssid <span class="hljs-string"><span class="hljs-string">"name of AP"</span></span> &gt; set_network <span class="hljs-number"><span class="hljs-number">0</span></span> key_mgmt WPA-PSK &gt; set_network <span class="hljs-number"><span class="hljs-number">0</span></span> pairwise TKIP &gt; set_network <span class="hljs-number"><span class="hljs-number">0</span></span> psk <span class="hljs-string"><span class="hljs-string">"key"</span></span> &gt; enable_network <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  For closed WPA2 network: </p><br><pre> <code class="hljs objectivec">&gt; add_network &gt; set_network <span class="hljs-number"><span class="hljs-number">0</span></span> ssid <span class="hljs-string"><span class="hljs-string">"name of AP"</span></span> &gt; set_network <span class="hljs-number"><span class="hljs-number">0</span></span> key_mgmt WPA-PSK &gt; set_network <span class="hljs-number"><span class="hljs-number">0</span></span> pairwise CCMP &gt; set_network <span class="hljs-number"><span class="hljs-number">0</span></span> psk <span class="hljs-string"><span class="hljs-string">"key"</span></span> &gt; enable_network <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  Finally, you need to manually start the DHCP daemon. </p><br><pre> <code class="hljs ruby">[root@home ~]$ dhcpcd wlan<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><h2>  Ad-Hoc network connection </h2><br><p>  I have never come across such a thing, but you need to be ready for everything.  Connect to open ad-hoc. </p><br><pre> <code class="hljs pgsql">&gt; add_network &gt; set_network <span class="hljs-number"><span class="hljs-number">0</span></span> ssid "adhoc-ssid" &gt; set_network <span class="hljs-number"><span class="hljs-number">0</span></span> mode <span class="hljs-number"><span class="hljs-number">1</span></span> &gt; set_network <span class="hljs-number"><span class="hljs-number">0</span></span> frequency <span class="hljs-number"><span class="hljs-number">2412</span></span> &gt; set_network <span class="hljs-number"><span class="hljs-number">0</span></span> key_mgmt <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span> &gt; enable_network <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  The same with <code>iw</code> . </p><br><pre> <code class="hljs pgsql">&gt; iw dev wlan0 del &gt; iw phy phy0 interface <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> wlan0 <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ibss &gt; ifconfig wlan0 up &gt; iw dev wlan0 scan &gt; iw dev wlan0 ibss <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> AdHocNetworkName <span class="hljs-number"><span class="hljs-number">2412</span></span></code> </pre> <br><h2>  Setup for home network </h2><br><p>  Now the most interesting is the setting.  This process is documented for the <a href="https://wiki.archlinux.org/index.php/WPA_supplicant_(%25D0%25A0%25D1%2583%25D1%2581%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9)">Arch Wiki</a> , the <a href="https://wiki.debian.org/ru/WiFi/HowToUse">Debian Wiki,</a> and the <a href="https://wiki.gentoo.org/wiki/Wpa_supplicant">Gentoo Wiki</a> , but of course there‚Äôs no details. </p><br><p>  The program is usually placed in the <code>/etc/wpa_supplicant/</code> directory, and our task is to correctly <em>configure the</em> <code>wpa_supplicant.conf</code> <em>configuration file</em> , and <em>bind it to autorun the wireless network interface</em> . </p><br><p>  Let's start with <code>wpa_supplicant.conf</code> .  If you are connecting from home to WPA / WPA2, then most likely you use the password for the WiFi connection, which corresponds to the <code>WPA-PSK ("WPA-Personal")</code> mode <code>WPA-PSK ("WPA-Personal")</code> .  We will not consider options with WEP encryption, since it is not much better than an open network. </p><br><p>  Let's take typical config from documentation.  For example such. </p><br><pre> <code class="bash hljs">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=wheel <span class="hljs-comment"><span class="hljs-comment"># # home network; allow all valid ciphers network={ ssid="home" scan_ssid=1 key_mgmt=WPA-PSK psk="very secret passphrase" }</span></span></code> </pre> <br><p>  The first line is <em>necessary</em> , without <code>ctrl_interface</code> program will not even start.  GROUP = wheel is needed in order to run wpa_gui from under a normal user, but this is not our way.  Therefore, we change to rutovy <code>GROUP=0</code> . </p><br><pre> <code class="hljs swift">ctrl_interface_group=<span class="hljs-number"><span class="hljs-number">0</span></span> ctrl_interface=/<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/run/wpa_supplicant ap_scan=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p>  Each network in the settings file must correspond to the <code>network {}</code> block.  Having rummaged in the source code, I found the <code>ap_scan</code> variable <code>ap_scan</code> in the file <code>config.h</code> , and in the manual and user manual its description is very poor. </p><br><pre> <code class="bash hljs">ap_scan=0 <span class="hljs-comment"><span class="hljs-comment">#    ap_scan=1 #wpa_supplicant   ,  - ap_scan=2 # 0,       SSID,   ndiswrapper</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Full description</b> <div class="spoiler_text"><p>  ap_scan - AP scanning / selection </p><br><p>  By default, it will be possible to scan the AP.  If you are not in use, it can be used for the IEEE 802.11 association. </p><br><p>  1: wpa_supplicant initiates scanning and AP selection (default). <br>  0: Driver selection, AP selection, and IEEE 802.11 association parameters (WPA IE generation);  non-WPA drivers when using this mode can also be used with IEEE 802.1X mode; <br>  do not try to associate with APs (ie, external program needs to control association).  This mode must also be used when using wired Ethernet drivers. </p><br><p>  2: like 0, but associate with APs using security policy (but not BSSID);  SSIDs for optimized roaming; <br>  in this configuration  each network block should have explicit security policy (ie, only one <br>  option in the lists) for key_mgmt, pairwise, group, proto variables. </p><br><p>  Note: ap_scan = 2 should not be used with the driver interface (the current Linux interface).  ap_scan = 1 is optimized work working with nl80211.  For finding networks using hidden SSID, scan_ssid = 1 in the network block can be used with nl80211. </p></div></div><br><p>  The remaining options are taken from <a href="">the config file manual</a> . </p><br><ul><li>  <code>bssid</code> - The Basic Service Set Identifier (BSSID), the physical address of the access point. </li><li>  <code>key_mgmt</code> - Authentication protocols. </li><li>  <code>pairwise</code> - For WPA2, specify CCMP, and for WPA, specify TKIP. </li><li>  <code>proto</code> - WPA / WPA2. </li><li>  <code>psk</code> - PreShared Key password hash. </li></ul><br><div class="spoiler">  <b class="spoiler_title">settings guide</b> <div class="spoiler_text"><p>  group: list of accepted group (broadcast / multicast) ciphers for WPA <br>  CCMP = AES in Counter mode with CBC-MAC [RFC 3610, IEEE 802.11i / D7.0] <br>  TKIP = Temporal Key Integrity Protocol [IEEE 802.11i / D7.0] <br>  WEP104 = WEP (Wired Equivalent Privacy) with 104-bit key <br>  WEP40 = WEP (Wired Equivalent Privacy) with 40-bit key [IEEE 802.11] <br>  If not set, this defaults to: CCMP TKIP WEP104 WEP40 </p><br><p>  pairwise: list of accepted pairwise (unicast) ciphers for WPA <br>  CCMP = AES in Counter mode with CBC-MAC [RFC 3610, IEEE 802.11i / D7.0] <br>  TKIP = Temporal Key Integrity Protocol [IEEE 802.11i / D7.0] <br>  NONE = Use only Keys Group (deprecated, should not be included if APs support pairwise keys) </p><br><p>  proto: list of accepted protocols <br>  WPA = WPA / IEEE 802.11i / D3.0 <br>  RSN = WPA2 / IEEE 802.11i (also WPA2 can be used) <br>  If not set, this defaults to: WPA RSN </p><br><p>  key_mgmt: list of accepted authenticated key management protocols <br>  WPA-PSK = WPA pre-shared key (this requires 'psk' field) <br>  WPA-EAP = WPA using EAP authentication (for example, Xsupplicant, for IEEE 802.1X EAP Authentication) <br>  IEEE8021X = IEEE 802.1X using EAP authentication and (optionally) dynamically generated WEP keys <br>  NONE = WPA is not used;  plaintext or static WEP could be used <br>  If not set, this defaults to: WPA-PSK WPA-EAP </p></div></div><br><p>  Create a password hash for <code>psk</code> : </p><br><pre> <code class="hljs ruby">$ wpa_passphrase MYSSID passphrase</code> </pre> <br><p>  Everything is ready to create a network config.  The resulting file should look something like this. </p><br><pre> <code class="bash hljs">ctrl_interface_group=0 ap_scan=1 ctrl_interface=/var/run/wpa_supplicant network={ proto=WPA2 pairwise=CCMP key_mgmt=WPA-PSK priority=5 ssid=<span class="hljs-string"><span class="hljs-string">"MYSSID"</span></span> bssid=44:b0:51:dc:ba:f8 psk=ce55977186ae1df2dffeb571acee8dacd92f49edddbdef53623132e3c24567ae }</code> </pre> <br><p>  <code>bssid</code> values ‚Äã‚Äãfor <code>bssid</code> , <code>group</code> , <code>proto</code> and <code>pairwise</code> can be determined by scanning the wireless network. </p><br><pre> <code class="hljs ruby">[root@home ~]$ iwlist &lt;wlan_interface&gt; scan</code> </pre> <br><p>  The <code>iwlist</code> command from the <code>Wireless Tools</code> set is deprecated, instead it is now <code>iw</code> . </p><br><pre> <code class="hljs ruby">[root@home ~]$ iw dev &lt;wlan_interface&gt; scan</code> </pre> <br><h2>  802.1X Office Setup </h2><br><p>  The IEEE 802.1X standard defines a more rigorous model for connecting to a WiFi network.  Instead of a <code>psk</code> password, you need to present a server certificate. </p><br><ul><li>  <code>ca_cert</code> - Absolute path to the CA-certificate in the PEM or DER format, necessary to be able to verify the server certificate. </li><li>  <code>ca_path</code> - Absolute path to the directory where CA certificate files (in PEM format) are stored that you want to add to the trusted list. </li><li>  <code>client_cert</code> - The absolute path to the client certificate in PEM or DER format. </li><li>  <code>eap</code> - A space-separated list of supported EAP methods: MD5, MSCHAPV2, OTP, GTC, TLS, PEAP, or TTLS. </li><li>  <code>identity</code> - EAP identifications, such as username. </li><li>  <code>password</code> - EAP password. </li></ul><br><p>  This might look like a block configured to connect to the network in WPA-Enterprise mode with 802.1X PEAP authentication, which requires user account information to be entered: </p><br><pre> <code class="bash hljs">network = { ssid=<span class="hljs-string"><span class="hljs-string">"Company WPA2 EAP"</span></span> key_mgmt=WPA-EAP pairwise=TKIP group=TKIP eap=PEAP identity=<span class="hljs-string"><span class="hljs-string">"username@domain"</span></span> password=<span class="hljs-string"><span class="hljs-string">"your_passphrase"</span></span> ca_cert=<span class="hljs-string"><span class="hljs-string">"/etc/cert/ca.pem"</span></span> phase1=<span class="hljs-string"><span class="hljs-string">"peapver=0"</span></span> phase2=<span class="hljs-string"><span class="hljs-string">"MSCHAPV2"</span></span> }</code> </pre> <br><p>  And this is an example of a block configured to connect to the network in WPA-Enterprise mode with 802.1X EAP-TLS authentication, which requires server and client certificates: </p><br><pre> <code class="bash hljs">network = { ssid=<span class="hljs-string"><span class="hljs-string">"Company WPA2 TLS"</span></span> key_mgmt=WPA-EAP pairwise=CCMP group=CCMP eap=TLS ca_cert=<span class="hljs-string"><span class="hljs-string">"/etc/cert/ca.pem"</span></span> private_key=<span class="hljs-string"><span class="hljs-string">"/etc/cert/privkey.p12"</span></span> private_key_passwd=<span class="hljs-string"><span class="hljs-string">"your_passphrase PKCS#12"</span></span> }</code> </pre> <br><h2>  Linking wpa_supplicant to a network map </h2><br><p>  For <strong>Gentoo Linux,</strong> add 2 lines to <code>/etc/conf.d/net</code> . </p><br><pre> <code class="hljs lisp">modules=( <span class="hljs-string"><span class="hljs-string">"wpa_supplicant"</span></span> ) wpa_supplicant_wlan0=<span class="hljs-string"><span class="hljs-string">"-Dnl80211"</span></span></code> </pre> <br><p>  List of drivers supported by <code>-D&lt;driver&gt;</code> .  For modern chips and kernel versions fit <code>nl80211</code> .  On the old gland <code>wext</code> can take off. </p><br><ul><li>  <code>nl80211</code> - New driver. </li><li>  <code>wext</code> - Linux wireless extensions (generic). </li><li>  <code>wired</code> - wpa_supplicant wired Ethernet driver. </li><li>  <code>roboswitch</code> - wpa_supplicant Broadcom switch driver. </li><li>  <code>bsd</code> - BSD 802.11 support (Atheros, etc.). </li><li>  <code>ndis</code> - Windows NDIS driver. </li></ul><br><p>  The <code>wlan0</code> network card must be linked to <code>lo0</code> . </p><br><pre> <code class="hljs dos">lrwxrwxrwx <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">6</span></span>  <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">2014</span></span> /etc/init.d/<span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.wlan0 -&gt; <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.lo</code> </pre> <br><p>  You should also add <em>wpa_supplicant</em> to autorun. </p><br><pre> <code class="hljs cs"> [<span class="hljs-meta"><span class="hljs-meta">root@home ~</span></span>]$ rc-update <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> wpa_supplicant <span class="hljs-keyword"><span class="hljs-keyword">default</span></span></code> </pre> <br><p>  <strong>Debian</strong> users add an entry to the <code>/etc/network/interfaces</code> file. </p><br><pre> <code class="bash hljs">auto wlan0 iface wlan0 inet dhcp wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf</code> </pre> <br><p>  <strong>RedHat</strong> users add to <code>/etc/sysconfig/wpa_supplicant</code> </p><br><pre> <code class="hljs objectivec">INTERFACES=<span class="hljs-string"><span class="hljs-string">"-iwlan0"</span></span></code> </pre> <br><p>  and in <code>/etc/sysconfig/network-scripts/ifcfg-wlan0</code> </p><br><pre> <code class="bash hljs">ESSID=<span class="hljs-string"><span class="hljs-string">"home"</span></span> NAME=wlan0 MODE=Managed KEY_MGMT=WPA-PSK TYPE=Wireless BOOTPROTO=dhcp DEFROUTE=yes ONBOOT=yes HWADDR=aa:bb:cc:dd:ee IPV6INIT=yes IPV6_AUTOCONF=yes</code> </pre> <br><h2>  Debugging </h2><br><p>  After <em>wpa_supplicant has</em> successfully connected to the access point, you can see the connection setup protocol in <code>dmesg</code> . </p><br><pre> <code class="diff hljs">[243960.587] cfg80211: World regulatory domain updated: [243960.587] cfg80211: DFS Master region: unset [243960.587] cfg80211: (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp), (dfs_cac_time) [243960.587] cfg80211: (2402000 KHz - 2472000 KHz @ 40000 KHz), (N/A, 2000 mBm), (N/A) [243960.587] cfg80211: (2457000 KHz - 2482000 KHz @ 20000 KHz, 92000 KHz AUTO), (2000 mBm), (N/A) [243960.587] cfg80211: (2474000 KHz - 2494000 KHz @ 20000 KHz), (N/A, 2000 mBm), (N/A) [243960.587] cfg80211: (5170000 KHz - 5250000 KHz @ 80000 KHz, 160000 KHz AUTO), (2000 mBm), (N/A) [243960.587] cfg80211: (5250000 KHz - 5330000 KHz @ 80000 KHz, 160000 KHz AUTO), (2000 mBm), (0 s) [243960.587] cfg80211: (5490000 KHz - 5730000 KHz @ 160000 KHz), (N/A, 2000 mBm), (0 s) [243960.587] cfg80211: (5735000 KHz - 5835000 KHz @ 80000 KHz), (N/A, 2000 mBm), [243960.587] cfg80211: (57240000 KHz - 63720000 KHz @ 2160000 KHz), (N/A, 0 mBm), [243963.070] wlan0: authenticate with aa:bb:cc:dd:ee [243963.075] wlan0: send auth to aa:bb:cc:dd:ee (try 1/3) [243963.077] wlan0: authenticated [243963.084] wlan0: associate with aa:bb:cc:dd:ee (try 1/3) [243963.088] wlan0: RX AssocResp from aa:bb:cc:dd:ee (capab=0x411 status=0 aid=3) [243963.090] wlan0: associated</code> </pre> <br><p>  If instead you see an error: </p><br><pre> <code class="hljs pgsql">Successfully initialized wpa_supplicant nl80211: Driver does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> support authentication/association <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> commands wlan0: Failed <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> initialize driver interface</code> </pre> <br><p>  you probably need to use the <code>wext</code> driver instead of <code>nl80211</code> .  And with an error: </p><br><pre> <code class="hljs pgsql">WEXT: Driver did <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> support SIOCSIWAUTH <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> AUTH_ALG, trying SIOCSIWENCODE</code> </pre> <br><p>  on the contrary, instead of <code>wext</code> it is necessary to substitute <code>nl80211</code> . <br>  In a situation where you cannot determine the error, run <em>wpa_supllicant</em> directly with the <code>-dd</code> . </p><br><pre> <code class="hljs swift">[root@home ~]$ wpa_supplicant -<span class="hljs-type"><span class="hljs-type">Dnl80211</span></span> -iwlan0 -<span class="hljs-type"><span class="hljs-type">C</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/run/wpa_supplicant/ -<span class="hljs-built_in"><span class="hljs-built_in">c</span></span>/etc/wpa_supplicant/wpa_supplicant.conf -dd</code> </pre> <br><h3>  Used materials </h3><br><ul><li>  <a href="http://processors.wiki.ti.com/index.php/WL18xx_Linux_Wireless_Architecture">WL18XX Linux WIreless Architecture</a> </li><li>  <a href="https://wireless.wiki.kernel.org/">Linux Kernel Wireless</a> </li><li>  <a href="http://www.ilmostro.info/2014/12/wpasupplicant-and-wifi-in-rhel-7.html">wpa_supplicant and wifi in RHEL 7</a> </li><li>  <a href="http://w1.fi/wpa_supplicant/">Linux WPA Supplicant (IEEE 802.1X, WPA, WPA2, RSN, IEEE 802.11i)</a> </li></ul><br><hr><br><ol><li><a name="cite_ref-1"></a>  <a href="https://habr.com/ru/post/315960/">‚Üë</a> 4-way handshake <br></li><li><a name="cite_ref-1"></a>  <a href="https://habr.com/ru/post/315960/">‚Üë</a> Unicast and broadcast <br></li></ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/315960/">https://habr.com/ru/post/315960/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../315950/index.html">Spine animation, tips and tricks, pseudo 3D effect</a></li>
<li><a href="../315952/index.html">Transferring passwords between Vivaldi browsers</a></li>
<li><a href="../315954/index.html">CTFzone write-ups - First comes Forensics</a></li>
<li><a href="../315956/index.html">Intersystems DeepSee. Easy and fast data visualization</a></li>
<li><a href="../315958/index.html">How MTS using a solar-powered repeater launched 3G and LTE in the mountains</a></li>
<li><a href="../315962/index.html">The release of CLion 2016.3: improved support for C11, C ++ 11 and C ++ 14, changes in working with the CMake design model and much more</a></li>
<li><a href="../315964/index.html">About types of used routers on MSK-IX and W-IX</a></li>
<li><a href="../315966/index.html">Create a simple VR demo with the Unreal Engine</a></li>
<li><a href="../315968/index.html">How we made a bot for the bank "Opening"</a></li>
<li><a href="../315970/index.html">The technique of total prescale in the lighting algorithm for a 2D 2D tile game</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>