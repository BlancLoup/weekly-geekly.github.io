<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic configuration of virtual machines in the clouds using metadata</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In God we trust, the rest we automate 
 - unknown DevOps Engineer 


 The use of virtualization and cloud platforms allows to reduce the time spent on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic configuration of virtual machines in the clouds using metadata</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/726/7bf/671/7267bf6719e6189ef09f649bd808c32f.jpg"><br><blockquote>  In God we trust, the rest we automate <br>  - unknown DevOps Engineer </blockquote><br><p>  The use of virtualization and cloud platforms allows to reduce the time spent on launching and maintaining the IT infrastructure tenfold.  One person can manipulate tens, hundreds and even thousands of virtual servers, easily start, stop, clone them, change the hardware configuration and create ready-made images of systems based on them.  If all your servers have the same configuration, then there are no special problems; you can manually configure the server once, make an image based on it and run as many machines as you need.  If you have a large number of different operating systems with a different set of software, or if you need to quickly start and stop complex cluster configurations, then servicing even a few dozen of such servers will take a very long time.  You can, of course, have a set of different scripts and images for all occasions that need to be maintained and updated, but it is more efficient to use one script and several images, and transfer all the necessary parameters at system start.  Many cloud computing platforms offer a so-called metadata mechanism (metadata) or user data (user-data), using this mechanism, you can transfer to the script all the necessary data on setting up a specific virtual machine, or even transfer the script itself so that it runs when start up </p><br><a name="habracut"></a><br>  To some extent, the following cloud platforms will be considered in this article: <br><ul><li>  Amazon EC2 </li><li>  Eucalyptus </li><li>  Nimbula Director </li><li>  VMWare vCloud Director </li></ul><br><br>  <b>1. Overview of how user data works for different platforms and examples of their use through CLI or simple scripts</b> <br><br>  <b>1.1 Amazon EC2</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In Amzon, the user-data parameter can be set in free form when the virtual machine is started and then it can be obtained via a specific link: <br><br>  <i><b>curl <a href="http://169.254.169.254/latest/user-data">169.254.169.254/latest/user-data</a></b></i> <br><br>  The IP address 169.254.169.254 is virtual and all requests to it are redirected to the internal API EC2 of the service in accordance with the IP address of the source. <br><br>  Standard system images provided by Amazon have a built-in ability to execute Bash and Power Shell scripts transmitted via user-data.  If user-data starts with shebang (#!), Then the system will try to execute the script using the interpreter specified in it.  Initially, this feature was implemented in a separate package of cloud init for Ubuntu, but now it is included in all standard system images, including Windows. <br><br>  For Windows systems, you can specify how to execute normal console commands, <br><br><pre><code class="cs hljs">&lt;script&gt; netsh advfirewall <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> allprofiles state off &lt;/script&gt;</code> </pre> <br><br>  and the code on the Power Shell: <br><br><pre> <code class="cs hljs">&lt;powershell&gt; $source = <span class="hljs-string"><span class="hljs-string">"http://www.example.com/myserverconfig.xml"</span></span> $destination = <span class="hljs-string"><span class="hljs-string">"c:\myapp\myserverconfig.xml"</span></span> $wc = New-Object System.Net.WebClient $wc.DownloadFile($source, $destination) &lt;/powershell&gt;</code> </pre><br><br>  This functionality can be used in conjunction with Cloud Formation templates and run entire server stacks by specifying the necessary user-data: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"AWSTemplateFormatVersion"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010-09-09"</span></span>, <span class="hljs-string"><span class="hljs-string">"Parameters"</span></span> : { <span class="hljs-string"><span class="hljs-string">"AvailabilityZone"</span></span> : { <span class="hljs-string"><span class="hljs-string">"Description"</span></span> : <span class="hljs-string"><span class="hljs-string">"Name of an availability zone to create instance"</span></span>, <span class="hljs-string"><span class="hljs-string">"Default"</span></span> : <span class="hljs-string"><span class="hljs-string">"us-east-1c"</span></span>, <span class="hljs-string"><span class="hljs-string">"Type"</span></span> : <span class="hljs-string"><span class="hljs-string">"String"</span></span> }, <span class="hljs-string"><span class="hljs-string">"KeyName"</span></span> : { <span class="hljs-string"><span class="hljs-string">"Description"</span></span> : <span class="hljs-string"><span class="hljs-string">"Name of an existing EC2 KeyPair to enable SSH access to the instance"</span></span>, <span class="hljs-string"><span class="hljs-string">"Default"</span></span> : <span class="hljs-string"><span class="hljs-string">"test"</span></span>, <span class="hljs-string"><span class="hljs-string">"Type"</span></span> : <span class="hljs-string"><span class="hljs-string">"String"</span></span> }, <span class="hljs-string"><span class="hljs-string">"InstanceSecurityGroup"</span></span> : { <span class="hljs-string"><span class="hljs-string">"Description"</span></span> : <span class="hljs-string"><span class="hljs-string">"Name of an existing security group"</span></span>, <span class="hljs-string"><span class="hljs-string">"Default"</span></span> : <span class="hljs-string"><span class="hljs-string">"default"</span></span>, <span class="hljs-string"><span class="hljs-string">"Type"</span></span> : <span class="hljs-string"><span class="hljs-string">"String"</span></span> } }, <span class="hljs-string"><span class="hljs-string">"Resources"</span></span> : { <span class="hljs-string"><span class="hljs-string">"autoconftest"</span></span> : { <span class="hljs-string"><span class="hljs-string">"Type"</span></span> : <span class="hljs-string"><span class="hljs-string">"AWS::EC2::Instance"</span></span>, <span class="hljs-string"><span class="hljs-string">"Properties"</span></span> : { <span class="hljs-string"><span class="hljs-string">"AvailabilityZone"</span></span> : { <span class="hljs-string"><span class="hljs-string">"Ref"</span></span> : <span class="hljs-string"><span class="hljs-string">"AvailabilityZone"</span></span> }, <span class="hljs-string"><span class="hljs-string">"KeyName"</span></span> : { <span class="hljs-string"><span class="hljs-string">"Ref"</span></span> : <span class="hljs-string"><span class="hljs-string">"KeyName"</span></span> }, <span class="hljs-string"><span class="hljs-string">"SecurityGroups"</span></span> : [{ <span class="hljs-string"><span class="hljs-string">"Ref"</span></span> : <span class="hljs-string"><span class="hljs-string">"InstanceSecurityGroup"</span></span> }], <span class="hljs-string"><span class="hljs-string">"ImageId"</span></span> : <span class="hljs-string"><span class="hljs-string">"ami-31308xxx"</span></span>, <span class="hljs-string"><span class="hljs-string">"InstanceType"</span></span> : <span class="hljs-string"><span class="hljs-string">"t1.micro"</span></span>, <span class="hljs-string"><span class="hljs-string">"UserData"</span></span> : { <span class="hljs-string"><span class="hljs-string">"Fn::Base64"</span></span> : { <span class="hljs-string"><span class="hljs-string">"Fn::Join"</span></span> : [<span class="hljs-string"><span class="hljs-string">""</span></span>,[ <span class="hljs-string"><span class="hljs-string">"#!/bin/bash"</span></span>,<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, <span class="hljs-string"><span class="hljs-string">"instanceTag=WebServer"</span></span>,<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, <span class="hljs-string"><span class="hljs-string">"confDir=/etc/myconfig"</span></span>,<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, <span class="hljs-string"><span class="hljs-string">"mkdir $confDir"</span></span>,<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, <span class="hljs-string"><span class="hljs-string">"touch $confDir/$instanceTag"</span></span>,<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, <span class="hljs-string"><span class="hljs-string">"IPADDR=$(ifconfig eth0 | grep inet | awk '{print $2}' | cut -d ':' -f 2)"</span></span>,<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, <span class="hljs-string"><span class="hljs-string">"echo $IPADDR myhostname"</span></span>,<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, <span class="hljs-string"><span class="hljs-string">"hostname myhostname"</span></span>,<span class="hljs-string"><span class="hljs-string">"\n"</span></span> ]] } } }</code> </pre><br><br>  If the launch of the script at the start of the machine does not suit you, for example, you want other people to use your images and they do not want to understand your code, then you can install your own script in the system, add it to the autoload, and create an image of the system.  And provide image users with a description of possible parameters that can be set in user-data.  For example, the parameter list key = value separated by semicolons: <br><br>  <i>graylogserver = "192.168.1.1"; chefnodename = "chef_node_name1"; chefattributes = "recipe1.attribute1 = value1, recipe1.attribute2 = value2, customparameter1 = value1"; chefserver = "192.168.1.38 Com000"; chefrole = "apache, mysq , php ";</i> <br><br>  You can get the whole Bash line like this: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> get_userdata { user_data=$(curl -w <span class="hljs-string"><span class="hljs-string">"%{http_code}"</span></span> -s http://169.254.169.254/latest/user-data) result_code=<span class="hljs-variable"><span class="hljs-variable">${user_data:(-3)}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$user_data</span></span></span><span class="hljs-string">"</span></span> ] || [ <span class="hljs-variable"><span class="hljs-variable">$result_code</span></span> != <span class="hljs-string"><span class="hljs-string">"200"</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CurrentDate</span></span></span><span class="hljs-string">: Couldn't receive user-data. Result code: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$result_code</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 1 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> user_data=<span class="hljs-variable"><span class="hljs-variable">${user_data%%$result_code}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 0 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> }</code> </pre><br><br>  and then, from the resulting list, get the desired value: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> get_userdata_value { IFS=<span class="hljs-string"><span class="hljs-string">';'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> user_data_list <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$user_data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> user_data_name=<span class="hljs-variable"><span class="hljs-variable">${user_data_list%%=*}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-variable"><span class="hljs-variable">$user_data_name</span></span> = <span class="hljs-variable"><span class="hljs-variable">$1</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> user_data_value=<span class="hljs-variable"><span class="hljs-variable">${user_data_list#*=}</span></span> user_data_value=$(<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$user_data_value</span></span> | tr -d <span class="hljs-string"><span class="hljs-string">'\"'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 0 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 1 }</code> </pre><br><br>  After that, you can continue to configure the system in accordance with the data.  It is not necessary to store all the scripts inside the image, it is enough to have a simple startup script that reads user-data and then downloads and runs all the necessary or transfers control to Chef or Puppet. <br><br>  Similar functionality can be implemented on the Power Shell. <br><br>  <b>1.2 Eucaliptus</b> <br>  This product is compatible with Amazon AWS, and the user-data engine is implemented in the same way. <br><br>  <b>1.3 Nimbula</b> <br>  This product is relatively young, but fast-growing, it is designed to create private cloud systems and uses KVM virtualization.  Its founders come from Amazon and have declared compatibility with Amazon, but despite this, compatibility is not complete.  They have support for the user-data mechanism via virtual IP, but they are specified as key = value. <br>  A list of all keys can be obtained by reference: <br>  <i><a href="http://192.0.0.192/latest/attributes">192.0.0.192/latest/attributes</a> or <a href="http://169.254.169.254/latest/attributes">169.254.169.254/latest/attributes</a></i> <br><br>  example: <br>  <i>curl <a href="http://169.254.169.254/latest/attributes">169.254.169.254/latest/attributes</a></i> <i><br></i>  <i>nimbula_compressed_size</i> <i><br></i>  <i>nimbula_decompressed_size</i> <i><br></i>  <i>chefserver</i> <i><br></i>  <i>hostname</i> <i><br></i> <br><br>  Get the value of a concreting key: <br>  <i>curl <a href="http://169.254.169.254/latest/attributes/chefserver">169.254.169.254/latest/attributes/chefserver</a></i> <i><br></i>  <i>192.168.1.45:4000</i> <br><br>  Thus, it is impossible to transfer the whole script for execution via user-data, it is necessary to create your own image of the system with a built-in start script. <br><br>  Bash code example: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> get_value { user_data_value=$(curl curl -w <span class="hljs-string"><span class="hljs-string">"%{http_code}"</span></span> -s http://169.254.169.254/latest/attributes/<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span>) result_code=<span class="hljs-variable"><span class="hljs-variable">${user_data_value:(-3)}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$user_data_value</span></span></span><span class="hljs-string">"</span></span> ] || [ <span class="hljs-variable"><span class="hljs-variable">$result_code</span></span> != <span class="hljs-string"><span class="hljs-string">"200"</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CurrentDate</span></span></span><span class="hljs-string">: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string"> variable is not set, skip it, return code: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$result_code</span></span></span><span class="hljs-string">"</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">$LogFile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 1 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> user_data_value=<span class="hljs-variable"><span class="hljs-variable">${user_data_value%%$result_code}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 0 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> }</code> </pre><br><br>  <b>1.4 VMWare vCloud Director</b> <br>  Starting with version 1.5, vCloud Director introduced a mechanism for using metadata within the framework of vApp (container for virtual machines).  The data is given in the key = value format.  To set metadata, you need to create XML with their description: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Metadata</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.vmware.com/vcloud/v1.5"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MetadataEntry</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Key</span></span></span><span class="hljs-tag">&gt;</span></span>app-owner<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag">&gt;</span></span>Foo Bar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MetadataEntry</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MetadataEntry</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Key</span></span></span><span class="hljs-tag">&gt;</span></span>app-owner-contact<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag">&gt;</span></span>415-123-4567<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MetadataEntry</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MetadataEntry</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Key</span></span></span><span class="hljs-tag">&gt;</span></span>system-owner<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag">&gt;</span></span>John Doe<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MetadataEntry</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Metadata</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  And then perform a POST request on the URL for the corresponding vApp: <br>  <i>$ curl -i -k -H "Accept: application / * + xml; version = 1.5" -H "x-vcloud-authorization: jmw43CwPAKdQS7t / EWd0HsP0 + 9 / QFyd / 2k / USs8uZtY =" -H "Content-Type: application / vnd.vmware.vcloud.metadata + xml ‚Äù-X POST <a href="https://10.20.181.101/api/vApp/vapp-1468a37d-4ede-4cac-9385-627678b0b59f/metadata">10.20.181.101/api/vApp/vapp-1468a37d-4ede-4cac-9385-627678b0b59f/metadata</a> -d @ metadata-request.</i> <br><br>  Read all the metadata can GET request: <br>  <i>$ curl -i -k -H "application / * + xml; version = 1.5" -H "x-vcloud-authorization: jmw43CwPAKdQS7t / EWd0HsP0 + 9 / QFyd / 2k / USs8uZtY =" -X GET <a href="https://10.20.181.101/api/vApp/vapp-1468a37d-4ede-4cac-9385-627678b0b59f/metadata">10.20.181.101/api/ vApp / vapp-1468a37d-4ede-4cac-9385-627678b0b59f / metadata</a> .</i> <br><br>  In order to read the value of a specific key, the request must be of the form: <br>  <i>$ curl -i -k -H "application / * + xml; version = 1.5" -H "x-vcloud-authorization: jmw43CwPAKdQS7t / EWd0HsP0 + 9 / QFyd / 2k / USs8uZtY =" -X GET <a href="https://10.20.181.101/api/vApp/vapp-1468a37d-4ede-4cac-9385-627678b0b59f/metadata/asset-tag">10.20.181.101/api/ vApp / vapp-1468a37d-4ede-4cac-9385-627678b0b59f / metadata / asset-tag</a></i> <br><br>  The answer is in the form of XML. <br><br>  <b>Learn more about how metadata works in vCloud here</b> : <a href="http://blogs.vmware.com/vsphere/2012/03/creating-custom-metadata-using-the-vcloud-api.html">blogs vmware</a> <br><br>  <b>2. Work with user data using control systems such as: Chef and Puppet</b> <br><br>  <b>2.1 Chef</b> <br>  The choice of how the Chef client gets to the machine is yours, you can install it manually and then create your own system images, or you can install it automatically when the system starts.  Both methods have their advantages and disadvantages: the first method reduces the time spent on the configuration of the machine during the start, the second method allows you to always install the latest version of the client or install the version of the client you absolutely need, depending on your needs.  In any case, we must transfer the list of roles and recipes that must be executed on the machine; we can get this list via used-data and configure the Chef client at system startup.  Also, if we install and configure the client at system startup, we need to download the validation.pem key for the corresponding Chef server (which data can also be transferred via user-data) <br><br>  An example of a bash script that gets a list of roles: <br><br><pre> <code class="bash hljs">rolefile=<span class="hljs-string"><span class="hljs-string">"/etc/chef/role.json"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> get_role { get_value <span class="hljs-string"><span class="hljs-string">"chefrole"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ $? = 0 ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> chefrole=<span class="hljs-variable"><span class="hljs-variable">$user_data_value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CurrentDate</span></span></span><span class="hljs-string">: Couldn't get any Chef role, use base role only."</span></span> chefrole=<span class="hljs-string"><span class="hljs-string">"base"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> commas_string=<span class="hljs-variable"><span class="hljs-variable">${chefrole//[!,]/}</span></span> commas_count=<span class="hljs-variable"><span class="hljs-variable">${#commas_string}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'{ "run_list": [ '</span></span> &gt; <span class="hljs-variable"><span class="hljs-variable">$rolefile</span></span> IFS=<span class="hljs-string"><span class="hljs-string">","</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$ep_chefrole</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-variable"><span class="hljs-variable">$commas_count</span></span> = 0 ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"\"role[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$line</span></span></span><span class="hljs-string">]\" "</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">$rolefile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"\"role[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$line</span></span></span><span class="hljs-string">]\", "</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">$rolefile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> commas_count=$((<span class="hljs-variable"><span class="hljs-variable">$commas_count</span></span>-1)) <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">' ] }'</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">$rolefile</span></span> }</code> </pre><br><br>  And then creates a configuration file for the client: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> set_chef { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -d <span class="hljs-variable"><span class="hljs-variable">$chef_dir</span></span> ] &amp;&amp; [ -e <span class="hljs-variable"><span class="hljs-variable">$chef_bin</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> service <span class="hljs-variable"><span class="hljs-variable">$chef_service</span></span> stop sleep 10 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -e <span class="hljs-string"><span class="hljs-string">"chef_server_url \"http://</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">\""</span></span> &gt; <span class="hljs-variable"><span class="hljs-variable">$chef_dir</span></span>/client.rb <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -e <span class="hljs-string"><span class="hljs-string">"log_location \"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$chef_log</span></span></span><span class="hljs-string">\""</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">$chef_dir</span></span>/client.rb <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -e <span class="hljs-string"><span class="hljs-string">"json_attribs \"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$rolefile</span></span></span><span class="hljs-string">\""</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">$chef_dir</span></span>/client.rb <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -e <span class="hljs-string"><span class="hljs-string">"interval </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$chef_interval</span></span></span><span class="hljs-string">"</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">$chef_dir</span></span>/client.rb <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CurrentDate</span></span></span><span class="hljs-string">: Writing </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$chef_dir</span></span></span><span class="hljs-string">/client.rb"</span></span> service <span class="hljs-variable"><span class="hljs-variable">$chef_service</span></span> start <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CurrentDate</span></span></span><span class="hljs-string">: Chef directory </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$chef_dir</span></span></span><span class="hljs-string"> or chef binary </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$chef_bin</span></span></span><span class="hljs-string"> does not exist. Exit."</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> }</code> </pre><br><br>  The json_attributes parameter sets the path to the JSON file with a list of roles and recipes. <br><br>  After we have handed over the control to Chef to the client, he will register on the server, download the list of recipes and start their execution, <b>but there are a few nuances</b> : <br><ul><li>  Some recipes can take a long time to complete, we need to know when the system configuration will end and how it ended successfully or not. </li><li>  what if we don‚Äôt want to execute recipes with attributes by default, but want to change some attributes, for example, we want to set LAMP, but so that Apache works on port 8080, not 80 </li></ul><br><br>  To solve the first problem, there is an Opscode cookbook called chef_handler.  It provides a mechanism called Exception and Report Handlers, which is called after the Chef client has finished executing the recipes.  Using this cookbook, we can check the result of the last client run and perform any actions.  You can send an email about the execution results ( <a href="http://wiki.opscode.com/display/chef/Exception%2Band%2BReport%2BHandlers">an example described in the Opscode documentation</a> ) or write the execution result to the Chef server to check this value with your applications and display the execution status. <br><br>  Sample recipe: <br><br>  set attribute values ‚Äã‚Äãto default <br><pre> <code class="ruby hljs">default[<span class="hljs-string"><span class="hljs-string">'lastrun'</span></span>][<span class="hljs-string"><span class="hljs-string">'state'</span></span>] = <span class="hljs-string"><span class="hljs-string">"unknown"</span></span> default[<span class="hljs-string"><span class="hljs-string">'lastrun'</span></span>][<span class="hljs-string"><span class="hljs-string">'backtrace'</span></span>] = <span class="hljs-string"><span class="hljs-string">"none"</span></span></code> </pre><br><br>  indicate that you need to perform <br><pre> <code class="ruby hljs">include_recipe <span class="hljs-string"><span class="hljs-string">"chef_handler"</span></span> chef_handler <span class="hljs-string"><span class="hljs-string">"NodeReportHandler::LastRun"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> source <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{node.chef_handler.handler_path}</span></span></span><span class="hljs-string">/nodereport.rb"</span></span> action <span class="hljs-symbol"><span class="hljs-symbol">:nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.run_action(<span class="hljs-symbol"><span class="hljs-symbol">:enable</span></span>)</code> </pre><br><br>  what we are doing <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeReportHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LastRun</span></span></span><span class="hljs-class"> &lt; Chef::Handler </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">report</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">success?</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">then</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">node</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">override</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lastrun</span></span></span><span class="hljs-class">][:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">state</span></span></span><span class="hljs-class">] = "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">successful</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">node</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">override</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lastrun</span></span></span><span class="hljs-class">][:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">backtrace</span></span></span><span class="hljs-class">] = "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">none</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">else</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">node</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">override</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lastrun</span></span></span><span class="hljs-class">][:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">state</span></span></span><span class="hljs-class">] = "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">failed</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">node</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">override</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lastrun</span></span></span><span class="hljs-class">][:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">backtrace</span></span></span><span class="hljs-class">] = "</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#{run_status.formatted_exception}" end node.save end end end</span></span></span></span></code> </pre><br><br>  As a result, we initially set the values ‚Äã‚Äãof the lastrun.state and lastrun.backtrace attributes to both 'unknown' and 'none' and then, according to the results of the client‚Äôs execution, we get either the record 'successfull' or 'failed' with a description of the error in lastrun. backtrace. <br>  This recipe should be on the run list first to cover errors when executing any recipes. <br><br>  In order to change the default attributes, we have to get them somehow, then save them and then start performing recipes.  We can get them again, through user-data. <br><br>  The recipe for getting user-data, on the example of Amazon: <br>  we get the whole line <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># Get whole user-data string def GetUserData(url) uri = URI.parse(url) http = Net::HTTP.new(uri.host, uri.port) http.open_timeout = 5 http.read_timeout = 5 proto = url.split(":", 2) if proto[0] == "https" http.use_ssl = true http.verify_mode = OpenSSL::SSL::VERIFY_NONE end request = Net::HTTP::Get.new(uri.request_uri) begin http.open_timeout = 5 http.read_timeout = 5 request = Net::HTTP::Get.new(uri.request_uri) response = http.request(request) result = response.body.to_s if response.is_a?(Net::HTTPSuccess) Chef::Log.info("Successfuly get user-data.") return result else return false end rescue Exception =&gt; e Chef::Log.info("HTTP request failed.") return false end end</span></span></code> </pre><br><br>  we get the value of a specific parameter <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># Get specified user-data value def GetValue(user_data,attribute) user_data.split(";").each do |i| attribute_name=i.split("=", 2) if attribute_name[0] == attribute return attribute_name[1].strip end end return false end</span></span></code> </pre><br>  Now, when we can get the value for a specific parameter from the transmitted data, we can set them: <br>  <i>hefnodename = "chef_node_name1"; chefattributes = "recipe1.attribute1 = value1, recipe1.attribute2 = value2, customparameter1 = value1"; chefserver = "192.168.1.38 Tet000"; chefrole = "apache, mysql, php"</i> <br><br>  In the chefattributes parameter we passed a list of attributes that we want to change, they are specified in the format ‚Äúcookbookname.attributename = value‚Äù.  If we want to change the default port for Apache, we need to set chefattributes = apache.port = 8080. <br><br>  A recipe that reads this value and saves it: <br><pre> <code class="ruby hljs">chefattributes = GetValue(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{node[</span></span><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-symbol">:user_data</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">"</span></span>,<span class="hljs-string"><span class="hljs-string">"chefattributes"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> chefattributes != <span class="hljs-literal"><span class="hljs-literal">false</span></span> hefattributes.split(<span class="hljs-string"><span class="hljs-string">","</span></span>).each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|i|</span></span> attribute_name=i.split(<span class="hljs-string"><span class="hljs-string">"="</span></span>) recipe_name=attribute_name[<span class="hljs-number"><span class="hljs-number">0</span></span>].split(<span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) node.override[<span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"</span></span><span class="hljs-subst"><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst">#{recipe_name[</span></span></span><span class="hljs-number"><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst">]}</span></span></span></span><span class="hljs-symbol"><span class="hljs-string">"</span></span></span></span>][<span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"</span></span><span class="hljs-subst"><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst">#{recipe_name[</span></span></span><span class="hljs-number"><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst">].strip}</span></span></span></span><span class="hljs-symbol"><span class="hljs-string">"</span></span></span></span>]=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{attribute_name[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">].strip}</span></span></span><span class="hljs-string">"</span></span> Chef::Log.info(<span class="hljs-string"><span class="hljs-string">"Save node attributes."</span></span>) node.save <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Chef::Log.info(<span class="hljs-string"><span class="hljs-string">"Couldn't get Chef attributes. Skip."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  This recipe must be performed before performing other recipes. <br><br>  <b>The disadvantages of the above recipes.</b>  The node.save operation sends to the server to save the entire JSON array for a particular node, including information collected by Ohai.  If you have thousands of machines and all of them will constantly try to overwrite their attributes on the server, this may have a bad effect on its performance.  The same applies to the use of flexible and powerful search provided by Chef, the search operation is very time consuming and in the case of servicing thousands of machines, this will create a heavy load on the server.  In this case, you need to use other methods that will not be described here. <br><br>  <b>2.2 Puppet</b> <br>  Using Puppet to get user-data is similar to using Chef.  The address of the Puppet server and other necessary data for configuring the agent are obtained using the start script.  To transfer your facts to the server it is convenient to use the Facter add-on. <br><br>  Here is an example of a ruby ‚Äã‚Äãscript that receives the necessary data from user-data and sends it to the server as additional facts for this machine: <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'facter'</span></span> user_data = <span class="hljs-string"><span class="hljs-string">`curl http://169.254.169.254/latest/user-data`</span></span> user_data = user_data.split(<span class="hljs-string"><span class="hljs-string">";"</span></span>) user_data.each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|line|</span></span> user_data_key_value = line.split(<span class="hljs-string"><span class="hljs-string">'='</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) user_data_key = user_data_key_value[<span class="hljs-number"><span class="hljs-number">0</span></span>] user_data_value = user_data_key_value[<span class="hljs-number"><span class="hljs-number">1</span></span>] Facter.add(user_data_key) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> setcode { user_data_value } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> instance_id = <span class="hljs-string"><span class="hljs-string">`curl http://169.254.169.254/latest/meta-data/instance-id`</span></span> Facter.add(<span class="hljs-string"><span class="hljs-string">'instance-id'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> setcode { instance_id } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  Of course, it may seem that this is all simple, and there is no need to fiddle around with any complex schemes, you can create the necessary set of images with the pre-installed software, and carry out all the changes with your own scripts that run on SSH and stink changes to the configuration files.  This article describes the elementary steps.  If we need to start a Hadoop cluster, MySQL or a cluster from Front-End, Back-End, App, DB servers, so that all machines are automatically configured and that you can dynamically delete or add an arbitrary number of machines to the cluster during automatic scaling, without the techniques described above. not enough. <br><br>  If you know how to transfer metadata for other cloud platforms and know other ways to manage the configuration of a virtual machine at startup, let's discuss in the comments. </div><p>Source: <a href="https://habr.com/ru/post/166639/">https://habr.com/ru/post/166639/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../166627/index.html">We put into practice the knowledge gained in the course An course to Interactive Programming in Python (coursera.org)</a></li>
<li><a href="../166629/index.html">Interview with developers of Windows 8 and Windows Phone applications</a></li>
<li><a href="../166631/index.html">Zend Framework: XSL and Self Serialization Views</a></li>
<li><a href="../166633/index.html">Performance Comparison: curl, php curl, php socket, python pycurl</a></li>
<li><a href="../166637/index.html">Instructions for forwarding ports on Juniper SRX</a></li>
<li><a href="../166641/index.html">Store ID in Cookie</a></li>
<li><a href="../166643/index.html">[Translation] What happened when Facebook blocked my account</a></li>
<li><a href="../166645/index.html">Small useful things. How to make access from nagios / icinga to the host management interface through Google Chrome and MS IE browsers</a></li>
<li><a href="../166647/index.html">Adding your functionality to UMI.CMS using event handlers</a></li>
<li><a href="../166649/index.html">As I digitalized the film, and not only</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>