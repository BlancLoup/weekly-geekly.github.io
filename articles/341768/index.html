<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An easy-to-use status container for a Restore application called Xstore.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dear colleagues, I present to your attention and your conviction a container for managing the state of React of the xstore application. He is definite...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An easy-to-use status container for a Restore application called Xstore.</h1><div class="post__text post__text-html js-mediator-article"><p>  Dear colleagues, I present to your attention and your conviction a container for managing the state of React of the <strong>xstore</strong> application.  He is definitely such a small children's bike next to the big and glittering Redux motorcycle.  We all JavaScript programmers are such a big and fast-paced bicycle factory. </p><br><p>  For more or less, just beginning or starting your acquaintance with React JavaScript Redux programmers may seem like a somewhat complicated thing, which is sometimes incomprehensible how it works and which is difficult to "connect", you want something simpler, something like this small bike. </p><br><p>  Let's take a closer look at it. </p><br><h2 id="ustanovka">  Installation </h2><br><pre><code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> <span class="hljs-comment"><span class="hljs-comment">--save xstore</span></span></code> </pre> <a name="habracut"></a><br><h2 id="ispolzovanie">  Using </h2><br><p>  First we need to add "handlers" to the repository. <br>  (An example handler is presented in the block below) </p><br><p>  <em>index.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Store <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'xstore'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/App'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> user <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./store_handlers/user'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> dictionary <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./store_handlers/dictionary'</span></span> <span class="hljs-comment"><span class="hljs-comment">//       "_". //       : user  dictionary. Store.addHandlers({ user, dictionary }); ReactDOM.render( &lt;App/&gt;, document.getElementById('root') );</span></span></code> </pre> <br><p>  The following is an example of the "user" handler. <br>  It contains the "init" reducer, which is needed to determine the initial state of the "user" storage. </p><br><p>  <em>./store_handlers/user.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> axios <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'axios'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DEFAULT_STATE = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'user'</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'alive'</span></span> } <span class="hljs-comment"><span class="hljs-comment">/** =============== Reducers =============== */</span></span> <span class="hljs-comment"><span class="hljs-comment">//       . //     ,     . //   ,     . //    this.props.dispatch('USER_INIT'). const init = () =&gt; { return DEFAULT_STATE; } // this.props.dispatch('USER_CHANGED', {name: 'NewName'}) const changed = (state, data) =&gt; { return { ...state, ...data } } /** =============== Actions =============== */ // this.props.doAction('USER_CHANGE', {data}) const change = ({dispatch}, data) =&gt; { // {dispatch, doAction, getState, state} dispatch('USER_CHANGED', data); } // this.props.doAction('USER_LOAD', {id: userId}) const load = ({dispatch}, data) =&gt; { // {dispatch, doAction, getState, state} axios.get('/api/load.php', data) .then(({data}) =&gt; { dispatch('USER_CHANGED', data); }); } //          export default { actions: { load, change // remove, save, add_item, remove_this_extra_item, ..... }, reducers: { init, changed // removed, saved, item_added, this_extra_item_removed, ..... } }</span></span></code> </pre> <br><p>  The following is an example of how to connect a component to the repository. </p><br><p>  <em>./components/ComponentToConnect/index.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Store <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'xstore'</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ComponentToConnect</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-comment"><span class="hljs-comment">//  user  dictionary    . let {user, dictionary} = this.props; return ( &lt;div className="some-component"&gt; .... &lt;/div&gt; ) } loadUser(userId) { //    . this.props.doAction('USER_LOAD', {id: userId}); } setUser(userData) { //    . //         . this.props.dispatch('USER_CHANGED', userData); } } //    . const params = { has: 'user, dictionary' } export default Store.connect(ComponentToConnect, params);</span></span></code> </pre> <br><p>  Possible options "params" to connect: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-comment"><span class="hljs-comment">//  ,     : has: 'user, dictionary', //  -: has: ['user', 'dictionary'], //       : has: 'user:name|status, dictionary:userStatuses', //  has: ['user:name|status', 'dictionary:userStatuses'], //      ,    . shouldHave: 'user,dictionary', //  shouldHave: ['user', 'dictionary'], //         ,   true. //      "name", "status", "userStatuses"  "user"  "dictionary" flat: true, // ,      ,    flat = true. //      "user_name", "user_status", "dictionary_userStatuses" withPrefix: true, //      . //       ,  "has"   . handlers: { user, dictionary } }</span></span></code> </pre> <br><p>  List of public repository methods: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Store <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'xstore'</span></span> <span class="hljs-comment"><span class="hljs-comment">//         : let state = Store.getState(); //         "user": let userState = Store.getState('user'); //   "name"   "user": let userName = Store.getState('user.name'); //     0   "items"   "user": let someItem = Store.getState('user.items.0'); //  : Store.addHandlers({ user: userHandler, dictionary: dictionaryHandler }) //   "load"  "user": //       ,      . Store.doAction('USER_LOAD', {id: userId}); //   "loaded"  "user": Store.dispatch('USER_LOADED', data); //     : Store.connect(Component, params);</span></span></code> </pre><br><h3 id="a-teper-o-tom-kak-eto-rabotaet">  And now about how it works: </h3><br><p>  The "connect" method creates a new HOC class XStoreConnect, which hides in itself all the logic of interaction between the component and the repository.  This class subscribes to changes to the repository and, when there are any changes, it calls the setState method protected from outside calls (for example, through this.refs.xStoreConnect.setState (...)), after which this component is redrawn, thereby updating props wrapped component. <br>  Directly changing the state of the wrapper component this.refs.xStoreConnect.state = something also does not lead to anything, this class can detect embedded data and delete it. </p><br><div class="spoiler">  <b class="spoiler_title">Wrapper component code</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ....      const LOCAL_OBJECT_CHECKER = {}; const connect = (ComponentToConnect, connectProps) =&gt; { let ready = false; let { has, handlers, shouldHave: shouldHaveString, flat, withPrefix } = connectProps; if (!has &amp;&amp; handlers instanceof Object) { has = Object.keys(handlers); } let shouldHave = []; if (typeof shouldHaveString == 'string') { shouldHaveString = shouldHaveString.split(','); for (let item of shouldHaveString) { if (item) { shouldHave.push(item.trim()); } } } let doUnsubscribe, doCleanState, stateItemsQuantity; return class XStoreConnect extends React.Component { constructor() { super(); const updater = (state) =&gt; { stateItemsQuantity = Object.keys(state).length; if (ready) { this.setState(state, LOCAL_OBJECT_CHECKER); } else { this.state = state; } } doUnsubscribe = () =&gt; { unsubscribe(updater); } doCleanState = () =&gt; { cleanStateFromInjectedItems(updater, this.state); } subscribe(updater, {has, handlers, flat, withPrefix}); } setState(state, localObjectChecker) { if (state instanceof Object &amp;&amp; localObjectChecker === LOCAL_OBJECT_CHECKER) { super.setState(state); } } componentWillMount() { ready = true; } componentWillUnmount() { ready = false; doUnsubscribe(); } render() { let {props, state} = this; let newStateKeysQuantity = Object.keys(state).length; if (stateItemsQuantity != newStateKeysQuantity) { doCleanState(); } for (let item of shouldHave) { if (state[item] === undefined) { return null; } } let componentProps = { ...props, ...state, doAction, dispatch }; return &lt;ComponentToConnect {...componentProps}/&gt; } } }</span></span></code> </pre></div></div><br><h2 id="generaciya-faylov-obrabotchikov-iz-komandnoy-stroki">  Generating handler files from the command line: </h2><br><pre> <code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> -g xstore xstore <span class="hljs-keyword"><span class="hljs-keyword">create</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> filename</code> </pre> <br><p>  You can also register in "scripts" in "package.json": </p><br><pre> <code class="hljs css">{ <span class="hljs-attribute"><span class="hljs-attribute">scripts</span></span>: { <span class="hljs-string"><span class="hljs-string">"create-handler"</span></span>: <span class="hljs-string"><span class="hljs-string">"node node_modules/xstore/bin/exec.js"</span></span> } } <span class="hljs-selector-tag"><span class="hljs-selector-tag">npm</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">run</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">create-handler</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">filename</span></span></code> </pre> <br><p>  This command will create a file filename.js (if it does not exist) with a template handler code. </p><br><p>  That's all, quite simply right?  And now you can kick.  I will be glad to advice and reasonable criticism, dear colleagues. <br></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/341768/">https://habr.com/ru/post/341768/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341752/index.html">How I found vulnerabilities in Google's bug tracking system and got $ 15,600</a></li>
<li><a href="../341756/index.html">Unreal Engine: QuickStart in Qt Creator under Arch Linux</a></li>
<li><a href="../341760/index.html">Infrastructure with Kubernetes as an affordable service</a></li>
<li><a href="../341764/index.html">Linux package managers almanac</a></li>
<li><a href="../341766/index.html">How I learned to directly reboot into the correct OS via UEFI</a></li>
<li><a href="../341772/index.html">Is it time to save the web?</a></li>
<li><a href="../341774/index.html">Analysis of robots.txt files of the largest sites</a></li>
<li><a href="../341776/index.html">RailsClub 2017. Materials</a></li>
<li><a href="../341778/index.html">How to incorrectly test the performance of NoSQL DB in Amazon</a></li>
<li><a href="../341782/index.html">Let's look into the future: how will the storage infrastructure change?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>