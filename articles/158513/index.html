<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ExtJS: an easy way to multiboot and validate files (using the HTML5 File API)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you need to validate user-uploaded files not only on the server, but also on the client, or you want to allow the user to select several files to l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ExtJS: an easy way to multiboot and validate files (using the HTML5 File API)</h1><div class="post__text post__text-html js-mediator-article">  If you need to validate user-uploaded files not only on the server, but also on the client, or you want to allow the user to select several files to load at once (multiple = "multiple"), then most likely you will encounter some difficulties when using Ext.form .field .File. <br><br><h4>  The essence of the problem </h4><br>  Checking the extension of the file being downloaded, if the user has selected only one file, is not difficult - simply declare vtype and see the value input-a: <br><br><pre><code class="javascript hljs">Ext.apply(Ext.form.field.VTypes, { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val, field</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> types = [<span class="hljs-string"><span class="hljs-string">'rtf'</span></span>, <span class="hljs-string"><span class="hljs-string">'pdf'</span></span>, <span class="hljs-string"><span class="hljs-string">'doc'</span></span>], ext = val.substring(val.lastIndexOf(<span class="hljs-string"><span class="hljs-string">'.'</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Ext.Array.indexOf(types, ext) === <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } ,<span class="hljs-attr"><span class="hljs-attr">fileText</span></span>: <span class="hljs-string"><span class="hljs-string">'Invalid file'</span></span> });</code> </pre> <br><a name="habracut"></a><br>  Problems begin when there are several files, and / or you need to check the ‚Äúweight‚Äù of the file.  The thing is that in the code above, the field refers not to the input in which the selected files are located, but to the table in which the input lies. <br>  Getting to the input itself is easy enough: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> input = Ext.get(field.id+<span class="hljs-string"><span class="hljs-string">'-fileInputEl'</span></span>); -      input.files.</code> </pre><br>  If it is not clear for someone, the line above on vanilla.js will sound like this: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> input = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(field.id+<span class="hljs-string"><span class="hljs-string">'-fileInputEl'</span></span>);</code> </pre><br>  Probably vanilla would even save a few matches, but I don‚Äôt really like when porridge starts, and my body doesn‚Äôt feel the difference in work. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If there is only one file, and you are not against using non-native input file loading, then the problem is solved (you can say it wasn‚Äôt) - we get the file upload field and validate the file weight using the File API.  Otherwise - some problems remain: <br><br>  1. When selecting several files (after some manipulations), the field on the form will show you only the first selected file. <br>  2. If you want native input, its size attribute will be 1, after setting inputType: 'file' in the field configuration, and setting the size: 50 property will not help you. <br><br>  Regarding the use of native browser elements, there is no desire to hollify on this topic - I just prefer to use them if the element has any behavior and if there is such a possibility.  It's just that this is more familiar to the user - he knows what to expect from this thing. <br><br>  Although, if we digress a little from the topic, when FF in one of the recent updates adopted the Chrome-style attribute of the placeholder attribute (the text ceased to disappear with the focus on the field) - it slightly jarred me.  I do not understand the advantages of this behavior - I always want to erase this text before entering. <br><br><h4>  Decision </h4><br><br>  If you google, the Internet, in most cases, will advise you to validate files only on the server, or use flash.  If you want and can - you can do so.  I also saw <a href="http://www.sencha.com/forum/showthread.php%3F243051-ExtJs-4-Multiple-File-Upload">ux</a> , which can load many files and validate them - may also be an option. <br><br>  And you can get by with just a few lines, and use the File API.  At the same time, all IEs are falling off for us, but personally I don‚Äôt have much experience with this - the download option still remains, but I still validate it on the server.  In addition, if you use ext and write a more or less complex application, then, most likely, you can dictate browsers to the end user. <br><br>  We proceed in the following way - inherit from textfield, set inputType: 'file' to it, let us set size and input multiple in the configuration.  Assign alias to this case for short access (xtype).  The validation rules are described by vtype.  All this will allow you to use the field with the desired behavior many times in any application view, and flexibly configure it (for example, specify the allowed file types and their maximum size). <br><br><h5>  We describe the field: </h5><br><pre> <code class="javascript hljs"> Ext.define(<span class="hljs-string"><span class="hljs-string">'fileupload'</span></span>,{ <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-string"><span class="hljs-string">'Ext.form.field.Text'</span></span> ,<span class="hljs-attr"><span class="hljs-attr">alias</span></span>: <span class="hljs-string"><span class="hljs-string">'widget.fileupload'</span></span> <span class="hljs-comment"><span class="hljs-comment">//     xtype: 'fileupload' ,inputType: 'file' ,listeners: { render: function (me, eOpts) { var el = Ext.get(me.id+'-inputEl'); el.set({ size: me.inputSize || 1 }); if(me.multiple) { el.set({ multiple: 'multiple' }); } } } });</span></span></code> </pre><br>  I don‚Äôt even know if something needs clarification.  If, in a nutshell, after the ‚Äúdrawing‚Äù of a native input, the size attribute is set (set in the configuration or defaulted to 1) and the multiple attribute if it is set in the configuration.  Thus, we now have a native configurable input. <br><br><h5>  We describe the validator: </h5><br><pre> <code class="javascript hljs"> Ext.apply(Ext.form.field.VTypes, { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val, field</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> input, files, file ,acceptSize = field.acceptSize || <span class="hljs-number"><span class="hljs-number">4096</span></span> <span class="hljs-comment"><span class="hljs-comment">//    ,acceptMimes = field.acceptMimes || ['rtf', 'pdf', 'doc', 'xls', 'xlsx', 'zip', 'rar']; //   input = Ext.get(field.id+'-inputEl'); files = input.getAttribute('files'); if ( ! files || ! window.FileReader) { return true; //      .      false } for(var i = 0, l = files.length; i &lt; l; i++) { //    file = files[i]; if(file.size &gt; acceptSize * 1024) { this.fileText = (file.size / 1048576).toFixed(1) + ' MB: invalid file size ('+(acceptSize / 1024).toFixed(1)+' MB max)'; return false; } var ext = file.name.substring(file.name.lastIndexOf('.') + 1); if(Ext.Array.indexOf(acceptMimes, ext) === -1) { //    this.fileText = 'Invalid file type ('+ext+')'; return false; } } return true; } });</span></span></code> </pre><br>  Here, I think, everything is also quite clear.  Just set the default file types / size, get input and run through its files - check their type / size.  Everything is very simple. <br><br>  Now we can load and validate files, describing the form field as follows: <br><pre> <code class="javascript hljs"> { <span class="hljs-attr"><span class="hljs-attr">xtype</span></span>: <span class="hljs-string"><span class="hljs-string">'fileupload'</span></span> ,<span class="hljs-attr"><span class="hljs-attr">vtype</span></span>: <span class="hljs-string"><span class="hljs-string">'file'</span></span> ,<span class="hljs-attr"><span class="hljs-attr">multiple</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-comment"><span class="hljs-comment">//     ,acceptMimes: ['doc', 'xls', 'xlsx', 'pdf', 'zip', 'rar'] //    ,acceptSize: 2048 //   ,inputSize: 76 //  size ,fieldLabel: 'File &lt;span class="gray"&gt;(doc, xls, xlsx, pdf, zip, rar; 2 MB max)&lt;/span&gt;' ,msgTarget: 'under' ,name: 'filesToUpload[]' }</span></span></code> </pre><br>  In action, all this farming can be <a href="https://github.com/werdender/ext4examples/blob/master/fileupload.html">viewed here</a> - everything is collected in one file for clarity, although in general I love the fourth century EXT MWC. </div><p>Source: <a href="https://habr.com/ru/post/158513/">https://habr.com/ru/post/158513/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158501/index.html">Redefining the role of IT in the era of cloud technologies</a></li>
<li><a href="../158505/index.html">Competition of mobile applications from IMI.VC</a></li>
<li><a href="../158507/index.html">Everspin began shipping STT-MRAM memory</a></li>
<li><a href="../158509/index.html">Be careful dialing the Russian number with eight</a></li>
<li><a href="../158511/index.html">Web system development, "here" and "there"</a></li>
<li><a href="../158515/index.html">How to get out of the registry of sites with prohibited information</a></li>
<li><a href="../158517/index.html">soap4all. Through thorns to online TV shows on the App Store</a></li>
<li><a href="../158523/index.html">Automate the initial setup of a web server</a></li>
<li><a href="../158525/index.html">36 nuclear router from Mikrotik and something else</a></li>
<li><a href="../158527/index.html">Software and delegation of authority</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>