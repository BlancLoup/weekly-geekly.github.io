<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with contact photos in android 2.1+</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the course of learning programming under the Android system, I was given the task of writing my contact manager, albeit not as a replacement for th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with contact photos in android 2.1+</h1><div class="post__text post__text-html js-mediator-article"> In the course of learning programming under the Android system, I was given the task of writing my contact manager, albeit not as a replacement for the system manager, but as an educational task. <br>  The work with the contact list has already been described <a href="http://habrahabr.ru/blogs/android_development/130148/">here</a> , and more than once, because I will write only about what I have not met here, namely, about working with a contact photo (contact avatar). <br><br><a name="habracut"></a>  In the course of the work I wrote the helper class, the code can be seen <a href="http://codepaste.ru/8005/">here</a> .  In it were implemented the main functions for working with photos from the contact. <br>  There are two main methods: <br> <code>public static void setContactPhoto(ContentResolver c, byte[] bytes, long personId)</code> <br> <code>public static Bitmap loadContactPhoto(ContentResolver cr, long id, Context context)</code> <br>  As is obvious from the name, in the first method we save the contact a new photo, and the second method loads the photo from the contact database. <br><br>  Using methods: <br>  To save a photo to a contact, you must first receive it, for example, from the gallery. <br>  Suppose we have an ImageButton button on the activation, by pressing which the window for selecting a photo from the gallery will appear.  Do not forget that the photo in the gallery can be of any size, because, first, the photo must be reduced to the desired size.  Fortunately, the programmer for android does not require knowledge of the algorithms for reducing the size and cropping images, everything has already been done by Google in advance, it‚Äôs enough to add the necessary parameters to the call, example below: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> REQ_CODE_PICK_IMAGE = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Bitmap contactPhoto = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ImageView ibtnAvatar; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle bundle)</span></span></span><span class="hljs-function"> </span></span>{ ... ibtnAvatar = (ImageButton) findViewById(R.id.ibtn_avatar); ibtnAvatar.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ Intent i = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(Intent.ACTION_PICK, android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI); i.putExtra(<span class="hljs-string"><span class="hljs-string">"crop"</span></span>, <span class="hljs-string"><span class="hljs-string">"true"</span></span>); i.putExtra(<span class="hljs-string"><span class="hljs-string">"aspectX"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); i.putExtra(<span class="hljs-string"><span class="hljs-string">"aspectY"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); i.putExtra(<span class="hljs-string"><span class="hljs-string">"outputX"</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>); i.putExtra(<span class="hljs-string"><span class="hljs-string">"outputY"</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>); i.putExtra(<span class="hljs-string"><span class="hljs-string">"scale"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); i.putExtra(<span class="hljs-string"><span class="hljs-string">"outputFormat"</span></span>, Bitmap.CompressFormat.JPEG.toString()); i.putExtra(<span class="hljs-string"><span class="hljs-string">"noFaceDetection"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); i.putExtra(<span class="hljs-string"><span class="hljs-string">"return-data"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); i.putExtra(MediaStore.EXTRA_OUTPUT, ContactPhotoHelper.getTempUri()); startActivityForResult(i, REQ_CODE_PICK_IMAGE); } }); }</code> </pre><br>  As we can see from this code, when creating a new intent, we added parameters from the documentation to it, for automatic cutting to size and reducing the photo.  The result of the execution of the system activite will put, according to the standard, to the onActivityResult call that caused its activation. <br>  It should be noted that in this example, system activation will put the result in a temporary file that we created in the ContactPhotoHelper.getTempUri () method. <br>  Processing of the result: the resulting photo will be highlighted on the button <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> requestCode, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> resultCode, Intent imageReturnedIntent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onActivityResult(requestCode, resultCode, imageReturnedIntent); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (requestCode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> REQ_CODE_PICK_IMAGE: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultCode == RESULT_OK) { contactPhoto = BitmapFactory.decodeFile(ContactPhotoHelper.getTempFile() .getAbsolutePath()); ibtnAvatar.setImageBitmap(contactPhoto); } } }</code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After that, you can save the user in this profile picture: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (contactPhoto != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { ByteArrayOutputStream bos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); contactPhoto.compress(CompressFormat.PNG, <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">/*ignored for PNG*/</span></span>, bos); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] bitmapdata = bos.toByteArray(); ContactPhotoHelper.setContactPhoto(getContentResolver(), bitmapdata, contactId); }</code> </pre><br>  As a result, the selected contact receives a new photo. <br><br>  To download a photo from the contact list, the call is quite simple, we use the same ImageButton button: <br><pre> <code class="java hljs">ibtnAvatar.setImageBitmap(ContactPhotoHelper.loadContactPhoto(getContentResolver(), contactId, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>));</code> </pre> <br>  Thus, using only two static methods, I greatly simplified working with contact photos, I don‚Äôt know why it wasn‚Äôt done by Google developers. <br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/130925/">https://habr.com/ru/post/130925/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130919/index.html">Backup solution from Cloud4Y</a></li>
<li><a href="../130920/index.html">Internet voting on html</a></li>
<li><a href="../130921/index.html">About danger and security in Cisco networks</a></li>
<li><a href="../130923/index.html">Writing a console translator for * nix in Python</a></li>
<li><a href="../130924/index.html">Get configuration version 1c directly from SQL</a></li>
<li><a href="../130926/index.html">Remote Access with Dynamic IP or Configure DynDNS in Linux</a></li>
<li><a href="../130928/index.html">In Tatarstan, chop air optics</a></li>
<li><a href="../130930/index.html">Seagate GoFlex Satellite: Wireless Winchester for iPad and more</a></li>
<li><a href="../130931/index.html">Google AI Challenge. How to write your bot. Part 1, 2</a></li>
<li><a href="../130932/index.html">Vertical screens in digital signage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>