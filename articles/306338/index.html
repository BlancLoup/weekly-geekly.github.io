<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Stripe: your dream service to automate money transfers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Those who dealt with the electronic payment service Stripe know that it is perfectly tailored for developers. His documentation is written by people f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Stripe: your dream service to automate money transfers</h1><div class="post__text post__text-html js-mediator-article"><p>  Those who dealt with the electronic payment service <a href="https://stripe.com/">Stripe</a> know that it is perfectly tailored for developers.  His documentation is written by people for people;  there is a good test mode - a complete copy of the real one, and in order to switch to the live mode, you only need to replace the keys without touching the API and without receiving any surprises;  admin test mode - also a complete copy of the battle.  In general, Stripe is good, and I want to devote this article to the basic issues of integrating a service into an e-Commerce project, explaining the processes with concrete and abstract examples.  I hope that my experience will help everyone who wants to try Stripe on their project. </p><a name="habracut"></a><br><p>  However, before using Stripe, ask the question: ‚ÄúWhere is the business that we will serve?‚Äù.  For example, if the business is Russian, Stripe is useless for us: you can receive payments from any country, but the business of the owner of an account on Stripe must be legally registered in one of the available countries.  Otherwise, it is impossible to create and authorize an account.  A list of countries can be found <a href="https://support.stripe.com/questions/what-countries-does-stripe-support">here</a> .  If you want to withdraw money to other accounts, for example, to suppliers (how to do this, I will tell below), then legally suppliers must also be located in the countries with which Stripe works.  The client business with which I worked is registered in America, which allowed making payments through Stripe. </p><br><p>  You also need to be prepared that Stripe does not support the 3-D-secure xml protocol, which requires the client to enter the confirmation code received in the SMS message.  Stripe is simply trying to make a payment without this option, and if the bank accepts payments without 3-D Secure, well, if not, everything will end in refusal, and you will not be able to pay from this card. </p><br><h1>  Making payment </h1><br><p>  To transfer money from the client‚Äôs card to our Stripe account, we need to do the following.  Using the Stripe.js script, we will get the Stripe token on the frontend.  Next we will use the token from the server side to conduct the payment itself. </p><br><p>  We connect Stripe.js and specify the public key: </p><br><pre><code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"https://js.stripe.com/v2/"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt; Stripe.setPublishableKey(<span class="hljs-string"><span class="hljs-string">'your_public_key'</span></span>); <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><p>  We make the usual HTML form, we specify the data-stripe attributes for the script to be input.  We will need the client card number, year and month of card validity and CVC.  Stripe owner‚Äôs name is not required. </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"POST"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"payment-form"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"payment-errors"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>Card Number<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-stripe</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"number"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>Expiration (MM/YY)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-stripe</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"exp_month"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-stripe</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"exp_year"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>CVC<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-stripe</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cvc"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Submit"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Now we get the token: </p><br><pre> <code class="javascript hljs">$(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $form = $(<span class="hljs-string"><span class="hljs-string">'#payment-form'</span></span>); $form.submit(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  ,     $form.find('.submit').prop('disabled', true); //  token  Stripe Stripe.card.createToken($form, stripeResponseHandler); //   submit return false; }); }); function stripeResponseHandler(status, response) { //  : var $form = $('#payment-form'); if (response.error) { // Problem! //    : $form.find('.payment-errors').text(response.error.message); $form.find('.submit').prop('disabled', false); //  submit } else { // Token   //  token id: var token = response.id; //  token  ,   submit    : $form.append($('&lt;input type="hidden" name="stripeToken"&gt;').val(token)); //  : $form.get(0).submit(); } };</span></span></code> </pre> <br><p>  Just in case: this step is described in the <a href="https://stripe.com/docs/custom-form">official documentation</a> . </p><br><p>  Now we can withdraw money from the client through the server.  PHP code examples. </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//    \Stripe\Stripe::setApiKey("your_secret_key"); //  token   $token = $_POST['stripeToken']; //   try { $charge = \Stripe\Charge::create(array( "amount" =&gt; 1000, //    "currency" =&gt; "usd", "source" =&gt; $token, "description" =&gt; "Example charge" )); } catch(\Stripe\Error\Card $e) { //    }</span></span></code> </pre> <br><p>  This is all you need to do to transfer money from a client card to your Stripe account. </p><br><h1>  Automatic money transfers to your suppliers <br></h1><br><p>  Now consider the translation in a working example.  Imagine that you are writing a platform that sells rare books from small publishers around the world.  You need to transfer money to your suppliers, publishers, so that they send the book to the client, and take a commission of $ 10 from each sale.  You do not want to bathe with monthly reports and payments, you just want to transfer money every time a client pays.  Stripe it allows. </p><br><p>  As before, a prerequisite for setting up automatic transfers is finding a supplier in one of the countries supported by Stripe. </p><br><p>  Stripe has a great <a href="https://stripe.com/docs/connect/managed-accounts">deal of Managed Accounts</a> .  With this option, we kind of create a Stripe account for our supplier, but we take care of all account management concerns, so the publisher itself will not need to register with Stripe. </p><br><p>  First, we will receive information about the bank account of your publisher using the script Stripe.js, which is already familiar to us.  As in the case of debiting money from the client‚Äôs card, we also need a Stripe token for operations with a bank account. </p><br><pre> <code class="javascript hljs">Stripe.bankAccount.createToken({ <span class="hljs-attr"><span class="hljs-attr">country</span></span>: $(<span class="hljs-string"><span class="hljs-string">'.country'</span></span>).val(), <span class="hljs-comment"><span class="hljs-comment">// 2-   (US) currency: $('.currency').val(), // 3-   (USD) routing_number: $('.routing-number').val(), //    account_number: $('.account-number').val(), //    account_holder_name: $('.name').val(), //    (   ‚Äî ) account_holder_type: $('.account-holder-type').val() //   ‚Äî     (individual, company) }, stripeResponseHandler);</span></span></code> </pre> <br><p>  This is also described in the <a href="">documentation</a> . </p><br><p>  <i>Remark</i> .  Keep in mind that for each country, bank data (routing_number, account_number) are filled in differently.  For example, for European countries you need to get an IBAN number.  It is placed in the account_number field, and routing_number is not sent at all.  Also for some countries, internal account numbers are glued together in one line and written in the fields.  For example, to get the correct identification number of the bank's routing_number for Canada, you need to glue the transit number and the institution number (transit number + institution number).  If transit number: 02345, and institution number: 987, then routing_number will be '02345987'.  Account number varies by bank.  And for Germany, only an IBAN number will be needed; it is filled in the routing_number field.  For example, IBAN: DE89370400440532013000 (22 characters).  How to fill these fields for other countries, you can see <a href="https://support.stripe.com/questions/what-bank-account-information-should-platforms-provide-for-managed-accounts-in-different-countries">here</a> . </p><br><p>  So, now we have a token bank account where we can withdraw money to suppliers.  Let's create a Managed Account.  Let our publishing house is in America, is a company, not an IE, and we pay it in American dollars. </p><br><pre> <code class="php hljs">\Stripe\Stripe::setApiKey(<span class="hljs-string"><span class="hljs-string">"your_secret_key"</span></span>); $account = Account::create([ <span class="hljs-string"><span class="hljs-string">"country"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'US'</span></span>, <span class="hljs-string"><span class="hljs-string">"managed"</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, ]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($account-&gt;id)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $account-&gt;external_accounts-&gt;create( [<span class="hljs-string"><span class="hljs-string">"external_account"</span></span> =&gt; $token] <span class="hljs-comment"><span class="hljs-comment">//  token   ); } catch (InvalidRequest $error) { //    } }</span></span></code> </pre> <br><p>  It would seem that now we have a Managed Account, and you can transfer money, but no: you need to verify your account.  To do this, Stripe must be provided with certain legal information about the company.  What kind of information is needed and in which countries is described <a href="https://stripe.com/docs/connect/required-verification-information">here</a> . </p><br><p>  So, for publishing in America, we need to provide: </p><br><table><thead><tr><th>  Title </th><th>  Description </th></tr></thead><tbody><tr><td>  legal_entity.address.city </td><td>  The city in which the company is located </td></tr><tr><td>  legal_entity.address.line1 </td><td>  Company address </td></tr><tr><td>  legal_entity.address.postal_code </td><td>  Postcode </td></tr><tr><td>  legal_entity.address.state </td><td>  State </td></tr><tr><td>  legal_entity.business_name </td><td>  Company name </td></tr><tr><td>  legal_entity.business_tax_id </td><td>  Tax Identification Number </td></tr><tr><td>  legal_entity.dob.day </td><td>  Birthday of the owner of the company </td></tr><tr><td>  legal_entity.dob.month </td><td>  The month of birth of the owner of the company </td></tr><tr><td>  legal_entity.dob.year </td><td>  Year of birth of the owner of the company </td></tr><tr><td>  legal_entity.first_name </td><td>  Company owner name </td></tr><tr><td>  legal_entity.last_name </td><td>  Name of company owner </td></tr><tr><td>  legal_entity.ssn_last_4 </td><td>  The last four digits of the company's social security number </td></tr><tr><td>  legal_entity.type </td><td>  individual / company </td></tr><tr><td>  tos_acceptance.date </td><td>  Date Accepted Stripe Terms of Use </td></tr><tr><td>  tos_acceptance.ip </td><td>  IP address from which Stripe terms of use were accepted </td></tr></tbody></table><br><p>  Terms of use Stripe <a href="https://stripe.com/us/terms">here</a> .  The person on whose behalf the Managed Account will be created must accept them. </p><br><p>  Stripe may also require additional information.  For America, this is: </p><br><table><thead><tr><th>  Title </th><th>  Description </th></tr></thead><tbody><tr><td>  legal_entity.personal_id_number </td><td>  Personal identification number </td></tr><tr><td>  legal_entity.verification.document </td><td>  Scan of identity document </td></tr></tbody></table><br><p>  We collect the necessary information and edit the account. </p><br><pre> <code class="php hljs">\Stripe\Stripe::setApiKey(<span class="hljs-string"><span class="hljs-string">"your_secret_key"</span></span>); $account = Account::retrieve($accountId); $account-&gt;legal_entity-&gt;address-&gt;city = <span class="hljs-string"><span class="hljs-string">'New-York'</span></span>; $account-&gt;legal_entity-&gt;address-&gt;state = <span class="hljs-string"><span class="hljs-string">'New-York'</span></span>; $account-&gt;legal_entity-&gt;address-&gt;postal_code = <span class="hljs-string"><span class="hljs-string">'00501'</span></span>; $account-&gt;legal_entity-&gt;address-&gt;line1 = <span class="hljs-string"><span class="hljs-string">'Some address'</span></span>; $account-&gt;legal_entity-&gt;business_name = <span class="hljs-string"><span class="hljs-string">'US TEST'</span></span>; $account-&gt;legal_entity-&gt;business_tax_id = <span class="hljs-string"><span class="hljs-string">'00000001'</span></span>; $account-&gt;legal_entity-&gt;dob-&gt;day = <span class="hljs-number"><span class="hljs-number">1</span></span>; $account-&gt;legal_entity-&gt;dob-&gt;month = <span class="hljs-number"><span class="hljs-number">1</span></span>; $account-&gt;legal_entity-&gt;dob-&gt;year = <span class="hljs-number"><span class="hljs-number">1980</span></span>; $account-&gt;legal_entity-&gt;first_name = <span class="hljs-string"><span class="hljs-string">'Bob'</span></span>; $account-&gt;legal_entity-&gt;last_name = <span class="hljs-string"><span class="hljs-string">'Smith'</span></span>; $account-&gt;legal_entity-&gt;type = <span class="hljs-string"><span class="hljs-string">'company'</span></span>; $account-&gt;legal_entity-&gt;ssn_last_4 = <span class="hljs-string"><span class="hljs-string">'0000'</span></span>; $account-&gt;tos_acceptance-&gt;date = <span class="hljs-number"><span class="hljs-number">1466074123</span></span>; <span class="hljs-comment"><span class="hljs-comment">// timestamp $account-&gt;tos_acceptance-&gt;ip = 123.123.123.123; try { $account-&gt;save(); } catch (InvalidRequest $error) { //     }</span></span></code> </pre> <br><p>  Now the Stripe team will check everything, and we will see the Verified status in the admin panel. <br>  <a href="https://dashboard.stripe.com/test/applications/users/overview">https://dashboard.stripe.com/test/applications/users/overview</a> </p><br><p><img src="https://habrastorage.org/files/bf8/be1/d93/bf8be1d93b824a3a98646fdcbf4cf6aa.png" alt="image"></p><br><p>  But this will not be enough for us.  Also, the Stripe team can indicate data errors or require additional information, such as personal_id_number. </p><br><p><img src="https://habrastorage.org/files/a48/017/ede/a48017ede9a64aad906ceeebebb9c942.png" alt="image"></p><br><p>  When the team checks the data, the account will be updated.  This event can be configured <a href="https://stripe.com/docs/webhooks">webhook</a> . </p><br><p><img src="https://habrastorage.org/files/197/08f/0f8/19708f0f8dbf48d1a9ae5fe7d79be81b.png" alt="image"></p><br><p>  The required fields will be described in the account object: </p><br><pre> <code class="php hljs">$account-&gt;verification-&gt;fields_needed</code> </pre> <br><p>  Stripe can also set a deadline to provide data.  If there is a date, it will be in the $ account-&gt; verification-&gt; due_by property. </p><br><p>  For verification verification Stripe provides a good test environment.  With the help of translations from certain test cards, we can simulate different scenarios for verification of accountants.  Examples of such scenarios: </p><br><ul><li>  data is not filled, and we generally can not make transfers; </li><li>  Worked limit on the size of the payment.  This happens if Stripe believes that the translation is too large, and the information provided is not enough for it.  In this case, it disables the Managed Account; </li><li>  disable the account with the requirement to enter data to a specific date; </li><li>  loading a scan of the document confirming the identity of the account holder; </li><li>  acceptance and rejection of this scan. </li></ul><br><p>  How specifically to simulate these cases is described <a href="https://stripe.com/docs/connect/testing-verification">here</a> . </p><br><p>  Handle all situations will have in any case.  And in my experience, it is better to provide Stripe with as much information as possible to avoid surprises with the disconnection of the account. </p><br><p>  When everything is OK, and Stripe verified your Managed Account, you need to enable transfers (transfers) using the API or disable automatic transfers - this is the same thing. <br>  <a href="https://dashboard.stripe.com/account/transfers">https://dashboard.stripe.com/account/transfers</a> </p><br><p><img src="https://habrastorage.org/files/ddd/e04/040/ddde04040e75453b9e44552f7ba5d775.png" alt="image"></p><br><p>  So, we have a verified account, transfers are included, and now we can make money transfers directly to the supplier. </p><br><p>  Suppose we have a book.  The supplier wants $ 50 for it, we want $ 10 dollars of commission for ourselves, plus we need to include the Stripe commission for translation into the price.  <a href="https://stripe.com/us/pricing">Stripe now charges</a> 2.9% + 30 ¬¢ <a href="https://stripe.com/us/pricing">for each transfer</a> .  We decided that we would pay the commission from our part.  Then the user must pay $ 60 for the book.  For our part, we will give away the $ 2.04 Stripe commission. </p><br><p>  We get token using Stripe.js and make a payment from the server side. </p><br><pre> <code class="php hljs">$charge = Charge::create([ <span class="hljs-string"><span class="hljs-string">"amount"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6000</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   "currency" =&gt; 'USD', "source" =&gt; $token, "application_fee" =&gt; 1000, "destination" =&gt; $managedAccountId ]);</span></span></code> </pre> <br><p>  The application_fee property allows you to specify how much of the transfer to leave on our account.  The Stripe commission will in any case be charged only from our account, even if we make a full transfer to the supplier. </p><br><p>  Money will not come to the bank account of the supplier immediately, they are withdrawn every seven days.  Those.  we transfer money to our supplier's Stripe account, and after seven days, they are transferred to the account on a linked bank account. </p><br><h1>  Additional features </h1><br><p>  In addition, Stripe allows you to save customers, add arbitrary metadata when creating a payment, to make it easier to navigate the payments made, set the description when making a payment for its more informative description, and much more.  All this can be viewed in the <a href="https://stripe.com/docs/api">documentation for the payments API</a> . </p><br><p>  I wish you the best of luck with Stripe integration!  I will be glad to your comments, questions and clarifications that will help to supplement the article. </p><br><h1>  Useful links: </h1><br><p>  <a href="https://support.stripe.com/questions/what-countries-does-stripe-support">Countries that support Stripe</a> <br>  <a href="https://stripe.com/docs/custom-form">Custom HTML form to get token</a> <br>  <a href="https://stripe.com/docs/connect/managed-accounts">Managed Accounts</a> <br>  <a href="">Getting a token for a bank account</a> <br>  <a href="https://support.stripe.com/questions/what-bank-account-information-should-platforms-provide-for-managed-accounts-in-different-countries">Required bank information by country</a> <br>  <a href="https://support.stripe.com/questions/what-bank-account-information-should-platforms-provide-for-managed-accounts-in-different-countries">Required legal information for Managed Accounts by country</a> <br>  <a href="https://stripe.com/us/terms">Stripe Terms of Use</a> <br>  <a href="https://stripe.com/docs/connect/testing-verification">Testing verification of an account</a> <br>  <a href="https://stripe.com/docs/webhooks">Webhooks</a> <br>  <a href="https://stripe.com/us/pricing">Stripe pricing</a> <br>  <a href="https://stripe.com/docs/api">Stripe API Reference</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/306338/">https://habr.com/ru/post/306338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306326/index.html">Help Desk and Service Desk - when is Excel and CRM insufficient? Really important functions of accounting systems</a></li>
<li><a href="../306328/index.html">10 errors leading to software overgraining</a></li>
<li><a href="../306332/index.html">Solve RAII problems with std :: thread: cancellation_token as an alternative to pthread_cancel and boost :: thread :: interrupt</a></li>
<li><a href="../306334/index.html">Elixir: Getting Started with Plug</a></li>
<li><a href="../306336/index.html">Skills and requirements for information security professionals</a></li>
<li><a href="../306340/index.html">Summer update on Habr√©: ‚ÄúAdministration‚Äù, voice weight and much more</a></li>
<li><a href="../306342/index.html">Prospects for the commercial use of IPv6 in Russia (year 2016)</a></li>
<li><a href="../306344/index.html">11 design projects that "blew up" the world</a></li>
<li><a href="../306348/index.html">Functional animation in UX design. What makes it effective?</a></li>
<li><a href="../306350/index.html">Swift Features</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>