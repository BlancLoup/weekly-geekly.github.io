<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Passage of the Labyrinth Captcha on Javascript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There is a not very well-known browser game. The gameplay in it is very simple and monotonous, which contributes to the appearance of bots. To combat ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Passage of the Labyrinth Captcha on Javascript</h1><div class="post__text post__text-html js-mediator-article">  There is a not very well-known browser game.  The gameplay in it is very simple and monotonous, which contributes to the appearance of bots.  To combat them, a captcha was introduced into the game, occasionally crawling out during battle.  50 seconds are given for guessing, if you guess for 20, then they will give an additional bonus.  Captcha two types: "Guess the pony" and "Pass the labyrinth".  I didn‚Äôt usually have problems with guessing ponies, but going through a maze in 20 seconds is not always a trivial task.  And I thought, is it possible to write Userscript, which would independently go through the maze and tell me the correct answer ... <br><a name="habracut"></a><br>  The first thing to start with is gathering information.  We cause the maze to appear, climb into the source code, and see what is there and how.  There we find the inserted image, and we learn two things: first, the image is on the same domain as the toy itself.  This makes it easy to work with canvas.  Secondly, it is in the form with id = "riddleform", which is the first image.  In the same form is another image. <br><br>  Disclaimer: jQuery is used in the script.  Throwing boots optional;  I know that connecting jQuery in order to pull out one image is not a good use of it.  The fact is that this script was planned as part of another, in which jQuery was already used. <br><br>  Start writing code <br><pre><code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'#riddleform img'</span></span>).load(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{<span class="hljs-comment"><span class="hljs-comment">// -      if (this.src == "http://ehgt.org/v/battle/answer.png") return;//  ,       var rmimg = $('#riddleform img')[0]; var canvas = document.createElement("canvas"); canvas.width = rmimg.width; canvas.height = rmimg.height; var ctx = canvas.getContext("2d"); ctx.drawImage (rmimg, 0, 0); var data = ctx.getImageData(0, 0, canvas.width, canvas.height); });</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As a result, we have the variable data, in which the image is loaded.  We stop.  We begin to collect images of mazes and save them. <br><br>  All images have an address of the form " <a href="http://hentaiverse.org/riddlemaster.php%3Fuid%3D">hentaiverse.org/riddlemaster.php?uid=</a> [here is the user's ID, the same for all images] &amp; v = [here, apparently, md5 hash]".  For example, " <a href="http://hentaiverse.org/riddlemaster.php%3Fuid%3D123456%26v%3D834a6b57de2d4e6d777478d7c2803d664293e7ec">hentaiverse.org/riddlemaster.php?uid=123456&amp;v=834a6b57de2d4e6d777478d7c2803d664293e7ec</a> ". <br><br>  After collecting about ten pictures, open them and begin to consider them. <br><br><img src="https://habrastorage.org/storage2/01e/7bd/a5f/01e7bda5fd601750562d09152d9a4bef.png"><img src="https://habrastorage.org/storage2/781/e57/b14/781e57b142f72c7f4c6bf3b78d62032a.png"><img src="https://habrastorage.org/storage2/baf/b79/dc0/bafb79dc07dc4b4df8251084fa7804f1.png"><img src="https://habrastorage.org/storage2/91b/5cb/2a3/91b5cb2a3342f664d1ee7eac36ad7a80.png"><img src="https://habrastorage.org/storage2/fed/2d4/ebd/fed2d4ebd7b4cf8d561b0ed597f4e47a.png"><img src="https://habrastorage.org/storage2/88f/267/1d7/88f2671d794f3213426a37191868b9fe.png"><br><br>  (Images reduced) <br><br>  So, the image is noisy, it may or may not pass through a bright triangle, which occupies the lower left corner, and a dark triangle, which occupies the upper left corner.  Both may be present.  There may not be one.  Entry and exits are always in the same place.  All images are the same size (615x615), and they are all in jpg format. <br><br>  A bunch of large images will not decorate the article, so I‚Äôll just put the links. <br>  <a href="">habrastorage.org/storage2/bfe/dcc/6a0/bfedcc6a0dc3b80e44d372a4b6660411.jpg</a> <br>  <a href="">habrastorage.org/storage2/5c1/b6e/7c3/5c1b6e7c3fb4db6e547b95ecf0d5d81c.jpg</a> <br>  <a href="">habrastorage.org/storage2/e85/6bc/c1e/e856bcc1ee6542acc66ab03601901eff.jpg</a> <br>  <a href="">habrastorage.org/storage2/48d/535/62e/48d53562e8edb7d787419a726a5fea77.jpg</a> <br>  <a href="">habrastorage.org/storage2/001/c2e/d34/001c2ed34a22d82fd467c3fcd36993e7.jpg</a> <br>  <a href="">habrastorage.org/storage2/eca/80a/75a/eca80a75a60b41498f3d847afc207e71.jpg</a> <br><br>  Further - more interesting.  It is easy to see that the noise in all the images is the same.  Further, although the colors of the ‚Äúwalls‚Äù differ from the image to the image, the color of the ‚Äútracks‚Äù is always the same.  If you look closer, it becomes clear that most of the cells are the same on all mazes. <br><br><img src="https://habrastorage.org/storage2/807/87a/7fc/80787a7fc6ade4b53c0c216a70d059bc.png"><br><br>  Black squares denote cells that are <i>always passable</i> .  The red dot indicates the central cell.  The cells located between the black dots on the diagonal are always busy.  They are not interesting for us.  We need to find out if the cells on the same horizontals and verticals as the black points are free or occupied. <br><br>  The first thought that comes to mind is ‚ÄúThe noise is the same, the color of the cell too.  We can simply take any pixel in the cell and look at its color. ‚Äù  However, this does not work.  A more detailed study shows that the noise is not exactly the same.  In addition, for each cell would have to choose a pixel, find out what it can be colors, take into account the triangles;  In short: a lot of fuss. <br><br>  Just in the maze of cells 37x37.  Create an array into which we will load this maze. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> clear = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tmp=<span class="hljs-number"><span class="hljs-number">0</span></span>; tmp&lt;<span class="hljs-number"><span class="hljs-number">38</span></span>; ++tmp) clear[tmp] = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r=<span class="hljs-number"><span class="hljs-number">1</span></span>; r&lt;<span class="hljs-number"><span class="hljs-number">38</span></span>;++r){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t=<span class="hljs-number"><span class="hljs-number">1</span></span>; t&lt;<span class="hljs-number"><span class="hljs-number">38</span></span>; ++t){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((r%<span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">1</span></span>) &amp;&amp; (t%<span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">1</span></span>)){clear[r][t] = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((r%<span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; (t%<span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>)){clear[r][t] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>;} } }</code> </pre><br>  It remains to figure out how to distinguish empty cells from occupied ones.  If we can‚Äôt choose one pixel by one, then we‚Äôll select by all: add and divide.  Smash the cells, to put it simply.  Look closely again.  Cells are 15x15 pixels. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sum = [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> amount = <span class="hljs-number"><span class="hljs-number">0</span></span>;<span class="hljs-comment"><span class="hljs-comment">//      for (var j=t*15; j&lt;t*15+15; ++j){ for (var k=r*15; k&lt;r*15+15; ++k){ sum[0] += data.data[getrdata(j, k)];//getrdata     ,   sum[1] += data.data[getrdata(j, k)+1];//      , sum[2] += data.data[getrdata(j, k)+2];//    ,  1  2. ++amount; } } sum[0] = Math.round(sum[0]/amount); sum[1] = Math.round(sum[1]/amount); sum[2] = Math.round(sum[2]/amount);</span></span></code> </pre><br>  It remains to find out which colors correspond to empty cells.  There are four kinds of them: pure, light, dark, and ‚Äúlight-dark,‚Äù depending on whether the triangles that I talked about at the beginning appeared.  Fortunately, there are no cells that would be <i>on the border of</i> these triangles.  In short: the colors were obtained by creating a diva into which all the colors of the cells were thrown.  Then from there the necessary ones were chosen.  For a while, the script was driven when it ran into an impassable labyrinth. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (sum[<span class="hljs-number"><span class="hljs-number">0</span></span>]&gt;<span class="hljs-number"><span class="hljs-number">190</span></span>)&amp;&amp;(sum[<span class="hljs-number"><span class="hljs-number">0</span></span>]&lt;<span class="hljs-number"><span class="hljs-number">202</span></span>) &amp;&amp; (sum[<span class="hljs-number"><span class="hljs-number">1</span></span>]&gt;<span class="hljs-number"><span class="hljs-number">170</span></span>)&amp;&amp;(sum[<span class="hljs-number"><span class="hljs-number">1</span></span>]&lt;<span class="hljs-number"><span class="hljs-number">183</span></span>) &amp;&amp; (sum[<span class="hljs-number"><span class="hljs-number">2</span></span>]&gt;<span class="hljs-number"><span class="hljs-number">130</span></span>)&amp;&amp;(sum[<span class="hljs-number"><span class="hljs-number">2</span></span>]&lt;<span class="hljs-number"><span class="hljs-number">145</span></span>) ){<span class="hljs-comment"><span class="hljs-comment">//normal clear[r][t] = true; }else if ( (sum[0]&gt;148)&amp;&amp;(sum[0]&lt;160) &amp;&amp; (sum[1]&gt;135)&amp;&amp;(sum[1]&lt;143) &amp;&amp; (sum[2]&gt;103)&amp;&amp;(sum[2]&lt;114) ){//dark clear[r][t] = true; }else if ( (sum[0]&gt;203)&amp;&amp;(sum[0]&lt;213) &amp;&amp; (sum[1]&gt;190)&amp;&amp;(sum[1]&lt;197) &amp;&amp; (sum[2]&gt;157)&amp;&amp;(sum[2]&lt;169) ){//light clear[r][t] = true; }else if ( (sum[0]&gt;171)&amp;&amp;(sum[0]&lt;180) &amp;&amp; (sum[1]&gt;158)&amp;&amp;(sum[1]&lt;167) &amp;&amp; (sum[2]&gt;133)&amp;&amp;(sum[2]&lt;143) ){//grey clear[r][t] = true; }else{ clear[r][t] = false; }</span></span></code> </pre><br>  There is a trifle: go through the maze.  This will make a recursive algorithm. <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeway</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x,y,data)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((y == <span class="hljs-number"><span class="hljs-number">11</span></span>)&amp;&amp;(x == <span class="hljs-number"><span class="hljs-number">37</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'A'</span></span>;<span class="hljs-comment"><span class="hljs-comment">//    A if ((y == 27)&amp;&amp;(x == 37)) return 'B';//   if ((y == 37)&amp;&amp;(x == 11)) return 'D'; if ((y == 37)&amp;&amp;(x == 27)) return 'C'; var t = ''; if (x&lt;37 &amp;&amp; data [x+1][y]) {data [x+1][y] = false; t = makeway (x+2, y, data);}//   ... if (t != '') return t; if (x&gt;1 &amp;&amp; data [x-1][y]) {data [x-1][y] = false; t = makeway (x-2, y, data);}// ... if (t != '') return t; if (y&lt;37 &amp;&amp; data [x][y+1]) {data [x][y+1] = false; t = makeway (x, y+2, data);} if (t != '') return t; if (y&gt;1 &amp;&amp; data [x][y-1]) {data [x][y-1] = false; t = makeway (x, y-2, data);} if (t != '') return t; return '';//   }</span></span></code> </pre><br>  After that, it remains only to create a div in the document and call <br><pre> <code class="javascript hljs">answerdiv.innerHTML = makeway (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, clear);</code> </pre> <br>  Pay attention to the fact that we "jump through the cage."  If a <i>neighboring</i> cell is free, then we jump <i>through</i> it, because we know for sure that that cell is free: it is one of the cells with black dots. <br><br>  All this is great, but such code is not very convenient to debug.  So he broke down, did not find the passage, because he did not recognize the cell as free.  Question: where did he break down?  Expand the script.  Add the variable ctx to the arguments to the makeway function, and in the beginning ... <br><pre> <code class="javascript hljs">ctx.fillStyle = <span class="hljs-string"><span class="hljs-string">"rgb(0,0,0)"</span></span>; ctx.fillRect (y*<span class="hljs-number"><span class="hljs-number">15</span></span>,x*<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>);</code> </pre><br>  ... And paint the passed cell with black.  Add to the script code ... <br><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'body'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].appendChild(canvas);</code> </pre><br>  ... And in the cycle, immediately after checking for free cells ... <br><pre> <code class="javascript hljs">ctx.fillStyle = <span class="hljs-string"><span class="hljs-string">"rgb("</span></span> + sum[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">','</span></span> + sum[<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-string"><span class="hljs-string">','</span></span> + sum[<span class="hljs-number"><span class="hljs-number">2</span></span>] + <span class="hljs-string"><span class="hljs-string">")"</span></span>; ctx.fillRect (t*<span class="hljs-number"><span class="hljs-number">15</span></span>,r*<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>);</code> </pre><br>  Now this canvas will appear in the document, which may look like this: <br><img src="http://habrastorage.org/storage2/1a5/925/9c1/1a59259c176eeb34547930fd29d5f11f.png"><br>  It remains only to open the image in the paint, poke a pipette into the impassable cell, and see its color. <br>  And finally, leave a link to the archive with several images and an html file in which you can insert the desired image and look at the result, as well as several working files: <a href="">dl.dropbox.com/u/42049925/rm.zip</a> </div><p>Source: <a href="https://habr.com/ru/post/164887/">https://habr.com/ru/post/164887/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../164875/index.html">The theory of creating artificial intelligence</a></li>
<li><a href="../164877/index.html">Re-optimization ... where is the limit?</a></li>
<li><a href="../164881/index.html">Seeder 1.1 entropy generator significantly reduces lags on Android devices</a></li>
<li><a href="../164883/index.html">Jelastic Cloud + Maven. Part 1</a></li>
<li><a href="../164885/index.html">WPF, WinForms: 15000 FPS. Hardcore tricks Part 1.5</a></li>
<li><a href="../164889/index.html">Creating a TV channel on the Internet using a home computer</a></li>
<li><a href="../164895/index.html">Zero Day Vulnerability in IE v6-8</a></li>
<li><a href="../164899/index.html">Another ‚ÄúSolar System‚Äù on HTML5 Canvas</a></li>
<li><a href="../164901/index.html">We write a simple sniffer for Windows</a></li>
<li><a href="../164903/index.html">My first captcha guessing script</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>