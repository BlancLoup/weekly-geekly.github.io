<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Whistler Bootkit - our regiment arrived</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, user complaints about the presence of malicious files have appeared and are gradually gaining momentum, which cannot be deleted in any way. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Whistler Bootkit - our regiment arrived</h1><div class="post__text post__text-html js-mediator-article"> Recently, user complaints about the presence of malicious files have appeared and are gradually gaining momentum, which cannot be deleted in any way.  These files can be seen in the list of active processes, and characteristically - they are all located in the <b>C: \ System Volume Information \</b> folder (or subfolders) and run with NT-AUTHORITY \ SYSTEM rights. <br><br>  If you find this behavior - congratulations, you picked up the Whistrler Bootkit.  About him and will be discussed today. <br><a name="habracut"></a><br>  At the moment, I, like some of my friends in antivirus companies, do not have an infector of this bootkit.  However, it is clear that the malware is not a new invention, but is a continuation of the idea of ‚Äã‚ÄãPeter Kleissner, expressed in <a href="http://www.stoned-vienna.com/">the Stoned PoC project</a> .  In this case, the virmaker probably copied the code frankly, without even bothering to add or change it.  So, the story ... <br><br>  Until some time, the Stoned Peter Kleissner project was a way to show the ability to load code into the system‚Äôs memory before the actual system load.  This made it possible to gain complete control over the OS: starting from executing arbitrary processes with arbitrary permissions to bypassing the Windows security system and controlling the license key on Vista / Seven.  The project developed quite stably within the framework of open source, until Kaspersky Lab and some other organizations sued the author for allegedly distributing malicious software.  I will not comment on this act and how reasonable it is, but since the end of last year, the author stopped distributing new versions and significantly cut down the available public version.  Development of support for Linux platforms was also suspended at the time of the trial.  And Whistler appeared ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      According to Peter, the leak most likely occurred before January of this year, since the first ‚Äúpromotional‚Äù move about Whistler appeared <a href="http://blog.novirusthanks.org/2010/02/whistler-bootkit-a-new-powerful-windows-bootkit/">on this blog</a> in January.  A month later, the blogger was forced to throw out clearly advertising information, as well as information about the cost of the bootkit and the cost of supporting it, making the article more ‚Äúinformational‚Äù rather than advertising.  Now the ‚Äúoffsite‚Äù of the bootkit is located <a href="http://www.w32whistler.com/">here</a> , where there is less information, but I want money more openly :) <br><br>  Based on this date, it can be assumed that Whistler is based on Stoned v2 Alpha 3 dated October 20, 2009.  It was this version that came with the compiled infector and disinfector files.  Taking it as a working hypothesis, in the absence of a dropper, the following information is made precisely on the basis of the work and capabilities of this version of Stoned. <br><br>  Initially, a variety of infection methods were well documented: autorun from flash drives, pdf exploits (infections from an infected pdf file), infectors, infections when loading special LiveCD / LiveUFD images.  Therefore, an infector can be anything that makes it difficult to understand how Whistler is transmitted and where it is taken. <br><br>  The list of infected OS is impressive: 2000, XP, Vista, Seven, Server 2003, Server 2008, supports x64.  At the same time it works correctly with hardware and software encryption of the entire contents of the hard drive.  Disabling the ability to modify the MBR in the BIOS does not help (it worked only in DOS and win95 / 98, so it is already irrelevant in principle). <br><br>  On the infected system, the boot loader in the MBR is patched to the initial execution of the bootkit code with the subsequent transfer of control to the original loader.  The original bootloader, bootkit code and its plugins are stored in an unallocated area at the end of the physical disk in a special file system (RawFS - this was in the original Stoned).  In this case, the bootkit code is the first file of this system and its location is precisely known.  This is an important point, which allows even fully encrypted disks to be infected, because the bootloader is not encrypted in them and the beginning of the unpartitioned area is known exactly - and this is quite enough. <br><br>  After loading the bootkit code is placed in memory and allows you to implement various functionalities, loading plugins into existing processes.  It is difficult to say whether the Whistler author got a public version, or a closed one (which included a ready-made application launch plugin with NT-AUTHORITY \ SYSTEM rights), but in general the execution scheme of the plugins from the bootkit is as follows. <br><br>  1. The function of PsGetVersion / RtlGetVersion determines the version of the operating system. <br>  2. Based on this information, EPROCESS and KTHREAD structures are determined. <br>  3. A bootkit, through an asynchronous procedure call, injects the plug-in code into any user-mode executable process. <br><br>  As can be seen from paragraphs.  1-2, the bootkit code allows you to work on any OS.  However, its plug-ins should be distinguished from the bootkit: the latter are OS-dependent (especially the bit depth - x32 or x64), and therefore different versions for different systems can be found in the RawFS system.  If the author of Whistler wrote a plugin that allows you to run processes with elevated rights - and this plugin is written under x32, then in general Whistler will infect both x32 and x64, there will be a bootkit in memory - but it will reveal its potential only on x32, since the plugin On the other bit does not work. <br><br>  If the author of Whistler came across a closed version of Stoned - there was no possibility of launching and escalating the rights of processes on x64 ( <b>NB !!!</b> ) <br><br>  The original Stoned did not hide its presence and the change in the MBR (as it was done, for example, by Sinowal).  In principle, this can be done with the help of an additional plug-in (see above), but it needs to be encoded.  Whether the mind and capabilities of the author Whistler is enough for this is unknown. <br><br>  What to do if you have a Whistler?  Based on the availability of the MBR, a standard fixmbr is sufficient.  However, taking into account the fact that while this virus is a ‚Äúdark horse,‚Äù it is strongly recommended to first remove the MBR dumps.  This can be done, for example, using the <a href="http://firesage.com/mbrwizard/index.php">MBRWizard</a> by running the following command line: <br><br> <code>mbrwiz.exe /save=mbr /filename=mbr.bin</code> <br> <br>  You can try in action and <a href="http://support.kaspersky.ru/viruses/solutions%3Fqid%3D208636990">antiboot</a> .  <a href="http://www.multiupload.com/WMWQJ6QAI9">I changed this utility a bit</a> , or rather, automated the quarantine collection.  Essence: junk conducts a study of antiboot on the following command: <br><br> <code>antiboot.exe -l "%cd%\log.txt" -p "%cd%\MBR"</code> <br> <br>  Then it packs the MBR folder into a quarantine.zip zip archive with the password virus and deletes the MBR folder. <br>  Directly in the utility there are bugs: brakes during operation and hang on some machines.  It looks like this: in the console it writes: <br><br> <code>Antibootkt, (c) Kaspersky Lab 2010, version 1.2.1 <br> Log started <br> Unpacking driver <br> Starting up driver</code> <br> <br>  after which - silence and for a long time.  In this case, you need to ask the user to close the window and manually send the created MBR folder (there will already be dumps in it). <br>  (According to the representative of LC, they know about this bug, but it is not possible to eliminate it for various reasons). <br><br>  Of course, it is possible to use the well-known ‚Äúuniversal‚Äù treatment of <a href="">bootkits eSage Bootkit Remover</a> .  However, there is evidence that, if there is an active TDL2 infection, this tool gives out ‚Äúno disk found‚Äù.  This should be borne in mind when using it, but in general it is quite a good thing, also recommended for use.  But not directly, but at least with the following script: <br><br> <code>start /wait remover.exe dump \\.\PhysicalDrive0 mbr.bin <br> remover.exe fix \\.\PhysicalDrive0</code> <br> <br>  These MBR dumps can be sent to your favorite antivirus vendor :) This will allow you to assess how much Whistler differs from Stoned.  I strongly suspect that there is no way :) <br><br>  PS Many thanks to Peter Kleissner for the assistance provided in the preparation of this material and in general for the work done in the framework of the Stoned project. </div><p>Source: <a href="https://habr.com/ru/post/96850/">https://habr.com/ru/post/96850/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../96844/index.html">Clouds do not threaten opensource</a></li>
<li><a href="../96845/index.html">New interface and functionality MobileMe is now available to all users of the service</a></li>
<li><a href="../96847/index.html">Website Builder and Biggo Online Stores</a></li>
<li><a href="../96848/index.html">Rambler speaks six languages. New version of "Rambler-Dictionaries"</a></li>
<li><a href="../96849/index.html">Entertaining Astronomy - Moon Facts</a></li>
<li><a href="../96853/index.html">In the game "Life" created the most complex organism that can reproduce</a></li>
<li><a href="../96858/index.html">Modules embedded in the core Drupal 7</a></li>
<li><a href="../96859/index.html">Winlockers - removing when nothing else to do</a></li>
<li><a href="../96861/index.html">Update Kaspersky Rescue Disk</a></li>
<li><a href="../96863/index.html">Unlimited mobile internet overview</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>