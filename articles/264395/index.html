<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Debugging the rules of RewriteRule, or a little about the intimate life of mod_rewrite</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My RewriteEngine has always been a pretty stressful topic. Only recently I suddenly discovered that everything had somehow settled down and became mor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Debugging the rules of RewriteRule, or a little about the intimate life of mod_rewrite</h1><div class="post__text post__text-html js-mediator-article">  My <b>RewriteEngine</b> has always been a pretty stressful topic.  Only recently I suddenly discovered that everything had somehow settled down and became more or less clear.  Since I‚Äôm a completely ordinary person, I‚Äôm sure that the situation of a web server configuration error was ‚Äúnot getting‚Äù not just me, and I‚Äôm in a hurry to share my experience. <br><br>  It turned out to be a cross between a guide to using the <b>mod_rewrite</b> module and a kind of reference for configuring a web server using the .htaccess file.  Along the way, I would like to focus on particularly difficult or non-obvious points. <br><br>  It is assumed that the reader uses URL-rewriting in his work, he knows in general terms what <b>RewriteEngine is</b> and has already spent several hours setting it up.  This article is not quite for beginners, but not for super-pros, of course. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h4>  Baseline Data for Experiments </h4><br><ul><li>  All experiments are performed on a local host. </li><li>  Lampp server installed </li><li>  Apache version: 2.4.9 (build for Unix) </li><li>  In the <b>/ opt / lampp / htdocs / bbb / _engine folder there</b> is an experienced site on the domain <b>engine.bbb.ru</b> .  The specified folder is the root (DocumentRoot). </li><li>  In the root folder of the site is only one page <b>ind.php</b> . </li><li>  The site has one folder <b>/ opt / lampp / htdocs / bbb / _engine / local</b> . </li><li>  It contains one <b>ind1.php</b> script file <b>.</b> </li></ul><br><br><h4>  Configuring virtual hosts </h4><br>  In order to make it easier to work, to debug and not to wag one's nerves where it is possible not to do this, it would be good to configure virtual hosts in terms of convenience.  Consider the simplest settings that greatly facilitate our lives. <br><br><h5>  We adjust logs </h5><br>  Few people on the local server only one domain.  Domains usually a lot.  It would be nice to divide the logs by domain and by day, so that they do not grow too much.  This is done through the <b>&lt;VirtualHost&gt;</b> section of our server settings. <br><br>  For the error log on our domain, add the following two lines. <br><br><pre><code class="apache hljs"><span class="hljs-attribute"><span class="hljs-attribute">ErrorLog</span></span> <span class="hljs-string"><span class="hljs-string">"|/opt/lampp/bin/rotatelogs /opt/lampp/logs/engine-bbb-error.%Y.%m.%d.log 86400"</span></span> LogFormat <span class="hljs-string"><span class="hljs-string">"%h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-agent}i\""</span></span> combined</code> </pre> <br>  The first one sets the name of the error log for the virtual server and makes it necessary to start a new log every 86400 seconds.  <b>Rotatelogs</b> is a program that is generally included with the Apache web server, and I hope that you also have it installed. <br><br>  The second line sets the format of each line of the error log.  Details can be found in the Apache server documentation.  Everything is pretty clear there.  For this article, it's important to just keep in mind that the format is customizable. <br><br>  For the access log, I only include one line.  The default string format usually suits me. <br><br><pre> <code class="apache hljs"> <span class="hljs-attribute"><span class="hljs-attribute">CustomLog</span></span> <span class="hljs-string"><span class="hljs-string">"|/opt/lampp/bin/rotatelogs /opt/lampp/logs/engine-bbb-access.%Y.%m.%d.log 86400"</span></span> combined</code> </pre><br>  In both cases, pay attention to the paths to the web server programs and to the logs.  You must install the paths that exist on your computer. <br><br><h4>  The most general information about how everything works </h4><br>  Suppose we want to include an address rewriting service in some folder of our domain.  To do this, we have the line <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span></span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span></code> </pre><br>  in the <b>.htaccess</b> file that will manage this folder.  In addition, we have below this line other directives and a few rules for rewriting. <br><br>  Suppose a server receives an url as input.  RewriteEngine begins to check this URL using rules.  He does it top down in order.  If the input URL does not satisfy any rule, then it is what is called ‚Äúpasses‚Äù.  So, for example, suppose that we have the <b>index.php</b> file in the root folder.  If the input uri "/index.php" does not satisfy any rule, then we will see in the browser the result of this script. <br><br>  If we have the following rule <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteRule</span></span></span></span> ^index\.php$ /<span class="hljs-meta"><span class="hljs-meta"> [L]</span></span></code> </pre><br>  then, obviously, this rule for ur "index.php" will work.  In this case, the Uri will be rewritten to "" and the new Uri "/" will be sent to the server as input.  And the whole process of applying the rules will go again.  Only if uri "/" does not satisfy any of our rules, we will see what we want.  And if it satisfies, it will be rewritten again and everything will be repeated anew. <br><br><h4>  How does the flag [L] </h4><br>  This flag probably introduces a lot of misunderstandings.  The presence of a flag prevents the input uri from being checked for the rules following it if this rule has worked.  That‚Äôs all.  That is, if our ‚Äúindex.php‚Äù passed the test (the rule worked for it), then due to the presence of the <b>[L]</b> flag, we interrupt all subsequent checks, and the web server immediately rewrites ‚Äúindex.php‚Äù -&gt; "" and receives to the input uri "/" ([INTERNAL REDIRECT]), and everything repeats from the beginning, from the first rule.  And if this flag is not present, then the rewriting still happens and the check continues with the next rule.  But uri will be already changed, namely "/". <br><br>  Understanding this process immediately prevents many cyclical redirects. <br><br>  But excuse me, does the written above mean that if you do not use the [L] flag, we will save time and the page will open faster?  We stumble upon the flag [L] and have to go through all the rules without exception, and if we don‚Äôt set the flag [L], then we will rewrite the rule that has been triggered, go to the end of all the rules and finish it? <br><br>  I checked.  It does not work.  In the absence of flags [L], the module, as expected, replaces the uri on the triggered rule, follows all the remaining rules to the end, then produces [INTERNAL REDIRECT] and still passes all the rules with this uri again.  That is confirmed by what we wrote above.  This rule does not seem to have exceptions. <br><br>  <b><font color="maroon">Conclusion:</font></b> whenever the RewriteRule is triggered, [INTERNAL REDIRECT] occurs and all rules are reapplied.  This second pass begins either immediately after applying the rule with the [L] flag, or after all the rules run out, if we work without the [L] flags.  The situation of the ‚Äúpassage‚Äù of url, and it is called <b>‚Äúpass through‚Äù</b> can occur only if no rule has been applied.  The [L] flag can actually reduce the Uri processing time and should be used wherever possible. <br><br><h4>  What is RewriteBase? </h4><br>  This instruction, in my opinion, is just a record holder for incomprehensibility!  I would give her a prize for it!  In view of this, I have two stories about this beast - short and long.  A short story for those who do not want to bother with this instruction.  Long for interested. <br><br><h5>  Short story </h5><br>  If you are doing relatively simple URL rewriting using .htaccess files, I recommend that you always proceed as follows. <br><br><ul><li>  Do not use the described directive at all. </li><li>  In all rules of rewriting the target URL, always start with a slash (indicating that Uri is relative to the root of the site) </li></ul><br><br><h5>  Long story </h5><br>  When rewriting, the following processes will occur: <br><br>  We have: <br><ul><li>  Document Root: / opt / lampp / htdocs / bbb / _engine </li><li>  The .htaccess file is in the same place in the Document Root </li></ul><br>  We request url <b>engine.bbb.ru/ind.php</b> <br><ul><li>  The rewriting service will lead the path of the requested file to its path in the file system, namely <b>opt / lampp / htdocs / bbb / _engine / ind.php</b> </li><li>  Remove the <b>opt / lampp / htdocs / bbb / _engine /</b> prefix from it (matches the path to the folder containing .htaccess) </li><li>  Will apply rewriting rules using the string "ind.php" </li></ul><br>  If there is no .htaccess file in the <b>/ opt / lampp / htdocs / bbb / _engine / local folder</b> or there is no RewriteEngine <br><ul><li>  We request url engine.bbb.ru/local/ind1.php </li><li>  The rewriting service will lead the path of the requested file to its path in the file system, namely opt / lampp / htdocs / bbb / _engine / local / ind1.php </li><li>  Remove the opt / lampp / htdocs / bbb / _engine / prefix from it </li><li>  Will apply rewriting rules using the string "local / ind.php" </li></ul><br><br>  If the <b>/ opt / lampp / htdocs / bbb / _engine / local folder</b> contains a .htaccess file and RewriteEngine is included <br><ul><li>  We request url engine.bbb.ru/local/ind1.php </li><li>  The rewriting service will lead the path of the requested file to its path in the file system, namely opt / lampp / htdocs / bbb / _engine / local / ind1.php </li><li>  Remove the opt / lampp / htdocs / bbb / _engine / local / prefix from it (this is the path to the folder where the .htaccess file of the / local directory is located) </li><li>  Will apply rewriting rules using the string "ind1.php" </li></ul><br>  <b><font color="maroon">Attention!</font></b>  Such an algorithm will always be executed.  This algorithm expresses the specifics of the term " <b>per-dir</b> ", that is, the " <b>per-director</b> " approach embedded in the Apache server.  The value of the RewriteBase directive does not affect it (the algorithm). <br><br><h5>  What is the effect of the RewriteBase directive? </h5><br>  It must be very well remembered that the URL directive is indicated in the RewriteBase directive!  It is impossible to specify there " <b>local /</b> " There will be an error!  You can only " <b>/ local</b> ". <br><br>  Let us specify in our <b>/opt/lampp/htdocs/bbb/_engine/local/.htaccess</b> <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-attribute">RewriteBase</span></span> /local</code> </pre><br>  We request url <b>engine.bbb.ru/local/</b> <br><br>  Then the rule <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteRule</span></span></span></span> ^$ ind1.php</code> </pre><br>  It will work!  And the transition to uri will be made / <b>local /ind1.php</b> <br><br>  And the rule <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteRule</span></span></span></span> ^$ /ind1.php</code> </pre><br>  it will also work, but the transition will be made to uri <b>/ind1.php</b> .  File not found!  We have no such uri (relative to the root of the site)! <br><br>  <b><font color="maroon">Conclusion 1: The</font></b> URL that we specify in the RewriteBase is added as a prefix to the target Uri in the event that it is relative, that is, there is no slash at the beginning. <br><br>  <b><font color="maroon">Conclusion 2:</font></b> If we never use relative target uri in the rules, then we don‚Äôt need the RewriteBase directive! <br><br>  <b><font color="maroon">Conclusion 3:</font></b> If we use "RewriteBase /", then when the rule is triggered <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteRule</span></span></span></span> ^$ ind1.php</code> </pre><br>  There will be an attempt to go to uri /ind1.php.  We simply use "/" as a prefix. <br><br><div class="spoiler">  <b class="spoiler_title">Another experience (hooligan)</b> <div class="spoiler_text">  We have the following RewriteEngine rules in the root .htaccess: <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span></span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span> RewriteRule ^$ ind.php</code> </pre><br>  We request with this <b><a href="http://engine.bbb.ru/">engine.bbb.ru</a></b> <br><br>  If RewriteBase is url, then let's install <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-attribute">RewriteBase</span></span> http://bbb.ru</code> </pre><br>  Not.  Does not pass.  Error " <b><i>RewriteBase: argument is not a valid URL</i></b> ".  Strange, right?  But we do not give up!  Change RewriteBase! <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-attribute">RewriteBase</span></span> //bbb.ru</code> </pre><br>  In this case, there is no error!  What happens with the paths?  A lot of interesting! <br>  The server honestly gets the path <b>/ opt / lampp / htdocs / bbb / _engine /</b> , removes the prefix <b>/ opt / lampp / htdocs / bbb / _engine / from it</b> and works with an empty string (''). <br>  We run into the rule and change the empty string to 'ind.php' <br>  Honestly add the prefix " <b>//bbb.ru</b> " and go to the next pass.  This second pass is equivalent to calling <b><a href="http://engine.bbb.ru//bbb.ru/ind.php">engine.bbb.ru//bbb.ru/ind.php</a></b> , which, by and large, is not what we wanted (there was an initial desire to jump to another site).  In short, the idea did not justify itself.  As a result, we have an error 404, which is logical.  By the way, " <b>//</b> " were in the process of rewriting replaced by the server with " <b>/</b> ".  The trace of this example is given significantly below. <br></div></div><br><br><h4>  How did I get all this breathtaking information about the intimate life of the Apache server?  Or finally debugging </h4><br>  Really!  How did I see the errors that the renaming service gives?  After all, this is debugging!  There is a very useful directive that I put in virtual hosts for the domain <b>engine.bbb.ru</b> .  Namely <br><br><pre> <code class="apache hljs"> <span class="hljs-attribute"><span class="hljs-attribute">LogLevel</span></span> warn rewrite:trace4</code> </pre><br>  After insertion, I restarted Apache.  And from this point on, the domain error log, namely, the <b>/opt/lampp/logs/engine-bbb-error.2015.08.08.log</b> file began to insert trace lines related to the rewrite module.  Lines a lot.  Why <b>trace4</b> ?  Maybe you can insert <b>trace3</b> ?  Can.  But then it will not be possible to debug RewriteCond, there will not be detailed information as with which pattern we compare and information about some other events will disappear (not so important as interesting). <br><br>  What is " <b>warn</b> "?  Literally, our LogLevel entry means that for all modules, the level of warn errors is and only for the rewrite module - trace4 <br><br><h5>  What do we get by turning on debugging? </h5><br>  We get a trace, or a very, very detailed log.  There are really a lot of trace lines.  If I get into a complicated plug-in with the rules, and after some time of torment, I fail, and I decide to turn on tracing, then I disable all the rules in my .htaccess that do not apply to the subject URL.  I put in front of them the comment sign "#".  After that, I reload the page that does not work and I try to find the necessary lines in the log. <br><br>  I present the rewriting trace with the following conditions: <br><br>  We request: <pre>  http://engine.bbb.ru/ </pre><br>  Rules: <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span></span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span> RewriteRule ^$ /ind.php<span class="hljs-meta"><span class="hljs-meta"> [L]</span></span></code> </pre><br><br><pre> <code class="hljs markdown">[<span class="hljs-string"><span class="hljs-string">Sat Aug 08 15:41:38.664920 2015</span></span>] [<span class="hljs-string"><span class="hljs-string">rewrite:trace3</span></span>] [<span class="hljs-string"><span class="hljs-string">pid 21776</span></span>] mod<span class="hljs-emphasis"><span class="hljs-emphasis">_rewrite.c(475): [client 127.0.0.1:45382] 127.0.0.1 - - [engine.bbb.ru/sid#85a910][rid#dd7890/initial] [perdir /opt/lampp/htdocs/bbb/_</span></span>engine/] strip per-dir prefix: /opt/lampp/htdocs/bbb/<span class="hljs-emphasis"><span class="hljs-emphasis">_engine/ -&gt; [Sat Aug 08 15:41:38.664955 2015] [rewrite:trace3] [pid 21776] mod_</span></span>rewrite.c(475): [<span class="hljs-string"><span class="hljs-string">client 127.0.0.1:45382</span></span>] 127.0.0.1 - - [<span class="hljs-string"><span class="hljs-string">engine.bbb.ru/sid#85a910</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">rid#dd7890/initial</span></span>] [<span class="hljs-string"><span class="hljs-string">perdir /opt/lampp/htdocs/bbb/_engine/</span></span>] applying pattern '^$' to uri '' [<span class="hljs-string"><span class="hljs-string">Sat Aug 08 15:41:38.664960 2015</span></span>] [<span class="hljs-string"><span class="hljs-string">rewrite:trace2</span></span>] [<span class="hljs-string"><span class="hljs-string">pid 21776</span></span>] mod<span class="hljs-emphasis"><span class="hljs-emphasis">_rewrite.c(475): [client 127.0.0.1:45382] 127.0.0.1 - - [engine.bbb.ru/sid#85a910][rid#dd7890/initial] [perdir /opt/lampp/htdocs/bbb/_</span></span>engine/] rewrite '' -&gt; '/ind.php' [<span class="hljs-string"><span class="hljs-string">Sat Aug 08 15:41:38.664966 2015</span></span>] [<span class="hljs-string"><span class="hljs-string">rewrite:trace1</span></span>] [<span class="hljs-string"><span class="hljs-string">pid 21776</span></span>] mod<span class="hljs-emphasis"><span class="hljs-emphasis">_rewrite.c(475): [client 127.0.0.1:45382] 127.0.0.1 - - [engine.bbb.ru/sid#85a910][rid#dd7890/initial] [perdir /opt/lampp/htdocs/bbb/_</span></span>engine/] internal redirect with /ind.php [<span class="hljs-string"><span class="hljs-string">INTERNAL REDIRECT</span></span>] [<span class="hljs-string"><span class="hljs-string">Sat Aug 08 15:41:38.665040 2015</span></span>] [<span class="hljs-string"><span class="hljs-string">rewrite:trace3</span></span>] [<span class="hljs-string"><span class="hljs-string">pid 21776</span></span>] mod<span class="hljs-emphasis"><span class="hljs-emphasis">_rewrite.c(475): [client 127.0.0.1:45382] 127.0.0.1 - - [engine.bbb.ru/sid#85a910][rid#dde8b8/initial/redir#1] [perdir /opt/lampp/htdocs/bbb/_</span></span>engine/] strip per-dir prefix: /opt/lampp/htdocs/bbb/<span class="hljs-emphasis"><span class="hljs-emphasis">_engine/ind.php -&gt; ind.php [Sat Aug 08 15:41:38.665044 2015] [rewrite:trace3] [pid 21776] mod_</span></span>rewrite.c(475): [<span class="hljs-string"><span class="hljs-string">client 127.0.0.1:45382</span></span>] 127.0.0.1 - - [<span class="hljs-string"><span class="hljs-string">engine.bbb.ru/sid#85a910</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">rid#dde8b8/initial/redir#1</span></span>] [<span class="hljs-string"><span class="hljs-string">perdir /opt/lampp/htdocs/bbb/_engine/</span></span>] applying pattern '^$' to uri 'ind.php' [<span class="hljs-string"><span class="hljs-string">Sat Aug 08 15:41:38.665046 2015</span></span>] [<span class="hljs-string"><span class="hljs-string">rewrite:trace1</span></span>] [<span class="hljs-string"><span class="hljs-string">pid 21776</span></span>] mod<span class="hljs-emphasis"><span class="hljs-emphasis">_rewrite.c(475): [client 127.0.0.1:45382] 127.0.0.1 - - [engine.bbb.ru/sid#85a910][rid#dde8b8/initial/redir#1] [perdir /opt/lampp/htdocs/bbb/_</span></span>engine/] pass through /opt/lampp/htdocs/bbb/_engine/ind.php</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Tracing the hooligan example from the long history section</b> <div class="spoiler_text"><pre> <code class="hljs markdown">[<span class="hljs-string"><span class="hljs-string">Sat Aug 08 15:09:37.475389 2015</span></span>] [<span class="hljs-string"><span class="hljs-string">rewrite:trace3</span></span>] [<span class="hljs-string"><span class="hljs-string">pid 21775</span></span>] mod<span class="hljs-emphasis"><span class="hljs-emphasis">_rewrite.c(475): [client 127.0.0.1:45327] 127.0.0.1 - - [engine.bbb.ru/sid#85a910][rid#de2740/initial] [perdir /opt/lampp/htdocs/bbb/_</span></span>engine/] strip per-dir prefix: /opt/lampp/htdocs/bbb/<span class="hljs-emphasis"><span class="hljs-emphasis">_engine/ -&gt; [Sat Aug 08 15:09:37.475406 2015] [rewrite:trace3] [pid 21775] mod_</span></span>rewrite.c(475): [<span class="hljs-string"><span class="hljs-string">client 127.0.0.1:45327</span></span>] 127.0.0.1 - - [<span class="hljs-string"><span class="hljs-string">engine.bbb.ru/sid#85a910</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">rid#de2740/initial</span></span>] [<span class="hljs-string"><span class="hljs-string">perdir /opt/lampp/htdocs/bbb/_engine/</span></span>] applying pattern '^$' to uri '' [<span class="hljs-string"><span class="hljs-string">Sat Aug 08 15:09:37.475411 2015</span></span>] [<span class="hljs-string"><span class="hljs-string">rewrite:trace2</span></span>] [<span class="hljs-string"><span class="hljs-string">pid 21775</span></span>] mod<span class="hljs-emphasis"><span class="hljs-emphasis">_rewrite.c(475): [client 127.0.0.1:45327] 127.0.0.1 - - [engine.bbb.ru/sid#85a910][rid#de2740/initial] [perdir /opt/lampp/htdocs/bbb/_</span></span>engine/] rewrite '' -&gt; 'ind.php' [<span class="hljs-string"><span class="hljs-string">Sat Aug 08 15:09:37.475414 2015</span></span>] [<span class="hljs-string"><span class="hljs-string">rewrite:trace3</span></span>] [<span class="hljs-string"><span class="hljs-string">pid 21775</span></span>] mod<span class="hljs-emphasis"><span class="hljs-emphasis">_rewrite.c(475): [client 127.0.0.1:45327] 127.0.0.1 - - [engine.bbb.ru/sid#85a910][rid#de2740/initial] [perdir /opt/lampp/htdocs/bbb/_</span></span>engine/] add per-dir prefix: ind.php -&gt; /opt/lampp/htdocs/bbb/<span class="hljs-emphasis"><span class="hljs-emphasis">_engine/ind.php [Sat Aug 08 15:09:37.475418 2015] [rewrite:trace2] [pid 21775] mod_</span></span>rewrite.c(475): [<span class="hljs-string"><span class="hljs-string">client 127.0.0.1:45327</span></span>] 127.0.0.1 - - [<span class="hljs-string"><span class="hljs-string">engine.bbb.ru/sid#85a910</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">rid#de2740/initial</span></span>] [<span class="hljs-string"><span class="hljs-string">perdir /opt/lampp/htdocs/bbb/_engine/</span></span>] trying to replace prefix /opt/lampp/htdocs/bbb/<span class="hljs-emphasis"><span class="hljs-emphasis">_engine/ with //bbb.ru [Sat Aug 08 15:09:37.475420 2015] [rewrite:trace4] [pid 21775] mod_</span></span>rewrite.c(475): [<span class="hljs-string"><span class="hljs-string">client 127.0.0.1:45327</span></span>] 127.0.0.1 - - [<span class="hljs-string"><span class="hljs-string">engine.bbb.ru/sid#85a910</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">rid#de2740/initial</span></span>] add subst prefix: ind.php -&gt; //bbb.ru/ind.php [<span class="hljs-string"><span class="hljs-string">Sat Aug 08 15:09:37.475422 2015</span></span>] [<span class="hljs-string"><span class="hljs-string">rewrite:trace1</span></span>] [<span class="hljs-string"><span class="hljs-string">pid 21775</span></span>] mod<span class="hljs-emphasis"><span class="hljs-emphasis">_rewrite.c(475): [client 127.0.0.1:45327] 127.0.0.1 - - [engine.bbb.ru/sid#85a910][rid#de2740/initial] [perdir /opt/lampp/htdocs/bbb/_</span></span>engine/] internal redirect with //bbb.ru/ind.php [<span class="hljs-string"><span class="hljs-string">INTERNAL REDIRECT</span></span>] [<span class="hljs-string"><span class="hljs-string">Sat Aug 08 15:09:37.475469 2015</span></span>] [<span class="hljs-string"><span class="hljs-string">rewrite:trace3</span></span>] [<span class="hljs-string"><span class="hljs-string">pid 21775</span></span>] mod<span class="hljs-emphasis"><span class="hljs-emphasis">_rewrite.c(475): [client 127.0.0.1:45327] 127.0.0.1 - - [engine.bbb.ru/sid#85a910][rid#dd8dc8/initial/redir#1] [perdir /opt/lampp/htdocs/bbb/_</span></span>engine/] add path info postfix: /opt/lampp/htdocs/bbb/<span class="hljs-emphasis"><span class="hljs-emphasis">_engine/bbb.ru -&gt; /opt/lampp/htdocs/bbb/_</span></span>engine/bbb.ru/ind.php [<span class="hljs-string"><span class="hljs-string">Sat Aug 08 15:09:37.475473 2015</span></span>] [<span class="hljs-string"><span class="hljs-string">rewrite:trace3</span></span>] [<span class="hljs-string"><span class="hljs-string">pid 21775</span></span>] mod<span class="hljs-emphasis"><span class="hljs-emphasis">_rewrite.c(475): [client 127.0.0.1:45327] 127.0.0.1 - - [engine.bbb.ru/sid#85a910][rid#dd8dc8/initial/redir#1] [perdir /opt/lampp/htdocs/bbb/_</span></span>engine/] strip per-dir prefix: /opt/lampp/htdocs/bbb/<span class="hljs-emphasis"><span class="hljs-emphasis">_engine/bbb.ru/ind.php -&gt; bbb.ru/ind.php [Sat Aug 08 15:09:37.475476 2015] [rewrite:trace3] [pid 21775] mod_</span></span>rewrite.c(475): [<span class="hljs-string"><span class="hljs-string">client 127.0.0.1:45327</span></span>] 127.0.0.1 - - [<span class="hljs-string"><span class="hljs-string">engine.bbb.ru/sid#85a910</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">rid#dd8dc8/initial/redir#1</span></span>] [<span class="hljs-string"><span class="hljs-string">perdir /opt/lampp/htdocs/bbb/_engine/</span></span>] applying pattern '^$' to uri 'bbb.ru/ind.php' [<span class="hljs-string"><span class="hljs-string">Sat Aug 08 15:09:37.475478 2015</span></span>] [<span class="hljs-string"><span class="hljs-string">rewrite:trace1</span></span>] [<span class="hljs-string"><span class="hljs-string">pid 21775</span></span>] mod<span class="hljs-emphasis"><span class="hljs-emphasis">_rewrite.c(475): [client 127.0.0.1:45327] 127.0.0.1 - - [engine.bbb.ru/sid#85a910][rid#dd8dc8/initial/redir#1] [perdir /opt/lampp/htdocs/bbb/_</span></span>engine/] pass through /opt/lampp/htdocs/bbb/_engine/bbb.ru</code> </pre><br></div></div><br><br>  Note that each line is marked with a level indication ( <b>rewrite: trace_</b> ).  Apparently, if you find in the log some one line you need, and you want to see only the same type, then you change the trace level, restart Apache and repeat the operation.  It seems to me personally that this way is not quite an easy task.  It is much easier, in my opinion, to first copy the lines into a separate file, focusing only on the time of the operation (by minutes).  Then separate the other necessary lines from them by removing unnecessary information (search-replace).  At first I even thought of making a PHP tool for viewing logs of this kind.  But then the need disappeared by itself (I‚Äôll dwell on this below). <br><br><h5>  Debugging is valid for the virtual host for which it is specified. </h5><br>  If the <b>engine.bbb.ru</b> domain uses external css styles, which are taken from the <b>bbb.ru</b> domain, and this is the problem, then you do not need to enable debugging within the virtual server engine.bbb.ru, but you need to enable it in the virtual server bbb.ru .  Then all calls to the bbb.ru domain should be viewed in the error logs (not access!) Of the bbb.ru domain.  At the same time, calls to the traced objects will not be in the access logs at all! <br><br><h4>  And you can not use such a stressful RewriteEngine at all? </h4><br>  You can switch to using just one script for the entire site and re-write all of it.  In PHP, this is easier to do, and debugging is much easier.  In addition to the obvious advantages in terms of site security, we get the convenience of rewriting without hassle.  In order to switch to such a scheme of work, our .htaccess should be something like this: <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span></span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span> #   <span class="hljs-string"><span class="hljs-string">" www"</span></span>  <span class="hljs-string"><span class="hljs-string">" www"</span></span> RewriteCond <span class="hljs-variable"><span class="hljs-variable">%{HTTP_HOST}</span></span> ^www\.our-site\.ru$ RewriteRule ^(.*)$ http://our-site.ru/<span class="hljs-number"><span class="hljs-number">$1</span></span><span class="hljs-meta"><span class="hljs-meta"> [R=301,L] #  4  ,    . RewriteCond %{REQUEST_URI} !favicon\.ico$ RewriteCond %{REQUEST_URI} !robots\.txt$ RewriteCond %{REQUEST_URI} !sitemap\.xml$ RewriteCond %{REQUEST_URI} !^/dispatch\.php$ RewriteRule ^.*$ /dispatch.php [L]</span></span></code> </pre><br><br>  And in the <b>dispatch.php</b> script, I strongly advise you not to forget to prohibit direct calling of the dispatch.php itself. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (preg_match(<span class="hljs-string"><span class="hljs-string">'#^/dispatch.php#'</span></span>, $_SERVER[<span class="hljs-string"><span class="hljs-string">'REQUEST_URI'</span></span>]) == <span class="hljs-number"><span class="hljs-number">1</span></span>) { redirect_to_bad_uri(); }</code> </pre><br><br>  If you suddenly want to adopt this approach, then I recommend calling the <b>dispatch.php</b> script something else.  I used this name only for clarity. <br><br>  By the way, this approach is being implemented quite actively.  To this we should be grateful for the introduction of CNC (URLs that are understandable to humans, although for me personally they are very incomprehensible).  Practically in all modern engines it already operates. <br><br><div class="spoiler">  <b class="spoiler_title">The virtual server section engine.bbb.ru that I used</b> <div class="spoiler_text"><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;VirtualHost 127.0.0.9:80&gt;</span></span> <span class="hljs-attribute"><span class="hljs-attribute">ServerAdmin</span></span> webmaster@serv1.ru DocumentRoot <span class="hljs-string"><span class="hljs-string">"/opt/lampp/htdocs/bbb/_engine"</span></span> ServerName <span class="hljs-string"><span class="hljs-string">"engine.bbb.ru"</span></span> ServerAlias <span class="hljs-string"><span class="hljs-string">"www.engine.bbb.ru"</span></span> ScriptAlias /cgi/ <span class="hljs-string"><span class="hljs-string">"/opt/lampp/cgi-bin/"</span></span> ScriptAlias /cgi-bin/ <span class="hljs-string"><span class="hljs-string">"/opt/lampp/cgi-bin/"</span></span> ErrorLog <span class="hljs-string"><span class="hljs-string">"|/opt/lampp/bin/rotatelogs /opt/lampp/logs/engine-bbb-error.%Y.%m.%d.log 86400"</span></span> LogFormat <span class="hljs-string"><span class="hljs-string">"%h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-agent}i\""</span></span> combined CustomLog <span class="hljs-string"><span class="hljs-string">"|/opt/lampp/bin/rotatelogs /opt/lampp/logs/engine-bbb-access.%Y.%m.%d.log 86400"</span></span> combined #      . # LogLevel warn rewrite:trace4 &lt;/VirtualHost&gt;</code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/264395/">https://habr.com/ru/post/264395/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264383/index.html">Tox developers disassociate themselves from the Tox Foundation</a></li>
<li><a href="../264385/index.html">The study "The global state of information security 2015" (GSISS 2015). Part 1</a></li>
<li><a href="../264387/index.html">Announcement Rust 1.2</a></li>
<li><a href="../264389/index.html">We measure power consumption for ASIC digital blocks (even before manufacturing)</a></li>
<li><a href="../264391/index.html">Build USB HID under BeagleBone</a></li>
<li><a href="../264397/index.html">Pipeline with spark.ml</a></li>
<li><a href="../264399/index.html">The digest of interesting materials for the mobile # 115 developer (August 2-9)</a></li>
<li><a href="../264401/index.html">IBM Launches 50 Projects for the Open Source Developer Community</a></li>
<li><a href="../264405/index.html">Ministry of Defense accused of sending sensitive information through public postal services</a></li>
<li><a href="../264407/index.html">Buying the best apartment with R</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>