<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Objective-C Runtime. Theory and practical application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post I want to turn to a topic about which many novice iPhone developers often have a vague idea: Objective-C Runtime. Many people know that i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Objective-C Runtime. Theory and practical application</h1><div class="post__text post__text-html js-mediator-article">  In this post I want to turn to a topic about which many novice iPhone developers often have a vague idea: Objective-C Runtime.  Many people know that it exists, but what are its capabilities and how to use it in practice? <br>  Let's try to understand the basic functions of this library.  The material is based on lectures that we use at <a href="http://coalla.ru/">Coalla</a> to train employees. <br><a name="habracut"></a><br><h4>  What is Runtime? </h4><br>  Objective-C was conceived as an add-on to the C language, adding support for the object-oriented paradigm to it.  In fact, from the point of view of syntax, Objective-C is a rather small set of keywords and control structures over ordinary C. It is Runtime, the runtime library, provides that set of functions that breathe life into a language, realizing its dynamic capabilities and ensuring the functioning of OOP . <br><br><h5>  Basic data structures </h5><br>  Functions and structures of the Runtime library are defined in several header files: <code>objc.h</code> , <code>runtime.h</code> and <code>message.h</code> .  First, look at the <code>objc.h</code> file and see what the object is from the point of view of Runtime: <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> objc_class *Class; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> objc_object { Class isa; } *<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>;</code> </pre><br>  We see that the object in the process of the program is represented by the usual C-structure.  Each Objective-C object has a reference to its class ‚Äî the so-called isa-pointer.  I think everyone saw it when viewing the structure of objects while debugging applications.  In turn, the class also has a similar structure: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> objc_class { Class isa; };</code> </pre><br>  A class in Objective-C is a full-fledged object and it also has an isa-pointer to a ‚Äúclass of class‚Äù, the so-called <a href="http://www.sealiesoftware.com/blog/archive/2009/04/14/objc_explain_Classes_and_metaclasses.html">metaclass</a> in terms of Objective-C.  Similarly, C-structures are defined for other entities of the language: <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> objc_selector *SEL; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> objc_method *Method; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> objc_ivar *Ivar; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> objc_category *Category; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> objc_property *objc_property_t;</code> </pre><br><br><h5>  Runtime Library Functions </h5><br>  In addition to defining the basic structures of the language, the library includes a set of functions that work with these structures.  They can be divided into several groups (the function assignment is usually obvious from their name): <br><ul><li>  Class manipulation: <code>class_addMethod</code> , <code>class_addIvar</code> , <code>class_replaceMethod</code> </li><li>  Creating new classes: <code>class_allocateClassPair</code> , <code>class_registerClassPair</code> </li><li>  Introspection: <code>class_getName</code> , <code>class_getSuperclass</code> , <code>class_getInstanceVariable</code> , <code>class_getProperty</code> , <code>class_copyMethodList</code> , <code>class_copyIvarList</code> , <code>class_copyPropertyList</code> </li><li>  Object manipulation: <code>objc_msgSend</code> , <code>objc_getClass</code> , <code>object_copy</code> </li><li>  Work with associative links </li></ul><br><h5>  Example 1. Introspection of an object </h5><br>  Consider an example of using the Runtime library.  In one of our projects, the data model is a plain old Objective-C object with a certain set of properties: <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">COConcreteObject</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">COBaseObject</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSNumber</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quantity</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  For debugging convenience, I would like the information on the state of the properties of the object to be printed to the log instead of something like <code>&lt;COConcreteObject: 0x71d6860&gt;</code> .  Since the data model is quite extensive, with a large number of different subclasses, it is undesirable to write for each class a separate <code>description</code> method in which to manually collect the values ‚Äã‚Äãof its properties.  Objective-C Runtime comes to the rescue: <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">COBaseObject</span></span></span><span class="hljs-class"> - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">description</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">NSMutableDictionary</span></span> *propertyValues = [<span class="hljs-built_in"><span class="hljs-built_in">NSMutableDictionary</span></span> dictionary]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> propertyCount; objc_property_t *properties = class_copyPropertyList([<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>], &amp;propertyCount); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; propertyCount; i++) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> *propertyName = property_getName(properties[i]); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *attr = property_getAttributes(properties[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (attr[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'@'</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *selector = [<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> stringWithCString:propertyName encoding:<span class="hljs-built_in"><span class="hljs-built_in">NSUTF8StringEncoding</span></span>]; SEL sel = sel_registerName([selector UTF8String]); <span class="hljs-built_in"><span class="hljs-built_in">NSObject</span></span> * propertyValue = objc_msgSend(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, sel); propertyValues[selector] = propertyValue.description; } } free(properties); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> stringWithFormat:<span class="hljs-string"><span class="hljs-string">@"%@: %@"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.class, propertyValues]; } <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span></code> </pre><br>  The method defined in the general superclass of model objects receives a list of all object properties using the <code>class_copyPropertyList</code> function.  Then property values ‚Äã‚Äãare collected in <code>NSDictionary</code> , which is used when constructing the string representation of the object.  This algorithm works only with properties that are Objective-C objects.  Type checking is performed using the <code>property_getAttributes</code> function.  The result of the method looks like this: <br><br>  <i>2013-05-04 15: 54: 01.992 Test [40675: 11303] COConcreteObject: {</i> <i><br></i>  <i>name = Foo;</i> <i><br></i>  <i>quantity = 10;</i> <i><br></i>  <i>title = bar;</i> <i><br></i>  <i>}</i> <br><br><h4>  Messages </h4><br>  The system for invoking methods in Objective-C is implemented by sending messages to the object.  Each method call is translated to the corresponding function call <code>objc_msgSend</code> : <br><br><pre> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">//   [array insertObject:foo atIndex:1]; //    Runtime- objc_msgSend(array, @selector(insertObject:atIndex:), foo, 1);</span></span></code> </pre><br>  The call <code>objc_msgSent</code> initiates the process of searching for the implementation of the method corresponding to the selector passed to the function.  The implementation of the method is looked up in the so-called class dispatch table.  Since this process can be quite long, a cache of methods is associated with each class.  After the first call of any method, the result of the search for its implementation will be cached in the class.  If the implementation of the method is not found in the class itself, then the search continues up the inheritance hierarchy in the superclasses of this class.  If, however, the result is not reached in the hierarchy search, the dynamic search mechanism comes into <code>resolveInstanceMethod</code> - one of the special methods is called: <code>resolveInstanceMethod</code> or <code>resolveClassMethod</code> .  Redefining these methods is one of the last ways to influence Runtime: <br><br><pre> <code class="objectivec hljs">+ (<span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span>)resolveInstanceMethod:(SEL)aSelector { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (aSelector == <span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(myDynamicMethod)) { class_addMethod(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, aSelector, (IMP)myDynamicIMP, <span class="hljs-string"><span class="hljs-string">"v@:"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">YES</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> resolveInstanceMethod:aSelector]; }</code> </pre><br>  Here you can dynamically specify your implementation of the called method.  If this mechanism for some reason does not suit you, you can use <a href="https://developer.apple.com/library/mac/">forward forwarding</a> messages. <br><br><h5>  Example 2. Method Swizzling </h5><br>  One of the features of categories in Objective-C is that the method defined in the category completely overlaps the base class method.  Sometimes we need not to override, but to expand the functionality of the existing method.  Suppose, for example, for some reason we want to log all additions of elements to the <code>NSMutableArray</code> array.  Standard language tools do this not work.  But we can use a technique called method swizzling: <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSMutableArray</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CO</span></span></span><span class="hljs-class">) + (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">load</span></span></span><span class="hljs-class"> </span></span>{ Method addObject = class_getInstanceMethod(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(addObject:)); Method logAddObject = class_getInstanceMethod(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(logAddObject:)); method_exchangeImplementations(addObject, logAddObject); } - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)logAddObject:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)aObject { [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> logAddObject:aObject]; <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"  %@   %@"</span></span>, aObject, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span></code> </pre><br>  We overload the <code>load</code> method ‚Äî this is a special callback that, if defined in a class, will be called during the initialization of this class ‚Äî before any of its other methods are called.  Here we swap the implementation of the base method <code>addObject:</code> and our method <code>logAddObject:</code>  Note the ‚Äúrecursive‚Äù call to <code>logAddObject:</code> - this is the call to the overloaded implementation of the main method. <br><br><h5>  Example 3. Associative links </h5><br>  Another known limitation of categories is the impossibility of creating new instance variables in them.  Suppose, for example, you need to add a new property to the library class <code>UITableView</code> - a link to the ‚Äústub‚Äù, which will be shown when the table is empty: <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableView</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Additions</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIView</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">placeholderView</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Out of the box this code will not work, you will get an exception during the execution of the program.  This problem can be circumvented using the functionality of associative links: <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> key; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableView</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Additions</span></span></span><span class="hljs-class">) -(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setPlaceholderView</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIView</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">placeholderView</span></span></span><span class="hljs-class"> </span></span>{ objc_setAssociatedObject(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, &amp;key, placeholderView, OBJC_ASSOCIATION_RETAIN_NONATOMIC); } -(<span class="hljs-built_in"><span class="hljs-built_in">UIView</span></span> *) placeholderView { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> objc_getAssociatedObject(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, &amp;key); } <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span></code> </pre><br>  You can use any object as an associative array, associating other objects with it using the <code>objc_setAssociatedObject</code> function.  Its operation requires a key by which you can then retrieve the object you need back using the <code>objc_getAssociatedObject</code> call.  In this case, you cannot use the copied key value - it must be exactly the object (in the example, a pointer) that was passed in the <code>objc_setAssociatedObject</code> call. <br><br><h4>  Conclusion </h4><br>  Now you have a basic idea of ‚Äã‚Äãwhat an Objective-C Runtime is and how it can be useful for a developer in practice.  For those who want to learn the possibilities of the library deeper, I can advise the following additional resources: <br><ul><li>  <a href="https://developer.apple.com/library/mac/">Objective-C Runtime Programming Guide</a> - Apple Documentation </li><li>  <a href="http://www.mikeash.com/pyblog/">Mike Ash Blog</a> - Objective-C development guru articles </li></ul></div><p>Source: <a href="https://habr.com/ru/post/177421/">https://habr.com/ru/post/177421/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../177409/index.html">Durex created vibrating underwear that can be controlled via smartphone</a></li>
<li><a href="../177411/index.html">The digest of news from the world of mobile development for the last week ‚Ññ10 (April 15 - 21, 2013)</a></li>
<li><a href="../177413/index.html">Applications for Sony NEX-6</a></li>
<li><a href="../177415/index.html">Peter Molyneu pushed two options for monetization in Curiosity</a></li>
<li><a href="../177419/index.html">Nokia: quarterly results</a></li>
<li><a href="../177423/index.html">Attempt to dispel the myths about OpenVZ, or VPS on OpenVZ vs Xen / KVM / Hyper-V / etc</a></li>
<li><a href="../177425/index.html">The slowest Linux machine</a></li>
<li><a href="../177427/index.html">Editing your article on Habr√© by highlighting a quote in HabrAjax; Iceweasel support</a></li>
<li><a href="../177431/index.html">Analog FreeAndNil with type checking</a></li>
<li><a href="../177433/index.html">The CIA is big tasks and big data. Towards a Global Information Cap</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>