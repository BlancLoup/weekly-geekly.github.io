<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Smart home architecture - with Black Swift and not only</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 If earlier we looked at the projects of the ‚Äúsmart home‚Äù with interest, but somewhat from the outside, now, after Black Swift entered the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Smart home architecture - with Black Swift and not only</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><br>  If earlier we looked at the projects of the ‚Äúsmart home‚Äù with interest, but somewhat from the outside, now, after <a href="http://black-swift.ru/">Black Swift</a> entered the public field, we ourselves began to receive questions and suggestions on using it as a base for the ‚Äúsmart home‚Äù - and of course I could not help but pay special attention to this topic. <br><br>  The result upset me, and I would like to talk about it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Projects of the ‚Äúsmart home‚Äù are now born (and dying) like mushrooms - but, unfortunately, in most cases they are not due to the awareness of the shortcomings of existing solutions, but by the very fact that there are technological platforms on which something can be built.  This is clearly seen by Habr: as one or another solution is popularized, a wave of next ‚Äúwireless sockets‚Äù on it passes.  So it was with the NRF24LE1, now the same wave is coming from the ESP8266.  Some promising projects in their life have time to change two or three platforms - depending on the current fashion and the presence of someone who can solder something on one of them. <br><br>  All this is often too similar to finding lost keys where it is lighter, as well as hammering screws with a hammer simply because there were a hammer and screws at hand at the same time. <br><br>  I will not touch any serious problems of ‚Äúsmart houses‚Äù, but I will talk about why and what technologies should be considered as a basis - not to explain in the comments for the fiftieth time why I do not consider embedding Wi-Fi in each outlet Neither necessary nor reasonable decision. <br><br>  Oh yeah, I almost forgot KDPV.  Here is: <br><br><img src="https://habrastorage.org/files/cbf/b64/c86/cbfb64c86ff64eeebe049d61f261fa1a.png"><br><br>  It is not about ‚Äúsmart home‚Äù, but about the fact that Black Swift can be found on the MWC at the stand of Imagination Technologies.  And now let's talk about ‚Äúsmart home‚Äù. <br><a name="habracut"></a><br>  The natural aspiration of a person who saw Black Swift, EL-M150, ESP8266 for the first time in his life, or some other similar solution, is to shove him everywhere.  After all, it would seem that it is simpler - since in any smartphone there is Wi-Fi, then by connecting all the lights, sockets and switches to Wi-Fi in the house, we will get that ‚Äúsmart home‚Äù, which for many looks like a smartphone application that allows flashing light bulb in the chandelier.  About the same fate befalls and Bluetooth-modules, albeit with a lower frequency. <br><br>  It turns out this is about the scheme: <br><br><img src="https://habrastorage.org/files/32d/eb7/80b/32deb780bf06459dbfb8b62d047d345d.png"><br><br>  However, it quickly becomes obvious that it does not solve the task of creating a ‚Äúsmart home‚Äù because all this set of devices does not have a unifying element - they just got access to the network.  Unfortunately, for some reason, the user does not want to memorize the IP addresses of all twenty-three light bulbs in his apartment, and what to do on this network to the remotes is completely incomprehensible. <br><br>  Technically, you can build a distributed system in which the devices themselves will detect each other and learn about each other‚Äôs status and capabilities, and the smartphone application will also get information about all the devices currently available from the network and show them in a beautiful interface.  It is tempting, flexible, but difficult - especially if questions start that it would be nice to have access from the outside, and a browser-based web interface ... <br><br>  Therefore, a central controller appears in the system in a natural way, on which all existing devices are registered, and it already provides a web interface, scripts, and command transmission between devices, and women with games of chance: <br><br><img src="https://habrastorage.org/files/c2f/e70/5c2/c2fe705c2d6549cbbf9525fb7a7d6350.png"><br><br>  Stop!  But after all, we used Wi-Fi to bring all the devices into an accessible and understandable data transfer medium in one step - and in this scheme it is already more than one step, because access to Wi-Fi sockets and a kettle does not play any more role for anyone except the central controller.  That is, Wi-Fi begins to lose its main advantage. <br><br>  At the same time, Wi-Fi has quite serious drawbacks: <br><br><ul><li>  <b>Power consumption</b> .  To ensure quick response, the device must always be connected to the network.  In the same ESP8266, this means a power consumption of about 0.3 mW, which means that on an AA battery with its ~ 1750 mW / h in ideal conditions, it will be possible to get 8 months of work.  In reality - no more than 6 months, since there is still DC-DC between the battery and the chip with an efficiency of about 85%, the chip itself consumes much more at the time of data transfer, and so on.  Believe me, you do not want to change the batteries throughout the house every six months.  Moreover, even AA makes the device quite cumbersome - if you want, for example, a flat switch that can be glued anywhere on the wall or furniture, you need a CR2032 or, at most, a CR2450.  You will change them once every two or three months.  The alternative is to take the ESP8266 into a deep sleep, but then the response to the touch of the switch will be up to a second late (yes, it quickly connects to the network, but not so fast that it is not easily noticeable to the naked eye). </li><li>  <b>Range</b>  Wi-Fi is quite well silenced by the walls, even in the 2.4 GHz band, and in the wall socket you will not only have an antenna installed inside the wall, but also covered on top with a steel frame of the socket block.  In the corners of the house, where the reception of the network is weak, sockets can simply not see it.  And this is not touching the issue of scalability: for some reason, the authors of the majority of ‚Äúsmart houses‚Äù limit their imagination to apartments, without thinking that such technologies can be in demand on the scale of buildings.  Have you ever tried to catch Wi-Fi under the door of a hotel room, because nowhere else is it caught in the room?  I - repeatedly.  Therefore, the project of such a "smart home" will have to lay down yet ensuring stable Wi-Fi coverage throughout the building. </li><li>  <b>Immunity</b> .  The 2.4 GHz band is not just forgotten by access points - it is perfectly muffled by microwaves operating at 2.45 GHz.  Weak reception of a network in this corner of the house and a microwave behind a wall at neighbors - and everything, periodically your sockets disappear. </li><li>  <b>Scalable</b> .  In general, when I say this word, I usually mean the transition from the scale of an apartment to a cottage and further to large buildings, but in the case of Wi-Fi everything is simpler - it doesn‚Äôt scale well even within an apartment.  A full-fledged ‚Äúsmart home‚Äù of the scale of an ordinary 2-3-room apartment implies a half or two dozen devices using the network - and so, with so many clients who simultaneously rush to it behind the network, the feet go up: either it goes completely to the astral , or manages to give out the network to the top ten.  That is, at the moment of switching on the electricity in the apartment, your ‚Äúsmart home‚Äù will simply arrange a DDOS attack on your router. </li></ul><br><br>  In general, you can continue, but it is already quite obvious that Wi-Fi in such a scheme becomes a strange choice for intra-system communication.  And all of them, in general, grow from the fact that Wi-Fi is a network designed for the constant presence of devices in it and large amounts of transmitted data.  It was never designed by anyone, taking into account the peculiarities of the operation of the light switch, which needs to be transmitted three bytes ten times a day. <br><br>  At the same time, it cannot be said that there are no other radio frequency solutions - firstly, the NRF24LE1 mode, operating in the 2.4 GHz band, arrived and passed not so long ago.  I must say at once that we tried them in the role we were discussing and almost instantly became disillusioned - the range of stable communication in real conditions is regrettable for them.  Secondly, there is simply a bunch of classics on the 433.92 and 868 MHz bands - the same TI CC1101 or single-chip solutions of the type CC430F6137, having both a radio frequency module and a processor core.  In these bands, a license for using transmitters up to 10 mW is not needed, these solutions are quite good with the communication range, and the only drawback is the antenna dimensions ‚Äî a quarter of the wavelength for 433.92 MHz is still 16.5 cm. These solutions are easily purchased both in the form of modules and in the form of the chips themselves. <br><br>  Everything is good with them and with efficiency - we do not need constant maintenance of the presence on the air with such systems (moreover, at 868 MHz there are legal restrictions), and in a dream they consume a maximum of a unit of microamps, waking up only for data transmission.  Accordingly, for the control panel immediately become a reality 1-2 years of work on the CR2032. <br><br>  But at the same time, there is a place for Wi-Fi - you just need to understand exactly where it is: <br><br><img src="https://habrastorage.org/files/b1d/094/b41/b1d094b414ef43ddb0a42d2767861077.png"><br><br>  So, we have a central controller that provides the logic of the system and the interface to the outside world - Wi-Fi or Ethernet (obviously, connected to a Wi-Fi router).  It has a wired and / or wireless interface for communicating with the subordinate elements of the ‚Äúsmart home‚Äù - a specific choice is determined by specific conditions, although if you get into a slightly different topic, the wireless interface has a great advantage: it does not require repairs to be installed.  No, as long as you are focusing on the traditional Russian market of "elite assemblers", taking from 300 thousand rubles for only one project of a "smart home" for a two-room shop on Biryulyovo-commodity, this is not a problem.  But as soon as you want to enter a more massive segment, or, God forbid, the B2B market, customer persuasion for overhaul may not be so easy. <br><br>  Moreover, although in principle such a controller can be built a lot on what, using Black Swift provides compactness - in the case of, for example, one wireless interface, all electronics easily retract into a DIN-rail housing the size of a standard RCD 35.5 mm wide. <br><br>  Executive devices in such a scheme are simple and cheap, and most importantly - they provide you with clear communication quality and power consumption, which makes normal battery power possible (less than a year of work, I insistently ask you not to consider normal power).  And the kopek microcontroller in them (integrated with the radio module or separate, the same PIC) fully provides all their capabilities, because no complex network protocols from a dimmer or wall switch are required. <br><br>  At the same time, it is not necessary to completely eliminate Wi-Fi from communications within the system - you just need to understand when you need it.  Let's say we want to integrate there any household appliances or climatic equipment, which has a number of features: <br><br><ul><li>  Complex control algorithms with a large number of parameters, working on the device itself </li><li>  The desirability of an interface that does not depend on the functioning of your "smart home" - that is, a normal web interface that lives on the device itself (the same technique can be installed where the "smart home" is not even planned, for example) </li><li>  Indifference to the size and power consumption of the "brains" - within reasonable limits </li></ul><br><br>  In this case, there is no practical sense to unambiguously bind to a specific specific radio interface - it is easier to put powerful ‚Äúbrains‚Äù inside with Wi-Fi, as a result of which the equipment can be used as part of various ‚Äúsmart houses‚Äù or without it. <br><br>  At the same time, notice that I didn‚Äôt have a box labeled ‚Äúflat‚Äù around the whole block diagram - in practice it can be used on different scales from the room (each room has its own controller, while due to its dimensions it can fit in the standard 68- mm socket socket) to a large cottage, it all depends on the specific requirements of a particular project.  The system is easily scaled to large buildings - put several controllers in different parts of the building, the benefit is not KNX with its $ 3k per box, and let them communicate with themselves via normal Ethernet or Wi-Fi, the benefit of the brains in them for such communication more than enough. <br><br>  However, I already went to talk about other topics related to the ‚Äúsmart home‚Äù, but traditionally forgotten in the vast majority of projects - scalability, integration into the system of various equipment, different levels of management ... In 99 projects out of 100, alas, the authors do not even try think in scale larger than your own apartment. <br><br>  But this is the next stage.  In the meantime, please stop trying to shove every Wi-Fi or Bluetooth light bulb into each outlet.  They are not needed there.  And do not hammer in the screws. </div><p>Source: <a href="https://habr.com/ru/post/251837/">https://habr.com/ru/post/251837/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251827/index.html">MailChimp UX Team: How We Do Research [Part 3 of the book]</a></li>
<li><a href="../251829/index.html">Overview of the most interesting materials on data analysis and machine learning ‚Ññ37 (February 23 - March 1, 2015)</a></li>
<li><a href="../251831/index.html">Basic principles of system analysis in SEBoK</a></li>
<li><a href="../251833/index.html">PHPCI updated to version 1.6</a></li>
<li><a href="../251835/index.html">Development of javascript applications based on Rx.js and React.js (RxReact)</a></li>
<li><a href="../251839/index.html">A little about the important: 7 ways to "impregnate" the goal or how to set goals to achieve them</a></li>
<li><a href="../251841/index.html">We write a bot for MMORPG with assembler and draenei. Part 4.5</a></li>
<li><a href="../251845/index.html">(Video) HP Helion Presentation</a></li>
<li><a href="../251847/index.html">Yii 2.0.3</a></li>
<li><a href="../251849/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ149 (February 24 - March 1, 2015)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>