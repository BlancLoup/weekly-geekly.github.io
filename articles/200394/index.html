<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How it is done: parsing articles</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For me, there has always been some kind of magic about how Getpocket, Readability and VKontakte pass links to pages and offer ready-made articles for ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How it is done: parsing articles</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/262/2dc/93f/2622dc93f0a309e16dd0c7cb1f6f3030.png"><br><br>  For me, there has always been some kind of magic about how Getpocket, Readability and VKontakte pass links to pages and offer ready-made articles for viewing without ads, sidebars and menus.  However, they are almost never wrong.  And recently a similar task has matured in our project, and I decided to dig a little deeper.  I‚Äôll say at once that this is ‚Äúwhite‚Äù parsing, webmasters themselves voluntarily use our service. <br><a name="habracut"></a><br><br>  In an ideal world, all the information on the pages should be semantically tagged.  Smart people came up with many useful things like Microdata, OpenGraph, Article tags, Nav ... etc, but I wouldn‚Äôt be in a hurry to rely on the awareness of webmasters in terms of semantics.  Enough to see the code pages of popular sites.  Open Graph is by the way the most popular format, everyone wants to look beautiful in social.  networks 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The isolation of the title of the article and the picture remains beyond the scope of my post, since the title is usually taken from the title or og, and the picture if it is not taken from the og: image is a separate story. <br><br>  We turn to the most interesting - the isolation of the body of the article. <br>  It turns out that there is quite a scientific paper devoted to this problem (including from Google employees).  There is even a CleanEval competition with a set of test pages from which to extract data, and algorithms compete in who will do it more precisely. <br><br>  The following approaches are distinguished: <br><ul><li>  Extracting data using only html document (DOM and text level).  This technique will be discussed below. </li><li>  Extract data using a rendered document using computer vision.  This is a very accurate algorithm, but also the most complex and gluttonous.  You can see how it works, for example, here: <a href="http://www.diffbot.com/">www.diffbot.com</a> (project of the guys from Stanford). </li><li>  Extracting data at the site level entirely, comparing the same type of pages and finding the differences between them (differing blocks are in fact the necessary content).  This is a big search engines. </li></ul><br><br>  We are now interested in approaches to retrieving an article with only one html document in hand.  In parallel, we can solve the problem of defining pages with lists of articles with pagination.  In this article we are talking about methods and approaches, and not the final algorithm. <br><br>  Parse will be the page <a href="http://habrahabr.ru/post/198982/">http://habrahabr.ru/post/198982/</a> <br><br><h4>  List of candidates to become an article </h4><br>  We take all the layout elements of the page structure (for simplicity, a <b>div</b> ) and the text that they contain (if any).  Our task is to get a flat list of the <b>DIV element -&gt; text in it</b> <br><br>  For example, the menu block on Habr√©: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4fa/968/de7/4fa968de7784bcc9bae1284a78b491cc.png"><br><br>  Gives us an element containing the text <b>"posts q &amp; a events of company hubs"</b> <br><br>  If there are <b>div</b> elements nested, their content is discarded.  Child divs will be processed in turn.  Example: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f2a/619/647/f2a61964766cf2d16aed3a71e3e21917.png"><br><br>  We will receive two elements, in one text <b>¬© habrahabr.ru</b> , and in the second. <b>Support service Mobile version</b> <br><br>  <i>We assume that in the 21st century, elements that are semantically intended for the markup of a structure (div) are not used for marking paragraphs in the text, and this is true on the top 100 news sites.</i> <br><br>  As a result, we get a flat set of wood: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/763/aac/432/763aac432892bb1db1ad4e8df21cdd98.png"><br><br>  And so, we have a set in which we need to classify an article.  Further, with the help of various rather simple algorithms for each element we will lower or increase the probability coefficient of the presence of an article in it. <br><br>  We do not throw a DOM tree; we will need it in the algorithms. <br><br><h4>  Find duplicate patterns. </h4><br>  In all elements of the DOM tree, we find elements with repeating patterns in the attributes (class, id ..).  For example, if you look at the comments: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f6/cc5/665/2f6cc56651d26b2aba688359008e5416.png"><br><br>  It becomes clear what a repeating pattern is: <br><ul><li>  Same set of element classes </li><li>  Same text substring in id </li></ul><br>  We are pessimizing all these elements and their ‚Äúchildren‚Äù, that is, we set a certain reduction factor depending on the number of repetitions found. <br>  When I talk about "kids", I mean that all nested elements (including those that fell into our classification kit) will be pessimized.  Here, for example, the element with the text of the comment also falls under the distribution: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/793/b45/978/793b45978d6ec8a8df1c2c76e2c6a2cc.png"><br><br><h4>  The ratio of links and plain text in the element. </h4><br>  The idea is clear - in the menu and in the columns we see solid links, which clearly does not look like an article.  We run over the elements from our set and assign a number to each. <br>  For example, the text in the elements in the Freelance block (we have already received a minus for the repeating class), get a minus to catch up for an ugly link-to-text ratio of one.  It is clear that the smaller this coefficient, the more the text looks like a meaningful article: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/903/613/834/9036138347baf47590d042a6c880248d.png"><br><br><h4>  The ratio of text markup to text </h4><br>  The more blocking of any markup (lists, hyphenation, span ...), the less chance that this is an article.  For example, advertising is probably a respected SEO company, not very similar to the article, as the whole is a list.  The lower the ratio of markup to text, the better. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5ca/7a5/e32/5ca7a5e324bb01909bd32f7957714ac3.png"><br><br><h4>  The number of points (sentences) in the text. </h4><br>  Here we have almost crawled into the territory of numerical linguistics.  The fact is that in the titles and menu points are practically not put.  But in the body of the article a lot of them. <br>  If any menus and lists of new materials on the site are still through the previous filters, then you can finish off by counting points.  Not very many of them in the best block: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a23/6ee/3de/a236ee3ded9397f3912aed3f804cf7f8.png"><br><br>  The more points, the better, and we increase the chances of this element to receive the proud title of the article. <br><br><h4>  The number of blocks with text about the same length </h4><br>  Many blocks with text of about the same length are a bad sign, especially if the text is short.  We pessimize such blocks.  The idea works well on a similar layout: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/51e/f40/b5e/51ef40b5ea2d494d2a694331d10db5aa.png"><br><br>  The example is not Habr, since this algorithm works better on more stringent grids.  On comments on Habr√© will work for example not very well. <br><br><h4>  The length of the text in the element </h4><br>  Here, a direct relationship - the longer the text in the element, the greater the chance that this article. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/957/a4b/51e/957a4b51e63ef563f2cceb260dd369bc.png"><br><br>  Moreover, the contribution of this parameter to the final assessment of the element is very significant.  90% of the cases of parsing an article can be solved by this method alone.  All previous research will raise this chance to 95%, but at the same time they eat the lion's share of processor time. <br><br>  But imagine: a comment about the size of the article itself.  If you simply define an article by the length of the text, an embarrassment happens.  But there is a high chance that the previous algorithms will slightly cut the wings of our graphomanal commentator, since the element will be pessimized for the repeated pattern in id or class. <br><br>  Or one more case - a weighty drop-down menu made using <ul> <code><br> <br>          "boilerplate algorithm", "readability algorithm"</code> </ul> </div><p>Source: <a href="https://habr.com/ru/post/200394/">https://habr.com/ru/post/200394/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200378/index.html">At the G20 summit, Russia gave diplomats flash drives with "bookmarks"</a></li>
<li><a href="../200382/index.html">Creating a module for Drupal 7. Part 2</a></li>
<li><a href="../200386/index.html">SSD-VDS and SSD hosting in the Netherlands and the USA</a></li>
<li><a href="../200388/index.html">My Opera closes in March 2014</a></li>
<li><a href="../200390/index.html">How the world's first Bitcoin exchanger works</a></li>
<li><a href="../200396/index.html">Adiabatic cooling data center</a></li>
<li><a href="../200398/index.html">Pays.io payment service closes</a></li>
<li><a href="../200400/index.html">BlackBerry 10.2: what's new?</a></li>
<li><a href="../200402/index.html">From 2015, all cars in the Russian Federation must be with GLONASS</a></li>
<li><a href="../200404/index.html">PayPal bans the withdrawal of money from Flattr in Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>