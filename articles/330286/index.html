<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HP DL120 G7 - the second life of the server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi Habr! Overboard in 2017 and new HP G9 servers are available on the market, and soon I think HP G10 will appear. 

 But there is no ‚Äúmoney,‚Äù and you...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HP DL120 G7 - the second life of the server</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/77d/e46/492/77de46492f8a476a90560166ae873d99.png"><br><br>  Hi Habr!  Overboard in 2017 and new HP G9 servers are available on the market, and soon I think HP G10 will appear. <br><br>  But there is no ‚Äúmoney,‚Äù and you made the decision to buy a BOO server or to optimize the existing server fleet.  And in this case, I want to draw your attention to a couple of moments related to the disk subsystem of the HP DL120 G7 server. <br><a name="habracut"></a><br>  The server had been in the warehouse for a couple of months after the branch was closed, and I decided to make something useful out of it in the form of a file storage. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I got a 628692-421 server with hotplug 3.5 (4 pcs) disks, a Xeon E3-1240 processor, 16GB frames and a Smart Array P212 / 256MB controller with SAS 10k 400GB disks. <br><br><h3>  HP Smart Array P212 </h3><br>  This controller can be found in almost all servers of the HP generation G5 / G6 / G7.  A list of servers can be found on the <a href="https://www.hpe.com/h20195/v2/Library.aspx%3Fdoctype%3D41%26doccompany%3DHPE%26footer%3D41%26filter_doctype%3Dno%26filter_doclang%3Dno%26country%3D%26filter_country%3Dno%26cc%3Dus%26lc%3Den%26filter_status%3Drw">HPE QuickSpecs website</a> . <br><br>  If the server has an optional Smart Array controller installed, you can monitor the status of the disks via ILO3. <br><br><img src="https://habrastorage.org/web/683/64d/ddf/68364dddfd3a44fd8801f54ce36935a8.png"><br><br>  In the screenshot, you can observe the status of the HGST HTS721010A drive, by installing non-original drives in the HP server, you risk receiving unreliable information about the drives.  In this case, the disk temperature is not correctly determined, as a result, the server displays fan speed at 100% speed and the server turns into a power-saw bench. <br><br>  <b>Conclusion number 1 - not all drives are equally useful, "choose the original HP disks."</b> <br><br>  By default, the HP Smart Array P212 controller caches read operations only, and installing the Battery Kit is recommended to enable caching of write operations. <br><br><img src="https://habrastorage.org/web/f24/724/551/f247245510a247c0bf97b80f36977209.png"><br><br>  In the absence of the Battery Kit, there is a chance of losing data during a power outage.  If you have enabled caching write operations without a battery, you do this at your own peril and risk. <br><br>  If you do not enable the write cache, the HDD will show the speed results noticeably lower.  A large read cache will not have a tangible impact on the result. <br><br><h4>  Let's take a look at how caching settings affect speed. </h4><br>  As parrots, I chose the VM cloning rate of 38 GB. <br><br>  1 - Copy from SAS 10k disk to SATA 7k disk <br>  2 - Copying from a SAS 10k disk to a SAS 10k disk (2.5inch) <br>  3 - Copy from SATA 7k disk to SAS 10k disk <br>  4 - Copy from SATA 7k disk to SAS 10k disk (2.5inch) <br>  5 - Copying from SAS 10k (2.5inch) disk to SATA 7k disk <br><br><img src="https://habrastorage.org/web/79f/101/704/79f10170426e48fc96c094cc07a77281.png"><br><br>  <b>Conclusion number 2 - write on write at least 50% of the size of the memory cache.</b> <br><br><h3>  About SAS drives </h3><br>  Pay attention to copying between SAS 10k disks, in some cases 10k loses 7k SATA disks. <br><br>  It is necessary to recognize that local SAS 10k disks in servers are less relevant, these disks cannot compete in the number of operations with SSD. <br><br><h3>  HP Smart Array P212 + SSD </h3><br>  In the servers, I still do not have SSD and I decided to see how not the newest Smart Array controller will survive the SSD connection. <br><br>  I had one single 120 GB SSD Kingston SHFS37 which I took out of the laptop.  I want to immediately note that for servers it is necessary to choose SSD with protection against power loss, such protection is stated by the manufacturers in the drives Intel DC and Kingston KC400. <br><br>  The SSD is defined and its status can be monitored through ILO3. <br><br><img src="https://habrastorage.org/web/516/91b/286/51691b286f8a4a45a33dc202103649e5.png"><br><br><h4>  SSD Testing </h4><br>  1.2 - Copy from SATA to SSD <br>  3.4 - Copy from SSD to SATA <br>  5.6 - Copy from SATA disk to SATA disk <br>  7,8,9 - Copy from SSD to SSD <br><br><img src="https://habrastorage.org/web/707/d89/d12/707d89d12f754eadbe0b48751c98ab31.png"><br><br>  If you disable write caching, the loss of SSD speed is not noticeable, while the SATA HDD subsides noticeably. <br><br><img src="https://habrastorage.org/web/d18/e03/12a/d18e0312ad5543a793740bab1b474198.png"><br><br>  <b>Conclusion number 3 - SSD shows excellent speed and can be used without caching write operations.</b> <br><br><h3>  HP Smart Array B110i </h3><br>  If the optional HP Smart Array controller is not in the server, the disks will work with the controller on the HP Smart Array B110i motherboard.  Only SATA drives can be connected to the B110i. <br><br>  HP Smart Array B110i can be found in HP ML110, ML150, ML330, DL120, DL160, DL180, DL320 G6 generation servers, and ML110, DL120, DL165 G7 generation servers.  Also, this controller is found in some servers of the SL series. <br><br>  The default controller works in SATA Legacy mode, I note right away that this is not the most successful mode, with such settings drives will work very slowly. <br><br>  By default, the disk cache is disabled if you turn it on there is a chance of losing data when the power is turned off. <br><br>  Three controller modes are available: <br>  1 - SATA RAID <br>  2 - SATA AHCI <br>  3 - SATA Legacy <br><br><img src="https://habrastorage.org/web/26c/592/5f4/26c5925f4e1d42e987f374bdfac3a277.png"><br><br>  VMware ESXi does not know how to work with disks collected on a raid and connected to this controller, and for this reason I will test the server by installing WS2012R2 on it. <br><br><h4>  1 - SATA Legacy </h4><br>  In the SATA Legacy mode, Windows defaults to a write-in software cache, and this means that there is a chance of losing data during a power outage. <br><img src="https://habrastorage.org/web/f50/ae3/71b/f50ae371bbea478fa6ea3c10c8274db8.png"><br><img src="https://habrastorage.org/web/d68/c00/114/d68c001141be41e998f0155fdb07e67d.png"><br><br>  After caching is turned off, the drop in speed for ordinary disks is terrible, 20 MB / s is a very good screenshot - and the results can be much worse. <br><img src="https://habrastorage.org/web/515/293/89d/51529389da77477db3ca7dfad3607909.png"><br><br><h4>  2 - SATA AHCI </h4><br>  Software caching of write operations is also enabled by default. <br><img src="https://habrastorage.org/web/204/f3e/ddb/204f3eddb7b84f68a2a0030d089d3835.png"><br><br>  After disabling caching HDD sagged not as much as in the case of SATA Legacy. <br><br><img src="https://habrastorage.org/web/c83/785/23e/c8378523ed8747c9adfa58280a580f26.png"><br><br>  <b>Pin number 4 - In cases where you do not need hardware RAID, the HDD should work in AHCI mode, and software caching of write operations should be disabled to ensure data integrity.</b> <br><br><h4>  3 - SATA RAID </h4><br>  HP Smart Array B110i supports only the ‚Äúsoftware raid‚Äù R10 and R1.  I want to write something bad about him - but I don‚Äôt think that you may have problems with it, but still, whenever possible, make an update to the full HP HP Smart Array, with cache memory and batteries. <br><br>  It is not possible to enable write caching in Windows; this function is not supported by the controller drivers.  For HP Smart Array P212 software caching is also not possible. <br><br><img src="https://habrastorage.org/web/84f/cf4/68d/84fcf468d5bf485d8886fb6b1a274c8c.png"><br><br>  This time I combined two sat disks in R1, and therefore the average speed was higher. <br><br><img src="https://habrastorage.org/web/18f/9ff/f80/18f9fff80ff944008ad527ee2835ba0f.png"><br><img src="https://habrastorage.org/web/e75/033/8e0/e750338e0aef44669117eeba2dea18cb.png"><br><br><h3>  Pro reliability and data integrity </h3><br>  During the process of switching disks between controllers and changing disks, the configuration of the controllers was lost several times and all the arrays collapsed.  Be careful with such castling. <br><br>  I draw attention to this by the fact that HP had previously declared compatibility with the configuration of raid arrays when swapping disks between controllers or between servers. <br><br><img src="https://habrastorage.org/web/d3c/b35/961/d3cb3596136b408fba59cff2d51b911c.png"><br><br>  <b>Pin number 5 - store backups on a separate device.</b> <br><br><h3>  TOTAL </h3><br>  1 - Not all discs are equally useful, ‚Äúchoose original HP discs‚Äù. <br>  2 - Record at least 50% of the memory cache size. <br>  3 - SSD shows excellent speed and can be used without caching write operations. <br>  4 - In cases where you do not need hardware RAID, the HDD should work in AHCI mode, and software caching of write operations should be disabled to ensure data integrity. <br>  5 - store backups on a separate device. <br><br><h4>  P.S. </h4><br>  To configure the disk subsystem from the graphics console, you need to download an <a href="http://h20566.www2.hpe.com/hpsc/swd/public/detail%3Fsp4ts.oid%3D5075938%26swItemId%3DMTX_2e6c41afdb8c4c0d9bffce484c%26swEnvOid%3D4064">HP Smart Start CD 8.70</a> boot disk image <a href="http://h20566.www2.hpe.com/hpsc/swd/public/detail%3Fsp4ts.oid%3D5075938%26swItemId%3DMTX_2e6c41afdb8c4c0d9bffce484c%26swEnvOid%3D4064">(B)</a> . <br><br>  For more convenience when working with a server, a license for HP ILO Advanced will not hurt, a demo license can be obtained <a href="https://www.hpe.com/us/en/servers/integrated-lights-out-ilo.html">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/330286/">https://habr.com/ru/post/330286/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330252/index.html">Must-Have 3: Game Interfaces and Assets for Designer and Artist</a></li>
<li><a href="../330278/index.html">Unity: save system for any project</a></li>
<li><a href="../330280/index.html">Finished off: how companies use gamification in recruitment</a></li>
<li><a href="../330282/index.html">Machine learning and data analysis: solving practical problems with the winners of the industrial hackathon LC</a></li>
<li><a href="../330284/index.html">Memory leaks in Android and how to localize them</a></li>
<li><a href="../330288/index.html">Swift Playgrounds 1.5. Programming Sphero and more.</a></li>
<li><a href="../330290/index.html">Preview RamblerElixir # 3</a></li>
<li><a href="../330292/index.html">WWDC 2017. Let's poke a little bit</a></li>
<li><a href="../330294/index.html">Replication Framework ‚Ä¢ deep copying and generalized comparison of connected object graphs</a></li>
<li><a href="../330296/index.html">Tips for engineers from Google manager</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>