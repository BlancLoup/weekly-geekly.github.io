<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A simple, natural question: what are the UWP libraries?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Code reuse and compatibility for various platforms in our time is a rather topical issue. In addition, MSFT has recently been trying to please the dev...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A simple, natural question: what are the UWP libraries?</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/2a4/122/27d/2a412227dd3648d7b1812b811815e6b9.jpg"></div><br><br>  Code reuse and compatibility for various platforms in our time is a rather topical issue.  In addition, MSFT has recently been trying to please the developers of various platforms and programming languages.  That is why, probably, the capabilities of the universal Windows platform allow using more than one type of library.  Under the cut about which libraries, how and why you can use in applications UWP. <br><a name="habracut"></a><br><h4>  Class Library - Class Library for Windows Store Applications </h4><br>  .Net library with classes and methods available for Windows Store apps.  Can only be used by UWP applications written in .Net languages.  That is, JavaScript, for example, disappears. <br><br>  Note that the .WWP application cannot use the usual .Net class libraries by itself. <br>  The list of differences and changes that need to be made when converting .Net code to .Net for Windows Store applications can be found at: <a href="https://msdn.microsoft.com/en-us/library/br230302.aspx">.NET for Windows Store apps overview</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There are quite a few changes and differences, although there is also a certain similarity.  Often, only the namespaces are different, and the methods and properties remain the same.  This is done for the convenience of porting existing code.  Of course, not all .Net functionality is available in Windows Store applications.  Partly for security reasons or because of the fact that he did not want to duplicate it conceptually in UWP. <br><br><h4>  Class Library Portable - PCL (Portable Class Library) </h4><br>  Some libraries are available in these libraries, depending on which platform you choose.  Target platforms are selected when creating a project. <br><br><img src="https://habrastorage.org/files/c25/279/c53/c25279c533964aae8d1e1247a6510c65.PNG"><br><br>  These target platforms can be changed at any time in the project properties. <br>  Since the code will be one for multiple platforms, all types and members must be present in the selected platforms and must not have any platform specificity.  Also they should not be deprecated or flagged for an exception. <br><br><h4>  Windows Runtime Component -Windows Runtime Component </h4><br>  A component that can be used with any of the WinRT platform languages.  Component extension ends in .winmd.  But let it not confuse you, the component is very often used as a library, and the metadata it contains allows it to work with all WinRT languages.  This is the main advantage. <br><br>  For example, I can show you how in the created Class Library project through properties you can select the Runtime Component as the result of the build: <br><br><img src="https://habrastorage.org/files/0a8/8ae/003/0a88ae0037e243848078125b637fc87e.PNG"><br><br>  But in this case, you will lose cross-language compatibility and will be able to work with such a library only from C # and VB. <br><br>  Runtime Component is based on COM.  It turns out that there is an opportunity to write a native Windows Runtime component in a managed language. <br>  All WinRT languages ‚Äã‚Äãuse their own data types.  But in the Runtime component, the data must be unified. <br>  Primitive types are more or less similar in all languages.  Mostly only JavaScript is different. <br>  Table mapping can be found on the links: <br>  <a href="https://msdn.microsoft.com/ru-ru/library/windows/desktop/br205768(v%3Dvs.85).aspx">Windows Runtime base data types</a> <br>  <a href="https://msdn.microsoft.com/en-us/windows/uwp/winrt-components/net-framework-mappings-of-windows-runtime-types">.NET Framework mappings of Windows Runtime types</a> <br><br>  WinRT languages ‚Äã‚Äãare different and therefore it is sometimes necessary to come to some common denominator.  For example, in .Net and JavaScript applications, strings are immutable, and in C ++ they are mutable.  In the Windows Runtime component, the immutable lines. <br><br>  Restrictions / rules: <br><ul><li>  Public elements must be sealed. </li><li>  Public classes or interfaces cannot be generic or implement a non-WinRT interface. </li><li>  Public classes cannot be derived from WinRT types. </li><li>  All fields, parameters, and returned values ‚Äã‚Äãof public members must be of type Windows Runtime. </li><li>  The root namespace must match the name of the assembly and cannot begin with ‚ÄúWindows‚Äù. </li><li>  WRC does not support polymorphism. </li><li>  Methods in the Windows Runtime can be overloaded, but in the case of the same number of parameters they must be marked with an attribute.  Official example: </li></ul><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OverloadExample</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> s</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s; } [Windows.Foundation.Metadata.DefaultOverload()] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OverloadExample</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x; }</code> </pre> <br>  The Class Library for Windows Store applications has the least restrictions, so if you have an application in .Net languages, then it is better to choose this library. <br><br><h4>  Practical example: </h4><br>  If your UWP application uses WebView to display web sites, then you have the opportunity to use a class in your application that will be accessible from JavaScript in the downloaded web pages. <br>  And this class must be located inside the Windows Runtime component.  This is where cross-language compatibility is needed. <br><br>  A component is created, and from the main project containing the WebView page, it is referred to.  Inside a component, a public class or classes can be labeled with the [AllowForWeb] attribute.  All public methods of such classes will be available from JavaScript loaded into the WebView page.  It is necessary only at the beginning of navigation to the page to add this class using the <a href="https://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.controls.webview.addweballowedobject.aspx">AddWebAllowedObject</a> method. <br><br>  Yes, of course, there is an option to use window.external.notify in the JS code, but there are certain security restrictions that allow these calls to be made only from trusted https sites. <br><br>  I will repeat a little and I will duplicate the example with MSDN.  In the class WinRT component add method SomeValueFromJS <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows.Foundation.Metadata; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyRuntimeComponent</span></span> { [AllowForWeb] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyNativeClass</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SomeValueFromJS</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { } } }</code> </pre><br>  Add a webview in XAML <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WebView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"webView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https:// www.contoso.com/script.htm"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NavigationStarting</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"webView_NavigationStarting"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  And at the beginning of navigation we will implement our class in JavaScript <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">webView_NavigationStarting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebView sender, WebViewNavigationStartingEventArgs args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (args.Uri.Host == <span class="hljs-string"><span class="hljs-string">"www.contoso.com"</span></span>) { webView.AddWebAllowedObject(<span class="hljs-string"><span class="hljs-string">"csharpclass"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyNativeClass()); } }</code> </pre><br>  Now from the JS code, you can call this method like this: <br><br><pre> <code class="javascript hljs">csharpclass.nativeMethod(<span class="hljs-string"><span class="hljs-string">"hello!"</span></span>);</code> </pre><br>  It would seem that everything is normal, but bad luck, it may often be necessary to transfer data to a page from a WebView.  The project with WebView already refers to the WinRT component and therefore we can‚Äôt add a backward link due to circular dependency.  WRC restrictions do not allow us to use some options.  As a solution, you can create an intermediate layer in the form of the Class Library for Windows Store applications, which has much less restrictions.  A link to this library containing a class called BridgeClass can be made from the main project and from the project of the Windows Runtime component. <br><br><img src="https://habrastorage.org/files/0f5/659/50a/0f565950a4e8438989e7e59d8bdb4cb8.PNG"><br><br>  Opportunities .Net allow us to create affordable event <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;</code> </pre><br>  and subscribe to an event in the main project.  Let's look at the code.  BridgeClass class code: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BridgeClass</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; MessageReceived; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Broadcast</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MessageReceived != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) MessageReceived(message); } }</code> </pre><br>  In the main project, in the code-behind page with WebView, subscribe to the event: <br><br><pre> <code class="cs hljs">BridgeClass.MessageReceived += ShowMessage;</code> </pre><br>  And we realize: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> msg</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre><br>  Now from the method available for JS we can transfer the value to C #: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SomeValueFromJS</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { BridgeClass.Broadcast(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); }</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/305674/">https://habr.com/ru/post/305674/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../305664/index.html">‚ÄúShoemaker in our boots‚Äù: as we wrote the module of financial resources management for internal EDS</a></li>
<li><a href="../305666/index.html">Improving the energy efficiency of data centers: the experience of Apple, Google, Microsoft, Active Power and Burland Energy</a></li>
<li><a href="../305668/index.html">Scientists again "puzzled": Is it possible to upgrade the brain and what to expect from it</a></li>
<li><a href="../30567/index.html">Lenovo IdeaPad S10 - another baby</a></li>
<li><a href="../305672/index.html">How to connect to the server via RDP from Windows, Mac OS, iPhone, iPad, Android, Ubuntu or Debian (Linux OS)</a></li>
<li><a href="../305676/index.html">The language of inter-professional communication. Poll results</a></li>
<li><a href="../305678/index.html">Scripto - replacing the standard JavaScriptInterface</a></li>
<li><a href="../305680/index.html">Using the SRR mechanism in Qt-designed QNX applications</a></li>
<li><a href="../305682/index.html">How to write a SQL query on Slick and not open the portal to hell</a></li>
<li><a href="../305686/index.html">Typical mistakes novice technical director in IT - expert opinion</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>