<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hacker, hack yourself</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We have come across many stories about how exploits caused irreparable damage to communities or even led to their collapse. When we started working on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hacker, hack yourself</h1><div class="post__text post__text-html js-mediator-article">  We have come across many stories about how exploits caused irreparable damage to communities or even led to their collapse.  When we started working on the <a href="https://discourse.org/">Discourse</a> project, we remembered the lessons we learned from these stories.  We set a goal to create an open source program that would provide security to all its communities by default - even if there are thousands or millions of them. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/0fc/4ca/3e9/0fc4ca3e94f141c1a661390c9b232f6c.jpg"></div><br>  At the same time, we also attach great importance to portability, that is, the ability to load and unload data from the Discourse at will.  That is why Discourse, unlike other forum services, is subject to a Creative Commons license.  Even an ordinary user on Discourse can freely export and download their posts directly from their personal profile. <br><br>  Forum owners have the ability to create backups and restore entire databases of sites directly from the admin panel in a web browser.  Automatic backups by default are made on a weekly basis.  I‚Äôm not just considered <a href="https://blog.codinghorror.com/international-backup-awareness-day/">the world's leading backup expert</a> ! <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/web/5ab/e15/cb1/5abe15cb134c4d0984ee0fe1b03d171b.png"></div><br>  By many years of experience, we know that combining security with data portability is also a challenge.  Sees ASCII, unload the entire database - this is exactly what hackers will strive for as soon as they manage to get into your system.  This is for them, we can say the main prize. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To eliminate this danger, we gradually tightened the requirements for creating backups on Discourse in various ways: <br><br><ul><li>  The administrator password must be at least 15 characters; </li><li>  Administrative actions such as creating or uploading a backup are officially logged; </li><li>  The keys for downloading the backup are one-time and are sent to the administrator‚Äôs mail in order to make sure that he really has access to this address. </li></ul><br>  Information security is tied to the protection in depth, so that all these rigor help ... but we still need to imagine that some Internet villains took over your database.  And now what?  Well, at first we will understand that in it in general is. <br><br>  <b>1. Cookies</b> <br><br>  It is cookies that allow the browser to identify the user.  Usually they are stored in the form of hashes, rather than specific values ‚Äã‚Äã- therefore, even having access to the hash, it is impossible to impersonate the end user.  Moreover, in many modern web frameworks, the life cycle of cookies is small, so that in any case they remain relevant for no more than 10-15 minutes. <br><br>  <b>2. Email addresses</b> <br><br>  Of course, the fact that their e-mail fell into the hands of hackers is a cause for excitement, but in reality very few people nowadays care about their addresses. <br><br>  <b>3. All posts and the contents of the branches</b> <br><br>  For the purity of the experiment, let us assume that the site is completely open to the public and there is nothing secret placed on it.  Accordingly, we do not have to worry about the leakage of commercial secrets and other sensitive information (at least for now) - all the posts were still public.  Otherwise, the situation would deserve a separate post;  maybe someday I'll write it. <br><br>  <b>4. Password hashes</b> <br><br>  All that remains is password hashes.  And this ... this is a <a href="https://blog.codinghorror.com/speed-hashing/">really serious problem</a> . <br><br>  When a hacker gains access to your database, he can crack password hashes by <a href="https://blog.codinghorror.com/your-password-is-too-damn-short/">large-scale</a> offline <a href="https://blog.codinghorror.com/your-password-is-too-damn-short/">attacks</a> with full use of the capabilities of any cloud service that he can afford.  And having cracked any hash, he gets an opportunity to enter the system under the guise of the corresponding user for all eternity ... well, or at least until this user changes the password. <br><br>  It is for this reason that if you found out (or even simply suspected) that your database fell into the wrong hands, the first thing you should do is change the passwords of all users. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/98b/b60/b10/98bb60b1012445e68078b800f961c9d6.png"></div><br>  And what if you do not know?  Is it worth it to be proactive and change all passwords every 30 days, following the example of the worst IT departments of mega-corporations in the world?  This greatly spoils the user experience, and in itself can lead to pathologies.  In reality, it is likely that you will not know about the data breach until it is too late to do something.  Therefore, it is crucial to slow down the process for hackers, to win yourself some time, in order to have time to react and deal with the situation. <br><br>  Thus, you have, in fact, only one way to protect users, and everything will depend on how resistant the password hashes are to the attacks stored in the database.  This sustainability is determined by two factors: <br><br><ol><li>  Hashing algorithm.  It should be as slow as possible and, ideally, designed to still slow down on graphics processors.  Why - you will clearly see paragraphs in five. </li><li>  Operating factor or number of iterations.  The more the better, the only restriction is the possibility of a DoS attack. </li></ol><br>  I read manuals that said that the total operating factor should be made so high that password hashing takes at least 8 milliseconds on the corresponding platform.  As it turns out, <a href="https://samsaffron.com/">Sam Saffron</a> , one of the co-founders of Discourse along with me, made the right decision back in 2013, choosing, on the recommendation of NIST, PBKDF2-HMAC-SHA256 and PBKDF2-HMAC-SHA256 and 64 thousand iterations.  We took measurements and found out that, in fact, the process takes about 8 milliseconds using our current Ruby login code on the servers used (quite good ones, Skylake 4.0 Ghz). <br><br>  But that was four years ago.  How secure are password hashes in our database today?  And what will happen in four years?  After ten years?  We are creating a program with a reserve for the future and we want to be sure that we are making the right decisions, which will later serve to universal security.  Therefore, in accordance with the principle ‚Äú <a href="https://blog.codinghorror.com/designing-for-evil/">design with the expectation of intruders</a> ‚Äù, the time has come to put on Darth Vader's helmet and get into the role of a villain - let's crack our own hashes! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/5e2/ae1/71f/5e2ae171f0a54b139bfe208167ff15ee.jpg"></div><br>  For this we will use the coolest graphics processor, known today - <a href="https://gist.github.com/epixoip/a83d38f412b4737e99bbef804a270c40">GTX 1080 Ti</a> .  For reference: at 1080 PBKDF2-HMAC-SHA256 reaches 1180 kH / s, and at 1080 Ti - 1640 kH / s.  In just one generation of video cards, the ability to attack hashes increased by almost 40%.  Think about these numbers. <br><br>  To begin with, a small test in the spirit of hello world to make sure everything works.  I downloaded <a href="https://hashcat.net/hashcat/">hashcat</a> , went to the demo version of our site on try.discourse.org and created a new account there with a password 0234567890. I checked the database and saw that the following values ‚Äã‚Äãfor the hash and salt columns were generated for the new user: <br><br> <code>hash <br> 93LlpbKZKficWfV9jjQNOSp39MT0pDPtYx7/gBLl5jw= <br> salt <br> ZWVhZWQ4YjZmODU4Mzc0M2E2ZDRlNjBkNjY3YzE2ODA=</code> <br> <br>  Hashcat requires the following input file format: for each hash, one line is allocated, which contains the hash type, the number of iterations, salt and hash (encoded in base64);  all this is separated by colons: <br><br> <code>type iter salt hash <br> sha256:64000:ZWVhZWQ4YjZmODU4Mzc0M2E2ZDRlNjBkNjY3YzE2ODA=:93LlpbKZKficWfV9jjQNOSp39MT0pDPtYx7/gBLl5jw=</code> <br> <br>  Let's score all this in hashcat and see what happens: <br><br> <code>type iter salt hash <br> sha256:64000:ZWVhZWQ4YjZmODU4Mzc0M2E2ZDRlNjBkNjY3YzE2ODA=:93LlpbKZKficWfV9jjQNOSp39MT0pDPtYx7/gBLl5jw=</code> <br> <br>  I note that we set a deliberately small amount of work - you need to guess just three characters.  Of course, it didn't take long!  See the password at the very end?  We did it. <br><br> <code>sha256:64000:ZWVhZWQ4YjZmODU4Mzc0M2E2ZDRlNjBkNjY3YzE2ODA=:93LlpbKZKficWfV9jjQNOSp39MT0pDPtYx7/gBLl5jw=:0234567890</code> <br> <br>  Now we are convinced that everything works, and we can get down to business.  Let's go from simple to complex.  How long will it take to brute-force the simplest possible password on the Discourse, consisting of 8 digits - which is only 108, that is, a little more than a hundred million different combinations? <br><br> <code>Hash.Type........: PBKDF2-HMAC-SHA256 <br> Time.Estimated...: Fri Jun 02 00:15:37 2017 (1 hour, 0 mins) <br> Guess.Mask.......: ?d?d?d?d?d?d?d?d [8]</code> <br> <br>  Even with the most powerful GPU, the result was ... well, so-so.  Do not forget: in this test we work with a single hash, so an hour is needed for each row in the table (that is, for each user).  And this is not all bad news: Discourse <a href="https://blog.codinghorror.com/your-password-is-too-damn-short/">for quite a long time</a> does not allow setting passwords of eight characters.  What will be the time cost for longer passwords from numbers? <br><br> <code>?d?d?d?d?d?d?d?d?d [9] <br> Fri Jun 02 10:34:42 2017 (11 hours, 18 mins) <br> <br> ?d?d?d?d?d?d?d?d?d?d [10] <br> Tue Jun 06 17:25:19 2017 (4 days, 18 hours) <br> <br> ?d?d?d?d?d?d?d?d?d?d?d [11] <br> Mon Jul 17 23:26:06 2017 (46 days, 0 hours) <br> <br> ?d?d?d?d?d?d?d?d?d?d?d?d [12] <br> Tue Jul 31 23:58:30 2018 (1 year, 60 days)</code> <br> <br>  But the passwords from the same numbers - this is a primitive for the little ones!  What if we take real passwords that have at least lowercase letters, or even a combination of numbers + uppercase letters + lowercase letters? <br><br> <code>Guess.Mask.......: ?l?l?l?l?l?l?l?l [8] <br> Time.Estimated...: Mon Sep 04 10:06:00 2017 (94 days, 10 hours) <br> <br> Guess.Mask.......: ?1?1?1?1?1?1?1?1 [8] (-1 = ?l?u?d) <br> Time.Estimated...: Sun Aug 02 09:29:48 2020 (3 years, 61 days)</code> <br> <br>  The brute force method ‚Äúlet's try all possible combinations of letters and numbers‚Äù something no longer seems such a brilliant idea, even with a high-quality graphics processor.  But what if we shorten this period eight times by <a href="https://gist.github.com/epixoip/a83d38f412b4737e99bbef804a270c40">simply inserting eight video cards into one machine</a> ?  The budget of a small company or a wealthy individual may well pull it.  Unfortunately, when the processing time is 38 months, a decrease of eight times the weather will not do.  Let's better imagine the attack by the authorities, who have enough money to throw several thousand (reducing the period to 1.1 day), and even tens of thousands (reducing to 2.7 hours) of the graphics processors to this task.  In that case ... yes.  Even assuming that the minimum password length is set to ten characters, you are in big trouble. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/e8b/141/3cc/e8b1413ccd9248f7953eee9853d5e0bc.jpg"></div><br>  If we want Discourse to stand up against government attacks, we need to come up with something.  Hashcat has a convenient benchmark mode;  <a href="https://docs.google.com/spreadsheets/d/1iwoMR5TBYAZ5eiSphkIQfIEfbrVvWW_tKwS4L1cYlaI/pubhtml%3Fgid%3D0%26single%3Dtrue">Here is a list of the most reliable hashes known to him</a> (that is, which takes the most time) that were tested on 8 Nvidia GTX 1080 graphics processors. From what I recognized, bcrypt, scrypt and PBKDF2-HMAC-SHA512 deserve the most mention. . <br><br>  The results, which gave this small experiment with hashcat, convinced me that in the organization of storing hashes in the database, we did not make gross mistakes.  But I wanted to be absolutely sure of this, so I turned to the services of a security specialist and penetration testing, so that he (having previously signed a non-disclosure agreement) tried to hack our two <a href="https://discourse.org/customers">workers and very popular forums on Discourse</a> . <br><br>  ‚ÄúI was provided with two sets of password hashes from two different communities on the Discourse, which contained 5,909 and 6,088 respectively.  Both used the PBKDF2-HMAC-SHA256 algorithm with a 64k operating factor.  With the help of hashcat, my Nvidia GTX 1080 Ti GPU model machine generated hashes at ~ 27,000 per second. <br><br>  The same list of requirements applies to the passwords of all communities on Discourse: <br><br><ul><li>  User password must be at least 10 characters long. </li><li>  The administrator password must be at least 15 characters long. </li><li>  Users can choose from two methods of identification: entering a name and password or logging into the system through third-party services (Google, Facebook, Twitter, and so on).  If they choose the second option, the system automatically creates a strong 32-character password for the account.  It is impossible to determine whether the password was set by a human or generated automatically. </li></ul><br>  Using the lists of popular passwords and masks in three weeks, I managed to crack 39 of the 11.997 hashes, 25 from the ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà community, and 14 from the ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà community. <br><br>  This information security specialist regularly conducts audits of this kind, so instead of using brute force methods, he used wordlist along with effective patterns and <a href="https://hashcat.net/wiki/doku.php%3Fid%3Dmask_attack">masks</a> that he knew from previous attempts to crack passwords.  As a result, he received the following list of passwords (one turned out to be a duplicate): <br><br> <code>007007bond <br> 123password <br> 1qaz2wsx3e <br> A3eilm2s2y <br> Alexander12 <br> alexander18 <br> belladonna2 <br> Charlie123 <br> Chocolate1 <br> christopher8 <br> Elizabeth1 <br> Enterprise01 <br> Freedom123 <br> greengrass123 <br> hellothere01 <br> I123456789 <br> Iamawesome <br> khristopher <br> l1ghthouse <br> l3tm3innow <br> Neversaynever <br> password1235 <br> pittsburgh1 <br> Playstation2 <br> Playstation3 <br> Qwerty1234 <br> Qwertyuiop1 <br> qwertyuiop1234567890 <br> Spartan117 <br> springfield0 <br> Starcraft2 <br> strawberry1 <br> Summertime <br> Testing123 <br> testing1234 <br> thecakeisalie02 <br> Thirteen13 <br> Welcome123</code> <br> <br>  If you invest 8 times more resources and double the time spent, you can assume that any hacker who is extremely committed or has a <a href="https://arstechnica.com/security/2013/10/how-the-bible-and-youtube-are-fueling-the-next-frontier-of-password-cracking/">good set of wordlists and masks</a> will eventually be able to calculate 39 x 16 = 624 passwords, i.e. 5% of the total number of users.  This is acceptable, but more than desired.  We are determined to add types to the hash table in future versions of Discourse in order to switch to a more reliable (in other words, <a href="http://www.pxdojo.net/2015/08/what-i-learned-from-cracking-4000.html">slower</a> ) password hashing scheme in a year or two. <br><br>  This exercise gave me a deeper understanding of what can happen with the worst case scenario - a database leak combined with a professional attack on password hashes.  Now I can more confidently recommend our service and vouch for the quality of the work that our engineers have done to make it safe for everyone.  So if you, like me, have doubts whether everything complies with safety requirements, then it‚Äôs time to check this assumption.  Do not wait until you are hacked - hacker, hack yourself! </div><p>Source: <a href="https://habr.com/ru/post/330302/">https://habr.com/ru/post/330302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330292/index.html">WWDC 2017. Let's poke a little bit</a></li>
<li><a href="../330294/index.html">Replication Framework ‚Ä¢ deep copying and generalized comparison of connected object graphs</a></li>
<li><a href="../330296/index.html">Tips for engineers from Google manager</a></li>
<li><a href="../330298/index.html">WWDC - what does Apple bet on in 2017?</a></li>
<li><a href="../330300/index.html">Fairy tales that cloud providers will tell you</a></li>
<li><a href="../330304/index.html">IBM introduced the world's first 5-nanometer chip</a></li>
<li><a href="../330306/index.html">Netflix comes out of the ‚Äúbattle‚Äù for network neutrality</a></li>
<li><a href="../330308/index.html">The internal structure of the game Contra</a></li>
<li><a href="../330310/index.html">Overview of VR / AR Google I / O 2017</a></li>
<li><a href="../330312/index.html">The best presentations at the conference United Dev Conf 2017</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>