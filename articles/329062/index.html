<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Choosing a DBMS for storing time series</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pavel Filonov ( Kaspersky Lab ) 
 Today we will talk about the storage of time series. I will try to tell you what approaches I used to try to throw o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Choosing a DBMS for storing time series</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/e0d/953/c8a/e0d953c8a7b6c41351cbcdefde133d7e.jpg"><br><br><h2>  Pavel Filonov ( <a href="https://habrahabr.ru/company/kaspersky/">Kaspersky Lab</a> ) </h2><br>  Today we will talk about the storage of time series.  I will try to tell you what approaches I used to try to throw out as much of my subjectivity as possible, replace it with something more objective, and leave my subjective view somewhere right at the end. <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/7bf/e66/168/7bfe66168ac7877b1fa2a4e60f253b53.png"><br><br>  Almost always lately in my practice, I notice that it is almost never necessary to invent something new to solve standard problems.  Almost always you just need to choose - how to choose yogurt in the store.  You come, there is a shelf, there these rows are all forced, and you need to decide which one to choose: the usual, try a new one, either the most delicious or the most useful.  And they are all bright, beautiful, with advertising.  All one another is better. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The great ones have long said that this is a big problem.  The fact that these bright curtains can slightly overshadow our choice. <br><br>  How can we try?  Anyway, honestly, objectively completely fail.  There will always be a subjectivity in the choice, otherwise it can not be.  But, maybe, it is possible to level this subjectivism somehow?  Maybe, hold in some kind of controlled framework to get something out of this? <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/4eEUrB5oad8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Today I will try to tell you what approaches I used to try to throw out as much of my subjectivity as possible, replace it with something more objective, and leave my subjective view somewhere right at the end. <br><br>  Before this, however, I want to first talk a little about the task that stood.  In my opinion, an understanding of the real problem, which in some sense can be touched - it always clarifies the situation.  It allows you to better understand those or other decisions that have been made.  Therefore, I will start with John McClain. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a23/1bd/520/a231bd52050cc86da6adaaceafee09c1.png"><br><br>  This is John - my hero.  Who in childhood, when he watched him beating terrorists, wanted to be the same as John McClain?  Not all, yes, I see.  So I really wanted to! <br><br>  I watched as he beat the terrorists in the first part, in the second, in the third.  And I began to think, quite recently, that I somehow resembled him.  It's hard to see similarities, I understand.  Probably not external, but a little bit - what we begin to do with him.  In particular, in the fourth part of his adventures, he fought not just terrorists, he fought very harmful cyber-terrorists, who not only tried to seize and terrorize someone, who tried to hack gas stations, tried to break power lines, who tried to rebuild traffic lights in a big city.  Can you imagine what will happen if the traffic lights in Moscow are chaotically rebuilt?  Perhaps nothing will change, but there is a suspicion that you should not do this right away. <br><br>  The film was released in 2007, he was a clownish, humorous.  What are these cyber-terrorists, what is the management of power plants, what kind of destruction? <br><br>  The problem arose a little later, after the release of the film, around 2010, when it seems that the film was watched by many.  Some even penetrated.  Unfortunately, not all of those who have penetrated are good people.  In particular, the name that sounds in the middle is one of the quite popular malware that was discovered about six years ago, which had a lot of skills, a lot of appointments. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/017/af8/493/017af849353f36cc7096908470cb3104.png"><br><br>  One of his most unpleasant assignments was hacking of automated process control systems (APCS) and causing not only commercial harm by stealing information or erasing something, but reprogramming technological processes to cause physical harm.  In particular, because of his actions, the uranium enrichment program, in my opinion, in Iran, was thrown back several years ago.  He simply disabled part of the enrichment plants.  The situation, unfortunately, was repeated.  Several cases have been officially registered.  Reports were created that confirmed that these plants failed not on their own, but directly due to the testing of some attacks, targeted attacks on the process control system. <br><br>  This task began to lead to a search for a solution.  This is a problem, many believe that this is a problem.  The process control system is not very good with safety.  It is necessary to introduce new security elements there and try to protect these objects.  What kind of objects?  Here, so that some image was in front of my eyes, I just took some picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a41/746/4c9/a417464c9f3d12d840723af640b18650.png"><br><br>  Some small factory, most likely an oil refinery, which does a very important and useful thing.  And we need to try to protect it from the threats that may be viewed from the cyber side.  This is a difficult task, it is very multi-layered, I would say. <br><br>  You can look at this little factory from different angles.  For example, you can look at it from the point of view of network behavior: you can draw a network topology, look who interacts with whom, who you can interact with, who you cannot.  This is one solution layer. <br><br>  You can go down below and watch how end stations behave, what programs are running on them, these are allowed programs or prohibited programs.  You can follow this layer. <br><br>  I work in the department, which is still on another layer, which monitors how the technological process itself works, how the relays turn on, the conveyors work, the tanks heat up, and the fluid runs through the pipelines.  And we, for example, look at this object like this. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eb2/935/e45/eb2935e4511a419ee36b66fca8ef8b29.png"><br><br>  Any technological process, in fact, is a dynamic system that changes over time.  It is multidimensional, it has many characteristics.  Here I drew five rows, for an average object there may be thousands, maybe tens of thousands.  This is just some kind of artificial example to present what our data will look like with small eyes. <br><br>  Of course, the main task is processing on the stream.  Because the historical data on hacking is interesting, but not so.  But in order to implement it, this data not only needs to be processed, but it is also desirable to save somewhere.  For historical investigations, for forensic.  For example, it is very important for us to save large amounts of historical data for training our online processing systems. <br><br>  From here a specific technical problem begins to arise.  If we have such data here (I‚Äôll tell about the models a little bit), and we have their characteristics with which these data enter the system, how we can rationally and efficiently organize the storage subsystem to which we will access, in order to conduct historical analysis, or request for our specific research?  So we come to the problem. <br><br>  Before the problem, however, a little bit about the data schema, so that you could imagine what it was all about.  Already in such a little specific language. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c41/66a/2d6/c4166a2d6c5c5f2a58a016196d1810d9.png"><br><br>  One point in the same row is usually characterized by three numbers: this is its certain identifier (channel number), 42 is temperature, 14 is pressure, 13 is on / off relay (possible).  The moment in time when something changed in this dynamic system, and the value at which it changed.  The value can be real-valued, it can be integer, it can be logical.  Substantial describes them all. <br><br>  A little bit about the characteristics, so that it can be seen that, probably, it has something to do with the subject of the conference.  There is not so easy with the volumes. <br><br>  Unfortunately, for an average object the number of such rows is of the order of tens of thousands, in exceptional cases it can be an order of magnitude more.  With intensity, thank God, a little bit better.  Usually sensor values ‚Äã‚Äãare collected on average once a second.  Maybe a little more, maybe a little slower, but according to real objects, the characteristics are approximately as follows. <br><br>  And we are starting a little bit already trying to imagine the volumes in which we have to work.  This is a very important point, because, in fact, from these numbers you can begin to derive something without which I, for example, feel very uncomfortable - without non-functional requirements. <br><br>  When they sometimes say: ‚ÄúMake it quick and good,‚Äù and I don‚Äôt understand such words.  I begin to torture a person: ‚ÄúWhat is‚Äú fast ‚Äù?  And what is ‚Äúgood‚Äù?  And what is your data?  And how many volumes do you have?  And what are your intensity? ".  Only after this check list has been passed, and the main points are known, can I begin to try at least to imagine solutions. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/439/b1c/486/439b1c4866b2a9c100d6c66fef0efdeb.png"><br><br>  There, however, is not so simple, there are many solutions, there is absolutely not one.  I am sure that each of you can calmly now add five more of his favorite DBMS to this list.  Of course, everyone here simply does not fit.  They are different.  Some work well in one case, some work better in another, some probably work well for the task I was talking about. <br><br>  But which ones?  How to understand?  How to choose?  This is a big problem.  I come across it often and constantly.  It is very rarely necessary to invent a new one, almost always you just need to choose wisely somehow from this set. <br><br>  There are several approaches to this choice.  First, I called it the ‚Äúnon-engineering‚Äù approach. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f2/0f6/42c/1f20f642c66fd7e1d334e9683d35d69b.png"><br><br>  Unfortunately, or maybe I do not know, fortunately, he is sometimes promoted.  What are some examples of non-engineering approach? <br><br><ul><li>  For example, like this - everyone kept it in X, let's use it here too.  It doesn't matter that the task is different, the subject area is different - we know how X works. </li><li>  Or here is such a sick way, when "We used it there, do not do this, in any case, please."  I met such people. </li><li>  The third is my favorite.  Yes, I feel many with me in solidarity.  But dangerous, slightly dangerous, but loved. </li><li>  We are at the conference with you, here they talk about databases.  I probably do not remember the conference, where they talk more about databases than here.  And of course, the first thing - people come after, the next day to work, they say: ‚ÄúWe were told about such a thing, let's try it!‚Äù. </li><li>  I also like this one very much - an article has been published somewhere, everything is great there: the graphs are simply exponential, they fly to the top, the dollar is drawn at the top, everyone is happy.  Let's choose this one. </li></ul><br>  Of course, the slide is humorous, but let's be honest - and who can now stand up bravely, introduce themselves and say that "indeed, I am such and such, and I used the non-engineering approach before"? <br><br>  And can I ask someone from the assistants?  Please mikrofonchik. <br><br>  Please introduce yourself and say it.  Bolder! <br><br>  <strong>Comment from the audience:</strong> I am Vladimir Myasnikov.  We used the approach "Let's take X, and there we'll figure it out." <br><br>  Thank you very much, Vladimir!  Let's applaud! <br><br><blockquote>  <font color="gray">By the way, we posted in open access the video of the last five years of the conference of developers of high-loaded systems <a href="http://www.highload.ru/">HighLoad ++</a> .</font>  <font color="gray">Watch, learn, share and subscribe to <a href="https://www.youtube.com/user/profyclub">the YouTube channel</a> .</font> </blockquote><br>  It is like that part of the therapy.  Do you know, yes?  To deal with a problem, you must first realize it and admit to yourself.  Vladimir is clearly a brave man, and many here are brave, they are ready to admit that this is a bad approach.  Maybe there is another? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b6/3a0/e99/5b63a0e99a387a54090c8bc3aca9dbdc.png"><br><br>  Let's call it "engineering."  Probably a little more complicated.  Maybe it is even somehow structured and decomposed.  I tried my decomposition, it does not claim to be common.  Let me tell you point by point and, in fact, this will be, at the same time, the content of the further part of the report. <br><br><ol><li>  First, a good read after all.  What is what has appeared in recent years?  Because I am waiting with fear when the article ‚Äú10 new databases that you have to learn this week‚Äù comes to me at Fidley.  I feel that sooner or later this will happen.  Everything appears there at such a speed that it is difficult to keep pace with the follow-up, and it is necessary to get acquainted constantly with literature.  Including, by what you are listening to at the conference: who tried what, who is pleased with what, who is dissatisfied with what.  And so we spread our experience to other people. </li><li>  Generally speaking, it would be nice to understand if we choose, then by what criteria - price, speed, scalability?  They need to decide.  Select by all criteria is not possible.  Most likely, your non-functional requirements can tell you which of the criteria in this task, and only in this task, you should consider first and which in the second. </li><li>  This is the most interesting, such a long-awaited item: you must choose who to compare.  There must be competitors.  Unfortunately, it is difficult to compare all.  There must be some sort of preliminary selection.  When, even before you reach specific numbers, you realize that this seems to be suitable as a solution, and this cannot.  Or you just understand that you do not have enough strength to measure everything, and then you need to choose what seems to be the most adequate for now.  But, of course, this list is unlikely to consist of one item, hardly even two. </li><li>  About the fourth point, I will say, probably the most.  If we choose what we measure and even choose whom we measure, then the question is very thin and very interesting: ‚ÄúHow do we do it?‚Äù.  Because even if you take two people, and they choose that they measure the same thing and the same people, they can do it completely differently, and the numbers can turn out very different.  Therefore, somewhere, maybe I will go into extra nuances, but, in my opinion, this is the most interesting part: how they measured how to reproduce it in one way or another.  Here we devote a lot of time to this. </li><li>  This is quite a hard part, because then it must be implemented.  She herself is so long, it requires some labor, work.  We will talk about this later.  In general, to conduct this testing, for each of the contestants to understand which tsiferki correspond to him.  This needs to be done by hand, even writing code.  Oh my God! </li><li>  By the way, sometimes the results are not enough.  If you bring a beautiful sign with the numbers "your" and say: "Here is the result."  They will say: ‚ÄúWell, good.  So what? ‚ÄùThere should be an analysis.  Numbers are not enough.  Always behind the numbers should be normal words that explain them, they reveal them, trying to convey the meaning of this result, and not just leave it in the form of bare numbers, saying: "Everything is clear." </li><li>  And in the end, some specific recommendations are required.  Moreover, they can hardly be very strict, that "only this will fit all."  In fact, of course, there may be several solutions.  It must be said, perhaps, with what degree of confidence this or that solution will do.  For example, in the form of a report and specific recommendations. </li><li>  Complicated approach.  When I wrote it down, more than three points are generally difficult, but here they turned out to be as many as eight.  This approach, I see it, but very rarely, and I understand why.  He is laborious.  Indeed, it is necessary to spend time on this, man-hours, if you like, some kind of effort, although it would seem: "Let's take X, and then we'll figure it out further." </li></ol><br><br>  But here, if we waste time, we do it for some reason.  Somewhere we want to save it.  For example, I once realized that testing is very time saving on parsing "bugs".  Maybe here we can save time?  This is possible. <br><br>  Who faced the situation when he had to change the database from release to release in production?  Why, few people have encountered.  And who liked it?  There are no hands at all.  It is very dangerous. <br><br>  If the choice was made unreasonable and blind, you have the risk of not getting into the nonfunctional requirements you need.  Especially if they start to change.  Who have they changed in their time?  Yes, this is also possible.  Therefore, these labor costs can be paid off, in the future, of course.  That is, it is difficult to predict how much they will pay you back, but believe me, sometimes it's worth it. <br><br>  Here is our plan.  Let's go for it.  Let's start with a critical review of the literature. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/377/cd5/8da/377cd58dabc5b2396238c6889c1f3839.png"><br><br>  I basically tell you what I didn‚Äôt like when I started reading.  Some specific points.  For example, a lot of database comparisons for a particular task are carried out - who do you think?  - The developers of these databases themselves. <br><br>  I noticed one hundred percent correlation, really one hundred percent.  If the developer of the base Bingo-Bongo, which I had just invented, makes comparisons, then there wins - who knows the correct answer?  - Bingo-BongoDB wins there.  Yes, always.  Amazing  It doesn't matter what kind of comparison it is.  I am confused by this result.  I am not ready to immediately trust him just like that.  In general, I am a very gullible person in life, but when I put on the engineer cap, I immediately begin to doubt very much in many ways.  For example, here in such reviews. <br><br>  Another interesting point that made me laugh, but I saw him often.  What do we need to do to properly compare different DBMS with each other?  Of course, take different data.  The funny thing is, when one article refers to another article, it says: ‚ÄúThat's where they got that number, and we got that number.  They had the same data there - we have other data.  They have one server - we have other servers. ‚Äù  Actually, what are you comparing?  Also not very nice. <br><br>  There are more good sources, at the end of the slides for those who want will be a link to what I liked just. <br><br>  And most of the authors say that if you really want to choose correctly, solve your problem, do not look at what data they have and what load profiles they have.  Take your load profiles, take your data and measure only on them.  Only these figures, and not 100% certainty, will give you an idea of ‚Äã‚Äãhow this will work further, for a long time.  Why not 100%?  Most likely, if your system should work for two years, you are unlikely to test it for two years first.  Your testing time will be more limited.  Therefore, there is still danger, but of course, it is greatly reduced. <br><br>  Let's go about the criteria.  What will we compare? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/42b/287/c25/42b287c2552f0b9c032cb15d994cb44d.png"><br><br>  I chose the most important for my task.  There are not all criteria by which a comparison can be made.  I will not say what I have dropped.  Let me, I rather leave it to additional questions: "Why do not you compare according to this criterion?"  I will tell you about what I am comparing. <br><br><ul><li>  For example, write bandwidth.  It's important for me.  I need to keep up with it to persist, fall onto the disk and withstand the loads that I have registered.  But the question turned out to be very difficult, incredibly difficult.  When I see an article somewhere where they say: ‚ÄúBandwidth is so much,‚Äù I begin to doubt - and under what conditions was it tested?  Because, in my experience, there is always a dependency.  For example, it varies with the size of the "batch" (how many in the data packet at a time we are trying to write there).  It varies with the number of customers who write to the database.  It is even slightly different if we write to the database for a long time.  For example, if we write 5 minutes, maybe one digit, and if 12 hours, then there may appear other numbers that do not always look like what is usually called ‚Äúpeak performance‚Äù.  And it seems that this criterion in itself is not very trivial.  It can already be viewed from different angles.     (  ),           . </li><li> ,      .  , ,   .  -   .   ,     .      ‚Äî    ,   .  , ,    .      ?          ,     :     ,     ,   ,         .  ,       .  ,     .  ,      ,     ?      ,  ¬´ ¬ª. </li><li>       ‚Äî  .  ,     ,       .  ,  .  ,   , ,     .  ,    .   ,    ,      ‚Äî    ,       ‚Äî  ,  -  .        ,      .           -  ,    ,    .      . </li></ul><br>  Here are our criteria, so I‚Äôll talk about them first.  And we start with the bandwidth, we still have HighLoad.  This is one of the most interesting characteristics, not so trivial, though, as it turns out. <br><br>  Before this, our "contestants".  We will compare these four: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0e3/414/b56/0e3414b568e9c6eb5bb036214d14ae14.png"><br><br>  Here I immediately want to describe one interesting point, which, most likely, many of you will emerge.  Why do I compare specialized solutions (and this is OpenTSDB and InfluxDB - they are ‚Äúwe are only a time series, this is our patrimony, we can‚Äôt practically keep anything else‚Äù) with a general-purpose DBMS?  After all, it would seem, most likely the answer will be obvious, that in many characteristics the specialized ones are better. <br><br>  The answer here is, in fact, I will immediately give it: on the one hand, yes, a specialized solution is good, but what if you have all the solutions for non-functional requirements?  Should you fence the zoo of different systems?  After all, most likely, you will store not only the time series, most likely, you still have some kind of metadata and some richer model data.  Most likely, they will also need to be put somewhere.  What if you don‚Äôt produce a zoo of specialized solutions, but show that one solution copes with this and that?  Therefore, it was interesting for me to take solutions that, in principle, are already being used.  In order to see how well they cope with this situation.  In order, as a last resort, not to produce a zoo. <br><br>  Who happened to have multiple databases in the project?  Who had two?  Who has three?  Who has four?  Who has five?  There are a few people left ... This is also not very good.  Yes, colleagues agree with me.  Thank.  It fits into good requirements, but for administration it is not a very convenient thing. <br><br>  Here we will talk about these four. <br><br>  A little bit tsiferok, where without numbers.  What we compare to.  Here, too, this slide is very important, because I want to insert such a disclaimer, and that you understand it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ff9/214/c22/ff9214c2202bf474e6b5d8c88ca33d54.png"><br><br>  I will measure now not a DBMS.  I will measure them in a whole bundle, that is, I automatically measure, as it were, the client.  Because I don‚Äôt, frankly, wonder how the DBMS works, I don‚Äôt sell them.  I wonder how they will work precisely in my task, in my infrastructure, with my clients, with something close to reality. <br><br>  Therefore, keep in mind - and this is a very important point - that the numbers that I will give refer to non-pure DBMS, they still attract everything described here.  The fact that there is a Docker (where now without it is very convenient, I like it).  There are specific clients that have one very interesting feature - they have not yet very optimized storage drivers, so in some places there may be problems with the drivers.  And this is the reality of our world - not every programming language has ideal drivers for all the DBMS that we need.  Sometimes in these drivers - oh my goodness!  - there are bugs, sometimes these performance bugs, and with this we also need to cope and understand this. <br><br>  And now to the most interesting. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/13e/d81/63b/13ed8163b135b0a56dd4496e2fe2bec3.png"><br><br>  The graphics are gone.  About bandwidth is a very complicated thing.  For a long time I tried to understand what it is, what is this value?  Is this a number?  It is addiction?  This, God forbid, integral?  Thank God, it turned out, it seems, no. <br><br>  At first, I tried to understand first what I would measure and how I would do it.  Let me try to clarify what the blue graph is and how it is built.  This is about testing methods. <br><br>  I have a ‚Äúvolume knob‚Äù, very simple - how much I will try to record.  I actually have two ‚Äúpens‚Äù there: how many sensors do I have in the system, and with what frequency do they log their values.  For example, I can ‚Äútwist‚Äù the number of sensors by fixing that each of them logs its values ‚Äã‚Äãevery second.  And then I begin to ‚Äútwist the handle‚Äù on the horizontal axis, my supposedly expected throughput, that is, 20 thousand - these are 20 thousand sensors, and each of them logs values ‚Äã‚Äãevery second. <br><br>  What is the vertical axis, where is the blue graph actually postponed?  We take this ‚Äúvoltmeter‚Äù neat and begin to measure: how much have we really recorded in the DBMS?  And it turns out, too, it can be done in different ways and cunning!  For example, here each point (well, they, of course, with an approximation) is obtained in the following way: we start with such a load for five minutes, log each second how much we recorded at that second, build a histogram of the distribution of these points and choose the median.  Very cool, I like it, this is such a bandwidth, to the left of which there is exactly half of these points that we measured.  That is, it guarantees us that at least half the time we wrote at such a speed and not less than it. <br><br>  Sometimes you can choose the average, but here it will give you a smaller number.  Why?  Average, just averaging, it is sensitive to emissions.  What if you accidentally had a hard disk there for some amount of time, or someone else connected to your system and did something for a couple of seconds?  Then you may have a few failures for a few seconds.  Average - it is very sensitive to these failures.  I did not draw it here, but the average is always less, and in this case, in my opinion, it does not show approximately the real state of affairs.  Median shows better.  I understand what it means.  At least half the time we will write "no slower than so much." <br><br>  We begin to be selected to the most interesting, you probably paid attention.  Here is this flat line - level.  That is, we are turning the ‚Äúvolume knob‚Äù, but ‚Äúlouder‚Äù is not becoming.  It would seem, probably, it is.  Here it is - bandwidth.  It is impossible to write more to this DBMS, it seemed to me at first, but what if we slightly change the way we write?  What if we start writing not one point at a time, but two points at a time?  What happens then?  And you‚Äôll get another graph, the red one: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9fe/3c2/916/9fe3c291611f834e4f4ef9376255d756.png"><br><br>  When on every insert, we do bulk insert.  We insert not one point, but two whole points, and ‚Äútwist‚Äù the same ‚Äúpen‚Äù.  It turns out that this threshold rises.  So what is bandwidth?  Blue or red?  And, in general, why so? <br><br>  Here a stupid example comes to my mind, you will excuse me, but it is somehow close to me.  Few related to the DBMS.  Let's assume such a picture that in the evening the company is well rested, having fun and deciding to send someone for a bottle of milk.  It seems to me that milk is best here.  What is a man doing?  He dresses, shoots, takes the keys, goes out, goes down the elevator, goes to the store, searches for the shelf, takes milk, walks to the checkout, makes ‚Äúpeak!‚Äù, Takes the bag, bottle, rises, undresses, brings to the refrigerator - that's it!  We have made a system with a capacity of "one bottle of milk for the time he went." <br><br>  Now we will think: "What if you ask him to take two bottles of milk?".  What is the difference in time?  The fact that the checkout will not be ‚Äúpeak!‚Äù, But ‚Äúpeak-peak!‚Äù, And the rest of the time will be one and the same.  And we get a system that has almost twice the bandwidth. <br><br>  If we return to the world of the DBMS, then how will this scene look?  Probably, this is preparing a request, opening a socket, establishing a network connection, sending a request, server-side parsing a request, preparing it, executing, possibly raising from a hard disk, preparing an answer, serializing the response, packaging, sending to a socket, client-side deployment and reading.  Probably, here, if you also ask to write down two points, and not one, here are common pieces, this will allow us to start saving a little. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2cf/681/4cd/2cf6814cd69724fa3ad426d41cc95f60.png"><br><br>  There is another interesting approach, it turns out.  Another axis that can be ‚Äútwisted‚Äù - and what if we send two people for a bottle of milk?  What if we write in two streams?  There is also an interesting effect.  We really do it faster than at one point.  Greens are two streams, but one point at a time.  It is curious, by the way, that they did not overlap each other.  Greens slightly smaller.  True, within the limits of fluctuations, but still the characteristic median is smaller than that of the red one. <br><br>  That is, there are two axes, you can still twist the "handles."  You can ‚Äútwist‚Äù, how much we write at a time, and you can ‚Äútwist‚Äù, how many clients we write to this system. <br><br>  Let's twist them, it's interesting.  These are the ‚Äúpens‚Äù, you can ‚Äútwist‚Äù them, see what happens.  For example, we will "turn" the batch.  This is one of my favorite "pens", it is very simple to implement, so I love to "twist" it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4dc/b65/4dc/4dcb654dcb663c6c0cecaaf3ce0d953e.png"><br><br>  Let's go on other schedules.  Take different batches, emki, and build our points.  Here it is clear that for the powers of two they are taken.  The points are constructed in exactly the same way: the experiment lasts for 5 minutes, and the median is calculated from all throughput capabilities per second that are obtained.  For two contestants.  An interesting pattern is visible, that, yes, it grows, but, by the way, somehow it starts to bend a little bit, that is, it clearly grows not to infinity, maybe not very linear.  Another interesting point - if at some points they are very similar and behave approximately the same, then at others they start to differ slightly and behave differently. <br><br>  Is bandwidth really this curve?  Any kind of addiction?  Maybe.  But working with curves and dependencies is terribly inconvenient.  They are inconvenient to enter in the table.  Convenient to work with numbers.  What would we have come up with, to take and turn each of them into a number, into a number that is convenient to measure: more or less.  Because everyone is inconvenient to post on this schedule, they can begin to overlap.  Ambiguities.  Let's think about how this can be done. <br><br>  The first is that when I see such a thing, my hand suggests itself to take a pen and do something like this ‚Äî to make some kind of curvature: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9af/63f/d91/9af63fd91b287e615b098974d29bc714.png"><br><br>  As though some laws, probably, dependences.  Then comes the moment of truth.  You need to be very tense and guess what kind of a crooked link it can be.  Need to pick something that looks like.  There are many selection methods.  One of the easiest and most loved and used by me is to play a little bit with the axes.  What if we start postponing not batchy along the horizontal axis (now we‚Äôll have to strain a little), but logarithms from the batch?  Logarithmic axis.  Rarely, maybe, he knows why it is used, but it is very useful in such situations, because in it this picture looks a bit simpler: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/71f/914/807/71f91480715b5726d6f5e81ffc873b24.png"><br><br>  With direct work more convenient.  Which, by the way, tells us that before this graphs really were logarithms.  Direct understandable.  Probably, even these angles can be calculated.  Here the title of the slide even reveals how it is done.  There is a not very complicated linear regression method, which will give us these angles, more precisely, the tangents of these catches. <br><br>  Next is a subtle point like that.  He is very debatable, and I really hope that someone will tell me later where I got this from.  I am sure that somewhere this was once described and well thought out.  And the idea is this: let's take these angles, or rather, the tangents of these angles, instead of taking these graphs.  The bigger the angle, the better it feels, the bigger the better.  The smaller the angle, the worse it is, the smaller the tangent will be.  That is, we can try to introduce this order relationship more strictly here. <br><br>  For example, for our contestants (these are not angles, these are tangents of angles, I have recorded here) we have obtained approximately such measured dependencies of throughput on the size of a batch.  In this case, for two. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a84/515/e99/a84515e9905531b61cd205a3b027b49c.png"><br><br>  Summarize the rest.  And we will do one more trick. <br><br>  Absolute numbers - 20 thousand, 100 thousand, 200 thousand - they are smart for advertising leaflets, but I don‚Äôt really need them.  By the way, I only know that I need a minimum.  I know, for example, that each of the contestants for peak performance fits into my non-functional requirements, even with a margin, some with a large margin. <br><br>  In order to then compare them with other criteria, I use a simple technique.  I simply normalize them to the maximum, and I get such a relative value from zero to one ‚Äî who is more, who is less.  Figuratively, by this criterion - who is better, who is worse. <br><br>  It is clear that there is still room in this plate for other columns to appear, according to other criteria.  Let's try to finish them. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/01f/fb4/a8c/01ffb4a8c367f02ed3fa54c657232ee5.png"><br><br>  For example, bandwidth on the number of clients.  Same.  We measure.  Only now on the horizontal axis we postpone how many streams they write with us, we get these points.  It can be seen that they begin to tremble a little.  Here you can guess that krivulinki can also be held.  They will be logistic functions, that is, with saturation.  They really go to such a threshold and do not go further. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d1/8c3/2e1/7d18c32e11cade9254b9d839535dbb20.png"><br><br>  Why, by the way looks like this?  Why so strange?  In fact, our nature is limited and, for example, on a machine on which they are tested, or rather, the environment is also limited by the number of cores that a DBMS can consume.  And, I think, from this graph, it is immediately clear what the number of cores is. <br><br>  I suggest.  And, let's, try to think, and now let's all together say how many cores are issued by this DBMS?  One two Three?  Four?  Some guessed, really four. <br><br>  As soon as the cores run out, terrible competition begins, and to work in this area is practically meaningless.  We need to work in the field earlier, so here I use a different approach.  I do not want to measure these curves entirely, I want to measure only in those parts where they are linear, where there is no this tough competition yet.  You never know, I have this machine with four cores, but what if I transfer to 20 cores, and what if someone is very lucky, he has 60 cores.  There probably will be other curves, so here I will measure only the linear part.  Here there generally lays more or less on some linear piece. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d5e/b52/a5d/d5eb52a5dc837ed67435104533d7026f.png"><br><br>  And the reception is the same - straight, the tangent of the angle of inclination - here it is.  We can get tsiferki dependence, figuratively, throughput on the number of clients, as I propose in this report to understand, and fill the plate with orange rectangles. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f2d/a9e/93e/f2da9e93e36a318f4ce2cae5fd931cdd.png"><br><br>  Get a measurement on this characteristic.  Go further and deeper.  For example, look, and what happens under load?  There, in general, the most interesting happens.  These are the most expensive experiments, because they last 10, 12 hours each.  My longest experiment, in my opinion, is three days.  For different DBMS, how they behave.  Some interesting general patterns are observed.  For example, this is OpenTSDB under a load of 60 thousand: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fc5/4e8/51a/fc54e851a39bd212a6ab94b8ec2a3cee.png"><br><br>  In principle, everything is quite predictable, everything is fine.  Sometimes the DBMS leaves on the DBMS-shny affairs, something does there.  Judging by the logs, she very actively communicates with HBase, that is, HBase does something very active, then comes back.  This, by the way, means that you need to be prepared for this, customers should be ready.  This is, in general, a good practice, because the DBMS can ‚Äúgo into itself‚Äù a little.  If she leaves forever, we don‚Äôt need it, but maybe a little.  But the rest of the time everything is fine, everything is stable, well done! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/321/1f0/abd/3211f0abd4c0bf5cf5736fef7b6bafc5.png"><br><br>  80 thousand.  Also.  It seems that stability is sufficient, and even I will tell you more - stability is understood here a little bit formally.  If the median (sometimes called its fifty-percent quantile) means half of it is to the left, then here I measured the ninety-nine percent quantile.  That is, it interests me that in 99% of the total time, the record in the DBMS is at the level at which I want.  That's 80 thousand indeed it is.  At some moments, of course, we can fall out, but they do not exceed 1%. <br><br>  So it still looks like ‚ÄúOpenTSDB healthy person‚Äù. <br><br>  And here is the "OpenTSDB Smoker": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e61/bfe/4ab/e61bfe4ab8eb75d91e84b89fe7356cf0.png"><br><br>  It can work on such a load, but obviously the ninety-ninth percentile, you see, this is not a hundred, it will obviously be much less.  ‚ÄúIt goes into itself‚Äù more often - you can understand, it‚Äôs still necessary to withstand such loads.  And this means that, looking at such a schedule, I would say: well, this piece under a hundred should not be kept in this installation.  Under eighty - hold.  One hundred for a long time do not turn on!  At peak load, it withstands even more, but I would not recommend keeping a hundred for 12 hours. <br><br>  And then this threshold appears.  Unfortunately, I could not calculate it accurately.  The experiments went with a very big step.  I stopped at the last step, where this characteristic was satisfied.  So that for 12 hours the system could work stably under the desired load. <br><br>  And tsiferki work under load.  Naturally, they are much smaller than the peak ones, but in this sense they are a bit more interesting, because they describe how it will last for days, and not how it will work for only five minutes.  And here they are blue bars: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3d6/851/e50/3d6851e5071bc7cec1cb259af16d959b.png"><br><br>  A little bit of "captaincy", probably, is already visible here.  Although, if you look at others, there are already some interesting interconnections, we will talk about this later. <br><br>  Let's go further.  Query execution time. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0b9/4c3/617/0b94c3617d75ca745e089388cb9f5967.png"><br><br>  Here, thank God, a little bit simpler.  Putting on the horizontal axis the length of the interval, how much we want.  We want to request data - for a day, for three days, for a week we want to upload them to ourselves.  We make 100 requests and measure the ninety-fifth percentile of the execution time, that is, I want 95% of requests to be executed shorter than in the time specified there. <br><br>  For me, this is more important, so there is no median here.  Why?  Because this is the most critical thing - the user has pressed the button, and the circle is spinning.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And it does not suit me here that in half the circle will stop spinning faster than in 5 seconds. I want 95% of users to complete this circle spinning earlier than in the allotted time. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/784/86e/35a/78486e35a6941ac0938dbf732e647a2e.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here everything is quite predictable. The dependence is very well approximated linearly, which is quite expected, so the reception is the same. Here the only thing is that here we have to turn the situation a little. Here the more, the longer we wait, the worse. Therefore, here we take not the tangent of the angle of inclination, but the reverse to it. Then the reverse law, feedback, works. We get green squares:</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/3b6/fdd/e29/3b6fdde29be727b83be57017565ba230.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yes, yes, I understand that at first a little bit of ‚Äúcaptaincy‚Äù will be. I tried to do everything honestly, with myself, at least to be honest. And I just give the results that I honestly received and can even reproduce them. I ensured that these results were reproduced, and these graphs did not tremble. Let us assume that such a schedule on Monday is not much different from such a schedule on Friday, so that they settle down in this sense.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/833/589/186/833589186a43545a2a27269fc1ad866c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About compression. Probably, I practically can only show results. The measurement is very simple. We load the approximate amount of traffic per month, we know how much it takes in its raw form, we look at how much the DBMS has occupied on the hard disk. Including all the meta-information, even I did not consider that she could reserve something extra for herself. Here I was a little rude. I just take it - how much did it take to disk additionally. Received coefficient ratio. And here it is, the compression ratio.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Someone, by the way, was even more than one, because there is a lot of meta-information, we still need to store indexes, we still need some additional identifiers, official fields. Someone had less than one, it is clear that good compression works. Especially for those who knew that they would add real numbers. Yes, they are very tight, really.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Got our intermediate result. It seems that, yes, the result is obvious, but I still wanted to go further, I did not want to dwell on this chart. Although, here it is already possible to draw some conclusions. If you wanted to bring it to some kind of automaticity, reproducibility and think: ‚ÄúIf the situation were a bit more complicated, what would I do next with these graphs?‚Äù. What if there were no top, top competitor? After all, there is very strange. Someone in one is good, someone wins in another. How can we make this multi-criteria comparison?</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b4/0fd/73c/2b40fd73c257688a7e17c6c55ba27e85.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's get a little bit of math involved. Take this tablet and rewrite it. I would not say that it is more convenient, but more convenient for us, the view. Nameplate of numbers. The lines are our competitors, and the columns are our criteria that were on the last chart. Now we‚Äôll add the thing I‚Äôve been waiting for and wondered where to add it: which of these criteria is more important to me than others; more important, less important. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I can, in principle, make way, but my colleagues really know. It seems that this approach is familiar to many. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This we declare out of competition. We enter our weight matrix. Further, I think you can guess what will happen. Multiply. We get. Outside of the competition, while we remove. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/77e/50b/b16/77e50bb160967bb3b1b2d6117cb9a7d4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here he is our winner.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What if we slightly change the weights matrix? What if we highlight something more important? </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/1ae/895/595/1ae895595025cec985e1e14ef5e674f4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I will first show an artificial example, the second criterion is very important to us (this is the dependence of throughput on the number of clients). If we then do everything formally, we will have a different winner. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here, of course, this is all a slightly artificial example. Such a small "captaincy", because the one whom I excluded out of the competition, he, it seems, is good. And when I got this result, yes, I was at first a little ashamed - that I would come to the people, would I tell them some extra things, and everything is clear there? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Therefore, I began to look for, maybe something that I do not know.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/16a/22e/359/16a22e359a7bcadbc53c28b634adeb81.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maybe find someone who will compete, some dark horse who can show himself in comparison with our competitor. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/aec/54a/17f/aec54a17fb53c80683f27449ea09dac9.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Began to study who left recently. Stumbled upon one very interesting project. The last contestant who looked interesting by advertising booklets. The source could be read, they are sane, I liked. And it was interesting to drive him through the same chain. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I, probably, will only show the final result, where unexpected effects began to appear. And I have never seen such unambiguity in them. If we now leave only the obvious leaders, and try for them the same trick, then there it may well make sense. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/78c/33d/1d7/78c33d1d759870e03f7a6552cc411e7d.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equally, when all the same - we have one winner.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/455/863/436/4558634367ca5d9f8c6d71bd3fcca127.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we single out some criteria, like a little more important, it is different. </font><font style="vertical-align: inherit;">They begin to change. </font><font style="vertical-align: inherit;">And it is here that we are trying to bring in our subjectivity. </font><font style="vertical-align: inherit;">Look, we subjectively measure non-competitors, we subjectively measure the criteria for which it is important for us to look for something. </font><font style="vertical-align: inherit;">And depending on this, we get different results. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/66c/da3/4c8/66cda34c8c262232137f9144a85868cc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In principle, these are probably the main thoughts that I wanted to convey, so I move smoothly to a conclusion. </font><font style="vertical-align: inherit;">Besides, the time I have, I think so, is running out. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">My conclusion is ‚Äúcaptain's‚Äù, which I myself am trying to formulate:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> check on your data, on your systems - this is very useful; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a little bit of mathematics never hurts, believe me, it makes you smarter in the eyes of others; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is an interesting point that colleagues, apparently, are well aware of - one can also measure a subjective assessment. </font><font style="vertical-align: inherit;">The main thing - know that you measure it.</font></font></li></ul><br>  Basically, that's all. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f0f/16a/5da/f0f16a5daa58ed801bb119e22a53c469.png"><br><br>  Thanks for attention. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If you are interested, you can follow the links below, and I have everything. </font></font><br><br>  <strong>Sources:</strong> <br><br><ol><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y. Bassil</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A Comparative Study of the Top DBMS Systems</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><a href="https://arxiv.org/pdf/1205.2889.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paper</font></font></a> </li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C. Pungila, O. Aritoni, TF. </font><font style="vertical-align: inherit;">Fortis</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System for Sensor Readings</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><a href="http://highload.guide/blog/uploads/2009/10/9-IETEBenchmarkingDatabaseSystems-secured.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paper</font></font></a> </li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B. Cooper ,, A. Silberstein, E.Tam, R. Ramakrishnan, and R. Sears</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benchmarking Cloud Serving Systems with YCSB - </font></font></em> <a href="https://www.cs.duke.edu/courses/fall13/cps296.4/838-CloudPapers/ycsb.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paper</font></font></a> </li><li> <strong>T. Goldschmidt, H. Koziolek, A. Jansen</strong> . <em>Scalability and Robustness of Time-Series Databases for Cloud-Native Monitoring of Industrial Processes ‚Äì</em> <a href="http://www.es.mdh.se/pdf_publications/3604.pdf">paper</a> </li><li> <strong>T. Person.</strong> <em>InfluxDB Markedly Outperforms Elasticsearch in Time-Series Data &amp; Metrics Benchmark ‚Äì</em> <a href="https://influxdata.com/blog/influxdb-markedly-elasticsearch-in-time-series-data-metrics-benchmark/">blogpost</a> </li><li> <strong>. -.</strong> <em>  In-memory NoSQL    ? -</em> <a href="http://www.highload.ru/2015/abstracts/1887.html">slides</a> </li><li> <strong>B. Schwartz</strong> . <em>Time-Series Databases and InfluxDB</em> ‚Äì <a href="http://www.xaprb.com/blog/2014/03/02/time-series-databases-influxdb/">blogpost</a> </li><li> <strong>K. Eamonn and K. Shruti</strong> . <em>On the Need for Time Series Data Mining Benchmarks: A Survey and Empirical Demonstration</em> ‚Äì <a href="http://arbor.ee.ntu.edu.tw/~brdai/papercollection/mining/keogot02_Journal.pdf">paper</a> </li><li> <strong>R. Sonnenschein.</strong> <em>Why industrial manufactoring data need special considerations ‚Äì</em> <a href="http://pgday.ru/ru/2016/papers/58">slides</a> </li><li> <strong>S.Acreman</strong> . <em>Top10 Time Series Databases ‚Äì</em> <a href="https://blog.dataloop.io/top10-open-source-time-series-databases">blogpost</a> </li><li> <strong><em>J. Guerrero</em></strong> . <em>InfluxDB Tops Cassandra in Time-Series Data &amp; Metrics Benchmark ‚Äì</em> <a href="https://www.influxdata.com/influxdb-vs-cassandra-benchmark-time-series-metrics/">blogpost</a> </li><li> <strong>J.Guerrero.</strong> <em>InfluxDB is 27x Faster vs MongoDB for Time-Series Workloads ‚Äì</em> <a href="https://www.influxdata.com/influxdb-is-27x-faster-vs-mongodb-for-time-series-workloads/">blogpost</a> </li><li> <em> </em> <em>ClickHouse -</em> <a href="https://habrahabr.ru/company/yandex/blog/303282/">blogpost</a> </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thank you, I am ready to answer your questions. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Question:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hello. Thanks for the report. Such a question: when you measured under load, what was the end of all? Rested in iron, in memory, in the processor? Or were these the limitations of the engine itself? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Answer:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This is, shall we say, ancillary work, which the engine must constantly do. That is, it is clear that, most likely, the recording goes constantly to the memory first, but it is necessary to periodically flush it to disk. And at this moment the drawdown began. This was clearly visible both in the logs and in the way the system behaved. Because, I did not draw here, I have automatically written the graphs of the load on the hard disk. They correlated very well with throughput failures. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Question:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I wanted to ask: did the requests of a parallel record go, how were things with them? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Answer:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Here I tried to imitate the real situation. Here are the timelines for the execution of requests. This system was constantly and in the write load. I didn‚Äôt set about, however, not hundreds of thousands, I took my indicators, in my opinion, I took 20 thousand per second record. Kept her non-stop. It was at that moment that I made inquiries and measured. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moreover, there I came across one problem. I now take the opportunity to tell a little more.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At first everything was very fast. I did not understand why. And then I understood - I did the same requests. And as soon as I began to randomly choose a channel through which I request, and randomly choose an interval through which I request - the numbers immediately came to normal. And yes, magic did not happen. It really doesn't always work fast. Especially if we want to upload data for the week. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Question:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> You said that you are not very interested in how the DBMS works, but, probably, you run them with some parameters, with some settings? I mean, for example, the same OpenTSDB can do a lot of things. And the rest too. Did you take the default, or did OpenTSDB use append mode instead of compaction? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Answer:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Good question.</font></font> Thank you very much.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I will answer it like this. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First, of course, part of me is lazy, and does not want to bother with the settings of each of them in detail. I understand that if you take a good DBA, he will come and say: ‚ÄúYou do not understand anything. Now I‚Äôll do it all and everything will work. ‚Äù But he does not always have. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Therefore, of course, I am interested in systems that by default behave themselves well. But somewhere I used his mailing lists, wrote to people, asked me to explain some facts that I discovered. They advised me. In particular, the PostgreSQL mailing list advised very well that I needed to set it up correctly in order for the data to go better, and the artifacts that I watched were gone. In particular, they advised me how to properly use VACUUM, when, in which areas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenTSDB. No, I did not change append / compaction. In my opinion, I have something in the storage settings, but I now, unfortunately, do not remember exactly what. But, to be honest, a detailed setting, right here, twist all the knobs, I definitely did not produce here. Most of them are systems that are stable and standard from their Docker containers, delivered and put on the system. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I agree with my colleague, yes, the comparison is not very correct, so I say: ‚ÄúI am not comparing a DBMS. I compare how I use them. ‚Äù Therefore, maybe this justifies me, and maybe the other way around.</font></font> Thank. <br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Question:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pavel, is it possible, in continuation of how you use them, those query (queries) that you gave? What is this query, are indices and aggregates used, are there any database features associated with working with queries? What did you compare? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Answer:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> There are several carts I used. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First, which OpenTSDB, InfluxDB - they have built-in indexes, so they immediately use them over time.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the rest, I walked in two ways: first, I just built the index, the queries worked well, but a little worse ‚Äî the record. And, moreover, it was very inconvenient, for example, to keep data in one collection or in one table. Obviously, it grew instantly. Therefore, colleagues will forgive me, I made a very bad reception, which I love very much, I began to split up by days simply. Every day has its own sign. And the indexes are not used. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After that, of course, I had terribly complicated requests, because now I had to drag this information into the client, but, for example, my rotation became very simple and very convenient: DROP is everything, DROP is everything. And requests began to work well on writing and reading.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Very stupid requests, only for a time interval. The maximum is that with aggregation, say, an average for a certain interval, that is, not every second, but, say, an average per minute. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Question:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pavel, thanks for the interesting report. I wanted to ask such a question: You said at the beginning that you need to know your data, you need to know your load profile, and measure on it, yes, and on the hardware that you have? Why not simplify everything and measure on the necessary bandwidth, immediately on the right amount of batches, immediately compare in such characteristics? Wouldn't it be necessary to derive these tangents, to do all the complicated math? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Answer:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I can answer here like this. Yes, thank God, I have, straightforwardly, a document, non-functional requirements are written there. But I know that they can change. And those 20 thousand that I have to keep up today, in a year can turn into 40 thousand. Therefore, despite the fact that each of the contestants fit in them, I, of course, would be interested to choose, which will withstand the change of non-functional requirements.</font></font> This time. <br><br>  The second.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The size of the batch is a very interesting feature. You have to pay for it. The more batch you have, the more latency you have. You need to create buffers somewhere that will add extra delay to your data. Therefore, to make them very large, if latency is important to you - it is, generally speaking, dangerous. Therefore, it would be interesting to look just from the point of view of the minimum size of the batch, but since I am simultaneously processing the entire stream online and not read from the DBMS, the latency here was basically not important to me, so of course I then twisted the size of the batches almost to the maximum.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Which, by the way, is different for different systems. For example, OpenTSDB already works well at sixty-four, but InfluxDB starts to behave normally from five thousand at the time you write. By the way, I later looked in the standard drivers, it stands as a constant sometimes: write 5 thousand at a time. And the buffer is in the driver itself, which, by the way, I really didn‚Äôt like. I want to be able to manage it, generally speaking, that is, how much it is really stored on the client when it goes to the base. Therefore, for example, for InfluxDB I had to write my driver on top of their HTTP protocol. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Question:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tell me, if I understood correctly, you set up the structure, the base scheme for each base separately. And somehow you tried to adjust the application under the structure? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Answer:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course. </font><font style="vertical-align: inherit;">Especially when I started to use this not very, maybe a beautiful cutting approach by day for each individual plate, when the drivers received a request for a range for more than one day, they needed to understand that in fact it should be broken or, if the base allows , make a query on several tables at once. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Question:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Attempt to use asynchronous access to the database or pools? </font><font style="vertical-align: inherit;">Something like that? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Answer:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> There was almost always asynchronous recording. </font><font style="vertical-align: inherit;">Yes, the pool was used, in particular, if it was an HTTP protocol, it tried to arrange a pool of connections, and everyone was keep alive, that is, not to repeat them. </font><font style="vertical-align: inherit;">Perhaps this is all that was used.</font></font><br><br>  Thank! <br><br><h3>  Contacts </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Üí </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pavel.filonov@kaspersky.com</font></font></a> <br>  ‚Üí <a href="https://github.com/sdukshis">github</a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Üí </font></font><a href="https://twitter.com/filonovpv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">twitter</font></font></a> <br><br><blockquote> <font color="gray">  ‚Äî            <a href="http://www.highload.ru/%3Futm_source%3Dhabr%26utm_medium%3Dmedia%26utm_campaign%3Dpast.articles%26utm_content%3Dnginx.module">Highload++</a> ,   ‚Äî  ¬´ ,  ¬ª. <br><br>       " <a href="http://backendconf.ru/2017/abstracts/2773">     highload</a> "      <a href="http://backendconf.ru/">Backend Conf</a> . <br><br>         ,      ,       ,   highload-.    Tarantool, ClickHouse  CockroachDB,  ,   ,    ,       -,    MySQL,   ‚Äî MongoDB.</font> </blockquote></div><p>Source: <a href="https://habr.com/ru/post/329062/">https://habr.com/ru/post/329062/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329046/index.html">To prevent the carriage from turning into a pumpkin, or why we need test recoveries from backups</a></li>
<li><a href="../329048/index.html">Nadezhda Moroshkina: ‚ÄúYou are not picking a team for the signs of the zodiac?‚Äù</a></li>
<li><a href="../329050/index.html">You have the right to anonymity. Part 1. Introduction and world practice</a></li>
<li><a href="../329056/index.html">Selection of slides from Julia Evans</a></li>
<li><a href="../329060/index.html">How to organize a large React-application and make it scalable</a></li>
<li><a href="../329064/index.html">How was Bell wrong (if the article gave the right example)</a></li>
<li><a href="../329066/index.html">Ubuntu + XRDP + x11RDP terminal server, with sound support, for surfing the Internet - a step by step guide</a></li>
<li><a href="../329068/index.html">Overview of the profession Data Scientist</a></li>
<li><a href="../329072/index.html">Lectures of the Technosphere. Infopoisk. Part 1 (Spring 2017)</a></li>
<li><a href="../329074/index.html">Metaphors and analogies in grocery design</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>