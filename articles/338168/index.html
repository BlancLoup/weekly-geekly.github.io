<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Do-it-yourself Windows server file backup</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Here we will look at how to make a differential out-of-box backup system (well, almost), using the minimum number of external modules, in the best UNI...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Do-it-yourself Windows server file backup</h1><div class="post__text post__text-html js-mediator-article">  Here we will look at how to make a differential out-of-box backup system (well, almost), using the minimum number of external modules, in the best UNIX-way traditions. <br>  We will use 7za.exe \ 7z, as well as the UNIX-like utility pdate.exe, so that over time we will work as well as in the tube * NIX, and the replacement for bash will be the ‚Äúcommon‚Äù BAT.  Background and details - under the cut. <a name="habracut"></a><br><br><h2>  Prehistory </h2><br>  It all started with a story about an inattentive and fearless user opening incoming files via personal mail by opening the .exe on the work computer.  Unfortunately, this turned out to be not a mediocre Malvar, but a completely ordinary encoder.  But, in addition to the user's files, which, of course, cannot be recovered, one tiny but important ball, access to which everyone had, was affected. <br><br>  Looking at this encrypted indecency, I gratefully remembered that every day I have a backup of this (and not only this) balls built-in Windows Server 2003 SP2 x64.  But, having looked through this backup, I realized that in terms of backup by means of Windows itself, not everything is so rosy.  First, the full backup was not available, which means it is unlikely to restore cold-data (files that change very rarely).  Secondly, the recovery from the created incremental backup turned out to be a nontrivial task - for each step it was possible to recover only the data that was changed, and nothing more.  It turns out that to restore at least all the changed data (since the full backup was lost), we would have to go through all the backups in turn - not exactly what I expected from the incremental backup in this case. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Some of you can say - it was necessary to check the performance of the backup, and yes, the way it is.  But the one of you who works in the trade, can understand where the admin time can go - yes, they are the most, online ticket offices. <br><br>  Thinking deeply, I remembered my first acquaintance with the fsbackup incremental copying system by Maxim Chirkov <a href="https://www.opennet.ru/dev/fsbackup/">www.opennet.ru/dev/fsbackup</a> - flexibility, simplicity, at the same time, plenty of opportunities and an open archive storage format (tar).  It is a pity that the system is designed for * NIX / Linux.  Google also did not answer my question about a similar system under Windows.  The most useful that I have found is a <a href="https://habrahabr.ru/post/72636/">short guide of the</a> antip0d <a href="https://habrahabr.ru/users/antip0d/" class="user_link">habrovchanin</a> and <a href="http://sysadminwiki.ru/wiki/%25D0%25A0%25D0%25B5%25D0%25B7%25D0%25B5%25D1%2580%25D0%25B2%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BA%25D0%25BE%25D0%25BF%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25B2_Windows">an example of a script</a> for backup.  I used the material from the last link for my script. <br><br><h2>  We assemble the system </h2><br>  First of all, download the latest <a href="http://7z-extra%20">stable version</a> .  At the time of writing it is 16.04.  Our backup will be stored in the 7z archive: support for multithreading, encrypted / multi-volume archives, and the extraction speed from 7z is higher than the packaging speed by 10-20 times! <br>  UPD: Thanks to the Taciturn <a href="https://habrahabr.ru/users/taciturn/" class="user_link">hacker</a> for the <a href="https://habrahabr.ru/users/taciturn/" class="user_link">fix</a> - you can also use 7z.exe already installed on your system.  I did not reveal any functional differences between 7z and 7za. <br><br>  We are interested: <br>  7za.exe is a standalone version of 7-Zip. <br>  7za.dll - library for working with archives 7z <br>  7zxa.dll is a library for unpacking 7z archives. <br>  For 64-bit OS use the same files from the x64 directory. <br>  Unfortunately, the link from the material I used to the pdate utility does not lead anywhere, the only version I found <br><blockquote>  pdate v1.1 build 2007.12.06 <br>  ¬© 2005-2007 Pavel Malakhov 24pm@mail.ru </blockquote>  The link from the built-in manual pdate leads there too, namely, to nowhere. <br><blockquote>  <a href="http://pm4u.opennet.ru/mysoft/pdate.htm">pm4u.opennet.ru/mysoft/pdate.htm</a> </blockquote>  Fortunately, on the same <a href="http://sysadminwiki.ru/">resource</a> there is a short article on this program, in the same place it can be <a href="">downloaded</a> . <br><br>  I used the following directory structure: <br>  <i>D: \ winfsbackup</i> - the root directory of the script and related files <br>  <i>D: \ winfsbackup \ 7z</i> - libraries and executable file 7za <br>  <i>D: \ winfsbackup \ backup</i> - <i>backup</i> storage location (can be reassigned by editing variables, like any other used files) <br>  <i>D: \ winfsbackup \ lists</i> - lists of files to include and exclude.  I will tell about them later <br>  <i>D: \ winfsbackup \ log</i> - logs <br>  <i>D: \ winfsbackup \ pdate</i> <br>  <i>D: \ winfsbackup \ tmp</i> - sets the working directory for the temporary base archive <br>  <i>D: \ winfsbackup \ winfsbackup.bat</i> - the script itself. <br><br><h2>  Work logic </h2><br>  After processing the variables, the script looks at the block: Main, where the logic of the backup operation is indicated - in which case the new backup should be executed, and in which case - the existing base archive should be updated.  By default, a new archive is created at the beginning of the month, and all files from the backup directory are moved to \ backup \ old, or if the base archive does not exist. <br>  Already at the time of writing this article, I realized that it was necessary to add the ability to update the basic archive - a simplified version of ‚Äúfull backup once a month + differential backups to it‚Äù should be used for file exchangers up to ~ 250 GB in size.  For my file hosting service of 550 GB with a predominance of small files, the backup speed was unsatisfactory (almost 55 hours).  It is fair to say that this cannot serve as a reliable measure of performance - during the backup process it turned out that some files were inaccessible (hello chkdsk), and the backup was added to the remote server section, which was also occupied by disk I / O operations. <br><br><pre><code class="hljs dos">:Main <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>   ,       \  ,    . <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>   -        <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXIST</span></span> <span class="hljs-variable"><span class="hljs-variable">%baseArch%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> BaseArchive <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>     + t    <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%dm%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EQU</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> BaseArchive <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateArchive <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>     <span class="hljs-number"><span class="hljs-number">1</span></span>   <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%dm%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EQU</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateBase <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateArchive <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>    (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-number"><span class="hljs-number">36</span></span>  ) <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-variable"><span class="hljs-variable">%wn%</span></span>.<span class="hljs-variable"><span class="hljs-variable">%dw%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EQU</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateArchive <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-variable"><span class="hljs-variable">%wn%</span></span>.<span class="hljs-variable"><span class="hljs-variable">%dw%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EQU</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateArchive <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-variable"><span class="hljs-variable">%wn%</span></span>.<span class="hljs-variable"><span class="hljs-variable">%dw%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EQU</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateArchive <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>   ,   <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%dw%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EQU</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateBase) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateArchive) <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>     ,       . <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>      <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Warning! No one condition matching, check :Main block of script &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> End</code> </pre> <br>  The first 2 conditions are enabled by default, and describe a full backup once a month + differential backups.  The remaining conditions are alternative, that is, when you turn on one, you need to turn off another, or change the logic of work to your taste. <br><br><h2>  Variables </h2><br>  <i>dm, dw, wn</i> are the day of the month, the day of the week and the week number (in numerical terms), respectively. <br>  <i>verboseLevel</i> - the mode of "talkative", gives information about where the archive will be recorded, and so on.  It is useful when you make major changes to the structure of the script. <br>  <i>tmpDir</i> is the location to save the temporary file.  By default, 7-Zip builds a new base file of the archive in the same directory as the old base file of the archive.  By defining this key, you can set the working directory where the temporary archive base file will be built.  After the temporary archive base file is built, it is copied over the original one;  then the temporary file is deleted. <br><br><h2>  Differential backup </h2><br>  By default, files that are not in the base archive, as well as newer files are placed in the differential backup.  If desired, this behavior can be changed.  Key descriptions are in the standard 7z help file. <br><br>  This approach has its advantages (which I have already managed to evaluate) - the speed of deployment from the backup.  In the case of a full recovery, expand the last (or any other) existing differential backup, and then the full archive, refusing to overwrite existing files. <br><br><h2>  Some command line options </h2><br>  <i>-bsp2</i> - displays a string with the progress of the execution in STDERR.  STDOUT 7z is redirected to the log, progress, of course, is not written there.  This command displays it in STDERR, for more information. <br><br>  <i>-ssw</i> - packs files opened for writing by another application.  If this key is not installed, 7-Zip does not include such files in the archive. <br><br>  <i>-slp</i> is an extremely useful option.  Large page mode increases compression speed.  However, there is a pause at the beginning of the compression, while 7-Zip distributes large pages in memory.  If 7-Zip cannot accommodate large pages, it places the usual small pages.  In addition, the Task Manager does not show the actual use of memory by programs if 7-Zip uses large pages.  This feature only works on Windows 2003 / XP x64.  You also need to have administrator rights for your system.  The recommended RAM size for this feature is 3 GB or more.  if you use the <i>-slp</i> mode, your Windows system may hang for a few seconds when 7-Zip allocates blocks of memory.  When Windows tries to allocate large pages from RAM for 7-Zip, Windows may suspend other tasks for this time.  This may look like a complete system hang, but then its operation is restored, and if the distribution is successful, 7-Zip works faster.  Do not use the <i>-slp</i> mode if you do not want other tasks to be ‚Äúhung‚Äù.  In addition, it <i>makes</i> no sense to use the <i>-slp</i> mode to compress small data sets (less than 100 MB).  But if you compress large data sets (300 MB or more) with the LZMA method with a large dictionary, you can get an increase in speed of 5% -10% in the <i>-slp</i> mode. <br>  <i>-mmt = on</i> - sets multithreading mode.  If you have a multiprocessor / multicore system, you can get an increase in speed with this key.  7-Zip supports multithreading mode only for LZMA / LZMA2 compression and BZip2 compression / decompression. <br><br>  <i>-ms = off</i> - disables the creation of solid-archives.  The compression quality, of course, falls, but there are very significant advantages - you can periodically update the data of the basic archive to reduce the size of the differential backups, and since the archive is not complete, you will not need to ‚Äúpinch‚Äù it further.  The non-solid archive is more resistant to damage, and the extraction time is much faster. <br><br>  Include / exclude sheets <br>  By default, 2 types of list are defined - the list of included files / directories ( <i>include_general.txt</i> ), and 2 exclusion lists ( <i>exclude_general.txt</i> , <i>exclude_regexp.txt</i> ). <br><br>  The include list also supports UNC paths.  In order to place a file / directory in the exceptions, the path must be relative. <br><br>  For example, if the directory for the backup is E: \ foo \ bar, and we want to exclude the subdirectory E: \ foo \ bar \ somefolder, then in exclude_general.txt we should add bar \ somefolder or bar \ somefolder \ <br><br>  A path without a slash at the end can refer to both the file and the directory. <br>  In exclude_regexp.txt are excluded to regexp files that are viewed recursively.  * - a sequence of arbitrary characters?  - any character. <br>  7-Zip does not use the system wildcard parser, so "any file" for 7 Zip is '*', and '*. *' Is a file with an extension. <br><br>  Finally, the whole script: <br><br><pre> <code class="hljs dos">@ <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> OFF <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> Sources were found on http://sysadminwiki.ru/wiki/___Windows <span class="hljs-built_in"><span class="hljs-built_in">CD</span></span> %~dp0 <span class="hljs-built_in"><span class="hljs-built_in">TITLE</span></span> winfsbackup <span class="hljs-built_in"><span class="hljs-built_in">MODE</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CON</span></span>: COLS=<span class="hljs-number"><span class="hljs-number">120</span></span> LINES=<span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Setting vars... <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> --- Definition block --- <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> verboseLevel=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> tmpDir=D:\winfsbackup\tmp <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> run_7z=D:\winfsbackup\<span class="hljs-number"><span class="hljs-number">7</span></span>z\<span class="hljs-number"><span class="hljs-number">7</span></span>za.exe <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> run_pdate=D:\winfsbackup\pdate\pdate.exe <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> /F "usebackq" <span class="hljs-variable"><span class="hljs-variable">%%a</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (`<span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> e`) <span class="hljs-keyword"><span class="hljs-keyword">DO</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> dm=<span class="hljs-variable"><span class="hljs-variable">%%a</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> /F "usebackq" <span class="hljs-variable"><span class="hljs-variable">%%a</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (`<span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> u`) <span class="hljs-keyword"><span class="hljs-keyword">DO</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> dw=<span class="hljs-variable"><span class="hljs-variable">%%a</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> /F "usebackq" <span class="hljs-variable"><span class="hljs-variable">%%a</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (`<span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> V`) <span class="hljs-keyword"><span class="hljs-keyword">DO</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> wn=<span class="hljs-variable"><span class="hljs-variable">%%a</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> LogDir=D:\winfsbackup\log <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> Log=<span class="hljs-variable"><span class="hljs-variable">%LogDir%</span></span>\general.log <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> dDir=D:\winfsbackup\backup <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> dlmDir=D:\winfsbackup\backup\old <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> baseArch=<span class="hljs-variable"><span class="hljs-variable">%dDir%</span></span>\general.<span class="hljs-number"><span class="hljs-number">7</span></span>z <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> IncludeList=lists\include_general.txt <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> ExcludeList=lists\exclude_general.txt <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> ExcludeRegexp=lists\exclude_regexp.txt <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> updArch_dw=<span class="hljs-variable"><span class="hljs-variable">%dDir%</span></span>\day_general_<span class="hljs-variable"><span class="hljs-variable">%dw%</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>z <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> updArch_wn=<span class="hljs-variable"><span class="hljs-variable">%dDir%</span></span>\week_general_<span class="hljs-variable"><span class="hljs-variable">%wn%</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>z <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%verboseLevel%</span></span>==<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> Main <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Verbose <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span> ON! <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Today is <span class="hljs-variable"><span class="hljs-variable">%wn%</span></span> week of year, <span class="hljs-variable"><span class="hljs-variable">%dw%</span></span> day of week. <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Full quarter backup will execute (<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> enabled) on <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span> and <span class="hljs-number"><span class="hljs-number">36</span></span> week, friday. <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Temporary directory is <span class="hljs-variable"><span class="hljs-variable">%tmpDir%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Now logging into <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Current backup directory is <span class="hljs-variable"><span class="hljs-variable">%dDir%</span></span>, older backups stored into <span class="hljs-variable"><span class="hljs-variable">%dlmDir%</span></span> :Main <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> Here discribed conditions - <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> which case script will make new backup, update older one, etc <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> You are free to change these conditions <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> Make sure you envisaged all possible cases <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> Actions here are <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> disigned to be active <span class="hljs-built_in"><span class="hljs-built_in">more</span></span> than <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">at</span></span> same <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>, excluding base condition <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> you want multiple conditions, you should edit it <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> Base condition - full backup will be created <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> it is <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXIST</span></span> <span class="hljs-variable"><span class="hljs-variable">%baseArch%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> BaseArchive <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> Command below turns on making full backup <span class="hljs-built_in"><span class="hljs-built_in">at</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>'st day of every month, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> other days - increments <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%dm%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EQU</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> BaseArchive <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateArchive <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> This option enables updating full backup every month <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%dm%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EQU</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateBase <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateArchive <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> Uncomment these <span class="hljs-number"><span class="hljs-number">3</span></span> commands <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you want to run full backup ~every quarter (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-number"><span class="hljs-number">36</span></span> week of year) <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-variable"><span class="hljs-variable">%wn%</span></span>.<span class="hljs-variable"><span class="hljs-variable">%dw%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EQU</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateArchive <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-variable"><span class="hljs-variable">%wn%</span></span>.<span class="hljs-variable"><span class="hljs-variable">%dw%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EQU</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateArchive <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-variable"><span class="hljs-variable">%wn%</span></span>.<span class="hljs-variable"><span class="hljs-variable">%dw%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EQU</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateArchive <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> This option enables rewriting base archive every saturday with new files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> order to decrease size of increments <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%dw%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EQU</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateBase) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> UpdateArchive) <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> Here you can place default action <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> conditions of previous ones were <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> executed. <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \A\c\t\i\o\n \w\a\s\ \n\o\t \s\e\l\e\c\t\e\d\! &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Warning! No one condition matching, check :Main block of script <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> End :BaseArchive <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Clear <span class="hljs-variable"><span class="hljs-variable">%dlmDir%</span></span> and <span class="hljs-built_in"><span class="hljs-built_in">move</span></span> data of previous month to that <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>... <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXIST</span></span> <span class="hljs-variable"><span class="hljs-variable">%dlmDir%</span></span>\<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-built_in"><span class="hljs-built_in">MKDIR</span></span> <span class="hljs-variable"><span class="hljs-variable">%dlmDir%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DEL</span></span> /Q <span class="hljs-variable"><span class="hljs-variable">%dlmDir%</span></span>\* <span class="hljs-built_in"><span class="hljs-built_in">MOVE</span></span> /Y <span class="hljs-variable"><span class="hljs-variable">%dDir%</span></span>\* <span class="hljs-variable"><span class="hljs-variable">%dlmDir%</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>&gt; <span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "====== YB =======" &gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \S\t\a\r\t \t\o \c\r\e\a\t\e \n\e\w \a\r\c\h\i\v\e" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Creating new backup <span class="hljs-variable"><span class="hljs-variable">%baseArch%</span></span> <span class="hljs-variable"><span class="hljs-variable">%run_7z%</span></span> a <span class="hljs-variable"><span class="hljs-variable">%baseArch%</span></span> -w<span class="hljs-variable"><span class="hljs-variable">%tmpDir%</span></span> -i@<span class="hljs-variable"><span class="hljs-variable">%IncludeList%</span></span> -x@<span class="hljs-variable"><span class="hljs-variable">%ExcludeList%</span></span> -xr@<span class="hljs-variable"><span class="hljs-variable">%ExcludeRegexp%</span></span> -bsp2 -ssw -slp -scsWIN -mmt=on -mx3 -ms=off &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">0</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \E\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">0</span></span> \- \a\r\c\h\i\v\e \s\u\c\c\e\s\s\f\u\l\l\y \c\r\e\a\t\e\d!" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">1</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \W\a\r\n\i\n\g\! \R\e\c\i\e\v\e\d\ \e\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">1</span></span>" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">2</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \E\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">2</span></span> \- \F\A\T\A\L \E\R\R\O\R\!" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">7</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \E\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">7</span></span> \- \C\o\m\m\a\n\d \p\r\o\m\p\t \e\r\r\o\r!" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">8</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \E\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">8</span></span> \- \N\o\t \e\n\o\u\g\h \m\e\m\o\r\y" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Recieved error <span class="hljs-number"><span class="hljs-number">255</span></span> - user stopped running process or <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> code unknown! &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) ) ) ) ) ) ) <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> End :UpdateBase <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Refreshing base archive <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> ******* ******* ******* &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \S\t\a\r\t \t\o \u\p\d\a\t\e \a\r\c\h\i\v\e" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> <span class="hljs-variable"><span class="hljs-variable">%run_7z%</span></span> u <span class="hljs-variable"><span class="hljs-variable">%baseArch%</span></span> -up0q1r2x1y2z1w0 -w<span class="hljs-variable"><span class="hljs-variable">%tmpDir%</span></span> -i@<span class="hljs-variable"><span class="hljs-variable">%IncludeList%</span></span> -x@<span class="hljs-variable"><span class="hljs-variable">%ExcludeList%</span></span> -xr@<span class="hljs-variable"><span class="hljs-variable">%ExcludeRegexp%</span></span> -bsp2 -ssw -slp -scsWIN -mmt=on -mx5 -ms=off &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">0</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \E\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">0</span></span> \- \u\p\d\a\t\e \s\u\c\c\e\s\s\f\u\l\l\y \f\i\n\i\s\h\e\d" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">1</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \W\a\r\n\i\n\g\! \R\e\c\i\e\v\e\d\ \e\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">1</span></span>" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">2</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \E\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">2</span></span> \- \F\A\T\A\L \E\R\R\O\R\!" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">7</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \E\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">7</span></span> \- \C\o\m\m\a\n\d \p\r\o\m\p\t \e\r\r\o\r!" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">8</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \E\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">8</span></span> \- \N\o\t \e\n\o\u\g\h \m\e\m\o\r\y" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Recieved error <span class="hljs-number"><span class="hljs-number">255</span></span> - user stopped running process or <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> code unknown! &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) ) ) ) ) ) ) <span class="hljs-keyword"><span class="hljs-keyword">GOTO</span></span> End :UpdateArchive <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Updtaing existing full backup <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> ******* ******* ******* &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \S\t\a\r\t \t\o \u\p\d\a\t\e \a\r\c\h\i\v\e" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%dw%</span></span>==<span class="hljs-number"><span class="hljs-number">7</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> updArch=<span class="hljs-variable"><span class="hljs-variable">%updArch_wn%</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> updArch=<span class="hljs-variable"><span class="hljs-variable">%updArch_dw%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> --- Check files existence --- <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXIST</span></span> <span class="hljs-variable"><span class="hljs-variable">%updArch%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DEL</span></span> /Q <span class="hljs-variable"><span class="hljs-variable">%updArch%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> --- Create incremental archive --- &lt;<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p strTemp=Updating <span class="hljs-variable"><span class="hljs-variable">%baseArch%</span></span> to incremental <span class="hljs-variable"><span class="hljs-variable">%updArch%</span></span> archive <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span>. <span class="hljs-variable"><span class="hljs-variable">%run_7z%</span></span> u <span class="hljs-variable"><span class="hljs-variable">%baseArch%</span></span> -u- -up0q0r2x0y2z0w0!<span class="hljs-variable"><span class="hljs-variable">%updArch%</span></span> -w<span class="hljs-variable"><span class="hljs-variable">%tmpDir%</span></span> -i@<span class="hljs-variable"><span class="hljs-variable">%IncludeList%</span></span> -x@<span class="hljs-variable"><span class="hljs-variable">%ExcludeList%</span></span> -xr@<span class="hljs-variable"><span class="hljs-variable">%ExcludeRegexp%</span></span> -bsp2 -ssw -slp -scsWIN -mmt=on -mx5 -ms=off &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">0</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \E\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">0</span></span> \- \u\p\d\a\t\e \s\u\c\c\e\s\s\f\u\l\l\y \f\i\n\i\s\h\e\d" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">1</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \W\a\r\n\i\n\g\! \R\e\c\i\e\v\e\d\ \e\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">1</span></span>" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">2</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \E\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">2</span></span> \- \F\A\T\A\L \E\R\R\O\R\!" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">7</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \E\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">7</span></span> \- \C\o\m\m\a\n\d \p\r\o\m\p\t \e\r\r\o\r!" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span>==<span class="hljs-number"><span class="hljs-number">8</span></span> ( <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \E\x\i\t \c\o\d\e \<span class="hljs-number"><span class="hljs-number">8</span></span> \- \N\o\t \e\n\o\u\g\h \m\e\m\o\r\y" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Recieved error <span class="hljs-number"><span class="hljs-number">255</span></span> - user stopped running process or <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> code unknown! &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> ) ) ) ) ) ) ) :End <span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> Done! <span class="hljs-variable"><span class="hljs-variable">%run_pdate%</span></span> "Z --- \D\o\n\e" &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%Log%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ping</span></span> localhost -w <span class="hljs-number"><span class="hljs-number">1000</span></span> -n <span class="hljs-number"><span class="hljs-number">5</span></span> &gt; <span class="hljs-built_in"><span class="hljs-built_in">nul</span></span></code> </pre><br><h2>  Instead of ending </h2><br>  There are always people who are against such decisions, and with all their hands and feet ‚Äúfor‚Äù the use of all sorts of acronis and other ‚Äúterry enterprises‚Äù. <br><br>  I think that the solution should be commensurate with the task, and in my case the task is to have a backup file file in a secluded place that can be quickly deployed - this is what disappointed ntbackup. <br><br>  The collected example can be viewed on <a href="https://yadi.sk/d/Tl290DQO3Mpbtz">YandexDisk</a> . <br><br>  There is also a zip-archive for download. <br>  Constructive criticism, advice, and even more so, testing - welcome! <br>  Thanks for attention!  All long uptime, stable link, and of course, backups at hand. </div><p>Source: <a href="https://habr.com/ru/post/338168/">https://habr.com/ru/post/338168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338156/index.html">Another HighLoadCup solution on Go</a></li>
<li><a href="../338158/index.html">kubernetes, playground, microservices and a bit of magic</a></li>
<li><a href="../338160/index.html">3CX technical support responds: how to replace or update the SSL certificate on the server</a></li>
<li><a href="../338164/index.html">Do not touch the logs with your hands! How to reduce the time for analysis using autotests</a></li>
<li><a href="../338166/index.html">Use PowerShell for IT security. Part III: Budget Classification</a></li>
<li><a href="../338170/index.html">Timing attack on Node.js - when time works against you</a></li>
<li><a href="../338172/index.html">Work with smart contracts through Ethereum RPC API</a></li>
<li><a href="../338174/index.html">Infographics: all 42 spacecraft buried on other planets in the solar system</a></li>
<li><a href="../338176/index.html">Create a GTK video player using Haskell</a></li>
<li><a href="../338178/index.html">Sotsinzhiniring in military propaganda</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>