<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Encrypt messages on the XMPP / Jabber network using PGP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I will describe in detail how to use encryption when sending messages over XMPP-based networks using the GnuPG package. Shows the pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Encrypt messages on the XMPP / Jabber network using PGP</h1><div class="post__text post__text-html js-mediator-article">  In this article, I will describe in detail how to use encryption when sending messages over XMPP-based networks using the GnuPG package.  Shows the procedure for generating key pairs under Windows, installing keys in the Psi client, checking the signed presence, sending an encrypted message. <br><h2>  Motivation </h2><br>  What may need to encrypt messages? <br><ol><li>  Since the XMPP network is federated and everyone can set up their own node, the question of trust in the administrator of this server is raised.  The server can be broken, the admin himself can add data, etc. </li><li>  XMPP is gaining popularity as an intracorporate exchange.  Maybe the server does not have access to the Internet, but no one is immune from the arrival of Party-van with a mask show inside </li><li>  Digital signature improves identification reliability.  That is, you know for sure that at that moment the person who gave you the key is sitting at the computer, and not the one who broke his account or used his lack of it at the computer </li></ol><br><a name="habracut"></a><br><h2>  A bit of theory </h2><br><br>  Messages are encrypted using a <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D1%2580%25D0%25B8%25D0%25BF%25D1%2582%25D0%25BE%25D1%2581%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2581_%25D0%25BE%25D1%2582%25D0%25BA%25D1%2580%25D1%258B%25D1%2582%25D1%258B%25D0%25BC_%25D0%25BA%25D0%25BB%25D1%258E%25D1%2587%25D0%25BE%25D0%25BC">public key cryptosystem</a> .  Without going into details, the essence of the encryption system is that there is a pair of keys and some procedure that can convert the message with one key so that the inverse transformation can be performed only with the help of another key.  One of these keys is called private and is kept secret, while the other, on the contrary, is called open and is distributed freely.  Thus, by encrypting a message with a public key, you can be sure that only the owner of the private key will read it, on the contrary, by signing something with his key, the author gives confidence to the recipient of the message in his authorship. <br>  You can combine these two procedures and then the content will be known only to two persons with the appropriate keys.  This is clearly shown in the picture: <br><img src="http://ivlis.com/sites/ivlis.com/files/1233667626536px-Public_key_shared_secret.svg_.png"><br><br>  At the moment, it is impossible to recover a private key from the public key in the near future. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Instruments </h2><br><br>  As an encryption system, we will use the open source GnuPG package (hey, do not run away, this is also under Windiows, and there is a very user user :) and the Psi client.  I am sure that in other clients the procedure is similar.  I took the implementation under windows, because most users still use it, and I think that the unixoids themselves will be parsed.  In * nix, kgpg can be recommended as a convenient key management tool. <br><br>  I assume that you already have a jabber client, it is configured and there is a connection to the network. <br><br><h2>  Step one, download software and generate private and public keys </h2><br>  For Windows users, a specially created software package <a href="http://www.gpg4win.org/">gpg4win</a> , which greatly facilitates the work with GPG.  <a href="http://www.gpg4win.org/download.html">Download gpg4win lite from the official site</a> , select the necessary components and install. <br><img src="http://ivlis.com/sites/ivlis.com/files/1233668310neededcomponents.png"><br><br>  After installation, run WinPT Key Manager.  When you first start the utility will offer to create a key pair.  This is a very important step.  The key is your passport on the Internet, check carefully the name and address, it is very desirable not to lose it and do not forget the password from it.  Restoring the private key will no longer be possible, you will have to generate a new one.  Each private key is encrypted with a password.  This is necessary in order that even if someone takes possession of your key, the attacker could not use it, it is useless without a password.  The program is suggested to save the key and this is correct. <br><br>  So, you have generated a key pair.  Now in the WinPT menu you need to select Key -&gt; Export ... Thus, you will receive a * .asc file that will contain something like: <br> <code>-----BEGIN PGP PUBLIC KEY BLOCK----- <br> <br> Version: GnuPG v1.4.7 (MingW32) <br> <br> mQGiBEmINMURBACJDeTglDCoq5HQ4bU6yFzqCTfYbCEjkNlMmvJK+5zesKVJhohK <br> LZ6oiCZaGt5B8rfY1qvJvgIQNvWOsp63lviPSTamndlmlDeTOXbqc21iEE6E9mOS <br> ..... <br></code> <br><br>  This is your public key, it can be sent to friends and colleagues with whom you are going to exchange messages.  It is natural to exchange keys preferably via an encrypted channel or tritely rewritten to a CD-R / USB flash drive.  You can also place your public key on your website or in the habr profile.  I will not go into details, but the key exchange is quite a fun procedure, see the <a href="http://en.wikipedia.org/wiki/Web_of_trust">Web Of Trust</a> and <a href="http://en.wikipedia.org/wiki/Key_signing_party">Key signing party</a> <br><br><h2>  Step two, add your key to Psi and import contact public keys </h2><br>  So, now I have to say Psi, that I need to use the key.  We launch Psi, go to the account settings, there in the details tab, click "select the openPGP key" and specify our key. <br><img src="http://ivlis.com/sites/ivlis.com/files/1233665763assignselfkey.png"><br><br>  After selecting a key and reconnecting to the network, Psi will request a password from the private key: <br><br><img src="http://ivlis.com/sites/ivlis.com/files/1233665791enterpathphrase.png"><br><br>  You are now connected to the network and your status is signed.  That is, those who have your public key know that you are at the computer. <br><br>  Let's say you exchanged keys with someone, but by giving up your public key and received someone's public key.  Now you need to bind the key to a specific account.  To do this, go to WinPT, go to key-&gt; import, then select the file with the key of the desired person.  Everything, the public key is imported into the system.  It should be said that Psi reads the state of the keys only at startup, so that after we have added a new key, we must restart Psi.  We right-click on the desired contact and select "Assign OpenPGP key", assign its key to the contact.  Now we can verify the electronic signature of our contact: <br><br><img src="http://ivlis.com/sites/ivlis.com/files/1233665869signedcontact.png"><br><br>  A green line indicates that the contact has logged in with the correct key and you have its public key.  If the line is black, it means that the status of the client is signed, but you do not have his key or the key is incorrect, so it‚Äôs unknown who is behind the computer. <br><br><h3>  Step three.  Exchange encrypted messages </h3><br>  Now all that is needed is to open a new chat window and click the lock icon.  There will be a reconciliation of keys and, if everything is in order, the system will display a message stating that the conversation is encrypted.  After that, you can communicate calmly without worrying that the conversation will be intercepted on the way. <br><br><img src="http://ivlis.com/sites/ivlis.com/files/1233670962secretconversation.png"><br><br>  The last message in encrypted form looks like this: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">message</font> <font color="#ff0000">from</font> <font color="#0000ff">="ivlis_test@jabber.ru/Psi"</font> <font color="#ff0000">type</font> <font color="#0000ff">="chat"</font> <font color="#ff0000">xml:lang</font> <font color="#0000ff">="ru-RU"</font> <font color="#ff0000">to</font> <font color="#0000ff">="ivan@ivlis.com/WorkF53B8E96"</font> <font color="#ff0000">id</font> <font color="#0000ff">="aaf8a"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> [:  ,    .] <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">active</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">="http://jabber.org/protocol/chatstates"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">x</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">="jabber:x:encrypted"</font> <font color="#0000ff">&gt;</font> <br> hQEOA/CjxWiKTl51EAP9HaQ8nzTtjUECqiO+1lcJRciUJrOLkgFr/KTqjvOmEgvx <br> rtF4TCCjpBMElbVbjY+yYmV6F8IWMweRlU4olzDFfdbJYO/TGWq+22s3jIvhWI+e <br> 7bfMn7qVcnDD7GsGxU8norUqjKHQmYvwdAwHBDdbf/AD0qqAvb7jK+1X1NXyeioD <br> /3lxyWobgoiCt165OwZu/G2osiDQlMTtzt/W198tzfpKoJURaUNkwhFJeOp3rgr0 <br> 77frKDbIO6IRloyHx1xL3kRZNEBOVJO5AYdflH0Z756wPt+mGpZ29vzbdt40hkwu <br> rHjnYEDJhj1oJkoRpesIgiPQxmXpbsRGrAcKQr2f4e3d0lgBCkkivC27qPEM0eFO <br> TQnVww+RGczA+VHRbpXCRvLx4fcle9qSEM0xgdkae7IWJXBQRVEootOqdNJz49G8 <br> FPakyAsBoZ2XvrEqW+r6hXvLYrKGBYO2cI3F <br> =ysML <font color="#0000ff">&lt;/</font> <font color="#800000">x</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">message</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  You can be sure that in the next 50 years, no one can read this. <br><br><h3>  Conclusion </h3><br><br>  So, as you can see, encrypting messages on the fly is very simple, for the end user practically nothing changes, and the reliability of the system increases.  Maybe this will encourage someone to switch to xmpp / jabber. <br><br>  But you should always remember: <br><ol><li>  Encryption does not cancel the head.  Keep your password from the keys secret, make behind keyloggers, viruses and other things. </li><li>  <a href="http://xkcd.com/538/">it</a> </li></ol><br><br>  Thank you for your attention, I hope it was interesting.  :) <br></div><p>Source: <a href="https://habr.com/ru/post/50982/">https://habr.com/ru/post/50982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../50969/index.html">Paid links to exler.ru?</a></li>
<li><a href="../50973/index.html">We create a parser for ini-files. Theory</a></li>
<li><a href="../50976/index.html">Create a parser for ini-files in C ++</a></li>
<li><a href="../50977/index.html">MyRambler - test version</a></li>
<li><a href="../50979/index.html">First release of StartupIndex Review</a></li>
<li><a href="../50983/index.html">Yes, how much can you?</a></li>
<li><a href="../50985/index.html">Implementation of the exception mechanism using the C language</a></li>
<li><a href="../50986/index.html">New version of problems from AOL</a></li>
<li><a href="../50990/index.html">Skype 4.0 (final version)</a></li>
<li><a href="../50991/index.html">Internet speed in Korea will reach 1Gbps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>