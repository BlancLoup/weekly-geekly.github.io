<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Step-by-step module creation in Magento - novice developer‚Äôs guide</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How much about Magento do not write, but still a lot of questions;) ¬© jeje 

 When studying the Magento e-shop, I have met many articles describing th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Step-by-step module creation in Magento - novice developer‚Äôs guide</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  How much about Magento do not write, but still a lot of questions;) ¬© <a href="http://habrahabr.ru/users/jeje/">jeje</a> </blockquote><br><br>  When studying the Magento e-shop, I have met many articles describing the creation of a module using examples, but almost all of them give step-by-step instructions ‚Äúdo this, do this and get it‚Äù, without explaining why this or that step is being taken.  As a result, when an error occurs, it is rather difficult to determine what is done wrong, and it is also more difficult to customize the module to fit your needs. <br><br>  In this article, I will try to show the creation of a module step by step with explanations of each change using the example of the news module DS News, where DS is the Namespace (Namespace) and News is the name of the module.  This module naming scheme is quite convenient in order not to be afraid of name conflicts in the module names.  I will try to emphasize on the values ‚Äã‚Äãused in the configuration file - the names of the nodes and the place where they are used.  I myself use this manual constantly when creating a new module, since  remember where data comes from, which classes need to be inherited, etc ... it is simply impossible physically.  And here everything is in one article. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will not describe the installation of Magento and filling with goods, considering that the system is already working.  However, you should make sure that caching is disabled (the cache can be disabled in the admin area on the <em>System / Cache Management</em> page) - this is necessary in order to immediately see the changes being made. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Step 1. Registering the module in the system</b> <div class="spoiler_text">  In the first step, we will create a minimum module that will not do anything, but will be taken into account in the system (and shown in the admin panel): <br><br><ol><li>  Create directory <em>/ app / code / local / DS / News</em> </li><li>  Create <em>etc / config.xml</em> file <br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DS_News</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.0.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DS_News</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></li><li>  Create <em>DS_News.xml</em> file in the <em>/ app / etc / modules /</em> directory <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DS_News</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">active</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">active</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">codePool</span></span></span><span class="hljs-tag">&gt;</span></span>local<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">codePool</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DS_News</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li></ol><br><br>  As a result of creating this directory and file structure, the DS_News module will be registered in the system.  This module can be seen in the list of modules in the admin panel on the <em>System / Configuration / Advanced / Advanced / Disable Modules Output</em> path. <br><br>  In paragraph 1, the directory <em>/ app / code / local / DS / News is created</em> , in which the main module code is stored: models, controllers, helpers, etc ... In paragraph 2, the directory <em>etc</em> is created in which the module configuration files are stored, and the main configuration file <em>config.xml is created</em> , in which so far only the version of the module is indicated.  In paragraph 3, the module is registered in the system. <br><br>  In fact, for the task of registering a module, point 3 is the most important - the module will be shown in the admin area even if there is no module directory.  The name of the <em>DS_News.xml</em> file in the <em>/ app / etc / modules /</em> directory is also optional - the system parses all the XML files from this directory when it is loaded.  This can be convenient when developing in the case when several interconnected modules are installed - all modules can be specified in one XML file. <br><br>  The <em>DS_News</em> module <em>names</em> in xml files consist of two parts: <nobr><em>[name of the namespace directory] _ [name of the module directory]</em></nobr> .  In connection with this naming approach, it is desirable to compile the names of directories only from letters, and it is also important to take case into account ‚Äî the name of the module in the configuration files must exactly match the name of the directories for correct operation on * nix systems. <br><br>  The file <em>/app/etc/modules/DS_News.xml</em> uses two tags: <em>active</em> and <em>codePool</em> .  The first tag is responsible for enabling / disabling the module, and the second is for the location in the <em>/ app / code /</em> directory: <strong>core</strong> (system core), <strong>community</strong> (modules developed by the Magento community) or <strong>local</strong> (modules developed by other developers). <br><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Step 2. Database initialization</b> <div class="spoiler_text">  For the news module to work, you need to create a table in which the news will be stored.  Magento allows you to create / update tables when installing a module. <br><br><ol><li>  Create a file <em>sql / dsnews_setup / install-0.0.1.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">'DS News module setup'</span></span>); $installer = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; $installer-&gt;startSetup(); $installer-&gt;run(<span class="hljs-string"><span class="hljs-string">"CREATE TABLE ds_news_entities ( `news_id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT, `title` VARCHAR(255) NOT NULL, `content` TEXT NOT NULL, `created` DATETIME, PRIMARY KEY (`news_id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8;"</span></span>); $installer-&gt;endSetup();</code> </pre><br></li><li>  Add the section with the resource for installation into the <em>etc / config.xml</em> configuration file: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_setup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">setup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span>DS_News<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">setup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_setup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li></ol><br><br>  After the changes are made, you just need to open the site in the browser.  If <strong>DS News module setup</strong> appears, then everything is fine.  A little later, it will be possible to comment out the line with <em>die</em> in the file <em>install-0.0.1.php</em> , and update the browser window, after which the module will be registered in the <em>core_resource</em> table, and the <em>ds_news_entities</em> table will be created in the database. <br><br>  If the caption does not appear, then most likely the module has already been installed on the system, and the installation requires removing the <em>dsnews_setup</em> resource <em>record</em> from the <em>core_resource</em> table in the database using any SQL manager, and then refresh the browser window with the site again: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`core_resource`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">`code`</span></span> = <span class="hljs-string"><span class="hljs-string">'dsnews_setup'</span></span>;</code> </pre><br><br>  The <em>dsnews_setup</em> node <em>name</em> in <em>config.xml</em> can be anything.  The main thing is that the name of this node coincides with the name of the directory where the files for installation will be located.  Also, the name of this node must be unique in the system, since  This name is used as the primary key of the <em>core_resource</em> table, in which all installed resources are stored. <br><br>  The names of files in the installation directory should correspond to a certain structure.  For installation files, this is <em>install- [version]. [Php | sql]</em> , and for upgrade files, this <em>upgrade- [version-from] is [version-to]. [Php | sql]</em> .  For more information about the process of setting resources, naming files and directories, see the <em>Mage_Core_Model_Resource_Setup</em> class. <br><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Step 3. Getting the table name from the config.xml</b> <div class="spoiler_text">  Since in the future in this module, work with the database will occur through models and collections, table names should be stored in the configuration file, and not in the installation file.  To do this, you need to change the file <em>etc / config.xml</em> , as well as the installation file <em>sql / dsnews_setup / install-0.0.1.php</em> <br><br><ol><li>  Create a model node <em>config / global / models /</em> in the file <em>etc / config.xml</em> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">models</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resourceModel</span></span></span><span class="hljs-tag">&gt;</span></span>dsnews_resource<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resourceModel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_resource</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">entities</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table_news</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span>ds_news_entities<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table_news</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">entities</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_resource</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">models</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>  Edit the <em>sql / dsnews_setup / install-0.0.1.php file</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $installer = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; $tableNews = $installer-&gt;getTable(<span class="hljs-string"><span class="hljs-string">'dsnews/table_news'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>($tableNews); $installer-&gt;startSetup(); $installer-&gt;getConnection()-&gt;dropTable($tableNews); $table = $installer-&gt;getConnection() -&gt;newTable($tableNews) -&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'news_id'</span></span>, Varien_Db_Ddl_Table::TYPE_INTEGER, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'identity'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'nullable'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-string"><span class="hljs-string">'primary'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, )) -&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, Varien_Db_Ddl_Table::TYPE_TEXT, <span class="hljs-string"><span class="hljs-string">'255'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'nullable'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, )) -&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'content'</span></span>, Varien_Db_Ddl_Table::TYPE_TEXT, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'nullable'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, )) -&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'created'</span></span>, Varien_Db_Ddl_Table::TYPE_DATETIME, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'nullable'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, )); $installer-&gt;getConnection()-&gt;createTable($table); $installer-&gt;endSetup();</code> </pre><br></li></ol><br><br>  If the browser displays the name of the ds_news_entities <em>table</em> , then everything is done correctly - you can delete the line with <em>die</em> and refresh the window to complete the installation of the module.  Otherwise, you should delete the module resource record from the <em>core_resource</em> table using any SQL manager: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`core_resource`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">`code`</span></span> = <span class="hljs-string"><span class="hljs-string">'dsnews_setup'</span></span>;</code> </pre><br><br>  In order for us not to have SQL errors in case this table was created in the previous step, the code for preliminary deletion of an already existing table was added to the installation file.  Also, the code for creating the same table is now changed to abstract: the table is created using an abstract connection class, which will allow you to further maintain databases other than MySQL. <br><br>  The <em>dsnews</em> model node name, as well as the <em>dsnews_resource</em> model-model node name, located in <em>config / global / models /</em> , can be any name.  The only requirement is the uniqueness of the node name among other models / resources of the system. <br><br>  Inside the installer code in clause 2, the table name is queried using the <em>$ installer-&gt; getTable ('dsnews / table_news') function</em> , which takes a string as argument <br>  <em>[model node name] / [resource entities node name]</em> .  The model node itself does not store the names of the tables, since the low-level interaction with the database, according to the logic of Magento, must occur with the help of resource models.  For this reason, the model stores only the link to the resource-model node in the <em>resourceModel</em> tag. <br><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Step 4. Accessing the module via FrontEnd</b> <div class="spoiler_text">  Now we will display the inscription ‚ÄúHello World‚Äù on the site. <br><br><ol><li>  Add <em>frontend</em> section to the configuration file <em>etc / config.xml</em> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">frontend</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">routers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">use</span></span></span><span class="hljs-tag">&gt;</span></span>standard<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">use</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">args</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span>DS_News<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">frontName</span></span></span><span class="hljs-tag">&gt;</span></span>news<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">frontName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">args</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">routers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">frontend</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>  Create <em>controllers / IndexController.php file</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_IndexController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Controller_Front_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;h1&gt;News&lt;/h1&gt;'</span></span>; } }</code> </pre><br></li></ol><br><br>  Now at the address <em>http://site.com/news/</em> will be displayed the inscription "News". <br><br>  The name of the <em>dsnews</em> node located in the <em>config / frontend / routers /</em> section can be any;  the only requirement is the uniqueness of the name among other routers of the system.  More important is the value of the <em>frontName</em> node - this value will be used to determine the desired module during the processing of the request. <br><br>  The path is determined as follows: <em>http: // [site] / [router] / [controller] / [action]</em> .  When prompted, you can omit <em>[action]</em> or the <em>[controller] / [action]</em> pair, then instead of the missing parameters, the default value <em>index</em> will be used.  Thus, the paths <em>http://site.com/news/</em> , <em>http://site.com/news/index/</em> , <em>http://site.com/news/index/index</em> are equivalent - refer to the <em>DS News</em> module, the controller <em>IndexController</em> and action <em>indexAction</em> . <br><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Step 5. Using the template for data output</b> <div class="spoiler_text">  Information can be generated directly in the controller, or a special template can be used to separate the display logic from the program logic. <br><br><ol><li>  Create a template file / <em>app/design/frontend/[package mine/[theme mine/</em> template/ <em>ds_news/index.phtml</em> <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Template ds_news/index.phtml<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>  Create a page layout configuration file <em>/app/design/frontend/[package//[theme//layout/ds_news.xml</em> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_index_index</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"content"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">block</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"core/template"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ds_news/index.phtml"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reference</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_index_index</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>  Add the <em>layout</em> section to the <em>etc / config.xml</em> configuration file <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">frontend</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">updates</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag">&gt;</span></span>ds_news.xml<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">updates</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">routers</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">routers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">frontend</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>  Change controller <em>controllers / IndexController.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_IndexController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Controller_Front_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadLayout(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;renderLayout(); } }</code> </pre><br></li></ol><br><br>  Now, on the way <em>http://site.com/news/</em> , the site page with all the blocks (header, footer, sidebar) should open, and the inscription ‚ÄúTemplate ds_news / index.phtml‚Äù will be displayed in place of the page content. <br><br>  All templates are stored in the <em>template</em> directory, and page layout settings are in the current theme directory <em>/ app / design / frontend / [package] / [theme]</em> .  When working with Magento, you need to create your own themes, without touching the contents of the base themes <em>/ app / design / frontend / base /</em> and <em>/ app / design / frontend / default /</em> due to the fact that the contents of the base themes can be overwritten when you update the version of Magento. <br><br>  When you initialize the page layout of <em>$ this-&gt; loadLayout ()</em> in the controller action, the <em>layout layout handle of the</em> page is alternately loaded, which can change each other.  By default, the <em>handle <strong>default</strong></em> is loaded first, and the last one is the <em>handle</em> with the name <em>[router] _ [controller] _ [action]</em> , where <em>[router]</em> is the name of the <em>config / frontend / routers / [router]</em> node. <br><br>  Paragraph 2 defines the <em>layout handle</em> for our controller / action: <em>dsnews_index_index</em> , inside of which a block of the built-in type <em>core / template is created</em> and the <em>dsnews / index.phtml</em> template created in paragraph 1. In paragraph 3, the <em>config / frontend / layout /</em> section is added to the configuration file <em>updates</em> , which indicates the update file to be applied when initializing a theme. <br><br>  If there are not so many changes in the theme layout and the module is not planned to be implemented in other projects, then the <em>layout handle</em> can be placed in the file <em>/app/design/frontend/[package[/[theme//layout/local.xml</em> , <br>  which is always loaded after all updates - this file is not necessary to be written in the configuration file of the module <em>config.xml</em> <br><br>  In case of difficulty with determining the correct name of the <em>layout handle</em> , you can see the list of used <em>handle-</em> s in the controller: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_IndexController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Controller_Front_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadLayout(); $layoutHandles = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;getUpdate()-&gt;getHandles(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;pre&gt;'</span></span> . print_r($layoutHandles, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) . <span class="hljs-string"><span class="hljs-string">'&lt;/pre&gt;'</span></span>; } }</code> </pre><br>  As a result, you can see the output, like this: <br><pre> Array
 (
     [0] =&gt; default
     [1] =&gt; STORE_default
     [2] =&gt; THEME_frontend_ [package] _ [theme]
     [3] =&gt; dsnews_index_index
     [4] =&gt; customer_logged_out
 )
</pre><br><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Step 6. Show news directly from the database</b> <div class="spoiler_text">  At this stage, you can try to display news in a template, using data directly from the database.  To do this, you first need to add some test news to the database: <br><br><ol><li>  Add test news to the database for output: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`ds_news_entities`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">'News 1'</span></span>, <span class="hljs-string"><span class="hljs-string">'News 1 Content'</span></span>, <span class="hljs-string"><span class="hljs-string">'2013-10-16 17:45'</span></span>), (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">'News 2'</span></span>, <span class="hljs-string"><span class="hljs-string">'News 2 Content'</span></span>, <span class="hljs-string"><span class="hljs-string">'2013-11-07 04:12'</span></span>), (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">'News 3'</span></span>, <span class="hljs-string"><span class="hljs-string">'News 3 Content'</span></span>, <span class="hljs-string"><span class="hljs-string">'2014-01-12 15:55'</span></span>);</code> </pre><br></li><li>  Change Template / <em>app/</em> design/ <em>frontend/[package mine/[theme mine/</em> template/ <em>dsnews/index.phtml</em> <br><pre> <code class="php hljs">&lt;h1&gt;News&lt;/h1&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $news = Mage::registry(<span class="hljs-string"><span class="hljs-string">'news'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($news <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $item) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;h2&gt;'</span></span> . $item[<span class="hljs-string"><span class="hljs-string">'title'</span></span>] . <span class="hljs-string"><span class="hljs-string">'&lt;/h2&gt;'</span></span>; }</code> </pre><br></li><li>  Change controller <em>controllers / IndexController.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_IndexController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Controller_Front_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $resource = Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'core/resource'</span></span>); $read = $resource-&gt;getConnection(<span class="hljs-string"><span class="hljs-string">'core_read'</span></span>); $table = $resource-&gt;getTableName(<span class="hljs-string"><span class="hljs-string">'dsnews/table_news'</span></span>); $select = $read-&gt;select() -&gt;from($table, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'news_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'content'</span></span>, <span class="hljs-string"><span class="hljs-string">'created'</span></span>)) -&gt;order(<span class="hljs-string"><span class="hljs-string">'created DESC'</span></span>); $news = $read-&gt;fetchAll($select); Mage::register(<span class="hljs-string"><span class="hljs-string">'news'</span></span>, $news); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadLayout(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;renderLayout(); } }</code> </pre><br></li></ol><br><br>  This example shows the option of directly requesting data from the database, as well as using the registry <em>Mage :: registry</em> to transfer news from the controller to the template.  The registry is available globally in any part of the code and, in rare cases, it is the most optimal solution in difficult situations. <br><br>  Using the registry, as well as using global variables, is considered a sign of poor-quality code.  Direct access to the database is also not recommended, as this is a potential problem of compatibility and code portability.  It is better to use the opportunities provided by the system itself for working with objects - models and collections, which will be discussed in the next section. <br><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Step 7. Creating and using models</b> <div class="spoiler_text">  According to the logic of Magento (and many other OOP systems), data should be processed at the level of objects / models and collections, not taking into account the methods of obtaining and saving data.  The operations of receiving and saving data are left for resource models, as lower-level ones - then, in the event of a change in the way data is stored (databases, files, etc ...), there is no need to change the processing logic, but only need to change the resource model, involved in obtaining and storing data.  Let us redo the output of news using models, and also add the output of news content by ID: <br><br><ol><li>  Add <em>class</em> node to model node in configuration file: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">frontend</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">frontend</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">models</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span>DS_News_Model<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resourceModel</span></span></span><span class="hljs-tag">&gt;</span></span>dsnews_resource<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resourceModel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_resource</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span>DS_News_Model_Resource<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">entities</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table_news</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span>ds_news_entities<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table_news</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">entities</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_resource</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">models</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>  Create a model news file <em>Model / News.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Model_News</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Model_Abstract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_construct(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_init(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>); } }</code> </pre><br></li><li>  Create a resource file of the <em>Model / Resource / News.php</em> news model <em>.</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Model_Resource_News</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Model_Mysql4_Abstract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_init(<span class="hljs-string"><span class="hljs-string">'dsnews/table_news'</span></span>, <span class="hljs-string"><span class="hljs-string">'news_id'</span></span>); } }</code> </pre><br></li><li>  Create a resource file for the <em>Model / Resource / News / Collection.php collection</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Model_Resource_News_Collection</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Model_Mysql4_Collection_Abstract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_construct(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_init(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>); } }</code> </pre><br></li><li>  Change controller <em>controllers / IndexController.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_IndexController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Controller_Front_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $news = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;getCollection()-&gt;setOrder(<span class="hljs-string"><span class="hljs-string">'created'</span></span>, <span class="hljs-string"><span class="hljs-string">'DESC'</span></span>); $viewUrl = Mage::getUrl(<span class="hljs-string"><span class="hljs-string">'news/index/view'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;h1&gt;News&lt;/h1&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($news <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $item) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;h2&gt;&lt;a href="'</span></span> . $viewUrl . <span class="hljs-string"><span class="hljs-string">'?id='</span></span> . $item-&gt;getId() . <span class="hljs-string"><span class="hljs-string">'"&gt;'</span></span> . $item-&gt;getTitle() . <span class="hljs-string"><span class="hljs-string">'&lt;/a&gt;&lt;/h2&gt;'</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $newsId = Mage::app()-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); $news = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;load($newsId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($news-&gt;getId() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;h1&gt;'</span></span> . $news-&gt;getTitle() . <span class="hljs-string"><span class="hljs-string">'&lt;/h1&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;div class="content"&gt;'</span></span> . $news-&gt;getContent() . <span class="hljs-string"><span class="hljs-string">'&lt;/div&gt;'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_forward(<span class="hljs-string"><span class="hljs-string">'noRoute'</span></span>); } } }</code> </pre><br></li></ol><br><br>  Now the link <em>http://site.com/news</em> opens a list of news in the form of links, when you click on it, the page with the contents of the news will open. <br><br>  In paragraph 1, the <em>class</em> node is added to the configuration file, in which the basic class prefixes for the <em>DS_News_Model</em> model and the DS_News_Model_Resource resource are written. <br><br>  When requesting a model in the controller (item 5) <em>Mage :: getModel ('dsnews / news')</em> , the <em>getModel</em> function takes a string of type <em>[model] / [class]</em> from which the model class name is formed, where <em>[model]</em> is the name of the <em>config</em> node <em>/ global / models / [model]</em> , from which the value of the <em>class</em> node is <em>taken</em> - <em>DS_News_Model</em> , and the value of <em>[class] is</em> added to this class prefix (the first letter in each word <em>[class] is</em> converted to the capital letter).  For example, the <em>DS_News_Model_News</em> class is obtained from the <em>dsnews / news</em> <em>line</em> , and the <em>DS_News_Model_News_Gallery</em> class is <em>obtained</em> from the <em>dsnews / news_gallery</em> <em>line</em> . <br><br>  In paragraph 2, the base news model <em>DS_News_Model_News is created</em> , in the constructor of which the resource <em>$ this -&gt; _ init ('dsnews / news')</em> is initialized: the function takes the <em>[model] / [class]</em> line as parameters, where <em>[model]</em> is the name of the node <em>config / global / models / [model]</em> , and <em>[class]</em> is the name of the class.  However, unlike the model, the initialization of the resource class uses the value of the <em>config / global / models / [resourceModel] / class of the</em> resource referenced by the model in the <em>resourceModel</em> node as a class prefix.  As a result, when initializing the <em>$ this -&gt; _ init ('dsnews / news')</em> <em>resource, the DS_News_Model_Resource_News</em> class will be initialized. <br><br>  In clause 3, the <em>DS_News_Model_Resource_News</em> resource class is created, in which the <em>$ this -&gt; _ init</em> table is initialized <em>('dsnews / table_news', 'news_id')</em> : the first parameter is the path to the name of the desired table, and the second is the field used as the primary key ( PRIMARY KEY) table. <br><br>  In clause 4, the object collection class is initialized, in the constructor of which the initial model <em>DS_News_Model_News</em> is initialized. <br><br>  In paragraph 5, there is a change in the receipt of data from the database.  This time models and collections are used.  In the <em>indexAction</em> action, all news is requested by receiving the <em>$ news = Mage :: getModel ('dsnews / news') -&gt; getCollection () collection</em> .  The class name of the collection is calculated from the resource class name of the <em>DS_News_Model_Resource_News</em> + <em>_Collection</em> model. <br><br>  In the <em>viewAction</em> action, the <em>news</em> is loaded by id received in the request.  If the news with this ID exists, then the name of the news and content will be displayed.  Otherwise, page 404 will be generated. <br><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Step 8. Creating and using blocks</b> <div class="spoiler_text">  To output data to Magento, special blocks are used - these are code objects that are responsible for rendering a particular section of code.  In step 5: Using the template for data output, the standard <em>core / template</em> block was used.  In this step, blocks will be created for the news module to display the list and content of the news. <br><br><ol><li>  Add node <em>config / global / blocks</em> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">blocks</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span>DS_News_Block<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">blocks</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>  Create block class news <em>block Block / News.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_News</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Block_Template</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNewsCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $newsCollection = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;getCollection(); $newsCollection-&gt;setOrder(<span class="hljs-string"><span class="hljs-string">'created'</span></span>, <span class="hljs-string"><span class="hljs-string">'DESC'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $newsCollection; } }</code> </pre><br></li><li>  Create class block news block content <em>View / View.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_View</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Block_Template</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre><br></li><li>  Update the configuration file / <em>app/design/frontend/[package mine/[theme mine/layout/ds_news.xml</em> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_index_index</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"content"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">block</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dsnews/news"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ds_news/index.phtml"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reference</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_index_index</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_index_view</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"content"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">block</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dsnews/view"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"news.content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ds_news/view.phtml"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reference</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_index_view</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>  Modify the template file / <em>app/design/frontend/[package mine/[theme mine/</em> template/ <em>ds_news/index.phtml</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $news = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getNewsCollection(); $newsViewUrl = Mage::getUrl(<span class="hljs-string"><span class="hljs-string">'news/index/view'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;h1&gt;News&lt;/h1&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($news <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $item): <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;h2&gt; &lt;a href=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo $newsViewUrl; ?&gt;?id=&lt;?php echo $item-&gt;getId(); ?&gt;"</span></span>&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $item-&gt;getTitle(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;/a&gt; &lt;/h2&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">endforeach</span></span>; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br></li><li>  Create a template file / <em>app/design/frontend/[package mine/[theme mine/</em> template/ <em>ds_news/view.phtml</em> <br><pre> <code class="php hljs">&lt;h1&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $newsItem-&gt;getTitle(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/h1&gt; &lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">content</span></span></span><span class="hljs-class">"&gt;&lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newsItem</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getContent</span></span></span><span class="hljs-class">(); ?&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre><br></li><li>  Change controller <em>controllers / IndexController.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_IndexController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Controller_Front_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadLayout(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;renderLayout(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $newsId = Mage::app()-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); $news = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;load($newsId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($news-&gt;getId() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadLayout(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;getBlock(<span class="hljs-string"><span class="hljs-string">'news.content'</span></span>)-&gt;assign(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">"newsItem"</span></span> =&gt; $news, )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;renderLayout(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_forward(<span class="hljs-string"><span class="hljs-string">'noRoute'</span></span>); } } }</code> </pre><br></li></ol><br><br>  When you open the <em>http://site.com/news/</em> page, the list of news will now be displayed as the contents of the page, and clicking on the news link will open the page with the news contents. <br><br>  The block mechanism allows the use of display logic regardless of the controller.  As you can see in step 3, the <em>indexAction</em> action <em>is</em> now only concerned with loading and displaying templates.  The logic of receiving news now lies on the <em>DS_News_Block_News</em> block, and the display logic is on the <em>/app/design/frontend/[package_///thetheme/template/dsnews/index.phtml</em> template.  Thus, for example, if the latest news list should appear on the sidebar of any other page, then it will be enough to connect the necessary block to the page without using the controller. <br><br>              <em>$this</em> ,    / -       . <br><br>   1          ,     Magento      .  ,        (type)   .xml .  <em>type</em>     <em>[module]/[block]</em> ,  <em>[module]</em> ‚Äî    <em>config/global/blocks/[module]</em> ,      <em>class</em>     ; a <em>[block]</em> ‚Äî  .   <em>type=¬´dsnews/news¬ª</em>      <em>DS_News_Block_News</em> . <br><br>   4      <em>&lt;reference name=¬´content¬ª</em>    .  ,      ,          .        <em>layout handle</em> <em>dsnews_index_view</em> ,      <em>&lt;block type=¬´dsnews/view¬ª name=¬´news.content¬ª template=¬´ds_news/view.phtml¬ª /&gt;</em> .     <em>viewAction</em>                <em>assign</em> ,       .            . <br><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 9. Creating an admin for the module</font></font></b> <div class="spoiler_text"> ,     ,  -     .       . <br><br><ol><li>   <em>controllers/Adminhtml/NewsController.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Adminhtml_NewsController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Controller_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;h1&gt;News Module: Admin section&lt;/h1&gt;'</span></span>; } }</code> </pre><br></li><li>       <em>etc/config.xml</em> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">admin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">routers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_admin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">use</span></span></span><span class="hljs-tag">&gt;</span></span>admin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">use</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">args</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span>DS_News<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">frontName</span></span></span><span class="hljs-tag">&gt;</span></span>dsnews_admin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">frontName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">args</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_admin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">routers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">admin</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>       ,   <em>etc/config.xml</em> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">adminhtml</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">module</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dsnews"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>News<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sort_order</span></span></span><span class="hljs-tag">&gt;</span></span>77<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sort_order</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span>dsnews_admin/adminhtml_news<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">adminhtml</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>  - <em>Helper/Data.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Helper_Data</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Helper_Abstract</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre><br></li><li>       <em>etc/config.xml</em> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">helpers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span>DS_News_Helper<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">helpers</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li></ol><br><br> ,   ,      <strong>News</strong> ,       <em>¬´News Module: Admin section¬ª</em> . <br><br>   1      ,     2 ‚Äî   <em>config/admin/routers/[router]</em> .    ,      <em>http://site.com/index.php/[frontName]/[controller]/index/</em> ,  <em>[frontName]</em> ‚Äî    <em>config/admin/routers/[router]/args/[frontName]</em> ,  <em>[controller]</em> ‚Äî  ,         <em>DS_News</em> + <em>[controller]</em> + <em>Controller</em> .       <em>adminhtml_news</em>    <em>DS_News_Adminhtml_NewsController</em> .          <em>http://site.com/index.php/dsnews_admin/adminhtml_news/index/</em> . <br><br>        , Magento     -  .         ,      .          3    ,       . <br><br>    4  5,       ,     <em>¬´Warning: include(Mage\DS\News\Helper\Data.php): failed to open stream: No such file or directory...¬ª</em> .    Magento   ,     <em>module</em>   <em>config/adminhtml/menu/[menu]</em> .          <em>config/global/helpers/[helper]</em> ,      .      4  5  -,        . <br><br>   ,      ‚Äî      <em>frontName</em>   <em>config/admin/routers</em>      <em>config/frontend/routers</em> .     <br> (   ),       ,         HTTPS  . <br><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 10. Using blocks in admin panel</font></font></b> <div class="spoiler_text">                 .               . <br><br><ol><li>   <em>controllers/Adminhtml/NewsController.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Adminhtml_NewsController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Controller_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadLayout(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_setActiveMenu(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); $contentBlock = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'dsnews/adminhtml_news'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_addContent($contentBlock); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;renderLayout(); } }</code> </pre><br></li><li>   <em>Block/Adminhtml/News.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Abstract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_toHtml</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;h1&gt;News Module: Admin section&lt;/h1&gt;'</span></span>; } }</code> </pre><br></li></ol><br><br> Magento      ,   frontend ( ),    backend () .   .xml    /    (     5: ¬´    ¬ª),     ,  -  Magento,  .       HTML ¬´ ¬ª     .   ,            <em>/app/design/adminhtml/default/default/</em> ,    , ..         . <br><br>   1      <em>$this-&gt;loadLayout()</em>      .             <em>$this-&gt;getLayout()</em> : //         .    <em>createBlock</em>        <em>[module]/[block]</em>   ,     <em>&lt;block type="[module]/[block]"</em>    ;           . <br><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 11. Displaying the list in the Data Grid</font></font></b> <div class="spoiler_text">      ,      . <br><br><ol><li>   <em>Block/Adminhtml/News.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Grid_Container</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_construct(); $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_blockGroup = <span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_controller = <span class="hljs-string"><span class="hljs-string">'adminhtml_news'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_headerText = $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'News Management'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_addButtonLabel = $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Add News'</span></span>); } }</code> </pre><br></li><li>    <em>Block/Adminhtml/News/Grid.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News_Grid</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Grid</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $collection = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;getCollection(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setCollection($collection); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_prepareCollection(); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareColumns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'news_id'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'header'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'News ID'</span></span>), <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'news_id'</span></span> )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'header'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Title'</span></span>), <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'text'</span></span>, )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'created'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'header'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Created'</span></span>), <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'created'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'date'</span></span>, )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_prepareColumns(); } }</code> </pre><br></li></ol><br><br>       ,    1   <em>DS_News_Block_Adminhtml_News</em> : <em>[_blockGroup]/[_controller]_grid</em> ,  <em>_blockGroup</em> ‚Äî      <em>config/global/blocks/[_blockGroup]</em> .       <em>¬´dsnews/adminhtml_news_grid¬ª</em> . <br><br>   <em>_prepareColumns</em>  ,     .  <em>addColumn</em>      ,    ‚Äî     ,  <em>index</em> ‚Äî     ,  <em>type</em> ‚Äî  .          <em>Mage_Adminhtml_Block_Widget_Grid_Column</em> . <br><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 12. Bulk operations in Data Grid</font></font></b> <div class="spoiler_text">        <br><br><ol><li>     <em>Block/Adminhtml/News/Grid.php</em>  <em>_prepareMassaction</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News_Grid</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Grid</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareColumns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareMassaction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setMassactionIdField(<span class="hljs-string"><span class="hljs-string">'news_id'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getMassactionBlock()-&gt;setFormFieldName(<span class="hljs-string"><span class="hljs-string">'news'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getMassactionBlock()-&gt;addItem(<span class="hljs-string"><span class="hljs-string">'delete'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;__(<span class="hljs-string"><span class="hljs-string">'Delete'</span></span>), <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getUrl(<span class="hljs-string"><span class="hljs-string">'*/*/massDelete'</span></span>), )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } }</code> </pre><br></li><li>   <em>massDeleteAction</em>   <em>controllers/Adminhtml/NewsController.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Adminhtml_NewsController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Controller_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">massDeleteAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $news = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'news'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array($news) &amp;&amp; sizeof($news) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($news <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $id) { Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;setId($id)-&gt;delete(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_getSession()-&gt;addSuccess(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;__(<span class="hljs-string"><span class="hljs-string">'Total of %d news have been deleted'</span></span>, sizeof($news))); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_getSession()-&gt;addError($e-&gt;getMessage()); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_getSession()-&gt;addError(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;__(<span class="hljs-string"><span class="hljs-string">'Please select news'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_redirect(<span class="hljs-string"><span class="hljs-string">'*/*'</span></span>); } }</code> </pre><br></li></ol><br><br>         .     ,       <em>Actions</em>  <em>Delete</em>    <em>Submit</em>    . <br><br>   1      <em>_prepareMassaction</em> ,    id- <em>news_id</em> ,    ,       id-.         ‚Äî  ,   ,    .     :         . ,     .            <em>Mage_Adminhtml_Block_Catalog_Product_Grid</em> . <br><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 13. CRUD: Add, Edit, and Delete</font></font></b> <div class="spoiler_text">  ,     <br><br><ol><li>   <em>controllers/Adminhtml/NewsController.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Adminhtml_NewsController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Controller_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadLayout()-&gt;_setActiveMenu(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_addContent(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'dsnews/adminhtml_news'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;renderLayout(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_forward(<span class="hljs-string"><span class="hljs-string">'edit'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">editAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $id = (int) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); Mage::register(<span class="hljs-string"><span class="hljs-string">'current_news'</span></span>, Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;load($id)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadLayout()-&gt;_setActiveMenu(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_addContent(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'dsnews/adminhtml_news_edit'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;renderLayout(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($data = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getPost()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $model = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>); $model-&gt;setData($data)-&gt;setId(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!$model-&gt;getCreated()){ $model-&gt;setCreated(now()); } $model-&gt;save(); Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;addSuccess(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;__(<span class="hljs-string"><span class="hljs-string">'News was saved successfully'</span></span>)); Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;setFormData(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_redirect(<span class="hljs-string"><span class="hljs-string">'*/*/'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) { Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;addError($e-&gt;getMessage()); Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;setFormData($data); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_redirect(<span class="hljs-string"><span class="hljs-string">'*/*/edit'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>) )); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;addError(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;__(<span class="hljs-string"><span class="hljs-string">'Unable to find item to save'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_redirect(<span class="hljs-string"><span class="hljs-string">'*/*/'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($id = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;setId($id)-&gt;delete(); Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;addSuccess(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;__(<span class="hljs-string"><span class="hljs-string">'News was deleted successfully'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) { Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;addError($e-&gt;getMessage()); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_redirect(<span class="hljs-string"><span class="hljs-string">'*/*/edit'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; $id)); } } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_redirect(<span class="hljs-string"><span class="hljs-string">'*/*/'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">massDeleteAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } }</code> </pre><br></li><li>   <em>getRowUrl</em>    <em>Block/Adminhtml/News/Grid.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News_Grid</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Grid</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareColumns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareMassaction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRowUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($model)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getUrl(<span class="hljs-string"><span class="hljs-string">'*/*/edit'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; $model-&gt;getId(), )); } }</code> </pre><br></li><li>      <em>Block/Adminhtml/News/Edit.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News_Edit</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Form_Container</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_blockGroup = <span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_controller = <span class="hljs-string"><span class="hljs-string">'adminhtml_news'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHeaderText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); $model = Mage::registry(<span class="hljs-string"><span class="hljs-string">'current_news'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($model-&gt;getId()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">"Edit News item '%s'"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;escapeHtml($model-&gt;getTitle())); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">"Add News item"</span></span>); } } }</code> </pre><br></li><li>      <em>Block/Adminhtml/News/Edit/Form.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News_Edit_Form</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Form</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareForm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); $model = Mage::registry(<span class="hljs-string"><span class="hljs-string">'current_news'</span></span>); $form = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Varien_Data_Form(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'edit_form'</span></span>, <span class="hljs-string"><span class="hljs-string">'action'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getUrl(<span class="hljs-string"><span class="hljs-string">'*/*/save'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>) )), <span class="hljs-string"><span class="hljs-string">'method'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'post'</span></span>, <span class="hljs-string"><span class="hljs-string">'enctype'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'multipart/form-data'</span></span> )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setForm($form); $fieldset = $form-&gt;addFieldset(<span class="hljs-string"><span class="hljs-string">'news_form'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'legend'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'News Information'</span></span>))); $fieldset-&gt;addField(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'text'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Title'</span></span>), <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span>, )); $fieldset-&gt;addField(<span class="hljs-string"><span class="hljs-string">'content'</span></span>, <span class="hljs-string"><span class="hljs-string">'editor'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Content'</span></span>), <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'content'</span></span>, )); $fieldset-&gt;addField(<span class="hljs-string"><span class="hljs-string">'created'</span></span>, <span class="hljs-string"><span class="hljs-string">'date'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'format'</span></span> =&gt; Mage::app()-&gt;getLocale()-&gt;getDateFormat(Mage_Core_Model_Locale::FORMAT_TYPE_SHORT), <span class="hljs-string"><span class="hljs-string">'image'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSkinUrl(<span class="hljs-string"><span class="hljs-string">'images/grid-cal.gif'</span></span>), <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Created'</span></span>), <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'created'</span></span> )); $form-&gt;setUseContainer(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($data = Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;getFormData()){ $form-&gt;setValues($data); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $form-&gt;setValues($model-&gt;getData()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_prepareForm(); } }</code> </pre><br></li></ol><br><br>       Data Grid   ,      <em>Add News</em> ‚Äî   . <br><br>   1      <em>new</em> , <em>edit</em> , <em>save</em>  <em>delete</em> ,    .    <em>new</em>      <em>edit</em> ,    <em>new</em>      <em>edit</em> .     ,      (    ,       ),       .      <em>save</em>  <br>  <em>$model-&gt;setData($data)-&gt;setId(...)</em> ‚Äî          , ..    ,    <em>setData</em>   .        ,   . <br><br>   2         Data Grid ‚Äî      .   3    ,       ,           <em>[_blockGroup]/[_controller]_[_mode]_form</em> ,    <em>dsnews/adminhtml_news_edit_form</em> ( <em>_mode</em>     <em>edit</em> ). <br><br>            .   ,     <em>new Varien_Data_Form</em>    <em>id</em>    HTML id   , ..      JavaScript-,     .      ,   <em>name</em>       . <br><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 14. Using Tabs</font></font></b> <div class="spoiler_text">         ,       TAB-. <br><br><ol><li>   <em>controllers/Adminhtml/NewsController.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Adminhtml_NewsController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Controller_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">editAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $id = (int) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); $model = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($data = Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;getFormData()){ $model-&gt;setData($data)-&gt;setId($id); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $model-&gt;load($id); } Mage::register(<span class="hljs-string"><span class="hljs-string">'current_news'</span></span>, $model); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadLayout()-&gt;_setActiveMenu(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_addLeft(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'dsnews/adminhtml_news_edit_tabs'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_addContent(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'dsnews/adminhtml_news_edit'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;renderLayout(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">massDeleteAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } }</code> </pre><br></li><li>     <em>Block/Adminhtml/News/Edit/Tabs.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News_Edit_Tabs</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Tabs</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setId(<span class="hljs-string"><span class="hljs-string">'news_tabs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setDestElementId(<span class="hljs-string"><span class="hljs-string">'edit_form'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setTitle($helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'News Information'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareLayout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addTab(<span class="hljs-string"><span class="hljs-string">'general_section'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'General Information'</span></span>), <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'General Information'</span></span>), <span class="hljs-string"><span class="hljs-string">'content'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'dsnews/adminhtml_news_edit_tabs_general'</span></span>)-&gt;toHtml(), )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addTab(<span class="hljs-string"><span class="hljs-string">'custom_section'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Custom Fields'</span></span>), <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Custom Fields'</span></span>), <span class="hljs-string"><span class="hljs-string">'content'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'dsnews/adminhtml_news_edit_tabs_custom'</span></span>)-&gt;toHtml(), )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_prepareLayout(); } }</code> </pre><br></li><li>    <em>Block/Adminhtml/News/Edit/Form.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News_Edit_Form</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Form</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareForm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $form = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Varien_Data_Form(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'edit_form'</span></span>, <span class="hljs-string"><span class="hljs-string">'action'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getUrl(<span class="hljs-string"><span class="hljs-string">'*/*/save'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>) )), <span class="hljs-string"><span class="hljs-string">'method'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'post'</span></span>, <span class="hljs-string"><span class="hljs-string">'enctype'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'multipart/form-data'</span></span> )); $form-&gt;setUseContainer(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setForm($form); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_prepareForm(); } }</code> </pre><br></li><li>    General <em>Block/Adminhtml/News/Edit/Tabs/General.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News_Edit_Tabs_General</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Form</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareForm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); $model = Mage::registry(<span class="hljs-string"><span class="hljs-string">'current_news'</span></span>); $form = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Varien_Data_Form(); $fieldset = $form-&gt;addFieldset(<span class="hljs-string"><span class="hljs-string">'general_form'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'legend'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'General Information'</span></span>) )); $fieldset-&gt;addField(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'text'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Title'</span></span>), <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span>, )); $fieldset-&gt;addField(<span class="hljs-string"><span class="hljs-string">'content'</span></span>, <span class="hljs-string"><span class="hljs-string">'editor'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Content'</span></span>), <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'content'</span></span>, )); $fieldset-&gt;addField(<span class="hljs-string"><span class="hljs-string">'created'</span></span>, <span class="hljs-string"><span class="hljs-string">'date'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'format'</span></span> =&gt; Mage::app()-&gt;getLocale()-&gt;getDateFormat(Mage_Core_Model_Locale::FORMAT_TYPE_SHORT), <span class="hljs-string"><span class="hljs-string">'image'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSkinUrl(<span class="hljs-string"><span class="hljs-string">'images/grid-cal.gif'</span></span>), <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Created'</span></span>), <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'created'</span></span> )); $form-&gt;setValues($model-&gt;getData()); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setForm($form); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_prepareForm(); } }</code> </pre><br></li><li>    Custom <br> <em>Block/Adminhtml/News/Edit/Tabs/Custom.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News_Edit_Tabs_Custom</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_toHtml</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;h2&gt;Custom Fields&lt;/h2&gt;'</span></span>; } }</code> </pre><br></li></ol><br><br>          .         2  ‚Äî   ,   ‚Äî    .       ,     General,       . <br><br>   ,        ,     .   2  -  ,        <em>_prepareLayout</em> .             .    ,    General     <em>$form = new Varien_Data_Form()</em> ,         ,   ‚Äî    . <br><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 15. Adding an image loading field</font></font></b> <div class="spoiler_text">        . <br><br><ol><li>      General <em>Block/Adminhtml/News/Edit/Tabs/General.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News_Edit_Tabs_General</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Form</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareForm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); $model = Mage::registry(<span class="hljs-string"><span class="hljs-string">'current_news'</span></span>); $form = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Varien_Data_Form(); $fieldset = $form-&gt;addFieldset(<span class="hljs-string"><span class="hljs-string">'general_form'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'legend'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'General Information'</span></span>))); $fieldset-&gt;addField(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'text'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Title'</span></span>), <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span>, )); $fieldset-&gt;addField(<span class="hljs-string"><span class="hljs-string">'content'</span></span>, <span class="hljs-string"><span class="hljs-string">'editor'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Content'</span></span>), <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'content'</span></span>, )); $fieldset-&gt;addField(<span class="hljs-string"><span class="hljs-string">'image'</span></span>, <span class="hljs-string"><span class="hljs-string">'image'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Image'</span></span>), <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'image'</span></span>, )); $fieldset-&gt;addField(<span class="hljs-string"><span class="hljs-string">'created'</span></span>, <span class="hljs-string"><span class="hljs-string">'date'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'format'</span></span> =&gt; Mage::app()-&gt;getLocale()-&gt;getDateFormat(Mage_Core_Model_Locale::FORMAT_TYPE_SHORT), <span class="hljs-string"><span class="hljs-string">'image'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSkinUrl(<span class="hljs-string"><span class="hljs-string">'images/grid-cal.gif'</span></span>), <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Created'</span></span>), <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'created'</span></span> )); $formData = array_merge($model-&gt;getData(), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'image'</span></span> =&gt; $model-&gt;getImageUrl())); $form-&gt;setValues($formData); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setForm($form); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_prepareForm(); } }</code> </pre><br></li><li>      <em>Helper/Data.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Helper_Data</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Helper_Abstract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImagePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $path = Mage::getBaseDir(<span class="hljs-string"><span class="hljs-string">'media'</span></span>) . <span class="hljs-string"><span class="hljs-string">'/ds_news'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($id) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"{$path}/{$id}.jpg"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $path; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImageUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $url = Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA) . <span class="hljs-string"><span class="hljs-string">'ds_news/'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($id) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $url . $id . <span class="hljs-string"><span class="hljs-string">'.jpg'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $url; } } }</code> </pre><br></li><li>     <em>Model/News.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Model_News</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Model_Abstract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_construct(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_init(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_afterDelete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); @unlink($helper-&gt;getImagePath(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getId())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_afterDelete(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImageUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getId() &amp;&amp; file_exists($helper-&gt;getImagePath(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getId()))) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $helper-&gt;getImageUrl(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getId()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre><br></li><li>   <em>controllers/Adminhtml/NewsController.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Adminhtml_NewsController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Controller_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">editAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $id = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($data = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getPost()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); $model = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>); $model-&gt;setData($data)-&gt;setId($id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$model-&gt;getCreated()) { $model-&gt;setCreated(now()); } $model-&gt;save(); $id = $model-&gt;getId(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_FILES[<span class="hljs-string"><span class="hljs-string">'image'</span></span>][<span class="hljs-string"><span class="hljs-string">'name'</span></span>]) &amp;&amp; $_FILES[<span class="hljs-string"><span class="hljs-string">'image'</span></span>][<span class="hljs-string"><span class="hljs-string">'name'</span></span>] != <span class="hljs-string"><span class="hljs-string">''</span></span>) { $uploader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Varien_File_Uploader(<span class="hljs-string"><span class="hljs-string">'image'</span></span>); $uploader-&gt;setAllowedExtensions(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'jpg'</span></span>, <span class="hljs-string"><span class="hljs-string">'jpeg'</span></span>)); $uploader-&gt;setAllowRenameFiles(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); $uploader-&gt;setFilesDispersion(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); $uploader-&gt;save($helper-&gt;getImagePath(), $id . <span class="hljs-string"><span class="hljs-string">'.jpg'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Upload the image } else { if (isset($data['image']['delete']) &amp;&amp; $data['image']['delete'] == 1) { @unlink($helper-&gt;getImagePath($id)); } } Mage::getSingleton('adminhtml/session')-&gt;addSuccess($this-&gt;__('News was saved successfully')); Mage::getSingleton('adminhtml/session')-&gt;setFormData(false); $this-&gt;_redirect('*/*/'); } catch (Exception $e) { Mage::getSingleton('adminhtml/session')-&gt;addError($e-&gt;getMessage()); Mage::getSingleton('adminhtml/session')-&gt;setFormData($data); $this-&gt;_redirect('*/*/edit', array( 'id' =&gt; $id )); } return; } Mage::getSingleton('adminhtml/session')-&gt;addError($this-&gt;__('Unable to find item to save')); $this-&gt;_redirect('*/*/'); } public function deleteAction(){ ... } public function massDeleteAction(){ ... } }</span></span></code> </pre><br></li></ol><br><br>           JPG,          .      <em>/media/ds_news</em> ,        ,       .       ‚Äî    URL ,   ,   ‚Äî     .       ,        ‚Äî       <em>image</em> : <em>$formData = array_merge($model-&gt;getData(), array('image' =&gt; $model-&gt;getImageUrl()))</em> . <br><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 16. Connect JavaScript / CSS files in admin panel</font></font></b> <div class="spoiler_text">         <br><br><ol><li>   <em>/skin/adminhtml/default/default/ds_news/adminhtml/scripts.js</em> <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'DS News admin'</span></span>);</code> </pre><br></li><li>   <em>/skin/adminhtml/default/default/ds_news/adminhtml/styles.css</em> <br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#general_form</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">label</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#FF0000</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: bold; }</code> </pre><br></li><li>       <em>controllers/Adminhtml/NewsController.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Adminhtml_NewsController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Controller_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">editAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $id = (int) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); $model = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($data = Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;getFormData()) { $model-&gt;setData($data)-&gt;setId($id); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $model-&gt;load($id); } Mage::register(<span class="hljs-string"><span class="hljs-string">'current_news'</span></span>, $model); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadLayout()-&gt;_setActiveMenu(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;getBlock(<span class="hljs-string"><span class="hljs-string">'head'</span></span>)-&gt;addItem(<span class="hljs-string"><span class="hljs-string">'skin_js'</span></span>, <span class="hljs-string"><span class="hljs-string">'ds_news/adminhtml/scripts.js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;getBlock(<span class="hljs-string"><span class="hljs-string">'head'</span></span>)-&gt;addItem(<span class="hljs-string"><span class="hljs-string">'skin_css'</span></span>, <span class="hljs-string"><span class="hljs-string">'ds_news/adminhtml/styles.css'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_addLeft(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'dsnews/adminhtml_news_edit_tabs'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_addContent(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'dsnews/adminhtml_news_edit'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;renderLayout(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">massDeleteAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } }</code> </pre><br></li></ol><br><br>               <strong>DS News admin</strong> ,        . <br><br>     ,   ,    ,     :   JS,    .      ‚Äî     <em>/skin/adminhtml/default/default/</em>    <em>/js/</em> ‚Äî    . ,   ,        <em>/js/</em> ,      ‚Äî   . <br><br>        ,    <em>/js/</em>         <em>/js/</em>    <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;getBlock(<span class="hljs-string"><span class="hljs-string">'head'</span></span>)-&gt;addItem(<span class="hljs-string"><span class="hljs-string">'skin_js'</span></span>, <span class="hljs-string"><span class="hljs-string">'ds_news/adminhtml/scripts.js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;getBlock(<span class="hljs-string"><span class="hljs-string">'head'</span></span>)-&gt;addItem(<span class="hljs-string"><span class="hljs-string">'skin_css'</span></span>, <span class="hljs-string"><span class="hljs-string">'ds_news/adminhtml/styles.css'</span></span>);</code> </pre>  on <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;getBlock(<span class="hljs-string"><span class="hljs-string">'head'</span></span>)-&gt;addJs(<span class="hljs-string"><span class="hljs-string">'ds_news/adminhtml/scripts.js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;getBlock(<span class="hljs-string"><span class="hljs-string">'head'</span></span>)-&gt;addItem(<span class="hljs-string"><span class="hljs-string">'js_css'</span></span>, <span class="hljs-string"><span class="hljs-string">'ds_news/adminhtml/styles.css'</span></span>);</code> </pre><br><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 17. Update module: add categories for news</font></font></b> <div class="spoiler_text">      ‚Äî  :    .           ,      . <br><br><ol><li>     <em>sql/dsnews_setup/upgrade-0.0.1-0.0.2.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;h1&gt;Upgrade DS News to version 0.0.2&lt;/h1&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; $installer = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; $tableCategories = $installer-&gt;getTable(<span class="hljs-string"><span class="hljs-string">'dsnews/table_categories'</span></span>); $tableNews = $installer-&gt;getTable(<span class="hljs-string"><span class="hljs-string">'dsnews/table_news'</span></span>); $installer-&gt;startSetup(); $installer-&gt;getConnection()-&gt;dropTable($tableCategories); $table = $installer-&gt;getConnection() -&gt;newTable($tableCategories) -&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'category_id'</span></span>, Varien_Db_Ddl_Table::TYPE_INTEGER, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'identity'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'nullable'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-string"><span class="hljs-string">'primary'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, )) -&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, Varien_Db_Ddl_Table::TYPE_TEXT, <span class="hljs-string"><span class="hljs-string">'255'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'nullable'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, )); $installer-&gt;getConnection()-&gt;createTable($table); $installer-&gt;getConnection()-&gt;addColumn($tableNews, <span class="hljs-string"><span class="hljs-string">'category_id'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'comment'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'News Category'</span></span>, <span class="hljs-string"><span class="hljs-string">'default'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'nullable'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; Varien_Db_Ddl_Table::TYPE_INTEGER, )); $installer-&gt;endSetup();</code> </pre><br></li><li>    <em>etc/config.xml</em> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DS_News</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.0.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DS_News</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">models</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span>DS_News_Model<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resourceModel</span></span></span><span class="hljs-tag">&gt;</span></span>dsnews_resource<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resourceModel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_resource</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span>DS_News_Model_Resource<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">entities</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table_categories</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span>ds_news_categories<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table_categories</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table_news</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span>ds_news_entities<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table_news</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">entities</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_resource</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">models</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>    <em>Model/Category.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Model_Category</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Model_Abstract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_construct(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_init(<span class="hljs-string"><span class="hljs-string">'dsnews/category'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_afterDelete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $newsCollection = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;getCollection() -&gt;addFieldToFilter(<span class="hljs-string"><span class="hljs-string">'category_id'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getId()); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($newsCollection <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $news){ $news-&gt;setCategoryId(<span class="hljs-number"><span class="hljs-number">0</span></span>)-&gt;save(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_afterDelete(); } }</code> </pre><br></li><li>        <em>Block/Adminhtml/News/Edit/Tabs/General.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News_Edit_Tabs_General</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Form</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareForm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... $fieldset-&gt;addField(<span class="hljs-string"><span class="hljs-string">'category_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'select'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Category'</span></span>), <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'category_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; $helper-&gt;getCategoriesOptions(), )); ... } }</code> </pre><br></li><li>    <em>Helper/Data.php</em>        ,      <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Helper_Data</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Helper_Abstract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImagePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImageUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCategoriesList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $categories = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/category'</span></span>)-&gt;getCollection()-&gt;load(); $output = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($categories <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $category){ $output[$category-&gt;getId()] = $category-&gt;getTitle(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $output; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCategoriesOptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $categories = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/category'</span></span>)-&gt;getCollection()-&gt;load(); $options = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $options[] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($categories <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $category) { $options[] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $category-&gt;getTitle(), <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; $category-&gt;getId(), ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $options; } }</code> </pre><br></li><li>       <em>Block/News/Grid.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News_Grid</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Grid</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareColumns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'news_id'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'header'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'News ID'</span></span>), <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'news_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'width'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'100px'</span></span>, )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'header'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Title'</span></span>), <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'text'</span></span>, )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'category'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'header'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Category'</span></span>), <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'category_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; $helper-&gt;getCategoriesList(), <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'options'</span></span>, <span class="hljs-string"><span class="hljs-string">'width'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'150px'</span></span>, )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'created'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'header'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Created'</span></span>), <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'created'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'date'</span></span>, )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_prepareColumns(); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareMassaction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRowUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($model)</span></span></span></span>{ ... } }</code> </pre><br></li><li>       <em>etc/config.xml</em> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">adminhtml</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">module</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dsnews"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>News<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sort_order</span></span></span><span class="hljs-tag">&gt;</span></span>77<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sort_order</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">children</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_news</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">translate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">module</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dsnews"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>News<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sort_order</span></span></span><span class="hljs-tag">&gt;</span></span>10<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sort_order</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span>dsnews_admin/adminhtml_news<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_news</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">translate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">module</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dsnews"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Categories<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sort_order</span></span></span><span class="hljs-tag">&gt;</span></span>20<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sort_order</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span>dsnews_admin/adminhtml_category<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews_category</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">children</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">adminhtml</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li></ol><br><br>         ¬´Upgrade DS News to version 0.0.2¬ª,     ‚Äî            .           <em>core_resource</em> ‚Äî   <em>dsnews_setup</em>     <em>0.0.1</em> .   ,       ,     <em>comment</em> ,     . <br><br>   , ,         .  ,          .     ,             ,     .      /  ‚Äî     Magento (    <em>/var/cache</em> ), .. Magento        ! <br><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 18. Displaying the Data Grid in the tab</font></font></b> <div class="spoiler_text">       ,              <br><br><ol><li>     <em>Model/Category.php</em>       <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Model_Category</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Model_Abstract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_afterDelete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getNewsCollection() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $news){ $news-&gt;setCategoryId(<span class="hljs-number"><span class="hljs-number">0</span></span>)-&gt;save(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_afterDelete(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNewsCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $collection = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;getCollection(); $collection-&gt;addFieldToFilter(<span class="hljs-string"><span class="hljs-string">'category_id'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getId()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $collection; } }</code> </pre><br></li><li>   <em>Block/Adminhtml/Category/Edit/Tabs/News.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_Category_Edit_Tabs_News</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Grid</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setId(<span class="hljs-string"><span class="hljs-string">'categoryNewsGrid'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setUseAjax(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $collection = Mage::registry(<span class="hljs-string"><span class="hljs-string">'current_category'</span></span>)-&gt;getNewsCollection(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setCollection($collection); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_prepareCollection(); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareColumns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'ajax_grid_news_id'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'header'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'News ID'</span></span>), <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'news_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'width'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'100px'</span></span>, )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'ajax_grid_title'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'header'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Title'</span></span>), <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'text'</span></span>, )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'ajax_grid_created'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'header'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Created'</span></span>), <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'created'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'date'</span></span>, )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_prepareColumns(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGridUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getUrl(<span class="hljs-string"><span class="hljs-string">'*/*/news'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'_current'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)); } }</code> </pre><br></li><li>       <em>Block/Adminhtml/Category/Edit/Tabs.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_Category_Edit_Tabs</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Tabs</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareLayout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addTab(<span class="hljs-string"><span class="hljs-string">'general_section'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'General Information'</span></span>), <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'General Information'</span></span>), <span class="hljs-string"><span class="hljs-string">'content'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'dsnews/adminhtml_category_edit_tabs_general'</span></span>)-&gt;toHtml(), )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addTab(<span class="hljs-string"><span class="hljs-string">'news_section'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'ajax'</span></span>, <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'News'</span></span>), <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'News'</span></span>), <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getUrl(<span class="hljs-string"><span class="hljs-string">'*/*/news'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'_current'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)), )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_prepareLayout(); } }</code> </pre><br></li><li>     <em>controllers/Adminhtml/CategoryController.php</em> ,         <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Adminhtml_CategoryController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Controller_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">editAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newsAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $id = (int) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); $model = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/category'</span></span>)-&gt;load($id); Mage::register(<span class="hljs-string"><span class="hljs-string">'current_category'</span></span>, $model); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Mage::app()-&gt;getRequest()-&gt;isAjax()) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadLayout(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'dsnews/adminhtml_category_edit_tabs_news'</span></span>)-&gt;toHtml(); } } }</code> </pre><br></li></ol><br><br>       ,           ¬´News¬ª.         ,   .     ,     ,     ,       3: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_Category_Edit_Tabs</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Tabs</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareLayout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); $category = Mage::registry(<span class="hljs-string"><span class="hljs-string">'current_category'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addTab(<span class="hljs-string"><span class="hljs-string">'general_section'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'General Information'</span></span>), <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'General Information'</span></span>), <span class="hljs-string"><span class="hljs-string">'content'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout()-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'dsnews/adminhtml_category_edit_tabs_general'</span></span>)-&gt;toHtml(), )); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($category-&gt;getId()){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addTab(<span class="hljs-string"><span class="hljs-string">'news_section'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'ajax'</span></span>, <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'News'</span></span>), <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'News'</span></span>), <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getUrl(<span class="hljs-string"><span class="hljs-string">'*/*/news'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'_current'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)), )); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_prepareLayout(); } }</code> </pre><br><br>    ,  ,      2 <em>$this-&gt;setId('categoryNewsGrid')</em> ,      JavaScript ,        ,      JavaScript (,    ). <br><br>       <em>ajax_grid_</em>       2.        ,             ,            . <br><br>    ,   - ,      <em>ajax</em> (  )    /,       .       <em>getGridUrl</em>       -.        <em>array('_current' =&gt; true)</em> ,  ,        ,     id    . <br><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 19. Saving Selected Records in Data Grid</font></font></b> <div class="spoiler_text">             ,   /         .     ,       .  ,    -,   .           ,      - .         <em>Mage_Adminhtml_Block_Widget_Grid_Serializer</em> . <br><br><ol><li>   <em>Block/Adminhtml/Category/Edit/Tabs/News.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_Category_Edit_Tabs_News</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Grid</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setDefaultFilter(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'ajax_grid_in_category'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setId(<span class="hljs-string"><span class="hljs-string">'categoryNewsGrid'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setSaveParametersInSession(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setUseAjax(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $collection = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;getCollection(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setCollection($collection); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_prepareCollection(); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareColumns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'ajax_grid_in_category'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'align'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'center'</span></span>, <span class="hljs-string"><span class="hljs-string">'header_css_class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'a-center'</span></span>, <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'news_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'checkbox'</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSelectedNews(), )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'ajax_grid_news_id'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'header'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'News ID'</span></span>), <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'news_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'width'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'100px'</span></span>, )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'ajax_grid_title'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'header'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Title'</span></span>), <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'text'</span></span>, )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addColumn(<span class="hljs-string"><span class="hljs-string">'ajax_grid_created'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'header'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Created'</span></span>), <span class="hljs-string"><span class="hljs-string">'index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'created'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'date'</span></span>, )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_prepareColumns(); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_addColumnFilterToCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($column-&gt;getId() == <span class="hljs-string"><span class="hljs-string">'ajax_grid_in_category'</span></span>) { $collection = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getCollection(); $selectedNews = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSelectedNews(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($column-&gt;getFilter()-&gt;getValue()) { $collection-&gt;addFieldToFilter(<span class="hljs-string"><span class="hljs-string">'news_id'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'in'</span></span> =&gt; $selectedNews)); } <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($selectedNews)) { $collection-&gt;addFieldToFilter(<span class="hljs-string"><span class="hljs-string">'news_id'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'nin'</span></span> =&gt; $selectedNews)); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_addColumnFilterToCollection($column); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGridUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getUrl(<span class="hljs-string"><span class="hljs-string">'*/*/news'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'_current'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'grid_only'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSelectedNews</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_data[<span class="hljs-string"><span class="hljs-string">'selected_news'</span></span>])) { $selectedNews = Mage::app()-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'selected_news'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(is_null($selectedNews) || !is_array($selectedNews)){ $category = Mage::registry(<span class="hljs-string"><span class="hljs-string">'current_category'</span></span>); $selectedNews = $category-&gt;getNewsCollection()-&gt;getAllIds(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_data[<span class="hljs-string"><span class="hljs-string">'selected_news'</span></span>] = $selectedNews; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_data[<span class="hljs-string"><span class="hljs-string">'selected_news'</span></span>]; } }</code> </pre><br></li><li>   <em>controllers/Adminhtml/CategoryController.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Adminhtml_CategoryController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Controller_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">editAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $categoryId = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($data = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getPost()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); $model = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/category'</span></span>); $model-&gt;setData($data)-&gt;setId($categoryId); $model-&gt;save(); $categoryId = $model-&gt;getId(); $categoryNews = $model-&gt;getNewsCollection()-&gt;getAllIds(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($selectedNews = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'selected_news'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)) { $selectedNews = Mage::helper(<span class="hljs-string"><span class="hljs-string">'adminhtml/js'</span></span>)-&gt;decodeGridSerializedInput($selectedNews); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $selectedNews = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); } $setCategory = array_diff($selectedNews, $categoryNews); $unsetCategory = array_diff($categoryNews, $selectedNews); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($setCategory <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $id){ Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;setId($id)-&gt;setCategoryId($categoryId)-&gt;save(); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($unsetCategory <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $id){ Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;setId($id)-&gt;setCategoryId(<span class="hljs-number"><span class="hljs-number">0</span></span>)-&gt;save(); } Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;addSuccess(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;__(<span class="hljs-string"><span class="hljs-string">'Category was saved successfully'</span></span>)); Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;setFormData(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_redirect(<span class="hljs-string"><span class="hljs-string">'*/*/'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) { Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;addError($e-&gt;getMessage()); Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;setFormData($data); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_redirect(<span class="hljs-string"><span class="hljs-string">'*/*/edit'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; $categoryId )); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Mage::getSingleton(<span class="hljs-string"><span class="hljs-string">'adminhtml/session'</span></span>)-&gt;addError(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;__(<span class="hljs-string"><span class="hljs-string">'Unable to find item to save'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_redirect(<span class="hljs-string"><span class="hljs-string">'*/*/'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newsAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $id = (int) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); $model = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/category'</span></span>)-&gt;load($id); $request = Mage::app()-&gt;getRequest(); Mage::register(<span class="hljs-string"><span class="hljs-string">'current_category'</span></span>, $model); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($request-&gt;isAjax()) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadLayout(); $layout = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLayout(); $root = $layout-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'core/text_list'</span></span>, <span class="hljs-string"><span class="hljs-string">'root'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'output'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'toHtml'</span></span>)); $grid = $layout-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'dsnews/adminhtml_category_edit_tabs_news'</span></span>); $root-&gt;append($grid); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$request-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'grid_only'</span></span>)) { $serializer = $layout-&gt;createBlock(<span class="hljs-string"><span class="hljs-string">'adminhtml/widget_grid_serializer'</span></span>); $serializer-&gt;initSerializerBlock($grid, <span class="hljs-string"><span class="hljs-string">'getSelectedNews'</span></span>, <span class="hljs-string"><span class="hljs-string">'selected_news'</span></span>, <span class="hljs-string"><span class="hljs-string">'selected_news'</span></span>); $root-&gt;append($serializer); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;renderLayout(); } } }</code> </pre><br></li></ol><br><br>     1,       <em>ajax_grid_in_category</em> ,     /   ,       (  / / ).           <em>_prepareCollection</em> ,      <em>_addColumnFilterToCollection</em> .  <em>$this-&gt;setDefaultFilter(array('ajax_grid_in_category' =&gt; 1));</em>     (     ).  <em>getSelectedNews</em>     ,  .   ,      ,  POST- (   ),   ‚Äî    . <br><br>     .      .  <em>$root = $layout-&gt;createBlock(...)</em>     <em>root</em> ,     .    , ,      ,       .      . <br><br>    <em>initSerializerBlock</em>  ,     .    4 :      ,       ,    (      ),      ,     <em>getSelectedNews</em>        . <br><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 20. Use beautiful URLs</font></font></b> <div class="spoiler_text">        ‚Äî  ,    HTML/CSS    .   ‚Äî .    ,      .     .   ,    ,    ,     . <br><br><ol><li>    <em>sql/dsnews_setup/upgrade-0.0.2-0.0.3.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;h1&gt;Upgrade DS News to version 0.0.3&lt;/h1&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; $installer = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; $tableNews = $installer-&gt;getTable(<span class="hljs-string"><span class="hljs-string">'dsnews/table_news'</span></span>); $installer-&gt;startSetup(); $installer-&gt;getConnection() -&gt;addColumn($tableNews, <span class="hljs-string"><span class="hljs-string">'link'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'comment'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'News URL link'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; Varien_Db_Ddl_Table::TYPE_TEXT, <span class="hljs-string"><span class="hljs-string">'length'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'255'</span></span>, <span class="hljs-string"><span class="hljs-string">'nullable'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, )); $installer-&gt;getConnection() -&gt;addKey($tableNews, <span class="hljs-string"><span class="hljs-string">'IDX_UNIQUE_NEWS_LINK'</span></span>, <span class="hljs-string"><span class="hljs-string">'link'</span></span>, Varien_Db_Adapter_Interface::INDEX_TYPE_UNIQUE); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;getCollection() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $news) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $news-&gt;load($news-&gt;getId())-&gt;setDataChanges(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)-&gt;save(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) { $news-&gt;setId($news-&gt;getId())-&gt;setLink($news-&gt;getId())-&gt;save(); } } $installer-&gt;endSetup();</code> </pre><br></li><li>     <em>etc/config.xml</em> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DS_News</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.0.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DS_News</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>   <em>Helper/Data.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Helper_Data</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Helper_Abstract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImagePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImageUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCategoriesList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCategoriesOptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($url)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> trim(preg_replace(<span class="hljs-string"><span class="hljs-string">'/-+/'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>, preg_replace(<span class="hljs-string"><span class="hljs-string">'/[^a-z0-9]/sUi'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>, strtolower(trim($url)))), <span class="hljs-string"><span class="hljs-string">'-'</span></span>); } }</code> </pre><br></li><li>    <em>Model/News.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Model_News</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Model_Abstract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_afterDelete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_beforeSave</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $helper = Mage::helper(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getData(<span class="hljs-string"><span class="hljs-string">'link'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setData(<span class="hljs-string"><span class="hljs-string">'link'</span></span>, $helper-&gt;prepareUrl(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getTitle())); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setData(<span class="hljs-string"><span class="hljs-string">'link'</span></span>, $helper-&gt;prepareUrl(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getData(<span class="hljs-string"><span class="hljs-string">'link'</span></span>))); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::_beforeSave(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImageUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } }</code> </pre><br></li><li>        <em>Block/Adminhtml/News/Edit/Tabs/General.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Block_Adminhtml_News_Edit_Tabs_General</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Adminhtml_Block_Widget_Form</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepareForm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... $fieldset-&gt;addField(<span class="hljs-string"><span class="hljs-string">'link'</span></span>, <span class="hljs-string"><span class="hljs-string">'text'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; $helper-&gt;__(<span class="hljs-string"><span class="hljs-string">'Link'</span></span>), <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'link'</span></span>, )); ... } }</code> </pre><br></li><li>     <em>etc/config.xml</em> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">events</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller_front_init_routers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">observers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span>DS_News_Controller_Router<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">method</span></span></span><span class="hljs-tag">&gt;</span></span>initControllerRouters<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">method</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dsnews</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">observers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller_front_init_routers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">events</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>   <em>Controller/Router.php</em> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DS_News_Controller_Router</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mage_Core_Controller_Varien_Router_Abstract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initControllerRouters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($observer)</span></span></span><span class="hljs-function"> </span></span>{ $front = $observer-&gt;getEvent()-&gt;getFront(); $front-&gt;addRouter(<span class="hljs-string"><span class="hljs-string">'dsnews'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">match</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Zend_Controller_Request_Http $request)</span></span></span><span class="hljs-function"> </span></span>{ $identifier = trim($request-&gt;getPathInfo(), <span class="hljs-string"><span class="hljs-string">'/'</span></span>); $cmd = explode(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, $identifier); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($cmd[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'news'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($cmd) == <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_fillRequest($request); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $model = Mage::getModel(<span class="hljs-string"><span class="hljs-string">'dsnews/news'</span></span>)-&gt;load($cmd[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-string"><span class="hljs-string">'link'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($model-&gt;getId()) { $params = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; $model-&gt;getId() ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_fillRequest($request, $params, <span class="hljs-string"><span class="hljs-string">'index'</span></span>, <span class="hljs-string"><span class="hljs-string">'view'</span></span>); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_fillRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($request, $cmd = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $controller = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'index'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $action = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'index'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $request-&gt;setModuleName(<span class="hljs-string"><span class="hljs-string">'news'</span></span>) -&gt;setControllerName($controller) -&gt;setActionName($action) -&gt;setParam(<span class="hljs-string"><span class="hljs-string">'is_routed'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array($cmd) &amp;&amp; count($cmd)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($cmd <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $value) { $request-&gt;setParam($key, $value); } } $request-&gt;setAlias(Mage_Core_Model_Url_Rewrite::REWRITE_REQUEST_PATH_ALIAS, $request-&gt;getPathInfo()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }</code> </pre><br></li></ol><br><br>          <strong>Upgrade DS News to version 0.0.3</strong> ,    ‚Äî      ,      Magento (       ).   1  5 ‚Äî   :     .      7,    6      .         <em>http://site.com/news/{news-link}</em> <br><br>       .          <em>controller_front_init_routers</em> ,           <strong>$this</strong> : <em>$front-&gt;addRouter('dsnews', $this)</em> .       <em>Mage_Core_Controller_Varien_Router_Abstract</em> ,      <em>match</em> .  ,      ,        .        <em>match</em> ,    URL.    ,  .     <em>true</em> ,    ,   <em>false</em>      .  <em>_fillRequest</em> ‚Äî    ,       . <br><br>    ,    <em>_fillRequest</em>  <em>$request-&gt;setModuleName('news')</em>    <em>frontName</em>    config.xml ( <em>frontend/routers/[module Name]/args/frontName</em> ),       . <br><br>     ,        ,    . <br><br></div></div><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source codes for each step are available </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Due to updating the code of examples, there may be situations when the code in the text will not match the code from the archive, or the code will not work as intended. </font><font style="vertical-align: inherit;">Please write a message to the author in PM if you notice any inaccuracies or differences in the code.</font></font></div><p>Source: <a href="https://habr.com/ru/post/180555/">https://habr.com/ru/post/180555/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../180537/index.html">Overview of data center network architectures</a></li>
<li><a href="../180539/index.html">Unobtrusive authorization</a></li>
<li><a href="../180541/index.html">Videos of the summer analytical festival 2010-2012</a></li>
<li><a href="../180549/index.html">Runet in pictures. Issue 3. Runet Giants - or in which online stores are Russians bought?</a></li>
<li><a href="../180551/index.html">About ratings: Hu from hu in the market of digital analytics?</a></li>
<li><a href="../180559/index.html">Economical smartphone with Retina-screen type Mirasol</a></li>
<li><a href="../180561/index.html">Customizable buttons in Yandex. Mail</a></li>
<li><a href="../180563/index.html">Runetology (199): Anton Terekhov, General Director of the combined company Price.ru, Begun, Ferra.ru, ichiba</a></li>
<li><a href="../180565/index.html">3D printer as a service - does it make sense?</a></li>
<li><a href="../180571/index.html">The six-legged robot Rhex learned to jump</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>