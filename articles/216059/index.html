<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>iToilet. Office toilet is free</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 
 My name is Serg Krivoblotsky and I‚Äôm an alcoholic iOS developer. I work in a small Kiev company that specializes in iOS development and de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>iToilet. Office toilet is free</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/a28/0c3/e0a/a280c3e0a2f5e60239b036b387bc989d.png"><br><a name="habracut"></a><br>  Hi, Habr! <br>  My name is Serg Krivoblotsky and I‚Äôm an <s>alcoholic</s> iOS developer.  I work in a small Kiev company that specializes in iOS development and design for our platform.  ‚ÄúLove what you do and do what you love,‚Äù they say.  We do.  Love <br><br>  The idea of ‚Äã‚Äãmonthly hackathons caught on in our team perfectly well.  Once a month, on weekends, the team gathers for entertainment in the form of writing code, learning new technologies, simply generating ideas, or eating pizza.  Tasks were different: from the virtual planning poker'a, to the recognition of the price on the check and convert to nat.  currency.  The main goal of all this is not to release the finished product, but rather to write a working prototype, aka MVP, as you wish. <br>  On one of the ideas and its implementation, I would like to tell you more. <br><br>  Everyone who is in a co-working or a small office has come across this algorithm of his actions: <br><ol><li>  Coming to the toilet </li><li>  Oops, busy </li><li>  You go to the workplace. </li><li>  Wait until it is free. </li></ol><br>  There is a problem - there must be a solution.  It would be convenient if, while in the workplace, I already knew whether the toilet was currently occupied and whether I should go there. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/09e/935/925/09e935925dfad1d8cb666b4c361d5e09.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/c6c/93f/f65/c6c93ff65f4b1bce410f823f6abcc58c.png"><br><br>  What we need for this: <br><ul><li>  Light sensor.  (Light on == the toilet is busy) </li><li>  A device capable of reading its readings. </li><li>  Some PHP and Objective C code. </li></ul><br><br>  <b>It was purchased:</b> <br><br><ol><li>  Pcduino <br><img src="https://habrastorage.org/getpro/habr/post_images/6da/843/0b6/6da8430b63af12b27dfb48b564595218.png"></li><li>  The most common analog light sensor <br><img src="https://habrastorage.org/getpro/habr/post_images/0da/f01/43e/0daf0143ef4d1e64b32f8b23e980a24d.png"></li><li>  Many wires and several resistors </li></ol><br><br>  <b>Working process:</b> <br>  I will not write a lot of code, because it is understood as hello world.  At the end of the article there will be links to Github. <br><br><ol><li>  Connect the sensor to pcduino: <br><img src="https://habrastorage.org/getpro/habr/post_images/8db/96b/0e5/8db96b0e5e21617a5d8ef1556d063af7.png"><br>  The sensor will return values ‚Äã‚Äãin the range 0..4096. <br>  Empirically, it was determined that our light bulb in the toilet when turned on gives: <br>  &gt; 3400 - darkness <br>  &lt;3400 - light <br></li><li>  Raise apache.  (previously there was installed ubuntu). </li><li>  We write php code to read the readings (at the end of the article there are links to GitHub): <br><br><pre><code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;port = (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">"port"</span></span>]) &amp;&amp; is_numeric($_GET[<span class="hljs-string"><span class="hljs-string">"port"</span></span>])) ? $_GET[<span class="hljs-string"><span class="hljs-string">"port"</span></span>]:<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data = exec(<span class="hljs-string"><span class="hljs-string">"cat /proc/adc"</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;port);</code> </pre> <br><br></li><li>  We write API for mobile, and not only, clients: <br><pre> <code class="hljs php"> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;answer(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'light_value'</span></span> =&gt; (int)<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data, <span class="hljs-string"><span class="hljs-string">'light_status'</span></span> =&gt; (bool)$l_status, <span class="hljs-string"><span class="hljs-string">'light_change'</span></span> =&gt; (int)$l_change, <span class="hljs-string"><span class="hljs-string">'sensor_status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ));</code> </pre> </li><li>  We interrogate the timer on the device in any way convenient for you: <br>  OSX: <br><pre> <code class="hljs objectivec"> <span class="hljs-built_in"><span class="hljs-built_in">NSURL</span></span> *toiletURL = [<span class="hljs-built_in"><span class="hljs-built_in">NSURL</span></span> URLWithString:kToiletURLString]; <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *requestError = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">NSData</span></span> *responseData = [<span class="hljs-built_in"><span class="hljs-built_in">NSData</span></span> dataWithContentsOfURL:toiletURL options:<span class="hljs-built_in"><span class="hljs-built_in">NSDataReadingUncached</span></span> error:&amp;requestError];</code> </pre> <br>  iOS: <br><pre> <code class="hljs objectivec"> <span class="hljs-built_in"><span class="hljs-built_in">NSURL</span></span> *url = [<span class="hljs-built_in"><span class="hljs-built_in">NSURL</span></span> URLWithString:urlString]; <span class="hljs-built_in"><span class="hljs-built_in">NSURLRequest</span></span> *request = [<span class="hljs-built_in"><span class="hljs-built_in">NSURLRequest</span></span> requestWithURL:url]; <span class="hljs-comment"><span class="hljs-comment">//Send NSURLSession dataTask [self sendRequest:request withCompletion:completion];</span></span></code> </pre><br></li><li>  Post notification: <br><pre> <code class="hljs objectivec">[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.notificationController deliverNotificationWithTitle:kBusyNotificationText andText:notificationText];</code> </pre><br></li></ol><br><br>  ... In general, this is all that is needed.  Later we added a few buns in the form of a timer and the ability to disable pop-up notifications. <br>  <b>Result of work:</b> <br>  OSX: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/UCWMOrLL4co%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700253&amp;usg=ALkJrhjgp_xsyayj3CGfcD6ypaS_01uwjg" frameborder="0" allowfullscreen=""></iframe><br><br>  iOS <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/lsY08fB-Fw0%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700253&amp;usg=ALkJrhicqa9NPINeygmDV694ZS_6tUs8aQ" frameborder="0" allowfullscreen=""></iframe><br><br>  <b>Hackathon sources:</b> <br>  OSX: <br>  <a href="https://github.com/Krivoblotsky/iToilet-Mac-OS">github.com/Krivoblotsky/iToilet-Mac-OS</a> <br><br>  iOS <br>  <a href="https://github.com/Krivoblotsky/iToilet">github.com/Krivoblotsky/iToilet</a> <br><br>  PHP: <br>  <a href="https://github.com/Krivoblotsky/iToilet-PHP">github.com/Krivoblotsky/iToilet-PHP</a> <br><br>  <a href="http://twitter.com/Krivoblotsky">@Krivoblotsky</a> </div><p>Source: <a href="https://habr.com/ru/post/216059/">https://habr.com/ru/post/216059/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../216047/index.html">Using Redis EXPIRE to Track Rails Online Audiences</a></li>
<li><a href="../216049/index.html">Concurrency: 6 ways to live with shared state</a></li>
<li><a href="../216051/index.html">Sony PlayStation 4: Human Tested</a></li>
<li><a href="../216055/index.html">The German company is developing self-learning manipulators a la "Doc Ock"</a></li>
<li><a href="../216057/index.html">From Oracle yes to Postgres</a></li>
<li><a href="../216063/index.html">Adaptation of Microsoft Project Server 2010 to the specifics of the company's project management system</a></li>
<li><a href="../216065/index.html">Conference Runet 2014</a></li>
<li><a href="../216067/index.html">PostgreSQL feature highlight: the rapid transformation of the old master in the stand-by with pg_rewind</a></li>
<li><a href="../216069/index.html">Google has released a new version of Google Play (4.6.16) with a new password protection option against uncontrolled purchases</a></li>
<li><a href="../216071/index.html">Xperia themes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>