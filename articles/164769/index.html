<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Internal device llst, part 1. Introduction to Smalltalk</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. I bring to your attention the second article from the cycle on Low Level Smalltalk (LLST). Who does not know what is at stake, I recommend r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Internal device llst, part 1. Introduction to Smalltalk</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/19c/551/07e/19c55107e3b8ceeae3d3524c847266fa.png" align="left">  Good day.  I bring to your attention the second article from the cycle on Low Level Smalltalk (LLST).  Who does not know what is at stake, I recommend reading the previous <a href="http://habrahabr.ru/post/164153/">review article</a> , which tells about what llst is and why it was created. <br><br>  In this part, we will focus on the Smalltalk language itself, its syntax and "rules of the game." <br><br>  In the subsequent parts, we smoothly move on to the features of the virtual machine implementation and the internal representation of objects in memory.  We will discuss the organization of the memory manager and the garbage collector.  Let's talk about the bytecodes of the virtual machine.  We learn how the text of the Smalltalk method turns into a sequence of commands.  Finally, we will follow the path from loading the image into the memory of the machine to the processes that occur when sending messages between objects, as well as learn how closures are implemented in blocks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h4>  Introduction </h4><img src="https://habrastorage.org/getpro/habr/post_images/693/d2c/8c4/693d2c8c4ff93b34b4c82a6a8a4f682d.png" align="left">  Programming languages ‚Äã‚Äãare different.  Some have a rather low entry threshold.  Others scare off the potential adept at further approaches, terrifying him by the bizarre and alien syntax, excessive verbosity of the narrative, or complexity of the concepts.  There are languages ‚Äã‚Äãthat require the programmer to literally turn the brain inside out in order to learn how to think as it is necessary for successful programming in such a language.  Some languages ‚Äã‚Äãonly look simple, but really demanding the candidate to have a strong baggage of knowledge from the field of mathematics, lambda calculus and category theory ... <br><br>  Smalltalk is a simple language.  Simple language is not only in terms of syntax, but also in terms of understanding it by an unprepared person.  Not surprisingly, the author initially positioned Smalltalk as a language for teaching programming to children.  Not grown together, unfortunately.  Children prefer PHP and BASIC (or is it fashionable now?).  Well, let's not talk about it. <br><br>  As you know, any theory needs to be confirmed by practice, therefore, in support of the above-mentioned thesis, we will now go over the key concepts of the language and after the introduction is complete we can confidently read the source code of the program. <br><br><h4>  Object World </h4>  Forget about Java, forget about C ++.  <s>Forget everything you were taught.</s> <br><br>  The phrase ‚Äúin language X everything is an object‚Äù is so worn out that I did not want to use it here.  Nevertheless, it is difficult to describe the full depth of this thought in relation to Smalltalk, without resorting to similar stamps. <br><br>  Indeed, in Smalltalk, all are objects.  Strings, numbers (however there is one useful exception), arrays are understandable.  But each object has its own class.  Which (surprise!) Is also an object.  And yes, he also has his own class, which is also an object, etc.  Class methods are also objects.  Bytecode methods - well, you understand.  Even pieces of code presented in the so-called language.  blocks, too, are objects, with each of which can be a friendly chat, and he will tell you everything he knows. <br><br>  In the description of the basic image of LittleSmalltalk there is such a <a href="">wonderful psychedelic place</a> : <br><pre><code class="xml hljs">name subclassOf instanceOf Object MetaObject nil Class MetaClass Object MetaObject Class Class MetaClass Class MetaObject</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/655/f72/272/655f72272035d64d0cb994a8b6be0b8f.png" align="right">  It tells us that: <br><ul><li>  class Object is a subclass of MetaObject and instance nil (from non-existence were objects) </li><li>  class Class is a subclass of MetaClass and an instance of Object (all classes are also objects) </li><li>  MetaObject class is a subclass of Class and its instance (uh ...) </li><li>  class MetaClass is a subclass of Class instance of class MetaObject (metaclasses are also classes) </li><li>  Note to connoisseurs: There is no Behavior class in Little Smalltalk. </li></ul><br>  Brain explosion?  Yeah.  But this is the only place in the entire class hierarchy that looks contradictory.  It is contradictory.  But at the price of this small insanity great opportunities are achieved. <br><br>  I brought this place not to frighten the reader, but to demonstrate that classes and objects in Smalltalk, like the Taoist symbol Yin and Yang, are interpenetrating entities. <br><br>  Returning to the question of simplicity, I note that this inconsistency does not in the least interfere with programming, and in 99% of cases the programmer does not think about it at all (or does not know).  In the remaining percentage of cases, it allows you to do things that greatly simplify programming and reading the texts of programs in this language. <br><br><h4>  Form </h4><img src="https://habrastorage.org/getpro/habr/post_images/039/a47/2f4/039a472f47a345f41f05ec59ebf949a3.jpg" align="left">  Like real living creatures, objects are born and die.  They live in the <i>image</i> - the memory area of ‚Äã‚Äãthe computer in which the objects of the virtual machine are stored.  This image can be saved to disk and loaded later.  Having loaded from a disk, we will receive exactly the same representation that was at the time of recording.  This applies to all objects without exception, from numbers and strings to user interface elements.  To take any special measures to preserve the state of the system is not required - it provides an image.  In this sense, the user interfaces of programs written in the Smalltalk language, I think, would have liked <a href="http://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B6%25D0%25B5%25D1%2584_%25D0%25A0%25D0%25B0%25D1%2581%25D0%25BA%25D0%25B8%25D0%25BD">Jeff Raskin</a> in terms of his persistence. <br><br>  For example: the user closed the text editor, and then returned to him after some time.  Having downloaded from the image, he will find that he has at his disposal a system in exactly the state in which he left it.  The position of the cursor, the selected areas of text, the contents of the clipboard will be restored to its original form.  This is fundamentally different from the startup model of ordinary programs.  This concept is continued in modern desktop environments; however, from my point of view, this is a pale similarity to what could be. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d65/a5b/ff6/d65a5bff62e799a3d6d65e9fc1a8ad9d.png" align="right"><h4>  Message concept </h4>  Programming in the Smalltalk language is entirely reduced to communicating with objects in the image.  There is no traditional editing of the source sheet.  Rather, it is successfully replaced by work in the built-in IDE.  But the basis is still the interaction of some objects with others. <br><br>  For example, to create a new class, we <i>send a message to</i> his ancestor, asking him to create an heir.  To create a new method, we ask the class to create a method, and then fill it with meaning.  In fact, we spawn a method object, and then add it to the class's list of methods.  There are no behind-the-scenes intrigues, operations in the native code and other arrangements here.  Everything is within the scope of the protocol. <br><br>  So, <i>sending a message</i> is the only operation of the language that allows objects to interact with each other (and even with themselves).  Moreover, it is actually the only complex operation that a virtual machine can do.  All other instructions are used to provide the main task. <br><br>  However, the easiest way to see this is with examples (how to run it can be found in the <a href="http://habrahabr.ru/post/164153/">first article</a> ): <br><pre> <code class="smalltalk hljs">-&gt;<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre><br>  Here we took object <code>2</code> and sent him a message <code>+</code> with parameter <code>3</code> .  The result of the message is the amount object that was returned to the outside and displayed by the shell.  This is an example of a <i>binary message</i> in which two objects are involved. <br><br>  Here is an example of a <i>unary message</i> .  Let's ask object <code>2</code> which class corresponds to it.  This is done by sending a <code>class</code> message: <br><pre> <code class="smalltalk hljs">-&gt;<span class="hljs-number"><span class="hljs-number">2</span></span> class <span class="hljs-type"><span class="hljs-type">SmallInt</span></span></code> </pre>  Fine.  Two was an object of class <code>SmallInt</code> . <br><br>  And what else can instances of class <code>SmallInt</code> ?  Let's ask: <br><pre> <code class="smalltalk hljs">-&gt;<span class="hljs-type"><span class="hljs-type">SmallInt</span></span> listMethods * + - / &lt; = asInteger asSmallInt bitAnd: bitOr: bitShift: hash quo: rem: truncSmallInt <span class="hljs-type"><span class="hljs-type">SmallInt</span></span></code> </pre><br>  Yeah.  Operator + known to us and a handful of arithmetic operations.  To get this information, we sent a <code>listMethods</code> message to the <code>listMethods</code> class.  This was possible because the <code>SmallInt</code> class <code>SmallInt</code> also an object to which messages can also be sent.  And all thanks to the above-described "psychedelic" tricks with inheritance.  It is important to note that sending messages to classes and objects is implemented in the same way, that is, it is the same mechanism (without crutches).  Classes and objects really coexist alongside and in no way interfere with each other. <br><br><h4>  What kind of objects are there at all? </h4>  There are: ordinary objects (which are instances of a certain class), classes themselves, metaclasses.  Metaclasses are such objects that ordinary classes are their instances.  Simple, but at first you can not pay any attention to it. <br><br>  And there is <b>true</b> , <b>false</b> and <b>nil</b> .  The first two are the only instances of the classes <code>True</code> and <code>False</code> respectively.  That is, there is only one <b>true</b> object in the whole image.  All places where it is supposed to return or store a Boolean value are used, either explicitly or implicitly. <br><br>  Now let's talk about <b>nil</b> .  As you might have guessed, this object is an empty, not initialized (or erroneous) value.  But, unlike the C ++ <code>null</code> pointer and <code>null</code> from the Java world, <b>nil</b> is a complete object. <br><br>  Let's check: <br><pre> <code class="smalltalk hljs">-&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> isNil <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span> isNil <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span> class <span class="hljs-type"><span class="hljs-type">Undefined</span></span></code> </pre><br>  As we see, sending messages to this object is no different from others, which, I think, is very convenient. <br><br><h4>  Characters </h4>  Another important type of object is <i>symbols</i> .  A character in Smalltalk is an object that is similar in its properties to a string, but, like <b>nil</b> , <b>true</b> and <b>false</b> , is present in a single-copy image. <br><br>  This is how ordinary strings behave: <br><pre> <code class="smalltalk hljs">-&gt;<span class="hljs-string"><span class="hljs-string">'hello'</span></span> = <span class="hljs-string"><span class="hljs-string">'hello'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> -&gt;<span class="hljs-string"><span class="hljs-string">'hello'</span></span> == <span class="hljs-string"><span class="hljs-string">'hello'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> -&gt; <span class="hljs-string"><span class="hljs-string">'hello'</span></span> + <span class="hljs-string"><span class="hljs-string">'World'</span></span> = <span class="hljs-string"><span class="hljs-string">'helloWorld'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> -&gt; <span class="hljs-string"><span class="hljs-string">'hello'</span></span> + <span class="hljs-string"><span class="hljs-string">'World'</span></span> == <span class="hljs-string"><span class="hljs-string">'helloWorld'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span></code> </pre><br>  Here, the operator <code>=</code> used to formally compare the <i>values ‚Äã‚Äãof</i> two strings, whereas the operator <code>==</code> checks objects for <i>identity</i> .  The <code>==</code> operator returns <b>true</b> only if the object and the passed parameter are the same object.  In the case described above, this is not the case, since two instances of the <code>String</code> class, which are created one after the other but are not the same object, are checked for identity. <br><br>  But what happens in the case of characters: <br><pre> <code class="smalltalk hljs">-&gt; <span class="hljs-symbol"><span class="hljs-symbol">#helloWorld</span></span> = <span class="hljs-symbol"><span class="hljs-symbol">#helloWorld</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> -&gt; <span class="hljs-symbol"><span class="hljs-symbol">#helloWorld</span></span> == <span class="hljs-symbol"><span class="hljs-symbol">#helloWorld</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> -&gt; (<span class="hljs-string"><span class="hljs-string">'hello'</span></span> + <span class="hljs-string"><span class="hljs-string">'World'</span></span>) asSymbol == <span class="hljs-symbol"><span class="hljs-symbol">#helloWorld</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span></code> </pre><br>  Smalltalk controls the creation of characters and ensures that they do not lose their uniqueness.  Symbols are typically used in the role of various identifiers, keys in collections, as well as method selectors (see below). <br><br><img src="http://habrastorage.org/storage2/84d/efb/9a7/84defb9a78dd2bcab22607c43c329ed8.png" align="left"><h4>  Cascading messages </h4>  So far, we have operated with a single object, sending messages to it and observing the result.  But the result is also an object.  So you can send a message to him. <br><br>  We try: <br><pre> <code class="smalltalk hljs">-&gt; <span class="hljs-type"><span class="hljs-type">Array</span></span> parent <span class="hljs-type"><span class="hljs-type">Collection</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Object</span></span> parent <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Array</span></span> parent isNil <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Object</span></span> parent isNil <span class="hljs-keyword"><span class="hljs-keyword">true</span></span></code> </pre><br>  In this example, we first derive the ancestors of the classes Array and Object, and then send the isNil message to the result to check for the presence of a value.  The Object class is the top of the hierarchy of regular classes, so it returns <b>nil</b> in response to the parent message.  As we see, to combine several messages, it is enough to write them through the space.  And such queues can be of any length: <br><br><pre> <code class="smalltalk hljs">-&gt; <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">12</span></span> class <span class="hljs-type"><span class="hljs-type">SmallInt</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">12</span></span> class methods <span class="hljs-type"><span class="hljs-type">Dictionary</span></span> (* -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>, + -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>, - -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>, / -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>, &lt; -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>, = -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>, asInteger -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>, asSmallInt -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>, bitAnd: -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>, bitOr: -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>, bitShift: -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>, hash -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>, quo: -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>, rem: -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>, truncSmallInt -&gt; <span class="hljs-type"><span class="hljs-type">Method</span></span>) -&gt; <span class="hljs-number"><span class="hljs-number">12</span></span> class methods keys <span class="hljs-type"><span class="hljs-type">OrderedArray</span></span> (* + - / &lt; = asInteger asSmallInt bitAnd: bitOr: bitShift: hash quo: rem: truncSmallInt) -&gt; <span class="hljs-number"><span class="hljs-number">12</span></span> class methods keys size <span class="hljs-number"><span class="hljs-number">15</span></span></code> </pre><br>  Cascading is another form of message aggregation.  In this case, a series of messages is sent to the same object without the need to specify the name of the addressee object each time.  In this case, the messages are written one after another through a semicolon.  At the end of the whole sentence put a point. <br><br>  <b>Note:</b> Message cascading in Little Smalltalk now works differently from standard implementations.  Why this happens remains to be seen. <br><br><img src="http://habrastorage.org/storage2/2f0/a57/a3b/2f0a57a3b32e78907c95f7e29d4f92d3.jpg" align="right"><h4>  Key messages </h4>  At the moment we already know two types of messages: unary and binary.  There are also <i>key messages</i> that can take one or more parameters.  Let's take from the last example the dictionary of methods of the class SmallInt and ask which key lies under the index 7: <br><br><pre> <code class="smalltalk hljs">-&gt; <span class="hljs-type"><span class="hljs-type">SmallInt</span></span> methods keys at: <span class="hljs-number"><span class="hljs-number">7</span></span> asInteger</code> </pre><br>  Here we send the <code>#at:</code> message to the <code>keys</code> object with parameter 7. The indices in Smalltalk are counted from 1, so the first element has the index 1 and the last element is the size of the container. <br><br>  Here is another example of a key message: <br><pre> <code class="smalltalk hljs">-&gt; (<span class="hljs-type"><span class="hljs-type">Array</span></span> new: <span class="hljs-number"><span class="hljs-number">5</span></span>) at: <span class="hljs-number"><span class="hljs-number">1</span></span> put: <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-type"><span class="hljs-type">Array</span></span> (<span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>)</code> </pre><br>  First, we created an array by sending the <code>#new:</code> message to the Array object with a parameter of 5, meaning the number of elements.  Then we placed 42 in the newly created array at index 1. The resulting array was displayed on the screen.  Notice that the remaining 4 cells are filled with <b>nil</b> values. <br><br>  A remarkable feature of key messages is that the string <code>at: 1 put: 42</code> is <b>one</b> parameterized message <code>#at:put:</code> and not two, as you might think.  In the style of <nobr>C-like</nobr> languages, this could be written like <code>keys-&gt;atPut(1, 42)</code> , but in such a record the correspondence of the passed parameters and their purpose is lost. <br><br>  Suppose we have a certain class <code>Rectangle</code> , representing a rectangle on some plane.  In C ++ code, we encountered the following lines: <br><pre> <code class="cpp hljs">Rectangle* rect1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rectangle(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>); Rectangle* rect2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rectangle(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">115</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>, <span class="hljs-number"><span class="hljs-number">45</span></span>);</code> </pre><br>  How to understand which numbers correspond to what?  Let's say, in the first case, our experience will tell us that most likely we are talking about the sizes of a rectangle, and that the first parameter corresponds to the size of X, and the second one of Y. But in order to find out exactly, we need to look at the prototype of the <code>Rectangle</code> class constructor.  The second option looks even less readable.  Of course, a good programmer would add comments to the code, and change the function's prototype so that it accepts ‚Äútalking‚Äù types, like <code>Point</code> , but this is not the case now. <br><br>  Let's see how a similar construct might look like in Smalltalk: <br><pre> <code class="smalltalk hljs">rect1 &lt;- <span class="hljs-type"><span class="hljs-type">Rectangle</span></span> width: <span class="hljs-number"><span class="hljs-number">200</span></span> height: <span class="hljs-number"><span class="hljs-number">100.</span></span> rect2 &lt;- <span class="hljs-type"><span class="hljs-type">Rectangle</span></span> new width: <span class="hljs-number"><span class="hljs-number">200</span></span>; height: <span class="hljs-number"><span class="hljs-number">100</span></span>; positionX: <span class="hljs-number"><span class="hljs-number">115</span></span>; positionY: <span class="hljs-number"><span class="hljs-number">120</span></span>; rotationDegrees: <span class="hljs-number"><span class="hljs-number">45.</span></span></code> </pre><br>  In the first case, we sent the <code>#width:height:</code> message to the <code>Rectangle</code> class, which created an instance of itself and set the value of the corresponding fields from its parameters.  In the second case, we created the instance in the usual way, sending the message <code>#new</code> , and then cascaded the messages to set the values ‚Äã‚Äãone by one.  Notice how visual the code becomes.  We do not even need to add comments so that the reader will understand what is happening. <br><br>  In principle, this code could also be written ‚Äúin the forehead,‚Äù but it looks less beautiful: <br><br><pre> <code class="smalltalk hljs"><span class="hljs-comment"><span class="hljs-comment">" "</span></span> rect1 &lt;- <span class="hljs-type"><span class="hljs-type">Rectangle</span></span> width: <span class="hljs-number"><span class="hljs-number">200</span></span> height: <span class="hljs-number"><span class="hljs-number">100.</span></span> rect2 &lt;- <span class="hljs-type"><span class="hljs-type">Rectangle</span></span> new. <span class="hljs-comment"><span class="hljs-comment">" "</span></span> rect2 width: <span class="hljs-number"><span class="hljs-number">200.</span></span> rect2 height: <span class="hljs-number"><span class="hljs-number">100.</span></span> rect2 positionX: <span class="hljs-number"><span class="hljs-number">115.</span></span> rect2 positionY: <span class="hljs-number"><span class="hljs-number">120.</span></span> rect2 rotationDegrees: <span class="hljs-number"><span class="hljs-number">45.</span></span></code> </pre><br>  The ability to intersperse parts of <i>a</i> message <i>selector</i> with passed parameters, it seems to me, is one of the strengths of Smalltalk.  With proper use of the names of variables and selectors, this allows you to write very clear methods that practically do not require commenting. <br><br>  Take a look at the following sample code.  This is the Dictionary class code that responds to the #keysAsArray unary message <code>#keysAsArray:</code> <pre> <code class="smalltalk hljs">keysAsArray | index result | result &lt;- Array new: keys size. 1 to: keys size do: [ :index | result at: index put: (keys at: index) ]. ^ result</code> </pre><br>  In the body of this method, we first create an array of return values, and then fill it with the contents of the <code>keys</code> field.  Here the message is transmitted to the unit <code>#to:do:</code> with two parameters.  The first is the <code>keys size</code> , and the second is a piece of code that needs to be executed (the expression in square brackets).  In Smalltalk, such pieces of code are called <i>blocks</i> .  Of course, they are objects and can be stored in a variable.  Here, the variable for the block is not created, but it is transmitted immediately at the place of use.  In order to execute a block, it needs to send a #value message, or #value: if it takes a parameter.  This is what the <code>SmallInt</code> class will do in the implementation of its <code>#to:do:</code> method. <br><br>  In our case, the block will be called <code>size</code> once, each time it will be given an iteration number, which will be interpreted as an index for selecting values ‚Äã‚Äãfrom <code>keys</code> and adding them to <code>result</code> . <br><br><img src="http://habrastorage.org/storage2/593/954/db6/593954db6d85aa474b6f625036cff722.png" align="right"><h4>  Syntax </h4>  At the moment, we suddenly realize that we already know 90% of the entire syntax of Smalltalk.  It remains only to comment on certain points and explain the purpose of certain parts.  In order not to be completely boring, let's do it with a real code example.  I brazenly borrowed it from the <a href="">source</a> image of the primary image.  First, I will give the entire text, and then go through the parts and comment on the purpose of the individual lines. <br><br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">METHOD</span></span> <span class="hljs-type"><span class="hljs-type">Collection</span></span> sort ^ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> sort: [ :x :y | x &lt; y ] ! <span class="hljs-type"><span class="hljs-type">METHOD</span></span> <span class="hljs-type"><span class="hljs-type">Collection</span></span> sort: criteria | left right mediane | (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> isEmpty) ifTrue: [^<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>]. mediane &lt;- <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> popFirst. left &lt;- <span class="hljs-type"><span class="hljs-type">List</span></span> new. right &lt;- <span class="hljs-type"><span class="hljs-type">List</span></span> new. <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> do: [ :x | (criteria value: x value: mediane) ifTrue: [ left add: x ] ifFalse: [ right add: x ] ]. left &lt;- left sort: criteria. right &lt;- right sort: criteria. right add: mediane. ^ left appendList: right !</code> </pre> <br><br>  The <code>Collection</code> class represents some abstract collection of elements.  <code>Collection</code> does not know how to store data, it only provides general algorithms for operating with them.  One of these algorithms is sorting. <br><br>  So, by the way: <br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">METHOD</span></span> <span class="hljs-type"><span class="hljs-type">Collection</span></span> sort ^ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> sort: [ :x :y | x &lt; y ] !</code> </pre><br>  Here we declare a default sorting method that takes no parameters and calls its partner - the #sort method: which takes as its parameter a block that compares two elements of the collection based on some criteria.  We have provided the default criterion: the ratio is more or less.  Although, for complex elements of the collection, no one forbids calling additional messages, like <code>x someField &lt; y someField</code> . <br><br>  Record <code>[ :x :y |</code>  describes the formal parameters of a block, the symbol <code>^</code> is the equivalent of <b><code>return</code></b> from the world of C.  The <code>self</code> keyword is used to send a message to itself, <code>super</code> - to send to its ancestor. <br><br>  Go ahead: <br><pre> <code class="smalltalk hljs">sort: criteria | left right mediane | (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> isEmpty) ifTrue: [^<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>]. mediane &lt;- <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> popFirst.</code> </pre><br>  Here the #sort method is declared: with one formal parameter <code>criteria</code> .  Next are local variables, separated from the rest of the text by vertical bars.  The style is allowed to write them in the same line, although you can transfer to the following: <br><pre> <code class="smalltalk hljs">sort: criteria | left right mediane | (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> isEmpty) ifTrue: [^<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>]. mediane &lt;- <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> popFirst.</code> </pre><br>  Then we check the recursion base.  In the case of an empty collection, the result of the sort will also be an empty collection. <br><br>  In the conventional sense, there is no syntax in Smalltalk.  There are separate messages and keywords that have a special meaning, but there are no hard-coded rules.  Therefore, there are no conditional statements.  Instead, the fact that they are able to make objects so well is used with success - to exchange messages. <br><br>  The construction <code>(self isEmpty) ifTrue: [^self]</code> essentially no different from any other similar one.  Parentheses are not required here and are inserted exclusively for decorative purposes.  First, we send the <code>#isEmpty</code> message to <code>#isEmpty</code> , and then the result of this action (one of the instances of the <code>Boolean</code> class) is to send the <code>#ifTrue:</code> message with the block parameter, which must be executed in case of truth. <br><br>  In the last line, we associate the local variable mediane with an object that returns the current object in response to the <code>#popFirst</code> message.  I intentionally used the verb ‚Äúbind‚Äù instead of ‚Äúassign‚Äù in order to emphasize that no copying takes place here.  All variables store only object references, not values.  Collections also store links, so we don‚Äôt have to worry about the problems of copying large amounts of data.  To explicitly create a copy of an object, separate messages are provided for full or shallow (non-recursive) copying. <br><br>  The next part of the code, sorting itself: <br><pre> <code class="smalltalk hljs"> left &lt;- <span class="hljs-type"><span class="hljs-type">List</span></span> new. right &lt;- <span class="hljs-type"><span class="hljs-type">List</span></span> new. <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> do: [ :x | (criteria value: x value: mediane) ifTrue: [ left add: x ] ifFalse: [ right add: x ] ].</code> </pre><br>  We create a pair of lists for storing items that satisfy and do not satisfy the sorting criteria.  Conventionally, we call them the "left" and "right" halves.  Then we go through the contents of the current collection (method <code>#do:</code> , for each element ( <code>x</code> ) we call the comparison block with the median and decompose the elements into lists, based on the result of the comparison. <br><br>  Notice that the blocks, being actually separate objects, calmly refer to the above declared variables.  So, the block inside <code>#do:</code> uses the variable <code>mediane</code> , whereas the block with <code>#ifTrue:</code> refers to both the variable <code>x</code> and <code>left</code> , declared even higher in the hierarchy.  This is made possible by the fact that the blocks in Smalltalk are <a href="http://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25BC%25D1%258B%25D0%25BA%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)">closures</a> and are tied to the lexical context of their use. <br><br>  Finally, the rest of the method: <br><pre> <code class="smalltalk hljs"> left &lt;- left sort: criteria. right &lt;- right sort: criteria. right add: mediane. ^ left appendList: right</code> </pre><br>  We recursively sort the resulting parts, and then combine the sorted left, median and sorted right parts into one list, which we return as the result of the sort. <br><br>  Let us now see how sorting can be used: <br><pre> <code class="smalltalk hljs"><span class="hljs-comment"><span class="hljs-comment">" "</span></span> -&gt; #(<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">-6</span></span> <span class="hljs-number"><span class="hljs-number">221</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">-273</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span>) sort <span class="hljs-type"><span class="hljs-type">Array</span></span> (<span class="hljs-number"><span class="hljs-number">-273</span></span> <span class="hljs-number"><span class="hljs-number">-6</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">221</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span>) <span class="hljs-comment"><span class="hljs-comment">"  "</span></span> -&gt; #(<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">-6</span></span> <span class="hljs-number"><span class="hljs-number">221</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">-273</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span>) sort: [ :x :y | x &gt; y ] <span class="hljs-type"><span class="hljs-type">Array</span></span> (<span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-number"><span class="hljs-number">221</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">-6</span></span> <span class="hljs-number"><span class="hljs-number">-273</span></span>) <span class="hljs-comment"><span class="hljs-comment">" "</span></span> -&gt; #(<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">-6</span></span> <span class="hljs-number"><span class="hljs-number">221</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">-273</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span>) sort: [ :x :y | x asString &lt; y asString ] <span class="hljs-type"><span class="hljs-type">Array</span></span> (<span class="hljs-number"><span class="hljs-number">-273</span></span> <span class="hljs-number"><span class="hljs-number">-6</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">221</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-comment"><span class="hljs-comment">"    "</span></span> -&gt; #(<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">-6</span></span> <span class="hljs-number"><span class="hljs-number">221</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">-273</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span>) sort: [ :x :y | x asString size &lt; y asString size ] <span class="hljs-type"><span class="hljs-type">Array</span></span> (<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">-6</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">221</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-number"><span class="hljs-number">-273</span></span>) <span class="hljs-comment"><span class="hljs-comment">"   "</span></span> -&gt;<span class="hljs-string"><span class="hljs-string">' ,     !'</span></span> words <span class="hljs-type"><span class="hljs-type">List</span></span> ( ,     !) <span class="hljs-comment"><span class="hljs-comment">"        "</span></span> -&gt;<span class="hljs-string"><span class="hljs-string">' ,     !'</span></span> words sort: [ :x :y | x size &lt; y size ] <span class="hljs-type"><span class="hljs-type">List</span></span> (   !  , )</code> </pre><br>  Thus, a single generalized algorithm can be successfully used to process any type of data.  It is enough to set the correct criterion. <br><br><h4>  Lists </h4><img src="http://habrastorage.org/storage2/df4/d75/0b7/df4d750b703e5ae1babf96235fb34896.png" align="right">        List,       Collection       ,   .         ,      (  Link)         . <br><br> ,       : <br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">METHOD</span></span> <span class="hljs-type"><span class="hljs-type">List</span></span> add: anElement elements &lt;- <span class="hljs-type"><span class="hljs-type">Link</span></span> value: anElement next: elements. ^ anElement !</code> </pre><br>        elements,         ,   . <br><br>        ,      : <br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">METHOD</span></span> <span class="hljs-type"><span class="hljs-type">List</span></span> addLast: anElement elements isNil ifTrue: [ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> add: anElement ] ifFalse: [ elements addLast: anElement ]. ^ anElement ! <span class="hljs-type"><span class="hljs-type">METHOD</span></span> <span class="hljs-type"><span class="hljs-type">Link</span></span> addLast: anElement next notNil ifTrue: [ ^ next addLast: anElement ] ifFalse: [ next &lt;- <span class="hljs-type"><span class="hljs-type">Link</span></span> value: anElement ] !</code> </pre><br><br>     Smalltalk      Haskell (       Haskell).    <code>:</code>  #add:,   <code>++</code>  <code>#addLast:</code> . <br><br> ,  #appendList:      .          : <br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">METHOD</span></span> <span class="hljs-type"><span class="hljs-type">List</span></span> appendList: aList | element | (elements isNil) ifTrue: [ elements &lt;- aList firstLink. ^<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> ]. element &lt;- elements. [element next isNil] whileFalse: [element &lt;- element next]. element next: aList firstLink. ^<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> !</code> </pre><br>   ,       . <br><br><h4>  Conclusion </h4>           Smalltalk. ,          ,        .        ,        .  Thanks for attention! <br><br> <a href="http://habrahabr.ru/post/191250/"> </a> :) <br><br> <b>PS:</b>  <a href="https://habrahabr.ru/users/sheknitrtch/" class="user_link">sheknitrtch</a>  <a href="https://bitbucket.org/0x7CFE/llst/commits/all/tip/branch%2528%2522win32-msvc%2522%2529"></a> ,   llst  MSVC10,     .  -       downloads ‚Äî    . </div><p>Source: <a href="https://habr.com/ru/post/164769/">https://habr.com/ru/post/164769/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../164757/index.html">'Elite: Dangerous' Sets a record as the most expensive project on Kickstarter, which successfully raised money for implementation</a></li>
<li><a href="../164759/index.html">He left his grandmother</a></li>
<li><a href="../164761/index.html">Sandbox review from 12/26/12 to 1/5/13</a></li>
<li><a href="../164763/index.html">Darwinian Evolution of Bacteria - The Complete Picture</a></li>
<li><a href="../164767/index.html">Google closed Maps for Windows Phone users</a></li>
<li><a href="../164771/index.html">-90% piracy on iOS or Hackulos closes</a></li>
<li><a href="../164773/index.html">Android GameStick: The World's Smallest Game Console</a></li>
<li><a href="../164775/index.html">Tracking directory changes: how it is done in different operating systems</a></li>
<li><a href="../164779/index.html">Django 1.5 Release Candidate released</a></li>
<li><a href="../164781/index.html">Network perversions: several identical ip on different router interfaces in FreeBSD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>