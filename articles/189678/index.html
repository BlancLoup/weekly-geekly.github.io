<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ActionBar on Android 2.1+ using the Support Library. Part 2 - Navigation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 In the previous article, I talked about adding a Support Library to your project and gave a simple example of SupportActionBar. But very ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ActionBar on Android 2.1+ using the Support Library. Part 2 - Navigation</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><br>  In the <a href="http://habrahabr.ru/post/189680/">previous article,</a> I talked about adding a Support Library to your project and gave a simple example of SupportActionBar.  But very often ActionBar is used not only as a substitute for the menu, but also as a way to navigate the application.  Under the cut it is written how to implement it. <br><a name="habracut"></a><br><h5>  Navigation methods </h5><br>  ActionBar has 3 ways to navigate: <br>  <a href="http://developer.android.com/reference/android/support/v7/app/ActionBar.html">NAVIGATION_MODE_STANDART</a> - in fact, not navigation at all, just an ActionBar with elements; <br>  <a href="http://developer.android.com/reference/android/support/v7/app/ActionBar.html">NAVIGATION_MODE_LIST</a> - instead of the title drop-down list; <br>  <a href="http://developer.android.com/reference/android/support/v7/app/ActionBar.html">NAVIGATION_MODE_TABS</a> - tabs under the ActionBar. <br><br><h5>  Drop-down list </h5><br>  Let's not create anything, but take the project from the <a href="http://habrahabr.ru/post/189680/">previous article</a> .  Let's create a new class - <b>ScreenFragment</b> , it will be analogous to different screens of the application: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v4.app.Fragment; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.LayoutInflater; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.ViewGroup; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.TextView; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScreenFragment</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fragment</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ TextView tv = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextView(getActivity()); tv.setText(<span class="hljs-string"><span class="hljs-string">"Screen "</span></span> + getArguments().getInt(MainActivity.key_screen_number)); tv.setTextSize(<span class="hljs-number"><span class="hljs-number">30</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tv; } }</code> </pre> <br><br>  I did not create a separate xml markup file, it is not really needed here.  We take the screen number from the arguments and insert it into the programmatically created TextView, which we then show. <br>  Change the <b>onCreate ()</b> method code and add another one to the <b>MainActivity</b> : <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String key_screen_number = <span class="hljs-string"><span class="hljs-string">"key_screen_number"</span></span>; ActionBar ab; FragmentTransaction ft; ScreenFragment screen_fragment; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); ab = getSupportActionBar(); ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST); String[] screens = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[] {<span class="hljs-string"><span class="hljs-string">"Screen 1"</span></span>, <span class="hljs-string"><span class="hljs-string">"Screen 2"</span></span>, <span class="hljs-string"><span class="hljs-string">"Screen 3"</span></span>}; ArrayAdapter&lt;String&gt; sp_adapter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayAdapter&lt;String&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, android.R.layout.simple_spinner_item, screens); sp_adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item); ab.setListNavigationCallbacks(sp_adapter, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); selected_list_item_position = -<span class="hljs-number"><span class="hljs-number">1</span></span>; ab.setSelectedNavigationItem(<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNavigationItemSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ ft = getSupportFragmentManager().beginTransaction(); screen_fragment = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScreenFragment(); Bundle args = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bundle(); args.putInt(key_screen_number, position + <span class="hljs-number"><span class="hljs-number">1</span></span>); screen_fragment.setArguments(args); ft.replace(android.support.v7.appcompat.R.id.action_bar_activity_content, screen_fragment); ft.commit(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br><br>  In onCreate, we tell ActionBar that we will use the navigation method - a list, and prepare an adapter for it, and assign an event handler.  It has only one method - <b>onNavigationItemSelected (int position, long id)</b> .  It is called when the user selects any item in the drop-down list.  Here we create a new <b>ScreenFragment</b> and give it a screen number so that it can show it.  Then we start <b>FragmentTransaction</b> and add this fragment to the View with id = android.support.v7.appcompat.R.id.action_bar_activity_content.  This is the FrameLayout where our layout from setContentView () is added.  Run the application and select various screens: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9c3/1fb/074/9c31fb0743a54bdfb0ea72321cc15c76.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e24/3cd/6ef/e243cd6ef644210faf145a74eb14ebbc.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb1/af4/1bc/cb1af41bcac6b4f8142ef23607418395.png"><br><br>  As a markup for the elements of the drop-down list, I use the system layout, but it does not look very nice.  Therefore, it is better to use your own.  The <b>Adapter.setDropDownViewResource ()</b> method is responsible for <b>adding it.</b> <br><br><h5>  Tabs </h5><br><br>  To change the way tabs are navigated, <b>let's</b> tweak <b>MainActivity</b> : <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); ab = getSupportActionBar(); ab.setNavigationMode(ActionBar.NAVIGATION_MODE_TABS); Tab tab = ab.newTab(); tab.setText(<span class="hljs-string"><span class="hljs-string">"Screen 1"</span></span>); tab.setTabListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); ab.addTab(tab, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); tab = ab.newTab(); tab.setText(<span class="hljs-string"><span class="hljs-string">"Screen 2"</span></span>); tab.setTabListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); ab.addTab(tab, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); tab = ab.newTab(); tab.setText(<span class="hljs-string"><span class="hljs-string">"Screen 3"</span></span>); tab.setTabListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); ab.addTab(tab, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); }</code> </pre><br><br>  You also need to make the <b>MainActivity ... implements ... TabListener</b> .  This is a tab clicker.  He has as many as 3 methods: <br>  <a href="http://developer.android.com/reference/android/support/v7/app/ActionBar.TabListener.html">onTabUnselected (Tab tab, FragmentTransaction ft)</a> - called when the current tab is closed; <br>  <a href="http://developer.android.com/reference/android/support/v7/app/ActionBar.TabListener.html">onTabSelected (Tab tab, FragmentTransaction ft)</a> - called when a new tab opens (triggered immediately after the previous one); <br>  <a href="http://developer.android.com/reference/android/support/v7/app/ActionBar.TabListener.html">onTabReselected (Tab tab, FragmentTransaction ft)</a> - when the user clicks on an already open tab: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTabUnselected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tab tab, FragmentTransaction ft)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTabSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tab tab, FragmentTransaction ft)</span></span></span><span class="hljs-function"> </span></span>{ screen_fragment = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScreenFragment(); Bundle args = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bundle(); args.putInt(key_screen_number, tab.getPosition() + <span class="hljs-number"><span class="hljs-number">1</span></span>); screen_fragment.setArguments(args); ft.replace(android.support.v7.appcompat.R.id.action_bar_activity_content, screen_fragment); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTabReselected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tab tab, FragmentTransaction ft)</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre><br><br>  Here we no longer need to create FragmentTransaction, it is given to us initially (it is assumed that we will work with fragments).  But for this FragmentTransaction, you cannot call the addToBackStack () and commit () methods.  We also have a pressed tab, from which we can pull out everything we need - text, icon, position, etc. <br>  Tabs can be assigned to your View, if the system does not suit you - <a href="http://developer.android.com/reference/android/support/v7/app/ActionBar.Tab.html">setCustomView (int layoutResId)</a> <br>  Run the application, click on the tabs: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2ae/c57/ad9/2aec57ad99bbb01f5f39713b1c1b6257.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/79a/42a/cfc/79a42acfc38bd6b6ade0252567b7371b.png"><br><br>  By the way, if there are a lot of tabs, then their titles can be scrolled horizontally (as on Google Play), but the svayp doesn‚Äôt work below the titles. <br><br><h6>  Addition to the ‚ÄúDrop-down list‚Äù </h6><br><br>  Most likely, when you click on an already selected navigation item, there is no need to change anything on the screen.  Well, with tabs everything is clear - do not touch the <b>onTabReselected ()</b> method and that's it.  And what about the list?  It's very simple: add a variable to <b>MainActivity</b> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> selected_list_item_position;</code> </pre><br>  And change the code <b>onNavigationItemSelected (int position, long id)</b> : <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNavigationItemSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (position != selected_list_item_position) { ft = getSupportFragmentManager().beginTransaction(); screen_fragment = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScreenFragment(); Bundle args = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bundle(); args.putInt(key_screen_number, position + <span class="hljs-number"><span class="hljs-number">1</span></span>); screen_fragment.setArguments(args); ft.replace(android.support.v7.appcompat.R.id.action_bar_activity_content, screen_fragment); ft.commit(); selected_list_item_position = position; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }</code> </pre><br><br>  Now a new screen will open only if you select a non-open navigation item <br><br><h5>  Menu </h5><br><br>  Different tabs usually contain different content, and the menu for it should be different.  The guys from google made this opportunity.  Further I will show everything on the example of tabs.  Add the following code to <b>ScreenFragment</b> : <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String key_menu_resource = <span class="hljs-string"><span class="hljs-string">"key_menu_resource"</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateOptionsMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Menu menu, MenuInflater inflater)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreateOptionsMenu(menu, inflater); inflater.inflate(getArguments().getInt(key_menu_resource), menu); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOptionsItemSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MenuItem item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onOptionsItemSelected(item); Log.d(<span class="hljs-string"><span class="hljs-string">"MENU"</span></span>, <span class="hljs-string"><span class="hljs-string">"Cliced MenuItem is "</span></span> + item.getTitle() + <span class="hljs-string"><span class="hljs-string">" (from ScreenFragment)"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br><br>  Create three files in the <b>res / menu /</b> folder: <br><br>  <b>screen_1.xml</b> : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/item1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Item 1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:drawable/ic_menu_add"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/settings"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Settings"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:drawable/ic_menu_edit"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  <b>screen_2.xml</b> : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/item2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Item 2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:drawable/ic_menu_camera"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/settings"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Settings"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:drawable/ic_menu_edit"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  <b>screen_3.xml</b> : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/item3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Item 3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:drawable/ic_menu_call"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Change <b>onTabSelected ()</b> : <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] menu_resources = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] {R.menu.screen_1, R.menu.screen_2, R.menu.screen_3}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTabSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tab tab, FragmentTransaction ft)</span></span></span><span class="hljs-function"> </span></span>{ screen_fragment = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScreenFragment(); Bundle args = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bundle(); args.putInt(key_screen_number, tab.getPosition() + <span class="hljs-number"><span class="hljs-number">1</span></span>); args.putInt(ScreenFragment.key_menu_resource, menu_resources[tab.getPosition()]); screen_fragment.setArguments(args); screen_fragment.setHasOptionsMenu(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); ft.replace(android.support.v7.appcompat.R.id.action_bar_activity_content, screen_fragment); }</code> </pre><br><br>  Now we need to remove (or better comment out) the <b>onCreateOptionsMenu</b> method - it will only interfere with us now.  And the <b>onOptionsItemSelected ()</b> in MainActivity will also be corrected: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOptionsItemSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MenuItem item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.getItemId() != R.id.settings) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Log.d(<span class="hljs-string"><span class="hljs-string">"MENU"</span></span>, <span class="hljs-string"><span class="hljs-string">"Cliced MenuItem is "</span></span> + item.getTitle() + <span class="hljs-string"><span class="hljs-string">" (from MainActivity)"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }</code> </pre><br><br>  Now I‚Äôll explain that I‚Äôm here.  The fact is that in the fragment, you can also create a menu.  To make it visible, you need to call the Fragment.setHasOptionsMenu (true) method.  If we create a menu not in the Activity, but in a fragment, the <b>onOptionsItemSelected ()</b> method is called first in the <b>MainActivity</b> , and only then in the <b>ScreenFragment</b> if <i>false is</i> returned in the Activity.  Here, instead of <b>if there</b> should be a <b>switch / case</b> , at the end of each <b>case</b> - <b>return true;</b>  This means that we have already processed the click and do not need to call onOptionsItemSelected in the fragment.  For example, on each tab there is a menu item "Settings".  In order not to type the code in each fragment, when you click on this item, we return <i>true</i> .  Then onOptionsItemSelected () is called only in Activity, where we can open a new SettingsActivity, for example.  If you start the program and press the Menu button on the device on different tabs, different elements will be displayed. <br>  When you click on the menu items in the logs will be not only their name, but in which class the clicks were processed.  And you can generally create a separate xml file in the <b>res / menu /</b> folder with this very element, Settings, and in the <b>MainActivity</b> in the <b>onCreateOptionsMenu ()</b> method, create a menu from this file.  Then the 2 menus will merge, and both items will be visible. <br><br><h5>  State saving </h5><br><br>  It often happens that when switching between tabs, the status of the content on them should be maintained.  For this, fragments have a special method - <a href="http://developer.android.com/reference/android/support/v4/app/Fragment.html">setRetainInstance (boolean retain)</a> .  If you pass it <i>true</i> in the parameter, the fragment will not be re-created.  To check this, rewrite the <b>onTabSelected ()</b> method in <b>MainActivity</b> : <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] menu_resources = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] {R.menu.screen_1, R.menu.screen_2, R.menu.screen_3}; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ScreenFragment[] screens = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScreenFragment[] {<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScreenFragment(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScreenFragment(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScreenFragment()}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTabSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tab tab, FragmentTransaction ft)</span></span></span><span class="hljs-function"> </span></span>{ screen_fragment = screens[tab.getPosition()]; Bundle args = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bundle(); args.putInt(key_screen_number, tab.getPosition() + <span class="hljs-number"><span class="hljs-number">1</span></span>); args.putInt(ScreenFragment.key_menu_resource, menu_resources[tab.getPosition()]); screen_fragment.setArguments(args); screen_fragment.setHasOptionsMenu(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); screen_fragment.setRetainInstance(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); ft.replace(android.support.v7.appcompat.R.id.action_bar_activity_content, screen_fragment); }</code> </pre><br><br><h6>  Afterword </h6><br><br>  Well, in general, and all that I wanted to say.  The article turned out great, but hopefully useful) <br><br>  <a href="http://habrahabr.ru/post/189680/">Part 1</a> - Adding Support Library to a project, simple example, search <br>  <a href="http://habrahabr.ru/post/189676/">Part 3</a> - Additional Functions </div><p>Source: <a href="https://habr.com/ru/post/189678/">https://habr.com/ru/post/189678/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../189668/index.html">The Pirate Bay is 10 years old, and they launched a browser to circumvent censorship.</a></li>
<li><a href="../189670/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ69 (August 4 - 10, 2013)</a></li>
<li><a href="../189672/index.html">Obama promised to make intelligence programs more transparent</a></li>
<li><a href="../189674/index.html">Foscam: Reboot</a></li>
<li><a href="../189676/index.html">ActionBar on Android 2.1+ using the Support Library. Part 3 - Useful Features</a></li>
<li><a href="../189680/index.html">ActionBar on Android 2.1+ using SupportLibrary</a></li>
<li><a href="../189682/index.html">Gauss machine gun - a real weapon for the boom (and not only)</a></li>
<li><a href="../189684/index.html">Learn English: movies, books, dictionaries</a></li>
<li><a href="../189686/index.html">The petition against the anti-piracy law gained 100 thousand votes!</a></li>
<li><a href="../189688/index.html">Vim 7.4 released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>