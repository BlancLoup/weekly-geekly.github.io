<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CSS animation will wait</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Translation of the article Making Animations Wait by Donovan Hutchinson. 


 Recently, I launched a CSS animation course for designers and developers ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CSS animation will wait</h1><div class="post__text post__text-html js-mediator-article"><p>  <i>Translation of the article <a href="https://css-tricks.com/making-animations-wait/">Making Animations Wait</a> by Donovan Hutchinson.</i> </p><br><p>  Recently, I launched a CSS animation course for designers and developers who want to improve their web animation skills.  When I was working on a course, I ran into a problem when the animation of the content begins before the files load.  This article describes the method that I use to solve this problem, and which ensures that all the animation will start when it is supposed to. </p><br><a name="habracut"></a><br><p>  With all this happened.  For example, we want our hero header to appear smoothly when loading, so we add fade-in keyframes, set up the animation, but the animation begins before the background image of this block loads.  As a result, we get a gently appearing half-loaded image, or even worse - our logo or title appears before the background is loaded. </p><br><p><img src="https://habrastorage.org/files/233/997/168/2339971682fb4577b620d8e3bcde268b.png"></p><br><p>  Fortunately, there is a way to fix this. </p><br><h3>  Problem: parallel events </h3><br><p>  When we go to the site, the browser tries to do everything as fast as it can: it loads and renders HTML and CSS and at the same time loads other necessary files, such as images. </p><br><p>  This method of loading means that we can almost immediately see some layers and text content, but if the site has a large journal-type header, the image may not be downloaded in time. </p><br><p>  Let's use some built-in browser tricks to pause the animation until you need it. </p><br><h3>  The load event and the animation-play-state property </h3><br><p>  Browsers send us a convenient load javascript event when all the content is loaded.  This event will be triggered for items such as pictures and scripts.  We can use it to control our animation. </p><br><p>  We are going to use the script to listen for the load event and the animation-play-state CSS property to pause the animation until the event occurs. </p><br><p>  Here is the script </p><br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.className += <span class="hljs-string"><span class="hljs-string">" js-loading"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">"load"</span></span>, removeLoadingClass, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeLoadingClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.className = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.className.replace(<span class="hljs-string"><span class="hljs-string">"js-loading"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>;); }</code> </pre> <br><p>  In the first line, the js-loading class is added to the body element. <br>  Then the interception of the event is set. <br>  When the load event occurs, the removeLoadingClass function is run.  At this point, all the pictures and other site files are uploaded. <br>  Finally, the removeLoadingClass function removes the js-loading class from the body. </p><br><p>  This code should be placed in the head of your site.  If you load it from a third-party file, the CSS may load before this script works, which will allow the animation to start ahead of time. </p><br><p>  You can use this class to pause all animations on a page until all the content has loaded. </p><br><h3>  Waiting for one image </h3><br><p>  The method described above waits until all files for the page are loaded.  Perhaps you want to wait only for loading one image, for example for your header.  Fortunately, the download event works for each image separately.  The approach described in <a href="https://css-tricks.com/measuring-image-widths-javascript-carefully/">Measuring Image Widths in JavaScript</a> can help with this. </p><br><p>  We can set the focus to one specific image. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Adjust the "querySelector" value to target your image var img = document.querySelector("img"); document.body.className += " js-loading"; img.addEventListener("load", removeLoadingClass); function removeLoadingClass() { document.body.className = document.body.className.replace("js-loading", ""); }</span></span></code> </pre> <br><h3>  The animation-play-state property </h3><br><p>  The <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/animation-play-state">animation-play-state</a> property is well supported by modern browsers.  It tells the browser when the current animation needs to be started or stopped.  By default, the animation is running. </p><br><p>  We can use this property to pause any animation on a page while the content is loading.  Add this code to CSS </p><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.js-loading</span></span> *, <span class="hljs-selector-class"><span class="hljs-selector-class">.js-loading</span></span> *<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:before</span></span>, <span class="hljs-selector-class"><span class="hljs-selector-class">.js-loading</span></span> *<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:after</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">animation-play-state</span></span>: paused <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; }</code> </pre> <br><p>  This code pauses all animations on the page, as long as body has a js-loading class.  It applies also to all pseudo-elements: before and: after. </p><br><p>  When the script removes the body js-loading class, the CSS rule is not applied and all animations are started at the right moment. </p><br><p>  A nice bonus of this method is that you do not need to change anything in our styles. </p><br><h3>  What if js doesn't work? </h3><br><p>  This is a question that must always be asked if we use javascript to work with content.  Sometimes js fails.  It can be turned off.  Plugins may do unexpected things.  Although in most cases everything works, javascript is always a little under our control, so it would be good to think about what will happen if it does not work as expected. </p><br><p>  In this case, we are fine.  If javascript doesn't work, then the js-loading class will not be added, and the animation will work right away.  This may give a slightly strange result when the background image is loaded during animation, but this is the worst case scenario and a reasonable fallback. </p><br><h3>  Let's see in action </h3><br><p>  Let's look at the test how it works.  We need big pictures.  For example, <a href="https://images.unsplash.com/photo-1446776811953-b23d57bd21aa%3Fdpr%3D2%26auto%3Dformat%26fit%3D">Nasa photo on Unsplash</a> , its size is about 2 MB. </p><br><p>  First, while the page loads, we will see a blank screen.  To truly see everything in action, you can use the built-in property in Chrome.  Open the inspector, select the Network tab, then select the download speed settings in the drop-down menu.  Take Good 3G, which is slow enough to see the work of our script. </p><br><p><img src="https://habrastorage.org/files/b45/0a7/544/b450a75441d94552b5c9ceb672030472.png"></p><br><p>  Click "Rerun" on the demo example, and you will see that there will be no animation until the image is loaded.  You can also try to disable javascript (and clear the cache before rebooting) to see the difference. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://codepen.io/donovanh/embed/preview/vxQrEQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Load indicator </h3><br><p>  If you want to avoid a blank page, you should use some explanatory text or animation that will let users know what is happening.  The choice depends on how long you think the download will take place.  If you have an extremely large image and the wait is more than 1-2 seconds, then the indicator will be a good option. </p><br><p>  On the other hand, it is probably better to compress a stronger image or reduce it so that the load is faster.  Experiment and see which option is best for you. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/325342/">https://habr.com/ru/post/325342/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325330/index.html">Security Watch: IBM QRadar SIEM</a></li>
<li><a href="../325334/index.html">Stanislavsky data center: how DataLine corporate theater works</a></li>
<li><a href="../325336/index.html">Iron for nuclear winter - with protection from cold, fog and smoke</a></li>
<li><a href="../325338/index.html">Russian Maxim Senah confessed to involvement in the Windigo cyber campaign.</a></li>
<li><a href="../325340/index.html">Cross-browser submission of a form with a file or how to rewrite the whole sender several times after testing in IE</a></li>
<li><a href="../325344/index.html">HotSpot organization on MikroTik equipment with SMS authorization</a></li>
<li><a href="../325346/index.html">ITMO University will start developing unbreakable storage systems</a></li>
<li><a href="../325348/index.html">What devices today is the market of "Internet of things" in Russia</a></li>
<li><a href="../325350/index.html">Programmer Identity</a></li>
<li><a href="../325352/index.html">Guide to creating a simple photo editor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>