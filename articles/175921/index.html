<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Address Book Sharepoint 2010 from AD with synchronization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I reworked a large amount of material on this topic, however, I did not find anything more or less worthwhile. In this regard, he collected his own ve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Address Book Sharepoint 2010 from AD with synchronization</h1><div class="post__text post__text-html js-mediator-article">  I reworked a large amount of material on this topic, however, I did not find anything more or less worthwhile.  In this regard, he collected his own version of the address book, which requires a minimum of time for implementation in the finished infrastructure. <br><br><h5>  Initial data: </h5><br><ul><li>  Domain Level: Windows 2008 R2 </li><li>  Sharepoint Server: Windows Server 2012 Standart </li><li>  Sharepoint 2010 version with all updates </li></ul><br><br><h5>  Purpose of the task </h5><br>  The goal of the task was to quickly deploy a dynamically updated telephone directory, the data source of which would be the Active Directory. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  The solution of the problem </h5><br>  My solution to the task will not be something revolutionary for Sharepoint professionals, however, it may be of interest to novice system administrators who face similar tasks.  I ask those interested under the cat. <a name="habracut"></a><br><br>  So, the whole task can be divided into two stages: <br><ul><li>  Export data from Active Directory. </li><li>  Import data to Sharepoint list. </li></ul><br><h4>  Export data from AD </h4><br>  To export data from AD, use the Active Directory module for PowerShell 2 or 3 versions.  The cmdlet we are interested in is called <b>Get-ADUser</b> and has a comprehensive help.  We use it: <br><br> <code>Get-ADUser -Filter {(ObjectClass -eq "user")} | FT Surname, GivenName, Name, Mail, Company, Department, Title, telephoneNumber, homephone, mobile, facsimileTelephoneNumber <br></code> <br><br>  The result of executing this code will be a table with the data of all users of the domain, including service accounts, however, this table will not contain such data as phone numbers, email addresses, departments and positions of employees.  This is due to the fact that by default PS returns only 10 account properties associated with accounts AD.  To indicate the PS need to extract the parameters we need, we use the parameter of the Get-ADUsers -Parameters cmdlet (sorry for taftology). <br><br> <code>Get-ADUser -Filter {(ObjectClass -eq "user")} -Properties Surname, GivenName, Name, Mail, Company, Department, Title, telephoneNumber, homephone, mobile, facsimileTelephoneNumber | FT Surname, GivenName, Name, Mail, Company, Department, Title, telephoneNumber, homephone, mobile, facsimileTelephoneNumber</code> <br> <br>  This code will return all the necessary data in tabular form for all users of the domain.  It is logical to assume that in the domain environment there is a large number of service credentials.  Add a filter rejecting user accounts with a blank ‚ÄúGivenName‚Äù field, that is, ‚ÄúName‚Äù. <br><br> <code>Get-ADUser -Filter {(ObjectClass -eq "user") -and (GivenName -like "*")} -Properties Surname, GivenName, Name, Mail, Company, Department, Title, telephoneNumber, homephone, mobile, facsimileTelephoneNumber | FT Surname, GivenName, Name, Mail, Company, Department, Title, telephoneNumber, homephone, mobile, facsimileTelephoneNumber</code> <br> <br>  Now comes the turn of exporting the data to a CSV file.  (Initially, everything was done in one script, however, PowerShell 3 does not support Sharepoint 2010 cmdlets, and Powershell 2 cannot work with Active Directory module intended for PowerShell 3).  To export data, I used the standard PS <b>Export-CSV</b> cmdlet and stepped on a rake: <br><ol><li>  The exported data was of the form <b>4641548913248745 ,,</b> .  Not at all what was displayed in the console earlier.  Conclusion: the table data does not suit us.  Replace <b>FT</b> with <b>SELECT</b> and get ... </li><li>  ... a bunch of questions instead of Cyrillic characters.  If the data is Cyrillic, you must explicitly set the export encoding (Unicode). </li></ol><br>  It is also worth ordering the data in alphabetical order by the "Name" or "Full Name" field, in order not to force Sharepoint to do this, and also remove the first line from the CSV file (the header left by PowerShell). <br><br> <code>Get-ADUser -Filter {(ObjectClass -eq "user") -and (GivenName -like "*")} -Properties Surname, GivenName, Name, Mail, Company, Department, Title, telephoneNumber, homephone, mobile, facsimileTelephoneNumber | sort-object -property Name | Select Surname, GivenName, Name, Mail, Company, Department, Title, telephoneNumber, homephone, mobile, facsimileTelephoneNumber | Export-Csv D:\Contacts.csv -Encoding Unicode -NoTypeInformation <br></code> <br><br><h4>  Import data to Sharepoint List </h4><br>  Imagine that we have some Sharepoint portal available at the <a href="http://portal/">portal</a> , as well as a standard list of "Contacts" into which we want to import data from AD.  To connect to Sharepoint via PowerShell, you need to add the Sharepoint folder to PowerShell, which is included in the Sharepoint package.  The connection to the ‚ÄúContacts‚Äù list we need, located on the portal ‚Äú <a href="http://portal/">portal</a> ‚Äù has the form: <br><br> <code>add-pssnapin microsoft.sharepoint.powershell</code> <br> <code>$web = Get-SPWeb "http://portal"</code> <br> <code>$list = $web.lists[""]</code> <br> <br>  I can't see this list of parsings, so every synchronization I suggest I delete all of its entries using a cycle: <br><br> <code>do {$list.items.delete(0)}</code> <br> <code>until ($list.items.Count -eq 0)</code> <br> <br>  Well, actually import itself: <br><br> <code>Import-Csv D:\Contacts.csv | ForEach-Object {</code> <br> <code>$item = $list.items.Add()</code> <br> <code>$item[" "] = $_.Name</code> <br> <code>$item[""] = $_.Company</code> <br> <code>$item[" "] = $_.telephoneNumber</code> <br> <code>$item[" "] = $_.mobile</code> <br> <code>$item["  "] = $_.Mail</code> <br> <code>$item[""] = $_.Title</code> <br> <code>$item.update()</code> <br> <code>}</code> <br> <br>  Add other options to taste ... <br><br><h4>  PowerShell 2 from PowerShell 3 </h4><br>  Remember that I put Sharepoint 2010 on Windows Server 2012?  So here's another rake!  There are several solutions: you can spread export from AD and import to Sharepoint by time, or you can run PowerShell 2 from under PowerShell 3 (Monsieur knows what it means ... (c)).  For this we need just one line in the first script: <br><br> <code>C:\Windows\System32\WindowsPowerShell\v1.0\PowerShell.exe -version 2.0 "&amp;'D:\Set-Contacts.ps1'" <br></code> <br><br>  Actually that's all.  It remains only to throw <b>C: \ Windows \ System32 \ WindowsPowerShell \ v1.0 \ PowerShell.exe</b> with the parameter <b>"&amp; 'D: \ Set-Contacts.ps1'"</b> into the task scheduler and keep the data of AD users up to date.  Thank you for your time!  I leave the full versions of the scripts below. <br><br>  <b>Get-Contacts.ps1</b> <br> <code>Get-ADUser -Filter {(ObjectClass -eq "user") -and (GivenName -like "*")} -Properties Surname, GivenName, Name, Mail, Company, Department, Title, telephoneNumber, homephone, mobile, facsimileTelephoneNumber | sort-object -property Name | Select Surname, GivenName, Name, Mail, Company, Department, Title, telephoneNumber, homephone, mobile, facsimileTelephoneNumber | Export-Csv D:\Contacts.csv -Encoding Unicode -NoTypeInformation <br></code> <code>C:\Windows\System32\WindowsPowerShell\v1.0\PowerShell.exe -version 2.0 " &amp; ' D:\Set-Contacts.ps1 ' "</code> <br> <br>  <b>Set-Contacts.ps1</b> <br> <code>add-pssnapin microsoft.sharepoint.powershell</code> <br> <code>$web = Get-SPWeb "http://portal"</code> <br> <code>$list = $web.lists[""]</code> <br> <code>do {$list.items.delete(0)}</code> <br> <code>until ($list.items.Count -eq 0)</code> <br> <code>Import-Csv D:\Contacts.csv | ForEach-Object {</code> <br> <code>$item = $list.items.Add()</code> <br> <code>$item[" "] = $_.Name</code> <br> <code>$item[""] = $_.Company</code> <br> <code>$item[" "] = $_.telephoneNumber</code> <br> <code>$item[" "] = $_.mobile</code> <br> <code>$item["  "] = $_.Mail</code> <br> <code>$item[""] = $_.Title</code> <br> <code>$item.update()</code> <br> <code>}</code> </div><p>Source: <a href="https://habr.com/ru/post/175921/">https://habr.com/ru/post/175921/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../175911/index.html">Win32 / Gapz: the last episode</a></li>
<li><a href="../175913/index.html">How accurate is the demographic targeting of Google?</a></li>
<li><a href="../175915/index.html">Note on Instructions (no claim to world domination)</a></li>
<li><a href="../175917/index.html">Ranking in Yandex: how to put machine learning on stream (post # 3)</a></li>
<li><a href="../175919/index.html">Arbor Pravail APS and DDOS</a></li>
<li><a href="../175929/index.html">Correct names and helpful errors</a></li>
<li><a href="../175931/index.html">The digest of interesting news and materials from the world of PHP for the last two weeks, No. 14 (03/26/2013 - 04/08/2013)</a></li>
<li><a href="../175933/index.html">Virality in games</a></li>
<li><a href="../175935/index.html">Features when intercepting method calls using __call () and __callStatic () in PHP</a></li>
<li><a href="../175937/index.html">Work with Avaya Aura Communication Manager using the OSSI protocol</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>