<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mobile devices from the inside. Changing the tablet memory layout</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Changing the tablet memory layout 
 TABLE OF CONTENTS  1. Introduction. 
 2. Planning for changes in memory markup. 
 3. Changes to the firmware of th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mobile devices from the inside. Changing the tablet memory layout</h1><div class="post__text post__text-html js-mediator-article"><h2>  Changing the tablet memory layout </h2><br><div class="spoiler">  <b class="spoiler_title">TABLE OF CONTENTS</b> <div class="spoiler_text">  <a href="https://habr.com/ru/post/347920/">1. Introduction.</a> <br>  <a href="https://habr.com/ru/post/347920/">2. Planning for changes in memory markup.</a> <br>  <a href="https://habr.com/ru/post/347920/">3. Changes to the firmware of the tablet.</a> <br>  <a href="https://habr.com/ru/post/347920/">3.1. Making changes to the GPT file.</a> <br>  <a href="https://habr.com/ru/post/347920/">3.2.PPT-GPT-file in MU.</a> <br>  <a href="https://habr.com/ru/post/347920/">4. Check the results of the work done.</a> <br>  <a href="https://habr.com/ru/post/347920/">5. Conclusion.</a> <br>  <a href="https://habr.com/ru/post/347920/">6. Sources of information.</a> <br></div></div><br><a name="1"></a><h2>  1. Introduction. </h2><br>  Somehow I got into the hands of a tablet <b>YB1-X90L</b> from <b>Lenovo</b> , made on a chip from <b>Intel</b> : <br><img src="https://habrastorage.org/webt/tr/1k/vu/tr1kvuenyewmyqaqhtje6stiphu.png"><br>  <b>Fig.1</b> .  Tablet YB1-X90 <br><br>  I tried to perform some on it, in principle, I would say, the standard modifications for a mobile device (MU) that fell into the hands of the developer: <br><br><ul><li>  unlock bootloader; </li><li>  install custom recovery; </li><li>  get ROOT; </li><li>  view memory markup; </li><li>  well, and general research work opportunities. </li></ul><br>  All items of the plan have been successfully implemented.  One of the unplanned items was the study of the markup section, which I called the <b>Intel-type GPT partition</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, on many sites, the topic of changing the layout of MPs made on <b>GPT-</b> scheme is very popular, especially if this is a <b>GPT</b> <a href="https://habrahabr.ru/post/347738/">-Intel-type</a> partition.  It turns out that this question, despite the theoretical calculations, is still not closed ... So I decided to seize the moment that I have a free <b>ME</b> on my hands, which can be ‚Äútortured‚Äù a little and carry out field tests of my theoretical knowledge .  In short, I decided to change the memory layout ... <br><br>  Before starting work, I took off everything that is possible on the existing markup: <b>partitions</b> files, <b>dev / block / by-name /,</b> and the image of a <b>GPT</b> partition. <br><br>  What we have: <br><br><ul><li>  tablet with <a href="https://forum.xda-developers.com/showpost.php%3Fp%3D71040707%26postcount%3D2">stock firmware</a> ; </li><li>  <b>GPT</b> image of an <b>Intel-</b> type partition; </li><li>  The partitions file, taken from a really working <b>MU</b> . </li></ul><br>  What I need: for my experiments, I needed a separate 512MB memory section. <br><br>  Accordingly, to place it you need to find these megabytes somewhere in the memory of the tablet ... <br><a name="habracut"></a><br><a name="2"></a><h2>  2. Planning for changes in memory markup. </h2><br>  Let's take a closer look at the <b>partitions</b> file: <br><br><pre><code class="xml hljs">major minor #blocks name 179 0 30535680 mmcblk0 179 1 102400 mmcblk0p1 179 2 102400 mmcblk0p2 179 3 30720 mmcblk0p3 179 4 30720 mmcblk0p4 179 5 1024 mmcblk0p5 179 6 16384 mmcblk0p6 179 7 1024 mmcblk0p7 179 8 1024 mmcblk0p8 179 9 8192 mmcblk0p9 179 10 10240 mmcblk0p10 179 11 1048576 mmcblk0p11 179 12 262144 mmcblk0p12 179 13 3932160 mmcblk0p13 179 14 24986624 mmcblk0p14 179 48 4096 mmcblk0rpmb 179 32 4096 mmcblk0boot1 179 16 4096 mmcblk0boot0 179 64 1927168 mmcblk1 179 65 1927160 mmcblk1p1</code> </pre> <br>  "Candidates" for "cuts" due to their size can be, for example, three sections: <b>android_country</b> ( <b>mmcblk0p11</b> ), <b>android_data</b> ( <b>mmcblk0p14</b> ) and <b>android_system</b> ( <b>mmcblk0p13</b> ).  They, as a rule, have the size of a section much larger than the image that is poured into them, which would allow me to easily allocate memory for a new section.  However, do not forget that resizing partitions, respectively, and shifts in the location of the partitions, will require fussing about restoring the data of these partitions, i.e.  their backup and subsequent restoration ... Therefore, it is easier to ‚Äúbite off‚Äù the free space from the data section, since  it is located last.  This will allow us to avoid performing a recalculation of the size of the affected sections of memory and will have to restore only one partition. <br><br>  Thus, we only need to add a new partition between the <b>android_system</b> section and the <b>android_data</b> section.  This section is called <b>win_tools</b> , and the size is set to 512MB.  All parameters of the new section are summarized in the table: <br><br><pre> <code class="xml hljs">.1.   ==================================================== | ‚Ññ |  |  |   | | / |  |  | | |====================================================| | 1 | 0x00 | Size | 0x200 | | 2 | 0x04 | Label | win_tools | | 3 | 0x4C | GuidType |   | | 4 | 0x5C | GuidPartition |   | ====================================================</code> </pre><br><a name="3"></a><h2>  3. Changes to the firmware of the tablet. </h2><br>  We were lucky, because  if the <b>GPT-</b> section were standard, then we would have to change both sections: primary and backup.  And so we only change one <b>GPT-</b> section of <b>Intel-</b> type.  Getting started ... <br><br><a name="31"></a><h3>  3.1. Making changes to the GPT file. </h3><br>  First, we make changes directly to the <b>GPT</b> file that stores the image of the GPT section of the tablet firmware.  To do this, take the <b>gpt.bin</b> file from the stock firmware and: <br><br><ol><li>  Load it into a hex editor: <br><br><div class="spoiler">  <b class="spoiler_title">Fig.2.</b>  <b class="spoiler_title">Intel GPT partition file</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/nm/av/rx/nmavrxwr_ggoizvbghxqveddfg4.png"><br></div></div></li><li>  Find the entry for the <b>android_system</b> section and copy it completely as a template for the new section: <br><br><div class="spoiler">  <b class="spoiler_title">Fig.3.</b>  <b class="spoiler_title">System partition entry</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gr/4m/9g/gr4m9gyryaurhhvgwnkitmjh0bu.png"><br></div></div></li><li>  Moving to the beginning of the next section, i.e.  <b>android_data</b> , and paste the template: <br><br><div class="spoiler">  <b class="spoiler_title">Fig.4.</b>  <b class="spoiler_title">Adding a new section entry</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/su/db/nd/sudbndjo1onok8xq9_noxfobtby.png"><br></div></div></li><li>  The new entry should contain a description of the new section, take the parameter values ‚Äã‚Äãof the description from Table 1 and fill in the <b>Size</b> fields (it was <b>0x00000F00</b> , it will become <b>0x00000200</b> ), <b>Label</b> (it was <b>android_system</b> , it will become <b>win_tools</b> ) of the new section.  All changes are marked in red in the picture: <br><br><div class="spoiler">  <b class="spoiler_title">Fig.5.</b>  <b class="spoiler_title">Filling in the fields of a new section record</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/7d/kg/qv/7dkgqvdhvwhsqfb8xwfckbh2bjo.png"><br></div></div></li><li>  Go to the header of the <b>GPT-</b> section and make changes in the <b>Number</b> field (Number of entries on the sections) (offset <b>0x08</b> header).  The field had the number <b>0x000E</b> (14 sections), we will write there the number <b>0x000F</b> (15 sections), in the figure below it is highlighted in red: <br><br><div class="spoiler">  <b class="spoiler_title">Fig.6.</b>  <b class="spoiler_title">New number of entries in the header of the GPT section</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/lo/ka/qy/lokaqyts4viskcsq7tvqxxdxxwc.png"><br></div></div></li><li>  Save the updated Intel-type <b>GPT</b> file. <br></li></ol><br>  All, the partition markup changed, now you need to put it in the tablet. <br><br><a name="32"></a><h3>  3.2.PPT-GPT-file in MU. </h3><br>  Since  we decided to move the beginning of the <b>android_data</b> section, then in order to find the saved data there, we will perform the backup section.  After that, you can safely change the markup of memory ... <br><br>  Flashing any partition images, removing / installing loader locking, etc.  Actions are performed using the flasher from <b>Intel</b> <b>PhoneFlashTools</b> .  And you need to use the one whose version is supported by your MU.  The investigated tablet must be "dissected" version 5.3.2.0.  An additional condition for a successful operation is the presence of a json file that controls the execution process.  It is easy to understand the version of the flasher, but I had to write the json_file myself, because  It seems that no one has tried to change the markup. <br><br><blockquote>  <b>ATTENTION!</b>  Before performing any work on changing the markup of memory, it is MANDATORY to back up all sections of memory. <br><br>  The point is that re-partitioning physically affects only one section - the partition section.  All your data, system, IMEI is stored in the same places.  Only change the pointers to these places, which are stored in the markup section.  This leads to the fact that you, using the MU (operating system) means, simply cannot get to the storage locations. <br></blockquote><br><a name="4"></a><h2>  4. Check the results of the work done. </h2><br>  After doing the work, I removed all the information on the new markup: the <b>partitions</b> files and the image of the new GPT partition. <br><br>  Let's look at the contents of partitions: <br><br><pre> <code class="xml hljs">major minor #blocks name 7 0 65536 loop0 179 0 30535680 mmcblk0 179 1 102400 mmcblk0p1 179 2 102400 mmcblk0p2 179 3 30720 mmcblk0p3 179 4 30720 mmcblk0p4 179 5 1024 mmcblk0p5 179 6 16384 mmcblk0p6 179 7 1024 mmcblk0p7 179 8 1024 mmcblk0p8 179 9 8192 mmcblk0p9 179 10 10240 mmcblk0p10 179 11 1048576 mmcblk0p11 179 12 262144 mmcblk0p12 179 13 3932160 mmcblk0p13 179 14 524288 mmcblk0p14 179 15 24462336 mmcblk0p15 179 48 4096 mmcblk0rpmb 179 32 4096 mmcblk0boot1 179 16 4096 mmcblk0boot0 179 64 1927168 mmcblk1 179 65 1927160 mmcblk1p1</code> </pre><br>  Now you can compare what was and what became, with the markup: <br><br><pre> <code class="xml hljs"> =========================================================================== |  |  | |=====================================|=====================================| |major minor #blocks name |major minor #blocks name | |=====================================|=====================================| | 179 13 3932160 mmcblk0p13 | 179 13 3932160 mmcblk0p13 | | 179 14 24986624 mmcblk0p14 | 179 14 524288 mmcblk0p14 | | 179 48 4096 mmcblk0rpmb | 179 15 24462336 mmcblk0p15 | | | 179 48 4096 mmcblk0rpmb | ===========================================================================</code> </pre><br>  It can be seen that the <b>mmcblk0p14</b> section of size <b>24986624</b> moved to the line below, decreased to the size of <b>24462336</b> and became now the section of <b>mmcblk0p15</b> , and in its place a new section of <b>mmcblk0p14 of</b> size <b>524288 appeared</b> . <br><br>  Well, let's compare the contents of GPT-partition images before and after re-partitioning.  Here is the header of the stock GPT section: <br><br><div class="spoiler">  <b class="spoiler_title">Fig.7a.</b>  <b class="spoiler_title">GPT section stock image header</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/n1/dj/3l/n1dj3lt8llv_chejmorrzcspb8c.png"><br></div></div><br>  Here are the records of the system - data partition spacing of the same image: <br><br><div class="spoiler">  <b class="spoiler_title">Fig.7b.</b>  <b class="spoiler_title">GPT partition image partition records</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/5m/4u/n2/5m4un2gwsw4bjjkp55gnjgwnfrk.png"><br></div></div><br>  But the header of the GPT section after the re-markup: <br><br><div class="spoiler">  <b class="spoiler_title">Fig.8a.</b>  <b class="spoiler_title">New GPT section header</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/qc/ij/gb/qcijgbjqbusatbflh1eld0juzym.png"><br></div></div><br>  Here are the records of the same partition of the system - data sections of the GPT section after the re-markup: <br><br><div class="spoiler">  <b class="spoiler_title">Fig.8b.</b>  <b class="spoiler_title">Partition entries for a new GPT partition image</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/kx/sb/j0/kxsbj0woonbo0pwyuhrwwajddyy.png"><br></div></div><br>  Everything speaks for the fact that the partition really exists, by the way, but the list of partitions, taken from the <b>/ dev / block / by-name</b> folder with the help of <b>Total Commander</b> : <br><br><img src="https://habrastorage.org/webt/oc/hi/_w/ochi_wjt3jddpnxy5gh4rvhglea.png"><br>  <b>Fig.9</b> .  List of images of MU sections <br><br><a name="5"></a><h2>  5. Conclusion. </h2><br>  Those who carefully read the publication, realized that making changes purely to the markup of the memory is not difficult, but when you consider that specialized editors exist for these purposes ... <br><br>  Much more problems arise when putting this markup inside the <b>ME</b> , although this is already material for another publication ... <br><br><a name="6"></a><h2>  6. Sources of information. </h2><br><a name="61"></a>  <a href="https://habrahabr.ru/post/347738/">1. Mobile devices from the inside.</a>  <a href="https://habrahabr.ru/post/347738/">What is GPT?</a> <br><a name="62"></a>  <a href="https://forum.xda-developers.com/showpost.php%3Fp%3D71040707%26postcount%3D2">2. Stock firmware YB1-X90L.</a> <br><a name="63"></a>  <a href="https://habrahabr.ru/post/346144/">3. The construction of the GPT section.</a> <br><a name="64"></a>  <a href="http://lenovo-forums.ru/topic/9111-razmetka-pamyati-mobilnyh-ustroystv/">4. ‚ÄúWhat is GPT?‚Äù</a> </div><p>Source: <a href="https://habr.com/ru/post/347920/">https://habr.com/ru/post/347920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347910/index.html">[BugBounty] Disclosing 5 million links to private Telegram chats and the ability to edit any article telegra.ph</a></li>
<li><a href="../347912/index.html">The most harmful advice. How to implement</a></li>
<li><a href="../347914/index.html">Technical duty and its habitat</a></li>
<li><a href="../347916/index.html">Examine pattern matching in C # 7</a></li>
<li><a href="../347918/index.html">Animations in Android on the shelves (Part 1. Basic animations)</a></li>
<li><a href="../347922/index.html">What really happened to Vista: an insider retrospective</a></li>
<li><a href="../347924/index.html">Experience of two attempts at putting JNCIE-SP</a></li>
<li><a href="../347926/index.html">Flask Mega-Tutorial, Part IX: Pagination (Edition 2018)</a></li>
<li><a href="../347928/index.html">FPGA for programmer, state machines (verilog)</a></li>
<li><a href="../347930/index.html">Writing a blockchain in less than 200 lines of Go code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>