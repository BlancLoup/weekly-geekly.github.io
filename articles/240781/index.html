<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>KodiCMS architecture</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Hello everyone, in this article I will try to briefly tell about the components that make up the CMS architecture, there are a lot of t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>KodiCMS architecture</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Hello everyone, in this article I will try to briefly tell about the components that make up the CMS architecture, there are a lot of them (I think they all don‚Äôt fit in the article), controllers, modules, plugins and css, js files connection. <br><a name="habracut"></a><br>  The basis of KodiCMS is <i>Kohana framework version 3.3.2</i> .  The core of the system is the ‚Äúkodicms‚Äù module, which contains the main logic of operation and is expanded with the help of observers (modules) through plug-ins and modules. <br><br><h5>  The list of modules that were developed for CMS: </h5><br><ul><li>  <b>API</b> - Working with AJAX requests, supports <i>GET, POST, PUT, DELETE</i> request types.  Answer in json or HTML format </li><li>  <b>Behavior</b> - expanding the behavior of <i>frontend</i> pages </li><li>  <b>Dashboard</b> - desktop and everything connected with it </li><li>  <b>Datasource</b> - the basis for creating data partitions (using it created sections <i><a href="https://github.com/butschster/kodicms/tree/master/cms/plugins/hybrid">Hybrid data</a></i> , <i><a href="https://github.com/KodiCMS/plugin-categories">Categories</a></i> , <i><a href="https://github.com/KodiCMS/plugin-rating">Document rating</a></i> ), <i>switchable</i> </li><li>  <b>elFinder</b> - file manager, <i>disable</i> </li><li>  <b>Email, Email _Queue</b> - sending mail, bulk mailing, Email sections in Backend and tasks for the task manager, <i>disabled</i> </li><li>  <b>FileSystem</b> - classes for working with FS </li><li>  <b>Installer</b> - System Installer </li><li>  <b>KodiCMS</b> - System Core </li><li>  <b>Navigation</b> - Navigating Backend </li><li>  <b>Page_Parts</b> - Parts of the pages (Linked to the <i>Pages</i> module via the <i>Observer</i> ), <i>disabled</i> </li><li>  <b>Pages</b> - the module of the site pages, <i>theoretically disabled</i> </li><li>  <b>Plugins</b> - module plug-ins, organizes the expansion of the system plug-ins, <i>switchable</i> </li><li>  <b>Reflinks</b> - assistant for generating temporary links, for example, <i><a href="https://github.com/butschster/kodicms/blob/master/cms/modules/reflinks/classes/reflink/forgot.php">Recall a password</a></i> or <i><a href="https://github.com/butschster/kodicms/blob/master/cms/modules/reflinks/classes/reflink/register.php">Confirmation of registration</a></i> </li><li>  <b>Scheduler</b> - Calendar for Backend, as well as task manager Cron, <i>disabled</i> </li><li>  <b>Search</b> - site search, contains a full-text search driver, the list can be supplemented with its own drivers </li><li>  <a href="https://github.com/butschster/Kohana-sidebar">Sidebar</a> , <i>disabled</i> </li><li>  <b>Snippet</b> - a module for organizing pieces of code that can be inserted into a template, also used by the ‚ÄúWidget‚Äù module for widget templates, which can be <i>disabled</i> </li><li>  <b>Tags</b> - the organization of tags in the module of the page and the Hybrid data, <i>disconnected</i> </li><li>  <b>Update</b> - system update module, <i>disabled</i> </li><li>  <b>Users</b> - system users, ACL </li><li>  <b>Widget</b> - Widgets, blocks placed on the site pages, display any information that is <i>disabled.</i> </li></ul><br><br>  * <a href="https://github.com/butschster/kodicms/blob/master/cms/application/init.php">disableable</a> - disabling is possible in <a href="https://github.com/butschster/kodicms/blob/master/cms/application/init.php">application / init.php</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  In addition to the modules developed by me, there are standard modules and third-party development in the system. </h5><br><ul><li>  <b>Assets</b> - for organizing CSS, JavaScript </li><li>  <b>Breadcrumbs</b> - generation of breadcrumbs, used by the ‚ÄúBreadcrumbs‚Äù widget </li><li>  <b>Captcha</b> </li><li>  <b>Minion</b> - used by the task manager to run scheduled tasks </li><li>  <b>Pagination</b> </li></ul><br><br><h4>  KodiCMS module </h4><br>  The main CMS module, namely, it expands the standard Kohana functional, contains basic controllers for working with <i>Backend</i> , configs, helpers, etc. <br><br><h4>  Settings </h4><br>  There are several types of settings storage in the system: <br><ul><li>  File configs </li><li>  A table in the database to override file configs (cached) </li><li>  Separate table for storing plug-in information (Cached) </li><li>  Storing user information User_Meta (for example, the set and location of widgets on the desktop), as in Wordpress and Bitrix, SugarCRM, etc.  (Cached) </li></ul><br><br>  Each module, as well as the system plug-in, can <a href="http://kohanaframework.org/3.3/guide/kohana/config">override or add new parameters</a> to the config file, so it was decided to use them for storing data that could be supplemented by a third-party developer in its module or plug-in, therefore the data for: <br><br><ul><li>  build sitemap admin panel - <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/kodicms/config/sitemap.php">sitemap.php</a> </li><li>  specifying possible page types - <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/kodicms/config/behaviors.php">behaviors.php</a> </li><li>  the list of access rights to controllers admin panel - <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/kodicms/config/permissions.php">permissions.php</a> </li><li>  list of data sections - <a href="https://github.com/butschster/kodicms/blob/master/cms/plugins/hybrid/config/datasources.php">datasources.php</a> </li><li>  list of available widgets - <a href="https://github.com/butschster/kodicms/blob/master/cms/plugins/hybrid/config/widgets.php">widgets.php</a> </li><li>  list of drivers for the search module - <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/search/config/search.php">search.php</a> </li><li>  the list of available tasks for Cron Task Manager - <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/search/config/jobs.php">jobs.php</a> </li><li>  list of field types for the section ‚ÄúHybrid Data‚Äù - <a href="https://github.com/butschster/kodicms/blob/master/cms/plugins/hybrid/config/fields.php">fields.php</a> </li></ul><br>  Those.  when creating a plug-in, if you need to add a menu item (sitemap.php), a new section in the backend (datasources.php), expand access rights to new controllers (permissions.php) or add a new task to the <a href="http://demo.kodicms.ru/backend/jobs/add">scheduler</a> (jobs.php) it creates config file. <br><br><h4>  Controllers </h4><br>  The system controller has several levels of abstraction: <br><br><ol><li>  Empty <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/kodicms/classes/kodicms/controller/system/controller.php">System_Controller</a> controller </li><li>  Security controller of access control <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/kodicms/classes/kodicms/controller/system/security.php">System_Security</a> &lt;System_Controller </li><li>  Template controller responsible for the page templates <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/kodicms/classes/kodicms/controller/system/template.php">System_Template</a> &lt;System_Security </li><li>  Backend <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/kodicms/classes/kodicms/controller/system/backend.php">System_Backend</a> &lt;System_Template controller, from which all controllers are inherited for access to which authorization is required.  This controller connects all the necessary css, javascript, etc. </li><li>  Frontend <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/kodicms/classes/kodicms/controller/system/frontend.php">System_Frontend</a> &lt;System_Template controller, from which all controllers are inherited for access to which authorization is not needed.  (Authorization, Recall Password, Error Page) </li><li>  Media controller for searching media files (sss, js, etc.) in all modules and plugins in the <a href="https://github.com/butschster/kodicms/tree/master/cms/modules/kodicms/media">media</a> folder, i.e.  if in the plugin you create the media / css folder and put the css file in it (test.css), then you can access it as <i>cms / media / css / test.css</i> </li><li>  The <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/api/classes/controller/system/api.php">System_API</a> &lt;System_Ajax controller API is mainly used for ajax (GET, POST, PUT, DELETE) requests, and actions in the controller also come in several types of get_ ..., post_ ..., put_ ..., delete_ ..., depending on what type of request comes in. </li><li>  <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/pages/classes/kodicms/controller/front.php">Front</a> controller for frontend pages. </li></ol><br><br>  Long ago, I talked about such a structure at the office.  forum <a href="http://forum.kohanaframework.org/discussion/10412/postroenie-arhitektury-prilozheniya">kohana</a> , maybe this post will seem useful to someone. <br><br><h4>  Frontend controller </h4><br>  The route for this controller is the last one on the list.  When the controller is called, the page is searched by URL ( <i>requests are cached</i> ), then the page type is checked, the page is checked for access, widgets, parts of the page and other extensions are connected to the HTML template for the admin (for the admin, the ability to create a toolbar through View, as in fashionable CMS like Bitrix, Wordpress, etc.), caching on the browser side and specifying the page type (in the <i>slug</i> field in the page settings you can specify the extension, for example, <i>rss.xml</i> and the output will be with the appropriate Content-Type) . <br><br>  I drew a diagram of the path that passes the request when calling the frontend controller, the scheme is a bit confusing and the main thing is not to get lost in the arrows and find Request. <br><br> <a href="http://www.kodicms.ru/public/images/forum/schemes/Frontend.pdf"><img src="https://habrastorage.org/files/dfc/af9/b18/dfcaf9b18d9344d8b5d0e714c585eb69.jpg"></a> <br><br><h4>  Organization of media (css, js, less, image) files </h4><br>  The main media files of the system are located in the cms / media folder. <br>  The main stylesheet file css / common.css is compiled from <i>LESS</i> files and third-party libraries, including <i>Twitter Bootstrap</i> , <i>Font-Awesome,</i> and others, recompiled when you turn on <a href="https://github.com/KodiCMS/plugin-less">the Less plugin</a> and make changes to the <a href="">less / common.less file</a> , which is also the main one. <br><br>  The main JavaScript file is <a href="">js / backend.js</a> (it will probably be described in a future article). <br><br>  To connect <i>css</i> and <i>js</i> in templates, the <b>Assets</b> module is used, which was slightly modified, namely, the package manager <i>Assets_Package was written</i> , which will allow <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/kodicms/init.php">grouping media files into packages</a> .  It can also be used in the frontend for quick connection of libraries, as well as in widgets. <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//     Frontend  Meta::factory($page)-&gt;package(array('jquery', 'bootstrap', 'holder', 'fontawesome', 'demo-assets'));</span></span></code> </pre> <br><br>  Each module and plug-in in the system can also have a media folder with a similar structure and can be connected to the controller as cms / media / ....  without specifying the name of the module, files are searched through Kohana :: find_file and therefore the paths of finding files are cached. <br><br>  Also, when requesting a backend controller, it searches for the javascript file for it <a href="">cms / media / js / controller / controller_name.js</a> <br><br><h4>  Modules and Plugins </h4><br>  In addition to the standard features of the modules (and plug-ins including), support for the installation has been added to them. <br><br>  At the moment of the installer launch, the installer searches and calls into each module of the <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/plugins/install/observers.php">install / observers.php</a> file, at the moment the system is installed, the installer goes through all the modules and <a href="">checks</a> for the presence of the <a href="">install / schema.sql files</a> , and then <a href="">install / dump.sql</a> and after the launch of <a href="https://github.com/butschster/kodicms/blob/master/cms/modules/plugins/install/install.php">install / install.php</a> <br><br>  Since  plugins have the ability to <i>activate</i> and <i>deactivate</i> , then <a href="https://github.com/butschster/kodicms/blob/master/cms/plugins/test/install.php">install.php</a> , <a href="https://github.com/butschster/kodicms/blob/master/cms/plugins/hybrid/uninstall.php">uninstall.php</a> , <a href="">install / drop.sql</a> , as well as in the <a href="https://github.com/butschster/kodicms/blob/master/cms/plugins/maintenance/frontend.php">frontend.php</a> and <a href="https://github.com/butschster/kodicms/blob/master/cms/plugins/maintenance/backend.php">backend.php</a> files are added for them, which work in the same way as <i>init.php</i> , but are connected in Frontend / Backend. <br>  Otherwise, the work of plug-ins is no different from standard Kohana modules. <br><br>  <b>PS</b> <br>  In the previous article I forgot to mention that there is a plugin repository for KodiCMS: <a href="https://github.com/KodiCMS">github.com/KodiCMS</a> , you can also see it in the <a href="http://demo.kodicms.ru/backend/plugins/repo">backend</a> . <br><br>  In the next article I would like to tell about the device of one of the modules or several modules, either to show an example of the implementation of a simple site or describe the capabilities of the section " <a href="http://demo.kodicms.ru/backend/datasources%3Fds_id%3D2">Hybrid Data</a> ". <br><br>  In general, if you are interested in learning something, write, I will try to tell you. </div><p>Source: <a href="https://habr.com/ru/post/240781/">https://habr.com/ru/post/240781/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../240767/index.html">mod_proctitle - Apache module for displaying requests and brief statistics in the program name (output of top and ps)</a></li>
<li><a href="../240769/index.html">Overview of JPA-RS New Features in EclipseLink</a></li>
<li><a href="../240773/index.html">Atom - TypeScript implementation</a></li>
<li><a href="../240775/index.html">Working with a COM port in a web project</a></li>
<li><a href="../240779/index.html">Create your own dojo widgets</a></li>
<li><a href="../240783/index.html">Finger Trees (Part 1. Introduction)</a></li>
<li><a href="../240785/index.html">Simple Rest Api framework based on Phalcon</a></li>
<li><a href="../240787/index.html">Web application - well, almost without a back-end: Flask, Redis, API via JSONP, JSFiddle.net</a></li>
<li><a href="../240789/index.html">CleverStyle CMS module architecture</a></li>
<li><a href="../240791/index.html">Russian translation Apple iPhone Developer Program License Agreement + Schedule 2 v19</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>