<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introducing the Realtek RTL8954C debug card</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Taiwanese company Realtek is known to numerous PC users for its network (Ethernet) and wireless (WiFi) card controllers, as well as for AC97 audio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introducing the Realtek RTL8954C debug card</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/d3f/39c/1aa/d3f39c1aad0f493c99d1a8f8e23d8590.jpg"><br>  The Taiwanese company Realtek is known to numerous PC users for its network (Ethernet) and wireless (WiFi) card controllers, as well as for AC97 audio codecs.  However, Realtek has processors not only for PC applications, but also for network equipment. <br><br>  In this article, we will introduce the debugging board and the Realtek RTL8954C network processor, build and run the base Linux kernel, and also perform a test of the throughput of the Ethernet ports. <br><a name="habracut"></a><br>  The title picture shows the Realtek debug board for the RTL8954C processor, we used it in several projects for developing LAN / WAN / WiFi subscriber routers with support for VoIP telephony. <br><br><div class="spoiler">  <b class="spoiler_title">Technical parameters of CPU Realtek RTL8954C:</b> <div class="spoiler_text">  ‚Ä¢ SOC <br>  - Embedded CPU, MIPS architecture, frequency up to 620 MHz with built-in Radiax technology 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ‚Ä¢ L2 functions <br>  - 6 Gigabit Ethernet MAC switch with five IEEE 802.3 10/100 / 1000Mbps transmitters <br>  - 1 dedicated GMII / RGMII / MII port for connecting to an external network <br>  - VLAN support (VLAN table for 4096 value) <br><br>  ‚Ä¢ L3 functions <br>  - 8 simultaneous PPPoE sessions <br>  - Automatic PPPoE configuration <br>  - Automatic verification and generation of IPv4 checksums <br><br>  ‚Ä¢ L4 functions <br>  - NAPT support for TCP / UDP protocols <br>  - Automatic verification and generation of TCP / UDP checksums <br>  - Automatic operation of L4 TCP / UDP, check generation of checksums <br><br>  ‚Ä¢ Firewall features <br>  - Creating filters Ethernet, PPPoE, TCP, UDP, ICMP, and IGMP protocols <br><br>  ‚Ä¢ QoS (Quality of Service) <br>  - Each port supports 6-level traffic priority system.  The traffic priority can be provided by the following technologies: based on Port, 802.1p tag, DSCP, ACL-based priority and NAT-based priority <br>  - Serial Peripheral Interfaces <br>  - Supports one PCI Express Host and one PCI Express Slave <br>  - Built-in 2 PCI Express PHYs <br>  - 1 USB 2.0 host controller for accessing USB peripherals <br>  - Built in 1 USB PHY <br>  - 2 16550 UART <br>  - Up to 44 GPIO pins <br><br>  ‚Ä¢ Memory-interface <br>  - Serial Flash (SPI type) <br>  - SDR DRAM <br>  - DDR1 DRAM <br>  - DDR2 DRAM <br>  - I2S interface <br></div></div><br><br><h4>  Board kit Realtek RTL8954C </h4><br>  Starting development, we signed NDA with Realtek and got access to Realtek SDK for RTL8954C.  With the help of this SDK it was possible to build the linux-2.6.30 kernel and the base rootfs without any problems.  The whale is pictured below: <br><br><img src="https://habrastorage.org/files/b38/ef9/603/b38ef9603768499195767abae0c02ed3.png"><br><br>  We list the main components of the board (line by line, from left to right): <br><ol><li>  Connector for DECT module </li><li>  Ethernet LED Indication Panel </li><li>  VOIP LED Display Panel (V400 / 401) </li><li>  PCI Express (IOH) slot </li><li>  JTAG male plug </li><li>  WIFI module </li><li>  Whip Plug (UART) </li><li>  RTL8954C processor </li><li>  DECT button </li><li>  WPS button </li><li>  Reset button to default </li><li>  Module LE88221 - SLIC with two FXS ports </li><li>  FXS1 connector </li><li>  FXS0 connector </li><li>  Connector for external power supply DC 12V (Power) </li><li>  USB drive connector </li><li>  Connectors for 4 LAN ports </li><li>  WAN port connectors </li></ol><br>  Here are the features that were incorporated in the Realtek SDK: <br><ul><li>  OS Linux-2.6.30 </li><li>  Toolchain rsdk-1.3.6-5281-EB-2.6.30-0.9.30 </li><li>  SDK for implementing VOIP functionality </li><li>  A small set of popular OpenSource software, including Samba </li></ul><br>  So, let's proceed to the assembly of the full firmware for the Realtek RTL8954C card.  To successfully complete this task, we need: <br><br>  1. Install on the Debian7 PC system. <br><br>  2. Copy the archive from the Realtek SDK to the user directory: <br><pre><code class="bash hljs">sudo cp rtl89xxc-jungle-VoIP-1.6.1_20120711.tgz ~/</code> </pre> <br>  3. Run the unzip SDK: <br><pre> <code class="bash hljs">tar -zxf rtl89xxc-jungle-VoIP-1.6.1_20120711.tgz</code> </pre><br>  4. Configure the configuration file to build the firmware: <br><pre> <code class="bash hljs">d SDK d rtl89xxc-jungle-VoIP-1.6.1 make menuconfig</code> </pre><br>  Perform configuration of the assembled firmware as described below (see screenshots): <br><pre> <code class="bash hljs">Please select blow items: Selected Target (rtl89xxC) ---&gt; Selected Kernel (linux-2.6.30) ---&gt; Selected Busybox (busybox-1.13) ---&gt; Selected toolchain (rsdk-1.3.6-5281-EB-2.6.30-0.9.30) ---&gt; Selected Board Configuration (V400_Ramfs + VE890HV_2S1O + 92C + SAMBA) ---&gt; [*] Config kernel [*] Load default settings &lt;Exit&gt;&lt;Save&gt; Do you wish to save your new configuration? &lt;ESC&gt;&lt;ESC&gt; to <span class="hljs-built_in"><span class="hljs-built_in">continue</span></span>. Please select &lt;Yes&gt;.</code> </pre><br><br><img src="https://habrastorage.org/files/a6a/633/14e/a6a63314e5ed417b98e490572c25a802.png"><br><br><pre> <code class="bash hljs">RTK VoIP Suite ---&gt; EV_Board version (RTL8954C_V400) ---&gt; &lt;Exit&gt;&lt;Save&gt;</code> </pre><br><br><img src="https://habrastorage.org/files/eeb/b4f/8cf/eebb4f8cfbd644d08c5c284cffa746f9.png"><br><br>  Build the firmware: <br><pre> <code class="bash hljs">make all</code> </pre><br>  5. In the image folder, if the process was successful, there will be fw.bin files, webpages.bin <br><br>  6. Copy the firmware files to the tftp server directory on the PC: <br><pre> <code class="bash hljs">cp ~/SDK/ rtl89xxc-jungle-VoIP-1.6.1/image/fw.bin /srv/tftp cp ~/SDK/ rtl89xxc-jungle-VoIP-1.6.1/image/webpages.bin /srv/tftp</code> </pre><br>  The following programs should be installed on the PC: <br>  A) tftp-hpa - a Linux TFTP client program, installing on Linux using the command: <br><pre> <code class="bash hljs">apt-get install tftp-hpa</code> </pre><br>  B) tftpd-hpa - Linux TFTP server program, installation on Linux using the command: <br><pre> <code class="bash hljs">apt-get install tftpd-hpa</code> </pre><br><h4>  Realtek RTL8954C firmware </h4><br>  1. Connect the UART to the board as shown in the screenshot below. <br>  The connection program is minicom (startup command: minicom ‚Äìs) <br><br><img src="https://habrastorage.org/files/137/851/cf3/137851cf302e4b8a9448bdf39468b12a.png"><br><br>  2. On the board, the bootloder loader program is running by default, not u-boot.  To work with the network, the default address is 192.168.1.6/24.  To update the firmware, you need to configure the address from the 192.168.1.1/24 subnet on the PC and connect the PC and our board to the switch. <br><br>  3. Power on the board and press ‚ÄúESC‚Äù immediately from the terminal. <br><br>  4. Write the firmware to the board from the PC using the commands: <br><pre> <code class="bash hljs">d /srv/tftp tftp 192.168.1.6 -m binary -cp fw.bin</code> </pre><br>  After recording the firmware, the board will reboot, then you need to press the "ESC" button from the terminal and flash the web interface for the board <br><pre> <code class="bash hljs">tftp 192.168.1.6 -m binary -cp webpages-gw.bin</code> </pre><br>  5. Restart the board by turning the power off and on. <br><br>  The result of the firmware board: <br>  A) Minicom access to the loaded system for working with files: <br><br><img src="https://habrastorage.org/files/2af/862/0ec/2af8620ec9a84507ae74016136d83300.png"><br><br>  B) Access to the web interface of the board: <br><br><img src="https://habrastorage.org/files/75b/7d6/00f/75b7d600f0d84481a81def3401759dad.png"><br><br><h4>  Testing the data transfer rate on the Realtek RTL8954C board on the LAN and WAN interface </h4><br>  Now let's see what this motherboard can do in terms of network performance.  Some network routers perform part of the LAN / LAN and LAN / WAN data transfer operations in software, which is why performance problems arise.  Below, we give one test of network performance using a portable network analyzer of Ethernet traffic and two tests of the speed of transferring data from PC to PC. <br><br><h5>  Network performance test (LAN Bridge, NAT) based on a portable Ethernet network traffic analyzer </h5><br>  Objective: To test the throughput of RTL8954C in packets of various sizes using a traffic generator. <br><br>  Tasks: <br><ol><li>  Connect to the RTL8954C board a traffic generation and measurement device. </li><li>  Conduct a series of stress tests. </li><li>  Fill in the table. </li></ol><br>  These are the results we got: <br><br>  <b>Performance Measurement (Throughput: LAN Bridge)</b> <br><table border="1" width="511"><tbody><tr><td><p>  Package size (bit) </p><br><p>  Package Type: TCP </p><br></td><td><p>  Packets Received </p><br><p></p><br></td><td><p>  Accepted Mbps </p><br><p></p><br></td></tr><tr><td><p>  1500 </p><br></td><td><p>  5317251 </p><br><p></p><br></td><td><p>  RX Framed Rate 986.829 Mbps </p><br><p>  RX Data Rate 948.671 Mbps </p><br><p>  RX Utilization 99.999% (1000.000 Mbit / s) </p><br></td></tr><tr><td><p>  1024 </p><br></td><td><p>  5375917 </p><br><p></p><br></td><td><p>  RX Framed Rate 980.830 Mbps </p><br><p>  RX Data Rate 925.275 Mbps </p><br><p>  RX Utilization 99.999% (1000.000 Mbit / s) </p><br></td></tr><tr><td><p>  512 </p><br></td><td><p>  12601894 </p><br><p></p><br></td><td><p>  RX Framed Rate 962.393 Mbps </p><br><p>  RX Data Rate 853.372 Mbps </p><br><p>  RX Utilization 99.999% (1000.000 Mbit / s) </p><br></td></tr><tr><td><p>  88 </p><br></td><td><p>  43111510 </p><br><p></p><br></td><td><p>  RX Framed Rate 814.804 Mbps </p><br><p>  RX Data Rate 277.774 Mbps </p><br><p>  RX Utilization 99.999% (1000.000 Mbit / s) </p><br></td></tr></tbody></table><br>  <b>Conclusion: the</b> test revealed a maximum performance of 948.67 Mbit / s with a frame size of 1500 bytes. <br><br>  <b>Performance Measurement (Throughput: LAN to WAN (NAT))</b> <br><table border="1" width="511"><tbody><tr><td><p>  Package size (bit) </p><br><p>  Package Type: UDP </p><br></td><td><p>  Packets Received </p><br><p></p><br></td><td><p>  Accepted Mbps </p><br><p></p><br></td></tr><tr><td><p>  1500 </p><br></td><td><p>  4957253 </p><br><p></p><br></td><td><p>  RX Framed Rate 986.829 Mbps </p><br><p>  RX Data Rate 956.57 Mbps </p><br><p>  RX Utilization 100.00% (1000.000 Mbit / s) </p><br></td></tr><tr><td><p>  1024 </p><br></td><td><p>  8078375 </p><br><p></p><br></td><td><p>  RX Framed Rate 980.83 Mbps </p><br><p>  RX Data Rate 936.77 Mbps </p><br><p>  RX Utilization 100.00% (1000.000 Mbit / s) </p><br></td></tr><tr><td><p>  512 </p><br></td><td><p>  5869635 </p><br><p></p><br></td><td><p>  RX Framed Rate 962.39 Mbps </p><br><p>  RX Data Rate 875.93 Mbps </p><br><p>  RX Utilization 100.00% (1000.000 Mbit / s) </p><br></td></tr><tr><td><p>  88 </p><br></td><td><p>  8505488 </p><br><p></p><br></td><td><p>  RX Framed Rate 814.80 Mbps </p><br><p>  RX Data Rate 277.77 Mbps </p><br><p>  RX Utilization 100.00% (1000.000 Mbit / s) </p><br></td></tr></tbody></table><br>  <b>Conclusion: the</b> test revealed a maximum performance of 956.57 Mbit / s with a frame size of 1500 bytes. <br><br><h5>  LAN Test - LAN </h5><br>  Tasks: <br><ol><li>  Connect 2 PCs with 1 Gbit Ethernet network cards to the LAN0 (IP_ADDR PC1 192.168.1.1) and LAN1 (IP_ADDR PC2 192.168.1.2) card ports. </li><li>  On PC1, start the Iperf server: <pre> <code class="bash hljs">iperf ‚Äìs</code> </pre></li><li>  On PC2, start the Iperf client: iperf ‚Äìc 192.168.1.1 ‚Äìi 1 </li></ol><br>  The result of the program will be the speed of data transfer between the ports. <br><br>  Test results: <br><br><img src="https://habrastorage.org/files/32a/6cb/284/32a6cb2848864f4ebb485ec2e16e6539.png"><br><br><h5>  LAN Test - WAN </h5><br>  Tasks: <br><br><ol><li>  Connect 2 PCs with 1 Gbit Ethernet network cards to the LAN0 (IP_ADDR PC1 192.168.1.1) and WAN (IP_ADDR PC2 192.168.2.2) card ports. </li><li>  Configure routing paths on PC1 and PC2, respectively: default route (Lan IP boards 192.168.1.254) and default route (Wan IP boards 192.168.2.1) </li><li>  On PC1 run the iperf client: <br><pre> <code class="bash hljs">iperf ‚Äì  192.168.2.2 ‚Äìi 1</code> </pre></li><li>  On PC2, start the iperf server: <br><pre> <code class="bash hljs">iperf ‚Äìs</code> </pre></li></ol><br>  The result of the program will be the speed of data transfer between the ports. <br><br>  Test results: <br><br><img src="https://habrastorage.org/files/d3e/51e/a3b/d3e51ea3b5ee4ec39d73d66954c4ea13.png"><br><br>  The most interesting thing is that the processor load for all tests is almost zero.  Those.  everything is done by hardware, see screenshot: <br><br><img src="https://habrastorage.org/files/7ec/38a/a87/7ec38aa8742548819890204953c1bf5e.png"><br><br>  Thus, we received a fee for developing and debugging software for network and multimedia tasks. <br><br>  Thanks for attention! <br><br>  If you are interested in reading about ‚Äúpinging‚Äù another processor from the Taiwanese team Realtek - read our article ‚Äú <a href="http://habrahabr.ru/company/promwad/blog/202178/">Launching Linux on the Realtek RTL-1185 media processor</a> ‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/250733/">https://habr.com/ru/post/250733/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250723/index.html">Ara, yes? Or the modular smartphone of the future</a></li>
<li><a href="../250725/index.html">Results of testing algorithms of Russian biometric companies in the world market</a></li>
<li><a href="../250727/index.html">DIY Math Package for Android</a></li>
<li><a href="../250729/index.html">How to simplify the verification of a bank card holder for online payments?</a></li>
<li><a href="../250731/index.html">JMeter: Forget Beanshell Sampler</a></li>
<li><a href="../250735/index.html">What DDoS protection services do not negotiate or why protection does not work</a></li>
<li><a href="../250743/index.html">Weekly assembly Vivaldi 1.0.105.7</a></li>
<li><a href="../250745/index.html">The story of one failure (the development of the first mobile game) with conclusions and tips</a></li>
<li><a href="../250749/index.html">Where do the security gaps come from?</a></li>
<li><a href="../250753/index.html">How Linux works with memory. Yandex Workshop</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>