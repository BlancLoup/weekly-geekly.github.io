<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Haskell Code Generator</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago I decided to experiment with Haskell microservices. The project architecture involves the creation of a large number of micro-projects, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Haskell Code Generator</h1><div class="post__text post__text-html js-mediator-article">  Some time ago I decided to experiment with Haskell microservices.  The project architecture involves the creation of a large number of micro-projects, each of which is responsible for one small volume of tasks.  After some time, I was bored with creating these projects manually, as well as writing template code for each entity from the database.  To solve this problem, I developed a small <a href="https://github.com/dbushenko/trurl">utility</a> that allows you to generate template code.  Under the cut - more. <br><a name="habracut"></a><br><br><img src="https://habrastorage.org/getpro/habr/post_images/20c/4da/c2d/20c4dac2d3285b32f1423518c1c1e775.jpg" alt="image" align="left">  In principle, the code generators around are a dime a dozen, but they are all specific and, as a rule, are designed for one particular language or even a project in that language.  Of course, looking at how easy it is to generate code for entities, for example, in Ruby on Rails, you begin to really envy the rubists.  Among the Haskell packages, I found only two more or less worthwhile code generator: <a href="https://github.com/fujimura/hi">Hi</a> and <a href="https://github.com/tfausak/haskeleton">Haskeleton</a> . <br><br>  Hi is able to generate the code of the whole project, which is very cool.  But this little spoon of honey is generously diluted with a barrel of tar.  In order to generate the project code, you need to pass the Hi link to the URL of the project template that you still need to find somewhere.  Each time, Hi will download the templates from this link, instead of downloading the downloaded ones.  Hi supports only a few variables for substitution: package-name, moduleName, author, email, and this is a complete file. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Haskeleton is a fancy design pattern for Hi, very well <a href="http://taylor.fausak.me/2014/03/04/haskeleton-a-haskell-project-skeleton/">thought out</a> .  It even incorporates the Haskeleton.hs utility, which allows you to create empty modules and insert imports of these modules into all suitable places.  However, empty modules are not what I need. <br><br>  The requirements that I imposed on the code generator were the following: <br><br><ul><li>  Global and local repositories.  I would like to download templates once or occasionally, but certainly not every time you generate something.  I would also like to be able to create my templates in the local repository without having to download them somewhere outside. </li><li>  Ability to generate template code for entities.  For example, for the Article table, generate all the code that can extract / save data into this table, represent it in JSON format, etc.  - in short, generate a model code. </li><li>  Ability to generate the entire project code, as Hi can do.  In the process of generating a project code, be able to use arbitrary templates, as Hi cannot.  Those.  use not only predefined variables, but any, including nested objects, and lists. </li></ul><br>  Based on these requirements and the availability of ready-made Haskell libraries, I chose the hastache package for Mustache's template code, as well as aeson, so that the parameters to the template can be transferred in JSON format. <br><br>  The local template repository is located in the ~ / .trurl / repo directory, where all the templates of entities and projects downloaded from the global <a href="">repository are</a> added.  The project template is a tarball.  An entity template is just a file.  For example, suppose there is a file myentity.hs with the following template code: <br><br><pre><code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> {{</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entityName</span></span></span><span class="hljs-class">}} = {{</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entityName</span></span></span><span class="hljs-class">}}{{#</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">props</span></span></span><span class="hljs-class">}} {{</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">}}{{/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">props</span></span></span><span class="hljs-class">}} insert{{</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entityName</span></span></span><span class="hljs-class">}} :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Pool</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Connection</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Maybe</span></span></span><span class="hljs-class"> {{</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entityName</span></span></span><span class="hljs-class">}} -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ActionT</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Text</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IO</span></span></span><span class="hljs-class"> () insert{{</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entityName</span></span></span><span class="hljs-class">}} _ </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Nothing</span></span></span><span class="hljs-class"> = return () insert{{</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entityName</span></span></span><span class="hljs-class">}} pool (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Just</span></span></span><span class="hljs-class"> ({{</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entityName</span></span></span><span class="hljs-class">}} </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_</span></span></span><span class="hljs-class">{{#</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">props</span></span></span><span class="hljs-class">}} {{</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">}}{{/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">props</span></span></span><span class="hljs-class">}})) = do liftIO $ execSqlT pool [{{#</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">props</span></span></span><span class="hljs-class">}}(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">show</span></span></span><span class="hljs-class"> {{</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">}}){{^</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">last</span></span></span><span class="hljs-class">}}, {{/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">last</span></span></span><span class="hljs-class">}}{{/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">props</span></span></span><span class="hljs-class">}}] "</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">INSERT</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">INTO</span></span></span><span class="hljs-class"> {{</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entityName</span></span></span><span class="hljs-class">}}({{#</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">props</span></span></span><span class="hljs-class">}}{{</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">}}{{^</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">last</span></span></span><span class="hljs-class">}}, {{/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">last</span></span></span><span class="hljs-class">}}{{/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">props</span></span></span><span class="hljs-class">}}) </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VALUES</span></span></span><span class="hljs-class">({{#</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">props</span></span></span><span class="hljs-class">}}?{{^</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">last</span></span></span><span class="hljs-class">}},{{/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">last</span></span></span><span class="hljs-class">}}{{/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">props</span></span></span><span class="hljs-class">}})" return ()</span></span></code> </pre> <br>  Run the trurl with the following parameters: <br><br>  trurl new Article myentity '{"entityName": "Article", "props": [{"name": "title", "type": "String"}, {"name": "body", "type": "String"}, {"name": "year", "type": "Integer", "last": true}]} ' <br><br>  As a result, we get the following code: <br><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Article</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Article</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Integer</span></span></span><span class="hljs-class"> insertArticle :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Pool</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Connection</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Maybe</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Article</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ActionT</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Text</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IO</span></span></span><span class="hljs-class"> () insertArticle _ </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Nothing</span></span></span><span class="hljs-class"> = return () insertArticle pool (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Just</span></span></span><span class="hljs-class"> (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Article</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">body</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">year</span></span></span><span class="hljs-class">)) = do liftIO $ execSqlT pool [(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">show</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">), (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">show</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">body</span></span></span><span class="hljs-class">), (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">show</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">year</span></span></span><span class="hljs-class">)] "</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">INSERT</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">INTO</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Article</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">body</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">year</span></span></span><span class="hljs-class">) </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VALUES</span></span></span><span class="hljs-class">(?,?,?)" return ()</span></span></code> </pre><br>  Similarly, you can generate and template projects using the create command.  The truth here is to follow the following rules: <br><br><ul><li>  All files that need to be renamed according to the project name must be named ‚ÄúProjectName‚Äù. </li><li>  All mustache template files in a template project must have the extension ".template". </li><li>  You can transfer any JSON parameters to mustache templates, as well as to templates of individual files created by the new command.  At the same time, at least one parameter will always be available, even if you don‚Äôt send JSON at all.  This is the ProjectName string containing the project name. </li></ul><br>  In order to download all available templates from the global repository, you must run the command "trurl update". <br><br>  Using the ‚Äútrurl list‚Äù command you can get a list of all available templates. <br><br>  The "trurl help [template]" command will show a hint on how to use the specified template. <br><br>  The "trurl new [newfilename] [file_template] [json_params]" command is designed to generate exactly one file. <br><br>  The "trurl create [newprojname] [project_template] &lt;json_params&gt;" command is intended to generate a whole project, JSON parameters are not required here. <br><br>  Currently, only a few templates are available for trurl in the global repository.  These are templates for my micro services (scotty-mysql and scotty entity), and haskeleton, which I added at the request of one of the users of the trurl.  You can create your templates, just send me a pull-request at <a href="https://github.com/dbushenko/trurl/tree/master/devrepo">github.com/dbushenko/trurl/tree/master/devrepo</a> , and I will add them to the master repository. <br><br>  The trurl project is young and therefore not without flaws.  It is not always convenient to transfer long JSON strings to generate entities, not any template can be generated using mustache, the main template repository is not very conveniently arranged.  All of these are directions for improvements that I actively pursue and will be glad if others join me. <br><br>  And the last.  I chose the name trurl in honor of the space designer Trurl from the works of Stanislav Lem "The seven journeys of Truer and Klapautsiya", it was you who saw the portrait of Trurl at the beginning of the article. </div><p>Source: <a href="https://habr.com/ru/post/260239/">https://habr.com/ru/post/260239/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260225/index.html">Vulnerability in Mail in iOS 8.3</a></li>
<li><a href="../260227/index.html">9 anti-patterns every programmer should know about</a></li>
<li><a href="../260229/index.html">The digest of interesting materials for the mobile developer # 107 (on June 8-14)</a></li>
<li><a href="../260233/index.html">When does not help the DAC. Digital potentiometers in detail. Part one</a></li>
<li><a href="../260237/index.html">Problems mounting CIFS clients when upgrading samba on the server</a></li>
<li><a href="../260249/index.html">Programmers and Depression</a></li>
<li><a href="../260253/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ164 (June 8 - 14, 2015)</a></li>
<li><a href="../260255/index.html">"Big battalions" in continuous time (battle simulation)</a></li>
<li><a href="../260257/index.html">PHP Digest 64 - interesting news, materials and tools (June 1 - 14, 2015)</a></li>
<li><a href="../260259/index.html">Ingredients of IoT Fast Food Delicacies: Intel Edison + Intel XDK + JavaScript + Grove Kit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>