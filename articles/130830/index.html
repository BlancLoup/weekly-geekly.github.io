<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Functional thinking: Thinking functionally, Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first part of the series, I began a discussion of some features of functional programming, showing the manifestations of these ideas in Java an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Functional thinking: Thinking functionally, Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/43f22036/f77a6fe8/3a45d204/e3063ea6.png"><br>  In the <a href="http://habrahabr.ru/blogs/programming/128063/">first part of the</a> series, I began a discussion of some features of functional programming, showing the manifestations of these ideas in Java and other more functional languages.  In this article I will continue my review, paying attention to the functions - first-class objects, optimization and closure.  But the main topic of this article is control: when you want it, when you need it and when you just need to score. <br><a name="habracut"></a><br><h4>  First-class functions and control </h4><br>  Using the Functional Java library, last time I demonstrated the implementation of a number classifier with the isFactor () and factorsOf () methods written in functional style, as shown in Listing 1: <br><br>  <b>Listing 1. Functional version of the number classifier</b> <br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> fj.F; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> fj.data.List; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> fj.data.List.range; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> fj.function.Integers.add; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> java.lang.Math.round; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> java.lang.Math.sqrt; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FNumberClassifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isFactor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> potential_factor)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> number % potential_factor == <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Integer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">factorsOf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, number+<span class="hljs-number"><span class="hljs-number">1</span></span>).filter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> F&lt;Integer, Boolean&gt;() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Integer i)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> number % i == <span class="hljs-number"><span class="hljs-number">0</span></span>; } }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Integer&gt; factors)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> factors.foldLeft(fj.function.Integers.add, <span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPerfect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sum(factorsOf(number)) - number == number; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAbundant</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sum(factorsOf(number)) - number &gt; number; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isDeficiend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sum(factorsOf(number)) - number &lt; number; } }</code> </pre> <br>  In the <code>isFactor()</code> and <code>factorOf()</code> methods, I delegated the traversal algorithm to the framework, which itself decides how best to bypass the range of numbers.  If the framework (or the language itself, if you use for example the functional languages ‚Äã‚ÄãClojure and Scala) is able to optimize the underlying implementation, then you automatically benefit from it.  And although at first you will not want to shift this functionality onto other people's shoulders, still note that this follows a basic trend in programming languages ‚Äã‚Äãand environments.  Over time, the developer is increasingly abstracting from parts that the platform can handle more efficiently.  I never care about memory management in the JVM, because the platform allows me to forget about it.  Of course, at times, this makes some things more complicated, but it‚Äôs a good compromise for the benefits you get in everyday writing.  Constructions of a functional language, such as: higher-order functions and functions ‚Äî objects, allow me to rise one more step higher in the abstraction ladder and focus on what the code should do, and not how it should do it. <br><br>  Even with the Functional Java framework, programming in this style in Java looks awkward, because the language doesn't actually have the necessary syntax and constructs.  How is the functional approach implemented in the languages ‚Äã‚Äãmeant for it? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Classifier in Clojure </h5><br>  Clojure is a functional Lisp designed for the JVM.  Take a look at the Clojure number classifier - Listing 2 <br><br>  <b>Listing 2. Clojure implementation of the number classifier</b> <br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">ns</span></span> nealford.perfectnumbers) (<span class="hljs-name"><span class="hljs-name">use</span></span> '[clojure.contrib.import-static <span class="hljs-symbol"><span class="hljs-symbol">:only</span></span> (<span class="hljs-name"><span class="hljs-name">import-static</span></span>)]) (<span class="hljs-name"><span class="hljs-name">import-static</span></span> java.lang.Math sqrt) (<span class="hljs-name"><span class="hljs-name">defn</span></span> is-factor? [factor number] (<span class="hljs-name"><span class="hljs-name">=</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-name"><span class="hljs-name">rem</span></span> number factor))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> factors [number] (<span class="hljs-name"><span class="hljs-name">set</span></span> (<span class="hljs-name"><span class="hljs-name">for</span></span> [n (<span class="hljs-name"><span class="hljs-name">range</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">inc</span></span> number)) <span class="hljs-symbol"><span class="hljs-symbol">:when</span></span> (<span class="hljs-name"><span class="hljs-name">is-factor</span></span>? n number)] n))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> sum-factors [number] (<span class="hljs-name"><span class="hljs-name">reduce</span></span> + (<span class="hljs-name"><span class="hljs-name">factors</span></span> number))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> perfect? [number] (<span class="hljs-name"><span class="hljs-name">=</span></span> number (<span class="hljs-name"><span class="hljs-name">-</span></span> (<span class="hljs-name"><span class="hljs-name">sum-factors</span></span> number) number))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> abundant? [number] (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> number (<span class="hljs-name"><span class="hljs-name">-</span></span> (<span class="hljs-name"><span class="hljs-name">sum-factors</span></span> number) number))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> deficient? [number] (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> number (<span class="hljs-name"><span class="hljs-name">-</span></span> (<span class="hljs-name"><span class="hljs-name">sum-factors</span></span> number) number)))</code> </pre><br>  The best part of Listing 2 is simple enough to understand, even if you are not a harsh Lisp developer, and especially if you can learn to read inside out.  For example, the <code>is-factor?</code> method <code>is-factor?</code>  It accepts two parameters and checks for equality to zero of the remainder of the division after multiplying the number by factor.  Like this <code>perfect?</code> methods <code>perfect?</code>  , <code>abundunt?</code>  and <code>deficient?</code>  should also be easy to understand, especially if you look at Listing 1 with a Java implementation. <br><br>  The <code>sum-factor</code> method uses the built-in <code>reduce</code> method.  <code>sum-factor</code> reduces the list by one element, using the function (in this case, +), taken by the first parameter above each element.  The reduce method is represented in various forms in individual programming languages ‚Äã‚Äãand frameworks.  In Listing 1, you saw it as <code>foldLeft()</code> .  The factors method returns a list of numbers, so I process elements by element, making up the sum returned from the reduce method from numbers.  You can see that once you get used to thinking in terms of higher order functions and functions ‚Äî first class objects ‚Äî you can get rid of a lot of noise in your code. <br><br>  The <code>factors()</code> method may seem like a bunch of random characters.  But it can immediately be understood if you once saw list conversions (lists <i>comprehensions</i> ) being one of several powerful features of Clojure.  As before, it is easiest to understand the factors method from the inside out.  Do not be confused by the terminating language terminology.  Clojure's for keyword does not imply a for loop.  Think rather of this as the ancestor of all filtering and transforming structures.  In this case, I call it to filter the range of numbers from 1 to (number + 1) using the <code>is-factor?</code> predicate <code>is-factor?</code>  that returns numbers that satisfy the condition.  The output of this operation is a list of numbers that satisfy my criterion, which I transform into a set (set) to remove repetitions. <br><br>  You get a lot of really cool things from functional languages ‚Äã‚Äãwith an understanding of their specifics and features, despite the initial difficulties in learning. <br><br><h5>  Optimization </h5><br>  One of the advantages of moving to a functional style is the ability to use higher-order functions provided by a language or framework.  But what if you don‚Äôt want to give up this control?  In my earlier example, I compared the internal behavior of the iterative mechanism with the work of the memory manager: most of the time, it's easier for you not to worry about these details.  But sometimes you care about it, as is the case with optimization and others like it. <br><br>  In the two Java versions of the number classifier, which I showed in the first part, I optimized the code that defines the divisors.  The initial simple implementation used a modulus operator (%), which is wildly inefficient to check all numbers from 2 to a given number to check if it is a divisor.  You can optimize this algorithm by noting that dividers are always found in pairs.  For example, if you are looking for dividers 28, then when you find 2, you can also take and 14. If you collect dividers in pairs, you only need to check numbers down to the square root of a given number. <br><br>  Optimization that was easy to do in the Java version seems impossible in Functional Java due to the fact that I do not directly control iteration.  However, the path to functional thinking requires us to abandon this type of control, allowing us to master others. <br><br>  I can reformulate the original problem in a functional style: filter all dividers from 1 to a given number, leaving only those that satisfy the isFactor predicate.  This is done in Listing 3: <br><br>  <b>Listing 3. The isFactor () method</b> <br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> List&lt;<span class="hljs-type"><span class="hljs-type">Integer</span></span>&gt; factorsOf(final <span class="hljs-type"><span class="hljs-type">int</span></span> number) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, number+<span class="hljs-number"><span class="hljs-number">1</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> F&lt;<span class="hljs-type"><span class="hljs-type">Integer</span></span>, <span class="hljs-type"><span class="hljs-type">Boolean</span></span>&gt;() { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">Boolean</span></span> f(final <span class="hljs-type"><span class="hljs-type">Integer</span></span> i) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> number % i == <span class="hljs-number"><span class="hljs-number">0</span></span>; } }); }</code> </pre><br>  Despite its elegance, the code in Listing 3 is not very efficient as it checks every number.  However, by understanding the optimization (to collect dividers in pairs from 1 to square root), I can reformulate the problem: <br><ol><li>  Filter all numbers from 1 to the square root of the given number. </li><li>  Divide the given number into each of these divisors to get a pair divider and add it to the list of divisors. </li></ol><br>  With this algorithm, I can write an optimized version of the factorsOf () method using the Functional Java library, as shown in Listing 4: <br><br>  <b>Listing 4. Optimized factors-finding method</b> <br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> List&lt;<span class="hljs-type"><span class="hljs-type">Integer</span></span>&gt; factorsOfOptimzied(final <span class="hljs-type"><span class="hljs-type">int</span></span> number) { List&lt;<span class="hljs-type"><span class="hljs-type">Integer</span></span>&gt; factors = range(<span class="hljs-number"><span class="hljs-number">1</span></span>, (<span class="hljs-type"><span class="hljs-type">int</span></span>) round(sqrt(number)+<span class="hljs-number"><span class="hljs-number">1</span></span>)) .<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> F&lt;<span class="hljs-type"><span class="hljs-type">Integer</span></span>, <span class="hljs-type"><span class="hljs-type">Boolean</span></span>&gt;() { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">Boolean</span></span> f(final <span class="hljs-type"><span class="hljs-type">Integer</span></span> i) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> number % i == <span class="hljs-number"><span class="hljs-number">0</span></span>; }}); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> factors.append(factors.map(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> F&lt;<span class="hljs-type"><span class="hljs-type">Integer</span></span>, <span class="hljs-type"><span class="hljs-type">Integer</span></span>&gt;() { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span> f(final <span class="hljs-type"><span class="hljs-type">Integer</span></span> i) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> number / i; }})) .nub(); }</code> </pre><br>  The code in Listing 4 is based on the algorithm described earlier, with a slightly corrupted syntax required by the Functional Java library.  First, I take a range of numbers starting from 1 to the square root of a given number plus 1 (to be sure that I will get all dividers).  Then, as well as in the previous version, I filter the result using the module operator wrapped in a code block.  I save this filtered result in the <code>factors</code> variable.  Further (if to read from within) I take this list of dividers and execute the <code>map()</code> function, which creates a new list, executing my block of code for each element (mapping each element to a new value).  My divisor list contains all divisors of a given number less than the square root;  now I have to divide the given number into each of them in order to get a list of symmetric dividers and connect it with the original list.  In the last step, I must take into account that I keep the dividers in the list, and not in the set.  The list methods are convenient for manipulations that were performed earlier, but my algorithm has a side effect: one element is repeated twice if a square root appears among the dividers.  For example, if the number is 16, the square root of 4 appears in the list of dividers twice.  In order to continue using the convenient list methods, I must call the <code>nub()</code> method at the end to remove all repetitions. <br><br>  The fact that you give up the knowledge of implementation details when using high-level abstractions like functional programming does not mean that you cannot go back to the little things when necessary.  Java basically protects you from low-level problems, but if you decide you need it, you can go down to the right level.  Also in functional programming - usually the details are easily left on the conscience of abstractions, except for the moments when they turn out to be really important. <br><br>  In all the code that I have cited above, the block syntax visually dominates, which uses generalizations and anonymous nested classes as pseudo blocks of code.  Closures are one of the most common features of functional languages.  What makes them so useful in a functional world? <br><br><h4>  What's so special about closures? </h4><br>  A closure is a function that stores implicit references to the variables it references.  In other words, a function (or method) that captures and preserves the context surrounding it *.  Closures are used quite often as a portable execution engine in functional languages ‚Äã‚Äãand frameworks that are passed to higher-order functions, for example, in map () for transformation.  Functional Java uses anonymous inner classes to simulate some behavior of ‚Äúreal‚Äù closures, but they are not able to provide the full functionality of the latter, because Java does not support closures.  What does this mean? <br><br>  Listing 5 shows an example of what makes closures special.  It is written in Groovy, a language that supports closures directly. <br><br>  <b>Listing 5. Groovy code illustrating closures</b> <br><pre> <code class="hljs scala"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeCounter</span></span></span></span>() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">very_local_variable</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> very_local_variable += <span class="hljs-number"><span class="hljs-number">1</span></span> } } c1 = makeCounter() c1() c1() c1() c2 = makeCounter() println <span class="hljs-string"><span class="hljs-string">"C1 = ${c1()}, C2 = ${c2()}"</span></span> <span class="hljs-comment"><span class="hljs-comment">// output: C1 = 4, C2 = 1</span></span></code> </pre><br>  The <code>makeCouner()</code> method defines a local variable with the appropriate name, and then returns a block of code that uses this variable.  Notice that the <code>makeCounter()</code> method returns a block of code, not a value.  This code does nothing except increase the value of a local variable by 1 and return it.  I explicitly indicated a call to return in this code, which is actually optional in Groovy, but the code without it may seem less clear. <br><br>  To show the <code>makeCounter()</code> method in action, I assigned a reference to the block to the variable <code>c1</code> , then called it 3 times.  I use Groovy syntax sugar to execute a block of code, consisting in placing parentheses after the variable.  Then I call <code>makeCounter()</code> again, assigning a new instance of the code block to the variable <code>C2</code> .  Finally, I run <code>C1</code> again with <code>C2</code> .  Note that each code block refers to a separate instance of the <code>very_local_variable</code> variable.  This is exactly what I had in mind when talking about context capture.  Despite the seeming locality of defining a variable inside a method, the closure is still associated with it and stores the state. " <br><br>  The largest approximation to this behavior implemented in Java is shown in Listing 6: <br><br>  <b>Listing 6. MakeCounter in Java</b> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Counter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> varField; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ varField = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Counter </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeCounter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Counter(<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ++varField; } }</code> </pre><br>  There may be several options for the class Counter, but you still have to face the independent state management.  This shows why the use of closures contributes to functional thinking: it allows the environment to control the state.  Instead of forcing you to control the creation of fields and monitor the state (including the terrifying prospect of using such code in a multithreaded environment), it allows the language or framework to do the work for you. <br><br>  In the end, we will still have closures in the next Java releases (which, fortunately, is beyond the scope of this article).  The appearance of closures in Java will bring a couple of expected results.  Firstly, it will greatly simplify the life of the authors of libraries and frameworks in the work on improving their syntax.  Second, it will provide a low-level ‚Äúcommon denominator‚Äù to support closures in all languages ‚Äã‚Äãthat work in the JVM.  Despite the fact that many JVM languages ‚Äã‚Äãsupport closures, they have to implement their own versions, which makes the transfer of closures between languages ‚Äã‚Äãrather difficult.  If Java itself defines a single format, all other languages ‚Äã‚Äãwill be able to use it effectively. <br><br><h4>  Conclusion </h4><br>  Losing control over low-level details in favor of a language or framework is a general trend in software development.  We happily disclaim responsibility for garbage collection, memory management, and hardware differences.  Functional programming represents a new level of abstraction: concessions to the details of the implementation of the routine functionality for iteration, concurrency, and state management of the environment to the extent possible.  This does not mean that you will not be able to regain control if needed - but you must want it and not be forced. <br><br>  In the next issue, I will continue my journey through functional constructs in Java and its close relatives with a description of currying ( <i>currying</i> ) and <i>partial method application</i> . <br><br><h5>  Notes </h5><br>  * - Here the author seems to be too diligently moving away from academic terminology.  We are talking about free variables in lambda expression.  Good intuition about the behavior of closures in different implementations can be obtained from the <a href="http://fprog.ru/2009/issue3/eugene-kirpichov-elements-of-functional-languages/">article</a> in the TFG.  A fairly clear formal definition of free and bound variables is given in the Wikipedia <a href="http://ru.wikipedia.org/wiki/%25D0%259B%25D1%258F%25D0%25BC%25D0%25B1%25D0%25B4%25D0%25B0-%25D0%25B8%25D1%2581%25D1%2587%25D0%25B8%25D1%2581%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5">article</a> . <br><br>  PS Thank you <a href="https://habrahabr.ru/users/cheatex/" class="user_link">CheatEx</a> for their assistance in translating </div><p>Source: <a href="https://habr.com/ru/post/130830/">https://habr.com/ru/post/130830/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130824/index.html">Training IT specialists in Serbia</a></li>
<li><a href="../130825/index.html">iPhone 4S, Galaxy Nexus - the choice is obvious?</a></li>
<li><a href="../130826/index.html">SQL injection. Check, hacking, protection</a></li>
<li><a href="../130827/index.html">Whitelisting: about technology, its market prospects and utility for the company</a></li>
<li><a href="../130829/index.html">Basics of email targeting and segmentation</a></li>
<li><a href="../130831/index.html">CodeSniffer and PhpEd</a></li>
<li><a href="../130832/index.html">Fifth habrae</a></li>
<li><a href="../130833/index.html">Microsoft and Skolkovo Open University announce a set for the course ‚ÄúTechnological entrepreneurship in IT: From idea creation to product realization‚Äù</a></li>
<li><a href="../130834/index.html">Mobile startups: Habr, you need your opinion!</a></li>
<li><a href="../130835/index.html">There are duplicate windows or ‚ÄúWhy am I not a camel?‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>