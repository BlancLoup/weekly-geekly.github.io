<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integration of 1C and Megaplan or why web services are good</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Habr√© already has many articles about 1C and its ‚Äúbad‚Äù ability to integrate with other systems. And I agree with them, integrating 1C and Megaplan tur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integration of 1C and Megaplan or why web services are good</h1><div class="post__text post__text-html js-mediator-article">  Habr√© already has many articles about 1C and its ‚Äúbad‚Äù ability to integrate with other systems.  And I agree with them, integrating 1C and Megaplan turned out to be a task, far less pleasant than I assumed at the beginning. <br><br>  In the article I will not tell you how to get and set up synchronization through the API using a web service from start to finish.  But I‚Äôll tell you the key moments after which finding the missing information is not a problem. <br><br><h5>  Prehistory </h5><br>  I got into the 1C department in which there was my own, written by employees, configuration for receiving and managing tasks ‚ÄúPM‚Äù.  As time went on, the configuration developed and overgrown with new functionality, and it was no longer possible to abandon it, since it became a single center for receiving and processing tasks, not only of the 1C department, but of all IT departments of the holding (at the time of writing this article, Administrative and economic department and building management department).  The configuration was configured to synchronize with LDAP, all holding databases, automatic notifications via skype, and more. <br><a name="habracut"></a><br><h5>  Story </h5><br>  A deputy technical director was taken, who painted the advantages of Megaplana in paints and convinced the management that it was vital for us to implement it.  After lengthy explanations that we could not refuse ‚ÄúRM‚Äù, I was given the task to synchronize our configuration and Megaplan.  Armed with the lion's share of patience, I began to explore the possibilities and immediately realized that Megaplana has only an API and I need to dig there.  After several days of searching and experimenting, it was clear that only 1C means could not do this. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  This is where the explanation of why web services start is good. </h5><br>  Unfortunately, we already had one web server configured, to which I connected my web service.  For this reason, the setting of the web server itself, I can not tell. <br><br><h6>  Setup part 1: Configure the web service part. </h6><br>  Thanks Megaplan, there are api libraries and even everyone works, so all we need to do is configure only the data models.  As an example, add a comment. <br><br>  We describe the method we will call from 1C <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Marks comment as read * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@access</span></span></span><span class="hljs-comment"> public * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> object $data * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">comment_create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data)</span></span></span><span class="hljs-function"> </span></span>{ $options = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'method'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'post'</span></span>, <span class="hljs-string"><span class="hljs-string">'useHttps'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;send_request(<span class="hljs-keyword"><span class="hljs-keyword">__FUNCTION__</span></span>, $data, $options); }</code> </pre> <br><br>  We describe the model of the method <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> APPPATH.<span class="hljs-string"><span class="hljs-string">'controllers/common/common_types.php'</span></span>; $types = array_merge_recursive( $types, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-comment"><span class="hljs-comment">// api methods 'methods' =&gt; array ( 'comment_create' =&gt; array( 'type' =&gt; 'public', 'returnType' =&gt; 'CommentEditReturn', 'description' =&gt; 'create comment', 'params' =&gt; array( 'data' =&gt; array( 'varName' =&gt; '$data', 'varType' =&gt; 'CommentEditInput', ), ) ), ), // api custom types for api methods 'types' =&gt; array( 'CommentCreateModel' =&gt; array( 'Text' =&gt; 'string', 'Work' =&gt; 'int', 'WorkDate' =&gt; 'string', 'Attaches' =&gt; 'CommentAttachment[]', ), 'CommentAttachment' =&gt; array( 'Add' =&gt; 'CommentAttachmentItem[]', ), 'CommentAttachmentItem' =&gt; array( 'Name' =&gt; 'string', 'Context' =&gt; 'string', ), ), ) );</span></span></code> </pre><br><br>  Next, let's say your web service is visible at your <a href="http://xn--80adhe8ahe2f/api/comments/get_wsdl">domain / api / comments / get_wsdl,</a> and when you go, you see XML describing your web service. <br><br><h6>  Setup part 2: Setup 1C part. </h6><br>  Then we add a web service to our configuration, we open, we look and indeed all the methods that we described are and have not gone away.  I certainly have more method. <br><img src="https://habrastorage.org/storage2/329/64f/537/32964f53777bda49240204184e50e23c.png"><br><br>  And finally, the most fascinating we write code on 1C. <br><br><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">//   (,,=,=)   =.;  = .(.,.,"");  .status.code = "ok"   = WS.WSMegaPlanComments.WS("urn:comments","commentsService","commentsPort");  = .XDTO.(.XDTO.("urn:comments", "CommentEditInput")); .AccessId = .data.AccessId; .SecretKey = .data.SecretKey; .SubjectType="task"; .SubjectId=((),"=0");  = .XDTO.(.XDTO.("urn:comments", "CommentCreateModel")); .Text= XML(); .Work=; .WorkDate=(,"='dd.MM.yyyy hh:mm:ss'"); .Model=;  = .comment_create();  ;   " :     ."; ;   " :"+ . + (); ;  //  (, , )    = WS.WSMegaPlanTasks.WS("urn:tasks","tasksService","tasksPort");  = .XDTO.(.XDTO.("urn:tasks", "AuthorizationData")); .Login = ;  = ""; md5(, ); .Password = ; .OneTimeKey = ;  .authorize();   = ();  " :"+ . + .; ; </span></span></code> </pre><br><br>  Actually everything.  Now it remains only to fasten the function call where you need it and that's it.  Megaplan gets our comments from 1C. </div><p>Source: <a href="https://habr.com/ru/post/179241/">https://habr.com/ru/post/179241/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../179231/index.html">BitTorrent Bundle and Network Marketing</a></li>
<li><a href="../179233/index.html">History of visiting sites through Mikrotik router logs</a></li>
<li><a href="../179235/index.html">Apache Thrift RPC Server. We are friends with C ++ and Java</a></li>
<li><a href="../179237/index.html">Shared laptop with session time limit</a></li>
<li><a href="../179239/index.html">We include Samsung Multi Window in another application</a></li>
<li><a href="../179243/index.html">jQuery EasyUI Datagrid + Yii Framework</a></li>
<li><a href="../179247/index.html">Cone model, with space-time jump</a></li>
<li><a href="../179249/index.html">The US government has blocked the distribution of drawings of the gun, which can be printed on a 3D printer</a></li>
<li><a href="../179253/index.html">There are no "clean" programmers</a></li>
<li><a href="../179255/index.html">BlackBerry MiniJam in Kiev on May 28th</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>