<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SambaCry critical vulnerability: how to protect</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In a popular package for creating network drives on various Samba operating systems, a critical vulnerability was discovered that allows you to gain c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SambaCry critical vulnerability: how to protect</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/company/pt/blog/329558/"><img src="https://habrastorage.org/web/4f4/6f3/dff/4f46f3dff25446bca54877b761d186ff.png"></a> <br><br>  In a popular package for creating network drives on various Samba operating systems, a critical vulnerability was discovered that allows you to gain control over Linux and Unix systems remotely.  The error lasted for 7 years - all versions of the package, starting with Samba 3.5.0, which was released on March 1, 2010, are vulnerable to CVE-2017-7494.  Today we will talk about how to protect against this vulnerability. <br><a name="habracut"></a><br><h2>  Possible consequences of operation </h2><br>  Vulnerability descriptions were published on <a href="https://habrahabr.ru/company/cloud4y/blog/329464/">Habr√©</a> (the exploit code was also <a href="https://github.com/omri9741/cve-2017-7494">published</a> ), so we will not dwell on this in detail.  Suffice it to say that, according <a href="http://thehackernews.com/2017/05/samba-rce-exploit.html%3Fm%3D1">to</a> the Shodan search engine, more than 485,000 thousand computers using Samba are currently available from the Internet.  Researchers at Rapid7 <a href="https://community.rapid7.com/community/infosec/blog/2017/05/25/patching-cve-2017-7494-in-samba-it-s-the-circle-of-life">estimated the</a> share of externally accessible vulnerable systems at 104,000, of which 92,000 computers use unsupported versions of Samba. <br><br>  This major problem affects Synology NAS servers, including: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); width: 500px; margin: 10px auto; max-width: 100%; min-width: 220px;" data-tweet-id="867573719522131968"></twitter-widget><script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  Vulnerable are also a large number of routers and NAS by Netgear, which has published its own <a href="https://kb.netgear.com/000038779/Security-Advisory-for-CVE-2017-7494-Samba-Remote-Code-Execution">security bulletin</a> on this issue. <br><br>  The scale of the problem allowed Cisco security expert Craig Williams (Craig Williams) to announce the threat that the CVE-2017-7494 vulnerability would trigger "the first large-scale epidemic of ransomware worms on Linux systems." <br><br>  In many home routers, Samba is used to organize shared access to USB devices ‚Äî and, as a rule, in such cases, write access is granted to such devices.  Therefore, if the manufacturers of network equipment in their firmware used a visible version of Samba, then this opens up broad opportunities for conducting attacks, for example, to create botnets. <br><br><h2>  How to protect </h2><br>  Samba developers have reported the removal of the vulnerability in the latest versions of the package (4.6.4 / 4.5.10 / 4.4.14) - users are advised to install the <a href="https://www.samba.org/samba/security/CVE-2017-7494.html">patch</a> as soon as possible.  In the event that a transition to a more recent version of the package is not possible, the product creators recommend making changes to the smb.conf configuration file by adding a line to the [global] section: <br><br><pre><code class="bash hljs">nt pipe support = no</code> </pre> <br>  After that, restart the SMB daemon (smbd).  These changes will block the ability of clients to fully access network machines and limit the functionality of connected Windows systems.  Later <a href="https://www.samba.org/samba/patches/">patches</a> were published for older versions of Samba. <br><br>  You can block the possibility of an attack using SELinux policies ‚Äî for example, the default RHEL configuration does not allow attackers to exploit a vulnerability in Samba. <br><br>  GuardiCore has developed a <a href="https://www.guardicore.com/2017/05/samba/">script</a> to detect the attack - to download it you must fill out a form on the site. <br><br>  In turn, the experts of Positive Technologies created a Suricata signature that allows detecting attempts to exploit the CVE-2017-7494 vulnerability in Samba: <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-1" style="position: static; visibility: visible; display: block; transform: rotate(0deg); width: 500px; margin: 10px auto; max-width: 100%; min-width: 220px;" data-tweet-id="867829634242560000"></twitter-widget><script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script></div><br><br>  In addition, to reduce the risk of a successful attack with this error, company experts recommend that public folders only have read permissions, but not write files (you can read how to do <a href="https://www.cyberciti.biz/tips/how-do-i-set-permissions-to-samba-shares.html">this</a> in <a href="https://www.cyberciti.biz/tips/how-do-i-set-permissions-to-samba-shares.html">this manual</a> ).  It can be difficult to find all network folders with write permissions - for this you should use, for example, the nmap tool.  You can see all the ‚Äúballs‚Äù with write permissions using the following command (you need to look at Current user access): <br><br><pre> <code class="bash hljs">nmap --script smb-enum-shares.nse -p445 &lt;host&gt;</code> </pre> <br>  In addition, it is recommended to analyze the access rights to network folders, leaving read and write access to them only for certain trusted users using <a href="http://help.ubuntu.ru/wiki/%25D1%2580%25D1%2583%25D0%25BA%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B4%25D1%2581%25D1%2582%25D0%25B2%25D0%25BE_%25D0%25BF%25D0%25BE_ubuntu_server/%25D1%2581%25D0%25B5%25D1%2582%25D1%258C_windows/securing_samba_servers">checklists</a> . </div><p>Source: <a href="https://habr.com/ru/post/329558/">https://habr.com/ru/post/329558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329546/index.html">To the question of constants</a></li>
<li><a href="../329550/index.html">Oddities of Generic Java Types</a></li>
<li><a href="../329552/index.html">Scrum in the real world. Overview of the meeting for scrum masters</a></li>
<li><a href="../329554/index.html">Open broadcast from the main conference hall of HolyJS 2017 Piter: Douglas Crockford, Lea Verou and someone else</a></li>
<li><a href="../329556/index.html">Comprehensive Automation with Ansible and OpenStack</a></li>
<li><a href="../329560/index.html">Almost manifesto design thinking</a></li>
<li><a href="../329562/index.html">Skit, Core, rock'n'roll: how did DotNext 2017 Piter go</a></li>
<li><a href="../329564/index.html">Multichannel communication in ecommerce or how to complete the quest "abandoned basket"?</a></li>
<li><a href="../329566/index.html">Mobile Dimension has developed a "tablet for the consultants of the trading hall" by order of M.Video</a></li>
<li><a href="../329568/index.html">Undocumented features of Windows: registration of registry key access events</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>