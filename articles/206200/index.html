<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Video calls through the browser - how to make technology work for your company</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Well, it was very interesting to figure out how to make video calls through the browser within the company and how useful it is. Moreover, skype is ‚Äúl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Video calls through the browser - how to make technology work for your company</h1><div class="post__text post__text-html js-mediator-article">  Well, it was very interesting to figure out how to make video calls through the browser within the company and how useful it is.  Moreover, skype is ‚Äúlistened‚Äù and the passwords sent are parsed by robots ... <br><br>  It seems to have <a href="http://www.google.com/hangouts/">Google+ Hangouts</a> and they are often used - but this is still not WebRTC and proprietary cloud technology.  Who knows if colleagues from another <s>competitor</s> company with notebooks and genuine smiles on shining faces are not looking at our business planning meeting? <br><img src="https://habrastorage.org/getpro/habr/post_images/56a/057/573/56a05757385ac7938fa83142aa09279f.png"><br>  In general, you see, the topic of our private, secure video conversations within the company is as relevant as ever.  Many need it, but how to organize something?  We made it.  This can be done quite simply, if you know how :-) (having studied a dozen RFCs, w3c standards and their implementations, and got to the bottom of the reasons). <br><br>  Below, I will try to carry out the main technological risks of implementation, which we had to step on and we will most likely have to step on - and for a snack: a brief technological squeeze and a business TODO, without unnecessary details blasting the brain. <br><a name="habracut"></a><br><h4>  Technology </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      One of the breakthrough technologies of <a href="http://ru.wikipedia.org/wiki/HTML5">HTML5</a> is undoubtedly <a href="http://ru.wikipedia.org/wiki/WebRTC">WebRTC</a> , developed by <a href="http://www.w3.org/TR/webrtc/">w3c</a> with the support of Google, Mozilla and Opera. <br><br>  Its essence is that having a camera, a microphone and a browser on a computer, I can make a video call to another person with a browser, camera and microphone anywhere ‚Äî both to a colleague at the next table, and to the boss who sunbathes on the beach with a laptop surrounded by beautiful female bodies.  In this case, the connection will be encrypted, once, and only between you - peer-to-peer - two.  Cool?  But that is not all. <br><img src="https://habrastorage.org/getpro/habr/post_images/bc8/5b3/091/bc85b3091aebbad17096a76c88f75bdf.jpg"><br>  The action <s>takes place with the use of strong black magic</s> is almost transparent, "inside" the browser - you and your programmers do not bother with codecs, firewalls, approvals, sip, etc.  - in the simplest case, the task of video calls at first glance is solved by a dozen lines of js-code and here it is, happiness - private video conversations in your company work. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a13/cb5/9bd/a13cb59bd43e625326e93bf86d51b6a1.png"><br>  <i>Do not delve into this scheme, otherwise the brain may explode.</i>  <i>For decades, media technologies and protocols have been stuck inside the browser: a television studio, a radio station, and a telephone exchange.</i> <br><br>  But as you know, the devil is in the details.  Let's talk about them ... <br><br><h4>  Signaling </h4><br><br>  In the description of the <a href="http://www.w3.org/TR/webrtc/">WebRTC</a> technology, there are two strikingly different topics - the romantic success stories "turned on and started" and wild low-level hardcore from sweeping away the terms <a href="http://en.wikipedia.org/wiki/STUN">stun</a> , <a href="http://en.wikipedia.org/wiki/TURN">turn</a> , <a href="http://tools.ietf.org/html/rfc5245">ice</a> , <a href="http://en.wikipedia.org/wiki/Session_Description_Protocol">sdp</a> ... Ie  either skipipast and earn, but it is not clear how, or half a year to study the source code and RFC :-) <br><br>  One of the hardcore terms that lead to despondency is <a href="http://www.html5rocks.com/en/tutorials/webrtc/infrastructure/">‚Äúsignaling‚Äù</a> .  In fact, it performs three simple tasks: <br><br>  1) Dock the configuration of two browsers (audio / video streams, codecs, addresses and ports - in SDP format) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fef/fdf/bd2/feffdfbd20f434c934bafa09d16e51b2.png"><br>  <i>Sdp</i>  <i>Between browsers, this nightmare is transmitted, the details of which can be ignored.</i>  <i>But sediment, even after reading the RFC - remains</i> <br><br>  2) Password exchange for setting up an encrypted connection between browsers <br>  3) Initiation of actions - call something (connect client A‚Äôs stream with client B‚Äôs stream on callbacks in js), hang up, etc.  Those.  on js in the browser you do very simple things with the <a href="http://www.w3.org/TR/webrtc/">RTCPeerConnection</a> object - but inside the object is a real ADB. <br><br>  Those.  via signaling, which you write on anything and in any way - browsers dock with each other and you can ... make video calls.  And, surprisingly, you can not understand what lies on the stack of protocols - calls will be surprisingly simple. <br><img src="https://habrastorage.org/getpro/habr/post_images/dc4/f10/dd3/dc4f10dd3c8da7f40ca4b55765bd0cec.png"><br>  <i>Signaling visually looks frightening - in fact, they simply ‚Äúchase‚Äù SDP descriptions of media streams in the browser via ICE ... Eh, I just wanted to write - it doesn't work</i> <br><br><h4>  Browsers Search Each Other </h4><br><br>  Calling is easy on the local network, but when employees are on different networks ... and even behind firewalls - browsers will not be able to connect without assistance. <br><br>  Technologically, there is even more hardcore here than in the section above, I warn you right away, but if you tell something on your fingers, you get something like: <br>  1) In order to ‚Äúpunch‚Äù firewalls of a company, employees must contact the STUN / TURN protocols to a certain central server.  This server is either raised by your system administrators, or you use a free, but with limited capabilities (no support for TURN relay-mode), a STUN server from Google. <br>  2) If the firewall fails to ‚Äúpunch‚Äù, the only possibility remains - to pour media streams through a third-party server, and not peer-to-peer between browsers.  This mode of operation of the TURN server is called ‚Äúrelay‚Äù.  You will have to understand this server yourself - there are <a href="https://code.google.com/p/rfc5766-turn-server/">open solutions</a> , but you will have to configure them yourself under WebRTC.  However, according to statistics - roughly only about 10% of video calls are in the ‚Äúrelay‚Äù mode. <br><br>  Once again, briefly - to make video calls reliably go inside your company, raise or use an ‚Äúalien‚Äù STUN / TURN server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/38d/4f4/ae3/38d4f4ae30bb61c7646b2d69b7a3eace.png"><br>  <i>Something like this goes the media streams between users' browsers - either directly or through a relay-server.</i>  <i>Yes, this is terrible and unaesthetic - but the best ways to ‚Äúpunch‚Äù firewalls have not yet been invented.</i>  <i>Skype also works on this principle.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c84/85e/1b7/c8485e1b789a8a564562baa6a3632ccb.png"><br>  <i>Without understanding that ICE is not ice, but the technology of choosing the optimal route for sharing video streams, enshrined in the RFC, you cannot go further.</i>  <i>The level of sediment from the excessive, ugly and illogical complexity of the STUN / TURN / ICE protocol stack has increased to a critical level.</i> <br><br><h4>  Video conferencing </h4><br><br>  WebRTC - does not support video conferencing directly.  There are video / audio streams and browsers and combine.  Skype is a paid service.  In Google+, Hangouts (which by the way does not use WebRTC, but works in its plugin for Chrome and with specific codecs!) - a limit of 10-15 people. <br><br>  Understand the complexity?  All video streams need to be collected somewhere, turned into one, personal, video stream for a specific participant and returned to him.  Those.  if we have 10 people, I take the frames of the participants from each personal video stream, superimpose them on the lead frame somewhere below and give the formed frame to a specific participant, and so on for everyone.  And you need to collect frames with support for codecs WebRTC compatible browsers.  Represent the amount of computation.  There are open implementations of this ‚ÄúMCU server‚Äù: <br>  1) <a href="http://lynckia.com/licode/">licode</a> - IMHO is damp and there is no honest MCU, but simply multiplexing of streams. <br>  2) <a href="http://www.medooze.com/products/mcu.aspx/">MCU video milticonference server</a> - but it didn‚Äôt start up right away after replicating with the Chrome source and the last Asterisk, which supports WebRTC via WebSockets.  And somehow scary - java on java and jav-oh chases :-) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/da4/263/a0b/da4263a0b4d0bf2c7973b636f6f73a33.jpg"><br>  <i>It looks awesome, I agree.</i> <br><br>  Of course, there are commercial products and a whole industry for organizing videoconferences - but in this article we focus only on WebRTC. <br><br>  At WebRTC, you can do it easier - in a video conference, each browser keeps a video stream of each participant.  This you have to program inside the browser on js yourself and connect with signaling.  Yes, the traffic here increases, but for calls within the company to several people - this solution impresses with its simplicity and efficiency. <br><br><h4>  Browsers are different </h4><br><br>  Video calls work stably between Chrome - Chrome.  The remaining combinations: Chrome, Firefox, Opera - or do not work, or formally work, but in fact not.  But still promise with the new year reliable operation of Chrome-Firefox video calls. <br><br>  If you look at it philosophically, not all companies are tied to a specific version of browsers - and you can put communicating colleagues in Chrome, perhaps only during the call and soon the New Year - well, you understand ... <br><br><h4>  WebRTC and telephony </h4><br><br>  But the truth is, why not call from a browser to a landline / mobile phone and vice versa?  This is possible, but ... But here without immersion in the technology of transmission of sound and video can not do.  The first ‚Äúshock‚Äù is the <a href="http://ru.wikipedia.org/wiki/SIP">SIP protocol</a> .  IP telephony and SIP are just inseparable technologies, but there is no mention of SIP in the WebRTC standard :-) Whom to beat and what? <br><br>  And everything is simple - arguing on the fingers of the SIP is a kind of powerful and flexible signaling (see above).  But if you write signaling yourself - why do you <s>need an intergalactic-level starburst with</s> SIP <s>photon rockets</s> ? <br><br>  Nastykovochka began to generate monsters such as creating <a href="https://code.google.com/p/sipml5/">js-libraries</a> ( <s>in assembly language</s> ), which understand SIP and can dock browsers on WebRTC.  And <a href="http://www.asterisk.org/">asterisk</a> began to support websockets for integration with browsers that want to communicate via WebRTC ... But the obvious incompatibility of technologies into one another and the complexity of the technology stack puts the use of SIP in your own WebRTC calls within the company ... (flew tomatoes, I understand, but agree js + sip is brute force in this case, although it may be). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c08/36f/624/c0836f624133aa43ec219d8e3cc9c6f5.jpg"><br>  <i>SIP is what signaling does in WebRTC, but more seriously, difficult and distributed.</i> <br><br>  An alternative way to solve the above problem is to use the services of a company <a href="http://habrahabr.ru/company/zingaya/blog/205404/">specialized in such calls</a> .  You are not immersed in details and just use a special js-library and ... you can call any city and mobile number through a special web service of the company. <br><br>  Thus, the task to call from the browser to the phone number is also solved. <br><br><h4>  Summarize </h4><br>  Let us now summarize the facts and weigh the possibilities and risks.  You can independently and in reasonable time to deploy secure video calls in the company.  Technologies are open, described, in the jungle you can not climb - because  I tried to describe all the risks objectively and to give a technological squeeze of hardcore above. <br><br>  To launch video calls via WebRTC within a company, it turns out you need: <br><ol><li>  write signaling that takes into account the specifics of business processes in a company, has access to employee lists in AD, etc. </li><li>  raise 1-2 STUN / TURN servers outside the company's local network to make video calls from different offices of the company and from mobile devices.  In some cases, the video traffic will go through these servers, though it is encrypted. </li><li>  try to integrate with very raw or rather complex products for organizing video conferencing for several people, or write your own WebRTC implementation of video conferencing </li><li>  integrate with "gateways" for the possibility of making calls to regular phone numbers from / to the company </li></ol><br><br>  Technologically tasks are solvable.  But if you do not have time to do all this, you can use, for example, <a href="http://www.1c-bitrix.ru/products/intranet/features/videochat.php">our product</a> or <a href="http://www.bitrix24.ru/">cloud service</a> (free registration and 100 rubles on the account for any calls anywhere - you can test the technology and see if you need it or not) supporting all of the above video calling technologies out of the box and using our cluster of video servers with support for STUN / TURN protocols. <br><br><h4>  Technology operation </h4><br>  You chose an implementation option and started using video calls from a browser within the company.  There is one thing that somehow either is silent, or they don‚Äôt know about it - there are rare cases when it‚Äôs impossible to reach the telephone.  This is due to the fact that browsers could not find each other directly (install peer-to-peer by ICE) and try to use the last opportunity - to establish a connection through an external relay-server but ... system administrators blocked outgoing UDP traffic in the employee's subnet .  But TURN supports relay-mode ONLY over UDP (details in RFC).  It is enough to allow it - and video calls will work again. <br><br>  Another common question is traffic and video size.  In relay mode on a TURN server, one connection consumes hundreds of kilobytes per second - traffic directly depends on the size of the video in the browser.  Those.  if you expect tight video conferences in the relay-mode - think about it in advance. <br><br>  That's probably all that I wanted to tell interesting and useful.  I wish everyone good luck in the upcoming New Year, working projects and satisfied employees! </div><p>Source: <a href="https://habr.com/ru/post/206200/">https://habr.com/ru/post/206200/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../206182/index.html">Transformation of threats in the information space: from technological to social. Part II</a></li>
<li><a href="../206186/index.html">Open Terminal Client - First Step</a></li>
<li><a href="../206188/index.html">Taskurotta or process management in a distributed system</a></li>
<li><a href="../206192/index.html">DIY mini-desktop</a></li>
<li><a href="../206198/index.html">A passion for programming. Chapter 10. Fall in Love or Throw It</a></li>
<li><a href="../206202/index.html">Skeptics list</a></li>
<li><a href="../206204/index.html">How we created the single on Ubuntu Studio 13.10</a></li>
<li><a href="../206206/index.html">One day from the life of Moscow in geotagging of Vkontakte</a></li>
<li><a href="../206208/index.html">Handling annotations during compilation</a></li>
<li><a href="../206210/index.html">Synchronization in Android applications. Part one</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>