<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Doctrine Specification Pattern or your reusable QueryBuilder</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I will try to tell you as briefly as possible how to use this pattern with our beloved Doctrine with examples and why this is true. 

 Let's imagine t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Doctrine Specification Pattern or your reusable QueryBuilder</h1><div class="post__text post__text-html js-mediator-article">  I will try to tell you as briefly as possible how to use this pattern with our beloved Doctrine with examples and why this is true. <br><br>  Let's imagine the base case: <br><br>  1. We have: the essence of ‚ÄúHouse‚Äù, the essence of ‚ÄúApartment in the house‚Äù, the essence of ‚ÄúDeveloper‚Äù, the essence of ‚ÄúRegion‚Äù. <br>  2. We have a task: to be able to get all the developers, to be able to get all the occupied regions by the developer, to be able to get all the houses that belong to the developer, and all the available regions in general, where homes are sold. <br>  3. We have rules for business: <br><a name="habracut"></a><br>  The valid developer is the one we confirmed through the admin panel, i.e.  whose <b>$ verifed = true</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>"But the truth is, we don‚Äôt know how it will be later, maybe the condition of validity will soon change - xs, guys."</i> <br><br>  A valid house is one that <b>already has its coordinates filled</b> and <b>there is at least some description</b> . <br><br>  <i>‚ÄúAnd so that at least one apartment is attached, it‚Äôs still unclear for us, we‚Äôre thinking <b>of not showing</b> it anywhere else <b>at home</b> ! 1!</i>  <i>But here again, we can change the concept of validity - for now let it be so.</i>  <i>This is not a long time to fix it then !!!</i>  <i>And, by the way, yes !! 1 If a developer without $ verifed = true, we must not show these houses !!!</i>  <i>Not for long to fix?</i> <br><br>  <i>‚ÄúAnd we want to show only those regions <b>in which there is at least 1 valid house</b> !!! 1 And by the way, such filtering should be turned both on the main page and on the page of a separate developer !!!</i>  <i>Do you remember what a valid house is like with us ??</i>  <i>BUT???</i>  <i>You are alive??"</i> <br><br>  So, as before my repositories would look like: <br><br><div class="spoiler">  <b class="spoiler_title">RegionRepository:</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegionRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Doctrine</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ORM</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAvailableRegions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $qb = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createQueryBuilder(<span class="hljs-string"><span class="hljs-string">'r'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $qb -&gt;join(<span class="hljs-string"><span class="hljs-string">'r.houses'</span></span>, <span class="hljs-string"><span class="hljs-string">'h'</span></span>) -&gt;join(<span class="hljs-string"><span class="hljs-string">'h.developer'</span></span>, <span class="hljs-string"><span class="hljs-string">'d'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#   start -&gt;innerJoin('h.apartments', 'a') //      -&gt;where('h.longitude IS NOT NULL') //   -&gt;andWhere('h.latitude IS NOT NULL') //,   -&gt;andWhere('h.description IS NOT NULL') //*...   ..      .. #   end #   start -&gt;andWhere('d.verified') //   -   ... #   end -&gt;getQuery() -&gt;getResult(); } public function findAvailableRegionsByDeveloper(DeveloperCompany $developerCompany) { $qb = $this-&gt;createQueryBuilder('r'); return $qb -&gt;join('r.houses', 'h') -&gt;join('h.developer', 'd') #   start -&gt;innerJoin('h.apartments', 'a') //      -&gt;where('h.longitude IS NOT NULL') //   -&gt;andWhere('h.latitude IS NOT NULL') //,   -&gt;andWhere('h.description IS NOT NULL') //*...   ..      .. #   end -&gt;andWhere('d.id = :developer_id') -&gt;setParameter('developer_id', $developerCompany-&gt;getId()) -&gt;getQuery() -&gt;getResult(); } }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">HouseRepository:</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HouseRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Doctrine</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ORM</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAvailableHouses</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $qb = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createQueryBuilder(<span class="hljs-string"><span class="hljs-string">'h'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $qb -&gt;join(<span class="hljs-string"><span class="hljs-string">'h.developer'</span></span>, <span class="hljs-string"><span class="hljs-string">'d'</span></span>) -&gt;innerJoin(<span class="hljs-string"><span class="hljs-string">'h.apartments'</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>) <span class="hljs-comment"><span class="hljs-comment">//    -&gt;where('h.longitude IS NOT NULL') // -&gt;andWhere('h.latitude IS NOT NULL') // -&gt;andWhere('h.description IS NOT NULL') //  #!!! -&gt;where('d.verified') //,    .      ... -&gt;getQuery() -&gt;getResult(); } }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">DeveloperCompanyRepository:</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeveloperCompanyRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Doctrine</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ORM</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAvailableDevelopers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createQueryBuilder(<span class="hljs-string"><span class="hljs-string">'d'</span></span>) -&gt;where(<span class="hljs-string"><span class="hljs-string">'d.verified'</span></span>) <span class="hljs-comment"><span class="hljs-comment">//........ -&gt;getQuery() -&gt;getResult(); } }</span></span></code> </pre><br></div></div><br>  So, we duplicated the developer‚Äôs validity check by verified = true 100 times. <br>  A hundred times duplications check the validity of the house by coordinates, description, and so on. <br>  A hundred times these two conditions were duplicated simultaneously. <br><br>  Initially, you simply scratch, sometimes you can not fall asleep, remembering this part of your code and you never have a desire to go to work with a smile.  But this is only for the time being ..., when managers come and change one of these conditions of ‚Äúvalidity‚Äù or you forget somewhere in the JOIN sampling to indicate one or another factor of validity of this or that entity, because yesterday Peter brought out another important point why some houses should not be shown, but did not fix in 10,000 repositories, and now we have the developer‚Äôs page showing regions where there are invalid houses, because Petya did not know about the existence of such validation, for Vasya did it - then is already starting to hurt in the area sing  Nice. <br><br>  And here, on a beautiful sunny morning, for some reason you come to work early when there is no one, the coffee machine is ready for repeated use - and there is no queue for it, in the office there is fresh air, not yet burned by your colleagues' computers coolers and complete silence. <br>  At such moments you get closer to the patterns, and at that very moment the <a href="https://en.wikipedia.org/wiki/Specification_pattern">Specification Pattern</a> came to me. <br><br>  The first step is to clear your mind in order to more calmly accept the fact that you have to get rid of $ this-&gt; createQueryBuilder ('alias'), take it not as some kind of revolution, but as a path to an unknown, but in any case a bright future. . <br>  The second step is <i>composer require happyr / doctrine-specification</i> <br>  The third step is to accept the fact that you deserve the best and create the following classes: <br><br>  Specificity of the sample of valid developers. <br><br><div class="spoiler">  <b class="spoiler_title">CorrectDeveloperSpecification</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Happyr</span></span>\<span class="hljs-title"><span class="hljs-title">DoctrineSpecification</span></span>\<span class="hljs-title"><span class="hljs-title">BaseSpecification</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Happyr</span></span>\<span class="hljs-title"><span class="hljs-title">DoctrineSpecification</span></span>\<span class="hljs-title"><span class="hljs-title">Spec</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CorrectDeveloperSpecification</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseSpecification</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSpec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Spec::eq(<span class="hljs-string"><span class="hljs-string">'verified'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } }</code> </pre><br></div></div><br>  Specificity of sampling valid homes. <br><br><div class="spoiler">  <b class="spoiler_title">CorrectHouseSpecification</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Happyr</span></span>\<span class="hljs-title"><span class="hljs-title">DoctrineSpecification</span></span>\<span class="hljs-title"><span class="hljs-title">BaseSpecification</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Happyr</span></span>\<span class="hljs-title"><span class="hljs-title">DoctrineSpecification</span></span>\<span class="hljs-title"><span class="hljs-title">Spec</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CorrectHouseSpecification</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseSpecification</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSpec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Spec::andX( Spec::innerJoin(<span class="hljs-string"><span class="hljs-string">'apartments'</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>), Spec::innerJoin(<span class="hljs-string"><span class="hljs-string">'developer'</span></span>, <span class="hljs-string"><span class="hljs-string">'d'</span></span>), Spec::isNotNull(<span class="hljs-string"><span class="hljs-string">'description'</span></span>), Spec::isNotNull(<span class="hljs-string"><span class="hljs-string">'longitude'</span></span>), Spec::isNotNull(<span class="hljs-string"><span class="hljs-string">'latitude'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CorrectDeveloperSpecification(<span class="hljs-string"><span class="hljs-string">'d'</span></span>) ); } }</code> </pre><br></div></div><br>  Specificity of sampling valid regions. <br><br><div class="spoiler">  <b class="spoiler_title">CorrectRegionSpecification</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Happyr</span></span>\<span class="hljs-title"><span class="hljs-title">DoctrineSpecification</span></span>\<span class="hljs-title"><span class="hljs-title">BaseSpecification</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Happyr</span></span>\<span class="hljs-title"><span class="hljs-title">DoctrineSpecification</span></span>\<span class="hljs-title"><span class="hljs-title">Spec</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CorrectRegionSpecification</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseSpecification</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSpec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Spec::andX( Spec::innerJoin(<span class="hljs-string"><span class="hljs-string">'houses'</span></span>, <span class="hljs-string"><span class="hljs-string">'h'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CorrectHouseSpecification(<span class="hljs-string"><span class="hljs-string">'h'</span></span>) ); } }</code> </pre><br></div></div><br>  Specific sample valid by developer: <br><br><div class="spoiler">  <b class="spoiler_title">CorrectOccupiedRegionByDeveloperSpecification</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>\<span class="hljs-title"><span class="hljs-title">DeveloperCompany</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Happyr</span></span>\<span class="hljs-title"><span class="hljs-title">DoctrineSpecification</span></span>\<span class="hljs-title"><span class="hljs-title">BaseSpecification</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Happyr</span></span>\<span class="hljs-title"><span class="hljs-title">DoctrineSpecification</span></span>\<span class="hljs-title"><span class="hljs-title">Spec</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CorrectOccupiedRegionByDeveloperSpecification</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseSpecification</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> DeveloperCompany */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $developer; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DeveloperCompany $developerCompany, $dqlAlias = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($dqlAlias); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;developer = $developerCompany; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSpec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Spec::andX( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CorrectRegionSpecification(), Spec::join(<span class="hljs-string"><span class="hljs-string">'developer'</span></span>, <span class="hljs-string"><span class="hljs-string">'d'</span></span>, <span class="hljs-string"><span class="hljs-string">'h'</span></span>), Spec::eq(<span class="hljs-string"><span class="hljs-string">'d.id'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;developer-&gt;getId()) ); } }</code> </pre><br></div></div><br>  Now the best part - we destroy, we split, we burn govnokod from repositories!  Before looking under the spoilers, make sure that you are not distracted and are ready to fully taste the fact how much simpler and more divine the code has become ... <br><br><div class="spoiler">  <b class="spoiler_title">RegionRepository</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegionRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntitySpecificationRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAvailableRegions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;match( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CorrectRegionSpecification() ); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAvailableRegionsByDeveloper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DeveloperCompany $developerCompany)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;match( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CorrectOccupiedRegionByDeveloperSpecification($developerCompany) ); } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Houserepository</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HouseRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntitySpecificationRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAvailableHouses</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;match( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CorrectHouseSpecification() ); } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">DeveloperCompanyRepository</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeveloperCompanyRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntitySpecificationRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAvailableDevelopers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;match( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CorrectDeveloperSpecification() ); } }</code> </pre><br></div></div><br>  Isn't it candy? <br><br>  <a href="https://github.com/Happyr/Doctrine-Specification">Link to the Bundle</a> - there is a full description of how <s>you can</s> use the specifications. <br><br>  All the pleasant hours of coding, patterns, sunshine and silence in your Open Space. </div><p>Source: <a href="https://habr.com/ru/post/334404/">https://habr.com/ru/post/334404/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334394/index.html">Mutation Testing</a></li>
<li><a href="../334396/index.html">Hacking a casino through a smart aquarium and DDoS stock brokers: new attacks on finance</a></li>
<li><a href="../334398/index.html">R and Big Data: Use Replyr</a></li>
<li><a href="../334400/index.html">Biomechanics and artificial intelligence in medicine. Lecture at YaC 2017</a></li>
<li><a href="../334402/index.html">Grant for startups: online magistracy awaits the best</a></li>
<li><a href="../334406/index.html">China tightens VPN regulation</a></li>
<li><a href="../334408/index.html">The simplest redux types generator for asynchronous requests</a></li>
<li><a href="../334410/index.html">Experience developing and promoting games on Android</a></li>
<li><a href="../334412/index.html">Grabber for one book site</a></li>
<li><a href="../334416/index.html">Google re: Work - Manual: Setting Goals with OKR (Translation)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>