<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We clean the HTML code when pasting text from MS Word to HTML5 WYSIWYG editor (contenteditable)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 When writing your WYSIWYG editor there was a problem copying text from Word. Actually there are three problems: 


- Ward inserts a lot of g...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We clean the HTML code when pasting text from MS Word to HTML5 WYSIWYG editor (contenteditable)</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  When writing your WYSIWYG editor there was a problem copying text from Word.  Actually there are three problems: <br><ul><li>  Ward inserts a lot of garbage html code that needs to be cleaned </li><li>  For some reason, Ward uses paragraphs instead of UL and LI tags to represent lists. </li><li>  Actually how to determine that the inserted text is inserted from the Word. </li></ul><br>  In general, to solve these problems, a jquery plugin was written, the full source code of which is available at the end of the article.  Usage example: <br><br><pre><code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'#editor'</span></span>). msword_html_filter();</code> </pre> <br>  The plugin hangs on the <em>keyup</em> event and checks whether the source code inside the editor is inserted from the Word, if so, the cleaning function is started.  In the resulting html, everything that is possible is nailed - non-breaking spaces, <em>style</em> and <em>align</em> attributes, <em>span</em> tags, all <em>Mso-</em> classes, empty paragraphs. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Implementation details under the cut. <br><br>  <b>UPD</b> <a href="http://codepen.io/anon/pen/hFAdk">CodePen Demo</a> <br><br><a name="habracut"></a><br><br>  Most of the regulars were used by <a href="http://www.tinymce.com/">TinyMCE</a> . <br><br>  How to determine whether the line html-code inserted from the Word: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-regexp"><span class="hljs-regexp">/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i</span></span>.test( content )) { ... }</code> </pre><br><br>  The code purge function (the jquery object of the editor is passed to the function): <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">word_filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">editor</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content = editor.html(); <span class="hljs-comment"><span class="hljs-comment">// Word comments like conditional comments etc content = content.replace(/&lt;!--[\s\S]+?--&gt;/gi, ''); // Remove comments, scripts (eg, msoShowComment), XML tag, VML content, // MS Office namespaced tags, and a few other tags content = content.replace(/&lt;(!|script[^&gt;]*&gt;.*?&lt;\/script(?=[&gt;\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/&gt;]))[^&gt;]*&gt;/gi, ''); // Convert &lt;s&gt; into &lt;strike&gt; for line-though content = content.replace(/&lt;(\/?)s&gt;/gi, "&lt;$1strike&gt;"); // Replace nbsp entites to char since it's easier to handle //content = content.replace(/ /gi, "\u00a0"); content = content.replace(/ /gi, ' '); // Convert &lt;span style="mso-spacerun:yes"&gt;___&lt;/span&gt; to string of alternating // breaking/non-breaking spaces of same length content = content.replace(/&lt;span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*&gt;([\s\u00a0]*)&lt;\/span&gt;/gi, function(str, spaces) { return (spaces.length &gt; 0) ? spaces.replace(/./, " ").slice(Math.floor(spaces.length/2)).split("").join("\u00a0") : ''; }); editor.html(content); // Parse out list indent level for lists $('p', editor).each(function(){ var str = $(this).attr('style'); var matches = /mso-list:\w+ \w+([0-9]+)/.exec(str); if (matches) { $(this).data('_listLevel', parseInt(matches[1], 10)); } }); // Parse Lists var last_level=0; var pnt = null; $('p', editor).each(function(){ var cur_level = $(this).data('_listLevel'); if(cur_level != undefined){ var txt = $(this).text(); var list_tag = '&lt;ul&gt;&lt;/ul&gt;'; if (/^\s*\w+\./.test(txt)) { var matches = /([0-9])\./.exec(txt); if (matches) { var start = parseInt(matches[1], 10); list_tag = start&gt;1 ? '&lt;ol start="' + start + '"&gt;&lt;/ol&gt;' : '&lt;ol&gt;&lt;/ol&gt;'; }else{ list_tag = '&lt;ol&gt;&lt;/ol&gt;'; } } if(cur_level&gt;last_level){ if(last_level==0){ $(this).before(list_tag); pnt = $(this).prev(); }else{ pnt = $(list_tag).appendTo(pnt); } } if(cur_level&lt;last_level){ for(var i=0; i&lt;last_level-cur_level; i++){ pnt = pnt.parent(); } } $('span:first', this).remove(); pnt.append('&lt;li&gt;' + $(this).html() + '&lt;/li&gt;') $(this).remove(); last_level = cur_level; }else{ last_level = 0; } }) $('[style]', editor).removeAttr('style'); $('[align]', editor).removeAttr('align'); $('span', editor).replaceWith(function() {return $(this).contents();}); $('span:empty', editor).remove(); $("[class^='Mso']", editor).removeAttr('class'); $('p:empty', editor).remove(); }</span></span></code> </pre><br><br>  Full source code of the plugin under the spoiler, save to <b>jquery.msword_html_filter.js</b> <br><br><div class="spoiler">  <b class="spoiler_title">plugin source code</b> <div class="spoiler_text"><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span></span><span class="hljs-function">) </span></span>{ $.fn.msword_html_filter = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> settings = $.extend( {}, options); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">word_filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">editor</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content = editor.html(); <span class="hljs-comment"><span class="hljs-comment">// Word comments like conditional comments etc content = content.replace(/&lt;!--[\s\S]+?--&gt;/gi, ''); // Remove comments, scripts (eg, msoShowComment), XML tag, VML content, // MS Office namespaced tags, and a few other tags content = content.replace(/&lt;(!|script[^&gt;]*&gt;.*?&lt;\/script(?=[&gt;\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/&gt;]))[^&gt;]*&gt;/gi, ''); // Convert &lt;s&gt; into &lt;strike&gt; for line-though content = content.replace(/&lt;(\/?)s&gt;/gi, "&lt;$1strike&gt;"); // Replace nbsp entites to char since it's easier to handle //content = content.replace(/ /gi, "\u00a0"); content = content.replace(/ /gi, ' '); // Convert &lt;span style="mso-spacerun:yes"&gt;___&lt;/span&gt; to string of alternating // breaking/non-breaking spaces of same length content = content.replace(/&lt;span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*&gt;([\s\u00a0]*)&lt;\/span&gt;/gi, function(str, spaces) { return (spaces.length &gt; 0) ? spaces.replace(/./, " ").slice(Math.floor(spaces.length/2)).split("").join("\u00a0") : ''; }); editor.html(content); // Parse out list indent level for lists $('p', editor).each(function(){ var str = $(this).attr('style'); var matches = /mso-list:\w+ \w+([0-9]+)/.exec(str); if (matches) { $(this).data('_listLevel', parseInt(matches[1], 10)); } }); // Parse Lists var last_level=0; var pnt = null; $('p', editor).each(function(){ var cur_level = $(this).data('_listLevel'); if(cur_level != undefined){ var txt = $(this).text(); var list_tag = '&lt;ul&gt;&lt;/ul&gt;'; if (/^\s*\w+\./.test(txt)) { var matches = /([0-9])\./.exec(txt); if (matches) { var start = parseInt(matches[1], 10); list_tag = start&gt;1 ? '&lt;ol start="' + start + '"&gt;&lt;/ol&gt;' : '&lt;ol&gt;&lt;/ol&gt;'; }else{ list_tag = '&lt;ol&gt;&lt;/ol&gt;'; } } if(cur_level&gt;last_level){ if(last_level==0){ $(this).before(list_tag); pnt = $(this).prev(); }else{ pnt = $(list_tag).appendTo(pnt); } } if(cur_level&lt;last_level){ for(var i=0; i&lt;last_level-cur_level; i++){ pnt = pnt.parent(); } } $('span:first', this).remove(); pnt.append('&lt;li&gt;' + $(this).html() + '&lt;/li&gt;') $(this).remove(); last_level = cur_level; }else{ last_level = 0; } }) $('[style]', editor).removeAttr('style'); $('[align]', editor).removeAttr('align'); $('span', editor).replaceWith(function() {return $(this).contents();}); $('span:empty', editor).remove(); $("[class^='Mso']", editor).removeAttr('class'); $('p:empty', editor).remove(); } return this.each(function() { $(this).on('keyup', function(){ var content = $(this).html(); if (/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i.test( content )) { word_filter( $(this) ); } }); }); }; })( jQuery )</span></span></code> </pre><br></div></div><br>  Performance was tested only in the last Firefox. </div><p>Source: <a href="https://habr.com/ru/post/194848/">https://habr.com/ru/post/194848/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194834/index.html">Recipe schemes for pizzeria cuisine. Fast food plus design</a></li>
<li><a href="../194836/index.html">Why is the frequency not increasing?</a></li>
<li><a href="../194838/index.html">PHP extension or everything will be in Zephir</a></li>
<li><a href="../194842/index.html">play rock, or comand-line internet radio</a></li>
<li><a href="../194844/index.html">The Startup AddVenture conference offers a new interactive format of interaction with venture capital investors and experts from Silicon Valley.</a></li>
<li><a href="../194850/index.html">Billing in a big project</a></li>
<li><a href="../194852/index.html">Rejecting jParser (in favor of working directly with Node.js buffers) speeds up the script by an order of magnitude</a></li>
<li><a href="../194854/index.html">Today, the Android OS is exactly 5 years old</a></li>
<li><a href="../194856/index.html">Google glass from a developer‚Äôs point of view</a></li>
<li><a href="../194860/index.html">BlackBerry leaves consumer market</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>