<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Remote deployment and debugging of dotnet core applications on * nix</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 Solving a rather elementary problem and not having mastered the Spartan development conditions for ESP8266 decided to return to the c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Remote deployment and debugging of dotnet core applications on * nix</h1><div class="post__text post__text-html js-mediator-article"><h1 id="vvedenie">  Introduction </h1><br><p>  Solving a rather elementary problem and not having mastered the Spartan development conditions for ESP8266 decided to return to the cozy world of .Net in which there is also auto-completion and debugging. </p><br><p>  So, we have on hand: </p><br><ul><li>  Computer with Windows 10 Pro Build 1803 (however, almost everything written below can be done on * nix with minimal changes) </li><li>  Orange Pi Zero with Raspbian Server installed </li><li>  The desire to write C # code and debug on the device simply by pressing F5 <a name="habracut"></a></li></ul><br><h1 id="podgotovka-okruzheniya">  Environment preparation </h1><br><h2 id="kompyuter-razrabotchika">  Developer's computer </h2><br><p> Development will be conducted in <a href="https://code.visualstudio.com/download">Visual Studio Code</a> with the <code>C#</code> extension installed. </p><br><p>  Requires installed <a href="https://www.microsoft.com/net/download">.NET Core SDK</a> . </p><br><p>  It is also desirable to have a version of Windows 10 <strong>1803</strong> , since OpenSSH is installed by default into it.  In earlier versions of Windows 10, OpenSSH can be installed via Manage Add-ons.  However, this does not prohibit the use of third-party SSH clients. </p><br><h2 id="celevoe-ustroystvo">  Target device </h2><br><h3 id="podgotovka">  Training </h3><br><p>  The first step is to configure SSH access by key.  <a href="https://www.digitalocean.com/community/tutorials/ssh-ubuntu-18-04-ru">Excellent instructions from Digital Ocean</a> perfectly help with this. </p><br><p>  *Note: </p><br><p>  Private keys can be stored as separate files in the .ssh folder, but I recommend using the pretty convenient <a href="https://keepass.info/">KeePass</a> + <a href="https://lechnology.com/software/keeagent/">KeeAgent combination</a> .  KeePass provides secure key storage, and KeeAgent provides keys.  In order for it to work with the client built into Windows SSH, you need to activate the appropriate experimental setting. * </p><br><h3 id="ustanovka-net-core-sdk">  Installing the .NET Core SDK </h3><br><p>  Since the official Microsoft repository does not contain packages compiled for ARM32, you must install the .NET Core SDK manually. </p><br><p>  First, we need to install the dependencies listed in the <a href="">documentation</a> . </p><br><pre> <code class="bash hljs">apt-get install liblttng-ust0 libcurl3 libssl1.0.0 libkrb5-3 zlib1g libicu52 gettext</code> </pre> <br><p>  Now you can install the SDK. </p><br><p>  Direct link to the archive with the SDK can be taken from the <a href="https://github.com/dotnet/core-sdk">SDK page on GitHub</a> . </p><br><pre> <code class="bash hljs">curl -sSL -o dotnet.tar.gz https://dotnetcli.blob.core.windows.net/dotnet/Sdk/release/2.1.401/dotnet-sdk-latest-linux-arm.tar.gz sudo mkdir -p /opt/dotnet &amp;&amp; sudo tar zxf dotnet.tar.gz -C /opt/dotnet sudo ln -s /opt/dotnet/dotnet /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin</code> </pre> <br><h3 id="ustanovka-udalyonnogo-otladchika">  Installing Remote Debugger </h3><br><p>  The install script of the remote debugger uses <code>unzip</code> : </p><br><pre> <code class="bash hljs">sudo apt-get install unzip</code> </pre> <br><p>  To install the remote debugger, run the following command: </p><br><pre> <code class="bash hljs">curl -sSL https://aka.ms/getvsdbgsh | bash /dev/stdin -r linux-arm -v latest -l ~/vsdbg</code> </pre> <br><h1 id="nastroyka-vs-core-dlya-udalyonnogo-razvyortyvaniya-i-otladki-na-linux">  Configure VS Core for remote deployment and debugging on linux </h1><br><h2 id="1-sozdaem-proekt">  1. Create a project </h2><br><p>  It's all very simple: </p><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> DemoProject <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> DemoProject dotnet new console</code> </pre> <br><h2 id="2-sozdaem-fayly-konfiguracii">  2. Create configuration files </h2><br><p>  Open the folder with the project.  The C # extension automatically downloads the OmniSharp and .NET Core Debuger packages, if this has not been done before.  After that, we will be asked to create assets for building and debugging the project.  We agree to this.  As a result, the <code>.vscode</code> folder with the <code>tasks.json</code> and <code>launch.json</code> files <code>tasks.json</code> <code>launch.json</code> .  These files describe the tasks that can be performed and launch configurations.  By default, a debugger launch configuration is created, depending on the build task. </p><br><h2 id="3-pravim-fayly-konfiguracii">  3. Rules configuration files </h2><br><p>  The basic idea of ‚Äã‚Äãlaunching and debugging on a remote device is to create tasks that collect the project and copy it to the device and launch configuration using the remote debugger. <br>  I will give a description of the finished tasks: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tasks"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"label"</span></span>: <span class="hljs-string"><span class="hljs-string">"publish"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>: <span class="hljs-string"><span class="hljs-string">"dotnet"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"process"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"args"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"publish"</span></span>, <span class="hljs-string"><span class="hljs-string">"${workspaceFolder}/DemoProject.csproj"</span></span> ] }, { <span class="hljs-attr"><span class="hljs-attr">"label"</span></span>: <span class="hljs-string"><span class="hljs-string">"copy-to-device"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dependsOn"</span></span>: <span class="hljs-string"><span class="hljs-string">"publish"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>: <span class="hljs-string"><span class="hljs-string">"scp"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"process"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"args"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"-r"</span></span>, <span class="hljs-string"><span class="hljs-string">"-v"</span></span>, <span class="hljs-string"><span class="hljs-string">"${workspaceFolder}/bin/Debug/netcoreapp2.1/publish/."</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;target_user&gt;@&lt;target_ip&gt;:~/DemoProject/"</span></span> ] }, ] }</code> </pre> <br><p>  The <code>publish</code> task invokes the <code>dotnet publish</code> command, which packages the application and its dependencies in a deployment folder. </p><br><p>  The <code>copy-to-device</code> command uses <code>scp</code> to copy the published application to a remote device.  Pay attention to the point at the end of the path from which copying takes place.  If you do not specify it, then during subsequent copying the <code>publish</code> folder will be placed in the <code>DemoProject</code> , and will not overwrite it.  The <code>dependsOn</code> parameter indicates that <code>copy-to-device</code> depends on <code>publish</code> .  Thus, before executing <code>copy-to-device</code> <code>publish</code> will be executed. </p><br><p>  Next, you need to configure the remote launch and debug configuration: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.2.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"configurations"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">".NET Core Launch (console)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"coreclr"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: <span class="hljs-string"><span class="hljs-string">"launch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"preLaunchTask"</span></span>: <span class="hljs-string"><span class="hljs-string">"copy-to-device"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"program"</span></span>: <span class="hljs-string"><span class="hljs-string">"~/DemoProject/DemoProject.dll"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"args"</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">"cwd"</span></span>: <span class="hljs-string"><span class="hljs-string">"~/DemoProject"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"console"</span></span>: <span class="hljs-string"><span class="hljs-string">"internalConsole"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"stopAtEntry"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"internalConsoleOptions"</span></span>: <span class="hljs-string"><span class="hljs-string">"openOnSessionStart"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pipeTransport"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"pipeCwd"</span></span>: <span class="hljs-string"><span class="hljs-string">"${workspaceRoot}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pipeProgram"</span></span>: <span class="hljs-string"><span class="hljs-string">"ssh"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pipeArgs"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"-T"</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;target_user&gt;@&lt;target_ip&gt;"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"debuggerPath"</span></span>: <span class="hljs-string"><span class="hljs-string">"~/vsdbg/vsdbg"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"quoteArgs"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } ,] }</code> </pre> <br><p>  The <code>"preLaunchTask": "copy-to-device"</code> parameter <code>"preLaunchTask": "copy-to-device"</code> indicates that you need to run the <code>copy-to-device</code> task before starting a debugging session.  Thus, each time before debugging, the project will be published and copied to the target device. </p><br><p>  The <code>pipeTransport</code> parameter allows you to configure the use of a remote debugger.  In this case, <code>ssh</code> used as the program providing the transport, but nothing prevents the use of <code>plink.exe</code> from the <code>putty</code> program <code>putty</code> . </p><br><h2 id="4-otlazhivaemsya">  4. Debugging </h2><br><p>  After pressing F5, the project builds, copies and launches the application on the remote device.  Debugging is completely identical to local. </p><br><p>  <em>Note:</em> <em><br></em>  <em>After the application was completed, I received the <code>Error from pipe program 'ssh': Process is terminating due to StackOverflowException</code> message each time <code>Error from pipe program 'ssh': Process is terminating due to StackOverflowException</code> .</em>  <em>Judging by the open issue on GitHub, this is a known debugger problem.</em>  <em>But since the error occurs after the debugging is completed, you can ignore this.</em> </p><br><h1 id="ispolzovannye-resursy">  Resources used </h1><br><p>  ‚Üí <a href="https://blogs.msdn.microsoft.com/david/2017/07/20/setting_up_raspian_and_dotnet_core_2_0_on_a_raspberry_pi/">Setting up Raspian and .NET Core 2.0 on a Raspberry Pi</a> <br>  ‚Üí <a href="https://github.com/OmniSharp/omnisharp-vscode/wiki/Remote-Debugging-On-Linux-Arm">Omnisharp-vscode Remote Debugging On Linux Arm</a> <br>  ‚Üí <a href="https://docs.microsoft.com/ru-ru/dotnet/core/tools/dotnet-publish%3Ftabs%3Dnetcore21">dotnet publish command help</a> <br>  ‚Üí <a href="">Configuring launch.json for C # debugging</a> <br>  ‚Üí <a href="https://code.visualstudio.com/docs/editor/tasks">Visual Studio Code Integrate with External Tools via Tasks</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/422141/">https://habr.com/ru/post/422141/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../422129/index.html">Interviews with the winners of the 59th International Mathematical Olympiad</a></li>
<li><a href="../422131/index.html">RICE and ICE Scoring: simple prioritization techniques for advanced product managers</a></li>
<li><a href="../422133/index.html">Automatic control tower installed in northern Colorado</a></li>
<li><a href="../422137/index.html">Foreshadow: harbinger of trouble?</a></li>
<li><a href="../422139/index.html">Mobile version of Habr. Version 3.0</a></li>
<li><a href="../422143/index.html">Recipe useful code review from a developer from Yandex</a></li>
<li><a href="../422147/index.html">We raise our Speedtest node</a></li>
<li><a href="../422149/index.html">How is it - to be a flight attendant</a></li>
<li><a href="../422151/index.html">Online checks on the federal network through RabbitMQ, 1C and black magic</a></li>
<li><a href="../422153/index.html">NASA announces a competition to convert CO‚ÇÇ into nutrients</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>