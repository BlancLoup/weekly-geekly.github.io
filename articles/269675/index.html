<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Approach to implementing large formatted reports in SAP BW</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On projects implementing reporting using the SAP BW data warehouse, many architects and consultants have to solve the problems of preparing large form...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Approach to implementing large formatted reports in SAP BW</h1><div class="post__text post__text-html js-mediator-article">  On projects implementing reporting using the SAP BW data warehouse, many architects and consultants have to solve the problems of preparing large formatted reports: various statements, statements, etc.  Such reports are usually characterized by: <br><br><ul><li>  Non-standard formatting requirements for SAP tools; </li><li>  Fixed number of columns; </li><li>  A significant number of columns and rows (tens and tens of thousands or more, respectively); </li><li>  The requirement for an Excel presentation; </li><li>  Required run time no more than a few minutes </li></ul><br>  Unfortunately, it is often necessary to observe the situation when BW project architects choose the standard BW approach for implementing such reports.  The essence of this approach is summarized below. <br><br>  The consultant creates a BW-BEx workbook that contains one or more BW-BEx reports.  Reports are uploaded to separate sheets of this book, which are usually hidden from users.  Only one sheet of the book containing the target report form with the necessary formatting is visible. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      User work with such a report is as follows: <br><br><ul><li>  Depending on the SAP BW Excel tool used, the user starts BW-BEx Analyzer or SBOP Analysis for Office, connects to the SAP BW server, selects a workbook from the role and launches it for execution. <br>  After a few seconds (sometimes a dozen seconds), the selection screen appears. <br>  On the screen, the user selects the parameter values.  For example, year-month, company code, material group, etc.  Then presses the "execute" button. </li><li>  Now it‚Äôs time to ‚Äúwork‚Äù for SAP BW: all BW-BEx reports of the workbook are executed sequentially, report by report, transferring your data to Excel worksheets. </li><li>  After receiving each report data in Excel, a VBA macro is launched.  The logic of the macro is such that it does nothing until the data of all the reports are received on the Excel sheets. </li><li>  When the data of the last report arrived on the Excel sheet, the VBA macro performs the main work of preparing the report formatting. </li><li>  When the VBA macro has finished, the user can see the result of the report in his Excel. </li></ul><br>  The standard approach has a number of advantages: it is simple to implement and most of the specialists in the market are fluent in it.  But certain restrictions do not allow to effectively implement large reports.  An inefficient implementation turns out (if it turns out at all) to be very inconvenient in work, which negatively affects the attitude of users to the implementation project in general and to SAP BW in particular.  The main limitation is the maximum number of cells (the number of rows multiplied by the number of columns) in the report.  If their number approaches an empirical 750,000, then the probability of failure due to lack of memory is almost 100%.  Those.  The report from only 18 columns and a little more than 40,000 lines already fall under this restriction.  Excel limits are much higher. <br><br>  What the consultants do not invent, so that, while remaining within the framework of the standard approach, it is possible to qualitatively make a big report.  But almost always nothing happens.  ‚ÄúAlmost‚Äù means compromises, relaxation in requirements.  Business users either agree to use more restrictive filters and the report returns less data, either wait a little longer, or manually reduce several report fragments to one. <br><br>  In order not to tell the client ‚Äúno, we cannot realize this with such requirements,‚Äù it is necessary to first draw the right conclusions from the obvious: each tool is designed for its own task. <br><a name="habracut"></a><br>  The BW BEx Analyzer and SBOP Analysis for Office tools are generally not designed to implement effective reports with a large number of cells, with a number of about 750,000 or more (see SAP note 1040454).  Therefore, using the SAP BW data model, you need to choose another tool, another approach to implementation.  Then the solution will not only succeed, but will also be effective. <br><br>  Recent versions of SAP Netweaver, SAP BW and HANA have introduced a greater variety of approaches for publishing BW data to Excel, without using BW BEx.  We can mention the following: <br><br><ul><li>  Connect Excel via OData services directly to SAP Netweaver or even to SAP HANA </li><li>  Connect Excel to SAP HANA, as a database, directly, through MDX </li></ul><br>  However, these approaches require either BW on HANA, or the latest versions of Excel, or deviations from the usual concepts of authority, in which users do not work with applications that directly access the database. <br><br>  I want to talk about an approach that is much less demanding of the new versions of the products used, and somewhat less complex.  It is about publishing these reports to an Excel document template via an OLE interface.  The Excel template is also stored in the BDS repository on the SAP BW side. <br><br>  The advantages of the approach with OLE are obvious: <br><br><ul><li>  Works on any modern versions of SAP and Microsoft Excel products. </li><li>  There are no limitations on the data volumes in the report, except for those in Excel </li><li>  Provides maximum data transfer performance from a BW server to Excel via OLE.  Example: a sample of 525,000 cells (70 columns for 7500 rows) is transmitted in 7 seconds. </li><li>  Data preparation on the ‚ÄúBW server‚Äù is performed in the ABAP report, which, having collected the sample into an internal table, passes it through OLE to an Excel template obtained from BDS. </li><li>  Centralized (in one BW-system) maintenance of all objects relevant to the report: Excel template, BW data model, ABAP program for filling in the template. </li><li>  Compliance with the usual SAP-standards for access control, development, transport settings, etc. </li></ul><br>  ‚ÄúReverse‚Äù of the medal - this approach requires programming on ABAP.  But, according to the author, this aspect should not cause significant difficulties.  A ‚Äúwrapper‚Äù from calling an Excel file from BDS, filling it with data and saving it, for example, to a file on disk or back to BDS is a less standard code that is used with minimal variations from report to report. <br><br>  Difficulties in ABAP can arise when retrieving data from the BW model.  Possible options: call the BEx report in ABAP, call FM RSDRI_INFOPROV_READ, SQL-SELECT on the data model tables.  But this is usually in the arsenal of skills of an experienced BW consultant.  Deep knowledge of ABAP programming will be needed if there is a need to further speed up the work of the code for preparing data by tuning ABAP-program or even parallelizing calculations.  The latter, by the way, is impossible architecturally in the approach with BW BEx workbooks. <br><br>  In short, the procedure for creating a report using the approach with OLE is as follows. <br><br><ul><li>  Development and debugging of the ABAP code, which returns to the internal data table of the report in accordance with the input parameters.  An ABAP code may be in the form of FM, or better, in the form of a static method of an ABAP class; </li><li>  Preparing an Excel report template with basic formatting and a vBA macro, which is performed after filling with data.  Such a macro usually takes the parameter "number of lines", although this is not necessary.  Macro tasks - apply the formatting of report cells, provided that the number of rows is unknown in advance; </li><li>  Placing an Excel template in the BDS repository; </li><li>  The development and debugging of the ABAP code that fills the internal table of report results, reads an Excel template from the BDS, puts data from the internal table into it in accordance with the mapping ‚Äúfield in table - field in template‚Äù, runs the VBA macro for execution, saves the filled file on the disk in the temporary directory and opens it for viewing to the user; </li><li>  Preparing a user transaction, which is prepared on the basis of the development from the previous paragraph. </li></ul><br>  What may be needed to make the first example based on the approach with ABAP-OLE and successfully apply it in the future? <br><br><ul><li>  BDS: OAOR Repository Transaction </li><li>  ABAP code fragments for working with documents from BDS via OLE (see below) </li><li>  Certificate for a VBA macro or allowing Excel to run macros (see <a href="https://support.microsoft.com/en-us/kb/206637">support.microsoft.com/en-us/kb/206637</a> ) </li></ul><br><pre><code class="axapta hljs">data: l_iref_template type ref to cl_bds_document_set, l_oref_container type ref to cl_gui_custom_container, l_iref_control type ref to i_oi_container_control, l_iref_error type ref to i_oi_error, l_iref_document type ref to i_oi_document_proxy, l_iref_spreadsheet type ref to i_oi_spreadsheet, l_retcode type soi_ret_string. data: lt_signature type sbdst_signature, lw_signature type bapisignat, lt_uri type sbdst_uri, lw_uri type bapiuri, lt_sheet type soi_sheets_table, lw_sheet type soi_sheets. data: lt_fields type standard table of rfc_fields, lv_last_row type i, lv_last_col type i. call method c_oi_container_control_creator=&gt;get_container_control importing control = l_iref_control retcode = l_retcode. check l_retcode = c_oi_errors=&gt;ret_ok. call method l_iref_control-&gt;init_control <span class="hljs-comment"><span class="hljs-comment">//    pv_template  BDS exporting r3_application_name = pv_template inplace_enabled = 'X' inplace_scroll_documents = 'X' parent = l_oref_container importing retcode = l_retcode. check l_retcode = c_oi_errors=&gt;ret_ok. create object l_iref_template. lw_signature-prop_name = 'DESCRIPTION'. lw_signature-prop_value = pv_template. append lw_signature to lt_signature. refresh lt_uri. call method l_iref_template-&gt;get_with_url exporting classname = 'SOFFICEINTEGRATION' classtype = 'OT' object_key = 'SOFFICEINTEGRATION' changing uris = lt_uri signature = lt_signature exceptions nothing_found = 1 error_kpro = 2 internal_error = 3 parameter_error = 4 not_authorized = 5 not_allowed = 6. clear lw_uri. read table lt_uri into lw_uri index 1. check sy-subrc = 0. call method l_iref_control-&gt;get_document_proxy exporting document_type = 'Excel.Sheet' importing document_proxy = l_iref_document retcode = l_retcode. check l_retcode = c_oi_errors=&gt;ret_ok. call method l_iref_document-&gt;open_document exporting document_url = lw_uri-uri open_inplace = 'X' importing retcode = l_retcode. check l_retcode = c_oi_errors=&gt;ret_ok. free l_iref_error. call method l_iref_document-&gt;get_spreadsheet_interface importing error = l_iref_error sheet_interface = l_iref_spreadsheet. call method l_iref_spreadsheet-&gt;get_sheets importing sheets = lt_sheet error = l_iref_error. check l_iref_error-&gt;error_code = c_oi_errors=&gt;ret_ok. clear lw_sheet. read table lt_sheet into lw_sheet index 1. check sy-subrc = 0. call method l_iref_spreadsheet-&gt;select_sheet exporting name = lw_sheet-sheet_name importing error = l_iref_error. check l_iref_error-&gt;error_code = c_oi_errors=&gt;ret_ok. refresh lt_fields. call function 'DP_GET_FIELDS_FROM_TABLE' //    lt_fields   pt_excel tables data = pt_excel fields = lt_fields. lv_last_row = lines( pt_excel ). lv_last_col = lines( lt_fields ). call method l_iref_spreadsheet-&gt;set_selection //     exporting left = 1 top = 1 rows = lv_last_row columns = lv_last_col. call method l_iref_spreadsheet-&gt;insert_range //   exporting columns = lv_last_col rows = lv_last_row name = pv_template. call method l_iref_spreadsheet-&gt;insert_one_table // ,    Excel exporting data_table = pt_excel[] fields_table = lt_fields rangename = pv_template. ‚Ä¶ call method l_iref_document-&gt;execute_macro //   MakeFormat   Module1 exporting macro_string = 'Module1.MakeFormat' param1 = lv_last_row param_count = 1 importing error = l_iref_error retcode = l_retcode ‚Ä¶ concatenate pv_file sy-uzeit '.xls' into pv_file. call method l_iref_document-&gt;save_as exporting file_name = pv_file. call method l_iref_document-&gt;release_document importing retcode = l_retcode. free: l_iref_spreadsheet, l_iref_document. call method l_iref_control-&gt;release_all_documents. call method l_iref_control-&gt;destroy_control.</span></span></code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/269675/">https://habr.com/ru/post/269675/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269665/index.html">Pixar's 22 storytelling rules</a></li>
<li><a href="../269667/index.html">Java evolution by reading lines from a file</a></li>
<li><a href="../269669/index.html">Brilliance and Poverty HTML5 - Access to Sensors</a></li>
<li><a href="../269671/index.html">Work with Git without using local branches</a></li>
<li><a href="../269673/index.html">Gulp: how I collected a project for production, ran livereload and made error catching</a></li>
<li><a href="../269677/index.html">What Stable has prescribed</a></li>
<li><a href="../269679/index.html">Setting up MikroTik as an OVPN server using client certificates and revocation list</a></li>
<li><a href="../269681/index.html">Geek Week 2015: Learn, Learn and Learn More</a></li>
<li><a href="../269685/index.html">Algorithm of search of object displacement in the image</a></li>
<li><a href="../269687/index.html">Technopark Lectures: Alexey Rybak Master Class ‚ÄúAbout what I would like to be told while I was studying‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>