<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>My favorite algorithm: finding the median for linear time</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Finding the list median may seem like a trivial task, but performing it in linear time requires a serious approach. In this post I will talk about one...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>My favorite algorithm: finding the median for linear time</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c9f/d76/788/c9fd7678817ab4943483818e208eff96.png" alt="image"></div><br>  Finding the list median may seem like a trivial task, but performing it in linear time requires a serious approach.  In this post I will talk about one of my favorite algorithms - finding the list median for deterministic linear time using the medians of the medians.  Although the proof that this algorithm is performed in linear time is rather difficult, the post itself will be clear to readers with an initial level of knowledge about the analysis of algorithms. <br><a name="habracut"></a><br><h3>  Finding the median for O (n log n) </h3><br>  The most straightforward way to find the median is to sort the list and select the median by its index.  The fastest sorting by comparison is performed in <code>O(n log n)</code> , therefore execution time <sup>1</sup> , <sup>2</sup> depends on it. <br><cut></cut><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nlogn_median</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l)</span></span></span><span class="hljs-function">:</span></span> l = sorted(l) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(l) % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> l[len(l) / <span class="hljs-number"><span class="hljs-number">2</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span> * (l[len(l) / <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>] + l[len(l) / <span class="hljs-number"><span class="hljs-number">2</span></span>])</code> </pre> <br>  This method has the easiest code, but it is definitely not the fastest. <br><br><h3>  Finding the median for the average time O (n) </h3><br>  Our next step is to find the median <em>on average</em> for linear time, if we are lucky.  This algorithm, called ‚Äúquickselect,‚Äù was developed by Tony Hoare, who also invented a sorting algorithm with a similar name, quicksort.  This is a recursive algorithm, and it can find any element (not just the median). <br><br><ol><li>  Choose a list index.  The method of choice is not important, in practice it is quite suitable and random.  The element with this index is called the <strong>reference element (pivot)</strong> . </li><li>  We divide the list into two groups: <br><ol><li>  Items less than or equal to pivot, <code>lesser_els</code> </li><li>  Items strictly larger than pivot, <code>great_els</code> </li></ol></li><li>  We know that one of these groups contains a median.  Suppose we are looking for the <em>kth</em> element: <br><ul><li>  If there are <em>k</em> or more elements in <code>lesser_els</code> , recursively <code>lesser_els</code> list <code>lesser_els</code> for the <em>k-</em> <code>lesser_els</code> element. </li><li>  If <code>lesser_els</code> less than <em>k</em> elements, recursively <code>greater_els</code> list.  Instead of searching for <em>k,</em> we look for <code>k-len(lesser_els)</code> . </li></ul></li></ol><br>  Here is an example of an algorithm that runs on 11 elements: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="python hljs">   .    . l = [<span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>] len(l) == <span class="hljs-number"><span class="hljs-number">11</span></span>,             (pivot).      <span class="hljs-number"><span class="hljs-number">3.</span></span>       <span class="hljs-number"><span class="hljs-number">2.</span></span>      pivot: [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>], [<span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>]    . <span class="hljs-number"><span class="hljs-number">6</span></span>-len(left) = <span class="hljs-number"><span class="hljs-number">3</span></span>,                  : [<span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>]     ,    pivot.    <span class="hljs-number"><span class="hljs-number">2</span></span>,     l[<span class="hljs-number"><span class="hljs-number">2</span></span>]=<span class="hljs-number"><span class="hljs-number">6</span></span>     pivot: [<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>] [<span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>]     ,   ,                : [<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>]     ,    pivot.    <span class="hljs-number"><span class="hljs-number">1</span></span>,     l[<span class="hljs-number"><span class="hljs-number">1</span></span>]=<span class="hljs-number"><span class="hljs-number">4</span></span>     pivot: [<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>] [<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>]     ,   ,       .        : [<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>]        ,        .    ,   <span class="hljs-number"><span class="hljs-number">5.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre> <br>  To find the median using quickselect, we will highlight the quickselect into a separate function.  Our <code>quickselect_median</code> function will call <code>quickselect</code> with the necessary indices. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quickselect_median</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l, pivot_fn=random.choice)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(l) % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> quickselect(l, len(l) / <span class="hljs-number"><span class="hljs-number">2</span></span>, pivot_fn) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span> * (quickselect(l, len(l) / <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>, pivot_fn) + quickselect(l, len(l) / <span class="hljs-number"><span class="hljs-number">2</span></span>, pivot_fn)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quickselect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l, k, pivot_fn)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  k-    l (  ) :param l:    :param k:  :param pivot_fn:   pivot,     :return: k-  l """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(l) == <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> k == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> l[<span class="hljs-number"><span class="hljs-number">0</span></span>] pivot = pivot_fn(l) lows = [el <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> el <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> l <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> el &lt; pivot] highs = [el <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> el <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> l <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> el &gt; pivot] pivots = [el <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> el <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> l <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> el == pivot] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> k &lt; len(lows): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> quickselect(lows, k, pivot_fn) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> k &lt; len(lows) + len(pivots): <span class="hljs-comment"><span class="hljs-comment">#       return pivots[0] else: return quickselect(highs, k - len(lows) - len(pivots), pivot_fn)</span></span></code> </pre> <br>  In the real world, Quickselect performs well: it consumes almost no resources and runs on average for <code>O(n)</code> .  Let's prove it. <br><br><h4>  Proof of the mean time O (n) </h4><br>  On average, pivot splits the list into two approximately equal parts.  Therefore, each subsequent recursion operates with <sup>1</sup> ‚ÅÑ <sub>2</sub> data from the previous step. <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>C</mi><mo>=</mo><mi>n</mi><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>2</mn></mrow><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>4</mn></mrow><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>8</mn></mrow><mo>+</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>=</mo><mn>2</mn><mi>n</mi><mo>=</mo><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="55.882ex" height="2.66ex" viewBox="0 -832 24060.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-43" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-3D" x="1038" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-6E" x="2094" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-2B" x="2917" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-66" x="4168" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-72" x="4718" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-61" x="5170" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-63" x="5699" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-6E" x="6133" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-32" x="6733" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-2B" x="7456" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-66" x="8706" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-72" x="9257" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-61" x="9708" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-63" x="10238" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-6E" x="10671" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-34" x="11272" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-2B" x="11995" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-66" x="13245" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-72" x="13796" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-61" x="14247" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-63" x="14777" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-6E" x="15210" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-38" x="15811" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-2B" x="16311" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-2E" x="17090" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-2E" x="17535" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-2E" x="17980" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-3D" x="18425" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-32" x="19482" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-6E" x="19982" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-3D" x="20860" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-4F" x="21917" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-28" x="22680" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-6E" x="23070" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-29" x="23670" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>C</mi><mo>=</mo><mi>n</mi><mo>+</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>n</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mn>2</mn></mrow><mo>+</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>n</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mn>4</mn></mrow><mo>+</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>n</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mn>8</mn></mrow><mo>+</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>=</mo><mn>2</mn><mi>n</mi><mo>=</mo><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> C = n + \ frac {n} {2} + \ frac {n} {4} + \ frac {n} {8} + ... = 2n = O (n) </script></p><br>  There are many ways to prove that this series converges to 2n.  Instead of bringing them here, I refer to a wonderful <a href="https://en.wikipedia.org/wiki/1/2_%252B_1/4_%252B_1/8_%252B_1/16_%252B_%25E2%258B%25AF">Wikipedia article</a> dedicated to this infinite series. <br><br>  Quickselect gives us linear velocity, but only on average.  What if we are not satisfied with the average, and we want guaranteed algorithm execution in linear time? <br><br><h3>  Deterministic O (n) </h3><br>  In the previous section, I described quickselect, an algorithm with an <em>average</em> speed of <code>O(n)</code> .  ‚ÄúMedium‚Äù in this context means that, <em>on average, the</em> algorithm will be executed in <code>O(n)</code> .  From a technical point of view, we may be very unlucky: at each step we can choose the largest element as the pivot.  At each stage we will be able to get rid of one element from the list, and as a result we will get the speed <code>O(n^2)</code> , but not <code>O(n)</code> . <br><br>  With this in mind, we need an algorithm for the <em>selection of reference elements</em> .  Our goal will be to choose for linear time pivot, which in the worst case removes a sufficient number of elements to ensure the speed <code>O(n)</code> when used together with quickselect.  This algorithm was developed in 1973 by Bloom (Blum), Floyd (Floyd), Pratt (Pratt), Rivest (Rivest) and Tarjan (Tarjan).  If my explanation is not enough for you, you can study their <a href="http://people.csail.mit.edu/rivest/pubs/BFPRT73.pdf">1973 article</a> .  Instead of describing the algorithm, I will comment on my implementation in Python in detail: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pick_pivot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   pivot    l      O(n). """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> len(l) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">#   &lt; 5,    if len(l) &lt; 5: #           . #            ,   #          # . return nlogn_median(l) #   l    5 . O(n) chunks = chunked(l, 5) #       ,    . O(n) full_chunks = [chunk for chunk in chunks if len(chunk) == 5] #     .     ,    #   .     n/5 ,   #  O(n) sorted_groups = [sorted(chunk) for chunk in full_chunks] #      2 medians = [chunk[2] for chunk in sorted_groups] # ,   ,    ,   #       O(n). #      n/5,     O(n) #      pick_pivot    pivot  # quickselect. O(n) median_of_medians = quickselect_median(medians, pick_pivot) return median_of_medians def chunked(l, chunk_size): """  `l`    `chunk_size`.""" return [l[i:i + chunk_size] for i in range(0, len(l), chunk_size)]</span></span></code> </pre> <br>  Let's prove that the median median is a good pivot.  It will help us if we present the visualization of our algorithm for selecting support elements: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/th/is/4e/this4ewsnviphst8jjmmrgydh7u.png"></div><br>  The red oval is the median of the fragments, and the central circle is the median of the medians.  Don't forget, we want the pivot to share the list as evenly as possible.  In the worst possible case, each element in the blue rectangle (top left) will be less than or equal to pivot.  The upper right rectangle contains <sup>3</sup> ‚ÅÑ <sub>5</sub> half lines - <code>3/5*1/2=3/10</code> .  Therefore, at each stage, we get rid of at least 30% of the rows. <br><br>  But are we enough to discard 30% of the elements at each stage?  At each stage, our algorithm should do the following: <br><br><ul><li>  Perform O (n) work on partitioning elements </li><li>  For recursion, solve one subtask of size <sup>7</sup> ‚ÅÑ <sub>10</sub> from the original </li><li>  To calculate the median, the medians solve one subtask the size of <sup>1</sup> <sub>5</sub> from the original </li></ul><br>  As a result, we get the following equation for the total execution time <code>T(n)</code> : <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>T</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>T</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>5</mn></mrow><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><mn>7</mn><mi>T</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>10</mn></mrow><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><mi>n</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="39.634ex" height="2.66ex" viewBox="0 -832 17064.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-28" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-6E" x="1094" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-29" x="1694" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-3D" x="2361" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-54" x="3418" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-28" x="4122" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-66" x="4762" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-72" x="5312" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-61" x="5764" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-63" x="6293" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-6E" x="6727" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-35" x="7327" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-29" x="7828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-2B" x="8439" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-37" x="9440" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-54" x="9941" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-28" x="10645" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-66" x="11285" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-72" x="11835" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-61" x="12287" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-63" x="12816" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-6E" x="13250" y="0"></use><g transform="translate(13850,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-29" x="14851" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMAIN-2B" x="15463" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/346930/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiLGI49z9Mcnty3gtY3zCeiDCwkrA#MJMATHI-6E" x="16463" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>T</mi><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>n</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mn>5</mn></mrow><mo stretchy="false">)</mo><mo>+</mo><mn>7</mn><mi>T</mi><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>n</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mn>10</mn></mrow><mo stretchy="false">)</mo><mo>+</mo><mi>n</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-2"> T (n) = T (\ frac {n} {5}) + 7T (\ frac {n} {10}) + n </script></p><br>  It‚Äôs not so easy to prove why it is equal to <code>O(n)</code> .  A quick solution is to rely on the <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D1%2581%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2582%25D0%25B5%25D0%25BE%25D1%2580%25D0%25B5%25D0%25BC%25D0%25B0_%25D0%25BE_%25D1%2580%25D0%25B5%25D0%25BA%25D1%2583%25D1%2580%25D1%2580%25D0%25B5%25D0%25BD%25D1%2582%25D0%25BD%25D1%258B%25D1%2585_%25D1%2581%25D0%25BE%25D0%25BE%25D1%2582%25D0%25BD%25D0%25BE%25D1%2588%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F%25D1%2585">basic theorem on recurrence relations</a> .  We find ourselves in the third case of the theorem, in which work at each level dominates the work of subtasks.  In this case, the total work will simply be equal to the work at each level, that is, <code>O(n)</code> . <br><br><h3>  Summarize </h3><br>  We have quickselect, an algorithm that finds the median for linear time, provided there is a fairly good reference element.  We have a median median algorithm, an <code>O(n)</code> algorithm for selecting a reference element (which is good enough for quickselect).  Combining them, we got an algorithm for finding the median (or the nth element in the list) in linear time! <br><br><h3>  Medians for linear time in practice </h3><br>  In the real world it is almost always enough to randomly select a median.  Although the median median approach is still executed in linear time, in practice its calculation takes too long.  The standard <code>C++</code> uses an algorithm called <a href="https://en.wikipedia.org/wiki/Introselect">introselect</a> , in which the combination heapselect and quickselect is applied;  the limit of its execution is <code>O(n log n)</code> .  Introselect usually allows using a fast algorithm with a bad upper limit in combination with an algorithm that is slower in practice, but has a good upper limit.  Implementations start with a fast algorithm, but return to a slower one if they cannot select efficient support elements. <br><br>  In conclusion, I will give a comparison of the elements used in each of the implementations.  This is not the execution speed, but the total number of elements that the quickselect function considers.  It does not take into account the work on the calculation of the median median. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c9f/d76/788/c9fd7678817ab4943483818e208eff96.png" alt="image"></div><br>  This is what we expected!  A deterministic support element almost always considers at quickselect fewer elements than a random one.  Sometimes we get lucky and we guess the pivot from the first attempt, which manifests itself as depressions on the green line.  Math works! <br><br><hr><br><ol><li>  This can be an interesting use of bitwise sorting (radix sort) if you need to find a median in the list of integers, each of which is less than 2 <sup>32</sup> . </li><li>  In fact, Python uses Timsort, an impressive combination of theoretical limits and practical speed.  <a href="https://rcoh.me/posts/notes-on-cpython-list-internals/">Notes on lists in Python</a> . </li></ol></div><p>Source: <a href="https://habr.com/ru/post/346930/">https://habr.com/ru/post/346930/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346920/index.html">Ten startups from 1298: the story of the first global IKEA Bootcamp</a></li>
<li><a href="../346922/index.html">Interview with Oren Kaniel (CEO Appsflyer) about the mobile ecosystem, investments in technology and corporate culture</a></li>
<li><a href="../346924/index.html">How many participants can be in a WebRTC call?</a></li>
<li><a href="../346926/index.html">Design Template Projects or the complexity of managing large projects</a></li>
<li><a href="../346928/index.html">Past, present and future speech recognition technology</a></li>
<li><a href="../346932/index.html">New process of launching online games in China</a></li>
<li><a href="../346934/index.html">Review of the best reports from HighLoad ++ 2017</a></li>
<li><a href="../346936/index.html">How to fit property in one byte?</a></li>
<li><a href="../346940/index.html">Technological demo of the Book of the Dead and the new features of Unity 2018</a></li>
<li><a href="../346942/index.html">Feature Engineering, as silent online courses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>