<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Real-time mesh manipulation on Unity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the advantages of Unity as a platform for developing games is its powerful 3D engine. In this tutorial, you will learn about the world of 3D ob...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Real-time mesh manipulation on Unity</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ce5/532/c83/ce5532c83ff152100775d62091370bf2.gif" alt="image"></div><br>  One of the advantages of Unity as a platform for developing games is its powerful 3D engine.  In this tutorial, you will learn about the world of 3D objects and mesh manipulation. <br><br>  Due to the growth of virtual and augmented reality technology (VR / AR), most developers are faced with complex concepts of 3D graphics.  Let this tutorial be their starting point.  Do not worry, there will be no complicated 3D mathematics here - only hearts, pictures, arrows and a lot of interesting things! <br><a name="habracut"></a><br><blockquote>  <em>Note:</em> this tutorial is intended for users who are familiar with Unity's IDE and who have some C # programming experience.  If you do not have this knowledge, then study the tutorials <a href="https://www.raywenderlich.com/149464/introduction-to-unity-ui-part-1" rel="noopener">Introduction to Unity UI</a> and <a href="https://www.raywenderlich.com/127672/introduction-unity-scripting" rel="noopener">Introduction to Unity Scripting first</a> . <br><br>  You will need Unity version not lower than 2017.3.1.  The latest version of Unity can be downloaded <a href="https://unity3d.com/get-unity/download" rel="noopener">here</a> .  In this tutorial, the custom editor is used, for more information about them, see the tutorial <a href="https://www.raywenderlich.com/130721/extend-unity3d-editor" rel="noopener">Extending the Unity Editor</a> . </blockquote><br><h2>  Getting Started </h2><br>  To get started, familiarize yourself with the basic terms of 3D graphics, which will allow you to better understand the tutorial. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Basic technical terms for 3D graphics: <br><br><ul><li>  <em>Vertices</em> : Each vertex is a point in the 3D space. </li><li>  <em>Mesh</em> : contains all vertices, edges, triangles, normals, and UV data of the model. </li><li>  <em>Mesh Filter</em> : Stores model mesh data. </li><li>  <em>Mesh Renderer</em> : Renders mesh data in the scene. </li><li>  <em>Normals</em> : A vertex or surface vector.  It is directed outward, perpendicular to the surface of the mesh. </li><li>  <em>Lines / Edges</em> : invisible lines connecting vertices to each other. </li><li>  <em>Triangles</em> : formed by connecting three vertices. </li><li>  <em>UV-Scan (UV Map)</em> : binds the material to an object, creating texture and color for it. </li></ul><br>  The anatomy of a 3D object begins with its mesh.  The creation of this mesh starts from its vertices.  The invisible lines connecting these vertices form triangles that define the basic shape of the object. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a7/83a/4c2/5a783a4c2ed2c144ccd0d7eb97369370.gif"></div><br>  Then the normals and the UV data define shading, color, and texture.  The mesh data is stored in the mesh filter, and the mesh renderer uses this data to draw the object in the scene. <br><br>  That is, the pseudo-code for creating a 3D model looks like this: <br><br><ul><li>  Create a new mesh called myMesh. </li><li>  Add data to the properties of vertices and triangles myMesh. </li><li>  Create a new mesh filter called myMeshFilter. </li><li>  Set the myMeshFilter mesh property to myMesh. </li></ul><br>  Having dealt with the basics, download the <a href="">project</a> , unzip the files and run the project blank in Unity.  Look at the folder structure in the <em>Project</em> window: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/690/2d6/c2e/6902d6c2e14a98284c8af39055242bc7.png"></div><br>  Folder Description: <br><br><ul><li>  <em>Prefabs</em> : contains the Sphere prefab, which will be used to save the 3D mesh during the execution of the application. </li><li>  <em>Scenes</em> : contains three scenes that we use in this tutorial. </li><li>  <em>Editor</em> : The scripts inside this folder give us in the editor super powers that we use in development. </li><li>  <em>Scripts</em> : here are the runtime scripts that are attached to the GameObject and run when you click on <em>Play</em> . </li><li>  <em>Materials</em> : this folder contains material for the mesh. </li></ul><br>  In the next section, we will create a custom editor to visualize the creation of a 3D mesh. <br><br><h2>  Modifying meshes using Custom Editor </h2><br>  Open the <em>01 Mesh Study Demo</em> , located in the <em>Scenes</em> folder.  In the <em>Scene</em> window, you will see a 3D cube: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d5/ed2/812/6d5ed28123a0c65bb083c67efab702c7.gif"></div><br>  Before we start the mesh, let's take a look at the custom editor script. <br><br><h3>  Change editor script </h3><br>  Select the <em>Editor</em> folder in the <em>Project</em> window.  The scripts in this folder add functionality to the editor (Editor) during development and are not available in Build mode. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/442/653/b41/442653b41ca755b67d3a1ce42ae1ec5a.png"></div><br>  Open <em>MeshInspector.cs</em> and view the source code.  All Editor scripts must implement the <code>Editor</code> class, its <code>CustomEditor</code> attribute tells the <code>Editor</code> class what type of object it is an editor for.  <code>OnSceneGUI()</code> is an event method that allows drawing in the Scene window;  <code>OnInspectorGUI()</code> allows you to add additional GUI elements to the Inspector. <br><br>  In <em>MeshInspector.cs,</em> before starting the <code>MeshInspector</code> class <code>MeshInspector</code> add the following: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">CustomEditor(typeof(MeshStudy))</span></span>]</code> </pre> <br>  Code Explanation: The <code>CustomEditor</code> attribute tells Unity which type of object can modify the custom editor class. <br><br>  In <code>OnSceneGUI()</code> before <code>EditMesh()</code> add the following: <br><br><pre> <code class="cs hljs">mesh = target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MeshStudy; Debug.Log(<span class="hljs-string"><span class="hljs-string">"Custom editor is running"</span></span>);</code> </pre> <br>  Code Explanation: The <code>Editor</code> class has a standard <code>target</code> variable.  Here, the <code>target</code> is a conversion to <code>MeshStudy</code> .  Now the custom editor will draw all the GameObject and <em>MeshStudy.cs</em> attached to it in the Scene window.  Adding debug messages allows you to verify in the console that the custom editor is actually running. <br><br>  Save the file and return to Unity.  Go to the <em>Scripts</em> folder and drag the <em>MeshStudy.cs</em> onto the GameObject <em>Cube</em> in the <em>Hierarchy</em> to attach it. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa6/b8a/ee4/aa6b8aee48eacb8421eff3c4e1ef4be3.png"></div><br>  Now the message ‚ÄúCustom editor is running‚Äù should be displayed in the console, and this means that we did everything right!  You can delete the debug message so that it does not interfere with us in the console. <br><br><h3>  Clone and reset a mesh </h3><br>  When working with a 3D mesh in Edit mode using the custom editor, be careful not to overwrite the default Unity mesh.  If this happens, you have to restart Unity. <br><br>  To safely clone a mesh without overwriting the original form, create a copy of the mesh from the <code>MeshFilter.sharedmesh</code> property and assign it to the mesh filter again. <br><br>  To do this, double-click <em>MeshStudy.cs</em> in the <em>Scripts</em> folder to open the file in the code editor.  This script inherits from the <code>MonoBehaviour</code> class, and its <code>Start()</code> function is not executed in Edit mode. <br><br>  In <em>MeshStudy.cs,</em> before starting the <code>MeshStudy</code> class <code>MeshStudy</code> add the following: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ExecuteInEditMode</span></span>]</code> </pre> <br>  Explanation of the code: after adding this attribute, the <code>Start()</code> function will be executed in both Play mode and Edit mode.  Now we can first create an instance of the mesh object and clone it. <br><br>  In <code>InitMesh()</code> add the following code: <br><br><pre> <code class="cs hljs">oMeshFilter = GetComponent&lt;MeshFilter&gt;(); oMesh = oMeshFilter.sharedMesh; <span class="hljs-comment"><span class="hljs-comment">//1 cMesh = new Mesh(); //2 cMesh.name = "clone"; cMesh.vertices = oMesh.vertices; cMesh.triangles = oMesh.triangles; cMesh.normals = oMesh.normals; cMesh.uv = oMesh.uv; oMeshFilter.mesh = cMesh; //3 vertices = cMesh.vertices; //4 triangles = cMesh.triangles; isCloned = true; Debug.Log("Init &amp; Cloned");</span></span></code> </pre> <br>  Explanation of the code: <br><br><ol><li>  Gets the original <code>oMesh</code> mesh from the <code>MeshFilter</code> component. </li><li>  Copies to a new <code>cMesh</code> mesh <code>cMesh</code> . </li><li>  Assigns the copied mesh to the mesh filter again. </li><li>  Updates local variables. </li></ol><br>  Save the file and return to Unity.  The message ‚ÄúInit &amp; Cloned‚Äù should be displayed in the debug console.  Select the <code>Cube</code> GameObject in the <em>Hierarchy</em> and check its properties in the <em>Inspector</em> .  <em>Mesh Filter</em> should display an asset mesh called <em>clone</em> .  Fine!  This means that we have successfully cloned the mesh. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c6c/2da/3e0/c6c2da3e0e29703888bad5e50bb608a6.png"></div><br>  In the Editor folder, go to <em>MeshInspector.cs</em> .  In <code>OnInspectorGUI()</code> , after the second line of code, add the following: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GUILayout.Button(<span class="hljs-string"><span class="hljs-string">"Reset"</span></span>)) <span class="hljs-comment"><span class="hljs-comment">//1 { mesh.Reset(); //2 }</span></span></code> </pre> <br>  Explanation of the code: <br><br><ol><li>  This code draws the Reset button in the <em>Inspector</em> . </li><li>  When clicked, it calls the <code>Reset()</code> function in <em>MeshStudy.cs</em> . </li></ol><br>  Save the file, open <em>MeshStudy.cs</em> and add the following code to the <code>Reset()</code> function: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cMesh != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; oMesh != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-comment"><span class="hljs-comment">//1 { cMesh.vertices = oMesh.vertices; //2 cMesh.triangles = oMesh.triangles; cMesh.normals = oMesh.normals; cMesh.uv = oMesh.uv; oMeshFilter.mesh = cMesh; //3 vertices = cMesh.vertices; //4 triangles = cMesh.triangles; }</span></span></code> </pre> <br>  Explanation of the code: <br><br><ol><li>  Check for the existence of the original and cloned mesh. </li><li>  Reset <code>cMesh</code> to the source mesh. </li><li>  Assign <code>cMesh</code> <code>oMeshFilter</code> . </li><li>  Update local variables. </li></ol><br>  Save the file and return to Unity.  In the <em>Inspector,</em> click on the <em>Test Edit</em> button to distort the cube mesh.  Next, click the <em>Reset</em> button;  the cube should return to the original form. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c3/a8a/e22/0c3a8ae22c8f8382dd46ee652b4b6eea.gif"></div><br><h3>  Explaining vertices and triangles in Unity </h3><br>  A mesh consists of vertices connected by edges to triangles.  Triangles define the basic shape of an object. <br><br><blockquote>  <em>Mesh class:</em> <br><br><ul><li>  Vertices are stored as an array of <code>Vector3</code> values. </li><li>  Triangles are stored as an array of integer corresponding to the indices of the array of vertices. </li></ul><br>  That is, in a simple Quad mesh, consisting of four vertices and two triangles, the mesh data will look like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56c/56d/794/56c56d794628ff20592f801340308790.gif"></div></blockquote><br><h3>  Vertex mapping </h3><br>  Here we want to display the vertices of the cube as blue dots. <br><br>  In <em>MeshInspector.cs,</em> go to the <code>EditMesh()</code> function and add the following: <br><br><pre> <code class="cs hljs">handleTransform = mesh.transform; <span class="hljs-comment"><span class="hljs-comment">//1 handleRotation = Tools.pivotRotation == PivotRotation.Local ? handleTransform.rotation : Quaternion.identity; //2 for (int i = 0; i &lt; mesh.vertices.Length; i++) //3 { ShowPoint(i); }</span></span></code> </pre> <br>  Explanation of the code: <br><br><ol><li>  <code>handleTransform</code> gets Transform values ‚Äã‚Äãfrom <code>mesh</code> . </li><li>  <code>handleRotation</code> gets the current hinge Rotation mode. </li><li>  Go around the vertices of the mesh and draw the points with <code>ShowPoint()</code> . </li></ol><br>  In the <code>ShowPoint()</code> function, immediately after the <code>//draw dot</code> comment, add the following: <br><br><pre> <code class="cs hljs">Vector3 point = handleTransform.TransformPoint(mesh.vertices[index]);</code> </pre> <br>  Explanation of the code: this string converts the local position of the vertex into a coordinate in world space. <br><br>  In the same function, in the <code>if</code> block, immediately after the newly added line of code, add the following: <br><br><pre> <code class="cs hljs">Handles.color = Color.blue; point = Handles.FreeMoveHandle(point, handleRotation, mesh.handleSize, Vector3.zero, Handles.DotHandleCap);</code> </pre> <br>  Explanation of the code: <br><br><ol><li>  Sets the color, size, and position of a point using the <code>Handles</code> auxiliary class. </li><li>  <code>Handles.FreeMoveHandle()</code> creates an unrestricted motion manipulator that simplifies the drag and drop operation, which will come in handy in the next section. </li></ol><br>  Save the file and return to Unity.  Check the cube property in the <em>Inspector</em> and make sure the <em>Move Vertex Point</em> option is on.  You should now see that the mesh on the screen is marked with a few blue dots.  Here they are - the tops of the cube mesh!  Try doing this with other 3D objects and observe the results. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d78/3aa/205/d783aa2054dd9ca81ee7a6c948c7c00a.gif"></div><br><h3>  Move a single vertex </h3><br>  Let's start with the simplest step of manipulating the mesh - moving a single vertex. <br><br>  Navigate to <em>MeshInspector.cs</em> .  Inside the <code>ShowPoint()</code> function, immediately after the <code>//drag</code> comment and right before the closing brackets of the <code>if</code> block, add the following: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GUI.changed) <span class="hljs-comment"><span class="hljs-comment">//1 { mesh.DoAction(index, handleTransform.InverseTransformPoint(point)); //2 }</span></span></code> </pre> <br>  Explanation of the code: <br><br><ol><li>  <code>GUI.changed</code> tracks all changes that occur with points, and works well with <code>Handles.FreeMoveHandle()</code> to recognize the drag and drop operation. </li><li>  For the dragged vertex, the <code>mesh.DoAction()</code> function receives its index and Transform values ‚Äã‚Äãas parameters.  Since the Transform vertex values ‚Äã‚Äãare in world space, we transform them into local space using <code>InverseTransformPoint()</code> . </li></ol><br>  Save the script file and go to <em>MeshStudy.cs</em> .  In <code>DoAction()</code> , after the opening parentheses add the following: <br><br><pre> <code class="cs hljs">PullOneVertex(index, localPos);</code> </pre> <br>  Then add the following to the <code>PullOneVertex()</code> function: <br><br><pre> <code class="cs hljs">vertices[index] = newPos; <span class="hljs-comment"><span class="hljs-comment">//1 cMesh.vertices = vertices; //2 cMesh.RecalculateNormals(); //3</span></span></code> </pre> <br>  Explanation of the code: <br><br><ol><li>  We update the target vertex with the value of <code>newPos</code> . </li><li>  <code>cMesh.vertices</code> values ‚Äã‚Äãof the updated vertices back to <code>cMesh.vertices</code> . </li><li>  In <code>RecalculateNormals()</code> recalculate and redraw the mesh to match the changes. </li></ol><br>  Save the file and return to Unity.  Try dragging points on a cube;  Did you see a broken mesh? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fca/ccf/c86/fcaccfc865e30b3c922e6cabcf9f79d7.gif"></div><br>  It seems that some of the vertices have the same position, so when we drag only one, the other vertices remain behind it, and the mesh breaks.  In the next section, we will fix this problem. <br><br><h3>  Finding all similar vertices </h3><br>  Visually, the cube mesh consists of eight vertices, six sides and 12 triangles.  Let's check it out. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/253/a30/b3f/253a30b3fcca7b0d9028d92b4c4149c2.gif"></div><br>  Open <em>MeshStudy.cs</em> , take a look at the place in front of the <code>Start()</code> function and find the variable <code>vertices</code> .  We will see the following: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">HideInInspector</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3[] vertices;</code> </pre> <br>  Code Explanation: <code>[HideInInspector]</code> hides the shared variable from the <em>Inspector</em> window. <br><br>  Comment out this attribute: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//[HideInInspector] public Vector3[] vertices;</span></span></code> </pre> <br><blockquote>  <em>Note:</em> Hiding vertex values ‚Äã‚Äãhelps <code>[HideInInspector]</code> in the case of more complex 3D meshes.  Since the size of the array of vertices can reach thousands of elements, this can lead to Unity inhibition when trying to view the value of the array in the Inspector. </blockquote><br>  Save the file and return to Unity.  Go to the <em>Inspector</em> .  Now the <em>vertices</em> property has appeared under the <em>Mesh Study</em> script component.  Click the arrow icon next to it;  this will <code>Vector3</code> array of <code>Vector3</code> elements. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/feb/f83/fd0/febf83fd02d469734b73910b1769d670.gif"></div><br>  You can see that the size of the array is 24, that is, there are vertices that have the same position!  Before you continue, do not forget to uncomment <code>[HideInInspector]</code> . <br><br><div class="spoiler">  <b class="spoiler_title">Why is vertex 24?</b> <div class="spoiler_text">  There are many theories about this.  But the simplest answer is this: the cube has six sides, and each side is composed of four vertices that form a plane. <br><br>  Therefore, the calculation is as follows: 6 x 4 = 24 vertices. <br><br>  You can search for other answers.  But for now, it‚Äôs enough just to know that some meshes will have vertices that have the same position. </div></div><br>  In <em>MeshStudy.cs,</em> replace <em>all the</em> code inside the <code>DoAction()</code> function with the following: <br><br><pre> <code class="cs hljs">PullSimilarVertices(index, localPos);</code> </pre> <br>  Go to the <code>PullSimilarVertices()</code> function and add the following: <br><br><pre> <code class="cs hljs">Vector3 targetVertexPos = vertices[index]; <span class="hljs-comment"><span class="hljs-comment">//1 List&lt;int&gt; relatedVertices = FindRelatedVertices(targetVertexPos, false); //2 foreach (int i in relatedVertices) //3 { vertices[i] = newPos; } cMesh.vertices = vertices; //4 cMesh.RecalculateNormals();</span></span></code> </pre> <br>  Explanation of the code: <br><br><ol><li>  get the position of the target vertex, which will be used as an argument to the <code>FindRelatedVertices()</code> method. </li><li>  This method returns a list of indexes (corresponding to vertices) that have the same position as the target vertex. </li><li>  The loop traverses the entire list and sets the corresponding vertices to the value of <code>newPos</code> . </li><li>  <code>cMesh.vertices</code> updated <code>vertices</code> back to <code>cMesh.vertices</code> .  Then call <code>RecalculateNormals()</code> to redraw the mesh with the new values. </li></ol><br>  Save the file and return to Unity.  Drag any of the vertices;  now the mesh must retain its shape and not collapse. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b1b/66d/bcc/b1b66dbccb73ac3a8ad8c56594611919.gif"></div><br>  Now that we have completed the first step in manipulating the meshes, save the scene and move on to the next section. <br><br><h2>  Manipulating Meshes </h2><br>  In this section, you will learn about real-time mesh manipulation.  There are many ways, but in this tutorial we will look at the most simple type of manipulation of meshes, namely the movement of previously created mesh vertices. <br><br><h3>  Collect selected indexes </h3><br>  We start by selecting the vertices that we will move in real time. <br><br>  Open Scene <em>02 Create Heart Mesh</em> from the <em>Scenes</em> folder.  In the Scene window, you will see a red sphere.  Select <em>Sphere</em> in the <em>Hierarchy</em> and go to the <em>Inspector</em> .  You'll see that the <em>Heart Mesh</em> script component is attached to the object. <br><br>  Now we need the Editor script for this object to display the vertices of the mesh in the Scene window.  Go to the <em>Editor</em> folder and double-click on <em>HeartMeshInspector.cs</em> . <br><br>  In the <code>ShowHandle()</code> function, add the following inside the <code>if</code> block: <br><br><pre> <code class="cs hljs">Handles.color = Color.blue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Handles.Button(point, handleRotation, mesh.pickSize, mesh.pickSize, Handles.DotHandleCap)) <span class="hljs-comment"><span class="hljs-comment">//1 { mesh.selectedIndices.Add(index); //2 }</span></span></code> </pre> <br>  Explanation of the code: <br><br><ol><li>  Sets and displays the vertices of the mesh as the type <code>Handles.Button</code> . </li><li>  When clicked, it adds the selected index to the list of pressed, <code>mesh.selectedIndices</code> . </li></ol><br>  In <code>OnInspectorGUI()</code> , before the closing bracket, add the following: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GUILayout.Button(<span class="hljs-string"><span class="hljs-string">"Clear Selected Vertices"</span></span>)) { mesh.ClearAllData(); }</code> </pre> <br>  Explanation of the code: this is how we add the Reset button in the <em>Inspector</em> to call <code>mesh.ClearAllData()</code> . <br><br>  Save the file and open <em>HeartMesh.cs</em> from the <em>Scripts</em> folder.  In the <code>ClearAllData()</code> function, add the following: <br><br><pre> <code class="cs hljs">selectedIndices = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); targetIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; targetVertex = Vector3.zero;</code> </pre> <br>  Code Explanation: The code clears the values ‚Äã‚Äãin <code>selectedIndices</code> and <code>targetIndex</code> .  It also resets <code>targetVertex</code> . <br><br>  Save the file and return to Unity.  Select <em>Sphere</em> and go to the <em>Inspector</em> component of the <em>HeartMesh</em> script.  Expand <em>Selected Indices</em> by clicking on the arrow icon next to it.  This will allow us to track every vertex added to the list. <br><br>  Enable <em>Is Edit Mode</em> using the checkbox next to it.  Due to this, the mesh vertices will be drawn in the Scene window.  When clicking on the blue dots in <em>Selected Indices</em> , the values ‚Äã‚Äãshould change accordingly.  Also test the <em>Clear Selected Vertices</em> button to make sure it clears all values. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/17a/271/dea/17a271dea970e9c3ade451773b87eb65.gif"></div><br>  <em>Note:</em> in the modified custom <em>Inspector</em> we have the option to show / hide the transform manipulator using the <em>Show Transform Handle</em> .  So do not panic if you do not find the Transform manipulator in other scenes!  Turn it on before quitting. <br><br><h3>  Turning a sphere into a heart </h3><br>  Changing the vertices of the mesh in real time essentially consists of three stages: <br><br><ol><li>  Copy the current mesh vertices (before the animation) into <code>mVertices</code> . </li><li>  <code>mVertices</code> calculations and change values ‚Äã‚Äãin <code>mVertices</code> . </li><li>  Update the current mesh vertices with <code>mVertices</code> as they change at each stage and let Unity automatically calculate the normals. </li></ol><br>  Open <em>HeartMesh.cs</em> and the following variables before the <code>Start()</code> function: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> radiusofeffect = <span class="hljs-number"><span class="hljs-number">0.3f</span></span>; <span class="hljs-comment"><span class="hljs-comment">//1 public float pullvalue = 0.3f; //2 public float duration = 1.2f; //3 int currentIndex = 0; //4 bool isAnimate = false; float starttime = 0f; float runtime = 0f;</span></span></code> </pre> <br>  Explanation of the code: <br><br><ol><li>  The radius of the area affected by the target vertex. </li><li>  Dragging Force. </li><li>  The duration of the animation. </li><li>  The current index of the <code>selectedIndices</code> list. </li></ol><br>  In the <code>Init()</code> function, before the <code>if</code> block, add the following: <br><br><pre> <code class="cs hljs">currentIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br>  The explanation of the code: at the beginning of the game <code>currentIndex</code> assigned the value 0 - the first index of the <code>selectedIndices</code> list. <br><br>  In the same <code>Init()</code> function, before the closing bracket of the <code>else</code> block, add the following: <br><br><pre> <code class="cs hljs">StartDisplacement();</code> </pre> <br>  Explanation of code: run the <code>StartDisplacement()</code> function if <code>isEditMode</code> is false. <br><br>  Inside the <code>StartDisplacement()</code> function, add the following: <br><br><pre> <code class="cs hljs">targetVertex = oVertices[selectedIndices[currentIndex]]; <span class="hljs-comment"><span class="hljs-comment">//1 starttime = Time.time; //2 isAnimate = true;</span></span></code> </pre> <br>  Explanation of the code: <br><br><ol><li>  Select the <code>targetVertex</code> to start the animation. </li><li>  Set the start time and change the <code>isAnimate</code> value to true. </li></ol><br>  After the <code>StartDisplacement()</code> function, we will create a <code>FixedUpdate()</code> function with the following code: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//1 { if (!isAnimate) //2 { return; } runtime = Time.time - starttime; //3 if (runtime &lt; duration) //4 { Vector3 targetVertexPos = oFilter.transform.InverseTransformPoint(targetVertex); DisplaceVertices(targetVertexPos, pullvalue, radiusofeffect); } else //5 { currentIndex++; if (currentIndex &lt; selectedIndices.Count) //6 { StartDisplacement(); } else //7 { oMesh = GetComponent&lt;MeshFilter&gt;().mesh; isAnimate = false; isMeshReady = true; } } }</span></span></span></span></code> </pre> <br>  Explanation of the code: <br><br><ol><li>  The <code>FixedUpdate()</code> function is executed in a loop with a fixed FPS. </li><li>  If <code>isAnimate</code> is false, then skip the following code. </li><li>  Change the <code>runtime</code> animation. </li><li>  If the <code>runtime</code> is within the <code>duration</code> , then we get the world coordinates of <code>targetVertex</code> and <code>DisplaceVertices()</code> , covering the target vertex with the parameters <code>pullvalue</code> and <code>radiusofeffect</code> . </li><li>  Otherwise, time is over.  Add to <code>currentIndex</code> unit. </li><li>  Check if <code>currentIndex</code> among <code>selectedIndices</code> .  Go to the next vertex in the list using <code>StartDisplacement()</code> . </li><li>  Otherwise, at the end of the list, change the <code>oMesh</code> data to the current mesh and <code>isAnimate</code> to false to stop the animation. </li></ol><br>  Add the following to <code>DisplaceVertices()</code> : <br><br><pre> <code class="cs hljs">Vector3 currentVertexPos = Vector3.zero; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sqrRadius = radius * radius; <span class="hljs-comment"><span class="hljs-comment">//1 for (int i = 0; i &lt; mVertices.Length; i++) //2 { currentVertexPos = mVertices[i]; float sqrMagnitute = (currentVertexPos - targetVertexPos).sqrMagnitude; //3 if (sqrMagnitute &gt; sqrRadius) { continue; //4 } float distance = Mathf.Sqrt(sqrMagnitute); //5 float falloff = GaussFalloff(distance, radius); Vector3 translate = (currentVertexPos * force) * falloff; //6 translate.z = 0f; Quaternion rotation = Quaternion.Euler(translate); Matrix4x4 m = Matrix4x4.TRS(translate, rotation, Vector3.one); mVertices[i] = m.MultiplyPoint3x4(currentVertexPos); } oMesh.vertices = mVertices; //7 oMesh.RecalculateNormals();</span></span></code> </pre> <br>  Explanation of the code: <br><br><ol><li>  Square radius. </li><li>  We loop around each vertex of the mesh. </li><li>  <code>sqrMagnitude</code> between <code>currentVertexPos</code> and <code>targetVertexPos</code> . </li><li>  If <code>sqrMagnitude</code> exceeds <code>sqrRadius</code> , then go to the next vertex. </li><li>  Otherwise, we continue by determining the <code>falloff</code> value, depending on the <code>distance</code> current vertex from the central point of the area of ‚Äã‚Äãaction. </li><li>  <code>Vector3</code> new position of <code>Vector3</code> and apply its Transform to the current vertex. </li><li>  When exiting the loop, assign the changed <code>mVertices</code> values ‚Äã‚Äãto the <code>mVertices</code> , and force Unity to recalculate the normals. </li></ol><br><blockquote>  <em>Falloff source</em> <br>  The original formula is taken from the <a href="https://assetstore.unity.com/packages/essentials/tutorial-projects/procedural-examples-5141" rel="noopener">Procedural Examples</a> asset package file, which can be downloaded for free from the Unity Asset Store. </blockquote><br>  Save the file and return to Unity.  Select <em>Sphere</em> , go to the <em>HeartMesh</em> component and try adding a few vertices to the <em>Selected Indices</em> property.  Disable <em>Is Edit mode</em> and click <em>Play</em> to view the result of your work. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1e/527/23b/e1e52723b08453591da6d10a28dbe13d.gif"></div><br>  Experiment with the <em>Radiusofeffect</em> , <em>Pullvalue,</em> and <em>Duration</em> values ‚Äã‚Äãto get different results.  When you are ready, change the settings according to the screenshot below. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a63/c44/082/a63c44082183529e737f287cb746dfd6.png"></div><br>  Click on <em>Play</em> .  Has your sphere turned into a heart? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ce5/532/c83/ce5532c83ff152100775d62091370bf2.gif"></div><br>  Congratulations!  In the next section, we will save the mesh to a prefab for future use. <br><br><h3>  Saving the mesh in real time </h3><br>  To save the procedural mesh in the shape of a heart in Play mode, you need to prepare a prefab, a child of which will be a 3D object, and then replace it with a new mesh asset using a script. <br><br>  In the <em>Project</em> window <em>,</em> find the <em>CustomHeart</em> in the <em>Prefabs</em> folder.  Click the arrow icon to expand its contents and select <em>Child</em> .  Now you see the Sphere object in the <em>Inspector</em> preview window.  This is the prefab that will store the new mesh data. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a3/f07/048/9a3f070486f3a66ee56304dae5bd2b12.png"></div><br>  Open <em>HeartMeshInspector.cs</em> .  Inside the <code>OnInspectorGUI()</code> function, add the following before the closing bracket: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mesh.isEditMode &amp;&amp; mesh.isMeshReady) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> path = <span class="hljs-string"><span class="hljs-string">"Assets/Prefabs/CustomHeart.prefab"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//1 if (GUILayout.Button("Save Mesh")) { mesh.isMeshReady = false; Object pfObj = AssetDatabase.LoadAssetAtPath(path, typeof(GameObject)); //2 Object pfRef = AssetDatabase.LoadAssetAtPath (path, typeof(GameObject)); GameObject gameObj = (GameObject)PrefabUtility.InstantiatePrefab(pfObj); Mesh pfMesh = (Mesh)AssetDatabase.LoadAssetAtPath(path, typeof(Mesh)); //3 if (!pfMesh) { pfMesh = new Mesh(); } else { pfMesh.Clear(); } pfMesh = mesh.SaveMesh(); //4 AssetDatabase.AddObjectToAsset(pfMesh, path); gameObj.GetComponentInChildren&lt;MeshFilter&gt;().mesh = pfMesh; //5 PrefabUtility.ReplacePrefab(gameObj, pfRef, ReplacePrefabOptions.Default); //6 Object.DestroyImmediate(gameObj); //7 } }</span></span></code> </pre> <br>  Explanation of the code: <br><br><ol><li>  Sets the <code>path</code> value of the CustomHeart <em>prefab</em> object <em>path</em> . </li><li>  Creates two objects from the CustomHeart <em>prefab</em> , one to create an instance as a GameObject ( <code>pfObj</code> ), the second as links ( <code>pfRef</code> ). </li><li>  Creates <em>an</em> instance of the pfMesh mesh from <code>pfMesh</code> .  If not found, creates a new mesh, otherwise clears the existing data. </li><li>  Fills <code>pfMesh</code> with new mesh data, and then adds it as an asset to <em>CustomHeart</em> . <br></li><li>  Fills the mesh asset in <code>gameObj</code> with the <code>gameObj</code> value. </li><li>  Replaces <em>CustomHeart</em> with <code>gameObj</code> matching pre-existing connections. </li><li>  Instantly destroy <code>gameObj</code> . </li></ol><br>  Save the file and go to <em>HeartMesh.cs</em> .  In the general <code>SaveMesh()</code> method, after creating an instance of <code>nMesh</code> add the following: <br><br><pre> <code class="cs hljs">nMesh.name = <span class="hljs-string"><span class="hljs-string">"HeartMesh"</span></span>; nMesh.vertices = oMesh.vertices; nMesh.triangles = oMesh.triangles; nMesh.normals = oMesh.normals;</code> </pre> <br>  Explanation of the code: returns an asset of the mesh with values ‚Äã‚Äãfrom the heart-shaped mesh. <br><br>  Save the file and return to Unity.  Click <em>play</em> .  When the animation is complete, the <em>Save Mesh</em> button will appear in the <em>Inspector</em> .  Click the button to save the new mesh, and then stop the player. <br><br>  Go to the <em>Prefabs</em> folder and look at the CustomHeart <em>prefab</em> .  You should see that now in the CustomHeart <em>prefab</em> object there is a completely new heart-shaped mesh. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/126/dee/103/126dee103ce798611d2dc2e94013c23c.png"></div><br>  <i>Great job!</i> <br><br><h2>  We put everything together </h2><br>  In the previous scene, the <code>DisplaceVertices()</code> function used the Falloff formula to determine the drag force that was applied to each vertex within a given radius.  The ‚Äúfall off‚Äù point at which the drag force begins to decrease depends on the type of falloff used: Linear, Gaussian, or Needle.  Each type creates different results in the mesh. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ff/284/9c0/9ff2849c0d0fe5f9d496d641c07e35d8.png"></div><br>  In this section, we will look at another way of manipulating vertices: using a given curve.  Taking the rule that the speed is equal to the distance divided by time (d = (v / t)), we can determine the position of the vector, referring to its distance divided by time. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b8/2d6/13c/3b82d613cedaf85e12db66beb6349201.gif"></div><br><h3>  Using the curve method </h3><br>  Save the current scene and open <em>03 Customize Heart Mesh</em> from the <em>Scenes</em> folder.  You will see in the <em>Hierarchy an</em> instance of the CustomHeart <em>prefab</em> .  Click the arrow icon next to it to expand its contents and select <em>Child</em> . <br><br>  View its properties in the <em>Inspector</em> .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You will see the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesh Filter</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> component </font><font style="vertical-align: inherit;">with the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heart Mesh</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> asset </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Attach the </font><em><font style="vertical-align: inherit;">Custom Heart</font></em><font style="vertical-align: inherit;"> script </font><font style="vertical-align: inherit;">to </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Child</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as a component </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Now the asset should change from </font><em><font style="vertical-align: inherit;">HeartMesh</font></em><font style="vertical-align: inherit;"> to </font><em><font style="vertical-align: inherit;">clone</font></em><font style="vertical-align: inherit;"> .</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/954/27f/89d/95427f89d17410e26893a0ec27dff51d.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next, open </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CustomHeart.cs</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scripts</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">. </font></font><code>Start()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add the following </font><font style="vertical-align: inherit;">before the function </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CurveType { Curve1, Curve2 } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CurveType curveType; Curve curve;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Explanation of the code: a generic enum (enum) is created here </font></font><code>CurveType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, after which it is made available from the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inspector</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go to </font></font><code>CurveType1()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and add the following:</font></font><br><br><pre> <code class="cs hljs">Vector3[] curvepoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3[<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//1 curvepoints[0] = new Vector3(0, 1, 0); curvepoints[1] = new Vector3(0.5f, 0.5f, 0); curvepoints[2] = new Vector3(1, 0, 0); curve = new Curve(curvepoints[0], curvepoints[1], curvepoints[2], false); //2</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Explanation of the code: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A simple curve consists of three points. </font><font style="vertical-align: inherit;">Set the points for the first curve.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We generate the first curve with the help </font></font><code>Curve()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and we assign its values </font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The drawn curve can be displayed in the preview, if the last parameter is true.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go to </font></font><code>CurveType2()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and add the following:</font></font><br><br><pre> <code class="cs hljs">Vector3[] curvepoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3[<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//1 curvepoints[0] = new Vector3(0, 0, 0); curvepoints[1] = new Vector3(0.5f, 1, 0); curvepoints[2] = new Vector3(1, 0, 0); curve = new Curve(curvepoints[0], curvepoints[1], curvepoints[2], false); //2</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Explanation of the code: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Set the points for the second curve. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generate the second curve with </font></font><code>Curve()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and assign its values </font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The drawn curve can be displayed in the preview, if the last parameter is true.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B </font></font><code>StartDisplacement()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, before the closing bracket add the following:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (curveType == CurveType.Curve1) { CurveType1(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (curveType == CurveType.Curve2) { CurveType2(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Explanation of the code: here we check the option selected by the user </font></font><code>curveType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and generate it accordingly </font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B </font></font><code>DisplaceVertices()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, inside the cycle operator, </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">before the closing brackets add the following:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> increment = curve.GetPoint(distance).y * force; <span class="hljs-comment"><span class="hljs-comment">//1 Vector3 translate = (vert * increment) * Time.deltaTime; //2 Quaternion rotation = Quaternion.Euler(translate); Matrix4x4 m = Matrix4x4.TRS(translate, rotation, Vector3.one); mVertices[i] = m.MultiplyPoint3x4(mVertices[i]);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Explanation of the code: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We </font><font style="vertical-align: inherit;">get the </font><font style="vertical-align: inherit;">position of the curve on the given one </font></font><code>distance</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and multiply its value </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">by </font></font><code>force</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to get </font></font><code>increment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create a new data type </font></font><code>Vector3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to store the new position of the current vertex and apply its Transform accordingly.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Save the file and return to Unity. </font><font style="vertical-align: inherit;">Check the properties of the component </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CustomHeart</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> game object </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Child</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">You will see a drop-down list where you can select the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Curve Type</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edit Type</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> drop-down list, </font><font style="vertical-align: inherit;">select </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add Indices</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remove Indices</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to update the list of vertices and experiment with different settings.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/792/1a7/3b6/7921a73b676b205bd33ec1db076cd4a6.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> To see detailed results for different types of curves, enter values ‚Äã‚Äãaccording to the screenshot: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e06/ab3/e5d/e06ab3e5d0bfc950be0c6dbc82d36f6e.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Curve Type</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> list, </font><font style="vertical-align: inherit;">select the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Curve1</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> value </font><font style="vertical-align: inherit;">, make sure that </font><em><font style="vertical-align: inherit;">None is</font></em><font style="vertical-align: inherit;"> selected </font><font style="vertical-align: inherit;">for the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edit Type</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and click </font><em><font style="vertical-align: inherit;">Play</font></em><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">You should see the mesh diverge into the pattern. </font><font style="vertical-align: inherit;">Twist the model to see it in the side view, and compare the results for both types of curves. </font><font style="vertical-align: inherit;">Here you can see how the selected </font><em><font style="vertical-align: inherit;">Curve Type</font></em><font style="vertical-align: inherit;"> affects the mesh offset.</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e1/f90/4d5/8e1f904d50987247014011ac32261134.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/da0/e1a/df4/da0e1adf49f8503188f47826c4079cf1.png"></div><br>  That's all!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can click on </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clear Selected Vertices</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to reset the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selected Indices</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and experiment with your own patterns. </font><font style="vertical-align: inherit;">But do not forget that there are other factors that will affect the final result of the mesh, namely:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Radius value. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The distribution of vertices in the region. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The position of the pattern of the selected vertices. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The method chosen for the offset. </font></font></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Where to go next? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Files of the finished project are in the </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">archive of the project</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tutorial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do not stop at this! </font><font style="vertical-align: inherit;">Try to use more complex techniques used in the tutorial </font></font><a href="https://habr.com/post/353104/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Procedural generation of mazes in Unity"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I hope you liked this tutorial, and the information was useful. </font><font style="vertical-align: inherit;">Special thanks go to </font></font><a href="http://catlikecoding.com/about/" rel="noopener"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jasper Flick</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from </font></font><a href="http://catlikecoding.com/" rel="noopener"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catlike Coding</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for his great tutorials that helped me build a demo for my project.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/190/e37/362/190e3736241796c39eac74bbe3ddc86e.png"></div></div><p>Source: <a href="https://habr.com/ru/post/428796/">https://habr.com/ru/post/428796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../428786/index.html">Quantum processor based on spin resonance and manipulations with singlet-triplet system</a></li>
<li><a href="../428788/index.html">Under the hood of Bitfury Clarke - how our new mining chip works</a></li>
<li><a href="../428790/index.html">We write chat bot for VKontakte on python using longpoll. Part two. Double cycles, exceptions and other heresy</a></li>
<li><a href="../428792/index.html">The new Apple T2 chip makes it difficult to audition through the built-in laptop microphone</a></li>
<li><a href="../428794/index.html">Overview of the main mathematical optimization methods for problems with constraints</a></li>
<li><a href="../428798/index.html">How to survive indie developer. Part 2</a></li>
<li><a href="../428800/index.html">Cooking perfect CSS</a></li>
<li><a href="../428806/index.html">Analysis of consumer check: what they buy on Amazon</a></li>
<li><a href="../428808/index.html">Small convenience in student life</a></li>
<li><a href="../428810/index.html">18 digital audio technologies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>