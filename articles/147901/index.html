<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A fresh look at impurities in javascript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I will explore impurities in detail in JavaScript, and show a less common, but, in my opinion, more natural ‚Äúmixing‚Äù strategy, which ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A fresh look at impurities in javascript</h1><div class="post__text post__text-html js-mediator-article">  In this article, I will explore impurities in detail in JavaScript, and show a less common, but, in my opinion, more natural ‚Äúmixing‚Äù strategy, which I hope you will find useful.  I will end with a matrix of profiling results, summarizing the impact on the performance of each technique.  (Many thanks to the brilliant <a href="https://twitter.com/kitcambridge">@kitcambridge</a> for <a href="https://twitter.com/kitcambridge">reviewing</a> and improving the code this post is based on!) <br><br><h4>  Reuse of functions </h4> In JavaScript, each object refers to a prototype object from which it can inherit properties.  Prototypes are excellent tools for code reuse: a single prototype instance can define properties of an infinite number of dependent entities.  Prototypes can also be inherited from other prototypes, thus forming chains of prototypes that more or less follow the inheritance hierarchy of ‚Äúclass‚Äù languages ‚Äã‚Äãsuch as Java and C ++.  Multi-storey inheritance hierarchies are sometimes useful in describing the natural order of things, but if the primary motive is code reuse, such hierarchies can quickly become twisted labyrinths of meaningless subclasses, tedious redundancies, and uncontrollable logic (‚Äúbutton is a rectangle or control? That's what, let's inherit <code>Button</code> from <code>Rectangle</code> , and <code>Rectangle</code> can inherit from <code>Control</code> ... so, stop ... "). <br><a name="habracut"></a><br>  Fortunately, when it comes to reusing functions, JavaScript offers viable alternatives.  In contrast to more rigidly structured languages, objects in JavaScript can call any public function regardless of pedigree.  The most straightforward approach is delegation;  Any public function can be called directly via <code>call</code> or <code>apply</code> .  This is an effective feature, and I use it extensively.  Anyway, delegation is so convenient that sometimes it starts working against structural code discipline;  moreover, the syntax may become slightly verbose.  Impurities are a great compromise that allows you to borrow and have access to whole functional units using minimalistic syntax, and they work fine in the same team with prototypes.  They offer the descriptive power of hierarchical inheritance without the brain problems associated with high-rise, single-root inheritance. <br><br><h4>  The basics </h4>  In programming, an impurity is a class that defines a set of functions related to a type (for example, <code>Person</code> , <code>Circle</code> , <code>Observer</code> ).  Impurity classes are usually considered abstract in the sense that they do not have instances on their own ‚Äî instead, their methods are copied (or ‚Äúborrowed‚Äù) by concrete classes as ‚Äúinheritance‚Äù of behavior without entering into formal relationships with the supplier of behavior. <br>  OK, but this is JavaScript, and we have no classes.  This is, in fact, good, because it means that instead we can use objects (instances), which gives clarity and flexibility: our impurities can be an ordinary object, prototype or function ‚Äî in any case, the process of ‚Äúmixing‚Äù becomes transparent and obvious. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Using </h4>  I intend to discuss several impurity techniques, but all the code examples boil down to one use-case: creating round, oval or straight buttons.  Here is a schematic view (created using the latest hi-tech gadgets).  In the rectangles - impurities, in the circles - full buttons. <br><img src="https://habrastorage.org/getpro/habr/post_images/1b3/31b/d92/1b331bd9277864b2065e4cf2550c3898.jpg"><br><br><h4>  1. Classic impurities </h4>  Having looked at the first two pages of Google‚Äôs issue for the javascript mixin request, I noticed that most authors define impurity objects as a full-fledged type with a designer and methods defined in the prototype.  You can consider this as a natural progress - previously the impurities were classes, and this is the closest to the classes that JS has.  Here is a mixture of a circle created in this style: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Circle = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{}; Circle.prototype = { <span class="hljs-attr"><span class="hljs-attr">area</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius; }, <span class="hljs-attr"><span class="hljs-attr">grow</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius++; }, <span class="hljs-attr"><span class="hljs-attr">shrink</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius--; } };</code> </pre> <br>  In practice, however, such a heavy mixture is superfluous.  A simple object literal is enough: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> circleFns = { <span class="hljs-attr"><span class="hljs-attr">area</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius; }, <span class="hljs-attr"><span class="hljs-attr">grow</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius++; }, <span class="hljs-attr"><span class="hljs-attr">shrink</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius--; } };</code> </pre> <br><br><h4>  Extend function </h4>  How does such an admixture object mix into our objects?  Using the <code>extend</code> function (sometimes called <code>augment</code> ).  In general, <code>extend</code> simply copies (but does not clone) the impurity functions to the receiving object.  A quick overview shows several small variations of this implementation.  For example, Prototype.js skips the <code>hasOwnProperty</code> check (assuming the impurity does not have enumerated properties in the prototype chain), while other versions assume that you only want to copy properties from the impurity prototype.  Here is a safe and flexible option ... <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">extend</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">destination, source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> k <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> source) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (source.hasOwnProperty(k)) { destination[k] = source[k]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> destination; }</code> </pre> <br>  ... which we can call to expand our prototype ... <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> RoundButton = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">radius, label</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius = radius; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label = label; }; extend(RoundButton.prototype, circleFns); extend(RoundButton.prototype, buttonFns); <span class="hljs-comment"><span class="hljs-comment">//etc. ...</span></span></code> </pre> <br><br><h4>  2. Functional impurities </h4>  If the functions defined in the impurities are intended to be used only by other objects, why create impurities at all as objects?  In other words, the impurity must be a process, not an object.  It would be logical to turn our impurities into functions that objects implement themselves in themselves through delegation.  This eliminates the need for an intermediary - the <code>extend</code> function. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> asCircle = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.area = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius; }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.grow = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius++; }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shrink = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius--; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Circle = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">radius</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius = radius; }; asCircle.call(Circle.prototype); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> circle1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Circle(<span class="hljs-number"><span class="hljs-number">5</span></span>); circle1.area(); <span class="hljs-comment"><span class="hljs-comment">//78.54</span></span></code> </pre> <br>  This approach looks right.  Impurities are like verbs, not nouns;  lightweight universal shops.  There are other things that you might like - the style of the code is natural and concise: <code>this</code> always points to the recipient of the function sets, and not to an abstract object that we do not need and which we do not use;  moreover, in contrast to the traditional approach, we do not need protection against unintentional copying of inherited properties, and (whatever that means) functions are now cloned, not copied. <br>  Here is the function-impurity for the buttons: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> asButton = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hover = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bool</span></span></span><span class="hljs-function">) </span></span>{ bool ? mylib.appendClass(<span class="hljs-string"><span class="hljs-string">'hover'</span></span>) : mylib.removeClass(<span class="hljs-string"><span class="hljs-string">'hover'</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.press = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bool</span></span></span><span class="hljs-function">) </span></span>{ bool ? mylib.appendClass(<span class="hljs-string"><span class="hljs-string">'pressed'</span></span>) : mylib.removeClass(<span class="hljs-string"><span class="hljs-string">'pressed'</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fire = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.action(); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; };</code> </pre> <br>  We take two impurities together and get round buttons: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> RoundButton = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">radius, label, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius = radius; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label = label; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.action = action; }; asButton.call(RoundButton.prototype); asCircle.call(RoundButton.prototype); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> button1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RoundButton(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'yes!'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'you said yes!'</span></span>}); button1.fire(); <span class="hljs-comment"><span class="hljs-comment">//'you said yes!'</span></span></code> </pre> <br><br><h4>  3. Add options </h4>  A strategy with functions also allows parameterization of borrowed behavior ‚Äî by passing an argument of options.  Let's see how this works by creating an <code>asOval</code> impurity with custom <code>grow</code> and <code>shrink</code> parameters: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> asOval = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.area = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.longRadius * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shortRadius; }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ratio = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.longRadius/<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shortRadius; }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.grow = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shortRadius += (options.growBy/<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ratio()); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.longRadius += options.growBy; }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shrink = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shortRadius -= (options.shrinkBy/<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ratio()); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.longRadius -= options.shrinkBy; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> OvalButton = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">longRadius, shortRadius, label, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.longRadius = longRadius; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shortRadius = shortRadius; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label = label; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.action = action; }; asButton.call(OvalButton.prototype); asOval.call(OvalButton.prototype, {<span class="hljs-attr"><span class="hljs-attr">growBy</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">shrinkBy</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> button2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OvalButton(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'send'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'message sent'</span></span>}); button2.area(); <span class="hljs-comment"><span class="hljs-comment">//18.84955592153876 button2.grow(); button2.area(); //52.35987755982988 button2.fire(); //'message sent'</span></span></code> </pre> <br><br><h4>  4. Add caching </h4>  You may be concerned that this approach degrades performance, as we redefine the same functions again and again with each call.  Using such a great thing as <a href="http://jsperf.com/">jsperf.com</a> , I removed the metrics of all impurity strategies (the results at the end of the article).  Surprisingly, in Chrome 12, the performance is higher using the functional approach, while in other browsers such impurities are twice as slow as the classic ones.  Assuming that such impurities are likely to be called once for each type (and not when creating each instance), this difference should not play a significant role - given that we are talking about 26000 impurities per second, even in IE8! <br>  Just in case, if such numbers do not allow your manager to sleep at night, here is the solution.  By placing impurities in the closure, we will be able to cache the result of the determination, which will greatly affect performance.  Functional impurities now easily beat the classic performance in all browsers (in my tests, about 20 times in Chrome and about 13 in FF4).  Again, this is not so significant, but leaves a pleasant feeling :) <br>  Here is the version of <code>asRectangle</code> with the addition of caching ... <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> asRectangle = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">area</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.length * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.width; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">grow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.length++, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.width++; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shrink</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.length--, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.width--; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.area = area; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.grow = grow; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shrink = shrink; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }; })(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> RectangularButton = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">length, width, label, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.length = length; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.width = width; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label = label; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.action = action; } asButton.call(RectangularButton.prototype); asRectangle.call(RectangularButton.prototype); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> button3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RectangularButton(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'delete'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'deleted'</span></span>}); button3.area(); <span class="hljs-comment"><span class="hljs-comment">//8 button3.grow(); button3.area(); //15 button3.fire(); //'deleted'</span></span></code> </pre> <br><br><h4>  5. Add Currying </h4>  In life, everything is a result of a compromise, and the aforementioned improvement with caching is no exception.  We have lost the ability to create real clones of each impurity, and, moreover, we can no longer customize borrowed functions by passing parameters.  The last problem can be solved by currying each cached function - thus assigning the parameters in advance, before subsequent calls.  Here is an <code>asRectangle</code> admixture with correctly <code>asRectangle</code> functions that allow parameterization of <code>grow</code> and <code>shrink</code> . <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>.prototype.curry = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> args = [].slice.call(<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fn.apply(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, args.concat([].slice.call(<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>))); }; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> asRectangle = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">area</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.length * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.width; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">grow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">growBy</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.length += growBy, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.width +=growBy; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shrink</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shrinkBy</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.length -= shrinkBy, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.width -= shrinkBy; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.area = area; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.grow = grow.curry(options[<span class="hljs-string"><span class="hljs-string">'growBy'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shrink = shrink.curry(options[<span class="hljs-string"><span class="hljs-string">'shrinkBy'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }; })(); asButton.call(RectangularButton.prototype); asRectangle.call(RectangularButton.prototype, {<span class="hljs-attr"><span class="hljs-attr">growBy</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">shrinkBy</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> button4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RectangularButton(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'add'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'added'</span></span>}); button4.area(); <span class="hljs-comment"><span class="hljs-comment">//2 button4.grow(); button4.area(); //12 button4.fire(); //'added'</span></span></code> </pre> <br><h4>  Performance metrics </h4><br>  As promised, here are the results of the <a href="http://jsperf.com/mixin-fun/2">jsperf tests</a> , tabulated by techniques and browsers. <br>  The result is expressed in thousands of operations per second, so the higher the number, the better. <br><img src="https://habrastorage.org/getpro/habr/post_images/38c/d41/429/38cd41429f82f5a128b5a34db23279ba.png"><br>  <i>(Note of the translator: it is better to see more recent results directly on jsperf.com; the table from the original post is shown just to show the order of the numbers)</i> <br><br><h4>  Conclusion </h4>  JavaScript is a fusion of functions and state.  The state is usually specific to instances, while functions are likely to be common.  It may be in our interests to separate these two basic areas of responsibility, and, possibly, admixtures will help us in this. <br>  In particular, the pattern of functional impurities offers a clean distinction.  Objects are a state, and functions are organized like clusters of fruit on a tree, ripened to be harvested.  In fact, this strategy can be extended far beyond the scope of impurities - the sets of functions can serve as a repository for any object. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> myCircle = asCircle.call({<span class="hljs-attr"><span class="hljs-attr">radius</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span>}); myCircle.area(); <span class="hljs-comment"><span class="hljs-comment">//1963.50</span></span></code> </pre> <br>  Good luck in studying the impurities, and do not be afraid to send corrections and any other feedback! </div><p>Source: <a href="https://habr.com/ru/post/147901/">https://habr.com/ru/post/147901/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147894/index.html">Ivideon launched cloud video storage</a></li>
<li><a href="../147896/index.html">Why OOP doesn't suck</a></li>
<li><a href="../147897/index.html">Facebook began implementing SPDY protocol</a></li>
<li><a href="../147899/index.html">AWS ELB: Forced disconnection of the instance from the balancer</a></li>
<li><a href="../147900/index.html">800,000 signed a petition for the right to download videos from Youtube</a></li>
<li><a href="../147902/index.html">Automated testing of ASP.NET applications via CUITe - features</a></li>
<li><a href="../147904/index.html">MIT creates an electronic "co-pilot"; Google talks about drones</a></li>
<li><a href="../147905/index.html">Panoramas on Yandex.Maps using KRPano</a></li>
<li><a href="../147906/index.html">Probability theory under your arm</a></li>
<li><a href="../147907/index.html">Simulator for keyboard shortcuts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>