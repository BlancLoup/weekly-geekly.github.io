<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tuning typical roles of Windows. Part Two: Terminal Server and Deduplication</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to squeeze all the juice from the Windows server. This time I will talk about setting up a remote desktop server, better known as a termin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tuning typical roles of Windows. Part Two: Terminal Server and Deduplication</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/031/a20/f9b/031a20f9ba3342dcb283e1d78585ca88.png"></p><br><p>  We continue to squeeze all the juice from the Windows server.  This time I will talk about setting up a remote desktop server, better known as a terminal server.  As a ‚Äúcherry on the cake,‚Äù we‚Äôll dwell on the tuning of the Windows volume deduplication system. <a name="habracut"></a></p><br><h1 id="server-udalennyh-rabochih-stolov">  Remote Desktop Server </h1><br><p>  In the infrastructure of remote desktops, the main role is <strong>the session node</strong> Remote Desktop Session Host (hereinafter referred to as RDSH).  I'll start with the selection of hardware for this role. </p><br><p>  With a processor and memory, everything is quite simple: more memory, more high-frequency processors and a larger cache are better.  A little more attention should be paid to the disk subsystem, because it is often a bottleneck.  The main load on the disks can be divided into three groups: </p><br><ul><li><p>  system files and applications; </p><br></li><li><p>  paging file; </p><br></li><li>  user profiles and data. </li></ul><br><p>  In order to increase speed, it makes sense to spread these groups on different physical disks.  About the paging file has already been mentioned in the previous <a href="https://habrahabr.ru/company/pc-administrator/blog/332600/">article</a> , but the user profiles will require some manipulation of the registry. </p><br><p>  To change the storage location of profiles, you need to change the following registry value: </p><br><ul><li><p>  path: HKLM \ Software \ Microsoft \ Windows NT \ CurrentVersion \ ProfileList; </p><br></li><li><p>  parameter: REG_EXPAND_SZ named ProfilesDirectory; </p><br></li><li>  value: the path to the folder, for example, D: \ Users. </li></ul><br><p>  Then the profiles of all users will be created in a different place. </p><br><blockquote>  Separately, it should be noted roaming user profiles of the terminal server.  You can configure them by Group Policy <strong>Windows Configuration - Administrative Templates - Remote Desktop Services - Remote Desktop Session Host - Profiles - Set the path for the remote desktop services user profile to be moved.</strong>  In this policy, you can set a place to store user profiles of the terminal server, but only part of the profile will be stored.  In particular, AppData \ Local will remain in the old place. </blockquote><p>  In addition to changing the storage location of profiles, it is useful to redirect a number of user folders to another location.  As a rule, it is practiced for speed and configuration of backups - after all, ‚Äúmy documents‚Äù and ‚Äúdesktop‚Äù can contain important information, but they also do not require high performance.  Redirection is conveniently configured using group policy. </p><br><div class="spoiler">  <b class="spoiler_title">Under the spoiler I remind you how to do it better.</b> <div class="spoiler_text"><p>  Group Policy itself is configured in <strong>User Configuration - Windows Configuration - Folder Redirection</strong> , and alternative locations can be specified for most user profile folders. </p><br><p><img src="https://habrastorage.org/web/ce7/0df/0b8/ce70df0b881d4eeba2017e986e671f7c.jpg"></p><br><p>  <em>Setting folder redirection policy</em> </p><br><p>  To avoid problems with creating folders and accessing them, I usually do the following permissions on a resource with redirected folders: </p><br><ul><li><p>  the group ‚ÄúEveryone‚Äù can create folders and read.  Permissions apply only to the root folder; </p><br></li><li><p>  the creator-owner (owner) has full access, but only to subfolders and files; </p><br></li><li>  Administrators and system have full access. </li></ul><br><p><img src="https://habrastorage.org/web/7b6/4b8/8da/7b64b88da8704f14862092f146de81a0.jpg"></p><br><p>  <em>Permissions to a network resource with user redirected folders.</em> </p></div></div><br><p>  One of the main disk loads on the server with the RDSH role is synchronous recording.  The reason is again the users: after all, during normal operation there is a regular access to the profile, as well as loading and unloading of user registry branches (% userprofile% \ ntuser.dat).  In addition to creating various kinds of <a href="https://habrahabr.ru/company/pc-administrator/blog/319214/">productive arrays, the</a> write cache can help optimize performance. </p><br><p>  If you do not have a battery for a RAID controller, you should think about purchasing one or endlessly believing that no-breakers are.  I must say that the cache can also be configured via Windows - on the Policy tab in the disk properties in the Disk Management snap-in. </p><br><p><img src="https://habrastorage.org/web/263/7e9/c1a/2637e9c1aeb64aedae4f915c6ff7c6f8.jpg"></p><br><p>  <em>Setup Windows hard disk cache.</em> </p><br><p>  The second potentially bottleneck is the network subsystem.  In order to optimize, it will not be superfluous to divide the network into a conditional frontend and backend if possible.  Through the frontend to make user connections, and through the backend - connections to other servers, including repositories for redirected folders and roaming profiles. </p><br><p>  Network connections with user connections are usually minimal, and for better backend performance, you can use adapter teaming (LACP) or install ten-gigabit adapters into the server. </p><br><p>  In setting up the operating system itself, you can highlight the following points: </p><br><ul><li><p>  whenever possible, turn off background processes such as spell checking, autosave, indexing for searching.  Or at least reduce their frequency; </p><br></li><li><p>  it is also better to reduce the frequency of checking the status of applications, updates and other synchronizations; </p><br></li><li><p>  less unnecessary processes and modules - more room for the rest.  You can check the processes and loadable modules using the built-in utility <strong>msinfo32.exe</strong> and the unforgettable <a href="https://technet.microsoft.com/ru-ru/sysinternals/bb963902.aspx">Autoruns</a> ; </p><br></li><li><p>  Antivirus on the terminal server is not the best idea, it is enough to limit the protection of the perimeter, SRP and regular updates.  If Petit and Non-Petit are disturbed by paranoia, then you should at least exclude from the scan some temporary folders: for example, with files created by system services and trusted applications; </p><br></li><li><p>  If redirected devices such as audio playback, microphone and other discs are not used, it is better to turn them off. </p><br></li><li><p>  special mention deserve redirected printers.  If possible, it is better not to use printer redirection, connect from a local <a href="https://habrahabr.ru/company/pc-administrator/blog/332600/">print server</a> .  If you can not connect - use probros printers using a regular tool EasyPrint, without installing the printer driver.  It‚Äôs worthwhile to install a printer driver when absolutely necessary, and neatly - many drivers, especially for older printers, pull their applications with them, which can easily ‚Äúdrop‚Äù the print service; </p><br></li><li>  check ‚Äúassigned tasks‚Äù.  In addition to the system, which by default leaves a number of scheduled tasks for user input and a simple user, applications also like to add their tasks.  Not all of them you need. </li></ul><br><p><img src="https://habrastorage.org/web/40a/bed/1e9/40abed1e9f964d1d914351c21a11c16e.jpg"></p><br><p>  <em>129 - just as many assignments in the newly installed Windows 2016 + Office 2016.</em> </p><br><p>  Not to mention the possibility of a terminal server called RemoteFX, setting its behavior also affects performance. </p><br><blockquote>  RemoteFX is a whole set of technologies responsible for compressing RDP, forwarding devices, working with a video card and USB devices both in a virtual machine and on a terminal server. </blockquote><p>  A useful setting is RemoteFX compression.  You can search for it in group policies at <strong>Computer Configuration - Administrative Templates - Windows Components - Remote Desktop Services - Remote Desktop Session Host - Remote Session Environment - Configuring RemoteFX Compression</strong> . </p><br><p><img src="https://habrastorage.org/web/34b/267/9a7/34b2679a71644ca2933c46a9c2ca7913.jpg"></p><br><p>  <em>Configure RemoteFX compression through group policies.</em> </p><br><p>  The setup has the following options: </p><br><ul><li><p>  memory optimization.  The load on the server is small, but the requirements for network bandwidth increase; </p><br></li><li><p>  network bandwidth optimization.  The network is poorly loaded, but the memory consumption is about 2 MB per session; </p><br></li><li><p>  balance of memory and network bandwidth.  Memory consumption is about 200 KB per session; </p><br></li><li>  Do not use the RDP compression algorithm.  The server almost does not compress RDP, so the load on the network is maximum. </li></ul><br><p>  With a small number of users from inside the local network, tuning has little effect on speed.  But when there are many users or if they are remote, it is worth thinking about its application. </p><br><p>  Next to this setting, there are other options that affect the speed - here and setting the encoding, and setting the maximum screen resolution.  Of particular interest is the configuration of using a graphics adapter to render the image ‚Äî for all sessions of the Remote Desktop Services, use the hardware graphics adapter by default.  Starting with Windows 2016, RemoteFX has learned how to work not only with virtual video cards in virtual machines, but also with a video card directly.  Yes, now you can <a href="https://habrahabr.ru/company/pc-administrator/blog/319712/">install a</a> video card even in a regular session server of remote desktops to speed up work. </p><br><p>  Other display settings can be made on the client side, in <strong>.rdp</strong> files.  Most options are on the Interaction tab. </p><br><p><img src="https://habrastorage.org/web/eb9/9a5/42c/eb99a542cdfd497f9023bfc6a302df76.jpg"></p><br><p>  <em>Display settings that affect performance.</em> </p><br><p>  You can configure it manually, you can use presets depending on the approximate connection speed, or give control to the automation.  Most importantly, you should not disable the "Constant caching of bitmaps."  When this option is enabled, the client will keep the image cache and upload only changes to the image. </p><br><p>  I turn to the speed of another terminal server role - the remote desktop gateway. </p><br><p>  <strong>The</strong> Remote Desktop Gateway (RDG) is conveniently used to connect external clients without a VPN ‚Äî in particular, it allows you to configure certificate authentication.  An example of configuration can be found in the <a href="https://habrahabr.ru/post/134456/">relevant article</a> , but I will limit myself to speed issues. </p><br><p>  RDG can use TCP and UDP transport, but in most cases standard RPC over HTTP is used.  The following registry settings apply to it: </p><br><table><tbody><tr><td width="150">  Parameter </td><td width="100">  Way </td><td width="100">  Default value </td><td width="150">  Comment </td></tr><tr><td>  Maxiothreads </td><td>  HKLM \ Software \ Microsoft \ Terminal Server Gateway </td><td>  Equal to the number of processors </td><td>  Responsible for the number of exiting streams that the RDG processes </td></tr><tr><td>  MaxPoolThreads </td><td>  HKLM \ System \ CurrentControlSet \ Services \ InetInfo \ Parameter </td><td>  four </td><td>  The number of threads that IIS processes </td></tr><tr><td>  ServerReceiveWindow </td><td>  HKLM \ Software \ Microsoft \ Rpc </td><td>  64 KB </td><td>  The maximum frame size received by the server.  Can vary from 8 KB to 1 GB. </td></tr><tr><td> ClientReceiveWindow </td><td>  HKLM \ Software \ Microsoft \ Rpc </td><td>  64 KB </td><td>  Maximum frame size accepted by the client.  Can vary from 8 KB to 1 GB. </td></tr></tbody></table><br><p>  To understand where there are problems, will help performance counters: </p><br><ul><li><p>  Terminal Services Gateway; </p><br></li><li><p>  RPC / HTTP Proxy Per Server; </p><br></li><li><p>  RPC / HTTP Proxy; </p><br></li><li><p>  W3SVC_W3WP; </p><br></li><li><p>  IPv4; </p><br></li><li><p>  memory; </p><br></li><li><p>  network interface; </p><br></li><li><p>  system; </p><br></li><li><p>  synchronization; </p><br></li><li><p>  TCPv4; </p><br></li><li><p>  process; </p><br></li><li><p>  RPC / HTTP Proxy </p><br></li><li><p>  information about the processor; </p><br></li><li>  web service. </li></ul><br><p>  I will say a few words about the third role - the <strong>site of virtualization of remote desktops</strong> .  It is needed to deploy Virtual Desktop Infrastructure (VDI), a little less popular than regular terminal servers. </p><br><p>  In addition to general recommendations for hypervisors - faster, higher, stronger - in the VDI infrastructure in the virtual desktop pool mode, it makes sense to pay attention to unnecessary services and features in client operating systems: </p><br><ul><li><p>  WIndows update.  Anyway, when connected, the machine is deployed from the template; </p><br></li><li><p>  offline files.  VDI do not go offline; </p><br></li><li><p>  background defragmentation.  File system changes are rolled back when disconnected; </p><br></li><li><p>  sleep or hibernation.  Not supported in VDI; </p><br></li><li><p>  crash dump.  When you restart the machine will be deployed from the template; </p><br></li><li><p>  WLAN autoconfiguration  There is no Wi-Fi on VDI; </p><br></li><li><p>  Windows Media Player Network Share Service; </p><br></li><li><p>  home group provider; </p><br></li><li><p>  Internet connection sharing; </p><br></li><li><p>  Bluetooth service; </p><br></li><li>  additional services of Windows Center. </li></ul><br><p>  In addition to disabling services in a patterned virtual machine, to optimize storage, it will not be superfluous to enable deduplication in any VDI deployment option.  This can be done using the PowerShell command: </p><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Enable</span></span>-DedupVolume &lt;volume&gt; -UsageType HyperV</code> </pre> <br><p>  Using deduplication will help save a lot of space, not only when using virtual desktops. </p><br><h1 id="deduplikaciya">  Deduplication </h1><br><p>  Deduplication is an array compression method where duplicate data is not duplicated. </p><br><div class="spoiler">  <b class="spoiler_title">Under the spoiler, let me remind you when and how to include deduplication.</b> <div class="spoiler_text"><p>  Microsoft recommends including deduplication in the following cases: </p><br><ul><li><p>  general-purpose file servers ‚Äî user shared folders, redirected profile folders, etc .; </p><br></li><li><p>  Remote Desktop Infrastructure Servers (VDI); </p><br></li><li>  virtualized backup applications like Microsoft DPM. </li></ul><br><p>  In all other cases, the benefits of deduplication should be pre-evaluated.  This will help the <strong>DDPEval.exe</strong> utility, which will appear after installing the deduplication role on the server. </p><br><p><img src="https://habrastorage.org/web/6db/189/157/6db1891572d6403c93e5312213a8a3cf.jpg"></p><br><p>  <em>On a disk with a large number of 1C file bases, deduplication can save up to 70% of space.</em> </p><br><p>  Installation of the deduplication component is done through the graphics mode or by the PowerShell cmdlet: </p><br><p>  Install-WindowsFeature -Name FS-Data-Deduplication </p><br><p>  It is convenient to enable by the Enable-DedupVolume cmdlet with the - UsageType parameter, which can be: </p><br><ul><li><p>  <strong>HyperV</strong> - for storage of virtual machines and VDI; </p><br></li><li><p>  <strong>Backup</strong> - for virtualized backup applications; </p><br></li><li>  <strong>Default</strong> is the default. </li></ul><br><p>  Read more about deduplication and how it differs, I suggest in the <a href="https://docs.microsoft.com/ru-ru/windows-server/storage/data-deduplication/understand">Microsoft</a> documentation. </p></div></div><br><p>  To optimize the balance of storage and performance, you should pay attention to the assigned tasks of deduplication and its fine tuning. </p><br><p>  The deduplication mechanism uses three types of assigned tasks: </p><br><table><tbody><tr><td width="150">  Title </td><td width="100">  What is he doing </td><td width="150">  Default schedule </td></tr><tr><td>  Optimization </td><td>  Performs deduplication </td><td>  Every hour </td></tr><tr><td>  Garbage collection </td><td>  Frees up disk space </td><td>  Every Saturday at 02:35 </td></tr><tr><td>  Integrity check </td><td>  Searches and repairs damage </td><td>  Every Saturday at 03:35 </td></tr></tbody></table><br><p>  You can view scheduled tasks with the <strong>Get-DedupSchedule cmdlet</strong> . </p><br><p><img src="https://habrastorage.org/web/26b/06e/f15/26b06ef15ae14f34aaa7ea91c6025c05.jpg"></p><br><p>  <em>Scheduled deduplication jobs by default.</em> </p><br><p>  Of course, such a schedule can be unacceptable, especially on servers with high load.  In this case, it will be convenient to run tasks only during idle hours.  Disable jobs with the PowerShell command: </p><br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-DedupSchedule | ForEach-Object { <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>-DedupSchedule -InputObject $_ -Enabled $<span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre><br><p>  Add a new optimization task after hours: </p><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">New</span></span>-DedupSchedule -<span class="hljs-type"><span class="hljs-type">Name</span></span> "Optimization" -<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> Optimization -DurationHours <span class="hljs-number"><span class="hljs-number">8</span></span> -Memory <span class="hljs-number"><span class="hljs-number">100</span></span> -Cores <span class="hljs-number"><span class="hljs-number">100</span></span> -Priority High -Days @(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>) -<span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-<span class="hljs-type"><span class="hljs-type">Date</span></span> "2017-01-01 21:00:00")</code> </pre><br><p>  And tasks garbage collection and checks on non-working days: </p><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">New</span></span>-DedupSchedule -<span class="hljs-type"><span class="hljs-type">Name</span></span> "WeeklyGarbageCollection" -<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> GarbageCollection -DurationHours <span class="hljs-number"><span class="hljs-number">23</span></span> -Memory <span class="hljs-number"><span class="hljs-number">100</span></span> -Cores <span class="hljs-number"><span class="hljs-number">100</span></span> -Priority High -Days @(<span class="hljs-number"><span class="hljs-number">6</span></span>) -<span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-<span class="hljs-type"><span class="hljs-type">Date</span></span> "2017-01-01 07:00:00") <span class="hljs-built_in"><span class="hljs-built_in">New</span></span>-DedupSchedule -<span class="hljs-type"><span class="hljs-type">Name</span></span> "WeeklyIntegrityScrubbing" -<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> Scrubbing -DurationHours <span class="hljs-number"><span class="hljs-number">23</span></span> -Memory <span class="hljs-number"><span class="hljs-number">100</span></span> -Cores <span class="hljs-number"><span class="hljs-number">100</span></span> -Priority High -Days @(<span class="hljs-number"><span class="hljs-number">0</span></span>) -<span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-<span class="hljs-type"><span class="hljs-type">Date</span></span> "2017-01-01 07:00:00")</code> </pre><br><p>  You can read more about the syntax of the <strong>New-DedupSchedule</strong> cmdlet in the <a href="https://msdn.microsoft.com/ru-ru/library/hh848445.aspx">documentation</a> . </p><br><p>  Most deduplication tweaks ‚Äî that is, most of the parameters for a volume ‚Äî are configured using the <strong>Set-DedupVolume cmdlet</strong> . </p><br><p>  Usage example: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>-DedupVolume -Volume F: -OptimizePartialFiles</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Under the spoiler you will find the possible parameters of the cmdlet.</b> <div class="spoiler_text"><table><tbody><tr><td width="150">  Parameter </td><td width="100">  Description </td><td width="100">  Valid Values </td><td width="150">  Comment </td></tr><tr><td>  ChunkRedundancyThreshold </td><td>  Number of links to a block before it is copied to the block's active zone partition </td><td>  Positive integers </td><td>  Usually there is no need to change the default value, but increasing the value may increase the speed of high duplication volumes. </td></tr><tr><td>  ExcludeFileType </td><td>  File types excluded from deduplication </td><td>  Array of file extensions </td><td>  Such files as multimedia are difficult to deduplicate, it makes no sense to optimize them. </td></tr><tr><td>  ExcludeFolder </td><td>  Folders excluded from deduplication </td><td>  Array of paths to folders </td><td>  To improve performance, you can exclude some folders. </td></tr><tr><td>  InputOutputScale </td><td>  Parallelization of I / O operations </td><td>  1 - 36 </td><td>  On a server with a high load, you can reduce the number of I / O deduplication operations, which will affect the speed of optimization, but will speed up the overall server operation </td></tr><tr><td>  MinimumFileAgeDays </td><td>  The number of days after the file is created before it is considered available for optimization. </td><td>  Positive integers, including 0 </td><td>  The default value is 3, in some cases you can change the value to increase optimization. </td></tr><tr><td>  MinimumFileSize </td><td>  The minimum file size so that it can be considered available for optimization. </td><td>  Positive integers (bytes) larger than 32 KB </td><td>  For small files, deduplication doesn't matter </td></tr><tr><td>  Nocompress </td><td>  Compress deduplicated blocks </td><td>  True \ False </td><td>  For a volume containing a large amount of compressed data, such as archives or multimedia, compression makes sense to turn off </td></tr><tr><td>  NoCompressionFileType </td><td>  Files that do not need to compress </td><td>  Array of file extensions </td><td>  Already compressed files do not make sense to compress </td></tr><tr><td>  OptimizeInUseFiles </td><td>  Using deduplication for active files </td><td>  True \ False </td><td>  If most files on the volume are large and constantly used, in which only a part of the files change regularly, it is better to include this parameter.  Otherwise, these files will not be optimized. </td></tr><tr><td>  OptimizePartialFiles </td><td>  When this option is enabled, the MinimumFileAge value is applied to the file segments, not the entire file. </td><td>  True \ False </td><td></td></tr><tr><td>  Verify </td><td>  Checking the data block not only by hash, but also byte </td><td>  True \ False </td><td>  Turning on the parameter slows down the performance, but provides a great guarantee of data integrity. </td></tr></tbody></table></div></div><br><p>  In addition to the settings for the volume, there are general deduplication service settings.  In particular, we are interested in two parameters located in the registry at the following address: </p><br><pre> <code class="xml hljs">HKLM:\System\CurrentControlSet\Services\ddpsvc\Settings</code> </pre><br><table><tbody><tr><td width="150">  Parameter </td><td width="100">  Description </td><td width="100">  Valid Values </td><td width="150">  Comment </td></tr><tr><td>  WlmMemoryOverPercentThreshold </td><td>  Ability to use more memory than auto evaluation </td><td>  Positive integers, as a percentage.  for example, a value of 300 means "three times more" </td><td>  Changing the parameter value is important when simultaneously running deduplication tasks and other resource-intensive tasks. </td></tr><tr><td>  DeepGCinterval </td><td>  The interval between full garbage collection </td><td>  Positive integers, -1 = disabled </td><td>  Full garbage collection optimizes data more carefully, but it is more resource-intensive.  In fact, the difference in free space after the normal and complete garbage collection is about 5%. </td></tr></tbody></table><br><p>  Now that deduplication is set up, you can try to articulate, ‚Äúdeduplicate, deduplicate, but not otuple duplicate,‚Äù and then spend the budget not on disks, but on new servers to the remote desktop farm.  And start tyunit them already. </p><br><p>  Have you ever had to do similar tuning of the speed of terminal servers or is everything ‚Äúby default‚Äù?  Was there any tangible result? </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/333476/">https://habr.com/ru/post/333476/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333464/index.html">SIP communications analysis using 3CX Log Viewer utility</a></li>
<li><a href="../333466/index.html">Muda marriage</a></li>
<li><a href="../333468/index.html">Installing MS SQL ODBC Driver for Linux and building a plugin for Qt 5.9</a></li>
<li><a href="../333470/index.html">Getting started in Kubernetes with Minikube</a></li>
<li><a href="../333474/index.html">Let's talk about micro-optimizations on the example of Tizen code</a></li>
<li><a href="../333478/index.html">Upgrading Fujitsu ETERNUS DX Entry Storage Systems</a></li>
<li><a href="../333480/index.html">DBMS for 1C Fresh. Quickly. Reliably Is free</a></li>
<li><a href="../333482/index.html">Hazards in measuring productivity</a></li>
<li><a href="../333484/index.html">Setting up the development environment: needlework circle (Part 1)</a></li>
<li><a href="../333486/index.html">Calls between browsers: WebRTC pitfalls</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>