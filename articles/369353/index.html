<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How Yandex created the first device with Alice. Yandex.The station on the basis of technology IO</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few minutes ago at the YaC 2018 conference, we first talked about Yandex.Station . This is the first multimedia device with Alice, which plays music...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How Yandex created the first device with Alice. Yandex.The station on the basis of technology IO</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/lb/n7/6r/lbn76rwh-7wx7yf3nybfqzeuqdc.png"><br><br>  A few minutes ago at the YaC 2018 conference, we first talked about <a href="https://station.yandex.ru/%3Ffrom%3Dhabr">Yandex.Station</a> .  This is the first multimedia device with Alice, which plays music and movies, tells fairy tales to children, helps in everyday affairs, and also supports skills from third-party developers. <br><br>  It may seem that to create such devices it is enough to take a voice assistant, add a simple microphone from a smartphone to it and hide it all in the case of an inexpensive audio speaker.  In practice, the developers of such systems are facing serious technological problems, the solution of which at the Station we will tell today to the readers of Habr.  You will also learn what exactly is the technological platform Yandex.IO, on the basis of which the device is created. <br><a name="habracut"></a><br>  In a post about the creation of Alice, we talked about the development of computer interfaces: from the command line to mouse and voice control.  The more accessible the computer became, the faster the technologies developed, the way of interaction with the device was simplified. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      With other home devices, the development went the same way.  Perhaps you <a href="">remember the</a> Soviet black-and-white TVs, in which even to switch channels it was necessary to put tangible physical effort.  Now, in many models, we can switch channels by voice. <br><br>  We believe that the time has come to teach home devices to communicate in the language of people, not buttons.  It was this idea that formed the basis of Alice‚Äôs voice assistant and our first device based on it, Yandex.Station. <br><br><h4>  Says and shows </h4><br>  The station is the first Yandex device with voice assistant Alice.  She will tell the weather, set the alarm, tell the news, read the story to the child or help with other daily activities.  But the value of our device is not only in this.  When we started working on the Station, we set ourselves the task of creating a home multimedia device, the capabilities of which would not be limited to the skills of a voice assistant.  This task included two important requirements: <br><br>  1. The station should play tracks from Yandex.Music or from any other device via Bluetooth. <br><br>  2. The station must find and play video: as from the database of partner content, and videos from the network.  There were even options with its own built-in screen, but they were quickly abandoned in favor of the HDMI connector for connecting to any TV. <br><br>  And all this - with high-quality sound.  Our device should handle the audio track better than the speakers of a typical TV (this applies to both deep bass and total power).  At the same time, the Station should not only sound good, but also clearly understand the user's speech.  And these tasks contradict each other a little.  And here the fun begins. <br><br><h4>  Location matters </h4><br><img src="https://habrastorage.org/webt/bq/eb/mv/bqebmvrfwidsjenlv2xbd_bqjiq.jpeg"><br><br>  Take a look at the picture above.  Smart home devices are often portrayed as if they are in the center of a room and reproduce sound in all directions.  It looks beautiful in photos, but in reality almost no one uses them that way.  Devices that need to hear voices from afar consume significant computational resources, so they work not from a battery, but from a network.  Almost no one has the closest outlets in the center of the room, so devices usually stand against the walls.  This means that it makes no sense to make a device with a circular arrangement of speakers.  And it's not just about saving. <br><br>  If you direct a part of the speakers to the wall, then the problem of sound wave interference arises, which would have to be compensated at the software level.  No extra speakers - no problem.  Therefore, in the Station we use two frontal speakers (including to maintain the stereo effect), one woofer and two passive radiators (for deep bass).  But even with their location in the case is not so simple. <br><br><img src="https://habrastorage.org/webt/bc/zo/ei/bczoei4inp-splibl5g_lefkbw0.jpeg"><br><br>  Usually, both tweeters (tweeters) and a woofer are directed toward the listener in order to achieve minimal sound distortion.  But in our case, the woofer is pointing down.  Why? <br><br>  Remember, we said that the Station should not only produce high-quality sound, but also be able to hear voice commands?  Human speech is predominantly midrange (although the full range is wider: 300-3400 Hz).  We were faced with the task of reducing the effect of the sound emitted by the Station on the microphones, which should capture human speech.  One solution to this problem is to increase the ‚Äúecho-path‚Äù of sound in the spectrum of human speech from speakers to microphones.  The woofer responds to the mids in the usual mode of the Station, so we sent it down.  This increases the ‚Äúecho path‚Äù, improves the quality of voice recognition and slightly affects the quality of sound reproduction. <br><br>  In the previous paragraph, you might have noticed the mention of the normal Station mode.  In short, we are talking about the volume level.  The total power of all speakers in the Station is 50 watts.  For a noisy party this is more than enough.  But at high volume it is difficult to recognize the voice of the user.  In the industry, this problem is solved by limiting the volume.  We also thought about this option, but, fortunately, we decided not to spoil the good acoustics with limitations. <br><br><h4>  Adaptive Crossfade </h4><br>  The current volume level is visualized using a circular light at the top of the Station.  As the volume increases, the color changes from green to yellow and red.  Green and yellow is a conventional ‚Äúnormal mode‚Äù, in which the Station plays music well and responds to user voice commands.  But the red color indicates a high volume.  In this mode, the volume is so high that the device is almost unable to hear user commands. <br><br>  At maximum volume, you no longer need to think about speech recognition, so we discarded the trade-offs and focused on the sound.  No, the woofer does not turn towards the user, but we redirect the mids to tweeters.  Above, we called them exclusively tweeters, but they are chosen to cope with the middle frequencies if necessary (they confidently hold from 2k to 20k Hz).  And at high volume, the Station switches to stereo mode, which is disabled in normal mode due to its negative effect on speech recognition quality. <br><br>  We called all this technology Adaptive rossfade, which, I want to believe, will appeal to fans of high-quality sound.  By the way, some audiophiles from our team recommend also removing the outer casing to win a couple decibels (yes, it is removable). <br><br><img src="https://habrastorage.org/webt/hf/au/hk/hfauhk72ivxhb5vf6gh2rz6yvi4.png"><br><br>  Above, we talked about how the station reproduces sound.  Now we will talk about the technology platform, thanks to which it understands users. <br><br><h4>  Yandex.IO </h4><br>  The speakers are an important part of the device, but far from the main one.  The station is built around the Yandex.IO platform, which includes two components.  First of all, this is the main board, which is responsible for the ‚Äúbrains‚Äù of the entire device: plays music and movies, and also ensures that Alice and all her skills work (including those that third-party developers can already create using the <a href="https://dialogs.yandex.ru/%3Ffrom%3Dhabr2">Dialogs</a> service). <br><br>  Brief specification: <br><br><ul><li>  Quad-core ARM Cortex-A53 @ 1 GHz (12000 MIPS) </li><li>  RAM: 1 GB DDR3 SDRAM </li><li>  Flash storage: 8 GB eMMC </li><li>  WiFi: 802.11 b / g / n / ac, dualband, MIMO 2x2 </li><li>  Bluetooth: BLE 4.1 with A2DP support </li><li>  Video: HDMI 1.4 + CEC.  FullHD support (1080p) </li><li>  Audio input: 16-channel digital audio capturing (I2S with TDM) </li><li>  Audio output: 3-channel digital D-class amplifier 30 W + 2x10 W </li></ul><br><img src="https://habrastorage.org/webt/1n/pl/me/1nplmeiq_i2764btvbxet-5mjw0.jpeg"><br><br>  A few words about the processor.  We chose ARM Cortex-A53 not only because of the difficult task of playing streaming video, but also to work with voice.  From the side it may seem that there are no special loads here: record the entire audio stream from the microphone and broadcast it to the cloud where the magic neural network recognizes everything.  But this is not how it works, and the main station board carries a whole stack of technologies aimed at improving voice recognition.  And here we go to the second important component of the IO platform. <br><br><h4>  Microphone array </h4><br>  The prevalence of smartphones with voice assistants creates the illusion that it is enough to take the same simple microphone and integrate it into a conventional refrigerator that will perfectly hear and understand your voice from any corner of the room.  No, it will not.  The sensitivity of simple microphones is such that they work only at short distances and in relatively quiet external conditions.  There are professional microphones for special purposes that could solve this problem.  But they cost hundreds of dollars, and no user device will pull such an increase in value. <br><br>  In the industry, this problem is solved with the help of microphone arrays.  One simple microphone does not cope with the task, but if we take a few and make them work in concert, according to the principle of phased antenna arrays, we will get a good directional microphone.  So, the Station uses a microphone matrix of its own design, consisting of 7 microphones: 1 in the center and 6 around the circumference. <br><br><img src="https://habrastorage.org/webt/nd/to/pn/ndtopnsdttzmpfcuhcl4vstj2p8.jpeg"><br><br>  Moreover, they are connected to a separate power circuit, and when you press the Mute button on the case, the microphones are physically de-energized.  The button does not depend on the software, so this logic cannot be ‚Äúprogrammed‚Äù to break.  Here is a diagram (a simpler <a href="">flowchart here</a> ): <br><br><img src="https://habrastorage.org/webt/co/wg/3i/cowg3icnf0wuy_aqitzroqwojwk.jpeg"><br><br>  Microphones are not enough for full voice control.  The device must be able to distinguish noise from speech and understand commands. <br><br><h4>  Voice activated </h4><br>  Speech recognition is a very resource-intensive process, so it only works in the cloud.  But the Station cannot afford to send all the surrounding noise to the network: it impairs responsiveness, consumes traffic and energy, and provokes a shutdown of voice control.  Therefore, our device begins to listen and send sound from microphones to the server only when the user has pronounced the keywords "Alice" or "Yandex."  But how does it work without network access? <br><br>  Keyword recognition is based on Phrase Spotting technology (voice activated).  We train a small neural network to find specific keywords in the noise stream, for example, ‚ÄúAlice‚Äù.  This requires about 100 thousand entries for each word, and for various acoustic conditions (a quiet room, a working television in the background, ...).  Moreover, for the Station we needed to collect these records again, and not to use those that remained after the launch of Alice for smartphones.  The reason is that voice samples must be recorded for a specific device, otherwise the final recognition quality will be lame. <br><br>  A neural network trained for voice activation can recognize only a few words, but it works quickly and is built into the device itself, so it does not require an internet connection.  Only after the station ‚Äúheard‚Äù a key word in the audio stream, the user's speech begins to be sent to Alice‚Äôs server to analyze the request and prepare a response.  But not at once. <br><br><h4>  Speech recognition </h4><br>  It makes no sense to send to the cloud audio stream recorded from 7 microphones.  First you need to clear it from the noise and highlight it. <br><br>  The Direction of Arrival algorithm is responsible for determining the direction in which the source of speech is located.  As soon as the direction of speech is determined, the microphone array "turns around" in this direction and sends a "beam" to it.  The Beamforming technology allows you to select the sound coming from the target direction, suppressing the sounds coming from other directions.  At the same stage, the Noise Suppression and De-reverberation algorithms (reverberation elimination) work. <br><br><img src="https://habrastorage.org/webt/eu/-e/2k/eu-e2kq9bwfvswp_dwf3jeyhwsq.jpeg"><br><br>  The source of sound that interferes with speech recognition may be the Station itself while playing music and movies.  It would seem that the signal emitted by the Station is known and therefore it can be subtracted from the signal fed to the microphones.  But not everything is so simple.  This sound comes with repeated repetitions and non-linear distortions (for example, due to the reflections from the walls), and its removal is a non-trivial task.  The Acoustic Echo Cancellation algorithm solves this problem. <br><br>  All of these algorithms work locally on the mainboard of the IO platform.  Only after the signal passes through all the stages of cleaning and extracting speech, is it sent to a Yandex server for full recognition by neural networks.  You can imagine how hard it is to train them, if thousands of records are required to understand one word.  This process is constantly being improved, but we have already managed to achieve speech recognition accuracy comparable to a live interlocutor. <br><br>  Yandex.Station will soon go on sale - if you leave the address <a href="https://station.yandex.ru/%3Ffrom%3Dhabr">on the site</a> , we will let you know when this happens.  In this post, we did not begin to describe all the product capabilities of the device, but focused on the main technological challenges facing the developers of smart devices with voice control.  I want to believe that in the near future we will be able to ask Alice to turn on the washing machine, buy tickets, or even feed the cat - and she will fulfill the request.  Yandex.Station and IO technology is our first step towards this future. </div><p>Source: <a href="https://habr.com/ru/post/369353/">https://habr.com/ru/post/369353/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../369343/index.html">Scientists from Oxford proved: fish can learn to distinguish people's faces</a></li>
<li><a href="../369345/index.html">Brute force against passwords</a></li>
<li><a href="../369347/index.html">Gifts from board games</a></li>
<li><a href="../369349/index.html">Artificial neural networks in simple words</a></li>
<li><a href="../369351/index.html">"Thin World". Chapter 4</a></li>
<li><a href="../369355/index.html">SignAloud gloves: translation of gestures into words</a></li>
<li><a href="../369359/index.html">Spanish engineers have created an Exeskeleton for children suffering from muscular atrophy</a></li>
<li><a href="../369361/index.html">Detective with "Proton" or how computers save rockets</a></li>
<li><a href="../369363/index.html">Bitcoin rate exceeded $ 700</a></li>
<li><a href="../369365/index.html">Results of the Microsoft presentation at E3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>