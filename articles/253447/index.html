<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Spectral analysis of signals</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, Comrade Makeman described how, using spectral analysis, you can decompose some sound signal into its composing notes. Let's abstract ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Spectral analysis of signals</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/41e/a2b/dd9/41ea2bdd9aff484b9261b952c6945b5f.png" alt="image" width="400"><br><br>  Not so long ago, Comrade <a href="http://habrahabr.ru/users/makeman/" class="user_link">Makeman</a> <a href="http://habrahabr.ru/post/247385/">described</a> how, using spectral analysis, you can decompose some sound signal into its composing notes.  Let's abstract a little from a sound and we suppose that we have some digitized signal, which spectral structure we want to define, and precisely enough. <br><br>  Under the cat a brief overview of the method of harmonic selection from an arbitrary signal using digital heterodyning, and a little special, Fourier magic. <br><a name="habracut"></a><br>  So, what we have. <br>  File with samples of the digitized signal.  It is known that a signal is the sum of sinusoids with its own frequencies, amplitudes and initial phases, and, possibly, white noise. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What do we do. <br>  Use spectral analysis to determine: <br><ul><li>  the number of harmonics in the signal, and for each: amplitude, frequency (hereinafter in the context of the number of wavelengths per signal length), the initial phase; </li><li>  presence / absence of white noise, and, if available, its MSE (standard deviation); </li><li>  the presence / absence of a constant component of the signal; </li><li>  put all this into a pretty PDF report <s>with blackjack and</s> illustrations. </li></ul><br><br>  We will solve this problem in Java. <br><br><h4>  Materiel </h4><br>  As I have already said, the signal structure is obviously known: it is the sum of sinusoids and some noise component.  It so happened that for the analysis of periodic signals in engineering practice they widely use a powerful mathematical apparatus, generally referred to as <i><b>‚ÄúFourier analysis‚Äù</b></i> .  Let's take a quick look at what this kind of beast is. <br><br><h5>  Bit special, Fourier Magic </h5><br>  Not so long ago, in the 19th century, the French mathematician Jean Baptiste Joseph Fourier showed that any function satisfying certain conditions (continuity in time, periodicity, satisfaction of Dirichlet conditions) can be decomposed into a series, which later received his name - the <i><b>Fourier series</b></i> . <br><br>  In engineering practice, the decomposition of periodic functions in a Fourier series is widely used, for example, in problems of circuit theory: a non-sinusoidal input action is decomposed into a sum of sinusoidal and the necessary parameters of the circuits are calculated, for example, by the overlay method. <br><br>  There are several possible options for recording the coefficients of the Fourier series, we only need to know the essence. <br>  Fourier series decomposition allows decomposing a continuous function into the sum of other continuous functions.  And in general, the series will have an infinite number of members. <br><br>  A further improvement of the Fourier approach is the integral transformation of his own name.  <i><b>Fourier transform</b></i> . <br>  In contrast to the Fourier series, the Fourier transform decomposes the function not according to discrete frequencies (the set of frequencies of the Fourier series over which decomposition occurs, generally speaking, discrete), but into continuous ones. <br>  Let's take a look at how the coefficients of the Fourier series and the result of the Fourier transform, referred to as the <i><b>spectrum</b></i> , correlate. <br>  A small digression: the Fourier transform spectrum is, in general, a complex function that describes the <i><b>complex amplitudes of the</b></i> corresponding harmonics.  That is, the spectrum values ‚Äã‚Äãare complex numbers, whose modules are amplitudes of the corresponding frequencies, and the arguments are the corresponding initial phases.  In practice, the <i><b>amplitude spectrum</b></i> and the <i><b>phase spectrum are</b></i> considered separately. <br><br><img src="https://habrastorage.org/files/853/4a1/5cd/8534a15cd8084809bbc3edef2c72c64a.png" alt="image" width="400"><br>  Fig.  1. The correspondence of the Fourier series and Fourier transforms on the example of the amplitude spectrum. <br><br>  It is easy to see that the coefficients of the Fourier series are nothing more than the values ‚Äã‚Äãof the Fourier transform at discrete points in time. <br><br>  However, the Fourier transform associates a continuous in time, infinite function of another, continuous in frequency, infinite function - the spectrum.  What if we do not have a function that is infinite in time, but there is only some part of it that is discrete in time recorded?  The answer to this question is provided by the further development of the Fourier transform - the <i><b>discrete Fourier transform (DFT)</b></i> . <br><br>  The discrete Fourier transform is designed to solve the problem of the need for continuity and infinity in time of a signal.  In fact, we believe that we cut out some part of the infinite signal, and the rest of the time domain we consider this signal to be zero. <br><br>  Mathematically, this means that, having a function f (t) that is endless in time, we multiply it by a window function w (t), which vanishes everywhere except for the time interval of interest. <br><br>  If the "output" of the classical Fourier transform is the spectrum - function, then the "output" of the discrete Fourier transform is the discrete spectrum.  And the input is also fed samples of a discrete signal. <br><br>  The remaining properties of the Fourier transform do not change: you can read about them in the relevant literature. <br><br>  We only need to know about the Fourier transform of a sinusoidal signal, which we will try to find in our spectrum.  In general, this is a pair of delta functions that are symmetrical about the zero frequency in the frequency domain. <br><br><img src="https://habrastorage.org/files/8c0/e1c/bad/8c0e1cbad8dd44dd9e082f5b7b7d2d57.png" alt="image" width="400"><br>  Fig.  2. Amplitude spectrum of a sinusoidal signal. <br><br>  I have already mentioned that, generally speaking, we are not considering the original function, but some of its product with a window function.  Then, if the spectrum of the original function is F (w), and the window W (w), then the spectrum of the product will be such an unpleasant operation as the convolution of these two spectra (F * W) (w) (The convolution theorem). <br><br>  In practice, this means that instead of the delta function, in the spectrum we will see something like this: <br><br><img src="https://habrastorage.org/files/073/98d/aaf/07398daaf54445babf867ccc95e0cca7.png" alt="image" width="400"><br>  Fig.  3. The effect of spreading the spectrum. <br><br>  This effect is also called spectral leekage.  And the noise that appears as a result of spreading the spectrum, respectively, <i><b>side lobes</b></i> (eng. Sidelobes). <br>  To combat side lobes use other, non-rectangular window functions.  The main characteristic of the "efficiency" of the window function is the <i><b>level of side lobes</b></i> (dB).  A summary table of side-lobe levels for some commonly used window functions is shown below. <br><br><table><tbody><tr><td>  Window function </td><td>  Side lobe level (dB) </td></tr><tr><td>  Dirichlet window (rectangular window) </td><td>  -13 dB </td></tr><tr><td>  Window hannah </td><td>  -31.5 dB </td></tr><tr><td>  Hamming window </td><td>  -42 dB </td></tr></tbody></table><br><br>  The main problem in our problem is that side lobes can mask other harmonics lying side by side. <br><br><img src="https://habrastorage.org/files/51a/554/360/51a55436001b442a9fc62bfe3ffdd586.png" alt="image" width="400"><br>  Fig.  4. Separate harmonic spectra. <br><br>  It is seen that when adding the above spectra, the weaker harmonics seem to dissolve into the stronger one. <br><br><img src="https://habrastorage.org/files/ce9/56b/f4f/ce956bf4f3df4689a05ec607543193f9.png" alt="image" width="400"><br>  Fig.  5. Only one harmonic is clearly visible.  Not good. <br><br>  Another approach to combating spreading the spectrum is to subtract from the signal the harmonics that create this spreading. <br>  That is, by setting the amplitude, frequency and initial phase of the harmonic, you can subtract it from the signal, and we will remove the ‚Äúdelta function‚Äù corresponding to it, and with it the side lobes generated by it.  Another question is how to exactly know the parameters of the desired harmonic.  It is not enough to simply take the necessary data from the complex amplitude.  The complex amplitudes of the spectrum are formed at integral frequencies, however, nothing prevents the harmonic from having a fractional frequency.  In this case, the complex amplitude seems to spread between two adjacent frequencies, and its exact frequency, like other parameters, cannot be set. <br><br>  To establish the exact frequency and complex amplitude of the desired harmonic, we will use a technique widely used in many branches of engineering practice - <i><b>heterodyning</b></i> . <br><br>  Let's see what happens if we multiply the input signal by the complex harmonic Exp (I * w * t).  The signal spectrum will shift by the value of w to the right. <br>  We will use this property by shifting the spectrum of our signal to the right until the harmonic resembles the delta function even more (that is, until some local signal-to-noise ratio reaches its maximum).  Then we can calculate the exact frequency of the desired harmonic, such as w <sub>0</sub> - w <sub>het</sub> , and subtract it from the original signal to suppress the spreading effect of the spectrum. <br>  An illustration of the change in spectrum depending on the LO frequency is shown below. <br><br><img src="https://habrastorage.org/files/c81/207/484/c812074842b14831b49d71ede4ce3d70.gif" alt="image"><br>  Fig.  6. Type of amplitude spectrum depending on the frequency of the local oscillator. <br><br>  We will repeat the described procedures until we cut out all the harmonics present, and the spectrum does not remind us of the spectrum of white noise. <br><br>  Then, you need to evaluate the standard deviation of white noise.  Tricks are not here: you can simply use the formula for calculating the deviations: <br><br><img src="https://habrastorage.org/files/8f6/caf/003/8f6caf003a884fc8b241e256d76580c0.png" alt="image"><br><br><h4>  Automate it </h4><br>  It's time to automate the harmonic extraction.  Repeat one more time algorithm: <br><br>  1. We are looking for a global peak of the amplitude spectrum, above a certain threshold k. <br>  1.1 If not found, finish <br>  2. By varying the frequency of the local oscillator, we are looking for a value of the frequency at which the maximum of some local signal-to-noise ratio will be reached in a certain neighborhood of the peak <br>  3. If necessary, round off the amplitude and phase values. <br>  4. Subtract the harmonic from the signal with the found frequency, amplitude and phase minus the local oscillator frequency. <br>  5. Go to step 1. <br><br>  The algorithm is not complicated, and the only question that arises is where do we get the threshold values, above which we will look for harmonics? <br>  To answer this question, you should estimate the noise level before cutting out the harmonics. <br><br>  We construct the distribution function (hello, mate. Statistics), where the amplitude of the harmonics will be on the abscissa axis, and the number of harmonics not exceeding in amplitude will be the very value of the argument on the ordinate axis.  An example of such a constructed function: <br><br><img src="https://habrastorage.org/files/ace/319/c5e/ace319c5e6b94e9d8bb6619205bba069.png" alt="image" width="400"><br>  Fig.  7. Harmonic distribution function. <br><br>  Now we also construct a function - the distribution density.  That is, the values ‚Äã‚Äãof finite differences from the distribution function. <br><br><img src="https://habrastorage.org/files/7d4/a4b/629/7d4a4b6295994c3aa207bce9c421c8d5.png" alt="image" width="400"><br>  Fig.  8. Density of the harmonic distribution function. <br><br>  The abscissa of the distribution density maximum is the amplitude of the harmonic occurring in the spectrum the greatest number of times.  Let's move away from the peak to the right for some distance, and we will consider the abscissa of this point as an estimate of the noise level in our spectrum.  Now you can and automate. <br><br><div class="spoiler">  <b class="spoiler_title">Look at a piece of code that detects harmonics as part of a signal.</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ArrayList&lt;SynthesizableSignal&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectHarmonics</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SignalCutter cutter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SignalCutter(source, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Signal(source)); SynthesizableComplexExponent heterodinParameter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SynthesizableComplexExponent(); heterodinParameter.setProperty(<span class="hljs-string"><span class="hljs-string">"frequency"</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>); Signal heterodin = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Signal(source.getLength()); Signal heterodinedSignal = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Signal(cutter.getCurrentSignal()); Spectrum spectrum = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Spectrum(heterodinedSignal); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> harmonic; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((harmonic = spectrum.detectStrongPeak(min)) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cutter.getCuttersCount() &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Unable to analyze signal! Try another parameters."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> heterodinSelected = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> signalToNoise = spectrum.getRealAmplitude(harmonic) / spectrum.getAverageAmplitudeIn(harmonic, windowSize); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> heterodinFrequency = -<span class="hljs-number"><span class="hljs-number">0.5</span></span>; heterodinFrequency &lt; (<span class="hljs-number"><span class="hljs-number">0.5</span></span> + heterodinAccuracy); heterodinFrequency += heterodinAccuracy) { heterodinParameter.setProperty(<span class="hljs-string"><span class="hljs-string">"frequency"</span></span>, heterodinFrequency); heterodinParameter.synthesizeIn(heterodin); heterodinedSignal.set(cutter.getCurrentSignal()).multiply(heterodin); spectrum.recalc(); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> newSignalToNoise = spectrum.getRealAmplitude(harmonic) / spectrum.getAverageAmplitudeIn(harmonic, windowSize); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newSignalToNoise &gt; signalToNoise) { signalToNoise = newSignalToNoise; heterodinSelected = heterodinFrequency; } } SynthesizableCosine parameter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SynthesizableCosine(); heterodinParameter.setProperty(<span class="hljs-string"><span class="hljs-string">"frequency"</span></span>, heterodinSelected); heterodinParameter.synthesizeIn(heterodin); heterodinedSignal.set(cutter.getCurrentSignal()).multiply(heterodin); spectrum.recalc(); parameter.setProperty(<span class="hljs-string"><span class="hljs-string">"amplitude"</span></span>, MathHelper.adaptiveRound(spectrum.getRealAmplitude(harmonic))); parameter.setProperty(<span class="hljs-string"><span class="hljs-string">"frequency"</span></span>, harmonic - heterodinSelected); parameter.setProperty(<span class="hljs-string"><span class="hljs-string">"phase"</span></span>, MathHelper.round(spectrum.getPhase(harmonic), <span class="hljs-number"><span class="hljs-number">1</span></span>)); cutter.addSignal(parameter); cutter.cutNext(); heterodinedSignal.set(cutter.getCurrentSignal()); spectrum.recalc(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cutter.getSignalsParameters(); }</code> </pre> <br></div></div><br><h4>  Practical part </h4><br>  I do not claim to be a Java expert, and the solution presented can be questionable both in terms of performance and memory consumption, and in general, Java philosophy and OOP philosophy, no matter how hard I try to make it better.  It was written for a couple of evenings, as proof of concept.  Those interested can see the source code on <a href="https://github.com/xwarior/SignalAnalyzer">GitHub</a> . <br><br>  The only difficulty was the generation of a PDF report on the results of the analysis: the PDFbox didn‚Äôt want to work with Cyrillic.  By the way, does not want now. <br><br>  The project used libraries: <br>  JFreeChart - display charts <br>  PDFBox - report building <br>  JLatexMath - Rendering Latex Formulas <br><br>  As a result, a rather massive program (13.6 megabytes) turned out, which conveniently implements the task. <br><br>  It is possible to cut the harmonics manually, and entrust this task to the algorithm. <br><br>  Thank you all for your attention! <br><br><div class="spoiler">  <b class="spoiler_title">Examples of signals for analysis</b> <div class="spoiler_text">  <a href="">Signal 1</a> <br>  <a href="">Signal 2</a> <br>  <a href="">Signal 3</a> <br>  <a href="">Signal 4</a> <br>  <a href="">Signal 5</a> <br>  <a href="">Signal 6</a> <br>  <a href="">Signal 7</a> <br></div></div><br>  <a href="http://m3studio.org/dsp/testReport.pdf">Sample report created by the program</a> . <br><br><h4>  Literature </h4><br>  <i>A. B. Sergienko - Digital Signal Processing</i> </div><p>Source: <a href="https://habr.com/ru/post/253447/">https://habr.com/ru/post/253447/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../253437/index.html">Modular File Manager Cloud Commander 2.0</a></li>
<li><a href="../253439/index.html">Advanced website parsing with Mechanize</a></li>
<li><a href="../253441/index.html">Technosphere - 1 year</a></li>
<li><a href="../253443/index.html">SaltStack: Creating dependent or referencing service configurations</a></li>
<li><a href="../253445/index.html">Django DB Mailer is a simple and convenient battery for sending email messages in your project.</a></li>
<li><a href="../253449/index.html">How to display the number of alerts in the name of the browser tab</a></li>
<li><a href="../253455/index.html">Yet another success story</a></li>
<li><a href="../253457/index.html">SAP announces CodeJam and invites you to share</a></li>
<li><a href="../253467/index.html">Effective Navigation Simplification, Part 2: Navigation Systems</a></li>
<li><a href="../253469/index.html">Angular 2.0.0-alpha for those who can't wait</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>