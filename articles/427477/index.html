<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We are preparing hierarchical clustering or how I have identified specializations from resumes.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I work as a developer in hh.ru , and I want to go to datasayns, but so far there is not enough skills. Therefore, in my free time I study machine lear...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We are preparing hierarchical clustering or how I have identified specializations from resumes.</h1><div class="post__text post__text-html js-mediator-article">  I work as a developer in <a href="https://hh.ru/">hh.ru</a> , and I want to go to datasayns, but so far there is not enough skills.  Therefore, in my free time I study machine learning and try to solve practical problems from this area.  Recently I was given a task to cluster our resumes.  The post will be about how I solved it with the help of agglomerative hierarchical clustering.  If you do not want to read, but the result is interesting, you can see the <a href="http://clusters.s2533.ru/clusters/">demo</a> right away. <br><img src="https://habrastorage.org/webt/qq/wo/zd/qqwozd8poikfgjyhq0fmss86uak.png"><br><a name="habracut"></a><br><br><h4>  Prerequisites </h4><br>  The labor market is constantly in dynamics, new professions arise, others disappear, and I want to have an up-to-date categorization of resume.  On hh.ru, the catalog of professional oblasts and specializations has long been outdated: a lot of it is tied up on it, so the changes have not been made for a long time.  It would be helpful to learn how to edit these categories painlessly.  I attempt to automatically identify these categories.  I hope that in the future it will help to solve the problem. <br><br><h4>  About the selected approach and clustering </h4><br>  By clustering, I will understand the union of objects with the most similar features into one group.  In my case, the object is considered a resume, and under the signs of the object - data summary: for example, the frequency of the word "manager" in the resume or salary.  The similarity of objects is determined by a pre-selected metric.  For now, you can think of it as a black box, to which two objects are fed to the input, and the output is a number that reflects, for example, the distance between objects in a vector space: the smaller the distance, the more similar the objects. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The approach I used can be called ascending agglomerative hierarchical clustering.  The result of clustering is a binary tree, where there are separate elements in the leaves, and the root of the tree is the collection of all elements.  It is called ascending because clustering starts from the lowest level of the tree, from the leaves, where each individual element is considered as a cluster. <br><img src="https://habrastorage.org/webt/tm/q5/k-/tmq5k-eld8dfsvffjfebi9yc9pu.png"><br><br>  Then you need to find the next two clusters and merge them into a new cluster.  This procedure must be repeated until there is one cluster with all the objects inside.  When clusters are merged, the distance between them is recorded.  In the future, these distances can be used to determine where these distances are large enough to consider selected clusters as separate. <br><br>  Most clustering methods assume that the number of clusters is known in advance, or they try to isolate the clusters on their own, depending on the algorithm and parameters of this algorithm.  The advantage of hierarchical clustering is that you can try to determine the desired number of clusters by examining the properties of the resulting tree, for example, to allocate those subtrees to different groups, the distances between which are quite large.  It is convenient to work with the resulting structure to search for clusters in it.  Conveniently, such a structure is built once and does not need to be rebuilt when searching for the required number of clusters. <br><br>  Among the shortcomings, I would mention that the algorithm is rather demanding of consumed memory.  And even instead of assigning a particular class, I would like to have the probability that the summary of a class belongs to a class in order to look not at one nearest specialty, but at the totality. <br><br><h4>  Data collection and preparation </h4><br>  The most important part in working with data is their preparation, selection and extraction of features.  It is based on what signs will be obtained in the end, will it depend on whether there are patterns in them, whether these patterns will correspond to the expected result and whether this ‚Äúexpected result‚Äù is possible at all.  Before feeding the data to any machine learning algorithm, you need to have an idea about each feature, whether there are gaps, what type is the feature, what properties does this type of feature have and what is the distribution of values ‚Äã‚Äãin this feature.  It is also very important to choose the algorithm by which the existing data will be processed. <br><br>  I took resumes that were updated during the last six months.  It turned out 2.7 million. From the data on the resume I chose the simplest signs, from which, it seemed to me, the membership of the resume should depend on this or that group.  Looking ahead, I will say that the result of clustering all resumes at once did not satisfy me.  Therefore, we had to first divide the summary of the already existing 28 professional oblasts. <br><br>  For each feature, I plotted the distribution to get an idea of ‚Äã‚Äãhow the data looked.  Perhaps they should somehow be converted or completely abandoned. <br><br>  <u>Region</u>  So that the values ‚Äã‚Äãof this attribute could be compared with each other, I assigned the total number of summaries entering this region to each region and took the logarithm of this number to smooth the difference between very large and small cities. <br><br>  <u>Paul</u>  Transformed into a binary sign. <br><br>  <u>Date of birth</u> .  Recalculated in the number of months.  Birthday is not specified at all.  I filled the gaps with the average values ‚Äã‚Äãof the age of the specialization to which this resume belongs. <br><br>  <u>Level of education</u>  This is a categorical feature.  I coded it with <a href="http://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.LabelBinarizer.html">LabelBinarizer</a> . <br><br>  <u>The name of the position</u> .  I drove through <a href="http://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.TfidfVectorizer.html">TfidfVectorizer</a> with ngram_range = (1,2), used <a href="https://www.nltk.org/api/nltk.stem.html">stemmer</a> . <br><br>  <u>Salary</u> .  Translated all values ‚Äã‚Äãinto rubles.  Gaps filled in the same way as in age.  Took from the logarithm value. <br><br>  <u>Work schedule</u> .  Encoded LabelBinarizer. <br><br>  <u>Employment rate</u>  Made binary, divided into two parts: full-time and all the rest. <br><br>  <u>Language proficiency</u> .  Chose the top most used.  Each language is set as a separate feature.  The levels of ownership compared the numbers from 0 to 5. <br><br>  <u>Key skills</u> .  Chased through TfidfVectorizer.  As a stop word, I collected a small dictionary of general skills and words, which, it seemed to me, do not affect the specialty.  All words missed through stemmer.  Each key skill can consist not only of one word, but also of several.  In the case of several words in the key skill, I sorted the words, and each word was additionally used as a separate attribute.  This feature is good only in the ‚ÄúInformation Technologies, Internet, Telecom‚Äù professional field, because people often indicate the skills relevant to their specialty.  I did not use it in the other professional areas because of the abundance of common words in skills. <br><br>  <u>Specializations</u> .  Each of the user-supplied specializations I set as a binary sign. <br><br>  <u>Experience</u>  I took the logarithm of the number of months + 1, since there are people with no work experience. <br><br><h4>  Standardization </h4><br>  As a result, each resume has become a vector of numbers-signs.  The selected clustering algorithm is based on calculating the distance between objects.  How to determine what contribution to this distance should make each sign?  For example, there is a binary sign - 0 and 1, and another sign can take a lot of values ‚Äã‚Äãfrom 0 to 1000. <br><br>  Standardization comes to the rescue.  I used <a href="http://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html">StandardScaler</a> .  It converts each feature in such a way that its mean value is zero and the standard deviation from the mean is one.  Thus, we try to bring all the data to the same distribution - the standard normal one.  Of course, it is far from a fact that the data itself has the nature of a normal distribution.  This is one of the reasons to build graphs of the distribution of its parameters and be glad that they look like Gaussians. <br><br>  So, for example, the schedule of distribution of salaries looked. <br><img src="https://habrastorage.org/webt/w1/w3/bu/w1w3buacpizwxvt3osu8eezcxf4.png"><br><br>  It is evident that he has a very heavy tail.  To make the distribution more like a normal one, you can take the logarithm from this data.  At the same time, emissions will not be as strong. <br><img src="https://habrastorage.org/webt/cn/86/7z/cn867zcxolxlvk2bwcjcloeaqny.png"><br><br><h4>  Dimension reduction </h4><br>  Now it makes sense to transfer the data into a space of a smaller dimension so that the clustering algorithm can later digest them in reasonable time and memory.  I used <a href="http://scikit-learn.org/stable/modules/generated/sklearn.decomposition.TruncatedSVD.html">TruncatedSVD</a> , <a href="http://scikit-learn.org/stable/modules/generated/sklearn.decomposition.TruncatedSVD.html">because</a> it can work with sparse matrices and, at the output, gives the usual dense-matrix, which we will need for further work.  By the way, in TruncatedSVD also need to submit standardized data. <br><br>  At the same stage, it is worth trying to visualize the resulting dataset, translating it into two-dimensional space using <a href="http://scikit-learn.org/stable/modules/generated/sklearn.manifold.TSNE.html">t-SNE</a> .  This is a very important step.  If the structure of the resulting image does not show any structure, or, on the contrary, this structure looks very strange, then either there is no necessary pattern in your data, or an error is made somewhere. <br><br>  I received a lot of very suspicious images before everything went well.  For example, once there was such a beautiful image: <br><img src="https://habrastorage.org/webt/rl/t9/ai/rlt9ai4ji7pge4eket3p9g5vnlm.png"><br><br>  The reason of the turned out worms was hit in resume identifiers.  And here is something that looks more like the truth: <br><img src="https://habrastorage.org/webt/gx/ns/r1/gxnsr1qyysmv5afoflqbvkpaq38.png"><br><br><h4>  Clustering </h4><br>  If it seems that everything is in order with the data, then you can start clustering.  I used the <a href="https://docs.scipy.org/doc/scipy/reference/cluster.hierarchy.html">hierarchy clustering</a> package from SciPy.  It allows clustering using the <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.cluster.hierarchy.linkage.html">linkage method</a> .  I tried all the distance metrics between clusters proposed in the algorithm.  The best result was given by <a href="https://en.wikipedia.org/wiki/Ward%2527s_method">the Ward method</a> . <br><br>  The main problem I encountered is that the clustering algorithm considers the matrix of distances between all the elements, which means quadratic dependence on the number of elements in memory.  For 2.7 million resumes, I did not succeed in this, because  The amount of memory required is terabytes.  All calculations were performed on a regular computer.  I do not have so much RAM.  Therefore, it seemed to me reasonable that you can first combine the resumes that are nearby, take the centers of the resulting groups and already cluster them with the necessary algorithm.  I took <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cluster.MiniBatchKMeans.html">MiniBatchKMeans</a> , created with it 30,000 clusters and sent them to hierarchical clustering.  It worked, but the result was so-so.  Many brightest groups of resumes have stood out, but the details are not enough to find specializations at a good level. <br><br>  In order to improve the quality of the received specializations, I have divided the data into professional fields.  It turned out datasets from 400 000 resumes and less.  At this point, it occurred to me that clustering a sample of data was better than using two algorithms in a row.  Therefore, I refused MiniBatchKMeans and took up to 100,000 resumes for each specialization so that the linkage method could digest them.  32 Gb of RAM was not enough, so I allocated an extra 100 Gb for the swap.  As a result, linkage provides a matrix with the distances between the clusters combined at each step and the number of elements in the resulting cluster. <br><br>  The algorithm used a quality test to compare different dataset options and different methods for calculating the distance between clusters. The algorithm used the cophenetic correlation coefficient obtained from <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.cluster.hierarchy.cophenet.html">cophenet</a> .  This coefficient shows how well the resulting dendrogram reflects the dissimilarity of objects against each other.  The closer the value is to one, the better. <br><br><h4>  Visualization </h4><br>  The best way to validate the quality of clustering work was visualization.  The <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.cluster.hierarchy.dendrogram.html">dendrogram</a> method draws the resulting dendrograms, where clusters can be distinguished by distance or level in the tree: <br><img src="https://habrastorage.org/webt/gc/ra/bd/gcrabdkgdble5gfp8zlvqdj2lg4.png"><br><br>  The following graph shows the dependence of the distance between clusters on the iteration step number, in which the two closest clusters merge into a new one.  The green line shows how the acceleration varies - the speed of change of the distance between the clusters being merged. <br><img src="https://habrastorage.org/webt/as/sv/jl/assvjl4dypvcog52ibjycg4vwyw.png"><br><br>  In the case of a small number of clusters, it would be possible to try to cut the tree at the point where the acceleration is maximum, that is, the distance at this point, when the two clusters merged was even larger, and the next step was less.  In my case, everything is different - I have many clusters, and I assumed that it is better to cut the dendrogram at the point where the acceleration begins to decrease more monotonously, that is, the distance between the clusters at this level does not mean a separate group.  On the chart, this place is approximately at the point where the green line stops dancing. <br><br>  One could come up with some program method, but it turned out to be faster to mark these places with 28 hands for 28 trade unions and submit the desired number of clusters to the <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.cluster.hierarchy.fcluster.html">fcluster</a> method, which will cut the tree in the right place. <br><br>  I saved the data obtained earlier from t-SNE, and noted on them the resulting clusters.  It looks pretty good: <br><img src="https://habrastorage.org/webt/ey/i1/8y/eyi18yqgkcxsrrnil23icje_rjw.png"><br><br>  In the end, I made a web interface where you can see a summary from each cluster, its position on the chart and give a meaningful name.  For convenience, the most frequent title of the summary is derived - it often characterizes the name of the cluster well. <br><br>  Look at the result of clustering <a href="http://clusters.s2533.ru/clusters/">here</a> . <br><br>  I concluded for myself that the system turned out to be working.  Although the division into imperfect clusters and some groups are very similar to each other, some could, on the contrary, be divided into parts, but the main trends of the market of specialties are clearly visible.  You can also see how new groups are formed.  Resume uploading was done in the summer, so <a href="http://clusters.s2533.ru/clusters/Transportlogistika/40">drivers,</a> for example, <a href="http://clusters.s2533.ru/clusters/Transportlogistika/40">who want to work at the World Cup</a> , stood out.  If you learn how to match each other clusters from launch to launch, you can observe how the main areas of specialization change over time.  In fact, ideas for improving quality and development are still full.  If I can find in myself the necessary motivation, I will develop further. <br><br><h4>  Additional materials </h4><br>  <a href="https://www.coursera.org/lecture/unsupervised-learning/aghlomierativnaia-iierarkhichieskaia-klastierizatsiia-STrfh">Video about agglomerative hierarchical clustering</a> from a course about structure search in data <br>  <a href="http://sebastianraschka.com/Articles/2014_about_feature_scaling.html">About scaling and normalization of signs</a> <br>  <a href="https://joernhees.de/blog/2015/08/26/scipy-hierarchical-clustering-and-dendrogram-tutorial/">Tutorial on hierarchical clustering</a> from the SciPy library, which I took as the basis of my task <br>  <a href="http://scikit-learn.org/stable/modules/clustering.html">Comparison of various types of clustering</a> using the example of sklearn libraries <br><br>  A small bonus.  I thought that people wondered how someone was working on a task.  I want to say that in some matters I pumped well, while I was doing this project.  I tried different options, studied, pondered how this or that thing works.  In many places, the lack of a good mathematical base was compensated for by resourcefulness and a large number of attempts.  And I would like to share a <a href="https://www.evernote.com/shard/s413/sh/9ca503b0-988f-4075-990f-744cf86e6780/31d14b22b373a31a618474727f099c7d">leaflet with Evernote</a> , in which I made notes, while working on the task.  Reflections in it were intended only for me, there are a lot of heresy and incomprehensibility, but I think that this is normal. <br><br>  UPD: Laid out laptops with <a href="https://github.com/shurik2533/notebooks/blob/master/prepare_dataset.ipynb">data preparation</a> and <a href="https://github.com/shurik2533/notebooks/blob/master/clustering.ipynb">clustering</a> code.  The code did not plan to spread, so sorry for the quality. </div><p>Source: <a href="https://habr.com/ru/post/427477/">https://habr.com/ru/post/427477/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../427467/index.html">The quickest introduction to Reactive Programming</a></li>
<li><a href="../427469/index.html">Revenue and profits of electronics manufacturers, or who has more margin</a></li>
<li><a href="../427471/index.html">Developing unmanned vehicles in high school with LEGO EV3</a></li>
<li><a href="../427473/index.html">What problems Temlida can solve with the game</a></li>
<li><a href="../427475/index.html">Android LiveData at Kotlin using Retrofit and coroutines</a></li>
<li><a href="../427479/index.html">The use of user data and the sale of big data offered to legitimize</a></li>
<li><a href="../427481/index.html">Features of building a Wi-Fi network on innovative food production</a></li>
<li><a href="../427483/index.html">School of Artificial Intelligence in Binary District</a></li>
<li><a href="../427485/index.html">Windows problem is not in the frequency of updates, but in the development process</a></li>
<li><a href="../427487/index.html">Testing configuration for Java developers: practical experience</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>