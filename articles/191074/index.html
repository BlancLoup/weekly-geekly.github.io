<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Localization of templates on the client in AngularJS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing a multilingual web application on AngularJS, you will most likely need to somehow solve the issue with the translation. Today I would ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Localization of templates on the client in AngularJS</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f50/cda/f62/f50cdaf621e4078f0207747d3de11172.png" alt="image"><br><br>  When developing a multilingual web application on <a href="http://angularjs.org/">AngularJS,</a> you will most likely need to somehow solve the issue with the translation.  Today I would like to share one of the ways in which this can be implemented. <br><a name="habracut"></a><br>  Suppose we already have a service that provides the ability to translate using a simple dictionary of strings. <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * @param {Settings} Settings * @constructor */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Language</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Settings</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Settings = Settings; } Language.$inject = [<span class="hljs-string"><span class="hljs-string">'Settings'</span></span>]; app.service(<span class="hljs-string"><span class="hljs-string">'Language'</span></span>, Language); <span class="hljs-comment"><span class="hljs-comment">/** * @param {String} string * @returns {String} */</span></span> Language.prototype.translate = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> translation = __lang[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Settings.getValue(<span class="hljs-string"><span class="hljs-string">'lang'</span></span>)]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> translation[string] !== <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { string = translation[string]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> string; };</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Knowing AngularJS, the very first idea that comes to mind is to use standard expressions with filters to translate strings on the fly: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>{{ 'some_english_string' | translate }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  But this approach has its drawbacks: <br>  - first, all the same, the amount of code executed in each $ digest cycle increases, and if you have a complex application, a large number of lines are displayed on the page at the same time and / or your translation algorithm is more complicated than simply supplying a string from a dictionary with a key - then productivity will decline. <br>  - secondly, the use of angular expressions will no longer be so convenient if you use them, say, inside the attributes of some directives that themselves accept expressions, since the execution of expressions within other expressions will not work.  In this case, of course, it will be possible to use a global function instead of a filter for converting such strings, but still these are additional difficulties. <br><br>  The second option, which is recommended to use is to translate templates on the server and from the client side to have access to localized copies of the form <b>some_partial_en.html</b> , <b>some_partial_ru.html</b> .  In this case, to change the language, you will need to restart the application.  In addition, this is not always possible: for example, on my past project, the application used data from a third-party service, and the writing of the backend was not supposed at all. <br><br>  But there is another way - namely, to translate templates on the client, but not by means of AngularJS.  For example, you can use a template engine from <a href="http://lodash.com/">Lo-Dash</a> / <a href="http://underscorejs.org/">underscorejs</a> and use constructions like: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">t</span></span></span><span class="hljs-tag">('</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">some_english_string</span></span></span><span class="hljs-tag">') %&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The advantage is that it will be possible to use both angular expressions inside a line feed in the dictionary. <br><br><pre> <code class="javascript hljs">__lang.ru = { <span class="hljs-string"><span class="hljs-string">"some_english_string"</span></span>: <span class="hljs-string"><span class="hljs-string">"    {{string.number}}"</span></span> };</code> </pre><br>  so, and vice versa, to substitute this construct into other angular expressions, for example, in some of its directive: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input-text-right"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">my-num-format</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"00000.00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">my-validate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"[ { type: 'notGreaterThen', compareTo: 'somecondition()', message: '&lt;%= t('some_validation_error_message') %&gt;' } ]"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-model</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"model.value"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  To do this, we will add a method for translating templates into our <b>Language</b> service: <br><br><pre> <code class="javascript hljs">..... <span class="hljs-comment"><span class="hljs-comment">/** * @param {String} template * @returns {String} */</span></span> Language.prototype.translateTemplate = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">template</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     this.translate()      Lo-Dash  t() return _.template(template, { t: angular.bind(this, this.translate) }); };</span></span></code> </pre><br><br>  Now we need to intercept the templates used by angular and translate them before it compiles them.  There is no separate service for getting templates in AngularJS, but wherever it happens (routing, ngInclude directive, etc.) - <a href="http://docs.angularjs.org/api/ng.%24templateCache">$ templateCache</a> is used for caching.  Here we will redefine it: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  angular-    ,       app.factory('$templateCache', [ '$cacheFactory', 'Language', function($cacheFactory, Language) { /** * @constructor */ function MyTemplateCache() { /** * @param {String} key * @param {*} value */ this.put = function(key, value) { //   -  promise-,    $http if (typeof value.then !== 'undefined') { //    promise-,       value = value.then(function(response) { response.data = Language.translateTemplate(response.data); return response; }); } //   -  -,  angular      promise- $http else if (value instanceof Array) { value[1] = Language.translateTemplate(value[1]); } //   -    // ( ,        &lt;script type="text/ng-template"&gt;&lt;/script&gt; //   ) else if (typeof value === 'string') { value = Language.translateTemplate(value); } //    put() MyTemplateCache.prototype.put(key, value); }; } //     $templateCache MyTemplateCache.prototype = $cacheFactory('templates'); return new MyTemplateCache(); } ]);</span></span></code> </pre><br><br>  That's all.  Now, to change the language without reloading the page, it will be enough to clear the cache and trigger the reload of the route: <br><br><pre> <code class="javascript hljs">$templateCache.removeAll(); $route.reload();</code> </pre><br>  The only note is that when the route is restarted, all changes that were not saved in the state will be reset, because when you recompile the templates, all the scans will be recreated again. </div><p>Source: <a href="https://habr.com/ru/post/191074/">https://habr.com/ru/post/191074/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../191052/index.html">Nginx has a paid version - Nginx Plus</a></li>
<li><a href="../191054/index.html">STM32 vs Arduino</a></li>
<li><a href="../191060/index.html">Minimalistic RSS reader for the Yandex.Following service</a></li>
<li><a href="../191066/index.html">Cowon AE1: another unusual recorder from the manufacturer of players</a></li>
<li><a href="../191072/index.html">Jolla: pre-order over, design updated</a></li>
<li><a href="../191078/index.html">jTap - event of a click for touch devices</a></li>
<li><a href="../191080/index.html">EPAM in Silicon Valley</a></li>
<li><a href="../191082/index.html">Fundraising campaign on Ubuntu Edge is over</a></li>
<li><a href="../191084/index.html">To birthday Mastdayki</a></li>
<li><a href="../191086/index.html">Do you (not) refactor?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>