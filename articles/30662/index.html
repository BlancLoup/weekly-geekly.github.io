<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>nginx, memcached and SSI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My first article, do not judge strictly ... 

 Greetings to you, dear Habradevelopery! 

 Many of you know about the beautiful lightweight web server ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>nginx, memcached and SSI</h1><div class="post__text post__text-html js-mediator-article">  <font color="gray">My first article, do not judge strictly ...</font> <br><br>  Greetings to you, dear Habradevelopery! <br><br>  Many of you know about the beautiful lightweight web server <b><a href="http://sysoev.ru/nginx/">nginx</a></b> . <br>  Some also know that he can work with <b><a href="http://www.danga.com/memcached/">memcached</a></b> . <br>  But only a few know, what does <b><a title="Server Side Includes" href="http://en.wikipedia.org/wiki/Server_Side_Includes">SSI have to do with</a></b> and how can it be used in conjunction with nginx and memcached. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As you know, the new is a well forgotten old.  Each named tool and technology you probably know.  I want to talk about how and why to dump all this in one pile :) <br><a name="habracut"></a><br><h3>  nginx </h3><br>  In the classical scheme, nginx is used as a load balancer or reverse proxy in front of one or more Apache-type servers. <br>  nginx gives static resources - images, CSS and JS files.  It transmits requests to dynamic pages to Apache / PHP, which independently processes them and returns the result. <br><br>  Looking for articles about nginx in Habr, I didn‚Äôt find a detailed description of how this ‚Äúclassic‚Äù scheme works, but I don‚Äôt want to be distracted from the topic, so I‚Äôm advising you to go deeper to <a href="http://www.google.com/search%3Fq%3Dnginx%2Breverse%2Bproxy">googling</a> ‚Äî there‚Äôs plenty of information and tutorials on the net. <br><br><h3>  memcached </h3><br>  nginx can work with memcached using the <a href="http_memcached_module.html">ngx_http_memcached_mod</a> module. <br>  When nginx receives a request for a specific URL, it first checks to see if there is a query result for that URL in the cache.  If there is, it gives the cached page as it is, and if it does not, it sends the request processing to Apache / PHP.  Upon receiving the request, PHP prepares the response, saves it to memcached, and then displays it to the user.  Thus, with the next request at the same URL, nginx will find the result in the cache and return it to the user, bypassing the resource-intensive access to Apache / PHP. <br>  In theory, everything is simple and convenient, but in practice the use of such caching is very limited. <br><br>  Let's say we want to cache the main page of the habr :) <br>  We see the authorization block in the upper right corner (login / register, or general information about the current user), ‚Äúbookmarks‚Äù (all, collective, personal ...), tape of zahabrenny articles, tag cloud, etc. <br>  All blocks on the page can be divided into static and dynamic.  Conventionally, because in fact all blocks are dynamic, but some can be cached, while others cannot.  Think yourself, what will happen if we cache the main page for an unauthorized user, and then an authorized user logs in at the same URL?  That's right, in the upper right corner he will see an invitation to log in or register and will be at least surprised. <br><br>  What to do?  One option is not to cache the entire page!  We have the ability to exclude dynamic blocks from caching.  And help us in this ... <br><br><h3>  SSI, or Server Side Includes </h3><br>  If someone else remembers, there was such a technology before, long before JSP, ASP, PHP and other Django's with RoRs :) <br>  Its meaning is that a regular HTML page was processed in a certain way on the server before it left the client.  For example, the usual include directive looked like this: <br> <code>&lt;!--#include file="header.html"--&gt;</code> <br> <br>  Here we are just interested in this particular directive, just do not include the file, but include virtual.  They differ in that include file inserts the contents of the file instead of itself, and include virtual - the result of the virtual query at the specified URL.  In nginx, the <a href="http_ssi_module.html">ngx_http_ssi_module</a> module will help us implement our plans. <br><br>  Returning to the example with the main page of the habr, we put the page as it is in the cache, only the authorization block is replaced with the following one: <br> <code>&lt;!-- #include virtual="/auth" --&gt;</code> <br> <br>  Then, when nginx gets this page from the cache, it will have to process all SSI instructions before giving it to the client.  Thus, nginx will execute a virtual request via the URL "/ auth" and, if there are no results for this URL in the cache, it will send the request to Apache / PHP.  Now, the PHP task is to check the authorization of the current user and return the HTML code of the authorization block, depending on whether the user is authorized. <br>  After receiving the result from Apache / PHP, nginx inserts it in place of the include directive and returns the page to the client.  Thus, authorized and unauthorized clients will see different pages, the content of which will still be cached and the poor server of the habr will not need to receive a tape of captured articles for each request, generate a tag cloud, etc.  - just a simple authorization block;) <br><br><h3>  Practice </h3><br>  I wanted to immediately describe the practical examples of the implementation of this idea, but the article turned out to be rather big - I would rather write the practical part separately, with a description of the server configuration and examples in PHP &amp; Zend Framework. <br><br>  And the most impatient people of Habra the Healers already have all the links to dig deeper into this topic :) <br><br>  PS: To be honest, in practice, this approach to caching has not been applied to me, unfortunately.  There are only a few sketches of the finished code, which at first glance is quite efficient.  If the collective mind prompts bottlenecks or potential problems - I will be very grateful.  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/30662/">https://habr.com/ru/post/30662/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306606/index.html">Full Disk Encryption (FDE)</a></li>
<li><a href="../306608/index.html">Yota support service online</a></li>
<li><a href="../306612/index.html">How to mark your TODO, FIXME and ERROR in Xcode</a></li>
<li><a href="../306616/index.html">Terms of Reference for revision: 10 rules and a little tediousness</a></li>
<li><a href="../306618/index.html">World of Warcraft: one line of code to lose everything</a></li>
<li><a href="../306622/index.html">Web application vulnerabilities: users hit</a></li>
<li><a href="../306624/index.html">The creators of the film Zero Days shed light on the authors of Stuxnet</a></li>
<li><a href="../306626/index.html">Graphical user interface as a reflection of the real world: the shadows and the rise of elements</a></li>
<li><a href="../306628/index.html">Updated Cisco CCNA Certification Program</a></li>
<li><a href="../30663/index.html">New firmware for iPhone?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>