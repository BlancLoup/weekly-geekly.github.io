<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>REST architecture web application controller layer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I would like to share the experience of developing a controller layer in our web framework. What we want from this layer: 


- abstra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>REST architecture web application controller layer</h1><div class="post__text post__text-html js-mediator-article">  In this article, I would like to share the experience of developing a controller layer in our web framework.  What we want from this layer: <br><ul><li>  abstraction of HTTP request and response, compensation for the inconvenience of the embedded implementation; </li><li>  the ability to build request handlers from separate modules (middleware); </li><li>  most importantly: URL scheduling, simple scheduling rule set structure; </li><li>  REST as the most versatile architecture. </li></ul><br><a name="habracut"></a><br>  Basically, I would like to focus on the last two points, so the rest is very superficial, especially since these are obvious things. <br><br><h4>  HTTP request and response abstraction </h4><br>  Unlike the vast majority of web frameworks in various languages, PHP does not have a normal interface for working with the request object (at least in the average configuration).  There are many special variables that contain fragmented and not always uniformly structured information (which is only worth the difference in the data structure, for example, in <code>$_POST</code> and <code>$_FILES</code> ). <br><br>  Therefore, in the best traditions of PHP, we are rapidly inventing a bicycle in the form of an object of the <code>Net_HTTP_Request</code> class.  Its main features are: convenient access to the parameters and fields of the request header, uploads as file objects, etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code><font color="#a52a2a">1</font> <font color="#6a5acd">&lt;?php</font> &lt;br&gt; <br> <font color="#a52a2a">2</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">id</font> <font color="#a52a2a"><b>=</b></font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">request</font> <font color="#6a5acd">[</font> ' <font color="#ff00ff">id</font> ' <font color="#6a5acd">]</font> ;&lt;br&gt; <br> <font color="#a52a2a">3</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">auth</font> <font color="#a52a2a"><b>=</b></font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">request</font> <font color="#2e8b57"><b>-&gt;</b></font> header <font color="#6a5acd">[</font> ' <font color="#ff00ff">Authorization</font> ' <font color="#6a5acd">]</font> &lt;br&gt; <br> <font color="#a52a2a">4</font> <font color="#a52a2a"><b>foreach</b></font> <font color="#6a5acd">(</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">request</font> <font color="#6a5acd">[</font> ' <font color="#ff00ff">upload</font> ' <font color="#6a5acd">]</font> <font color="#a52a2a"><b>as</b></font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">line</font> <font color="#6a5acd">)</font> <font color="#6a5acd">{</font> <font color="#0000ff">/* ... */</font> <font color="#6a5acd">}</font> &lt;br&gt; <br> <font color="#a52a2a">5</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">stores</font> <font color="#a52a2a"><b>=</b></font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">request</font> <font color="#6a5acd">[</font> ' <font color="#ff00ff">upload</font> ' <font color="#6a5acd">]</font> <font color="#2e8b57"><b>-&gt;</b></font> copy_to <font color="#6a5acd">(</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">permanent_path</font> <font color="#6a5acd">)</font> ;&lt;br&gt; <br> <font color="#a52a2a">6</font> <font color="#6a5acd">?&gt;</font> &lt;br&gt; <br></code> <br><br>  Similarly, a response is represented by an object of the <code>Net_HTTP_Response</code> class, which provides convenient work with response headers, body as a string, iterator or file object, etc. <br><br> <code><font color="#a52a2a">1</font> <font color="#6a5acd">&lt;?php</font> &lt;br&gt; <br> <font color="#a52a2a">2</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">file</font> <font color="#a52a2a"><b>=</b></font> IO_FS <font color="#a52a2a"><b>::</b></font> <font color="#008b8b">File</font> <font color="#6a5acd">(</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">path</font> <font color="#6a5acd">)</font> ;&lt;br&gt; <br> <font color="#a52a2a">3</font> <font color="#a52a2a"><b>return</b></font> Net_HTTP <font color="#a52a2a"><b>::</b></font> Response <font color="#6a5acd">()</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">4</font> status <font color="#6a5acd">(</font> Net_HTTP <font color="#a52a2a"><b>::</b></font> OK <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">5</font> content_type <font color="#6a5acd">(</font> MIME <font color="#a52a2a"><b>::</b></font> type_for_file <font color="#6a5acd">(</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">file</font> <font color="#6a5acd">))</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">6</font> body <font color="#6a5acd">(</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">file</font> <font color="#6a5acd">)</font> ;&lt;br&gt; <br> <font color="#a52a2a">7</font> <font color="#6a5acd">?&gt;</font> &lt;br&gt; <br></code> <br><br><h4>  Request handlers, middleware </h4><br>  Request processing is performed by service objects that implement the standard interface: <br><br> <code><font color="#a52a2a">1</font> <font color="#6a5acd">&lt;?php</font> &lt;br&gt; <br> <font color="#a52a2a">2</font> <font color="#2e8b57"><b>interface</b></font> WS_ServiceInterface <font color="#6a5acd">{</font> &lt;br&gt; <br> <font color="#a52a2a">3</font> <font color="#2e8b57"><b>public</b></font> <font color="#a020f0">function</font> run <font color="#6a5acd">(</font> WS_Environment <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">env</font> <font color="#6a5acd">)</font> ;&lt;br&gt; <br> <font color="#a52a2a">4</font> <font color="#6a5acd">}</font> &lt;br&gt; <br> <font color="#a52a2a">5</font> <font color="#6a5acd">?&gt;</font> &lt;br&gt; <br></code> <br><br>  The result of the <code>run()</code> method execution is an object of the <code>Net_HTTP_Response</code> class.  The <code>WS_Environment</code> class <code>WS_Environment</code> designed to exchange information between service objects; each service can create, read, or write the value of an environment parameter.  By default, the environment contains the <code>$env-&gt;request</code> element of the <code>$env-&gt;request</code> class. <br><br>  If the service in the process of processing calls another service, modifying the request, response, or environment, we get the so-called middleware component, the name is entered into use by <a href="http://wsgi.org/wsgi/">the WSGI standard</a> .  We have a set of trivial middleware-services that implement the configuration of the application, connect to the database, caching, authorization, and most interesting, dispatching. <br><br>  In general, it was an obvious preamble, we turn, finally, to the ambulla. <br><br><h4>  REST based dispatching </h4><br>  In many existing frameworks, dispatching is built on the basis of matching the calls of various application methods to regular expressions applied to the URL string.  The need to support REST has led to the emergence of various REST-oriented add-ons over this scheme, which, first of all, provide an analysis of the HTTP request method. <br><br>  Dispatching based on a set of regular expressions has several drawbacks, first of all: <br><ol><li>  for large applications there is a risk of getting a large complex system of heterogeneous rules, heavy in support; </li><li>  the rule system is static, it is difficult to influence the result of dispatching directly in its process; </li><li>  Difficult to dispatch for nested resources with an arbitrary level of nesting. </li></ol><br>  In the process of choosing the dispatching scheme for the library, we looked at the various existing options and most of all we liked the approach proposed in the <a href="https://jsr311.dev.java.net/">Java standard JAX-RS</a> (JSR-311). <br><br>  Why did we choose this standard? <br><ul><li>  plain; </li><li>  Transparently transfers the REST model to the level of the application code; </li><li>  allows you to conveniently work with nested resources; </li><li>  does not impose restrictions on classes that implement resources. </li></ul><br>  We have implemented a simplified version of the standard, taking into account the PHP specifics: <br><ul><li>  to describe the resources using its own DSL, rather than annotations; </li><li>  we abandoned the possibility of an arbitrary order of resource determination, which significantly simplified the algorithm. </li></ul><br>  Our request manager is implemented as a service object ( <pre>  WS_ServiceInteface </pre>  ).  Its <code>run()</code> method delegates processing to a user-defined resource object created by the dispatcher based on the description of the application‚Äôs resource set. <br><br>  A resource is just an object of an arbitrary class.  It is not necessary to inherit it from any standard parent class, it does not need to implement any standard interface.  In this case, in a user application, it is most likely that it makes sense to introduce a hierarchy of inheritance in order to avoid duplication of code, but the framework does not require this. <br><br>  A resource class implements a set of methods that can be divided into three types: <br><ul><li>  helper methods intended for use within the class; </li><li>  HTTP methods that process various types of requests and return response objects; </li><li>  sublocators generating instances of nested resource classes. </li></ul><br><h4>  Application resources </h4><br>  A set of resources forms the application.  The application contains a description of its resources, for the construction of the description is used internal DSL. <br><br>  To make a decision on calling a resource method, you must have a complete description of the available resources and their methods.  The code of one or several resources is actually executed, so there is no need to load all classes.  Thus, the description of the resources that make up the application should be separated from their actual implementation. <br><br>  Example application schema: <br><br> <code><font color="#a52a2a">1</font> <font color="#6a5acd">&lt;?php</font> &lt;br&gt; <br> <font color="#a52a2a">2</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">companies</font> <font color="#a52a2a"><b>=</b></font> WS_REST_DSL <font color="#a52a2a"><b>::</b></font> Application <font color="#6a5acd">()</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">3</font> begin_resource <font color="#6a5acd">(</font> ' <font color="#ff00ff">company</font> ', ' <font color="#ff00ff">App.WS.Company</font> ', ' <font color="#ff00ff">company/{name:[a-zA-Z][a-zA-Z-]+}</font> ' <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">4</font> sublocator <font color="#6a5acd">(</font> ' <font color="#ff00ff">blog</font> ' <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> <font color="#0000ff">//    - </font> &lt;br&gt; <br> <font color="#a52a2a">5</font> sublocator <font color="#6a5acd">(</font> ' <font color="#ff00ff">vacancies</font> ' <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> <font color="#0000ff">//    -  </font> &lt;br&gt; <br> <font color="#a52a2a">6</font> for_format <font color="#6a5acd">(</font> ' <font color="#ff00ff">html</font> ' <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">7</font> index <font color="#6a5acd">()</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> <font color="#0000ff">// /company/Techart/ -  </font> &lt;br&gt; <br> <font color="#a52a2a">8</font> <font color="#008b8b">end</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">9</font> <font color="#008b8b">end</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">10</font> begin_resource <font color="#6a5acd">(</font> ' <font color="#ff00ff">blog</font> ', ' <font color="#ff00ff">App.WS.Blog</font> ', <font color="#2e8b57"><b>null</b></font> <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">11</font> sublocator <font color="#6a5acd">(</font> ' <font color="#ff00ff">entry</font> ', ' <font color="#ff00ff">{\d+:id}</font> ' <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">12</font> for_format <font color="#6a5acd">(</font> ' <font color="#ff00ff">html</font> ' <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">13</font> get_for <font color="#6a5acd">(</font> ' <font color="#ff00ff">{page_no:\d+}</font> ', ' <font color="#ff00ff">index</font> ' <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> <font color="#0000ff">// /company/Techart/blog/5.html -  </font> &lt;br&gt; <br> <font color="#a52a2a">14</font> post <font color="#6a5acd">()</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> <font color="#0000ff">//    -    create()</font> &lt;br&gt; <br> <font color="#a52a2a">15</font> index <font color="#6a5acd">()</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> <font color="#0000ff">// /company/Techart/blog/ -    </font> &lt;br&gt; <br> <font color="#a52a2a">16</font> <font color="#008b8b">end</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">17</font> for_format <font color="#6a5acd">(</font> ' <font color="#ff00ff">rss</font> ' <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">18</font> get <font color="#6a5acd">(</font> ' <font color="#ff00ff">index_rss</font> ' <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> <font color="#0000ff">// /company/Techart/blog/index.rss - RSS- </font> &lt;br&gt; <br> <font color="#a52a2a">19</font> <font color="#008b8b">end</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">20</font> <font color="#008b8b">end</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">21</font> begin_resource <font color="#6a5acd">(</font> ' <font color="#ff00ff">entry</font> ', ' <font color="#ff00ff">App.WS.Entry</font> ', <font color="#2e8b57"><b>null</b></font> <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">22</font> for_format <font color="#6a5acd">(</font> ' <font color="#ff00ff">html</font> ' <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">23</font> index <font color="#6a5acd">()</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> <font color="#0000ff">// /company/Techart/blog/82715/ -    </font> &lt;br&gt; <br> <font color="#a52a2a">24</font> get_for <font color="#6a5acd">(</font> ' <font color="#ff00ff">print</font> ', ' <font color="#ff00ff">print_version</font> ' <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> <font color="#0000ff">// /company/Techart/blog/82715/print.html -   </font> &lt;br&gt; <br> <font color="#a52a2a">25</font> put <font color="#6a5acd">()</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> <font color="#0000ff">//  ,   -  update()</font> &lt;br&gt; <br> <font color="#a52a2a">26</font> <font color="#008b8b">delete</font> <font color="#6a5acd">()</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> <font color="#0000ff">//   ,   -  delete()</font> &lt;br&gt; <br> <font color="#a52a2a">27</font> <font color="#008b8b">end</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">28</font> <font color="#008b8b">end</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">29</font> begin_resource <font color="#6a5acd">(</font> ' <font color="#ff00ff">vacancies</font> ', ' <font color="#ff00ff">App.WS.Job</font> ', <font color="#2e8b57"><b>null</b></font> <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">30</font> for_format <font color="#6a5acd">(</font> ' <font color="#ff00ff">html</font> ' <font color="#6a5acd">)</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">31</font> index <font color="#6a5acd">()</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> <font color="#0000ff">// /company/Techart/vacancies/ -   </font> &lt;br&gt; <br> <font color="#a52a2a">32</font> <font color="#008b8b">end</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">33</font> <font color="#008b8b">end</font> <font color="#a52a2a"><b>-</b></font> <font color="#a52a2a"><b>&gt;</b></font> &lt;br&gt; <br> <font color="#a52a2a">34</font> <font color="#008b8b">end</font> ;&lt;br&gt; <br> <font color="#a52a2a">35</font> <font color="#6a5acd">?&gt;</font> &lt;br&gt; <br></code> <br><br>  In this scheme, the resource is described by three parameters: <br><ul><li>  name - the name of the resource, an auxiliary parameter, you can still ignore; </li><li>  classname - the name of the class that implements the resource; </li><li>  path - URL pattern corresponding to the resource. </li></ul><br>  The URL pattern is a regular expression (where do without them!) With named parameters. <br><br><h4>  HTTP methods </h4><br>  HTTP methods perform processing of requests of various types and generate a response.  Method Description Parameters: <br><ul><li>  name - the name of the method; </li><li>  http_mask - the mask that defines the combination of http-methods that the resource method processes; </li><li>  path - URL pattern corresponding to the method; </li><li>  formats - a list of formats of representations that forms the method. </li></ul><br>  A resource class constructor and resource methods can have an arbitrary set of arguments.  If the URL pattern contains parameters whose names match the arguments of the methods, the parameter values ‚Äã‚Äãare automatically substituted when the constructor or methods of the resource are called.  In addition, there are several predefined standard parameters, such as <code>$env</code> , <code>$request</code> and <code>$format</code> .  If the argument name is not included in the parameter set of the template and is not a predefined parameter, <code>null</code> substituted. <br><br>  For each method, you can specify a list of presentation formats.  The definition of the requested format is made by the HTTP request headers or by the extension of the requested document.  For each format, you can provide a separate method, or perform processing in one method, using the <code>$format</code> parameter.  Formats can be specified both for individual methods and for whole resources. <br><br><h4>  Sublokatory </h4><br>  Creating an instance of a class corresponding to a nested resource can be dynamically performed during processing.  For this, so-called sub-resource locators are used.  The method is a sublokator if it is present in the resource description, but no method is specified in the HTTP mask.  The sublokator does not process the request; instead, it creates an instance of the nested resource class.  Thus, the decision to create a resource can be made at the time of processing the request, depending on certain external conditions. <br><br><h4>  Resource classes </h4><br>  For the example above, the skeleton of several classes of resources might look like this: <br><br> <code><font color="#a52a2a">1</font> <font color="#6a5acd">&lt;?php</font> &lt;br&gt; <br> <font color="#a52a2a">2</font> <font color="#0000ff">//    -    </font> &lt;br&gt; <br> <font color="#a52a2a">3</font> <font color="#2e8b57"><b>class</b></font> App_WS_Resource <font color="#6a5acd">{</font> &lt;br&gt; <br> <font color="#a52a2a">4</font> <font color="#2e8b57"><b>protected</b></font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">env</font> ;&lt;br&gt; <br> <font color="#a52a2a">5</font> <font color="#2e8b57"><b>protected</b></font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">db</font> ;&lt;br&gt; <br> <font color="#a52a2a">6</font> &lt;br&gt; <br> <font color="#a52a2a">7</font> <font color="#2e8b57"><b>public</b></font> <font color="#a020f0">function</font> <font color="#a52a2a"><b>__construct</b></font> <font color="#6a5acd">(</font> WS_Environment <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">env</font> <font color="#6a5acd">)</font> <font color="#6a5acd">{</font> &lt;br&gt; <br> <font color="#a52a2a">8</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">this</font> <font color="#2e8b57"><b>-&gt;</b></font> env <font color="#a52a2a"><b>=</b></font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">env</font> ;&lt;br&gt; <br> <font color="#a52a2a">9</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">this</font> <font color="#2e8b57"><b>-&gt;</b></font> db <font color="#a52a2a"><b>=</b></font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">env</font> <font color="#2e8b57"><b>-&gt;</b></font> db;&lt;br&gt; <br> <font color="#a52a2a">10</font> <font color="#6a5acd">}</font> &lt;br&gt; <br> <font color="#a52a2a">11</font> <font color="#6a5acd">}</font> &lt;br&gt; <br> <font color="#a52a2a">12</font> &lt;br&gt; <br> <font color="#a52a2a">13</font> <font color="#0000ff">//  blog</font> &lt;br&gt; <br> <font color="#a52a2a">14</font> <font color="#2e8b57"><b>class</b></font> App_WS_Blog <font color="#2e8b57"><b>extends</b></font> App_WS_Resource <font color="#6a5acd">{</font> &lt;br&gt; <br> <font color="#a52a2a">15</font> &lt;br&gt; <br> <font color="#a52a2a">16</font> <font color="#2e8b57"><b>public</b></font> <font color="#a020f0">function</font> index <font color="#6a5acd">(</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">page_no</font> <font color="#a52a2a"><b>=</b></font> <font color="#ff00ff">1</font> <font color="#6a5acd">)</font> <font color="#6a5acd">{</font> <font color="#0000ff">/* $page_no    URL  */</font> <font color="#6a5acd">}</font> &lt;br&gt; <br> <font color="#a52a2a">17</font> &lt;br&gt; <br> <font color="#a52a2a">18</font> <font color="#2e8b57"><b>public</b></font> <font color="#a020f0">function</font> index_rss <font color="#6a5acd">()</font> <font color="#6a5acd">{</font> <font color="#0000ff">/* RSS- */</font> <font color="#6a5acd">}</font> &lt;br&gt; <br> <font color="#a52a2a">19</font> &lt;br&gt; <br> <font color="#a52a2a">20</font> <font color="#2e8b57"><b>public</b></font> <font color="#a020f0">function</font> entry <font color="#6a5acd">(</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">id</font> <font color="#6a5acd">)</font> <font color="#6a5acd">{</font> &lt;br&gt; <br> <font color="#a52a2a">21</font> <font color="#0000ff">//  -         </font> &lt;br&gt; <br> <font color="#a52a2a">22</font> <font color="#0000ff">//  </font> &lt;br&gt; <br> <font color="#a52a2a">23</font> <font color="#a52a2a"><b>if</b></font> <font color="#6a5acd">(</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">entry</font> <font color="#a52a2a"><b>=</b></font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">this</font> <font color="#2e8b57"><b>-&gt;</b></font> db <font color="#2e8b57"><b>-&gt;</b></font> blog <font color="#2e8b57"><b>-&gt;</b></font> entries <font color="#6a5acd">[</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">id</font> <font color="#6a5acd">])</font> &lt;br&gt; <br> <font color="#a52a2a">24</font> <font color="#a52a2a"><b>return</b></font> <font color="#a020f0">new</font> App_WS_Entry <font color="#6a5acd">(</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">this</font> <font color="#2e8b57"><b>-&gt;</b></font> env, <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">entry</font> <font color="#6a5acd">)</font> ; &lt;br&gt; <br> <font color="#a52a2a">25</font> <font color="#6a5acd">}</font> &lt;br&gt; <br> <font color="#a52a2a">26</font> &lt;br&gt; <br> <font color="#a52a2a">27</font> <font color="#2e8b57"><b>public</b></font> <font color="#a020f0">function</font> create <font color="#6a5acd">()</font> <font color="#6a5acd">{</font> <font color="#0000ff">/*    */</font> <font color="#6a5acd">}</font> &lt;br&gt; <br> <font color="#a52a2a">28</font> <font color="#6a5acd">}</font> &lt;br&gt; <br> <font color="#a52a2a">29</font> &lt;br&gt; <br> <font color="#a52a2a">30</font> <font color="#0000ff">//  entry</font> &lt;br&gt; <br> <font color="#a52a2a">31</font> <font color="#2e8b57"><b>class</b></font> App_WS_Entry <font color="#2e8b57"><b>extends</b></font> App_WS_Resource <font color="#6a5acd">{</font> &lt;br&gt; <br> <font color="#a52a2a">32</font> <font color="#2e8b57"><b>protected</b></font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">entry</font> ;&lt;br&gt; <br> <font color="#a52a2a">33</font> &lt;br&gt; <br> <font color="#a52a2a">34</font> <font color="#2e8b57"><b>public</b></font> <font color="#a020f0">function</font> <font color="#a52a2a"><b>__construct</b></font> <font color="#6a5acd">(</font> WS_Environment <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">env</font> , App_DB_Entry <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">entry</font> <font color="#6a5acd">)</font> <font color="#6a5acd">{</font> &lt;br&gt; <br> <font color="#a52a2a">35</font> <font color="#2e8b57"><b>parent</b></font> <font color="#a52a2a"><b>::</b></font> <font color="#a52a2a"><b>__construct</b></font> <font color="#6a5acd">(</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">env</font> <font color="#6a5acd">)</font> ;&lt;br&gt; <br> <font color="#a52a2a">36</font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">this</font> <font color="#2e8b57"><b>-&gt;</b></font> entry <font color="#a52a2a"><b>=</b></font> <font color="#a52a2a"><b>$</b></font> <font color="#008b8b">entry</font> ;&lt;br&gt; <br> <font color="#a52a2a">37</font> <font color="#6a5acd">}</font> &lt;br&gt; <br> <font color="#a52a2a">38</font> &lt;br&gt; <br> <font color="#a52a2a">39</font> <font color="#2e8b57"><b>public</b></font> <font color="#a020f0">function</font> index <font color="#6a5acd">()</font> <font color="#6a5acd">{</font> <font color="#0000ff">/*   */</font> <font color="#6a5acd">}</font> &lt;br&gt; <br> <font color="#a52a2a">40</font> <font color="#2e8b57"><b>public</b></font> <font color="#a020f0">function</font> print_version <font color="#6a5acd">()</font> <font color="#6a5acd">{</font> <font color="#0000ff">/*    */</font> <font color="#6a5acd">}</font> &lt;br&gt; <br> <font color="#a52a2a">41</font> <font color="#2e8b57"><b>public</b></font> <font color="#a020f0">function</font> update <font color="#6a5acd">()</font> <font color="#6a5acd">{</font> <font color="#0000ff">/*   */</font> <font color="#6a5acd">}</font> &lt;br&gt; <br> <font color="#a52a2a">42</font> <font color="#2e8b57"><b>public</b></font> <font color="#a020f0">function</font> <font color="#008b8b">delete</font> <font color="#6a5acd">()</font> <font color="#6a5acd">{</font> <font color="#0000ff">/*   */</font> <font color="#6a5acd">}</font> &lt;br&gt; <br> <font color="#a52a2a">43</font> <font color="#6a5acd">}</font> &lt;br&gt; <br></code> <br><br><h4>  Dispatch algorithm </h4><br>  The dispatch algorithm, which is a simplified version of the algorithm described in <a href="https://jsr311.dev.java.net/">the JAX-RS standard</a> , looks like this: <br><ol><li>  Determine the required presentation format (by request headers or document extension); </li><li>  View resource descriptions and match the path of each with the beginning of the URL; </li><li>  If you have not found a resource for which the URL matches the pattern and the format is included in the list of supported - 404; </li><li>  Resource found, looking for a method.  We remove from the URL the same part of the resource path; </li><li>  We look through all the descriptions of the resource methods by matching the URL pattern of the method with the beginning of the rest of the URL; </li><li>  If there is neither a method nor a sublocator matching the URL pattern and presentation format - 404; </li><li>  If a method is found with the appropriate URL pattern, format, and HTTP mask, we create an object of the resource class and call the method, performing parameter substitution.  The result of the execution is the object representing the response, the work is completed; </li><li>  If a sublocator with the corresponding URL pattern is found, we create an object of the resource class and call the method, performing parameter substitution. </li><li>  The result of sublocator execution is a new resource.  We search the resource list for the description of the resource of the corresponding class. </li><li>  If the class of the resource in the description is missing - 404; </li><li>  Delete the matched line from the beginning of the URL and return to step 4, and so on until the http method is found. </li></ol><br>  To simplify the algorithm, we assume that the addresses / resource / and /resource/index.html (for the html format) are equivalent, and we also limit the maximum number of iterations of the algorithm. <br><br>  To improve performance, you can, firstly, cache resource descriptions, and secondly, break large applications into separate smaller ones by linking them to URL subdirectories or subdomains of the main application domain. <br><br><h4>  Result </h4><br>  What do we gain by implementing the proposed scheme? <br><ul><li>  We can fully utilize all the advantages of the REST model, regardless of the type of application (traditional web application, web service, AJAX application); </li><li>  the application code is separated from the implementation mechanism as much as possible; this greatly simplifies testing and gives the developer more freedom in designing an application model object; </li><li>  dispatching rules and, as a result, resource classes have a fairly homogeneous structure, which facilitates design and further support.  If you wish (we are all going, we are not going to get it together), we can develop a graphical notation to describe the structure of the application and visualize it, say, using <a href="http://www.graphviz.org/">graphviz</a> . </li><li>  working with nested resources of arbitrary depth of nesting is trivial. </li></ul><br>  In general, we are very pleased with the proposed scheme, in our opinion, it practically does not impose restrictions on the developer and is very simple to implement.  An interesting and unexpected result was a very simple integration with our primitive ORM layer.  Having implemented only two very simple resource classes, we received a transparent mapping of HTTP requests in the ORM layer instruction, for example <br><br> <code><b>GET</b> /api/news/stories/most_popular <br> $db-&gt;news-&gt;stories-&gt;most_popular-&gt;select() <br> <br> <b>POST</b> /api/news/stories/ <br> $db-&gt;news-&gt;stories-&gt;insert($story) <br> <br> <b>PUT</b> /api/news/stories/15 <br> $db-&gt;news-&gt;stories-&gt;update($db-&gt;news-&gt;stories[15]); <br></code> <br>  and so on. <br><br>  Well, to the heap, our <a href="http://edu.techart.ru/corporate/professional-seminar/rest-architecture/">materials of the internal seminar on REST</a> , suddenly anyone is interested. </div><p>Source: <a href="https://habr.com/ru/post/83442/">https://habr.com/ru/post/83442/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../83432/index.html">What is fire?</a></li>
<li><a href="../83433/index.html">Learn to give!</a></li>
<li><a href="../83434/index.html">Creating circular panoramas (flash)</a></li>
<li><a href="../83435/index.html">Wacom Bamboo Fun M Pen & Touch Tablet Review</a></li>
<li><a href="../83438/index.html">"Female" USB stick GOODDRIVE Edge</a></li>
<li><a href="../83447/index.html">Evernote for Windows updated to version 3.5.1</a></li>
<li><a href="../83448/index.html">How to set up Maemo 5 (4) SDK and start writing applications under Windows / Linux / MacOS in less than half an hour!</a></li>
<li><a href="../83450/index.html">LG GW620 Android from LG</a></li>
<li><a href="../83454/index.html">Reader Market Grows: PVI Version</a></li>
<li><a href="../83455/index.html">AddVenture and RIS Ventures will give prizes to social media projects.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>