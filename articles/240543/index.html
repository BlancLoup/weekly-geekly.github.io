<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RESTful API for Android: pattern B</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="More recently, at an interview in Yandex, I happened to discuss the organization of Rest-interaction in Android applications. During the discussion, t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RESTful API for Android: pattern B</h1><div class="post__text post__text-html js-mediator-article">  More recently, at an interview in Yandex, I happened to discuss the organization of Rest-interaction in Android applications.  During the discussion, the question came up - why of the three patterns proposed on Google IO 2010 Virgil Dobjanschi, the first one is used significantly more often than the other two.  The question interested me. <br><br>  Since the topic of discussion is rather narrowly specialized, I‚Äôll let the reader skip the words about how important the Rest-interaction architecture is important in Android applications and how often Android developers are faced with similar tasks. <br><a name="habracut"></a><br><h4>  Brief description of patterns and overview </h4>  ( <a href="https://docs.google.com/file/d/0B2dn_3573C3RdlVpU2JBWXdSb3c/edit">more info</a> ) <table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td>  <strong>Pattern A</strong> </td><td>  <strong>Pattern B</strong> </td><td>  <strong>Pattern C</strong> </td></tr><tr><td>  Service API used: Activity -&gt; Service -&gt; Content Provider.  In this version, Activity works with the Android Servcie API.  If necessary, send a REST request. Activity creates a Service, Service asynchronously sends requests to a REST server, and saves the results to Content Provider (sqlite).  The activity receives a data readiness notification and reads the results from the Content Provider (sqlite). </td><td>  Used ContentProvider API: Activity -&gt; Content Provider -&gt; Service.  In this case, the Activity works with the API Content Provider, which acts as a facade for the service.  This approach is based on the similarity of the Content Provider API and the REST API: GET REST is equivalent to a select query to the database, POST REST is equivalent to insert, PUT REST ~ update, DELETE REST ~ delete.  Activity results are also loaded from sqlite. </td><td>  The Content Provider API + SyncAdapter is used: Activity -&gt; Content Provider -&gt; Sync Adapter.  A variation of the ‚ÄúB‚Äù approach, which uses <a href="http://udinic.wordpress.com/2013/07/24/write-your-own-android-sync-adapter/">its own Sync Adapter</a> instead of the service.  Activity gives the command Content Provider, which redirects it to the Sync Adapter.  The Sync Adapter is called from the Sync Manager, but not immediately, but at a ‚Äúconvenient‚Äù moment for the system.  Those.  delays in the execution of commands are possible. </td></tr><tr><td><img src="https://habrastorage.org/files/fab/18d/8fe/fab18d8fec7a43a39c5b5285720e6771.png" width="300"></td><td><img src="https://habrastorage.org/files/f6b/75f/7fb/f6b75f7fbb5f41aa8594a8a5349faca5.png" width="300"></td><td><img src="https://habrastorage.org/files/67e/8f2/e05/67e8f2e050e44aecb44a9f3bfb715340.png" width="300"></td></tr></tbody></table>  A quick review confirmed that Pattern A is really much more widely used.  Dv in his wonderful article <a href="http://derevyanko.blogspot.ru/2014/01/rest-android-1.html">‚ÄúREST for Android.</a>  <a href="http://derevyanko.blogspot.ru/2014/01/rest-android-1.html">Part 1: Virgil Dobjanschi patterns ‚Äù</a> mentions a number of libraries and examples of Pattern A implementation ( <a href="http://habrahabr.ru/post/176729/">there is one</a> in Habr√©), and just one example of Pattern B is described in the book <a href="http://it-ebooks.info/book/1988/">Programming Android, 2nd Edition</a> by Zigurd Mednieks, Laird Dornin, G. Blake Meike and Masumi Nakamura [1], in Chapter 13, ‚ÄúA Content Provider for a RESTful Web Service‚Äù, is available <a href="https://github.com/bmeike/ProgrammingAndroidExamples/tree/master/FinchVideo">on github.com</a> .  I could not find others. <br>  Reading the <a href="https://docs.google.com/file/d/0B2dn_3573C3RdlVpU2JBWXdSb3c/edit">original report of</a> Virgil Dobjanschi only added intrigue. <blockquote>  Content a little bit.  ... Again, we're not forcing you to adopt these particular design patterns. </blockquote>  In general, do not want - do not use.  It is encouraging. <br>  I propose to briefly review the existing implementation of Pattern B and try to understand what its features are. <br><br><h4>  FinchVideo application </h4><br><img src="https://habrastorage.org/files/ff5/61c/ee7/ff561cee78fc4a289e8019e7cbe0f503.png" align="right" width="200">  Immediately, I note that this code was written by a respected G. Blake Meike in 2012, and has not been significantly modified since then, so we will treat with understanding the use of any deprecated managedQuery constructions, disuse of such wonderful things as Loader, synchronized (HashMap) instead of ConcurrentHashMap and other things - they have no effect on the architecture of the application. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So let's start with the user interface.  In <a href="">FinchVideoActivity,</a> everything is completely transparent - a Cursor is attached to the ListView via SimpleCursorAdapter, into which the results of the managedQuery queries to FinchVideoContentProvider merge. <br>  Further - more interesting. <br><br><div class="spoiler">  <b class="spoiler_title">FinchVideoContentProvider</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FinchVideoContentProvider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RESTfulContentProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String VIDEO = <span class="hljs-string"><span class="hljs-string">"video"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String DATABASE_NAME = VIDEO + <span class="hljs-string"><span class="hljs-string">".db"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> DATABASE_VERSION = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String VIDEOS_TABLE_NAME = <span class="hljs-string"><span class="hljs-string">"video"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String FINCH_VIDEO_FILE_CACHE = <span class="hljs-string"><span class="hljs-string">"finch_video_file_cache"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> VIDEOS = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> VIDEO_ID = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> THUMB_VIDEO_ID = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> THUMB_ID = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> UriMatcher sUriMatcher; <span class="hljs-comment"><span class="hljs-comment">// Statically construct a uri matcher that can detect URIs referencing // more than 1 video, a single video, or a single thumb nail image. static { sUriMatcher = new UriMatcher(UriMatcher.NO_MATCH); sUriMatcher.addURI(FinchVideo.AUTHORITY, FinchVideo.Videos.VIDEO, VIDEOS); // use of the hash character indicates matching of an id sUriMatcher.addURI(FinchVideo.AUTHORITY, FinchVideo.Videos.VIDEO + "/#", VIDEO_ID); sUriMatcher.addURI(FinchVideo.AUTHORITY, FinchVideo.Videos.THUMB + "/#", THUMB_VIDEO_ID); sUriMatcher.addURI(FinchVideo.AUTHORITY, FinchVideo.Videos.THUMB + "/*", THUMB_ID); } /** uri for querying video, expects appending keywords. */ private static final String QUERY_URI = "http://gdata.youtube.com/feeds/api/videos?" + "max-results=15&amp;format=1&amp;q="; private DatabaseHelper mOpenHelper; private SQLiteDatabase mDb; private static class DatabaseHelper extends SQLiteOpenHelper { private DatabaseHelper(Context context, String name, SQLiteDatabase.CursorFactory factory) { super(context, name, factory, DATABASE_VERSION); } @Override public void onCreate(SQLiteDatabase sqLiteDatabase) { createTable(sqLiteDatabase); } private void createTable(SQLiteDatabase sqLiteDatabase) { String createvideoTable = "CREATE TABLE " + VIDEOS_TABLE_NAME + " (" + BaseColumns._ID + " INTEGER PRIMARY KEY AUTOINCREMENT, " + FinchVideo.Videos.TITLE + " TEXT, " + FinchVideo.Videos.DESCRIPTION + " TEXT, " + FinchVideo.Videos.THUMB_URI_NAME + " TEXT," + FinchVideo.Videos.THUMB_WIDTH_NAME + " TEXT," + FinchVideo.Videos.THUMB_HEIGHT_NAME + " TEXT," + FinchVideo.Videos.TIMESTAMP + " TEXT, " + FinchVideo.Videos.QUERY_TEXT_NAME + " TEXT, " + FinchVideo.Videos.MEDIA_ID_NAME + " TEXT UNIQUE," + FinchVideo.Videos.THUMB_CONTENT_URI_NAME + " TEXT UNIQUE," + FinchVideo.Videos._DATA + " TEXT UNIQUE" + ");"; sqLiteDatabase.execSQL(createvideoTable); } @Override public void onUpgrade(SQLiteDatabase sqLiteDatabase, int oldv, int newv) { sqLiteDatabase.execSQL("DROP TABLE IF EXISTS " + VIDEOS_TABLE_NAME + ";"); createTable(sqLiteDatabase); } } public FinchVideoContentProvider() { } public FinchVideoContentProvider(Context context) { } @Override public boolean onCreate() { FileHandlerFactory fileHandlerFactory = new FileHandlerFactory(new File(getContext().getFilesDir(), FINCH_VIDEO_FILE_CACHE)); setFileHandlerFactory(fileHandlerFactory); mOpenHelper = new DatabaseHelper(getContext(), DATABASE_NAME, null); mDb = mOpenHelper.getWritableDatabase(); return true; } @Override public SQLiteDatabase getDatabase() { return mDb; } /** * Content provider query method that converts its parameters into a YouTube * RESTful search query. * * @param uri a reference to the query for videos, the query string can * contain, "q='key_words'". The keywords are sent to the google YouTube * API where they are used to search the YouTube video database. * @param projection * @param where not used in this provider. * @param whereArgs not used in this provider. * @param sortOrder not used in this provider. * @return a cursor containing the results of a YouTube search query. */ @Override public Cursor query(Uri uri, String[] projection, String where, String[] whereArgs, String sortOrder) { Cursor queryCursor; int match = sUriMatcher.match(uri); switch (match) { case VIDEOS: // the query is passed out of band of other information passed // to this method -- its not an argument. String queryText = uri. getQueryParameter(FinchVideo.Videos.QUERY_PARAM_NAME); if (queryText == null) { // A null cursor is an acceptable argument to the method, // CursorAdapter.changeCursor(Cursor c), which interprets // the value by canceling all adapter state so that the // component for which the cursor is adapting data will // display no content. return null; } String select = FinchVideo.Videos.QUERY_TEXT_NAME + " = '" + queryText + "'"; // quickly return already matching data queryCursor = mDb.query(VIDEOS_TABLE_NAME, projection, select, whereArgs, null, null, sortOrder); // make the cursor observe the requested query queryCursor.setNotificationUri( getContext().getContentResolver(), uri); /** * Always try to update results with the latest data from the * network. * * Spawning an asynchronous load task thread, guarantees that * the load has no chance to block any content provider method, * and therefore no chance to block the UI thread. * * While the request loads, we return the cursor with existing * data to the client. * * If the existing cursor is empty, the UI will render no * content until it receives URI notification. * * Content updates that arrive when the asynchronous network * request completes will appear in the already returned cursor, * since that cursor query will match that of * newly arrived items. */ if (!"".equals(queryText)) { asyncQueryRequest(queryText, QUERY_URI + encode(queryText)); } break; case VIDEO_ID: case THUMB_VIDEO_ID: long videoID = ContentUris.parseId(uri); queryCursor = mDb.query(VIDEOS_TABLE_NAME, projection, BaseColumns._ID + " = " + videoID, whereArgs, null, null, null); queryCursor.setNotificationUri( getContext().getContentResolver(), uri); break; case THUMB_ID: String uriString = uri.toString(); int lastSlash = uriString.lastIndexOf("/"); String mediaID = uriString.substring(lastSlash + 1); queryCursor = mDb.query(VIDEOS_TABLE_NAME, projection, FinchVideo.Videos.MEDIA_ID_NAME + " = " + mediaID, whereArgs, null, null, null); queryCursor.setNotificationUri( getContext().getContentResolver(), uri); break; default: throw new IllegalArgumentException("unsupported uri: " + QUERY_URI); } return queryCursor; } /** * Provides a handler that can parse YouTube gData RSS content. * * @param requestTag unique tag identifying this request. * @return a YouTubeHandler object. */ @Override protected ResponseHandler newResponseHandler(String requestTag) { return new YouTubeHandler(this, requestTag); } /** * Provides read only access to files that have been downloaded and stored * in the provider cache. Specifically, in this provider, clients can * access the files of downloaded thumbnail images. */ @Override public ParcelFileDescriptor openFile(Uri uri, String mode) throws FileNotFoundException { // only support read only files if (!"r".equals(mode.toLowerCase())) { throw new FileNotFoundException("Unsupported mode, " + mode + ", for uri: " + uri); } return openFileHelper(uri, mode); } @Override public String getType(Uri uri) { switch (sUriMatcher.match(uri)) { case VIDEOS: return FinchVideo.Videos.CONTENT_TYPE; case VIDEO_ID: return FinchVideo.Videos.CONTENT_VIDEO_TYPE; case THUMB_ID: return FinchVideo.Videos.CONTENT_THUMB_TYPE; default: throw new IllegalArgumentException("Unknown video type: " + uri); } } @Override public Uri insert(Uri uri, ContentValues initialValues) { // Validate the requested uri if (sUriMatcher.match(uri) != VIDEOS) { throw new IllegalArgumentException("Unknown URI " + uri); } ContentValues values; if (initialValues != null) { values = new ContentValues(initialValues); } else { values = new ContentValues(); } SQLiteDatabase db = getDatabase(); return insert(uri, initialValues, db); } private void verifyValues(ContentValues values) { if (!values.containsKey(FinchVideo.Videos.TITLE)) { Resources r = Resources.getSystem(); values.put(FinchVideo.Videos.TITLE, r.getString(android.R.string.untitled)); } if (!values.containsKey(FinchVideo.Videos.DESCRIPTION)) { Resources r = Resources.getSystem(); values.put(FinchVideo.Videos.DESCRIPTION, r.getString(android.R.string.untitled)); } if (!values.containsKey(FinchVideo.Videos.THUMB_URI_NAME)) { throw new IllegalArgumentException("Thumb uri not specified: " + values); } if (!values.containsKey(FinchVideo.Videos.THUMB_WIDTH_NAME)) { throw new IllegalArgumentException("Thumb width not specified: " + values); } if (!values.containsKey(FinchVideo.Videos.THUMB_HEIGHT_NAME)) { throw new IllegalArgumentException("Thumb height not specified: " + values); } // Make sure that the fields are all set if (!values.containsKey(FinchVideo.Videos.TIMESTAMP)) { Long now = System.currentTimeMillis(); values.put(FinchVideo.Videos.TIMESTAMP, now); } if (!values.containsKey(FinchVideo.Videos.QUERY_TEXT_NAME)) { throw new IllegalArgumentException("Query Text not specified: " + values); } if (!values.containsKey(FinchVideo.Videos.MEDIA_ID_NAME)) { throw new IllegalArgumentException("Media ID not specified: " + values); } } /** * The delegate insert method, which also takes a database parameter. Note * that this method is a direct implementation of a content provider method. */ @Override public Uri insert(Uri uri, ContentValues values, SQLiteDatabase db) { verifyValues(values); // Validate the requested uri int m = sUriMatcher.match(uri); if (m != VIDEOS) { throw new IllegalArgumentException("Unknown URI " + uri); } // insert the values into a new database row String mediaID = (String) values.get(FinchVideo.Videos.MEDIA_ID_NAME); Long rowID = mediaExists(db, mediaID); if (rowID == null) { long time = System.currentTimeMillis(); values.put(FinchVideo.Videos.TIMESTAMP, time); long rowId = db.insert(VIDEOS_TABLE_NAME, FinchVideo.Videos.VIDEO, values); if (rowId &gt;= 0) { Uri insertUri = ContentUris.withAppendedId( FinchVideo.Videos.CONTENT_URI, rowId); getContext().getContentResolver().notifyChange(insertUri, null); return insertUri; } throw new IllegalStateException("could not insert " + "content values: " + values); } return ContentUris.withAppendedId(FinchVideo.Videos.CONTENT_URI, rowID); } private Long mediaExists(SQLiteDatabase db, String mediaID) { Cursor cursor = null; Long rowID = null; try { cursor = db.query(VIDEOS_TABLE_NAME, null, FinchVideo.Videos.MEDIA_ID_NAME + " = '" + mediaID + "'", null, null, null, null); if (cursor.moveToFirst()) { rowID = cursor.getLong(FinchVideo.ID_COLUMN); } } finally { if (cursor != null) { cursor.close(); } } return rowID; } @Override public int delete(Uri uri, String where, String[] whereArgs) { int match = sUriMatcher.match(uri); int affected; SQLiteDatabase db = mOpenHelper.getWritableDatabase(); switch (match) { case VIDEOS: affected = db.delete(VIDEOS_TABLE_NAME, (!TextUtils.isEmpty(where) ? " AND (" + where + ')' : ""), whereArgs); break; case VIDEO_ID: long videoId = ContentUris.parseId(uri); affected = db.delete(VIDEOS_TABLE_NAME, BaseColumns._ID + "=" + videoId + (!TextUtils.isEmpty(where) ? " AND (" + where + ')' : ""), whereArgs); getContext().getContentResolver().notifyChange(uri, null); break; default: throw new IllegalArgumentException("unknown video element: " + uri); } return affected; } @Override public int update(Uri uri, ContentValues values, String where, String[] whereArgs) { getContext().getContentResolver().notifyChange(uri, null); SQLiteDatabase db = mOpenHelper.getWritableDatabase(); int count; switch (sUriMatcher.match(uri)) { case VIDEOS: count = db.update(VIDEOS_TABLE_NAME, values, where, whereArgs); break; case VIDEO_ID: String videoId = uri.getPathSegments().get(1); count = db.update(VIDEOS_TABLE_NAME, values, BaseColumns._ID + "=" + videoId + (!TextUtils.isEmpty(where) ? " AND (" + where + ')' : ""), whereArgs); break; default: throw new IllegalArgumentException("Unknown URI " + uri); } getContext().getContentResolver().notifyChange(uri, null); return count; } }</span></span></code> </pre> </div></div>  <a href="">FinchVideoContentProvider,</a> in addition to implementing the base for ContentProvider (query, insert, etc.) operations, to SQLiteDatabase inherits from <a href="">RESTfulContentProvider the</a> mechanism for launching http requests in separate streams <br><div class="spoiler">  <b class="spoiler_title">asyncQueryRequest</b> <div class="spoiler_text">  public void asyncQueryRequest (String queryTag, String queryUri) { <br>  synchronized (mRequestsInProgress) { <br>  UriRequestTask requestTask = getRequestTask (queryTag); <br>  if (requestTask == null) { <br>  requestTask = newQueryTask (queryTag, queryUri); <br>  Thread t = new Thread (requestTask); <br>  // allows other requests to run in parallel. <br>  t.start (); <br>  } <br>  } <br>  } </div></div>  and HashMap &lt;String, UriRequestTask&gt; - mRequestsInProgress (respectively, a set of executed queries).  The results of the requests are processed in the <a href="">YouTubeHandler implements ResponseHandler</a> , which is passed to the <a href="">UriRequestTask</a> task when it is created. <br><br>  Let's compare existing classes with Pattern B. <br><img src="https://habrastorage.org/files/f6b/75f/7fb/f6b75f7fbb5f41aa8594a8a5349faca5.png" width="450" align="left">  With Activity and Content Provider everything is quite clear.  The Service object is not used explicitly in the example, its functions and partly the ServiceHelper functions on structuring and launching requests are performed by the FinchVideoContentProvider.  He also performs the functions of the Processor, about the Rest method is written above.  Such is the simplified implementation. <br><br><h4>  findings </h4><br>  Based on the analysis of the existing implementation of Pattern B and its descriptions, I made the following conclusions for myself <br><ol><li>  The biggest plus of Pattern B, as the author of the example describes in the section ‚ÄúSummary of Benefits‚Äù [1 - p. 369], is the increased query performance, since they are primarily implemented to the local database (Content Provider); </li><li>  The reverse side of this plus is the mismatch between the local and server database and the complicated logic of data acquisition. <br>  It is not surprising that the author of the example used only a query (GET) query - this is the easiest option.  Did not receive the new data - we will take old from a cache.  And if to implement insert (PUT)?  It will be necessary to first make changes to the local database, set the ‚Äúnot synchronized‚Äù flag to them (changes), then if the GET request is unsuccessful, retry this attempt, for example with an exponentially increasing pause (as suggested by the author of the pattern) ... All this time the user will see the added data that is not on the server.  Moreover, that they are not on the server, he will not be able to find out either (see clause 3); </li><li>  And the unpleasant side effect associated with the limited interaction of the Activity with REST (only through the Content Provider mechanisms) - in the GUI we cannot get anything but data. <br>  For example, we will never know the reasons for the lack of data.  Error in parsing?  The server did not return anything?  No network at all?  The result is one - no data.  In the <a href="http://habrahabr.ru/post/176729/">implementation of Pattern A</a> for this purpose we could send a RequestListener from the Activity to the ServiceHelper.  C Content Provider this number will not work. <br>  Of course, we can get data, for example through Broadcast Receiver, and bypassing the Content Provider, but this will no longer be related to Pattern B. </li></ol><br>  Thus, when using Pattern B, the above points must be considered. <br><br>  Maybe someone used this pattern in work projects or knows more successful examples of implementation?  Does it make any sense to implement it more qualitatively (there was such an idea), if in 4 years nobody bothered with this?  I will be glad to see the answers in the comments. </div><p>Source: <a href="https://habr.com/ru/post/240543/">https://habr.com/ru/post/240543/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../240533/index.html">SMS thermometer from a bunch of Google script, Google Doc, Wolfram-Alpha and Sms.ru</a></li>
<li><a href="../240535/index.html">Recording the first lecture of the Android Course from MasterUp</a></li>
<li><a href="../240537/index.html">Smart Listing Generator, EnumGenerator</a></li>
<li><a href="../240539/index.html">Duo.js is a new generation of frontend package manager.</a></li>
<li><a href="../240541/index.html">PcDuino3 Nano, a serious competitor to the Raspberry Pi B +, for $ 39</a></li>
<li><a href="../240545/index.html">rawdog - RSS aggregator without excessive requests</a></li>
<li><a href="../240549/index.html">Barcelona tried to seize the domain in the .email zone</a></li>
<li><a href="../240555/index.html">DigitalOcean launches metadata server</a></li>
<li><a href="../240557/index.html">Using the proxy pattern to organize caching in PHP</a></li>
<li><a href="../240559/index.html">Pricing model for SaaS: more money - more problems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>