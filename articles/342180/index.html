<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to WebAssembly</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is based on my speech at ITSubbotnik, held in Ryazan on October 14, 2017. There is still quite a bit of material on this topic in Russian...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to WebAssembly</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/wy/qa/yi/wyqayiyhpuzzcwiwkui7_ztdmku.jpeg"></p><br><p>  This article is based on my speech at ITSubbotnik, held in Ryazan on October 14, 2017.  There is still quite a bit of material on this topic in Russian, I hope that the article will be useful to you. </p><br><p>  Disclaimer: The author is not an expert in either WebAssembly or in JavaScript.  This article is a compilation of thoughts and ideas derived from the speeches of other people on this topic, plus the episodic experience of studying WebAssembly for several months. </p><a name="habracut"></a><br><h2 id="chto-takoe-webassembly">  What is WebAssembly? </h2><br><p>  <strong>WebAssembly</strong> ( <strong>WASM</strong> ) is a new binary format that allows you to run code in a browser. <br>  While such a definition will suffice, a more complete definition can be found on <a href="https://ru.wikipedia.org/wiki/WebAssembly">Wikipedia</a> . </p><br><h3 id="problema">  Problem </h3><br><p>  Let's see first what problem or problem they were trying to solve by creating a WebAssembly.  The problem is not new, in fact it is to <strong>quickly execute code in the browser</strong> .  But not everything is so simple, gradually it turned out that in addition to the problem itself, we still have several related requirements: </p><br><ul><li>  Faster than javascript - ideally, with speed <del>  Sveta </del>  native code of our processor. </li><li>  Zero configuration is an out-of-box solution, without installation, you just need a browser. </li><li>  Safe - new technology should not create new threats. </li><li>  Cross-platform - we have several platforms, including mobile, several operating systems. </li><li>  Convenient for developers - we need convenient development and debugging tools. </li></ul><br><h4 id="situaciya">  Situation </h4><br><p>  In an attempt to solve this problem, we have one winner, and this is javascript. </p><br><p>  Losers (not a complete list): </p><br><ul><li>  ActiveX - technology allowed to do everything at all, without any sandbox, respectively, represented a real security threat. </li><li>  Flash - in 2017, Adobe announced plans to stop supporting Flash. </li><li>  Silverlight <br>  and other plugins </li></ul><br><p>  Other solution attempts: </p><br><ul><li>  NaCl - Native Client - an initiative from Google, appeared in 2011;  I did not find support for other browsers except Chrome. </li><li>  PNaCl - Portable Native Client - LLVM IR subset. </li><li>  asm.js - Mozilla, appeared in 2013 - we will consider in more detail below. </li></ul><br><p>  In general, all attempts to solve can be divided into two groups: </p><br><h4 id="reshenie-1-rodnoy-kod-pryamo-v-brauzere">  Solution 1: Native code right in the browser </h4><br><p>  Examples: ActiveX, NaCl <br>  What is bad: no portability, potential or real security issues. </p><br><h4 id="reshenie-2-kod-dlya-virtualnoy-mashiny">  Solution 2: Virtual Machine Code </h4><br><p>  Examples: Java Applets, Silverlight, etc. <br>  What is bad: you need a plugin and / or runtime ‚áí no zero configuration <br>  In general, if you want to provide cross-platform execution of your code, then the virtual machine is the right approach. </p><br><h3 id="chto-ne-tak-s-javascript">  What's wrong with javascript? </h3><br><p>  JavaScript is good.  But if you look at the growth of its performance over the years, we will see that it is now on the second ‚Äúplateau‚Äù of the S-shaped curve.  At first, the performance was small and grew gradually, with the advent of the V8, we saw a sharp jump, which had long ago moved back to smooth growth. <br><img src="https://habrastorage.org/webt/ay/bm/ie/aybmietwx1tqocxpk_nnndcxkjs.png"><br>  (Picture from <a href="https://www.smashingmagazine.com/2017/05/abridged-cartoon-introduction-webassembly/">An Abridged Cartoon Introduction To WebAssembly by Lin Clark</a> .) </p><br><p>  Let's see how modern JavaScript engines work. </p><br><p>  First of all, the source code (text on JS) passes through the parser, as a result, an internal representation of the code arises - an abstract syntax tree.  The interpreter continues to work.  When executed, individual functions are converted to bytecode ‚Äî essentially, a sequence of calls to the internal functions of the interpreter.  This accumulates statistics on the use of JS-functions.  If a call threshold has been overcome for a particular function, then a decision is made that it needs to be optimized and passed to the compiler.  The compiler generates machine code that is strongly tied to the types of input values. </p><br><p><img src="https://habrastorage.org/webt/g-/tv/yx/g-tvyxlxy0e3kc0c_quq_r0d9uo.png"></p><br><p>  Suppose we have a function with two arguments: foo (a, b), and we call it many times with the numeric values ‚Äã‚Äãof the parameters.  At some point, the function will be passed to the compiler and will be executed faster.  Suppose we call it with a string argument.  As a result, the engine will perform ‚Äúde-optimization‚Äù: it will transfer the function from the compiler back to the interpreter, and the finished machine code will be thrown. </p><br><p>  What do I want to say with this?  The JavaScript engine developers do an excellent job and thank them for it.  JavaScript is not at all bad, but it has internal limitations that will no longer allow it to be made radically faster. </p><br><h3 id="asmjs">  asm.js </h3><br><p>  Another interesting initiative, already from the Mozilla Foundation, which brings us close to the topic WebAssembly.  It appeared in 2010, and in 2013 it became publicly available. </p><br><p>  The idea is to create a subset of JavaScript into which you can compile code from C and C ++ using the special Emscripten compiler. </p><br><p>  Since this is a subset of JavaScript, such code will be executed in any browser.  In addition, the main modern browsers have long been able to quickly recognize asm.js and effectively compile it into native processor code.  In comparison with the native code obtained directly from C / C ++, the code obtained from asm.js is the slowest by 1.5-2 times (50-67%). </p><br><p> For the simplest C / C ++ function, the asm.js code looks like this: <br><img src="https://habrastorage.org/webt/ev/pw/gr/evpwgrnw3jchpkg2udto9mcpmry.png"><br>  Here, <code>'use asm'</code> is a directive showing the JS engine that the code below is asm.js, and constructions of the form <code>|0</code> indicate that the work goes with integers (bitwise OR with a zero value zeroes the fractional part of Number). </p><br><h3 id="celi-razrabotki-webassembly">  Development Goals for WebAssembly </h3><br><ul><li>  Speed ‚Äã‚Äãis almost like native code. </li><li>  Efficiency - binary format, fast parsing and compilation. </li><li>  Portability - all browsers and operating systems. </li><li>  Security - launch in sandbox. </li><li>  Easy debugging - debugging support in browsers, the debugger is already there. </li><li>  An open standard - that is, this is no longer the initiative of a separate company trying to "pull the blanket over itself."  The standard has already been adopted in 2017. </li></ul><br><h3 id="tak-chto-zhe-takoe-webassembly">  So what is WebAssembly? </h3><br><ul><li>  Binary format </li><li>  NOT a programming language, but a byte code. <br>  We do not call Java bytecode a programming language. </li><li>  It is loaded into the browser and executed in the browser. <br>  Formally, WebAssembly is executed by a JavaScript engine, and not by the browser itself, so there are other versions of execution, for example, under NodeJS. </li><li>  Executed by the virtual machine <br>  This is a simple stack machine with memory, simplicity makes it easy to implement it for any modern processor. </li><li>  It has nothing to do with the Web, except that it communicates with the outside world through JavaScript. <br>  Indeed, WebAssembly is just a virtual machine that has memory and executes instructions. </li></ul><br><h2 id="s-chego-nachat-hello-world">  Where to begin?  Hello world </h2><br><p>  Mastering WebAssembly I strongly advise starting with the <a href="https://wasdk.github.io/WasmFiddle/">WasmFiddle</a> online tool. <br>  (I myself started with Emscripten and realized my mistake only after a while.) </p><br><p>  WasmFiddle interface: </p><br><p><img src="https://habrastorage.org/webt/ow/7b/tr/ow7btr-kwzabaxoephlz_1pps9c.png"></p><br><p>  At the top left, the source code, at the bottom left, the result of the compilation by the Build button (now you can see the textual representation), at the top right, the code to run and at the bottom right, the result of the run by the Run button. </p><br><div class="spoiler">  <b class="spoiler_title">C / C ++ sample text</b> <div class="spoiler_text"><p>  As an example, I used a simple code to calculate the Fibonacci number (yes, again, it is :), not to say that a good code, just the first available variant: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((n == <span class="hljs-number"><span class="hljs-number">-1</span></span>) || (n == <span class="hljs-number"><span class="hljs-number">1</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fib(n + <span class="hljs-number"><span class="hljs-number">2</span></span>) - fib(n + <span class="hljs-number"><span class="hljs-number">1</span></span>); } } } }</code> </pre> </div></div><br><p>  A little about the textual representation (WAST).  As already mentioned, WebAssembly is a binary format, at the output of the compilation we get a WASM file.  Textual representation can always be obtained from the WASM file, it allows you to figure out what exactly the assembly contains, which tables and code.  This view is also used for debugging. </p><br><p>  In this case, from the textual representation, we see that 1 memory page is allocated (each page = 64 Kbytes), the memory and the function fib are visible (exported), and then the definition of this function, that is, its implementation itself goes. </p><br><div class="spoiler">  <b class="spoiler_title">Text View (WAST)</b> <div class="spoiler_text"><p>  The beginning of the textual representation of this assembly looks like this: </p><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">module</span></span> (<span class="hljs-name"><span class="hljs-name">table</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> anyfunc) (<span class="hljs-name"><span class="hljs-name">memory</span></span> $<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">data</span></span> (<span class="hljs-name"><span class="hljs-name">i32</span></span>.const <span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-string"><span class="hljs-string">"\01\00\00\00\00\00\00\00\01\00\00\00"</span></span>) (<span class="hljs-name"><span class="hljs-name">export</span></span> <span class="hljs-string"><span class="hljs-string">"memory"</span></span> (<span class="hljs-name"><span class="hljs-name">memory</span></span> $<span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">export</span></span> <span class="hljs-string"><span class="hljs-string">"fib"</span></span> (<span class="hljs-name"><span class="hljs-name">func</span></span> $fib)) (<span class="hljs-name"><span class="hljs-name">func</span></span> $fib (<span class="hljs-name"><span class="hljs-name">param</span></span> $<span class="hljs-number"><span class="hljs-number">0</span></span> i32) (<span class="hljs-name"><span class="hljs-name">result</span></span> i32) (<span class="hljs-name"><span class="hljs-name">local</span></span> $<span class="hljs-number"><span class="hljs-number">1</span></span> i32) (<span class="hljs-name"><span class="hljs-name">block</span></span> $label$<span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-name"><span class="hljs-name">br_if</span></span> $label$<span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-name"><span class="hljs-name">i32</span></span>.ge_u (<span class="hljs-name"><span class="hljs-name">tee_local</span></span> $<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">i32</span></span>.add (<span class="hljs-name"><span class="hljs-name">get_local</span></span> $<span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">i32</span></span>.const <span class="hljs-number"><span class="hljs-number">1</span></span>) ) ) (<span class="hljs-name"><span class="hljs-name">i32</span></span>.const <span class="hljs-number"><span class="hljs-number">3</span></span>) ) ) (<span class="hljs-name"><span class="hljs-name">return</span></span> (<span class="hljs-name"><span class="hljs-name">i32</span></span>.load (<span class="hljs-name"><span class="hljs-name">i32</span></span>.add (<span class="hljs-name"><span class="hljs-name">i32</span></span>.shl (<span class="hljs-name"><span class="hljs-name">get_local</span></span> $<span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">i32</span></span>.const <span class="hljs-number"><span class="hljs-number">2</span></span>) ) (<span class="hljs-name"><span class="hljs-name">i32</span></span>.const <span class="hljs-number"><span class="hljs-number">12</span></span>) ) ) ...</code> </pre> </div></div><br><p>  If you put it all together, then the minimum JavaScript code to run the example looks like this: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wasmCode = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Uint8Array</span></span>( [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">97</span></span>,<span class="hljs-number"><span class="hljs-number">115</span></span>,<span class="hljs-number"><span class="hljs-number">109</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">134</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">96</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">127</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">127</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">130</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">132</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">112</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">131</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">129</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">144</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">109</span></span>,<span class="hljs-number"><span class="hljs-number">101</span></span>,<span class="hljs-number"><span class="hljs-number">109</span></span>,<span class="hljs-number"><span class="hljs-number">111</span></span>,<span class="hljs-number"><span class="hljs-number">114</span></span>,<span class="hljs-number"><span class="hljs-number">121</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">102</span></span>,<span class="hljs-number"><span class="hljs-number">105</span></span>,<span class="hljs-number"><span class="hljs-number">98</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">203</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">197</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">127</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">65</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">106</span></span>,<span class="hljs-number"><span class="hljs-number">34</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">65</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">79</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">65</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">116</span></span>,<span class="hljs-number"><span class="hljs-number">65</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">106</span></span>,<span class="hljs-number"><span class="hljs-number">40</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">65</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">72</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">65</span></span>,<span class="hljs-number"><span class="hljs-number">127</span></span>,<span class="hljs-number"><span class="hljs-number">106</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">65</span></span>,<span class="hljs-number"><span class="hljs-number">126</span></span>,<span class="hljs-number"><span class="hljs-number">106</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">106</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">65</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">106</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">107</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">146</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">65</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wasmModule = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Module(wasmCode); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wasmInstance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Instance(wasmModule, []); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(wasmInstance.exports.fib(<span class="hljs-number"><span class="hljs-number">10</span></span>));</code> </pre> <br><p>  Here, the finished WASM is described in the code as an array of numbers, but in real life, of course, the WASM file will be quite a lot more, and we will load it from the server. </p><br><p>  Execution of WebAssembly in the browser looks like this.  The browser, as usual, loads an HTML page with which JavaScript is executed, which already loads WebAssembly ‚Äî you get a ‚Äúmodule‚Äù (WebAssembly module), then create an instance of the module, after which you can call the functions it exports for this instance. </p><br><p><img src="https://habrastorage.org/webt/du/e7/z_/due7z_shugro9z4fr0a-viomoq0.png"></p><br><p>  Notice the gray arrow here: JavaScript functions can be called from within a WebAssembly.  Let's take a closer look at the sequence diagram: </p><br><p><img src="https://habrastorage.org/webt/lp/xu/gb/lpxugbydqbh7i03cltbbhxvb_ec.png"></p><br><p>  Here we first call WebAssembly from JavaScript, then call the JavaScript function from WebAssembly. </p><br><p>  In the second call here, I showed how WebAssembly uses any API (for example, DOM / WebGL, etc.).  This is possible, but not directly, such calls also occur only through JavaScript.  Obviously, a ‚Äúbottleneck‚Äù arises here: if we work intensively with the API from WASM, then we will lose a lot of time on ‚Äúpinging‚Äù these calls through JavaScript. </p><br><p>  The WebAssembly memory model is very simple.  This is a flat ‚Äúpiece‚Äù of memory in which the program code, global variables, the stack and the heap are located.  It is possible to make the memory expandable, then if, if at the next memory allocation we do not have enough space, then the upper memory limit automatically increases. </p><br><p><img src="https://habrastorage.org/webt/8m/ek/0l/8mek0lpn5fwccixe72pspomcxag.png"><br>  The entire memory block is accessible from JavaScript, simply as an array of bytes (and also as an array of 16-bit and 32-bit words, as an array of 16-bit and 32-bit float values).  Moreover, the memory from JavaScript is available for both reading and writing. </p><br><h2 id="emscripten">  Emscripten </h2><br><p>  Emscripten is the main compiler for getting asm.js and WebAssembly from C / C ++.  (There are also compilers in WASM from other languages, for example from Rust and TypeScript.) Here I will consider using Emscripten under Windows, but I do not think that there will be significant differences for other systems. </p><br><p><img src="https://habrastorage.org/webt/ig/lp/re/iglprejjrgyuacz4rp87sh6k4gy.png"></p><br><h3 id="llvm">  Llvm </h3><br><p>  Speaking of Emscripten, it‚Äôs worth a little to talk about the Low Level Virtual Machine (LLVM). </p><br><p><img src="https://habrastorage.org/webt/zw/wn/dy/zwwndyeq27p46jl3wl47lnmdaqm.png"></p><br><p>  LLVM is a family of compilers.  The main idea of ‚Äã‚ÄãLLVM is to separate the compilation into frontend and backend.  The frontend compiler is engaged in compiling from source code to internal representation (Intermediate Representation, IR).  IR is the code for some virtual machine.  The backend compiler is already engaged in converting IR into code for a specific platform, for example, backend is often used for x86 and x86-64.  If you need a compiler from another programming language, then only a new frontend is written.  If you need to compile a new platform, then write a new backend. </p><br><p>  Emscripten uses LLVM to compile from C / C ++, and provides its backend compilers for building in asm.js and WebAssembly. </p><br><h3 id="ustanovka-emscripten">  Install emscripten </h3><br><p>  Installing Emscripten is pretty simple, in my case it was under Windows, and I didn't even need to compile anything from the sources. </p><br><ol><li>  Download from here: <a href="http://emscripten.org/">http://emscripten.org/</a> </li><li>  We unpack in a separate folder, in my case <code>C:\bin\emsdk</code> </li><li>  Open the command prompt, go to the emsdk folder and execute three commands: </li></ol><br><pre> <code class="hljs sql">emsdk <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> emsdk <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> latest emsdk <span class="hljs-keyword"><span class="hljs-keyword">activate</span></span> latest</code> </pre> <br><p>  Everything is installed and configured, we can compile.  <code>emsdk list</code> command, you will receive a list of all versions of all tools available for installation, with notes of what is selected now. </p><br><h3 id="kompilyaciya-v-asmjs">  Compiling in asm.js </h3><br><p>  Let's see how to compile code using Emscripten, let's start with asm.js. </p><br><div class="spoiler">  <b class="spoiler_title">Emscripten Example</b> <div class="spoiler_text"><p>  The example is the same as above, slightly modified for Emscripten (fib.c): </p><br><pre> <code class="hljs kotlin"># include &lt;emscripten/emscripten.h&gt; int EMSCRIPTEN_KEEPALIVE fib(int n) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((n == -<span class="hljs-number"><span class="hljs-number">1</span></span>) || (n == <span class="hljs-number"><span class="hljs-number">1</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fib(n + <span class="hljs-number"><span class="hljs-number">2</span></span>) - fib(n + <span class="hljs-number"><span class="hljs-number">1</span></span>); } } } } int main() { printf(<span class="hljs-string"><span class="hljs-string">"fib(10) = %d\n"</span></span>, fib(<span class="hljs-number"><span class="hljs-number">10</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><p>  Here is added the <code>EMSCRIPTEN_KEEPALIVE</code> macro, which does two things.  First, it prevents the function from being thrown away by the compiler, even if it is not used anywhere in our code.  Secondly, it indicates that the function must be exported to be called from the outside. </p></div></div><br><p>  To compile, I use the following batch file: </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> EMSDKPATH=C:\<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>\emsdk <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> %EMSDKPATH%\emsdk_env.bat emcc -O1 fib.c -o fib.html -fno-<span class="hljs-keyword"><span class="hljs-keyword">exceptions</span></span> -fno-rtti</code> </pre> <br><p>  Here <code>emcc</code> is actually Emscripten, <code>-O1</code> optimization option, <code>fib.c</code> what to compile, <code>-o fib.html</code> where to compile, and further options <code>-f</code> to disable what we do not need. </p><br><div class="spoiler">  <b class="spoiler_title">What we get at the output</b> <div class="spoiler_text"><p>  At the output of the compilation, we get an HTML file (fib.html) that includes JavaScript to run the compiled code: <br><img src="https://habrastorage.org/webt/eq/1-/20/eq1-20dwlsgl9uhvblsx6ej_r5a.png"></p><br><p>  We also received the file fib.js, in the depths of which you can find the function fib () and its call in main (): <br><img src="https://habrastorage.org/webt/-z/q_/jq/-zq_jq1ohdvgthoexkmmtho-wpy.png"></p><br><p>  In addition, the binary file fib.html.mem is generated - this is the ‚Äúmemory image‚Äù, what the memory looks like before launching the program, here all the constants and global variables. </p><br><p>  Opening fib.html we will see the following picture: </p><br><p><img src="https://habrastorage.org/webt/qp/dk/ic/qpdkic3cxn0wzlfwzayyrxce3km.png"><br>  This is the standard result view for Emscripten.  The black rectangle in the center is the output of the ‚Äúconsole‚Äù (stdout), there in particular <code>printf()</code> is output.  The black box at the top is canvas;  Emscripten does not know whether you need it, but creates it here just in case. </p></div></div><br><h3 id="kompilyaciya-v-webassembly">  Compiling in WebAssembly </h3><br><p>  To compile in WebAssembly, we don‚Äôt need to change the source code to C / C ++ at all (and that‚Äôs great!). </p><br><p>  We change only the command line of the compiler call: </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> EMSDKPATH=C:\<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>\emsdk <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> %EMSDKPATH%\emsdk_env.bat emcc -O1 fib.c -g -o fib.html -s WASM=<span class="hljs-number"><span class="hljs-number">1</span></span> -s NO_EXIT_RUNTIME=<span class="hljs-number"><span class="hljs-number">1</span></span> -s NO_FILESYSTEM=<span class="hljs-number"><span class="hljs-number">1</span></span> -fno-<span class="hljs-keyword"><span class="hljs-keyword">exceptions</span></span> -fno-rtti <span class="hljs-comment"><span class="hljs-comment">--llvm-lto 1</span></span></code> </pre> <br><p>  The main difference here is the addition of the <code>-s WASM=1</code> option.  The remaining <code>-s</code> and <code>-f</code> added in an attempt to explain to Emscripten what we do NOT need.  Emscripten can do too much, and therefore ‚Äújust in case,‚Äù ‚Äúsuddenly needed,‚Äù he adds a lot of things to the resulting files. </p><br><p>  As a result of the compilation, we also get fib.html, plus fib.js (a set of Emscripten service functions), and finally fib.wasm: </p><br><p><img src="https://habrastorage.org/webt/hw/3e/2p/hw3e2pyx2nkgcfwytyrjffgqylo.png"></p><br><p>  At the beginning of the WASM file there is a byte 00 and then the characters "asm", using these first four bytes, you can determine that we are loading exactly wasm, and not any stub page with an error code.  The next 4 bytes is the version number, in this case 1.0.  A separate file for the memory image is not generated, constants and global variables are included in the same WASM file. </p><br><p>  I will not give here a screenshot with the result, it looks one-to-one just like for the asm.js example. </p><br><div class="spoiler">  <b class="spoiler_title">Debug WebAssembly in Chrome</b> <div class="spoiler_text"><p>  Let's see what we have in terms of debugging.  Having opened the Chrome developer tools (F12), we go to Sources and there we will see a new section ‚Äúwasm‚Äù, in which we can find our function among a set of blocks, we can put a breakpoint there, stop at it and step in the debugger. <br><img src="https://habrastorage.org/webt/d1/fi/w9/d1fiw9hju0ivqgxjhagdd4k1dzi.png"></p><br><p>  As you can see, the text view (WAST), which I mentioned above, is used for debugging. </p><br><p>  Now let's compile the same code with debugging information. To do this, add the option <code>-g</code> emcc command line.  As a result, the compiler will generate two more files for us: fib.wast and fib.html.map. <br>  In the fib.wast text view file, there is not only code, but also references to the source code in C / C ++: </p><br><pre> <code class="hljs lisp"> (<span class="hljs-name"><span class="hljs-name">func</span></span> $_fib (<span class="hljs-name"><span class="hljs-name">param</span></span> $<span class="hljs-number"><span class="hljs-number">0</span></span> i32) (<span class="hljs-name"><span class="hljs-name">result</span></span> i32) (<span class="hljs-name"><span class="hljs-name">local</span></span> $<span class="hljs-number"><span class="hljs-number">1</span></span> i32) <span class="hljs-comment"><span class="hljs-comment">;; fib.c:11 (block $switch-default</span></span></code> </pre> <br><p>  Let's see what it gives us in terms of debugging.  After refreshing the page, in the Sources section we will now see our source code for fib.c, we can put a breakpoint in it, stop at it, view local variables and step through the debugger through the code. <br><img src="https://habrastorage.org/webt/f5/en/r0/f5enr00lzbpv703zbuj7pzagtyi.png"></p></div></div><br><h3 id="vozmozhnosti-emscripten">  Emscripten features </h3><br><p>  Emscripten has been developing since 2010 and already has a lot of things.  In this case, it is no longer about the compiler, but about supporting popular libraries used from C / C ++ code.  Supported: </p><br><ul><li>  Standard C / C ++ Libraries </li><li>  SDL 2 - input (keyboard / mouse / joysticks), video, sound </li><li>  OpenGL, EGL - 2D / 3D graphics, implemented via WebGL </li><li>  OpenAL - sound </li></ul><br><p>  And other features: </p><br><ul><li>  File system emulation - many C / C ++ programs intensively work with files, you can leave this code as it is;  see <a href="https://kripken.github.io/emscripten-site/docs/porting/files/file_systems_overview.html">Emscripten - File System Overview</a> </li><li>  <code>EM_ASM("JS code")</code> - execute arbitrary javascript code generated as a string </li><li>  Workers </li></ul><br><h3 id="bolee-slozhnyy-primer">  More complicated example </h3><br><p>  I have my own hobby project of an emulator of an old Soviet computer written in C ++, I described it here <a href="https://geektimes.ru/post/80078/">in this article</a> .  Since then I have managed to finish it a little, and also to port it under Qt (Windows / MacOS / Linux).  So I have already been allocated the emulation core (~ 280 Kbytes of code, ~ 7 kilo-blocks), which was built under different compilers.  Actually, I started learning WebAssembly by compiling this emulator using Emscripten.  Before the first successful launch, it took me two nights after work, I consider it a good result, indicating that the threshold for entering the topic is relatively low.  Most of the work was related to JavaScript: how to call WASM methods from JS, how to pass parameters, how to draw a canvas and so on. </p><br><p>  By the way, the screen of the emulated machine is formed completely inside WASM, in the form of a solid block of memory, with a ‚Äúpixel‚Äù format suitable for canvas.  Outward in JavaScript is transmitted only the address of the finished "screen".  In JavaScript, it remains only to copy this block of memory to the canvas. </p><br><p>  A working emulator <a href="https://nzeemin.github.io/ukncbtl-wasm/index.html">can be seen here</a> , well, the <a href="https://github.com/nzeemin/ukncbtl-wasm">source code is also available</a> . </p><br><div class="spoiler">  <b class="spoiler_title">Screenshot of emulator compiled as WASM</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/hj/zc/sk/hjzcskiij1gt9lbwmd1ev6uhwom.png"></p></div></div><br><p>  Also at some point I decided ‚Äúto complete the picture‚Äù to build this emulator also under asm.js.  I made myself a coffee, set aside a couple of free hours, and in less than 15 minutes the emulator started working.  It was as if unexpected.  In fact, all that had to be done was to look at the differences in the generated HTML file and transfer the added JavaScript block to the right place.  The only difference was that asm.js should load the .mem file, the memory image with constants and global variables.  Otherwise, all the calls were performed in the same way, and the finished page looked and worked exactly the same, except a little slower. </p><br><p>  So, summing up on Emscripten.  I was convinced that from the same code it generates a result in the form of asm.js and in the form of WebAssembly, the result obtained looks and works exactly the same (except for speed, of course).  The threshold of entry to obtain a real result was relatively low. </p><br><p>  On the other hand, the Emscripten is a rather complicated and ‚Äústuffed‚Äù tool.  As a result of compilation, it includes a lot of things that you do not expect, but which may be useful to you.  Therefore, even for small sources, a large amount of the resulting code is generated.  Some of these things <a href="https://kripken.github.io/emscripten-site/docs/tools_reference/emcc.html">can be disabled with command line options</a> , some not. </p><br><p>  I think that you shouldn‚Äôt start mastering WebAssembly right away from Emscripten, for the reason that it‚Äôs quite difficult to separate for yourself what Emscripten gives from what has WASM out of the box.  But on real projects, Emscripten is more than useful, precisely because of the opportunities it provides to the developer. </p><br><h2 id="tekuschee-sostoyanie-webassembly">  The current state of WebAssembly </h2><br><p>  WebAssembly news in 2017: </p><br><ul><li>  March 2017 - WebAssembly Cross-browser consensus and end of browser preview </li><li>  May 2017 - The Chromium team abandoned PNaCl in favor of WebAssembly <a href="https://blog.chromium.org/2017/05/goodbye-pnacl-hello-webassembly.html">https://blog.chromium.org/2017/05/goodbye-pnacl-hello-webassembly.html</a> </li><li>  September - Safari 11 released with WebAssembly support <a href="https://webkit.org/blog/7956/new-webkit-features-in-safari-11/">https://webkit.org/blog/7956/new-webkit-features-in-safari-11/</a> </li></ul><br><h3 id="podderzhka-v-brauzerah">  Browser support </h3><br><p>  At the beginning of October 2017, the situation looked like this: </p><br><p><img src="https://habrastorage.org/webt/5k/ru/_q/5kru_qcvloktlo8wkf879xrgumo.png"></p><br><p>  The Edge version is bound to the operating system version.  Together with Windows 10 Fall Creators Update we get Edge 16, in which the WebAssembly works immediately, no longer need to include anything in the settings. </p><br><p>  For browsers that do not support WebAssembly, it is supposed to use the so-called.  "Polyfill", that is, the automatic conversion of WASM into code that can be executed in this browser.  In particular, a prototype was made that effectively performs the WebAssembly conversion to asm.js.  But so far I have not seen examples of the real application of this approach. </p><br><h3 id="buduschee-webassembly">  Future WebAssembly </h3><br><p>  A number of things that the WebAssembly team <a href="http://webassembly.org/docs/future-features/">is currently working on</a> : </p><br><ul><li>  Threads <br>  The current implementation of WASM is completely single-threaded. </li><li>  <a href="https://ru.wikipedia.org/wiki/SIMD">SIMD</a> <br>  SIMD support will significantly speed up single-type processing on large amounts of data - images, video, sound. </li><li>  Exceptions </li><li>  Garbage collection <br>  The GC implementation will allow compiling for WASM from languages ‚Äã‚Äãwith automatic memory management.  This is possible now, but only in the version when GC is implemented in C / C ++ inside WASM. </li></ul><br><h3 id="proizvoditelnost">  Performance </h3><br><p>  The performance question is actually quite complicated.  Because not always WebAssembly works faster than the same JavaScript or asm.js.  For example, look at comparisons from <a href="https://takahirox.github.io/WebAssembly-benchmark/">JavaScript vs WebAssembly easy benchmark</a> .  On the very first collisionDetection test, it turns out that WASM gives 88% of JS.  And let's say on the next test Fibonacci WASM gives a much better result, 3 times faster than JS. </p><br><p>  I will note here only a few moments that affect the speed, of course there are much more of them. </p><br><p>  It was already noted above that WebAssembly can lose significantly in performance when intensive calls are made to JS functions. </p><br><p>  WebAssembly loses its performance on memory accesses: each such treatment makes a check to go beyond the boundaries of the available memory block. </p><br><p>  WebAssembly can significantly benefit from the type of integer variables.  In JS, we only have the Number type, in fact, always 64-bit floating point, and integers are floating numbers without a fractional part.  When compiling in the JS engine, a 64-bit integer type is used for integers.  In WASM, we choose the bitness of the type ourselves, and if we use a 32-bit integer type, operations on which are slightly faster than on a 64-bit integer, then we get here a ‚Äúdishonest‚Äù advantage in computation speed. </p><br><p>  In general, I got the impression that there is no such thing as ‚Äúon average, WebAssembly provides a 10-15% increase in speed‚Äù, there is no ‚Äúon average‚Äù; for each algorithm, you need to determine whether you get a speed increase using WASM.  But in general, it can be predicted that for intensive calculations, most likely WebAssembly will give some more or less noticeable performance gain.  Well, besides, it is clear that even in the last six months, the speed of WASM has slightly increased with the release of new versions of browsers. </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><h3 id="primenenie-webassembly">  Using WebAssembly </h3><br><ul><li>  Reduce load time </li><li>  Raise computation speed </li><li>  Use ready C / C ++ code </li></ul><br><h3 id="varianty-ispolzovaniya">  Use cases </h3><br><ol><li>  Apply WASM now, if you are ready for it </li><li>  Use asm.js now, switch to WASM in the future </li><li>  Give asm.js or WASM, depending on the browser </li></ol><br><h3 id="ssylki">  Links </h3><br><p>  There is a lot of material on the topic, but it is practically all in English.  Here I have collected several links that I consider most useful. </p><br><ul><li>  <a href="http://webassembly.org/">WebAssembly.org</a> </li><li>  <a href="https://github.com/mbasso/awesome-wasm">Awesome list by webassembly</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3DPpuAqLCraAQ">Real World WebAssembly, Chrome Dev Summit 2017</a> - video, October 24, 2017 </li><li>  <a href="https://www.youtube.com/watch%3Fv%3DNhAPPQqKCi8">Web Assembly by Nick Bray, GOTO 2015</a> - video, October 21, 2015 </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/342180/">https://habr.com/ru/post/342180/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342168/index.html">Internet: everything is very bad</a></li>
<li><a href="../342170/index.html">Java 9 overview</a></li>
<li><a href="../342172/index.html">Creating concept art in 3D</a></li>
<li><a href="../342174/index.html">How to follow trends on github</a></li>
<li><a href="../342176/index.html">Brilliance and misery of Artificial Intelligence</a></li>
<li><a href="../342184/index.html">CatalogBox - the idea of ‚Äã‚ÄãComboBox development</a></li>
<li><a href="../342186/index.html">Scarless Face or First Steps in Multicad.NET API 7 (for Nanocad 8.1)</a></li>
<li><a href="../342188/index.html">Roles, their modeling in IC</a></li>
<li><a href="../342190/index.html">Convenient solution for the gaming database based on EditorWindow</a></li>
<li><a href="../342192/index.html">Sir Markdown. Yandex lecture</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>