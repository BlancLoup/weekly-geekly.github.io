<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Reverse engineering test crackme from Kaspersky Lab</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings to the community! A long time ago, in 2013, the post ‚ÄúReverse engineering at the interview: how we hire‚Äù was published on Habr√©. It offered ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Reverse engineering test crackme from Kaspersky Lab</h1><div class="post__text post__text-html js-mediator-article">  Greetings to the community!  A long time ago, in 2013, the post <a href="https://habrahabr.ru/company/kaspersky/blog/203228/">‚ÄúReverse engineering at the interview: how we hire‚Äù</a> was published on Habr√©.  It offered a test crackme for applicants for the position of virus analyst.  After making sure that there is no complete analysis of the test file on the Internet, I decided to write my own analysis.  So let's get started.  Crackme 64-bit.  Run it in IDA Pro. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6c8/4e4/0ad/6c84e40adbfff2f290a9a5a799536a43.jpg" alt="image"></div><br><a name="habracut"></a><br>  We see three functions on the left of the list of functions: start is the function with which program execution begins, DialogFunc ‚Äî this function communicates with us and some function sub_140001000.  Consider the dialogue function.  We decompile it with Hex Rays. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31b/391/8f1/31b3918f1ac1ef87cfddd05e12a4382c.jpg" alt="image"></div><br>  The branching of conditions is striking, according to which, if some function sub_140001000 returns TRUE, a message will appear informing us of a job well done, otherwise it is not true.  Let us analyze our cherished function sub_140001000.  If we pass it through a decompiler, we will see that a pointer of just one value is passed as an argument.  Probably, this value is taken from the dialog box and is an input key.  Now consider the assembler listing.  There is a first verification of the condition of accuracy of the entered data.  If the condition is satisfied, the program is executed further; if not, then the return is from the subroutine. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/de4/903/f2c/de4903f2c6d6a60840eec30ea7ddef45.jpg" alt="image"></div><br>  Run our crackme under the debugger.  Let's use <b>x64dbg</b> .  We set breakpoint at our first check.  As the input key, use the set of numbers 1234567. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a9e/c6a/55e/a9ec6a55e7379fbf2fcedc7bdf1ff07e.jpg" alt="image"></div><br>  As you can see, the edx register value and the number 13h are checked (in decimal system it is 19).  This is probably a check on the number of entered key characters (we have 7 and the number in the edx number is 7).  Let's try to enter a different number of characters.  Run the debugger again.  We introduce 9 numbers 123456789. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab5/351/bec/ab5351bec6a9e510b0a1b6ed24121688.jpg" alt="image"></div><br>  It seems that the way it is.  <b><u>So our key must contain 19 characters.</u></b>  Enter 19 characters 1234567890123456789 and proceed to the next stage of verification. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ffa/562/348/ffa562348acf6323e59a8012bb1aaf01.jpg" alt="image"></div><br>  At this step, every fifth key symbol is checked for equality to the value 2Dh.  The fact is that the number 2Dh is a hexadecimal character code "-".  <b><u>Those.</u></b>  <b><u>our key should be xxxx-xxxx-xxxx-xxxx.</u></b>  We use 1234-5678-9012-3456 as a key and proceed to the next step. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/69e/5c1/6e3/69e5c16e3dab04c73449954261ddfb03.jpg" alt="image"></div><br>  And in the next step, <b><u>characters</u></b> are <b><u>checked for numerical identity.</u></b>  The verification procedure is as follows: a character is taken from the key (every fifth character of the key is not counted) and the number -30 is added to its hexadecimal code and the result is compared with the number 9. If less, then the next key character is taken for verification, if A message is displayed that the key is incorrect.  Go ahead. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ef/513/77b/8ef51377b0ed2890a12348f4558434df.jpg" alt="image"></div><br>  At this step, it is verified that the <b><u>sums of the numbers in the blocks are equal.</u></b>  The figure above highlights the block of code that counts the sum of numbers and the stack area where these sums are added.  In parallel, the sums of the blocks are summed up among themselves and entered into the register r10.  Then the result is divided in the register r10 by 4 (shr r10d, 2 - the shift by 2 bits is equivalent to division by 4) and the comparison of the value from the register r10 with the previously entered values ‚Äã‚Äãin the stack.  Fine.  We make so that the sums of digits of each key block are equal (for example 1122-0123-2112-0006) and move on to the next verification step. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/243/490/075/2434900755762d12e176fafc946b1610.jpg" alt="image"></div><br>  The code section highlighted in the figure above checks that the <b><u>location of the characters in each subsequent key block does not match the previous one</u></b> .  As a result, our key looks like 1478-7814-1478-7814.  We are checking. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/802/56e/3d1/80256e3d1c9e2292bab513730c085f0e.jpg" alt="image"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/13a/31f/192/13a31f1928c6f1863ddb2aa3740932d3.jpg" alt="image"></div><br>  Great job! </div><p>Source: <a href="https://habr.com/ru/post/308548/">https://habr.com/ru/post/308548/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308534/index.html">R and Spark</a></li>
<li><a href="../308536/index.html">Announcement of the conference Linux Piter 2016 - the second international Linux conference in Russia</a></li>
<li><a href="../308538/index.html">Crosswalk Project - replacement of Android WebView. Project development</a></li>
<li><a href="../308540/index.html">Serena releases version 11.1 of its BPM platform.</a></li>
<li><a href="../308546/index.html">Creator of the World Wide Web Tim Berners-Lee changed the world, but he himself remained the same</a></li>
<li><a href="../308550/index.html">Blue. Not! Yellow! - or - Do new programming languages ‚Äã‚Äãincrease development speed?</a></li>
<li><a href="../308552/index.html">Friday format: Mental models or approach to solving complex problems</a></li>
<li><a href="../308554/index.html">Starting programming is never too early: the look of a nine-year-old.</a></li>
<li><a href="../308556/index.html">Lua Meetup on September 2 at the Mail.Ru Group office</a></li>
<li><a href="../308558/index.html">Apple has released an emergency update for iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>