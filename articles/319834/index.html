<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WebAssembly - the path to new performance horizons</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you are one of those programmers who on New Year's Eve promised themselves to write faster code, today you have a chance to fulfill this promise. W...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WebAssembly - the path to new performance horizons</h1><div class="post__text post__text-html js-mediator-article">  If you are one of those programmers who on New Year's Eve promised themselves to write faster code, today you have a chance to fulfill this promise.  We will talk about how to speed up web solutions using WebAssembly technology (abbreviated as wasm).  The technology is very young, now is the time of its formation, however, it may well have a serious impact on the future development for the Internet. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc0/47b/2dc/bc047b2dc6b2e85668ab0b873aac1ff0.jpg" alt="image"></div><br>  Here I will talk about how to create WebAssembly modules, how to work with them, how to call them from the client code in the browser as if they were modules written in JS.  We consider two sets of implementations of <a href="https://medium.com/developers-writing/fibonacci-sequence-algorithm-in-javascript-b253dc7e320e">the</a> Fibonacci number search <a href="https://medium.com/developers-writing/fibonacci-sequence-algorithm-in-javascript-b253dc7e320e">algorithm</a> .  One of them is represented by regular JavaScript functions, the second is written in C and converted to a WebAssembly module.  This will allow you to compare the performance of wasm and JS in solving similar problems. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Test Code</font> </h2><br>  We will explore three approaches to finding Fibonacci numbers.  The first uses a loop.  The second involves recursion.  The third is based on the technique of memoization.  All of them are implemented in JavaScript and C. <br><br>  <a href="https://gist.github.com/zzarcon/f25863252278b22e79f2cebaf11bb9da">Here is the</a> js code: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fiboJs</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">num</span></span></span><span class="hljs-function">)</span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-number"><span class="hljs-number">1</span></span>, b = <span class="hljs-number"><span class="hljs-number">0</span></span>, temp;  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (num &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>){    temp = a;    a = a + b;    b = temp;    num--;  }  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> b; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fiboJsRec = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">num</span></span></span><span class="hljs-function">) =&gt;</span></span> {  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (num &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fiboJsRec(num - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fiboJsRec(num - <span class="hljs-number"><span class="hljs-number">2</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fiboJsMemo = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">num, memo</span></span></span><span class="hljs-function">) =&gt;</span></span> {  memo = memo || {};  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (memo[num]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> memo[num];  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (num &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> memo[num] = fiboJsMemo(num - <span class="hljs-number"><span class="hljs-number">1</span></span>, memo) + fiboJsMemo(num - <span class="hljs-number"><span class="hljs-number">2</span></span>, memo); } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = {fiboJs, fiboJsRec, fiboJsMemo};</code> </pre> <br>  <a href="https://gist.github.com/zzarcon/4b8cd1c3b686f81e56c554b96dfc9600">Here</a> is the same thing written in C: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fibonacci</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (n-- &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) {   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = a;   a = b;   b += t; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> b; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fibonacciRec</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> num</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (num &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fibonacciRec(num - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fibonacciRec(num - <span class="hljs-number"><span class="hljs-number">2</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> memo[<span class="hljs-number"><span class="hljs-number">10000</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fibonacciMemo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (memo[n] != <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> memo[n]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">1</span></span> || n == <span class="hljs-number"><span class="hljs-number">2</span></span>) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> memo[n] = fibonacciMemo(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fibonacciMemo(n - <span class="hljs-number"><span class="hljs-number">2</span></span>); } }</code> </pre> <br>  The subtleties of implementation will not be discussed here, yet, our main goal is different.  If you wish, you can read about Fibonacci numbers <a href="http://stackoverflow.com/questions/8965006/java-recursive-fibonacci-sequence">here</a> , <a href="http://stackoverflow.com/questions/8965006/java-recursive-fibonacci-sequence">here</a> is an interesting discussion of the recursive approach to finding these numbers, and <a href="https://en.wikipedia.org/wiki/Memoization">here</a> is a material about memoization.  Before turning to the practical example, let us briefly dwell on the peculiarities of the technologies related to our conversation. <br><br><h2>  <font color="#3AC1EF">Technology</font> </h2><br>  WebAssembly technology is an initiative to create a secure, portable, and fast to download and execute code format suitable for the Web.  WebAssembly is not a programming language.  This is the goal of a compilation that has specifications for text and binary formats.  This means that other low-level languages, such as C / C ++, Rust, Swift, and so on, can be compiled into WebAssembly.  WebAssembly gives access to the same API as browser JavaScript, organically integrates into the existing technology stack.  This distinguishes wasm from something like <a href="https://en.wikipedia.org/wiki/Java_applet">Java applets</a> .  <a href="https://github.com/WebAssembly/design">The</a> WebAssembly <a href="https://github.com/WebAssembly/design">architecture</a> is the result of community collaboration, in which there are representatives of developers from all leading web browsers.  Emscripten is used to compile code into the WebAssembly format. <br><br>  Emscripten is a compiler from LLVM bytecode in JavaScript.  That is, it can be used to compile JavaScript programs written in C / C ++ or in any other languages ‚Äã‚Äãwhose code can be converted to LLVM format.  Emscripten provides a set of APIs for porting code to a format suitable for the web.  This project has been around for many years, it is mainly used to convert games into their browser versions.  Emscripten allows you to achieve high performance due to the fact that it generates code that conforms to Asm.js standards, which is later, but recently, successfully equipped with WebAssembly support. <br><br>  Asm.js is a low-level, optimized subset of JavaScript that provides linear memory access using typed arrays and supports annotations with information about data types.  Asm.js improves the performance of solutions.  This is also not a new programming language, so if the browser does not support it, the Asm.js code will be executed as regular JavaScript, that is, it will not be possible to get a performance boost from its use. <br><br>  WebAssembly, as of January 10, 2017, is supported in <a href="https://www.chromestatus.com/features/5453022515691520">Chrome Canary</a> and <a href="https://hacks.mozilla.org/2016/03/a-webassembly-milestone/">Firefox</a> .  In order for the wasm-code to work, you need to activate the corresponding feature in the settings.  In <a href="https://webkit.org/status/">Safari</a> , WebAssembly support is still under development.  In V8, wasm is <a href="https://chromium.googlesource.com/v8/v8/%2B/34b63f050b1a247bb64ddc91c967501ce04e011f">enabled</a> by default. <br>  <a href="https://www.youtube.com/watch%3Fv%3DPvZdTZ1Nl5o">Here is an</a> interesting video about the V8 engine, about the current state of support for JavaScript and WebAssembly with the <a href="https://www.youtube.com/playlist%3Flist%3DPLNYkxOF6rcIBTs2KPy1E6tIYaWoFcG3uj">Chrome Dev Summit 2016</a> . <br><br><h2>  <font color="#3AC1EF">Building and loading a module</font> </h2><br>  Let's convert a program written in C to the <a href="http://webassembly.org/docs/semantics/">wasm</a> format.  In order to do this, I decided to take the opportunity to create <a href="https://github.com/kripken/emscripten/wiki/WebAssembly-Standalone">standalone</a> WebAssembly modules.  With this approach, at the output of the compiler, we get only a file with the code of WebAssembly, without additional auxiliary .js-files. <br><br>  This approach is based on the Emscripten side module concept.  It makes sense to use such modules, since they are, in essence, very similar to dynamic libraries.  For example, system libraries do not connect to them automatically, they are some self-contained blocks of code issued by the compiler. <br><br><pre> <code class="hljs swift">$ emcc fibonacci.<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> -<span class="hljs-type"><span class="hljs-type">Os</span></span> -s <span class="hljs-type"><span class="hljs-type">WASM</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> -s <span class="hljs-type"><span class="hljs-type">SIDE_MODULE</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> -o fibonacci.wasm</code> </pre> <br>  After receiving the binary file, we only need to load it into the browser.  In order to do this, <a href="">the WebAssembly API</a> provides a top-level <b>WebAssembly</b> object that contains the methods needed to <a href="">compile</a> and <a href="">create an</a> instance of the module.  <a href="https://gist.github.com/zzarcon/f41cb1fddaff4097c216bf38339a296b">Here is a</a> simple method based on Alona Zakai's <a href="https://gist.github.com/kripken/59c67556dc03bb6d57052fedef1e61ab">gist</a> , which works as a universal bootloader. <br><br><pre> <code class="hljs javascript"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filename</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fetch(filename)   .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> response.arrayBuffer())   .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">buffer</span></span></span><span class="hljs-function"> =&gt;</span></span> WebAssembly.compile(buffer))   .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">module</span></span></span><span class="hljs-function"> =&gt;</span></span> {     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imports = {       <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {         <span class="hljs-attr"><span class="hljs-attr">memoryBase</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>,         <span class="hljs-attr"><span class="hljs-attr">tableBase</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>,         <span class="hljs-attr"><span class="hljs-attr">memory</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Memory({           <span class="hljs-attr"><span class="hljs-attr">initial</span></span>: <span class="hljs-number"><span class="hljs-number">256</span></span>         }),         <span class="hljs-attr"><span class="hljs-attr">table</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Table({           <span class="hljs-attr"><span class="hljs-attr">initial</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>,           <span class="hljs-attr"><span class="hljs-attr">element</span></span>: <span class="hljs-string"><span class="hljs-string">'anyfunc'</span></span>         })       }     };     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Instance(<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>, imports);   }); }</code> </pre> <br>  The best part is that everything happens asynchronously.  First we take the contents of the file and convert it into an <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a> data structure.  The buffer contains the original binary data of a fixed length.  We cannot execute them directly, which is why, in the next step, the buffer is passed to the <b>WebAssembly.compile</b> method, which is returned by <a href="">WebAssembly.Module</a> , an instance of which can be created using <b>WebAssembly.Instance</b> . <br><br>  Read the description of the <a href="">binary format</a> a, which uses WebAssembly, if you want to get a deeper understanding of all this. <br><br><h2>  <font color="#3AC1EF">Performance testing</font> </h2><br>  It's time to take a look at how to use the wasm module, how to test its performance and compare it with the speed of JavaScript.  The input of the functions under study will be given the number 40. <a href="https://gist.github.com/zzarcon/e0deeff77a365ea216294db0090632fe">Here is the</a> code for the tests: <br><br><pre> <code class="hljs coffeescript">const Benchmark = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'benchmark'</span></span>); const loadModule = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./loader'</span></span>); const {fiboJs, fiboJsRec, fiboJsMemo} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./fibo.js'</span></span>); const suite = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Benchmark.Suite; const numToFibo = <span class="hljs-number"><span class="hljs-number">40</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Benchmark = Benchmark; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>Benchmark.js uses the <span class="hljs-built_in"><span class="hljs-built_in">global</span></span> object internally <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.info(<span class="hljs-string"><span class="hljs-string">'Benchmark started'</span></span>); loadModule(<span class="hljs-string"><span class="hljs-string">'fibonacci.wasm'</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(instance =&gt; { const fiboNative = instance.exports._fibonacci; const fiboNativeRec = instance.exports._fibonacciRec; const fiboNativeMemo = instance.exports._fibonacciMemo; suite .add(<span class="hljs-string"><span class="hljs-string">'Js'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> fiboJs(numToFibo)) .add(<span class="hljs-string"><span class="hljs-string">'Js recursive'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> fiboJsRec(numToFibo)) .add(<span class="hljs-string"><span class="hljs-string">'Js memoization'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> fiboJsMemo(numToFibo)) .add(<span class="hljs-string"><span class="hljs-string">'Native'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> fiboNative(numToFibo)) .add(<span class="hljs-string"><span class="hljs-string">'Native recursive'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> fiboNativeRec(numToFibo)) .add(<span class="hljs-string"><span class="hljs-string">'Native memoization'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> fiboNativeMemo(numToFibo)) .<span class="hljs-literal"><span class="hljs-literal">on</span></span>(<span class="hljs-string"><span class="hljs-string">'cycle'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(String(event.target))) .<span class="hljs-literal"><span class="hljs-literal">on</span></span>(<span class="hljs-string"><span class="hljs-string">'complete'</span></span>, function() {   <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Fastest: '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'fastest'</span></span>).map(<span class="hljs-string"><span class="hljs-string">'name'</span></span>));   <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Slowest: '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'slowest'</span></span>).map(<span class="hljs-string"><span class="hljs-string">'name'</span></span>));   <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.info(<span class="hljs-string"><span class="hljs-string">'Benchmark finished'</span></span>); }) .run({ <span class="hljs-string"><span class="hljs-string">'async'</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); });</code> </pre> <br>  And here are the results.  On <a href="https://zzarcon.github.io/WebAssembly-demo/">this page</a> , by the way, you can try everything yourself. <br><br><pre> <code class="hljs pgsql">JS <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> x <span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">605</span></span>,<span class="hljs-number"><span class="hljs-number">838</span></span> ops/sec ¬±<span class="hljs-number"><span class="hljs-number">1.17</span></span>% (<span class="hljs-number"><span class="hljs-number">55</span></span> runs sampled) JS <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> x <span class="hljs-number"><span class="hljs-number">0.65</span></span> ops/sec ¬±<span class="hljs-number"><span class="hljs-number">1.09</span></span>% (<span class="hljs-number"><span class="hljs-number">6</span></span> runs sampled) JS memoization x <span class="hljs-number"><span class="hljs-number">407</span></span>,<span class="hljs-number"><span class="hljs-number">714</span></span> ops/sec ¬±<span class="hljs-number"><span class="hljs-number">0.95</span></span>% (<span class="hljs-number"><span class="hljs-number">59</span></span> runs sampled) Native <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> x <span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">166</span></span>,<span class="hljs-number"><span class="hljs-number">298</span></span> ops/sec ¬±<span class="hljs-number"><span class="hljs-number">1.18</span></span>% (<span class="hljs-number"><span class="hljs-number">54</span></span> runs sampled) Native <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> x <span class="hljs-number"><span class="hljs-number">2.20</span></span> ops/sec ¬±<span class="hljs-number"><span class="hljs-number">1.58</span></span>% (<span class="hljs-number"><span class="hljs-number">10</span></span> runs sampled) Native memoization x <span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-number"><span class="hljs-number">886</span></span>,<span class="hljs-number"><span class="hljs-number">062</span></span> ops/sec ¬±<span class="hljs-number"><span class="hljs-number">1.64</span></span>% (<span class="hljs-number"><span class="hljs-number">56</span></span> runs sampled) Fastest: Native memoization Slowest: JS <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span></code> </pre> <br>  It is clearly seen that the wasm-code obtained from the C program (in the test output it is designated as ‚ÄúNative‚Äù) is faster than the similar code written in regular JavaScript (‚ÄúJS‚Äù in the test output).  At the same time, the fastest implementation turned out to be the wasm-function of searching for Fibonacci numbers, using the memoization technique, and the slowest - the recursive function on JavaScript. <br><br>  If you sit over the results with a calculator, you can find out the following: <br><br><ul><li>  The best-performing C implementation is 375% faster than the best JS implementation. <br><br></li><li>  The fastest version in C uses memoization.  On JS, this is an implementation of an algorithm using a loop. <br><br></li><li>  The second most efficient implementation on C is still faster than the fastest version on JS. <br><br></li><li>  The slowest implementation of the algorithm on C is 338% faster than the slowest version on JS. </li></ul><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  I hope you enjoyed my short story about the capabilities of WebAssembly, and what can be achieved with this technology today.  A lot of topics remain beyond the scope of this material, among which are wasm-modules that are being compiled to create and auxiliary files, various ways of interaction between compiled C code and JS code, dynamic linking.  It is possible that we will discuss them someday.  Now you have everything you need to start experimenting with WebAssembly.  By the way, you can still take a look at the official <a href="http://webassembly.org/getting-started/developers-guide/">guide for</a> WebAssembly <a href="http://webassembly.org/getting-started/developers-guide/">developers</a> . <br><br>  In order to keep abreast of the latest developments in the area of ‚Äã‚Äãwasm, add to bookmarks <a href="http://webassembly.org/roadmap/">this page</a> with information about the achievements and development plans of the project.  It will be useful to look in the <a href="https://github.com/kripken/emscripten/blob/master/ChangeLog.markdown">changelog</a> Emscripten. <br><br>  By the way, have you already thought about how to use the features of WebAssembly in your projects? </div><p>Source: <a href="https://habr.com/ru/post/319834/">https://habr.com/ru/post/319834/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../319822/index.html">IT outsourcing in Russia - current realities and perspectives, opinions and experience of experts</a></li>
<li><a href="../319824/index.html">Old men have a place here: forgotten IT technologies in the ranks</a></li>
<li><a href="../319826/index.html">How to distinguish between British and American literature using machine learning</a></li>
<li><a href="../319830/index.html">[Translation] Report: The most popular Android devices in the US, Britain, Germany and Canada for the 4th quarter of 2016</a></li>
<li><a href="../319832/index.html">Hey request! Are you alive? How to easily handle locks in PostgreSQL</a></li>
<li><a href="../319836/index.html">ExBB - PHP File Forum</a></li>
<li><a href="../319838/index.html">As I in one team did a redesign of a web product (cases!)</a></li>
<li><a href="../319848/index.html">"Ultimate DNS Digest": 45 materials from Habr and other resources</a></li>
<li><a href="../319852/index.html">Java examples from books and documentation</a></li>
<li><a href="../319854/index.html">"I learned something - try to explain it until you understand it yourself"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>