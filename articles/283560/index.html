<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Delete your dead code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The post ‚ÄúDelete Code‚Äù by Ned Batchelder recently appeared on HN , although it was originally written in 2002. Here I want to repeat several of Ned's ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Delete your dead code</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/532/e15/510/532e15510ebe4bf098113f6083a381d0.jpg"><br><br>  The post <a href="http://nedbatchelder.com/text/deleting-code_ru.html">‚ÄúDelete Code‚Äù by</a> <a href="http://nedbatchelder.com/">Ned Batchelder</a> recently appeared on <a href="https://news.ycombinator.com/item%3Fid%3D11541474">HN</a> , although it was originally written in 2002.  Here I want to repeat several of Ned's thoughts, and take a more decisive position than he: remove the code as soon as you notice that it is no longer needed, no questions asked.  I will also offer some tips from the trenches how to identify candidates for the dead code. <br><br><h2>  The fact that dead can not die! </h2><br>  This is not just a ‚Äúvery smart‚Äù and timely reference to pop culture.  A dead code, that is, a code that is never executed in your program, is a real obstacle to supporting your code base.  How many times could you not add something that seemed like a simple function or an improvement, just because you were stumped by the complexity of the code that should work alongside this function?  How much nicer would your life be if adding a new feature or correcting an error would be as easy as you thought about when planning your work? <br><a name="habracut"></a><br>  Every time you want to make changes, you need to consider how they interact with all existing functions, ‚Äúcrutches‚Äù, known errors and limitations of the surrounding code.  This is easier to do with less code around the object you want to add, because  at the same time, there will be less things to consider and fewer options that something goes wrong.  The dead code is especially harmful, because it seems that it is necessary to take into account the interaction with it, but since it is dead, it is just a red herring.  It cannot benefit you, since it is never executed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The fact that a dead code can never die is a real threat to your ability to work with this code base.  In the worst case, if code that is never called is not deleted, the size of your application will grow forever.  Before you notice that, perhaps, only a few thousand really functioning lines are surrounded by several orders of magnitude with a large amount of code that does nothing useful. <br><br><h2>  He must go </h2><br>  Ned (Batchelder, not <a href="http://ru.gameofthrones.wikia.com/wiki/%25D0%25AD%25D0%25B4%25D0%25B4%25D0%25B0%25D1%2580%25D0%25B4_%25D0%25A1%25D1%2582%25D0%25B0%25D1%2580%25D0%25BA">Stark</a> ) was a bit more delicate and tactful than I am in this article: <br><blockquote>  Let's say you have an excellent class that has a bunch of methods.  One fine day you discover that some particular method is no longer called.  Will you leave it or delete it? <br><br>  In this case there is no simple answer to this question, because it depends on the class and on the method.  The answer depends on whether you assume that this method may be needed again in the future. <br>  <a href="http://nedbatchelder.com/text/deleting-code_ru.html">A source</a> </blockquote><br>  I will say this: burn the earth and do not leave the code alive.  The best code is the code of which you do not have. <br><br>  If you're not as daring as I am, remember that version control systems will cover you in case you ever need this code again. <br><br>  However, I never felt the need to return something that I already deleted, at least not literally returning line-by-line, literally, a piece of code that I had previously deleted. <br><br>  Of course, I'm not talking about things like returning erroneous commits ‚Äî we are all human, and I make as many mistakes as others.  I mean, I never deleted objects sent to production, and then returned several weeks or months later, thinking: ‚ÄúWell, the code seems to be the one I wrote a year or more ago was very good, so I‚Äôll return ka i have him back.  The code base lives and develops over time, so the old code probably does not fit with the new ideas, techniques, frameworks and styles used today.  I could go back to the old version for an update, especially if it‚Äôs some subtle points, but I never returned the code back en masse. <br><br>  So do yourself and your team a favor and delete the dead code as soon as you notice it. <br><br><h2>  How did we get here? </h2><br>  <a href="http://nedbatchelder.com/text/deleting-code_ru.html">Ned's post</a> explains in detail how and why a ‚Äúdead‚Äù code appears - perhaps the one who makes the changes does not think that the code should disappear forever and comment on it or add a conditional compilation.  Perhaps the person making the changes does not know enough to understand that the code is actually dead (I‚Äôll tell you about this later). <br><br>  I‚Äôll add another hypothesis to the list: we can all just be lazy.  Of course, it is easier to not do something (that is, to leave it as it is) than to do something (delete). <br><br>  Laziness is, after all, one of the <a href="http://threevirtues.com/">three great virtues of a programmer</a> .  But the laziness that <a href="http://www.wall.org/~larry/">Larry Wall is</a> talking about is of a different kind: "The quality that makes you exert more effort to reduce the total energy costs."  From this point of view, the removal of dead code is Laziness with a capital L - to do something that is easy to do now, to save yourself from having to do something difficult in the future.  We should all try to develop such Laziness.  I like to think of her as ‚Äúdisciplined laziness,‚Äù our daily habit. <br><br><h2>  How do we get out of here? </h2><br>  I spend most of my time programming in Python, for which, unfortunately, IDEs usually cannot correctly analyze the full code base and automatically find never called code.  But by combining discipline and some tools for analyzing the program at runtime (run-time tooling), we can approach this problem from two sides. <br><br>  In simple cases, a good sense of code can help identify and remove dead code while you make changes.  Imagine that you are working on a particular function and notice that one of the if / else branches can never be executed.  I call it ‚Äúdead code in the small‚Äù <sup><a href="https://habr.com/ru/post/283560/">*</a></sup> and it is fairly easy to see and remove, but this requires a bit more effort than it could have been spent. <br><br>  Until you develop the habit of noticing this during all your normal routine work, you can add one more step to the actions you perform before the commit: check for any dead code next to your changes.  This can happen just before sending the code to your colleagues (you do a <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25BE%25D1%2581%25D0%25BC%25D0%25BE%25D1%2582%25D1%2580_%25D0%25BA%25D0%25BE%25D0%25B4%25D0%25B0">code review</a> , right?) So they don‚Äôt have to repeat this process while watching your changes. <br><br>  Another kind of dead code appears when you delete the last class that uses it, or when you make changes, not realizing that this is the last place that uses it.  This is ‚Äúdead code in the large‚Äù <sup><a href="https://habr.com/ru/post/283560/">*</a></sup> , and is harder to detect in the course of normal programming, unless you are lucky enough to have <a href="https://ru.wikipedia.org/wiki/%25D0%25AD%25D0%25B9%25D0%25B4%25D0%25B5%25D1%2582%25D0%25B8%25D0%25B7%25D0%25BC">eidetic memory</a> , or know the code base like your own five fingers. <br><br>  That's when we can be helped by tools for analyzing a program at runtime.  In <a href="http://tech.magnetic.com/">Magnetic,</a> we use the Ned package (yes, the same Ned) <a href="http://coverage.readthedocs.org/en/latest/">coverage.py</a> to help us make decisions about the dead code.  Usually coverage is used during testing to ensure that your test cases correctly execute the test code, but we also use it in our ‚Äúas usual‚Äù code to understand what is being used and what is not: <br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> coverage cov = coverage.Coverage( data_file=<span class="hljs-string"><span class="hljs-string">"/path/to/my_program.coverage"</span></span>, auto_data=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, cover_pylib=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, branch=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, source=[<span class="hljs-string"><span class="hljs-string">"/path/to/my/program"</span></span>], ) cov.start() <span class="hljs-comment"><span class="hljs-comment"># ...  - ... cov.stop() cov.save()</span></span></code> </pre> <br>  Here a Coverage object is created with several options to make the report more convenient.  First, we tell him where to save his data (we will use it later, to create a convenient HTML report, about what is used and what is not), and we ask it to automatically open and add them to this file using auto_data = True .  Further, we ask you not to worry about processing the standard library and installed packages - this is not our code, so we can assume that much of what it contains may not be used by us.  This is not a dead code that we have to maintain, so we can safely ignore it.  We ask him to calculate the branch coverage (are both true and false states for each if statement)?  And finally, we indicate where our sources are located, so that it can combine its knowledge of what is used and not used in the source code for compiling a report. <br><br>  After starting our program, we can create an HTML report: <br><pre> <code class="bash hljs">$ COVERAGE_FILE=/path/to/my_program.coverage coverage html -d /path/to/output</code> </pre><br>  Which looks something like this: <br><img src="https://habrastorage.org/files/77e/f36/571/77ef36571180429c8a70f378a7174dc1.png" width="700"><br>  (A <a href="http://nedbatchelder.com/files/sample_coverage_html/index.html">full HTML report example</a> can be found in the <a href="http://coverage.readthedocs.org/en/latest/">coverage.py documentation.</a> ) <br><br>  The lines highlighted in red were not called during program execution.  These strings (and possibly methods) are candidates for deletion as dead code. <br><br>  I will leave you three warnings about using this approach to find and delete dead code: <br><ol><li>  Be careful when considering the outcome of the work coverage - the fact that the string or function was not executed during one program run does not mean that they are necessarily dead or not available at all.  You should still check the code to determine if they are completely dead in your application. </li><li>  Calculating coverage means that your program needs to do more work, so it will be slower when running in this mode.  I would not recommend running it in production, but in the staging environment or in the target scenarios, everything should be fine.  As always, if performance is an important task, you must measure the impact of the calculation of coverage before running it. </li><li>  Finally, do not trust code coverage reports during test runs.  Some code may be dead, but tests will still run it;  and some code may be alive, but not run tests! </li></ol><br><br><h2>  Goodbye words </h2><br>  Before you, dear reader, I must apologize.  I omitted an important part of Ned's post when I quoted him earlier. <br>  He says: <br><blockquote>  In this case there is no simple answer to this question, because it depends on the class and on the method.  [...] The rude answer may be as follows: if this class is part of the framework, then leave it, if it is part of the application, then delete it. </blockquote><br>  If you are writing a library or framework, and not an application, then the question of dead code becomes more difficult on the one hand, and easier on the other.  In essence, you can never remove a part of the public API (except for <a href="http://semver.org/lang/ru/">incompatibility in major versions</a> ).  In fact, your entire public API is live code, even if you do not use it yourself.  But behind the frontend, a dead code can still occur, and it should be removed. <br><br>  Delete your dead code! <br><br><hr><br><a name="note"></a>  <sup>*</sup> - references to <a href="https://en.wikipedia.org/wiki/Programming_in_the_large_and_programming_in_the_small">the programming paradigms of</a> "programming in the small" and "programming in the large" <i>(approx. Transl.)</i> </div><p>Source: <a href="https://habr.com/ru/post/283560/">https://habr.com/ru/post/283560/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../283548/index.html">Doomsday: What are the hidden errors of asynchronous data processing with increasing load</a></li>
<li><a href="../283550/index.html">Distribute pictures by rails after disabling Google‚Äôs svn repositories</a></li>
<li><a href="../283552/index.html">Reduce the size of published npm modules</a></li>
<li><a href="../283554/index.html">Adding Unreal Engine support for dxf format</a></li>
<li><a href="../283556/index.html">Angular 2 Beta, training course "Tour of Heroes" part 4</a></li>
<li><a href="../283570/index.html">Objective-C, static libraries, categories, -ObjC, pain‚Ä¶</a></li>
<li><a href="../283572/index.html">PyNSK # 8 - May meeting of the Novosibirsk Python community</a></li>
<li><a href="../283576/index.html">IOS TEAM Developer Portfolio</a></li>
<li><a href="../283580/index.html">The digest of interesting materials for the mobile # 153 developer (May 10-15)</a></li>
<li><a href="../283582/index.html">Video of the best reports of the .NET conference DotNext 2015 Moscow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>