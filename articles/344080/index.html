<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Debugging an evil bug in Go runtime</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I'm a big fan of Prometheus and Grafana . After working SRE at Google, I learned to appreciate good monitoring and over the past year I preferred to u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Debugging an evil bug in Go runtime</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/pb/wy/7i/pbwy7iszx6tlxruyh6xel5fhpc0.jpeg"></div><br><p>  I'm a big fan of <a href="https://prometheus.io/">Prometheus</a> and <a href="https://grafana.com/">Grafana</a> .  After working SRE at Google, I learned to appreciate good monitoring and over the past year I preferred to use a combination of these tools.  I use them to monitor my personal servers (black-box and white-box monitoring), external and internal events of <a href="https://encounter.eus/">Euskal Encounter</a> , to monitor client projects and much more.  Prometheus makes it very easy to write custom export modules to monitor my own data, and you can also find a suitable module right out of the box.  For example, to create a nice panel of available metrics for Encounter events, we use <a href="https://github.com/justwatchcom/sql_exporter">sql_exporter</a> . </p><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/xc/rf/1k/xcrf1kp7sijbdpxxvacdgvxe8uo.png"><br>  <em>Event panel for Euskal Encounter (false staging data)</em> </p><br><p> You can easily <code>node_exporter</code> to any machine and set up an instance of Prometheus to get the basic system metrics (CPU, memory, network, disk, file system, etc.).  I thought, why not monitor your laptop this way?  I have a ‚Äúgaming‚Äù laptop, Clevo, which I use as the main workstation.  He usually stands at home, but sometimes he goes to big events with me like the Chaos Communication Congress.  And since I already have a VPN between the laptop and one of my servers running Prometheus, I can simply <code>emerge prometheus-node_exporter</code> , pick up the service and point it to the Prometheus instance.  It will automatically configure alerts, and my phone will start breaking when I open too many tabs in Chrome and exhaust all 32 GB of RAM.  Wonderful. </p><br><h2 id="na-gorizonte-problema">  Problem on the horizon </h2><br><p>  About an hour after setting up, my phone reported that the newly added monitoring object was unavailable.  Alas, I perfectly connected to the laptop via SSH, so the whole thing was about the <code>node_exporter</code> . </p><br><pre> <code class="hljs go">fatal error: unexpected signal during runtime execution [signal SIGSEGV: segmentation violation code=<span class="hljs-number"><span class="hljs-number">0x1</span></span> addr=<span class="hljs-number"><span class="hljs-number">0xc41ffc7fff</span></span> pc=<span class="hljs-number"><span class="hljs-number">0x41439e</span></span>] goroutine <span class="hljs-number"><span class="hljs-number">2395</span></span> [running]: runtime.throw(<span class="hljs-number"><span class="hljs-number">0xae6f</span></span>b8, <span class="hljs-number"><span class="hljs-number">0x2a</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/<span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">605</span></span> +<span class="hljs-number"><span class="hljs-number">0x95</span></span> fp=<span class="hljs-number"><span class="hljs-number">0xc4203e8be8</span></span> sp=<span class="hljs-number"><span class="hljs-number">0xc4203e8bc8</span></span> pc=<span class="hljs-number"><span class="hljs-number">0x42c815</span></span> runtime.sigpanic() /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/signal_unix.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">351</span></span> +<span class="hljs-number"><span class="hljs-number">0x2b8</span></span> fp=<span class="hljs-number"><span class="hljs-number">0xc4203e8c38</span></span> sp=<span class="hljs-number"><span class="hljs-number">0xc4203e8be8</span></span> pc=<span class="hljs-number"><span class="hljs-number">0x443318</span></span> runtime.heapBitsSetType(<span class="hljs-number"><span class="hljs-number">0xc4204b6f</span></span>c0, <span class="hljs-number"><span class="hljs-number">0x30</span></span>, <span class="hljs-number"><span class="hljs-number">0x30</span></span>, <span class="hljs-number"><span class="hljs-number">0xc420304058</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/mbitmap.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">1224</span></span> +<span class="hljs-number"><span class="hljs-number">0x26e</span></span> fp=<span class="hljs-number"><span class="hljs-number">0xc4203e8c90</span></span> sp=<span class="hljs-number"><span class="hljs-number">0xc4203e8c38</span></span> pc=<span class="hljs-number"><span class="hljs-number">0x41439e</span></span> runtime.mallocgc(<span class="hljs-number"><span class="hljs-number">0x30</span></span>, <span class="hljs-number"><span class="hljs-number">0xc420304058</span></span>, <span class="hljs-number"><span class="hljs-number">0x1</span></span>, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/malloc.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">741</span></span> +<span class="hljs-number"><span class="hljs-number">0x546</span></span> fp=<span class="hljs-number"><span class="hljs-number">0xc4203e8d</span></span>38 sp=<span class="hljs-number"><span class="hljs-number">0xc4203e8c90</span></span> pc=<span class="hljs-number"><span class="hljs-number">0x411876</span></span> runtime.newobject(<span class="hljs-number"><span class="hljs-number">0xa717e0</span></span>, <span class="hljs-number"><span class="hljs-number">0xc42032f</span></span>430) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/malloc.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">840</span></span> +<span class="hljs-number"><span class="hljs-number">0x38</span></span> fp=<span class="hljs-number"><span class="hljs-number">0xc4203e8d</span></span>68 sp=<span class="hljs-number"><span class="hljs-number">0xc4203e8d</span></span>38 pc=<span class="hljs-number"><span class="hljs-number">0x411d</span></span>68 github.com/prometheus/node_exporter/vendor/github.com/prometheus/client_golang/prometheus.NewConstMetric(<span class="hljs-number"><span class="hljs-number">0xc42018e460</span></span>, <span class="hljs-number"><span class="hljs-number">0x2</span></span>, <span class="hljs-number"><span class="hljs-number">0x3ff</span></span>0000000000000, <span class="hljs-number"><span class="hljs-number">0xc42032f</span></span>430, <span class="hljs-number"><span class="hljs-number">0x1</span></span>, <span class="hljs-number"><span class="hljs-number">0x1</span></span>, <span class="hljs-number"><span class="hljs-number">0x10</span></span>, <span class="hljs-number"><span class="hljs-number">0x9f9d</span></span>c0, <span class="hljs-number"><span class="hljs-number">0x8a0601</span></span>, <span class="hljs-number"><span class="hljs-number">0xc42032f</span></span>430) /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/tmp/portage/net-analyzer/prometheus-node_exporter<span class="hljs-number"><span class="hljs-number">-0.15</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/work/prometheus-node_exporter<span class="hljs-number"><span class="hljs-number">-0.15</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/src/github.com/prometheus/node_exporter/vendor/github.com/prometheus/client_golang/prometheus/value.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">165</span></span> +<span class="hljs-number"><span class="hljs-number">0xd0</span></span> fp=<span class="hljs-number"><span class="hljs-number">0xc4203e8dd</span></span>0 sp=<span class="hljs-number"><span class="hljs-number">0xc4203e8d</span></span>68 pc=<span class="hljs-number"><span class="hljs-number">0x77a980</span></span></code> </pre> <br><p>  <code>node_exporter</code> , like many Prometheus components, is written in Go.  This is a relatively safe language: it allows you to shoot yourself in the leg if you wish, and its security guarantees are incomparable with Rust, for example, but still it is not so easy to call segfault in Go.  In addition, <code>node_exporter</code> is a fairly simple Go application, for the most part using purely pure dependencies.  Hence, the case of the fall will be interesting.  Especially considering that the drop occurred in <code>mallocgc</code> , which should not fall at all under normal conditions. </p><br><p>  After a few restarts, it became even more interesting: </p><br><pre> <code class="hljs go"><span class="hljs-number"><span class="hljs-number">2017</span></span>/<span class="hljs-number"><span class="hljs-number">11</span></span>/<span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>:<span class="hljs-number"><span class="hljs-number">49</span></span> http: <span class="hljs-built_in"><span class="hljs-built_in">panic</span></span> serving <span class="hljs-number"><span class="hljs-number">172.20</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">38504</span></span>: runtime error: growslice: <span class="hljs-built_in"><span class="hljs-built_in">cap</span></span> out of <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> goroutine <span class="hljs-number"><span class="hljs-number">41</span></span> [running]: net/http.(*conn).serve.func1(<span class="hljs-number"><span class="hljs-number">0xc4201cdd</span></span>60) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/net/http/server.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">1697</span></span> +<span class="hljs-number"><span class="hljs-number">0xd0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>(<span class="hljs-number"><span class="hljs-number">0xa24f</span></span>20, <span class="hljs-number"><span class="hljs-number">0xb41190</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/<span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">491</span></span> +<span class="hljs-number"><span class="hljs-number">0x283</span></span> fmt.(*buffer).WriteString(...) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/fmt/<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">82</span></span> fmt.(*fmt).padString(<span class="hljs-number"><span class="hljs-number">0xc42053a040</span></span>, <span class="hljs-number"><span class="hljs-number">0xc4204e6800</span></span>, <span class="hljs-number"><span class="hljs-number">0xc4204e6850</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/fmt/format.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">110</span></span> +<span class="hljs-number"><span class="hljs-number">0x110</span></span> fmt.(*fmt).fmt_s(<span class="hljs-number"><span class="hljs-number">0xc42053a040</span></span>, <span class="hljs-number"><span class="hljs-number">0xc4204e6800</span></span>, <span class="hljs-number"><span class="hljs-number">0xc4204e6850</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/fmt/format.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">328</span></span> +<span class="hljs-number"><span class="hljs-number">0x61</span></span> fmt.(*pp).fmtString(<span class="hljs-number"><span class="hljs-number">0xc42053a000</span></span>, <span class="hljs-number"><span class="hljs-number">0xc4204e6800</span></span>, <span class="hljs-number"><span class="hljs-number">0xc4204e6850</span></span>, <span class="hljs-number"><span class="hljs-number">0xc400000073</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/fmt/<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">433</span></span> +<span class="hljs-number"><span class="hljs-number">0x197</span></span> fmt.(*pp).printArg(<span class="hljs-number"><span class="hljs-number">0xc42053a000</span></span>, <span class="hljs-number"><span class="hljs-number">0x9f</span></span>4700, <span class="hljs-number"><span class="hljs-number">0xc42041c290</span></span>, <span class="hljs-number"><span class="hljs-number">0x73</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/fmt/<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">664</span></span> +<span class="hljs-number"><span class="hljs-number">0x7b5</span></span> fmt.(*pp).doPrintf(<span class="hljs-number"><span class="hljs-number">0xc42053a000</span></span>, <span class="hljs-number"><span class="hljs-number">0xae7c2d</span></span>, <span class="hljs-number"><span class="hljs-number">0x2c</span></span>, <span class="hljs-number"><span class="hljs-number">0xc420475670</span></span>, <span class="hljs-number"><span class="hljs-number">0x2</span></span>, <span class="hljs-number"><span class="hljs-number">0x2</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/fmt/<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">996</span></span> +<span class="hljs-number"><span class="hljs-number">0x15a</span></span> fmt.Sprintf(<span class="hljs-number"><span class="hljs-number">0xae7c2d</span></span>, <span class="hljs-number"><span class="hljs-number">0x2c</span></span>, <span class="hljs-number"><span class="hljs-number">0xc420475670</span></span>, <span class="hljs-number"><span class="hljs-number">0x2</span></span>, <span class="hljs-number"><span class="hljs-number">0x2</span></span>, <span class="hljs-number"><span class="hljs-number">0x10</span></span>, <span class="hljs-number"><span class="hljs-number">0x9f</span></span>4700) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/fmt/<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">196</span></span> +<span class="hljs-number"><span class="hljs-number">0x66</span></span> fmt.Errorf(<span class="hljs-number"><span class="hljs-number">0xae7c2d</span></span>, <span class="hljs-number"><span class="hljs-number">0x2c</span></span>, <span class="hljs-number"><span class="hljs-number">0xc420475670</span></span>, <span class="hljs-number"><span class="hljs-number">0x2</span></span>, <span class="hljs-number"><span class="hljs-number">0x2</span></span>, <span class="hljs-number"><span class="hljs-number">0xc420410301</span></span>, <span class="hljs-number"><span class="hljs-number">0xc420410300</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/fmt/<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">205</span></span> +<span class="hljs-number"><span class="hljs-number">0x5a</span></span></code> </pre> <br><p>  So, already interesting.  This time <code>Sprintf</code> broke.  Shta </p><br><pre> <code class="hljs go">runtime: pointer <span class="hljs-number"><span class="hljs-number">0xc4203e2f</span></span>b0 to unallocated span idx=<span class="hljs-number"><span class="hljs-number">0x1f</span></span>1 span.base()=<span class="hljs-number"><span class="hljs-number">0xc4203d</span></span>c000 span.limit=<span class="hljs-number"><span class="hljs-number">0xc4203e6000</span></span> span.state=<span class="hljs-number"><span class="hljs-number">3</span></span> runtime: found in object at *(<span class="hljs-number"><span class="hljs-number">0xc420382a80</span></span>+<span class="hljs-number"><span class="hljs-number">0x80</span></span>) object=<span class="hljs-number"><span class="hljs-number">0xc420382a80</span></span> k=<span class="hljs-number"><span class="hljs-number">0x62101c1</span></span> s.base()=<span class="hljs-number"><span class="hljs-number">0xc420382000</span></span> s.limit=<span class="hljs-number"><span class="hljs-number">0xc420383f</span></span>80 s.spanclass=<span class="hljs-number"><span class="hljs-number">42</span></span> s.elemsize=<span class="hljs-number"><span class="hljs-number">384</span></span> s.state=_MSpanInUse &lt;snip&gt; fatal error: found bad pointer in Go heap (incorrect use of unsafe or cgo?) runtime stack: runtime.throw(<span class="hljs-number"><span class="hljs-number">0xaee4f</span></span>e, <span class="hljs-number"><span class="hljs-number">0x3e</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/<span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">605</span></span> +<span class="hljs-number"><span class="hljs-number">0x95</span></span> fp=<span class="hljs-number"><span class="hljs-number">0x7f0f19ff</span></span>ab90 sp=<span class="hljs-number"><span class="hljs-number">0x7f0f19ff</span></span>ab70 pc=<span class="hljs-number"><span class="hljs-number">0x42c815</span></span> runtime.heapBitsForObject(<span class="hljs-number"><span class="hljs-number">0xc4203e2f</span></span>b0, <span class="hljs-number"><span class="hljs-number">0xc420382a80</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0xc41ffd</span></span>8a33, <span class="hljs-number"><span class="hljs-number">0xc400000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x7f0f</span></span>400ac560, <span class="hljs-number"><span class="hljs-number">0xc420031260</span></span>, <span class="hljs-number"><span class="hljs-number">0x11</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/mbitmap.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">425</span></span> +<span class="hljs-number"><span class="hljs-number">0x489</span></span> fp=<span class="hljs-number"><span class="hljs-number">0x7f0f19ff</span></span>abe8 sp=<span class="hljs-number"><span class="hljs-number">0x7f0f19ff</span></span>ab90 pc=<span class="hljs-number"><span class="hljs-number">0x4137c9</span></span> runtime.scanobject(<span class="hljs-number"><span class="hljs-number">0xc420382a80</span></span>, <span class="hljs-number"><span class="hljs-number">0xc420031260</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/mgcmark.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">1187</span></span> +<span class="hljs-number"><span class="hljs-number">0x25d</span></span> fp=<span class="hljs-number"><span class="hljs-number">0x7f0f19ff</span></span>ac90 sp=<span class="hljs-number"><span class="hljs-number">0x7f0f19ff</span></span>abe8 pc=<span class="hljs-number"><span class="hljs-number">0x41ebed</span></span> runtime.gcDrain(<span class="hljs-number"><span class="hljs-number">0xc420031260</span></span>, <span class="hljs-number"><span class="hljs-number">0x5</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/mgcmark.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">943</span></span> +<span class="hljs-number"><span class="hljs-number">0x1ea</span></span> fp=<span class="hljs-number"><span class="hljs-number">0x7f0f19ff</span></span>ace0 sp=<span class="hljs-number"><span class="hljs-number">0x7f0f19ff</span></span>ac90 pc=<span class="hljs-number"><span class="hljs-number">0x41e42a</span></span> runtime.gcBgMarkWorker.func2() /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/mgc.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">1773</span></span> +<span class="hljs-number"><span class="hljs-number">0x80</span></span> fp=<span class="hljs-number"><span class="hljs-number">0x7f0f19ffad</span></span>20 sp=<span class="hljs-number"><span class="hljs-number">0x7f0f19ff</span></span>ace0 pc=<span class="hljs-number"><span class="hljs-number">0x4580b0</span></span> runtime.systemstack(<span class="hljs-number"><span class="hljs-number">0xc420436ab8</span></span>) /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/asm_amd64.s:<span class="hljs-number"><span class="hljs-number">344</span></span> +<span class="hljs-number"><span class="hljs-number">0x79</span></span> fp=<span class="hljs-number"><span class="hljs-number">0x7f0f19ffad</span></span>28 sp=<span class="hljs-number"><span class="hljs-number">0x7f0f19ffad</span></span>20 pc=<span class="hljs-number"><span class="hljs-number">0x45a469</span></span> runtime.mstart() /usr/lib64/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/proc.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">1125</span></span> fp=<span class="hljs-number"><span class="hljs-number">0x7f0f19ffad</span></span>30 sp=<span class="hljs-number"><span class="hljs-number">0x7f0f19ffad</span></span>28 pc=<span class="hljs-number"><span class="hljs-number">0x430f</span></span>e0</code> </pre> <br><p>  Now the problems began with the garbage collector.  Already another failure. </p><br><p>  Here you could make two logical conclusions: either I have a serious problem with the hardware, or in the binary a memory bug.  At first, I decided that the first is unlikely, because the laptop was processing very different types of loads at the same time and there were no signs of unstable work that could be associated with the equipment (I had software dropped, but this never happened by chance).  Since Go binaries like <code>node_exporter</code> are statically linked and do not depend on any other libraries, I downloaded the official release of the binary and tried to make sure that most of my system was not a variable.  But still got a crash: </p><br><pre> <code class="hljs go">unexpected fault address <span class="hljs-number"><span class="hljs-number">0x0</span></span> fatal error: fault [signal SIGSEGV: segmentation violation code=<span class="hljs-number"><span class="hljs-number">0x80</span></span> addr=<span class="hljs-number"><span class="hljs-number">0x0</span></span> pc=<span class="hljs-number"><span class="hljs-number">0x76b998</span></span>] goroutine <span class="hljs-number"><span class="hljs-number">13</span></span> [running]: runtime.throw(<span class="hljs-number"><span class="hljs-number">0xabf</span></span>b11, <span class="hljs-number"><span class="hljs-number">0x5</span></span>) /usr/local/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/<span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">605</span></span> +<span class="hljs-number"><span class="hljs-number">0x95</span></span> fp=<span class="hljs-number"><span class="hljs-number">0xc420060c40</span></span> sp=<span class="hljs-number"><span class="hljs-number">0xc420060c20</span></span> pc=<span class="hljs-number"><span class="hljs-number">0x42c725</span></span> runtime.sigpanic() /usr/local/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/runtime/signal_unix.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">374</span></span> +<span class="hljs-number"><span class="hljs-number">0x227</span></span> fp=<span class="hljs-number"><span class="hljs-number">0xc420060c90</span></span> sp=<span class="hljs-number"><span class="hljs-number">0xc420060c40</span></span> pc=<span class="hljs-number"><span class="hljs-number">0x443197</span></span> github.com/prometheus/node_exporter/vendor/github.com/prometheus/client_model/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>.(*LabelPair).GetName(...) /<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/github.com/prometheus/node_exporter/vendor/github.com/prometheus/client_model/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/metrics.pb.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">85</span></span> github.com/prometheus/node_exporter/vendor/github.com/prometheus/client_golang/prometheus.(*Desc).String(<span class="hljs-number"><span class="hljs-number">0xc4203ae010</span></span>, <span class="hljs-number"><span class="hljs-number">0xaea9d</span></span>0, <span class="hljs-number"><span class="hljs-number">0xc42045c000</span></span>) /<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/github.com/prometheus/node_exporter/vendor/github.com/prometheus/client_golang/prometheus/desc.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">179</span></span> +<span class="hljs-number"><span class="hljs-number">0xc8</span></span> fp=<span class="hljs-number"><span class="hljs-number">0xc420060d</span></span>c8 sp=<span class="hljs-number"><span class="hljs-number">0xc420060c90</span></span> pc=<span class="hljs-number"><span class="hljs-number">0x76b998</span></span></code> </pre> <br><p>  Brand new crash.  It looks like a problem with node_exporter or one of its dependencies, so I filled out <a href="https://github.com/prometheus/node_exporter/issues/730">a bug report</a> on GitHub.  Perhaps, developers already faced the similar?  It is necessary to attract their attention and listen to what they say. </p><br><h2 id="ne-takoy-uzh-korotkiy-obhodnoy-put">  Not-so-short workaround </h2><br><p>  It is not surprising that at first they assumed: it is a matter of equipment.  It is quite reasonable, because I ran into a problem on only one computer.  All the rest of my cars drove fine <code>node_exporter</code> .  I had no other evidence of iron failure on this host, or even an explanation of what exactly <code>node_exporter</code> could have caused.  <a href="http://www.memtest.org/">Memtest86 +</a> still did not harm anyone, so I decided to use it. </p><br><p>  And then it happened: </p><br><p><img src="https://habrastorage.org/webt/4s/de/j6/4sdej6bc97xa1rbou7qj6non5fy.png"><br>  <em>That's what happens when you use consumer goods for serious tasks.</em> </p><br><p>  Oops!  Broken memory.  More precisely, one bit.  I drove the test entirely and found this bit and a few false positives in test No. 7 (blocks move in it, which can lead to the reproduction of a single error). </p><br><p>  Further testing in Memtest86 + revealed that test No. 5 in SMP mode quickly detects a problem, but usually not on the first pass.  The problem always occurred with one bit at the same address.  It looks like a weak memory cell, which, when heated, begins to act up.  Logically: a rise in temperature increases leakage in memory cells, and the likelihood that some marginal cell will start to fail will increase. </p><br><p>  To make it clearer: this is one bad bit of 274,877,906,944. Great value!  Hard drives and flash memory have a much higher error rate ‚Äî in these devices, broken blocks are marked in factories, and during operation, new broken blocks are unnoticed by users and transferred to the backup zone.  The RAM has no such mechanisms, so the broken block remains forever. </p><br><p>  Alas, this bit is unlikely to result in malfunctions in my <code>node_exporter</code> .  The application uses very little memory, so the probability of hitting the bad bit (and time after time) is extremely small.  The problem of this bit would manifest itself, in the worst case, leading to a broken pixel in the image, or the loss of one character in the letter, or the failure of any instruction, or a rare segfault, if something bad had to be done on a bad bit.  Nevertheless, this means long-term problems with reliability, and therefore servers and other devices for which reliability is important, use ECC RAM - memory with error correction. </p><br><p>  I have no such luxury in my laptop.  But then I can mark the broken block as bad and tell the OS not to use it.  GRUB 2 has a little-known <a href="https://www.gnu.org/software/grub/manual/grub/html_node/badram.html">ability</a> to change the memory scheme that is transferred to the loaded OS kernel.  You should not buy a new line of memory because of one bad bit (besides, DDR3 is already outdated, and it is likely that the new memory will also be with weak cells). </p><br><p>  But I can do something else.  As the situation worsens with temperature, what will happen if I heat my memory? </p><br><p><img src="https://habrastorage.org/webt/66/js/x3/66jsx30zbisvfmlcyer9strvuvs.jpeg"><br><img src="https://habrastorage.org/webt/in/ia/3o/inia3oqe65ali7t_f78k7lhmexu.jpeg"><br>  <em>100 ¬∞ C</em> </p><br><p>  Having set the temperature of the hair dryer to 130 ¬∞ C, I warmed up two memory modules (the other two are hiding under the back cover, there are four slots in my laptop).  Having played with the order of the modules, I found three more weak bits that were scattered in three modules and only manifested themselves when they were heated. </p><br><p>  I also found that the location of the errors remained almost unchanged even when modules were rearranged: the upper bits of the address were the same.  The whole thing is in the alternation of RAM: instead of each module assigning a whole quarter of the address space, data is distributed across all four modules.  This is convenient, then you can put a mask on the memory area, covering all possible addresses for each bad bit, and not worry that everything is messed up if you swap the modules in places.  I found out that if you put a mask on a solid area of ‚Äã‚Äã128 KB, then this is enough to close all possible permutations of addresses for every bad bit.  But rounded up to 1 MB.  It turned out three megabyte equalized blocks for masking (one of them covers two bad bits, and all I wanted to cover four): </p><br><ul><li> <code>0x36a700000 ‚Äì 0x36a7fffff</code> </li> <li> <code>0x460e00000 ‚Äì 0x460efffff</code> </li> <li> <code>0x4ea000000 ‚Äì 0x4ea0fffff</code> </li> </ul><br><p>  I set the masks in <code>/etc/default/grub</code> using the address masking syntax: </p><br><pre> <code class="hljs objectivec">GRUB_BADRAM=<span class="hljs-string"><span class="hljs-string">"0x36a700000,0xfffffffffff00000,0x460e00000,0xfffffffffff00000,0x4ea000000,0xfffffffffff00000"</span></span></code> </pre> <br><p>  Then he quickly executed <code>grub-mkconfig</code> and turned off 3 MB of memory with four bad bits.  Of course, not ECC RAM, and yet the reliability of my Shirpotreb's memory should be higher, because I know that the other cells behave stably when heated to 100 ¬∞ C. </p><br><p>  As you understand, <code>node_exporter</code> continued to fall, but we knew that this problem was not serious, right? </p><br><h2 id="kopaem-glubzhe">  Digging deeper </h2><br><p>  In this bug, I was annoyed by the fact that the reason was clearly a memory corruption that crashed the executable code.  It is very difficult to debug, because it is impossible to predict what will be damaged (floating problem), and you can not catch a bad code by the hand. </p><br><p>  At first, I tried to split the available <code>node_exporter</code> releases in <code>node_exporter</code> and turn on / off different collectors, but this did not give me anything.  Tried to run an instance under <code>strace</code> .  The falls have stopped, indicating a race condition.  Later it turned out that <code>strace</code> instance also falls, but this had to wait much longer.  I assumed it was a parallelization.  Set <code>GOMAXPROCS=1</code> so that Go uses only one system thread of execution.  The crashes stopped again, so I had arguments for the problem of paralleling. </p><br><p>  By that time, I had collected a large number of logs of falls and began to notice some patterns.  Although the places and the order of falls changed greatly, but in general, error messages could be divided into three groups, and one of the errors occurred more than once.  I climbed into a search engine and came across a <a href="https://github.com/golang/go/issues/20427">problem in Go No. 20427</a> .  It seems that she belonged to another part of Go, but led to the same segfault and random failures.  The ticket was closed without analysis, because the situation could not be reproduced in Go 1.9.  No one knew what the root of the problem was, it just stopped. </p><br><p>  I took the <a href="https://github.com/golang/go/issues/20427">code</a> from the error report that caused the crashes, and I started it.  Oh, a miracle, in seconds I got a fall.  Got it!  So much better than <code>node_exporter</code> hours waiting for the <code>node_exporter</code> to fall. </p><br><p>  This did not bring me closer to debugging on the Go side, but it allowed me to test solutions much faster.  Let's try the other side </p><br><h2 id="proveryaem-na-mashinah">  Check on the machines </h2><br><p>  Crashes occur on my laptop, but not on my other computers.  I tried to reproduce the bug on all servers that were easily accessed, and did not encounter a single crash.  So, on my laptop there is something special.  Go statically links the binaries, so the rest of the user space doesn't matter.  There are two candidates left: the hardware or the OS kernel. </p><br><p>  Only my computers are accessible to me from hardware, but I can test the kernels.  First question: will there be a fall in the virtual machine? </p><br><p>  I made a minimal initramfs (initial ram file system) in order to run the crash playback code very quickly in the QEMU virtual machine without installing the distribution or downloading the full version of Linux.  My initramfs was built on Linux <code>scripts/gen_initramfs_list.sh</code> and contained the files: </p><br><pre> <code class="hljs swift">dir /dev <span class="hljs-number"><span class="hljs-number">755</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> nod /dev/console <span class="hljs-number"><span class="hljs-number">0600</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> nod /dev/null <span class="hljs-number"><span class="hljs-number">0666</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> dir /bin <span class="hljs-number"><span class="hljs-number">755</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> file /bin/busybox busybox <span class="hljs-number"><span class="hljs-number">755</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> slink /bin/sh busybox <span class="hljs-number"><span class="hljs-number">755</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> slink /bin/<span class="hljs-literal"><span class="hljs-literal">true</span></span> busybox <span class="hljs-number"><span class="hljs-number">755</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> file /<span class="hljs-keyword"><span class="hljs-keyword">init</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.sh <span class="hljs-number"><span class="hljs-number">755</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> file /reproducer reproducer <span class="hljs-number"><span class="hljs-number">755</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  <code>/init</code> is the Linux-initramfs entry point, in my case it was a simple shell script to run the test and measure time: </p><br><pre> <code class="hljs mel">#!/bin/sh export PATH=/bin start=$(busybox <span class="hljs-keyword"><span class="hljs-keyword">date</span></span> +%s) echo <span class="hljs-string"><span class="hljs-string">"Starting test now..."</span></span> /reproducer ret=$? end=$(busybox <span class="hljs-keyword"><span class="hljs-keyword">date</span></span> +%s) echo <span class="hljs-string"><span class="hljs-string">"Test exited with status $ret after $((end-start)) seconds"</span></span></code> </pre> <br><p>  <code>/bin/busybox</code> is a statically linked version of BusyBox, typically used in minimized systems like mine to provide all the basic Linux shell utilities (including the shell itself). </p><br><p>  Initramfs can be done like this (based on the source tree of the Linux kernel), where list.txt is the above list of files: </p><br><pre> <code class="hljs php">scripts/gen_initramfs_list.sh -o initramfs.gz <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.txt</code> </pre> <br><p>  And QEMU can directly load the kernel and initramfs: </p><br><pre> <code class="hljs pgsql">qemu-<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>-x86_64 -kernel /boot/vmlinuz<span class="hljs-number"><span class="hljs-number">-4.13</span></span><span class="hljs-number"><span class="hljs-number">.9</span></span>-gentoo -initrd initramfs.gz -append <span class="hljs-string"><span class="hljs-string">'console=ttyS0'</span></span> -smp <span class="hljs-number"><span class="hljs-number">8</span></span> -nographic -<span class="hljs-type"><span class="hljs-type">serial</span></span> mon:stdio -cpu host -<span class="hljs-keyword"><span class="hljs-keyword">enable</span></span>-kvm</code> </pre> <br><p>  Nothing was displayed in the console ... then I realized that I didn‚Äôt even compile support for the 8250 serial port in my kernel on my laptop. Damn.  He doesn't have a physical serial port, right?  Okay, I quickly rebuilt the kernel with the port support (and crossed my fingers, so as not to change anything important), tried again, successfully loaded and launched the reproducing bug code. </p><br><p>  Fell down?  Yeah.  Well, the crash can be played in a virtual machine on the same computer.  I tried the same QEMU command on my home server, on its own core, and ... nothing.  Then I copied the kernel from the laptop, downloaded and ... crashed.  It's all about the core.  This is not iron. </p><br><h2 id="zhongliruya-yadrami">  Juggling cores </h2><br><p>  I realized that I would have to compile a lot of cores in order to catch the problem.  I decided to do it on my most powerful computer: a rather old 12-core Xeon with 24 threads of execution (it no longer works, unfortunately).  I copied the source code of the failed kernel, compiled and tested it. </p><br><p>  Did not fall. </p><br><p>  What? </p><br><p>  Scratched in the head, checked if the original kernel binary falls (fell).  Is it really iron?  Does it really matter what computer I build the kernel on?  I tried to build on the home server, a fall soon happened.  If you assemble one core on two machines, then there are drops, and if you assemble on the third, there are no drops.  Why is that? </p><br><p>  On all three machines, there is a Linux Gentoo with Hardened Gentoo changes.  But on a laptop and a home server is ~ amd64 (unstable version), and on a Xeon server - amd64 (stable).  That is, the GCC is different.  On the laptop and the home server was gcc (Gentoo Hardened 6.4.0 p1.0) 6.4.0, and on Xeon it was gcc (Gentoo Hardened 5.4.0-r3 p1.3, pie-0.6.5) 5.4.0. </p><br><p>  But the kernel on the home server, almost the same version as on the laptop, compiled using the same GCC, did not reproduce the crash.  It turns out that both compilers used to build the kernel are important, <em>as well as</em> the kernel itself (or its configuration)? </p><br><p>  To find out, I compiled on the home server exactly the same kernel tree from my laptop (linux-4.13.9-gentoo), it fell.  Therefore I copied <code>.config</code> from the home server and compiled it - it did not fall.  So, you need to take into account the difference in configurations and compilers: </p><br><ul><li>  <code>linux-4.13.9-gentoo + gcc 5.4.0-r3 p1.3 + laptop .config</code> - does not crash. </li><li>  <code>linux-4.13.9-gentoo + gcc 6.4.0 p1.0 + laptop .config</code> - <em>crashes</em> . </li><li>  <code>linux-4.13.9-gentoo + gcc 6.4.0 p1.0 + server .config</code> - does not crash. </li></ul><br><p>  Two configs, one good and one bad.  Of course, they were very different (I prefer to include in the configuration of my kernel only those drivers that are needed on a specific computer), so I had to rebuild the kernel one by one, looking for differences. </p><br><p>  I decided to start with the ‚Äúdefinitely bad‚Äù config and began to throw out different things from it.  Since the reproducing failure code fell at different intervals, it was easier to test for ‚Äústill falling‚Äù (just waiting for the fall) than ‚Äúnot falling‚Äù (how long would you have to wait to confirm the absence of failure?).  Over the course of 22 kernel builds, I simplified the <a href="https://marcan.st/posts/go_debug/config">configuration</a> so much that the core lost network support, file system, block device foundation, and even PCI support (and continued to work fine in a virtual machine!).  My builds now took less than 60 seconds, and the core was about 3/4 less than usual. </p><br><p>  Then I went to the ‚Äúexactly good‚Äù configuration and removed all unnecessary junk, checking whether the repro code falls (it was harder and longer than the previous test).  I had a few false branches when I changed something (I don‚Äôt know what) that destroys the repro code.  I mistakenly marked them as ‚Äúnot falling‚Äù, and when I ran into crashes, I had to go back to the previously assembled cores and find out when exactly the falls occurred.  I collected seven cores. </p><br><p>  In the end, I narrowed down the search area to a small number of different options.  Some attracted attention, for example <code>CONFIG_OPTIMIZE_INLINING</code> .  After careful checking, I made sure that this option was the culprit.  If you turn it off, the reproducing code falls, and if you turn it on, there are no failures.  Enabling this option allows GCC to determine which <code>inline</code> functions really need to be inline, and not to force it.  This explains the connection with GCC: the behavior of the inlining is probably different in different versions of the compiler. </p><br><pre> <code class="hljs vbscript">/* * Force always-inline <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> the user requests it so via the .config, * <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> gcc <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> too old. * GCC does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> warn about unused static inline functions <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> * -Wunused-<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>. This turns out <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> avoid the need <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> complex #ifdef * directives. Suppress the warning <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> clang as well by using <span class="hljs-string"><span class="hljs-string">"unused"</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> attribute, which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> redundant but <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> harmful <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> gcc. */ #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !defined(CONFIG_ARCH_SUPPORTS_OPTIMIZED_INLINING) || \ !defined(CONFIG_OPTIMIZE_INLINING) || (__GNUC__ &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) #define inline inline __attribute__((always_inline,unused)) notrace #define __inline__ __inline__ __attribute__((always_inline,unused)) notrace #define __inline __inline __attribute__((always_inline,unused)) notrace #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> /* A lot of inline functions can cause havoc <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> tracing */ #define inline inline __attribute__((unused)) notrace #define __inline__ __inline__ __attribute__((unused)) notrace #define __inline __inline __attribute__((unused)) notrace #endif</code> </pre> <br><p>  What's next?  We know that the CONFIG_OPTIMIZE_INLINING option results in crashes, but it can change the behavior of each inline function in the entire kernel.  How to calculate the root of evil? </p><br><p>  I have an idea. </p><br><h2 id="differencialnaya-kompilyaciya-na-osnove-heshey">  Differential Hash Based Compilation </h2><br><p>  The idea is to compile one part of the kernel with the option turned on, and the other part with the option turned off.  After verification, it is possible to understand which subset of kernel computational modules contain the problem code. </p><br><p>              .  -  GCC: </p><br><pre> <code class="hljs mel">#!/bin/bash args=(<span class="hljs-string"><span class="hljs-string">"$@"</span></span>) doit= <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> [ $# -gt <span class="hljs-number"><span class="hljs-number">0</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"$1"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> -c) doit=<span class="hljs-number"><span class="hljs-number">1</span></span> ;; -o) shift objfile=<span class="hljs-string"><span class="hljs-string">"$1"</span></span> ;; esac shift done extra= <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ ! -z <span class="hljs-string"><span class="hljs-string">"$doit"</span></span> ]; then sha=<span class="hljs-string"><span class="hljs-string">"$(echo -n "</span></span>$objfile<span class="hljs-string"><span class="hljs-string">" | sha1sum - | cut -d"</span></span> <span class="hljs-string"><span class="hljs-string">" -f1)"</span></span> echo <span class="hljs-string"><span class="hljs-string">"${sha:0:8} $objfile"</span></span> &gt;&gt; objs.txt <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ $((<span class="hljs-number"><span class="hljs-number">0</span></span>x${sha:<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">8</span></span>} &amp; (<span class="hljs-number"><span class="hljs-number">0x80000000</span></span> &gt;&gt; $BIT))) = <span class="hljs-number"><span class="hljs-number">0</span></span> ]; then echo <span class="hljs-string"><span class="hljs-string">"[n]"</span></span> <span class="hljs-string"><span class="hljs-string">"$objfile"</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;&amp;<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> extra=-DCONFIG_OPTIMIZE_INLINING echo <span class="hljs-string"><span class="hljs-string">"[y]"</span></span> <span class="hljs-string"><span class="hljs-string">"$objfile"</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;&amp;<span class="hljs-number"><span class="hljs-number">2</span></span> fi fi <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span> gcc $extra <span class="hljs-string"><span class="hljs-string">"${args[@]}"</span></span></code> </pre> <br><p>         SHA-1,      32   (    $BIT).    0,   <code>CONFIG_OPTIMIZE_INLINING</code> .   1,   <code>CONFIG_OPTIMIZE_INLINING</code> .  ,     685   (    ),        10 .        :       (  0),    ,       (       ). </p><br><p>   32 ,       SHA-1,    29 .               SHA-1,       .    (  )     ,     .      . </p><br><pre> <code class="hljs markdown">$ grep '^[<span class="hljs-string"><span class="hljs-string">0246</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">012389ab</span></span>][<span class="hljs-string"><span class="hljs-string">0189</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">014589cd</span></span>][<span class="hljs-string"><span class="hljs-string">028a</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">012389ab</span></span>][<span class="hljs-string"><span class="hljs-string">014589cd</span></span>]' objs<span class="hljs-emphasis"><span class="hljs-emphasis">_0.txt 6b9cab4f arch/x86/entry/vdso/vclock_</span></span>gettime.o</code> </pre> <br><p>  vDSO.  Well, of course. </p><br><h2 id="vyhodki-vdso">  vDSO </h2><br><p> vDSO       .     ,        . vDSO           .    ,            . </p><br><p>  , vDSO ‚Äî  GCC ,              .    .  ,      :     ,   ,   ! Go  vDSO   .   Go  ( ,   )     ,     vDSO      Linux- glibc,     (  ). </p><br><p>   <code>CONFIG_OPTIMIZE_INLINING</code>   vDSO?    . </p><br><p>  <code>CONFIG_OPTIMIZE_INLINING=n</code> : </p><br><pre> <code class="hljs mel">arch/x86/entry/vdso/vclock_gettime.o.no_inline_opt: <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">format</span></span> elf64-x86<span class="hljs-number"><span class="hljs-number">-64</span></span> Disassembly of section .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>: <span class="hljs-number"><span class="hljs-number">0000000000000000</span></span> &lt;vread_tsc&gt;: <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-number"><span class="hljs-number">55</span></span> push %rbp <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">89</span></span> e5 mov %rsp,%rbp <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-number"><span class="hljs-number">90</span></span> nop <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-number"><span class="hljs-number">90</span></span> nop <span class="hljs-number"><span class="hljs-number">6</span></span>: <span class="hljs-number"><span class="hljs-number">90</span></span> nop <span class="hljs-number"><span class="hljs-number">7</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>f <span class="hljs-number"><span class="hljs-number">31</span></span> rdtsc <span class="hljs-number"><span class="hljs-number">9</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> c1 e2 <span class="hljs-number"><span class="hljs-number">20</span></span> shl $0x20,%rdx d: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span> d0 or %rdx,%rax <span class="hljs-number"><span class="hljs-number">10</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>b <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov <span class="hljs-number"><span class="hljs-number">0x0</span></span>(%rip),%rdx # <span class="hljs-number"><span class="hljs-number">17</span></span> &lt;vread_tsc+<span class="hljs-number"><span class="hljs-number">0x17</span></span>&gt; <span class="hljs-number"><span class="hljs-number">17</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span> c2 cmp %rax,%rdx <span class="hljs-number"><span class="hljs-number">1</span></span>a: <span class="hljs-number"><span class="hljs-number">77</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span> ja <span class="hljs-number"><span class="hljs-number">1</span></span>e &lt;vread_tsc+<span class="hljs-number"><span class="hljs-number">0x1e</span></span>&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>c: <span class="hljs-number"><span class="hljs-number">5</span></span>d pop %rbp <span class="hljs-number"><span class="hljs-number">1</span></span>d: c3 retq <span class="hljs-number"><span class="hljs-number">1</span></span>e: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">89</span></span> d0 mov %rdx,%rax <span class="hljs-number"><span class="hljs-number">21</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>d pop %rbp <span class="hljs-number"><span class="hljs-number">22</span></span>: c3 retq <span class="hljs-number"><span class="hljs-number">23</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>f <span class="hljs-number"><span class="hljs-number">1</span></span>f <span class="hljs-number"><span class="hljs-number">00</span></span> nopl (%rax) <span class="hljs-number"><span class="hljs-number">26</span></span>: <span class="hljs-number"><span class="hljs-number">66</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>e <span class="hljs-number"><span class="hljs-number">0</span></span>f <span class="hljs-number"><span class="hljs-number">1</span></span>f <span class="hljs-number"><span class="hljs-number">84</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> nopw %cs:<span class="hljs-number"><span class="hljs-number">0x0</span></span>(%rax,%rax,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span>d: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0000000000000030</span></span> &lt;__vdso_clock_gettime&gt;: <span class="hljs-number"><span class="hljs-number">30</span></span>: <span class="hljs-number"><span class="hljs-number">55</span></span> push %rbp <span class="hljs-number"><span class="hljs-number">31</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">89</span></span> e5 mov %rsp,%rbp <span class="hljs-number"><span class="hljs-number">34</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">81</span></span> ec <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> sub $0x1020,%rsp <span class="hljs-number"><span class="hljs-number">3</span></span>b: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>c <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> orq $0x0,(%rsp) <span class="hljs-number"><span class="hljs-number">40</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">81</span></span> c4 <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> add $0x1020,%rsp <span class="hljs-number"><span class="hljs-number">47</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>c <span class="hljs-number"><span class="hljs-number">8</span></span>d <span class="hljs-number"><span class="hljs-number">0</span></span>d <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> lea <span class="hljs-number"><span class="hljs-number">0x0</span></span>(%rip),%r9 # <span class="hljs-number"><span class="hljs-number">4</span></span>e &lt;__vdso_clock_gettime+<span class="hljs-number"><span class="hljs-number">0x1e</span></span>&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>e: <span class="hljs-number"><span class="hljs-number">83</span></span> ff <span class="hljs-number"><span class="hljs-number">01</span></span> cmp $0x1,%edi <span class="hljs-number"><span class="hljs-number">51</span></span>: <span class="hljs-number"><span class="hljs-number">74</span></span> <span class="hljs-number"><span class="hljs-number">66</span></span> je b9 &lt;__vdso_clock_gettime+<span class="hljs-number"><span class="hljs-number">0x89</span></span>&gt; <span class="hljs-number"><span class="hljs-number">53</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>f <span class="hljs-number"><span class="hljs-number">8</span></span>e dc <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> jle <span class="hljs-number"><span class="hljs-number">135</span></span> &lt;__vdso_clock_gettime+<span class="hljs-number"><span class="hljs-number">0x105</span></span>&gt; <span class="hljs-number"><span class="hljs-number">59</span></span>: <span class="hljs-number"><span class="hljs-number">83</span></span> ff <span class="hljs-number"><span class="hljs-number">05</span></span> cmp $0x5,%edi <span class="hljs-number"><span class="hljs-number">5</span></span>c: <span class="hljs-number"><span class="hljs-number">74</span></span> <span class="hljs-number"><span class="hljs-number">34</span></span> je <span class="hljs-number"><span class="hljs-number">92</span></span> &lt;__vdso_clock_gettime+<span class="hljs-number"><span class="hljs-number">0x62</span></span>&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>e: <span class="hljs-number"><span class="hljs-number">83</span></span> ff <span class="hljs-number"><span class="hljs-number">06</span></span> cmp $0x6,%edi <span class="hljs-number"><span class="hljs-number">61</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>f <span class="hljs-number"><span class="hljs-number">85</span></span> c2 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> jne <span class="hljs-number"><span class="hljs-number">129</span></span> &lt;__vdso_clock_gettime+<span class="hljs-number"><span class="hljs-number">0xf9</span></span>&gt; [...]</code> </pre> <br><p>  <code>CONFIG_OPTIMIZE_INLINING=y</code> : </p><br><pre> <code class="hljs mel">arch/x86/entry/vdso/vclock_gettime.o.inline_opt: <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">format</span></span> elf64-x86<span class="hljs-number"><span class="hljs-number">-64</span></span> Disassembly of section .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>: <span class="hljs-number"><span class="hljs-number">0000000000000000</span></span> &lt;__vdso_clock_gettime&gt;: <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-number"><span class="hljs-number">55</span></span> push %rbp <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>c <span class="hljs-number"><span class="hljs-number">8</span></span>d <span class="hljs-number"><span class="hljs-number">0</span></span>d <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> lea <span class="hljs-number"><span class="hljs-number">0x0</span></span>(%rip),%r9 # <span class="hljs-number"><span class="hljs-number">8</span></span> &lt;__vdso_clock_gettime+<span class="hljs-number"><span class="hljs-number">0x8</span></span>&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-number"><span class="hljs-number">83</span></span> ff <span class="hljs-number"><span class="hljs-number">01</span></span> cmp $0x1,%edi b: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">89</span></span> e5 mov %rsp,%rbp e: <span class="hljs-number"><span class="hljs-number">74</span></span> <span class="hljs-number"><span class="hljs-number">66</span></span> je <span class="hljs-number"><span class="hljs-number">76</span></span> &lt;__vdso_clock_gettime+<span class="hljs-number"><span class="hljs-number">0x76</span></span>&gt; <span class="hljs-number"><span class="hljs-number">10</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>f <span class="hljs-number"><span class="hljs-number">8</span></span>e dc <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> jle f2 &lt;__vdso_clock_gettime+<span class="hljs-number"><span class="hljs-number">0xf2</span></span>&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>: <span class="hljs-number"><span class="hljs-number">83</span></span> ff <span class="hljs-number"><span class="hljs-number">05</span></span> cmp $0x5,%edi <span class="hljs-number"><span class="hljs-number">19</span></span>: <span class="hljs-number"><span class="hljs-number">74</span></span> <span class="hljs-number"><span class="hljs-number">34</span></span> je <span class="hljs-number"><span class="hljs-number">4</span></span>f &lt;__vdso_clock_gettime+<span class="hljs-number"><span class="hljs-number">0x4f</span></span>&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>b: <span class="hljs-number"><span class="hljs-number">83</span></span> ff <span class="hljs-number"><span class="hljs-number">06</span></span> cmp $0x6,%edi <span class="hljs-number"><span class="hljs-number">1</span></span>e: <span class="hljs-number"><span class="hljs-number">0</span></span>f <span class="hljs-number"><span class="hljs-number">85</span></span> c2 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> jne e6 &lt;__vdso_clock_gettime+<span class="hljs-number"><span class="hljs-number">0xe6</span></span>&gt; [...]</code> </pre> <br><p> , <code>CONFIG_OPTIMIZE_INLINING=y</code>   GCC  <em></em> ,      <em></em> :    <code>vread_tsc</code>  ,      <code>CONFIG_OPTIMIZE_INLINING=n</code> .  <code>vread_tsc</code>     <code>inline</code> ,   GCC      ,        . <br>      ?  What is the problem?     ‚Ä¶ </p><br><pre> <code class="hljs mel"> <span class="hljs-number"><span class="hljs-number">30</span></span>: <span class="hljs-number"><span class="hljs-number">55</span></span> push %rbp <span class="hljs-number"><span class="hljs-number">31</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">89</span></span> e5 mov %rsp,%rbp <span class="hljs-number"><span class="hljs-number">34</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">81</span></span> ec <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> sub $0x1020,%rsp <span class="hljs-number"><span class="hljs-number">3</span></span>b: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>c <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> orq $0x0,(%rsp) <span class="hljs-number"><span class="hljs-number">40</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">81</span></span> c4 <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> add $0x1020,%rsp</code> </pre> <br><p>  GCC   4   ?      ,    (stack probe),   ‚Äî   GCC <code>-fstack-check</code> . </p><br><p>  Linux Gentoo Hardened <code>-fstack-check</code>   .      <a href="https://www.qualys.com/2017/06/19/stack-clash/stack-clash.txt">Stack Clash</a> .  <code>-fstack-check</code> ‚Äî   GCC      ,       ( ,     Stack Clash   GCC 8).    :  ,       (,  ),     4   .   ,   <code>-fstack-check</code> ,    4    ,    -¬´¬ª ( ,     ). </p><br><p> Go   . </p><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">TEXT</span></span> runtime¬∑walltime(SB),NOSPLIT,<span class="hljs-meta"><span class="hljs-meta">$16</span></span> // Be careful. W<span class="hljs-string"><span class="hljs-string">e're calling a function with gcc calling convention here. // We'</span></span>re guaranteed <span class="hljs-number"><span class="hljs-number">128</span></span> bytes <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> entry, <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> w<span class="hljs-string"><span class="hljs-string">e've taken 16, and the // call uses another 8. // That leaves 104 for the gettime code to use. Hope that'</span></span>s enough!</code> </pre> <br><p> , 104     .     . </p><br><p>  ,   vDSO       ,     Go   ,     . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>     .   ‚Äî  <code>orq</code> ,    0.  ,      (   ,  segfault).    vDSO   segfaults,   Go ?   ,    0    .  <code>orq</code>   ,        .   .        , <code>orq</code>         .      ,             ,      ,     .      <code>GOMAXPROCS=1</code>     ,           Go. </p><br><p>  How to fix?       Go.   <a href="https://github.com/golang/go/commit/a158382b1c9c0b95a7d41865a405736be6bc585f"> </a>    vDSO.     (),   .   <code>node_exporter</code>   Go  . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/344080/">https://habr.com/ru/post/344080/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344064/index.html">GDPR - new rules for the processing of personal data in Europe for the international IT market</a></li>
<li><a href="../344066/index.html">[Translation of the article] 7 basic rules for protection against phishing</a></li>
<li><a href="../344068/index.html">Instructions for use sysadmin in small business</a></li>
<li><a href="../344070/index.html">As in banks: the state will insure exchange investments of citizens in the amount of up to 1.4 million rubles</a></li>
<li><a href="../344076/index.html">The release of CLion 2017.3: significant improvements in C ++ support, integration with Valgrind Memcheck and Boost.Test, and more</a></li>
<li><a href="../344082/index.html">A rather remarkable case of introducing video conferencing in one industrial enterprise.</a></li>
<li><a href="../344084/index.html">How we help quickly certify the requirements of information security to those who move to the cloud</a></li>
<li><a href="../344086/index.html">Preview documents in a Python program</a></li>
<li><a href="../344090/index.html">How to build a community. Translation of the book "Social Architecture": Chapter 1. Toolkit</a></li>
<li><a href="../344092/index.html">Product Design Digest, November 2017</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>