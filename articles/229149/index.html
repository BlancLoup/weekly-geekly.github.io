<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We investigate and test distributed computing from Hazelcast</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to test Hazelcast . In the previous post, we met with his queues. And in this we take a closer look at his ability to distributed tasks. 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We investigate and test distributed computing from Hazelcast</h1><div class="post__text post__text-html js-mediator-article">  We continue to test <a href="http://hazelcast.com/">Hazelcast</a> .  In the previous <a href="http://habrahabr.ru/post/228445/">post,</a> we met with his queues.  And in this we take a closer look at his ability to distributed tasks. <br><br>  It is much more efficient to work with data as close as possible to them, instead of pumping out ‚Äúto yourself‚Äù, then counting and / or changing and sending it back to the distributed storage.  This is the opportunity that Hazelcast provides us in the form of a distributed implementation of the ExecutorService.  It is possible to control the servers on which servers to store data, by grouping them by a common key, and to run tasks on the necessary servers using the same key. <br><br>  We will try to find out - is this true and are there any pitfalls? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  All tests are available on <a href="https://github.com/romario13/hz-executor">GitHub</a> . <br><br>  And so, let's go.  The latest stable version of hazelcast is used - 3.2.3. <br>  (The tests provide approximate data on the measurement of speed and quantity. The configuration of the test machine is not published. The data are sufficient to compare the tests with each other, which is the goal) <br><br><h5>  Test 1 - we work in the old manner </h5><br><br>  The purpose of this test is to measure performance when working without distributed computing for further comparisons. <br><br>  We take two nodes and two storages (Map).  We emulate the worst case in which all the data we have is not on the local node.  Those.  The hazelcast will be forced to download data from another node and, after changing it, save it also on another node.  We create all the problems that should be solved by distributed computing tasks in future tests. <br><br>  We expect that we will quickly throw 100k tasks into the queue and then they will be executed in 10 threads. <br><br>  Result: <br><br>  INFO: 100,000 713 sec: 0.538 <br>  INFO: Done tasks: 100000 sec: 15.470 <br><br>  The expectations were met.  They threw 100k fast - in half a second.  During the cast, only 713 tasks were completed.  All tasks completed in 15.5 seconds. <br><br><h5>  Test 2 - distributed computing </h5><br><br>  Now turn on distributed computing from hazelcast.  We also run the worst case when the necessary data is on the second node.  But now the hazelcast should determine this and send the task to the second node and start it there. <br><br>  We expect that we will quickly throw 100k tasks into the queue and then they will be executed in 10 threads as well (we specified this in the hazelcast configuration) but faster than in the first test.  Additionally, we register - on which node the tasks were performed. <br><br>  Result: <br><br>  INFO: 100000 99998 sec: 6.308 <br>  INFO: Done tasks: hz1: 0 hz2: 100000 sec: 6.319 <br><br>  We see that all the tasks have been completed on the second node (hz2: 100000) and the speed increase is more than two times.  It is very good.  Moreover, this difference will grow with the growth of data processed in reality.  Now we have only integers in the vault. <br><br>  But something very incomprehensible is happening with the cast.  It can be seen that the cast was very slow.  During the cast, almost all the tasks were completed.  We will put a little aside this riddle, and now we will look at more vital test. <br><br><h5>  Test 3 - even more reality </h5><br><br>  In this test, we will no longer artificially create tasks only for the second node.  In real life, there will be bright moments when the data will be on the same node where the calculations are initiated. <br><br>  We expect that the speed will be even higher.  We expect close to uniform distribution of tasks by nodes. <br><br>  Result: <br><br>  INFO: 100000 99857 sec: 5.241 <br>  INFO: Done tasks: hz1: 50818 hz2: 49182 sec: 5.252 <br><br>  The expectations were met.  We see the normal distribution of tasks among the nodes (hz1: 50818 hz2: 49182) and the execution speed is faster by a second. <br><br><h5>  Test 4 - perform slow tasks </h5><br><br>  Tasks are different.  Some can and resources of input of an output to operate in the course of work.  Therefore, we will try to perform slow tasks (add a delay of 10 milliseconds to complete them).  In addition, we are interested in the previously discovered effect that almost all of the tasks are completed during their casting.  Perhaps the fact is that they are fast and there is a hazelcast overhead compared to the first test? <br><br>  We do not expect a decrease in time for the abandonment of tasks.  We expect an increase in the execution time of all tasks. <br><br>  Result: <br><br>  INFO: 100000 99978 sec: 59.442 <br>  INFO: Done tasks: hz1: 49522 hz2: 50478 sec: 59.455 <br><br>  Casting also catastrophically slowed down.  This is strange, especially since we use the <code>executorService.executeOnKeyOwner</code> casting method, which, unlike <code>executorService.submitToKeyOwner</code> does not imply waiting for the execution result.  Must quit task and forget. <br><br>  We read the source.  The first point (you can skip the code, the conclusions below): <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">executeOnKeyOwner</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Runnable command, Object key)</span></span></span><span class="hljs-function"> </span></span>{ Callable&lt;?&gt; callable = createRunnableAdapter(command); submitToKeyOwner(callable, key); }</code> </pre><br><br>  Hazelcast translates our call into <pre> <code class="hljs cs"><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> final <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SYNC_FREQUENCY = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> final AtomicInteger consecutiveSubmits = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AtomicInteger(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sync) { Object response; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { response = future.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(); ... ... <span class="hljs-comment"><span class="hljs-comment">/** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkSync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { boolean sync = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> last = lastSubmitTime; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> now = Clock.currentTimeMillis(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (last + <span class="hljs-number"><span class="hljs-number">10</span></span> &lt; now) { consecutiveSubmits.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == <span class="hljs-number"><span class="hljs-number">0</span></span>) { sync = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } lastSubmitTime = now; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  <span class="hljs-number"><span class="hljs-number">100</span></span>      <span class="hljs-number"><span class="hljs-number">10</span></span> ,  hazelcast     (<span class="hljs-number"><span class="hljs-number">100</span></span> )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test <span class="hljs-number"><span class="hljs-number">5</span></span> -    <br> <br>               ,        <span class="hljs-number"><span class="hljs-number">4.</span></span>     ,      hazelcast  .      .     <span class="hljs-number"><span class="hljs-number">100</span></span>    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: <span class="hljs-number"><span class="hljs-number">100000</span></span> <span class="hljs-number"><span class="hljs-number">25223</span></span> sec: <span class="hljs-number"><span class="hljs-number">13.350</span></span> <br> INFO: Done tasks: hz1: <span class="hljs-number"><span class="hljs-number">49257</span></span> hz2: <span class="hljs-number"><span class="hljs-number">50743</span></span> sec: <span class="hljs-number"><span class="hljs-number">52.837</span></span> <br> <br>             <span class="hljs-number"><span class="hljs-number">25</span></span>k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , <span class="hljs-number"><span class="hljs-number">50</span></span>     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test <span class="hljs-number"><span class="hljs-number">6</span></span> -  OOM <br> <br> Hazelcast        .       .       <span class="hljs-number"><span class="hljs-number">10.</span></span> <br> <br>           : <br> <br> <code class="java">WARNING: [<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>]:<span class="hljs-number"><span class="hljs-number">5701</span></span> [dev] [<span class="hljs-number"><span class="hljs-number">3.2</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>] While executing RunnableAdapter{task=Test6$RunnableTask@<span class="hljs-number"><span class="hljs-number">219307f</span></span>2} <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:<span class="hljs-number"><span class="hljs-number">98</span></span>)</code> <br> <br>  : <br> <br> <code class="java"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Runnable command</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!taskQ.offer(command)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RejectedExecutionException(<span class="hljs-string"><span class="hljs-string">"Executor["</span></span> + name + <span class="hljs-string"><span class="hljs-string">"] is overloaded!"</span></span>); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: <span class="hljs-number"><span class="hljs-number">100000</span></span> <span class="hljs-number"><span class="hljs-number">32604</span></span> sec: <span class="hljs-number"><span class="hljs-number">16.931</span></span> <br> INFO: Done tasks: hz1: <span class="hljs-number"><span class="hljs-number">26304</span></span> hz2: <span class="hljs-number"><span class="hljs-number">26281</span></span> sec: <span class="hljs-number"><span class="hljs-number">27.269</span></span> <br> <br>     . <br> <br> Test <span class="hljs-number"><span class="hljs-number">7</span></span> -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: <span class="hljs-number"><span class="hljs-number">100000</span></span> <span class="hljs-number"><span class="hljs-number">31790</span></span> sec: <span class="hljs-number"><span class="hljs-number">16.713</span></span> <br> INFO: Done tasks: hz1: <span class="hljs-number"><span class="hljs-number">25898</span></span> hz2: <span class="hljs-number"><span class="hljs-number">25873</span></span> sec: <span class="hljs-number"><span class="hljs-number">27.046</span></span> <br> INFO: Canceled tasks: <span class="hljs-number"><span class="hljs-number">0</span></span> execution exceptions: <span class="hljs-number"><span class="hljs-number">48229</span></span> rejected tasks: <span class="hljs-number"><span class="hljs-number">48229</span></span> <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           <span class="hljs-number"><span class="hljs-number">10</span></span>     <span class="hljs-number"><span class="hljs-number">99</span></span>;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> </pre> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> <h5> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> </h5> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> <h5> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> </h5> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> <pre> <code class="hljs cs"><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> final <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SYNC_FREQUENCY = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> final AtomicInteger consecutiveSubmits = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AtomicInteger(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sync) { Object response; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { response = future.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(); ... ... <span class="hljs-comment"><span class="hljs-comment">/** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkSync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { boolean sync = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> last = lastSubmitTime; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> now = Clock.currentTimeMillis(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (last + <span class="hljs-number"><span class="hljs-number">10</span></span> &lt; now) { consecutiveSubmits.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == <span class="hljs-number"><span class="hljs-number">0</span></span>) { sync = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } lastSubmitTime = now; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  <span class="hljs-number"><span class="hljs-number">100</span></span>      <span class="hljs-number"><span class="hljs-number">10</span></span> ,  hazelcast     (<span class="hljs-number"><span class="hljs-number">100</span></span> )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test <span class="hljs-number"><span class="hljs-number">5</span></span> -    <br> <br>               ,        <span class="hljs-number"><span class="hljs-number">4.</span></span>     ,      hazelcast  .      .     <span class="hljs-number"><span class="hljs-number">100</span></span>    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: <span class="hljs-number"><span class="hljs-number">100000</span></span> <span class="hljs-number"><span class="hljs-number">25223</span></span> sec: <span class="hljs-number"><span class="hljs-number">13.350</span></span> <br> INFO: Done tasks: hz1: <span class="hljs-number"><span class="hljs-number">49257</span></span> hz2: <span class="hljs-number"><span class="hljs-number">50743</span></span> sec: <span class="hljs-number"><span class="hljs-number">52.837</span></span> <br> <br>             <span class="hljs-number"><span class="hljs-number">25</span></span>k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , <span class="hljs-number"><span class="hljs-number">50</span></span>     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test <span class="hljs-number"><span class="hljs-number">6</span></span> -  OOM <br> <br> Hazelcast        .       .       <span class="hljs-number"><span class="hljs-number">10.</span></span> <br> <br>           : <br> <br> <code class="java">WARNING: [<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>]:<span class="hljs-number"><span class="hljs-number">5701</span></span> [dev] [<span class="hljs-number"><span class="hljs-number">3.2</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>] While executing RunnableAdapter{task=Test6$RunnableTask@<span class="hljs-number"><span class="hljs-number">219307f</span></span>2} <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:<span class="hljs-number"><span class="hljs-number">98</span></span>)</code> <br> <br>  : <br> <br> <code class="java"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Runnable command</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!taskQ.offer(command)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RejectedExecutionException(<span class="hljs-string"><span class="hljs-string">"Executor["</span></span> + name + <span class="hljs-string"><span class="hljs-string">"] is overloaded!"</span></span>); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: <span class="hljs-number"><span class="hljs-number">100000</span></span> <span class="hljs-number"><span class="hljs-number">32604</span></span> sec: <span class="hljs-number"><span class="hljs-number">16.931</span></span> <br> INFO: Done tasks: hz1: <span class="hljs-number"><span class="hljs-number">26304</span></span> hz2: <span class="hljs-number"><span class="hljs-number">26281</span></span> sec: <span class="hljs-number"><span class="hljs-number">27.269</span></span> <br> <br>     . <br> <br> Test <span class="hljs-number"><span class="hljs-number">7</span></span> -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: <span class="hljs-number"><span class="hljs-number">100000</span></span> <span class="hljs-number"><span class="hljs-number">31790</span></span> sec: <span class="hljs-number"><span class="hljs-number">16.713</span></span> <br> INFO: Done tasks: hz1: <span class="hljs-number"><span class="hljs-number">25898</span></span> hz2: <span class="hljs-number"><span class="hljs-number">25873</span></span> sec: <span class="hljs-number"><span class="hljs-number">27.046</span></span> <br> INFO: Canceled tasks: <span class="hljs-number"><span class="hljs-number">0</span></span> execution exceptions: <span class="hljs-number"><span class="hljs-number">48229</span></span> rejected tasks: <span class="hljs-number"><span class="hljs-number">48229</span></span> <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           <span class="hljs-number"><span class="hljs-number">10</span></span>     <span class="hljs-number"><span class="hljs-number">99</span></span>;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> </pre> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> <pre> <code class="hljs cs"><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> final <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SYNC_FREQUENCY = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> final AtomicInteger consecutiveSubmits = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AtomicInteger(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sync) { Object response; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { response = future.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(); ... ... <span class="hljs-comment"><span class="hljs-comment">/** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkSync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { boolean sync = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> last = lastSubmitTime; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> now = Clock.currentTimeMillis(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (last + <span class="hljs-number"><span class="hljs-number">10</span></span> &lt; now) { consecutiveSubmits.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == <span class="hljs-number"><span class="hljs-number">0</span></span>) { sync = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } lastSubmitTime = now; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  <span class="hljs-number"><span class="hljs-number">100</span></span>      <span class="hljs-number"><span class="hljs-number">10</span></span> ,  hazelcast     (<span class="hljs-number"><span class="hljs-number">100</span></span> )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test <span class="hljs-number"><span class="hljs-number">5</span></span> -    <br> <br>               ,        <span class="hljs-number"><span class="hljs-number">4.</span></span>     ,      hazelcast  .      .     <span class="hljs-number"><span class="hljs-number">100</span></span>    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: <span class="hljs-number"><span class="hljs-number">100000</span></span> <span class="hljs-number"><span class="hljs-number">25223</span></span> sec: <span class="hljs-number"><span class="hljs-number">13.350</span></span> <br> INFO: Done tasks: hz1: <span class="hljs-number"><span class="hljs-number">49257</span></span> hz2: <span class="hljs-number"><span class="hljs-number">50743</span></span> sec: <span class="hljs-number"><span class="hljs-number">52.837</span></span> <br> <br>             <span class="hljs-number"><span class="hljs-number">25</span></span>k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , <span class="hljs-number"><span class="hljs-number">50</span></span>     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test <span class="hljs-number"><span class="hljs-number">6</span></span> -  OOM <br> <br> Hazelcast        .       .       <span class="hljs-number"><span class="hljs-number">10.</span></span> <br> <br>           : <br> <br> <code class="java">WARNING: [<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>]:<span class="hljs-number"><span class="hljs-number">5701</span></span> [dev] [<span class="hljs-number"><span class="hljs-number">3.2</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>] While executing RunnableAdapter{task=Test6$RunnableTask@<span class="hljs-number"><span class="hljs-number">219307f</span></span>2} <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:<span class="hljs-number"><span class="hljs-number">98</span></span>)</code> <br> <br>  : <br> <br> <code class="java"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Runnable command</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!taskQ.offer(command)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RejectedExecutionException(<span class="hljs-string"><span class="hljs-string">"Executor["</span></span> + name + <span class="hljs-string"><span class="hljs-string">"] is overloaded!"</span></span>); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: <span class="hljs-number"><span class="hljs-number">100000</span></span> <span class="hljs-number"><span class="hljs-number">32604</span></span> sec: <span class="hljs-number"><span class="hljs-number">16.931</span></span> <br> INFO: Done tasks: hz1: <span class="hljs-number"><span class="hljs-number">26304</span></span> hz2: <span class="hljs-number"><span class="hljs-number">26281</span></span> sec: <span class="hljs-number"><span class="hljs-number">27.269</span></span> <br> <br>     . <br> <br> Test <span class="hljs-number"><span class="hljs-number">7</span></span> -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: <span class="hljs-number"><span class="hljs-number">100000</span></span> <span class="hljs-number"><span class="hljs-number">31790</span></span> sec: <span class="hljs-number"><span class="hljs-number">16.713</span></span> <br> INFO: Done tasks: hz1: <span class="hljs-number"><span class="hljs-number">25898</span></span> hz2: <span class="hljs-number"><span class="hljs-number">25873</span></span> sec: <span class="hljs-number"><span class="hljs-number">27.046</span></span> <br> INFO: Canceled tasks: <span class="hljs-number"><span class="hljs-number">0</span></span> execution exceptions: <span class="hljs-number"><span class="hljs-number">48229</span></span> rejected tasks: <span class="hljs-number"><span class="hljs-number">48229</span></span> <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           <span class="hljs-number"><span class="hljs-number">10</span></span>     <span class="hljs-number"><span class="hljs-number">99</span></span>;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> </pre> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> <h5> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> </h5> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> <h5> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> </h5> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> <ul><li> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> </li> <li> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> </li> <li> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> </li> <li> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> </li> </ul> <code><code class="java">Future submitToKeyOwner.         . <br> <br>     (  ,  ): <br> <br> public static final int SYNC_FREQUENCY = 100; private final AtomicInteger consecutiveSubmits = new AtomicInteger(); private volatile long lastSubmitTime; ... ... boolean sync = !preventSync &amp;&amp; checkSync(); CallableTaskOperation op = new CallableTaskOperation(name, uuid, task); ICompletableFuture future = invoke(partitionId, op); if (sync) { Object response; try { response = future.get(); ... ... /** * This is a hack to prevent overloading the system with unprocessed tasks. Once backpressure is added, this can * be removed. */ private boolean checkSync() { boolean sync = false; long last = lastSubmitTime; long now = Clock.currentTimeMillis(); if (last + 10 &lt; now) { consecutiveSubmits.set(0); } else if (consecutiveSubmits.incrementAndGet() % SYNC_FREQUENCY == 0) { sync = true; } lastSubmitTime = now; return sync; }</code> <br> <br>   ,    <code>ExecutorService</code>  100      10 ,  hazelcast     (100 )     . <br> <br>          ,      .    , ..     ,         .    ,     .       ,       . <br> <br>   <br> <br> Test 5 -    <br> <br>               ,        4.     ,      hazelcast  .      .     100    . <br> <br>    hazelcast   .   . <br> <br> : <br> <br> INFO: 100000 25223 sec: 13.350 <br> INFO: Done tasks: hz1: 49257 hz2: 50743 sec: 52.837 <br> <br>             25k .  ,       ,  -   .          hazelcast (     )        ,       . <br> <br>      , 50     OOM <br> <br> <img src="https://raw.githubusercontent.com/romario13/hz-executor/master/img/oom.png" alt="oom"> <br> <br>    .     ,    .   -    . <br> <br> Test 6 -  OOM <br> <br> Hazelcast        .       .       10. <br> <br>           : <br> <br> <code class="java">WARNING: [10.0.0.3]:5701 [dev] [3.2.3] While executing RunnableAdapter{task=Test6$RunnableTask@219307f2} on Executor[exe] java.util.concurrent.RejectedExecutionException: Executor[exe] is overloaded! at com.hazelcast.util.executor.CachedExecutorServiceDelegate.execute(CachedExecutorServiceDelegate.java:98)</code> <br> <br>  : <br> <br> <code class="java"> public void execute(Runnable command) { if (!taskQ.offer(command)) { throw new RejectedExecutionException("Executor[" + name + "] is overloaded!"); } ...</code> <br> <br>    ,          -  .       ( <code>executeOnKeyOwner</code> ),           . <br> <br>    : <br> <br> INFO: 100000 32604 sec: 16.931 <br> INFO: Done tasks: hz1: 26304 hz2: 26281 sec: 27.269 <br> <br>     . <br> <br> Test 7 -    <br> <br>        -   ,   ,    ?     <code>executeOnKeyOwner</code>  Future <code>submitToKeyOwner</code>      <code>Callable</code>    . <br> <br>   : <br> <br> INFO: 100000 31790 sec: 16.713 <br> INFO: Done tasks: hz1: 25898 hz2: 25873 sec: 27.046 <br> INFO: Canceled tasks: 0 execution exceptions: 48229 rejected tasks: 48229 <br> <br>     .      . <br> <br>   <br> <br> hazelcast     ,           10     99;       ,    ;  ,              .        OOM;           .      ; <br> <br>     -      .    ,           .             .</code> </div><p>Source: <a href="https://habr.com/ru/post/229149/">https://habr.com/ru/post/229149/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229137/index.html">Designing an online store: substitutes, complements, comparisons and other tools to increase conversion</a></li>
<li><a href="../229139/index.html">Built-in Fujitsu remote server management portal based on iRMC controller</a></li>
<li><a href="../229141/index.html">Sound on the table and with you: a review of the Creative T30 Wireless and Airwave HD</a></li>
<li><a href="../229143/index.html">Chronicle of space super heavyweight. Part 1. Moon "dinosaurs"</a></li>
<li><a href="../229145/index.html">Nokia XTREME CODING Challenge: what should a developer do at a bird's eye height</a></li>
<li><a href="../229151/index.html">PFSense Package Writing: Controls</a></li>
<li><a href="../229157/index.html">TrulySecure: biometric user authentication for mobile devices</a></li>
<li><a href="../229161/index.html">Google Co-Founders on Industry Regulation and Innovation</a></li>
<li><a href="../229165/index.html">Armed robbers robbed Samsung plant for $ 6 million, stealing 40 thousand devices</a></li>
<li><a href="../229167/index.html">Automatic detection of the connection / disconnection of the second monitor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>