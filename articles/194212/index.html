<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What could be the schedule of the university</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Using the slow and inconvenient information resources on the network, you can curse their creators and lose time, or you can write a spider that will ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What could be the schedule of the university</h1><div class="post__text post__text-html js-mediator-article">  Using the slow and inconvenient information resources on the network, you can curse their creators and lose time, or you can write a spider that will collect and classify information as needed.  Already processed information will be available in any plane and with the response that is required.  This article is about one of these experiences.  With a practical example of parsing and improving the timetable of the NSU (Novosibirsk State University). <br><br>  I would like to note that it will not go about replacing one ugly table with a beautiful table with different properties, adding pictures and soft colors, all this is of course wonderful, but I am not an artist and when it comes to getting information I don‚Äôt see much difference between the styles of tables as long as it does not interfere with reading. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The idea was to simplify access to the schedule.  The original schedule, available on the NSU website, can be found <a href="http://nsu.ru/education/schedule/">here</a> .  In order to find my own schedule, I had to start my journey from the main page of the site, go to the ‚Äúold site‚Äù, then ‚Äúinformation systems‚Äù, then ‚Äúclass schedule‚Äù, select the building, department, group, total - 6 clicks.  Most of these transitions seemed to be quite meaningful, except for the choice of corps: it would seem, why choose corpus if the faculties are still different, and their total number is not so large as to be split into two pages (about 10 in total)?  But the situation became a little more difficult if it was necessary to find the schedule of a teacher or friend.  For the teacher it was necessary in the worst case to check both buildings, and for a friend it was necessary to find him first in the lists of groups, find out the group number, and then everything else.  The steps are quite doable, but you don‚Äôt always want to perform them, and nothing prevents you from gathering this information and making it possible to make such selections simply by typing in the line the name of the person whose schedule you want to learn - as in search engines to which everyone is already used. <br><br><h4>  Parsing lists </h4><br>  Let's start with the list of students: fortunately, it is available as xml, and for each group it looks like this: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0502, - ,  ()"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">student</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">status</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">student</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">status</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">student</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">status</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  In order to export such data, use the following code: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exportGroup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($groupFile, $groupName, $department, $course)</span></span></span><span class="hljs-function"> </span></span>{ $grouplist=file_get_contents($groupFile); $dom2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> domDocument; $dom2-&gt;loadXML($grouplist); $s2 = simplexml_import_dom($dom2); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($k=<span class="hljs-number"><span class="hljs-number">0</span></span>;$k&lt;count($s2-&gt;student);$k++) { $attrs=$s2-&gt;student[$k]-&gt;attributes(); $student=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Student(); $student-&gt;name=$attrs[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; $student-&gt;group=$groupName; $student-&gt;department=$department; $student-&gt;course=$course; $student-&gt;save(); } }</code> </pre><br><br>  In addition, you need to select lists of groups by faculty, but this is done in a similar way from similar xml files. <br><br><h4>  Correction to valid </h4><br>  The class schedule itself is not available in xml, in addition, the html generated by the NSU timetable system turned out to be invalid, which put me before a choice: convert it to a valid one or parse it with regular expressions.  I must say that somehow I really didn't want to resort to regexp.  Looking at the html files, I realized that not too much needed to be done in order for the documents to become valid, namely, add one &lt;tr&gt; tag (missing) and specify the encoding.  It turned out the following: <br><br><pre> <code class="php hljs">$text=file_get_contents($url); $text = iconv ( <span class="hljs-string"><span class="hljs-string">"CP1251"</span></span> , <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span> , $text ); $doc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DOMDocument(); $doc-&gt;loadHTML(str_replace(<span class="hljs-string"><span class="hljs-string">"&lt;/HEAD&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /&gt; &lt;/HEAD&gt;'</span></span>, str_replace(<span class="hljs-string"><span class="hljs-string">"&lt;TH Width=10%&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;TR&gt;&lt;TH Width=10%&gt;"</span></span>, $text))); $s = simplexml_import_dom($doc);</code> </pre><br><br>  After these manipulations, the schedule was dealt with in a remarkable way.  It should be noted that it was possible not to transcode to utf, but since all the other project data was in utf, and the encoding in these files was not specified - I preferred to do the conversion at this step. <br><br><h4>  Search </h4><br>  In this way, I got a schedule of groups and teachers, as well as lists of students. <br>  The schedule in the resulting structure refers to the group or teacher, but not to the student.  To search for students, teachers, groups and faculties required a complex query or a few queries to the database server.  Making such a request is not a problem, but I was afraid for its speed.  It was decided to make a separate table for the search ‚Äúsearchable‚Äù, which would contain in one column the aliases for which the search is performed, and in the other - the address of the document.  First of all - to optimize access time.  It also made it possible to process requests like ‚ÄúMathematician Vasily 1 course‚Äù, but at the same time allowed to have inconsistent database states, since the address of the document (url) is contained in several different tables.  The latter is not a plus, but the advantages in this case, I saw much more significant than this minus. <br><br><h4>  REST API </h4><br>  In order for others not to have the need to perform all this routine again, I published an open REST API, which seems to be used in two third-party projects.  The request to the API contains the search string and the type of the requested schedule: for the day, for the week and the closest pair.  The response contains a schedule in JSON format or the possible names and addresses of the respective schedules, when several schedules correspond to a given string. <br><br><h4>  Abbreviations </h4><br>  After publication, quite a few people said that the schedule uses incomprehensible abbreviations that are difficult to interpret (for example, ‚ÄúO. chemistry‚Äù is ‚ÄúFundamentals of General and Inorganic Chemistry‚Äù, and ‚ÄúSPTF‚Äù - ‚ÄúTheory of Complex Variable Functions‚Äù).  I have seen two ways to solve this problem: 1. Provide students with the opportunity to specify the full names themselves and 2. Try to decipher them in some way.  The first option was simple and fun, but controversial, because it was necessary to introduce a moderation system and the ability to look without decryption, because I myself could not determine how the correct name was provided, and finding experts from each department practically means asking several people to decipher these abbreviations.  I tried to find the possibility of automatic decryption, found lists of departments and teachers with subjects.  These lists were not complete, but I must say that the lists of students did not differ completely.  In addition, the names of teachers in the list of departments are given with the decoding of the name and patronymic, and in the schedule with initials, but this is not such a big problem.  The first idea was to find such teachers who teach only one subject and determine all the names from them (at the NSU, the majority combine teaching with another job and those who teach one discipline quite a lot), but this method unexpectedly failed and gave the wrong ones. results.  Perhaps the fact is that teachers with one subject were not often included in the department lists that I was able to get.  Then I tried to compare the number of matching letters, but it also turned out quite strange results.  The best was the method that establishes the correspondence between the abbreviated name and the full one only if this teacher has the only subject starting with this letter.  Thus managed to decipher most of the items. <br><br><h4>  By classroom </h4><br>  In addition, my hands were very much itchy to conduct a statistical study of the workload of audiences / teachers, and I got the idea that it is possible to display information from the current schedule: who and what audiences are now, how many people, how many male students, and how many female.  Of course, the last characteristic was invented just to make the project more fun, you could just bring all the names, but the problem was that the group numbers in the schedule did not always correspond well to the numbers in the student lists.  For example, there could be groups 123.1, 123.2, 123.3 in the schedule, and only 123 in the lists. Thus, one can say approximately how many people are in each group, but it is impossible to say exactly who is in which.  I used student names to determine gender.  I must say that the definition was as accurate as I can accurately distinguish a male name from a female one; this was not always possible, but in most cases it works fine.  Based on this information, an audience map was built, which is updated automatically every 10 minutes and displays the number of students, students, the number of places (the maximum number found in the schedule) and the numbers of groups that are currently in this audience.  It can be very useful if you are looking for an empty audience or have lost something and would like to interview everyone who could see it. <br>  Audiences were selected from the timetable, postfixes denoting the corpus were disassembled, and then displayed on the page so that a list of the following type was obtained: <br><br><img src="http://habrastorage.org/storage3/ca3/f4e/86d/ca3f4e86dfa8e2f273e2957ac3b6d80c.png"><br><br>  For each audience / corps a load chart is displayed for any day entered. <br><br><img src="http://habrastorage.org/storage3/19a/e92/c6c/19ae92c6c40e97366927cf72f9b957ac.png"><br><br>  This is the schedule for the main building of the NSU on Friday;  the service allows you to watch such for any audience or corpus on any school day (non-training schedule is empty).  Here Y is the number of people, time is the beginning of pairs.  Red column - students, blue - students, gray - amount.  The fractional scale on Y is striking, the fact is that I couldn‚Äôt manage to set up a graph drawing library to display only integers, but it seems to me that it‚Äôs not very important.  Yes, there is no fractional number of people, but the bars do not run into non-integer numbers. <br><br>  Before writing an article, I decided to see how everything works at Moscow State University and found a schedule, even a map of empty audiences, but it turned out that in order to obtain information, you need to be patient;  and the matter is not in the number of clicks, which are also abundant, but in a very slow response.  From periodically appearing SQL errors, it is possible to draw conclusions about the use of the DBMS, but apparently it‚Äôs somehow not very optimally arranged. <br><br><h4>  Statistics </h4><br>  Available data also provided some more global figures. <br><br>  The average audience load with a maximum capacity is 28% (the amount of students involved is divided by the total audience capacity, averaged by day and time) <br><br>  The average audience load in the NSU, if it is considered fully loaded, when at least one student is engaged - 60% <br><br>  The most female audience is 500, 431 and 608 - about 89% of girls <br><br>  The most male audience - 312, only 10% of girls <br><br>  The most female time is 14:15, 53% of girls <br><br>  The most masculine time is 19:20, 46.8% of girls <br><br>  The most feminine day is Tuesday, 52.3% of girls <br><br>  The most masculine day is Monday 49.2% of girls <br><br>  From this we can conclude that there are audiences in which there are practically only girls, but there is not any time or day when the number of girls in the university would prevail in a serious way. <br><br>  The statistics was obtained solely for entertainment purposes, I will be happy if this article inspires someone from the Internet users to other experiences in the field of systematization of open data or just to create a similar schedule for your university. <br><br><h4>  References: </h4><br>  original schedule <br>  <a href="http://www.nsu.ru/education/schedule/">www.nsu.ru/education/schedule</a> <br>  disassembled prototype <br>  <a href="http://nsu-schedule.ru/">nsu-schedule.ru</a> <br>  on-line audience map <br>  <a href="http://nsu-schedule.ru/now/">nsu-schedule.ru/now</a> <br>  mentioned schedule of MSU <br>  <a href="http://cacs.law.msu.ru/">cacs.law.msu.ru</a> </div><p>Source: <a href="https://habr.com/ru/post/194212/">https://habr.com/ru/post/194212/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194190/index.html">Participants' stories about the recent hack quest</a></li>
<li><a href="../194196/index.html">Why are cards the future of the web?</a></li>
<li><a href="../194206/index.html">New features of LifePay: everything for the convenience of customers</a></li>
<li><a href="../194208/index.html">3D Accounting</a></li>
<li><a href="../194210/index.html">Windows Server 2012 R2 from A. Kibkalo - Free webinars and unique courses</a></li>
<li><a href="../194214/index.html">Russian Code Cup 2013: tune in to hardworking!</a></li>
<li><a href="../194216/index.html">Cube U55GT - 7.9 "tablet with 3G and GPS</a></li>
<li><a href="../194218/index.html">Ramos i9 - 8.9-inch tablet with Full HD screen on the Intel Atom</a></li>
<li><a href="../194220/index.html">Huawei W1 - budget smartphone on Windows Phone 8</a></li>
<li><a href="../194226/index.html">Features of launching the Jelastic cloud platform on the Infobox</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>