<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple Wolfram Language http server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Preamble 



 Schematic diagram of the server 


 The idea of ‚Äã‚Äãwriting this article came to me after reading a similar article on Habrahabr, which te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple Wolfram Language http server</h1><div class="post__text post__text-html js-mediator-article"><h2 id="preambula">  Preamble </h2><br><p><img src="https://habrastorage.org/files/062/36a/561/06236a56163c46a5b15c192e33ee6824.jpg"><br>  <em>Schematic diagram of the server</em> </p><br><p>  The idea of ‚Äã‚Äãwriting this article came to me after reading a similar <a href="https://habrahabr.ru/post/262983/">article</a> on Habrahabr, which tells how to create your own localhost server using Mathematica.  The web server itself was written using Python and the extensible Tornado server.  He processed requests and sent responses in json format, and the logic was implemented in Mathematica.  At the same time, communication between Python and Mathematica occurred via the command line, and each request to the server restarted the Mathematics core.  The remaining details can be found in the article itself by the author <a href="https://habrahabr.ru/users/Nilis/">@Nilis</a> .  Here I would like to show you how to write simple code that will perform similar functions ‚Äî that is, create an http server to process requests and send responses.  Plus I would like to show some interesting features of Wolfram Language and its syntax. </p><a name="habracut"></a><br><h2 id="pustaya-realizaciya-servera">  Empty server implementation </h2><br><p>  The easiest way is to start the implementation with the main function, and then move deeper.  In order to write it, you need to load the SocketLink context by executing the following command: </p><br><pre><code class="hljs objectivec">Needs[<span class="hljs-string"><span class="hljs-string">"SocketLink`"</span></span>];</code> </pre> <br><p>  After that, the functions of this context become available.  You can see which functions it contains in the following way: </p><br><pre> <code class="hljs objectivec">Information[<span class="hljs-string"><span class="hljs-string">"SocketLink`*"</span></span>];</code> </pre> <br><table><thead><tr><th>  SocketLink` </th></tr></thead><tbody><tr><td>  CreateAsynchronousServer </td><td>  CreateServerSocket </td></tr><tr><td>  CreateClientSocket </td><td>  OpenSocketStreams </td></tr></tbody></table><br><p>  Let us explain what each of them represents: </p><br><ol><li>  <strong>CreateClientSocket [</strong> <em>port</em> <strong>]</strong> - creates a socket using the port - <em>port</em> ; </li><li>  <strong>CreateServerSocket [</strong> <em>host</em> , <em>port</em> <strong>]</strong> - creates a client socket connecting to the host - <em>host</em> and using the port - <em>port</em> ; </li><li>  <strong>OpenSocketStreams [</strong> <em>socket</em> <strong>]</strong> - opens a stream of input and output on the socket - <em>socket</em> ; </li><li>  <strong>CreateAsynchronousServer [</strong> <em>socket</em> , <em>handler</em> <strong>]</strong> - creates a "server" with the specified socket - <em>socket</em> and handler - <em>handler</em> . </li></ol><br><p>  In the simplest case, we need only two functions from this context: </p><br><p>  <strong>CreateAsynchronousServer</strong> and <strong>CreateServerSocket</strong> .  Of course at first glance it seems that everything is already ready and there is no point in " <em>writing</em> " the server.  But it is not.  <strong>CreateAsynchronousServer</strong> - can not do anything except listen to the specified socket.  So we have to implement everything else.  To begin with, it would be nice to create an auxiliary function that will have a restriction on the input arguments: </p><br><pre> <code class="hljs sql">MathematicaSimpleServer[socket_Socket, handler_Handler] := CreateAsynchronousServer[socket, <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>];</code> </pre> <br><p>  Explanation for non Mathematica users.  To the left of the " <strong>: =</strong> " sign ( <strong>SetDelayed []</strong> ) there is a template, which after execution will be stored in memory.  On the right is the rule that will be executed when the pattern is encountered.  Note <em>socket_Socket</em> indicates that the first argument must be a socket.  Template <em>handler_Handler</em> - says that the second argument must be of type <strong>Handler</strong> .  This type does not currently exist.  However, Mathematica does not pay attention to this and allows in any case to create a function that will take a non-existent type as one of the input parameters. </p><br><p>  If this type does not exist, then it must be created.  Let's do it.  The following code shows how Mathematica can create its own simple data type using <strong>TagSetDelayed []</strong> : </p><br><pre> <code class="hljs delphi"><span class="hljs-comment"><span class="hljs-comment">(* getters for Handler *)</span></span> Handler /: GetRequestParser[Handler[parser_RequestParser, _]] := parser; Handler /: GetResponseGenerator[Handler[_, generator_ResponseGenerator]] := generator; <span class="hljs-comment"><span class="hljs-comment">(* setters for Handler *)</span></span> Handler /: SetRequestParser[handler_Handler, parser_RequestParser] := Handler[handler, GetResponseGenerator[handler]]; Handler /: SetResponseGenerator[handler_Handler, generator_ResponseGenerator] := Handler[GetRequestParser[handler], generator];</code> </pre> <br><p>  Explanation of syntax for non-Mathematica users.  The symbol " <strong>/:</strong> " ( <strong>TagSetDelayed []</strong> ) means that only for the data type ( <strong>Handler</strong> ), which is on the left, the operation of the function, whose definition is entirely on the right, will be redefined.  The rule that will be executed when the function is called is normally to the right of the " <strong>: =</strong> " sign.  This method will also work for protected system functions.  Since in this case there is a change associated not with the name of the function itself, but with the name of the type.  Some peculiarity lies in the fact that inside the template between the characters " <strong>/:</strong> " and " <strong>: =</strong> " must be in an explicit form somewhere there is a type <strong>Handler</strong> (but not at the top level).  Again, it is worth noting that the four functions above have been defined using yet non-existing data types: <strong>RequestParser</strong> , <strong>ResponseGenerator</strong> .  Now the final touch in the handler definition is to create a template that will be executed when the handler is called inside the server.  He is obliged to accept as input a list of two elements ‚Äî input and output streams.  Actions with these streams can be performed almost any.  As mentioned above, the handler must read the input stream and write to the output stream.  We implement it as follows: </p><br><pre> <code class="hljs vbscript">handler_Handler[{input_InputStream, output_OutputStream}] := Module[{ requestParser = GetRequestParser[handler], responseGenerator = GetResponseGenerator[handler], <span class="hljs-built_in"><span class="hljs-built_in">request</span></span> = <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">response</span></span> = <span class="hljs-string"><span class="hljs-string">""</span></span> }, (* read data from input stream of the socket *) {<span class="hljs-built_in"><span class="hljs-built_in">request</span></span>} = <span class="hljs-keyword"><span class="hljs-keyword">If</span></span>[# != {}, FromCharacterCode[#], Print[DateString[], <span class="hljs-string"><span class="hljs-string">"\nERROR"</span></span>]; Close[input]; Close[output]; Return[]]&amp; @ Last[Reap[<span class="hljs-keyword"><span class="hljs-keyword">While</span></span>[<span class="hljs-literal"><span class="hljs-literal">True</span></span>, TimeConstrained[ Sow[BinaryRead[input]], <span class="hljs-number"><span class="hljs-number">0.01</span></span>, (Close[input]; Break[]) ];];]]; (* logging *) Print[DateString[], <span class="hljs-string"><span class="hljs-string">"\nREQUEST:\n\n"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">request</span></span>]; (* processing <span class="hljs-built_in"><span class="hljs-built_in">request</span></span> *) <span class="hljs-built_in"><span class="hljs-built_in">response</span></span> = responseGenerator[requestParser[<span class="hljs-built_in"><span class="hljs-built_in">request</span></span>]]; (* logging <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> writing data <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the output stream *) Switch[<span class="hljs-built_in"><span class="hljs-built_in">response</span></span>, _String, Print[DateString[], <span class="hljs-string"><span class="hljs-string">"\nRESPONSE:\n\n"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>]; BinaryWrite[output, ToCharacterCode[<span class="hljs-built_in"><span class="hljs-built_in">response</span></span>]], {__Integer}, Print[DateString[], <span class="hljs-string"><span class="hljs-string">"\nRESPONSE:\n\n"</span></span>, FromCharacterCode[<span class="hljs-built_in"><span class="hljs-built_in">response</span></span>]]; BinaryWrite[output, <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>]; ]; Close[output]; ];</code> </pre> <br><p>  Oddly enough - but for Mathematica it is not necessary to create any one unique name on the left side of the template.  This can be a complex expression with a header and internal content.  This way of creating function definitions is rarely used, but in our case it will be very useful.  The internal contents of the handler determine the entire server operation logic.  Now the empty server implementation is ready.  It will be working, but it will not do anything useful.  After all, all the processing of the request lies on non-existent functions: <strong>requestParser</strong> , <strong>responseGenerator</strong> .  In our case, a string is passed to their input, and the result must also be a string (or a list of bytes, which is hinted at by the second choice in the <strong>Swich []</strong> switch).  Although no one bothers to return anything after a request, only on the condition that this ‚Äú <em>anything</em> ‚Äù will be correctly processed by the function for creating answers. </p><br><h2 id="obrabotka-zaprosa">  Processing request </h2><br><p>  Now that the server is ready, you need to take care of the implementation of the <strong>RequestParser</strong> type.  It will be used first.  In the same way as was done above for <strong>Handler</strong> , we will create the simplest definition: </p><br><pre> <code class="hljs vbscript">requestParser_RequestParser[request_String] := <span class="hljs-built_in"><span class="hljs-built_in">request</span></span>;</code> </pre> <br><p>  According to this definition, the function will simply return the query string itself.  To begin with, that's enough.  Now everything is the same, but for the answer generator: </p><br><pre> <code class="hljs xml">responseGenerator_ResponseGenerator[parsed_String] := "HTTP/1.1 200 OK Content-Length: 1024 Connection: close <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content-Type</span></span></span><span class="hljs-tag">\" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">text</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">html</span></span></span><span class="hljs-tag">; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">utf-8\</span></span></span><span class="hljs-tag">" /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>MathematicaSimpleServer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> Hello from mathematica simple server! <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span>"</code> </pre> <br><p>  The definition of the generator is the simplest.  This is just the answer line connected to the html markup of the displayed page.  Now everything is ready!  You can try to start the server and check how it will work.  You can do this by running the following code: </p><br><pre> <code class="hljs sql">socket = CreateServerSocket[8888]; <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">Handler</span></span>[RequestParser[], ResponseGenerator[]]; server = MathematicaSimpleServer[socket, <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>];</code> </pre> <br><p>  Now open the browser and go to <a href="http://localhost:8888/">http: // localhost: 8888 /</a> .  The following page will be displayed in the browser: </p><br><p><img src="https://habrastorage.org/files/743/e8e/779/743e8e779bc54f33a59ef39bc065ca7b.jpg"></p><br><div class="spoiler">  <b class="spoiler_title">In this case, the request log is printed in the Messages window:</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">Thu <span class="hljs-number"><span class="hljs-number">19</span></span> Jan <span class="hljs-number"><span class="hljs-number">2017</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> REQUEST: <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> / HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> Accept: <span class="hljs-type"><span class="hljs-type">text</span></span>/html, application/xhtml+<span class="hljs-type"><span class="hljs-type">xml</span></span>, image/jxr, *<span class="hljs-comment"><span class="hljs-comment">/* Accept-Language: ru-RU User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.79 Safari/537.36 Edge/14.14393 Accept-Encoding: gzip, deflate Host: localhost:8888 Connection: Keep-Alive</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">And the response log:</b> <div class="spoiler_text"><pre> <code class="hljs xml">Wed 18 Jan 2017 14:56:45 RESPONSE: HTTP/1.1 200 OK Content-Length: 1024 Connection: close <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>MathematicaSimpleServer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> Hello from mathematica simple server! <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><p>  Hooray!  Our server still works.  I wonder what will happen if we do not stop it and try to change the code of the displayed html page, which is returned during the call to <strong>ResponseGenerator []</strong> ?  Let's do it - just define the function again: </p><br><pre> <code class="hljs xml">responseGenerator_ResponseGenerator[parsed_String] := ("HTTP/1.1 200 OK Content-Type: text/html; charset=utf-8 Content-Length: " <span class="hljs-tag"><span class="hljs-tag">&lt;&gt;</span></span> ToString[StringLength[#]] <span class="hljs-tag"><span class="hljs-tag">&lt;&gt;</span></span> " Connection: close " <span class="hljs-tag"><span class="hljs-tag">&lt;&gt;</span></span> #)&amp; @ "<span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content-Type</span></span></span><span class="hljs-tag">\" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">text</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">html</span></span></span><span class="hljs-tag">; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">utf-8\</span></span></span><span class="hljs-tag">" /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>MathematicaSimpleServer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> Hello from mathematica simple server! <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span> we changed the server logic without stopping ;) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span>"</code> </pre> <br><p><img src="https://habrastorage.org/files/d8c/5c1/b85/d8c5c1b854134e43b8d49b3b4beaf00d.jpg"></p><br><p>  After executing the code above and refreshing the page, the modified content is displayed in the browser.  It turns out that you can not stop the web server and continue to add new definitions for the <strong>ResponseGenerator</strong> and <strong>RequestParser</strong> .  Nevertheless, it is useful to know how to stop it.  It is enough to execute the code: </p><br><pre> <code class="hljs perl">SocketLink<span class="hljs-string"><span class="hljs-string">`Sockets`</span></span>CloseSocket[<span class="hljs-keyword"><span class="hljs-keyword">socket</span></span>]; StopAsynchronousTask[server];</code> </pre> <br><h2 id="rasshirenie-vozmozhnostey-servera">  Server Expansion </h2><br><p>  A little preparation.  To avoid any further problems, we will immediately set up as the working directory for the location of this document: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">SetDirectory</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[NotebookDirectory[]</span></span>];</code> </pre> <br><p>  Obviously, displaying two lines in a browser window is not a good demonstration of Mathematica's capabilities.  For the sake of test purposes, we will create a simple html <strong>index</strong> page.  The page code is shown below.  There are already several links to other addresses that the server should return.  Also added a function that creates the answer itself entirely. </p><br><pre> <code class="hljs markdown">IndexPage[<span class="hljs-string"></span><span class="hljs-string"></span>] := "<span class="xml"><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">\</span></span></span></span><span class="xml"><span class="hljs-tag">"</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Content-Type</span></span></span></span><span class="xml"><span class="hljs-tag">\" </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">\</span></span></span></span><span class="xml"><span class="hljs-tag">"</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">text</span></span></span></span><span class="xml"><span class="hljs-tag">/</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">html</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">utf-8\</span></span></span></span><span class="xml"><span class="hljs-tag">" /&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>MathematicaSimpleServer<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">\</span></span></span></span><span class="xml"><span class="hljs-tag">"</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">icon</span></span></span></span><span class="xml"><span class="hljs-tag">\" </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">\</span></span></span></span><span class="xml"><span class="hljs-tag">"</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">image</span></span></span></span><span class="xml"><span class="hljs-tag">/</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">png</span></span></span></span><span class="xml"><span class="hljs-tag">\" </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">\</span></span></span></span><span class="xml"><span class="hljs-tag">"/</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">favicon.png</span></span></span></span><span class="xml"><span class="hljs-tag">\"/&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> Index page for the mathematica simple server <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">\</span></span></span></span><span class="xml"><span class="hljs-tag">"/</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">graphic</span></span></span></span><span class="xml"><span class="hljs-tag">?</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Sin</span></span></span></span><span class="xml"><span class="hljs-tag">\" &gt;</span></span></span></span>graphic<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">\</span></span></span></span><span class="xml"><span class="hljs-tag">"/</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">page.html</span></span></span></span><span class="xml"><span class="hljs-tag">\" &gt;</span></span></span></span>page<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">\</span></span></span></span><span class="xml"><span class="hljs-tag">"</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">notebook.nb</span></span></span></span><span class="xml"><span class="hljs-tag">\" &gt;</span></span></span></span>notebook<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>"; ResponseString[<span class="hljs-string"><span class="hljs-string">page_String</span></span>] := StringTemplate[<span class="hljs-string"><span class="hljs-string">"HTTP/1.1 200 OK Content-Type: text/html; charset=utf-8 Content-Length: `length` Connection: close `page`"</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">&lt;|"length" -&gt; StringLength[page</span></span>], "page" -&gt; page|&gt;]; ResponseString[<span class="hljs-string"><span class="hljs-string">page_String, length_Integer</span></span>] := StringTemplate[<span class="hljs-string"><span class="hljs-string">"HTTP/1.1 200 OK Content-Type: text/html; charset=utf-8 Content-Length: `length` Connection: close `page`"</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">&lt;|"length" -&gt; length, "page" -&gt; page|&gt;</span></span>];</code> </pre> <br><p>  The function that connects the response string and the page markup code - <strong>ResponseString []</strong> - has two definitions: the first one calculates the page size and replaces the value of the <strong>Content-Length</strong> header with the result.  In the second definition, you can specify the size of the response body.  As mentioned above, there are several links on the main page.  It is assumed that the links lead to one of the addresses where some server logic is executed.  A total of four different cases are the display of the main page itself, a link to an arbitrary graph, to the html page and to the page formed from the finished Mathematics notebook.  Each of the cases must be considered separately.  The first case, loading the main page.  It is executed only if a GET request has been received at the address "/" or "/ index".  How to check this address?  You can do it in various ways.  The following is not the most popular, but interesting.  First, override the <strong>Keys</strong> and <strong>Part</strong> functions on the <strong>RequestParser</strong> data type as follows: </p><br><pre> <code class="hljs lua">RequestParser /: Keys[RequestParser[rules___Rule]] := {rules}<span class="hljs-string"><span class="hljs-string">[[All, 1]]</span></span>; RequestParser /: Part[RequestParser[___, <span class="hljs-string"><span class="hljs-string">"Address"</span></span> -&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_Symbol|_Function)</span></span></span></span>, ___], <span class="hljs-string"><span class="hljs-string">"Address"</span></span>] := <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">;</span></span></code> </pre> <br><p>  It is worth explaining the syntax of the expressions above.  <em>rules___Rule</em> - is a template with an arbitrary (including zero) number of replacement rules.  This means that <strong>RequestParser</strong> can be created using any number of processing functions, and all the names of these functions can be obtained simply by using the Keys function.  Interestingly, Keys is a system function with a <strong>Protected</strong> attribute, which prohibits changing this function, but specifying a type using <strong>TagSetDelayed</strong> allows it.  Similarly, the built-in <strong>Part</strong> function was overridden.  As mentioned above, it is assumed that <strong>RequestParser</strong> is a complex expression that must contain a set of rules within itself.  Each rule is a key and a value (a function to process).  Why is all this needed?  Writing a large number of conditions and checking the query string is hard enough.  It is all the more easy to make a mistake in the order of definitions, since if it is bad to choose a regular expression or pattern for checking the request, then some sections of the code will be unattainable.  It is much easier to process a single request with several functions at once and return the result as an association with pairs: the name of the function and the result.  Below is the implementation of this method: </p><br><pre> <code class="hljs lua">requestParser_RequestParser[request_String] /; MatchQ[requestParser, RequestParser[_String -&gt; (_Symbol|_Function)]] := Association[Map[Function[key, key -&gt; (requestParser<span class="hljs-string"><span class="hljs-string">[[key]]</span></span>)[request]], Keys[requestParser]]];</code> </pre> <br><p>  Now you need to create those same functions.  We will have only one such function to get the address from the request method, because the author‚Äôs fantasy has managed to fit all the variability of the server‚Äôs work only into the difference of addresses in the first query line. </p><br><pre> <code class="hljs markdown">TakeAddress[<span class="hljs-string"><span class="hljs-string">request_String</span></span>] := First[<span class="hljs-string"><span class="hljs-string">StringCases["GET " ~~ address___ ~~ " HTTP/" -&gt; address</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">request</span></span>]];</code> </pre> <br><p>  For those who are not familiar with Mathematica, there are many interesting constructs for string expressions in the language.  The construction above is intuitive, it simply selects all the text that is between GET and HTTP in the first line.  In a previous server implementation, the response generator processed the string that the request handler returned.  But now the input from the key-value pairs will be passed to the input of this function.  So it is necessary for the generator to create a new definition that can convert the resulting association into an answer. </p><br><pre> <code class="hljs lua">responseGenerator_ResponseGenerator[parsed_Association] /; parsed<span class="hljs-string"><span class="hljs-string">[["Address"]]</span></span> == <span class="hljs-string"><span class="hljs-string">"/"</span></span> || parsed<span class="hljs-string"><span class="hljs-string">[["Address"]]</span></span> == <span class="hljs-string"><span class="hljs-string">"/index"</span></span> := ResponseString[IndexPage[]];</code> </pre> <br><p>  Restart the server with a new handler.  Now inside <strong>RequestParser</strong> there is an explicit indication of the name of the function - "Address" - and the function itself - <strong>TakeAddress</strong> - with which all answers are processed. </p><br><pre> <code class="hljs sql">socket = CreateServerSocket[8888]; <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">Handler</span></span>[RequestParser[<span class="hljs-string"><span class="hljs-string">"Address"</span></span> -&gt; TakeAddress], ResponseGenerator[]]; server = MathematicaSimpleServer[socket, <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>];</code> </pre> <br><p><img src="https://habrastorage.org/files/511/e96/5b9/511e965b9476479c901a076240925eea.jpg"></p><br><p>  Home page is working.  Add the correct processing of requests to other resources.  The first of these is an attempt to obtain a graph of the specified function.  First we add the definition to the response generator.  Another great feature of Mathematica.  You can redefine a function not only by specifying other types of arguments or another number of them.  You can also set an arbitrary complex condition for executing a function using the " <strong>/;</strong> " ( <strong>Condition []</strong> ) sign.  The condition is most conveniently written between the template itself (name and function arguments / signature) after the " <strong>/;</strong> " sign and before the " <strong>: =</strong> " sign. </p><br><pre> <code class="hljs markdown">responseGenerator<span class="hljs-emphasis"><span class="hljs-emphasis">_ResponseGenerator[parsed_</span></span>Association] /; StringMatchQ[<span class="hljs-string"><span class="hljs-string">parsed[["Address"</span></span>]], "/graphic?" ~~ <span class="hljs-emphasis"><span class="hljs-emphasis">___</span></span>] := Module[<span class="hljs-string"><span class="hljs-string">{function = ToExpression[StringSplit[parsed[["Address"</span></span>]], "?"][[-1]]]}, ResponseString[ExportString[Plot[function[x], {x, -5, 5}], "SVG"]] ];</code> </pre> <br><p>  You can check how it will work - go to the first link on the page <a href="http://localhost:8888/index">http: // localhost: 8888 / index</a> or simply at <a href="http://localhost:8888/graphic%3FSin">http: // localhost: 8888 / graphic? Sin</a> .  Now it shows the following: </p><br><p><img src="https://habrastorage.org/files/0ec/a86/3de/0eca863de0444e41bef30abc2f3ae689.jpg"></p><br><p>  If instead of ../graphic?Sin you write ../graphic?Cos or even Log / Exp / Sqrt / Function [x, x ^ 3] / t.d., the corresponding graph will be displayed on the page.  Now let's add to the handler the ability to display an arbitrary html page that is located in the working directory or in one of the subdirectories.  To begin, create this page using the code: </p><br><pre> <code class="hljs matlab">Export[<span class="hljs-string"><span class="hljs-string">"page.html"</span></span>, TableForm[Table[{ToString[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] &lt;&gt; <span class="hljs-string"><span class="hljs-string">"!"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>!}, {<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>}]], <span class="hljs-string"><span class="hljs-string">"HTML"</span></span>];</code> </pre> <br><p>  Unfortunately, anyone who executes the code from the line above will immediately notice that exporting Mathematica expressions to html takes a lot of time.  It turns out that for Mathematics it will not be difficult to create many pages or other elements (pictures / tables), but the export of all this data will take much more time each time than the creation by standard means.  Well.  We will assume that all pages already exist and are located on the disk in the working directory of the server - where we just saved the test page.  Now let's try to display it.  In this case, the page and any of its elements are imported as a list of bytes and are connected to the list of bytes that correspond to the line with the response headers. </p><br><pre> <code class="hljs lua">responseGenerator_ResponseGenerator[parsed_Association] /; FileExistsQ[FileNameJoin[{Directory[], parsed<span class="hljs-string"><span class="hljs-string">[["Address"]]</span></span>}]] &amp;&amp; StringTake[parsed<span class="hljs-string"><span class="hljs-string">[["Address"]]</span></span>, <span class="hljs-number"><span class="hljs-number">-3</span></span>] != <span class="hljs-string"><span class="hljs-string">".nb"</span></span> := Module[{<span class="hljs-built_in"><span class="hljs-built_in">path</span></span> = FileNameJoin[{Directory[], parsed<span class="hljs-string"><span class="hljs-string">[["Address"]]</span></span>}], data}, data = Import[<span class="hljs-built_in"><span class="hljs-built_in">path</span></span>, <span class="hljs-string"><span class="hljs-string">"Byte"</span></span>]; Join[ToCharacterCode[ResponseString[<span class="hljs-string"><span class="hljs-string">""</span></span>, Length[data]]], data] ];</code> </pre> <br><p><img src="https://habrastorage.org/files/850/045/ae0/850045ae049b4c7a9d5a558f1f2e5fa3.jpg"></p><br><p>  As expected, the server returned a table of factorial integers to the browser.  The last case.  Display in your browser a saved notepad.  In the working directory, create a new notebook notebook.nb with the code: </p><br><pre> <code class="hljs perl">notebook = CreateDocument[{TextCell[<span class="hljs-string"><span class="hljs-string">"Bubble sort"</span></span>,<span class="hljs-string"><span class="hljs-string">"Section"</span></span>], ExpressionCell[Defer[list = RandomInteger[{<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>}, <span class="hljs-number"><span class="hljs-number">20</span></span>]], <span class="hljs-string"><span class="hljs-string">"Input"</span></span>], ExpressionCell[Defer[list //. {firsts__<span class="hljs-number"><span class="hljs-number">_</span></span>, prev<span class="hljs-number"><span class="hljs-number">_</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">next</span></span><span class="hljs-number"><span class="hljs-number">_</span></span>, lasts__<span class="hljs-number"><span class="hljs-number">_</span></span>} :&gt; {firsts, <span class="hljs-keyword"><span class="hljs-keyword">next</span></span>, prev, lasts} /; <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> &lt; prev], <span class="hljs-string"><span class="hljs-string">"Input"</span></span>] }]; NotebookEvaluate[notebook, InsertResults -&gt; True]; NotebookSave[notebook, FileNameJoin[{Directory[], <span class="hljs-string"><span class="hljs-string">"notebook.nb"</span></span>}]] NotebookClose[notebook];</code> </pre> <br><p>  Now we perform actions similar to those that occurred when html-page was requested.  But before returning the html code, the notepad is first converted to html. </p><br><pre> <code class="hljs lua">responseGenerator_ResponseGenerator[parsed_Association] /; FileExistsQ[FileNameJoin[{Directory[], parsed<span class="hljs-string"><span class="hljs-string">[["Address"]]</span></span>}]] &amp;&amp; StringTake[parsed<span class="hljs-string"><span class="hljs-string">[["Address"]]</span></span>, <span class="hljs-number"><span class="hljs-number">-3</span></span>] == <span class="hljs-string"><span class="hljs-string">".nb"</span></span> := Module[{<span class="hljs-built_in"><span class="hljs-built_in">path</span></span>, data, notebook}, <span class="hljs-built_in"><span class="hljs-built_in">path</span></span> = FileNameJoin[{Directory[], parsed<span class="hljs-string"><span class="hljs-string">[["Address"]]</span></span>}]; notebook = Import[<span class="hljs-built_in"><span class="hljs-built_in">path</span></span>, <span class="hljs-string"><span class="hljs-string">"NB"</span></span>]; Export[<span class="hljs-built_in"><span class="hljs-built_in">path</span></span> &lt;&gt; <span class="hljs-string"><span class="hljs-string">".html"</span></span>, notebook, <span class="hljs-string"><span class="hljs-string">"HTML"</span></span>]; data = Import[<span class="hljs-built_in"><span class="hljs-built_in">path</span></span> &lt;&gt; <span class="hljs-string"><span class="hljs-string">".html"</span></span>, <span class="hljs-string"><span class="hljs-string">"Byte"</span></span>]; Join[ToCharacterCode[ResponseString[<span class="hljs-string"><span class="hljs-string">""</span></span>, Length[data]]], data] ];</code> </pre> <br><p><img src="https://habrastorage.org/files/af6/e56/d9a/af6e56d9a6f34463ad30db076ac7ff80.jpg"></p><br><p>  The exact display of the notebook in the browser of course will not.  It all depends on the way Math exports the notepad to html.  Also for our server, it would be worthwhile to add an error page that will be displayed to the user in the absence of a resource. </p><br><pre> <code class="hljs lua">responseGenerator_ResponseGenerator[parsed_Association] /; !FileExistsQ[FileNameJoin[{Directory[], parsed<span class="hljs-string"><span class="hljs-string">[["Address"]]</span></span>}]] := Join[ToCharacterCode[StringReplace[ResponseString[<span class="hljs-string"><span class="hljs-string">"Page not found"</span></span>], <span class="hljs-string"><span class="hljs-string">"200 OK"</span></span> -&gt; <span class="hljs-string"><span class="hljs-string">"404 !OK"</span></span>]]];</code> </pre> <br><p>  Obviously, the web server implementation shown in this article is not even close.  Moreover, it has major drawbacks.  As an example, you can give at least the fact that the server is able to return only two codes: 200 and 404. Therefore, the presented code is best viewed as experimental / demonstrative. </p><br><h2 id="yuridicheskiy-aspekt">  Legal aspect </h2><br><p>  As it became known to the author, the standard license for Wolfram Mathematica does not allow the use of the Mathematics core inside server applications for both commercial and personal purposes.  This restriction does not apply to scheduled tasks that should not be associated with the web.  Wolfram Research has its own very good platform for implementing large (and not so) server applications - this is webMathematica.  It is the license for webMathematica that makes it possible to avoid problems with the law and use Wolfram Language on the server, and it does not matter if the application is developed on it (webMathematica) or not, you still have to purchase a license.  The author is of the opinion that his code does not violate any license agreements, because here it shows just the text of the program that allows the Mathematica built-in tools to run a web server on localhost.  After all, a detective story in which a crime is described is not in itself a crime. </p><br><h2 id="vyvod">  Conclusion </h2><br><p>  In this article I wanted to demonstrate first of all the interesting syntactic features of Wolfram Language.  Various ways of creating functions, rules and conditions when solving a specific task in a non-standard way.  I also hope that this guide will allow enthusiasts to practice web development by combining this with learning Mathematica and its capabilities.  In turn, I expect all sorts of tips to improve the code, possible ideas for the implementation of this task, as well as criticism and comments.  Download the notebook containing this work at the following <a href="https://github.com/KirillBelovTest/MathematicaSimpleServer">link</a> .  Thank you all for your attention! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/320196/">https://habr.com/ru/post/320196/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320186/index.html">Selection of useful slides from Julia Evans</a></li>
<li><a href="../320188/index.html">Hey, tv, are you the smartest?</a></li>
<li><a href="../320190/index.html">Virtual Client Computing in 2017: Tools and Tips for Successful Implementation</a></li>
<li><a href="../320192/index.html">Spotify: Google Cloud event subsystem migration (part 2)</a></li>
<li><a href="../320194/index.html">3 days left before the conference ‚ÄúRegulation of cryptocurrency in Russia: interim results‚Äù</a></li>
<li><a href="../320198/index.html">Welcome to Moscow CocoaHeads January 27</a></li>
<li><a href="../320200/index.html">Pygest # 1. Releases, articles, interesting projects from the world of Python [January 01, 2017 - January 15, 2017]</a></li>
<li><a href="../320202/index.html">Wikimart and the ‚Äútheory of the big fool‚Äù in e-commerce</a></li>
<li><a href="../320204/index.html">GearVR tracking system or electronics production in Russia</a></li>
<li><a href="../320206/index.html">On the fabulous Bali snow fell or how easy it is to deceive the GPS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>