<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hacking on board the aircraft</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="During the 5 years that I have been working at IOActive, I have been able to visit many interesting places thousands of kilometers from home. Therefor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hacking on board the aircraft</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e2f/4d3/d7b/e2f4d3d7b9ed152d793c997a66800481.png"></div><br>  During the 5 years that I have been working at IOActive, I have been able to visit many interesting places thousands of kilometers from home.  Therefore, flight for me has become commonplace.  You might think that this is nothing special, but not for me, as a person who is afraid to fly.  Not to say that I managed to get rid of this phobia;  after a dozen flights, my palms are still sweating on takeoff, but I have come to terms with it, even, one might say, I sometimes like to fly ... and hack the systems right from the side. <br><a name="habracut"></a><br>  To overcome the fear I was helped to study the functionality of the aircraft and getting used to the noise, jumps and turbulence.  This article will explain how the onboard systems work, in particular, about the On-Board Entertainment and Information System (BRIS) developed by Panasonic Avionics. <br><br>  Two years ago, while I was flying from Warsaw to Dubai, I decided to play a little with BRIS.  And when I clicked to a certain place in one of the upper corners of the screen, I saw the following debugger details: <br><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">----</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Interactive</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ek_seatappbase_1280x768_01</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.01</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.18</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.01</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.cram</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Content</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ek_seatappcontent_1280x768</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.01</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.01</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.01</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.cram</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Engine</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">qtengine_01</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.01</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.squash</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">LRU</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Type</span></span>: 196 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span>: 172<span class="hljs-selector-class"><span class="hljs-selector-class">.17</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.148</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.48</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Media</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Player</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Auto</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Popup</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Enabled</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">false</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-----</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2fe/250/791/2fe250791452d8bfd97f23e51f92376f.png"></div><br>  After arriving in Dubai and searching for keywords on Google, I found in the open access hundreds of firmware for various airlines. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/37d/5c9/73b/37d5c973b49d06c4656a67a5110655a5.png"></div><br>  Obviously, the firmware is actively updated, so you can get access to the current one, which is installed on board.  To date, the files are still there, but access to the list of directories is closed. <br><br>  Below is a list of airlines for which I managed to find the firmware: <br><br><ul><li>  Emirates <br></li><li>  Airfrance <br></li><li>  Aerolineas argentinas <br></li><li>  United <br></li><li>  Virgin <br></li><li>  Singapore <br></li><li>  Finnair <br></li><li>  Iberia <br></li><li>  Etihad <br></li><li>  Qatar <br></li><li>  Klm <br></li><li>  American airlines <br></li><li>  Scandinavian <br></li></ul><br>  The basic architecture of BRIS is as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/335/85b/0ae/33585b0ae51e592357d765ba7ae24273.png"></div><br><br><h1>  System Control Unit (BEAD) </h1><br>  This is a certified onboard server.  Passengers, as a rule, can monitor in real time the current flight parameters, such as wind speed, latitude, longitude, altitude and temperature overboard.  The BEADS receives all this information via the avionics bus (usually ARINC 429) and then the Informational Terminals Terminals (ITCs) can access it via Ethernet. <br><br><h1>  Information Terminal Chairs (ITK) </h1><br>  This is a removable line unit and through it passengers have access to passive and active BRIS functionality, such as watching movies, buying goods, reading articles or accessing the Internet.  Simply put, it is a built-in touch screen device.  Newer models use Android, while outdated ones are mostly Linux. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/45c/c0a/848/45cc0a8489046d693841d2993f947f16.png"></div><br>  <i>Removing ITK - this is Rave AIX, not a model from Panasonic Avionics ( <a href="">source</a> )</i> <br><br><h1>  Personal Control Device (PUU) </h1><br>  This is an optional device.  With the help of PUU, ITC can be managed and, as will be shown below, it can also work as a credit card terminal. <br><br><h1>  Panel for flight attendants </h1><br>  Flight attendants and other crew members can use this panel to control aircraft functions such as lights, drives (including beds), passenger announcements, onboard purchases, or a personnel call system.  Cabin Management System [Cabin Management System] is usually integrated with BRIS.  Panasonic Avionics does this with Global Communications Services [Global Communications Services], providing general functionality for simple cockpit operations (see <a href="https://www.panasonic.aero/inflight-systems/cabin-systems/">here</a> ).  CrewApp crew app is available from the flight attendant panel. <br><br><h1>  Panasonic BRIS </h1><br>  Panasonic BRISS: outdated 3000 / 3000i and new XSeries eFX, eX2 and eX3 (on Android).  The hardware component can vary, but in architecture they are similar and they have common characteristics. <br><br>  More information on Panasonic's BRIS can be found on <a href="https://www.panasonic.aero/">their website</a> . <br><br>  These systems can be customized, which allows the airlines to install BRIS in accordance with the policies of the airline, while the code base is almost the same. <br><br>  After analyzing the firmware, I was not quite able to find out how to download data on the ground.  Typically, the content is updated via Wi-Fi ad-hoc-network, or through a high-speed mobile connection as soon as the plane lands.  Panasonic's BRIS is mainly updated via <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BB%25D0%25BE%25D0%25BF%25D0%25BF%25D0%25B8%25D0%25BD%25D0%25B5%25D1%2582">Floppinet</a> .  Communication with satellites or mobile networks in flight is available, but in most cases, BRIS works autonomously, with preloaded content.  Normally, BRIS does not even check credit cards in real time. <br><br>  Panasonic Avionics BRIS follows a client-server architecture with three main components: <br><br><ul><li>  CrewApp <br></li><li>  Seatapp <br></li><li>  Backend <br></li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f07/708/81a/f0770881a132debb104fa92c97fde43a.png"></div><br>  I found several versions of CrewApp and SeatApp on the above page.  When I was googling keywords, I also managed to find a backend in open access on different .aero sites.  Despite the fact that they have brand and unique data from the airlines, the code base in them is from the Panasonic backend. <br><br>  It is impossible to cover all the options for BRIS in one article, as the airlines expand and adapt the framework, therefore, we‚Äôll discuss further specific functions. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/662/734/620/66273462041c495282466c747f12d765.png"></div><br>  <i>Reboot SeatApp on Linux</i> <br><br>  The firmware files (in this case, the program that runs on the device is not supported by the user), which I analyzed did not contain the entire system, but only the parts that need to be updated.  It's sad because  We could find out more information about the operation of these devices, but still some interesting points can be clarified using the available files. <br><br><h1>  Scripts </h1><br>  Panasonic Avionics has developed its declarative scripting programming language to interact with the user interface and main application functions.  It supports dozens of teams and has good functionality. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/129/d85/c20/129d85c20a650f383e2e67e4dd9dea88.png"></div><br>  <i>Sample code core / startup.txt</i> <br><br>  Reverse engineering of the main binary file (airsurf) will let you know how the parser of such scripts works.  To demonstrate, let's look at <b>#define</b> . <br><br>  The script is processed line by line and when the parser sees the <b>#define</b> construction, it tries to parse it in <b>sub_80C2690</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c8e/bd5/5df/c8ebd55dfb9594f439f8badda8c4d937.png"></div><br>  In this function, 5 types can be defined: flash, text, draw, timer, and value. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/930/d12/e74/930d12e744add120203b533256aeb22c.png"></div><br>  The first line of the script contains <b>#define</b> with the value [value], let's see how it is processed. <br><br>  First of all, the string is parsed and the name of define is extracted.  Then the parser checks whether the number (below the blue block) is the value that is after (below the green block). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7da/b6f/ca2/7dab6fca24a1f07bfe4d5979e0dedbf9.png"></div><br>  If the value is not a number, then it is compared with various variables and if a match is found, it is replaced with its value. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa3/299/bd9/fa3299bd97a37562eec44f1cca11e6a1.png"></div><br>  If the value is a number, then the name / value pair is added to the global array define (the blue block below) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/562/d16/f25/562d16f259fc768846e641122818333c.png"></div><br>  For the <b>cmd</b> command, the binary calls the desired function from the <b>cmd</b> table and passes the arguments. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ef5/287/9de/ef52879de0d32a699a9ce262e017cca8.png"></div><br>  Here you can find some interesting features, for example, the one that reads information about a credit card after it is activated in the terminal. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/787/ce7/8e4/787ce78e4a1cf2a37563afe6e23c7069.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b69/5ea/2a9/b695ea2a91f2ddf271ec2ad5321b086e.png"></div><br>  The data received from the card reader (/ dev / ccr) is parsed, printed and checked. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/026/6ec/afc/0266ecafc9ede5a9e5c8bf7c541bd391.png"></div><br>  You can also find regular files, such as shell scripts, configuration files (containing embedded credentials), databases, resources and libraries. <br><br>  In one of the tweets where the reboot of the Panasonic BRIS was removed from Panasonic, I saw the following information.  SeatAppBase application files are the same as we are considering. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cd3/90a/bc7/cd390abc7dc29e2e198f932c67c14e4c.png"></div><br>  <i>loadlru.h</i> <br><br>  In the new versions of BRIS X, Panasonic switched to Android and, accordingly, the old .txt scripts are replaced with the approach using QT QML: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be4/862/8f9/be48628f960c3e9bb8b9cdb25a916ff1.png"></div><br>  PHP is used in backend.  At a glance, vulnerabilities are visible. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f08/6db/176/f086db176ff76e85502346b94021530d.png"></div><br>  The image above refers to the chat functionality between the seats, where passengers can send messages to each other.  You will not be hard to guess what is wrong here, and this is not the only problem. <br><br>  The following videos demonstrate exploitation of vulnerabilities, but without causing damage. <br><br><ol><li><div class="spoiler">  <b class="spoiler_title">Bypass credit card verification</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/D8NM8YlhyIc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br></li><li><div class="spoiler">  <b class="spoiler_title">File access (for example / dev / random)</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/jEsQsGf0Qek" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br></li><li><div class="spoiler">  <b class="spoiler_title">SQL injection</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/dqji2JSg_tw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br></li></ol><br><h1>  Potential threats </h1><br>  So how far can an attacker use such vulnerabilities in BRIS?  There is no definitive answer to this question, but we will try to consider some general cases that are not specific to a particular system manufacturer, but we will do this by considering more aspects of the system‚Äôs operation. <br><br>  According to the DO-178B standard, which defines the specifications of real-time operating systems in aviation, BRIS should be between levels D and E. Panasonic Avionics BRISS is certified at level E. This means that even if the whole system fails, this is nothing will change or create some inconvenience to passengers. <br><br>  I would also like to note that the air vessel information network is divided into 4 parts, according to the type of data that they process: entertainment of passengers, passenger devices, airline information services and aircraft control. <br><img src="https://habrastorage.org/getpro/habr/post_images/16e/d88/f91/16ed88f911975dd346fb5257c05f99c3.png"><br>  Control of the aircraft should belong to the same part of the network, which should be physically separated from the passenger part, but this is not always the case.  Some ships use optical information diodes, while others prefer network gateway modules.  This means that a potential threat cannot be excluded as long as the connection between the two parts exists. <br><br>  BSID can be an attack vector.  In some cases, this type of attack will not be possible due to the isolation of the systems, but in others the potential threat remains due to the physical connection of the systems.  IOActive successfully compromised the gateways of other vehicles.  The distinction between the passenger and control systems is strongly defined due to specific devices, software and aircraft settings. <br><br>  In 2014, we published a series of vulnerabilities in satellite communication devices (SATCOM), including onboard terminals.  Most worried about the fact that these devices are used in various areas of the system, which allows an attacker to use equipment to gain access to avionics through a compromised BRIS. <br><br>  On the IT side, hacking BRIS means that an attacker can control the information that passengers receive on board.  For example, you can change the flight data such as altitude or speed and show the fictitious route of the aircraft on the map.  An attacker could compromise the CrewApp personnel application and control the lights or drives in the classes above.  If these threats are combined, then passengers can be confused. <br><br>  Receiving personal information, including credit card information, also takes place if the backend, which sometimes provides specific information about the frequency of flights or VIP membership, is not properly configured. <br><br>  On the other hand, a Wi-Fi network can be configured securely without any security threats. <br><br>  This would like to say that in our opinion, such systems will not be able to withstand a serious attack from an experienced attacker.  Airlines need to be vigilant when it comes to BRIS, providing carefully separated systems and checking every aspect of security in stages.  Responsibility for security does not lie on the shoulders of only the developer of BRIS, the manufacturer of the vessel or the operator.  Each plays an important role in the security environment. <br><br><h1>  Responsibility for disclosure </h1><br>  We reported the found vulnerabilities of Panasonic Avionics in March 2015. We hope that there was enough time to close the found vulnerabilities, at least the most obvious ones.  Nevertheless, we think it is difficult to say that all these problems have been solved in an area where different airlines and hundreds of product versions are involved. </div><p>Source: <a href="https://habr.com/ru/post/318228/">https://habr.com/ru/post/318228/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318218/index.html">From Intranet to Digital Workplace</a></li>
<li><a href="../318220/index.html">SetGoroutineName</a></li>
<li><a href="../318222/index.html">Parsing: how and why to use PureComponent in React</a></li>
<li><a href="../318224/index.html">.NET wrappers for native C ++ / CLI libraries</a></li>
<li><a href="../318226/index.html">NetApp SnapLock ‚Ñ¢ - Licensed Data Protection Feature (WORM)</a></li>
<li><a href="../318230/index.html">Information hygiene in a country with non-free Internet</a></li>
<li><a href="../318232/index.html">What is enterprise architecture, and why was Zachman wrong?</a></li>
<li><a href="../318234/index.html">Oracle Database History ‚Äî First Commercially Successful Relational DBMS</a></li>
<li><a href="../318236/index.html">Working with C ++ tuples (std :: tuple). Functions foreach, map and call</a></li>
<li><a href="../318238/index.html">VulnHub: Exploiting the buffer overflow vulnerability in Lord Of The Root</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>