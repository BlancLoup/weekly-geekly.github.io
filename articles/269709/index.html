<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Validation of complex structures with PHPixie Validate</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today another PHPixie 3 component came out , this time for data validation. PHP libraries that deal with validation are already enough, then why write...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Validation of complex structures with PHPixie Validate</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/7cd/47c/66c/7cd47c66c5df9f4b83f7886240a1cba2.png" alt="image" align="right"><br>  Today another <a href="http://phpixie.com/">PHPixie</a> 3 component <a href="http://phpixie.com/">came out</a> , this time for data validation.  PHP libraries that deal with validation are already enough, then why write another one?  In fact, most of them have a big drawback - they only work with one-dimensional data arrays, focusing primarily on working with forms.  This approach is inevitably outdated in the world of API and REST, it is increasingly necessary to work with document-based queries with a complex structure.  Validate was designed from the very beginning just to cope with such tasks.  And even if you are not using PHPixie, this component can be very useful to you. <br><a name="habracut"></a><br>  Let's start with a simple example, a simple one-dimensional array: <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//    $data = array( 'name' =&gt; 'Pixie', 'home' =&gt; 'Oak', 'age' =&gt; 200, 'type' =&gt; 'fairy' ); $validate = new \PHPixie\Validate(); //   $validator = $validate-&gt;validator(); //        $document = $validator-&gt;rule()-&gt;addDocument(); //       //  .    //     $document-&gt;valueField('name') -&gt;required() -&gt;addFilter() -&gt;alpha() -&gt;minLength(3); //      $document-&gt;valueField('home') -&gt;required() -&gt;addFilter() -&gt;filters(array( 'alpha', 'minLength' =&gt; array(3) )); //      //     $document-&gt;valueField('age') -&gt;required() -&gt;filter('numeric'); //      $document-&gt;valueField('type') -&gt;required() -&gt;callback(function($result, $value) { if(!in_array($value, array('fairy', 'pixie'))) { //    $result-&gt;addMessageError("Type can be either 'fairy' or 'pixie'"); } }); //       //     . //      $document-&gt;allowExtraFields(); //      $validator-&gt;rule()-&gt;callback(function($result, $value) { if($value['type'] === 'fairy' &amp;&amp; $value['home'] !== 'Oak') { $result-&gt;addMessageError("Fairies live only inside oaks"); } });</span></span></code> </pre> <br><br><div class="spoiler">  <b class="spoiler_title">Same but with alternate syntax</b> <div class="spoiler_text"><pre> <code class="php hljs">$validator = $validate-&gt;validator(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ $value-&gt;document(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($document)</span></span></span><span class="hljs-function"> </span></span>{ $document -&gt;allowExtraFields() -&gt;field(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{ $name -&gt;required() -&gt;filter(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($filter)</span></span></span><span class="hljs-function"> </span></span>{ $filter -&gt;alpha() -&gt;minLength(<span class="hljs-number"><span class="hljs-number">3</span></span>); }); }) -&gt;field(<span class="hljs-string"><span class="hljs-string">'home'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($home)</span></span></span><span class="hljs-function"> </span></span>{ $home -&gt;required() -&gt;filter(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'alpha'</span></span>, <span class="hljs-string"><span class="hljs-string">'minLength'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) )); }) -&gt;field(<span class="hljs-string"><span class="hljs-string">'age'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($age)</span></span></span><span class="hljs-function"> </span></span>{ $age -&gt;required() -&gt;filter(<span class="hljs-string"><span class="hljs-string">'numeric'</span></span>); }) -&gt;field(<span class="hljs-string"><span class="hljs-string">'type'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($home)</span></span></span><span class="hljs-function"> </span></span>{ $home -&gt;required() -&gt;callback(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($result, $value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!in_array($value, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'fairy'</span></span>, <span class="hljs-string"><span class="hljs-string">'pixie'</span></span>))) { $result-&gt;addMessageError(<span class="hljs-string"><span class="hljs-string">"Type can be either 'fairy' or 'pixie'"</span></span>); } }); }); }) -&gt;callback(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($result, $value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($value[<span class="hljs-string"><span class="hljs-string">'type'</span></span>] === <span class="hljs-string"><span class="hljs-string">'fairy'</span></span> &amp;&amp; $value[<span class="hljs-string"><span class="hljs-string">'home'</span></span>] !== <span class="hljs-string"><span class="hljs-string">'Oak'</span></span>) { $result-&gt;addMessageError(<span class="hljs-string"><span class="hljs-string">"Fairies live only inside oaks"</span></span>); } }); });</code> </pre><br></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And the validation itself: <br><br><pre> <code class="php hljs">$result = $validator-&gt;validate($data); var_dump($result-&gt;isValid()); <span class="hljs-comment"><span class="hljs-comment">//    $data['name'] = 'Pi'; $data['home'] = 'Maple'; $result = $validator-&gt;validate($data); var_dump($result-&gt;isValid()); //   foreach($result-&gt;errors() as $error) { echo $error."\n"; } foreach($result-&gt;invalidFields() as $fieldResult) { echo $fieldResult-&gt;path().":\n"; foreach($fieldResult-&gt;errors() as $error) { echo $error."\n"; } } /* bool(true) bool(false) Fairies live only inside oaks name: Value did not pass filter 'minLength' */</span></span></code> </pre><br><br><h4>  Work with results </h4><br><br>  As you can see above, the result directly includes its errors and also the results of all nested fields.  It may seem that the errors themselves are just text strings, but in fact they are classes implementing the __toString () magic method for convenience only.  When working with forms, you will almost never show this default text to the user.  Instead, get its type and parameters from the error class and then format it nicely, for example: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($error-&gt;type() === <span class="hljs-string"><span class="hljs-string">'filter'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($error-&gt;filter() === <span class="hljs-string"><span class="hljs-string">'minLength'</span></span>) { $params = $error-&gt;parameters(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Please enter at least {$params[0]} characters"</span></span>; } }</code> </pre><br><br>  Thus, a small helper class can make a beautiful localization of various types of errors. <br><br><h4>  Data structures </h4><br>  Well, that's actually a killer feature, let's try to validate this structure: <br><br><pre> <code class="php hljs">$data = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Pixie'</span></span>, <span class="hljs-comment"><span class="hljs-comment">// 'home'    'home' =&gt; array( 'location' =&gt; 'forest', 'name' =&gt; 'Oak' ), // 'spells'    , //    (   ) // of the same type 'spells' =&gt; array( 'charm' =&gt; array( 'name' =&gt; 'Charm Person', 'type' =&gt; 'illusion' ), 'blast' =&gt; array( 'name' =&gt; 'Fire Blast', 'type' =&gt; 'evocation' ), // .... ) ); $validator = $validate-&gt;validator(); $document = $validator-&gt;rule()-&gt;addDocument(); $document-&gt;valueField('name') -&gt;required() -&gt;addFilter() -&gt;alpha() -&gt;minLength(3); //  $homeDocument = $document-&gt;valueField('home') -&gt;required() -&gt;addDocument(); $homeDocument-&gt;valueField('location') -&gt;required() -&gt;addFilter() -&gt;in(array('forest', 'meadow')); $homeDocument-&gt;valueField('name') -&gt;required() -&gt;addFilter() -&gt;alpha(); //   $spellsArray = $document-&gt;valueField('spells') -&gt;required() -&gt;addArrayOf() -&gt;minCount(1); //    $spellDocument = $spellsArray -&gt;valueKey() -&gt;filter('alpha'); //     $spellDocument = $spellsArray -&gt;valueItem() -&gt;addDocument(); $spellDocument-&gt;valueField('name') -&gt;required() -&gt;addFilter() -&gt;minLength(3); $spellDocument-&gt;valueField('type') -&gt;required() -&gt;addFilter() -&gt;alpha();</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Same using alternate syntax</b> <div class="spoiler_text"><pre> <code class="php hljs">$validator = $validate-&gt;validator(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ $value-&gt;document(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($document)</span></span></span><span class="hljs-function"> </span></span>{ $document -&gt;field(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{ $name -&gt;required() -&gt;filter(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'alpha'</span></span>, <span class="hljs-string"><span class="hljs-string">'minLength'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) )); }) -&gt;field(<span class="hljs-string"><span class="hljs-string">'home'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($home)</span></span></span><span class="hljs-function"> </span></span>{ $home -&gt;required() -&gt;document(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($home)</span></span></span><span class="hljs-function"> </span></span>{ $home-&gt;field(<span class="hljs-string"><span class="hljs-string">'location'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($location)</span></span></span><span class="hljs-function"> </span></span>{ $location -&gt;required() -&gt;addFilter() -&gt;in(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'forest'</span></span>, <span class="hljs-string"><span class="hljs-string">'meadow'</span></span>)); }); $home-&gt;field(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{ $name -&gt;required() -&gt;filter(<span class="hljs-string"><span class="hljs-string">'alpha'</span></span>); }); }); }) -&gt;field(<span class="hljs-string"><span class="hljs-string">'spells'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($spells)</span></span></span><span class="hljs-function"> </span></span>{ $spells-&gt;required()-&gt;arrayOf(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($spells)</span></span></span></span>{ $spells -&gt;minCount(<span class="hljs-number"><span class="hljs-number">1</span></span>) -&gt;key(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($key)</span></span></span><span class="hljs-function"> </span></span>{ $key-&gt;filter(<span class="hljs-string"><span class="hljs-string">'alpha'</span></span>); }) -&gt;item(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($spell)</span></span></span><span class="hljs-function"> </span></span>{ $spell-&gt;required()-&gt;document(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($spell)</span></span></span><span class="hljs-function"> </span></span>{ $spell-&gt;field(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{ $name -&gt;required() -&gt;addFilter() -&gt;minLength(<span class="hljs-number"><span class="hljs-number">3</span></span>); }); $spell-&gt;field(<span class="hljs-string"><span class="hljs-string">'type'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($type)</span></span></span><span class="hljs-function"> </span></span>{ $type -&gt;required() -&gt;filter(<span class="hljs-string"><span class="hljs-string">'alpha'</span></span>); }); }); }); }); }); }); });</code> </pre><br></div></div><br><br>  The alternative syntax in my opinion is much more readable in this case, since the tabulation of the code coincides with the tabulation of the document. <br><br>  Look at the results <br><br><pre> <code class="php hljs">$result = $validator-&gt;validate($data); var_dump($result-&gt;isValid()); <span class="hljs-comment"><span class="hljs-comment">//bool(true) //   $data['name'] = ''; $data['spells']['charm']['name'] = '1'; //    $data['spells'][3] = $data['spells']['blast']; $result = $validator-&gt;validate($data); var_dump($result-&gt;isValid()); //bool(false) //      function printErrors($result) { foreach($result-&gt;errors() as $error) { echo $result-&gt;path().': '.$error."\n"; } foreach($result-&gt;invalidFields() as $result) { printErrors($result); } } printErrors($result); /* name: Value is empty spells.charm.name: Value did not pass filter 'minLength' spells.3: Value did not pass filter 'alpha' */</span></span></code> </pre><br><br><h4>  Demo </h4><br>  To try your own hands on Validate enough: <br><br><pre> <code class="diff hljs">git clone https://github.com/phpixie/validate cd validate/examples #      curl -sS https://getcomposer.org/installer | php php composer.phar install php simple.php php document.php</code> </pre><br><br>  And by the way, like all other libraries from PHPixie, you will be 100% covered in code by tests and work under any version of PHP older than 5.3 (including the new 7 and HHVM). </div><p>Source: <a href="https://habr.com/ru/post/269709/">https://habr.com/ru/post/269709/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269697/index.html">Cold perfection: news on the data center cooling systems market</a></li>
<li><a href="../269699/index.html">Compare me completely. Reflection in the service of .NET developer</a></li>
<li><a href="../269701/index.html">Monitoring is handy on IxoraRMS. Quick and tasteful</a></li>
<li><a href="../269705/index.html">Sharing checkstyle and gerrit</a></li>
<li><a href="../269707/index.html">Duke, take out the trash! - Part 2</a></li>
<li><a href="../269711/index.html">Another build Vivaldi 1.0.303.37 - Beta Candidate</a></li>
<li><a href="../269717/index.html">Maybe monad on steroids</a></li>
<li><a href="../269719/index.html">‚ÄúWhat's new in Swift 2?‚Äù With examples. Part 2</a></li>
<li><a href="../269721/index.html">Latest article about setting up a server for Rails</a></li>
<li><a href="../269723/index.html">Test Recipes for Ruby and Rails Applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>