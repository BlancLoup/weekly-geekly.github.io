<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Android Studio for NDK for Windows</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day, I discovered that the version of Android Studio is constantly striving for a unit, and therefore I thought about studying this tool. So...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Android Studio for NDK for Windows</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f21/6ab/2b6/f216ab2b699fb5d28ef1568bb3da3dd0.png"><br><br>  The other day, I discovered that the version of Android Studio is constantly striving for a unit, and therefore I thought about studying this tool.  So that it was not boring, I decided to share my experience and the collected rake in the form of an article-tutorial. <br><br>  I just want to make a reservation that I am not the guru of Android development, so you will not find any revelations in the text.  But there is a step-by-step instruction on installing and configuring Android Studio under Windows and creating the simplest project using Android NDK. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I also warn you in advance: the article turned out to be large and very detailed (honestly, I did not expect it myself), even though I almost hid all the screenshots and some code listings under the spoilers. <br><a name="habracut"></a><br>  At the time of writing, the latest version of Android Studio was 0.8.1, for subsequent versions, the necessary actions may differ from those described below (I really hope for the better). <br><br>  <a href="https://habr.com/ru/post/228365/">For those who are only interested in NDK</a> <br>  <a href="https://habr.com/ru/post/228365/">For those who are only interested in the settings Gradle for NDK</a> <br><br><h4>  Install and configure Android Studio </h4><br><h5>  1. You must install the JDK (Java Development Kit) and JRE (Java Runtime Environment). </h5><a name="a1"></a><br>  Previously, the Android SDK only supported JDK version 6, but now it is in the past.  It supports 7 and even 8 (at least, I specified the 8th version as <i>JAVA_HOME</i> and in the settings of Android Studio, and have not experienced any problems). <br>  JRE is needed to run the studio itself.  I use it with version 7. <br>  Download JDK and JRE versions greater than 6 from <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">the Oracle site</a> . <br><br>  The <i>JAVA_HOME</i> variable can now, it would seem, not be set, since in Android Studio we will set the path to the JDK in the settings.  But I installed it.  For this you need: <br><ul><li>  Go to <i>Control Panel \ System and Security \ System</i> , select <i>Additional System Settings</i> on the left, find the <i>Environment Variables</i> button in the dialog that opens. </li><li>  Create a <i>JAVA_HOME</i> system or user variable and specify the path to the JDK for it.  I have the following path: <i>C: \ Program Files \ Java \ jdk1.8.0_05</i> . </li></ul><br><div class="spoiler">  <b class="spoiler_title">If for any reason you need version 6 of the JDK</b> <div class="spoiler_text">  JDK 6 without registration can be obtained as follows: <br><ul><li>  Download Java EE 6 from <a href="http://www.oracle.com/technetwork/java/javaee/downloads/java-archive-downloads-eesdk-419427.html">Oracle</a> . </li><li>  Install it.  Included is a JDK 6. </li><li>  As <i>JAVA_HOME</i> in this case, you need to specify the path to the JDK from Java EE, the default is <i>C: / glassfish3 / jdk</i> . </li></ul></div></div><br><h5>  2. If you have Android SDK installed. </h5><br>  Included with the Android Studio is your Android SDK.  And, if you want to use it, then in some cases it may happen strange.  For example, when updating the SDK through the SDK Manager, I recorded part of the files in the old folder, and there were problems when I deleted this folder.  Most likely this happened due to the fact that the registry key was stored with the path to the old folder.  Therefore, it makes sense to clean the registry.  To do this, run regedit.exe and find <i>HKEY_LOCAL_MACHINE \ Software \ Android SDK Tools</i> for 32-bit machines or <i>HKEY_LOCAL_MACHINE \ Software \ Wow6432Node \ Android SDK Tools</i> for 64-bit machines and remove <i>Android SDK Tools</i> .  If there are no such keys in the registry of your system, then everything is in order. <br><br>  If you have the <i>ANDROID_SDK_HOME</i> environment variable <i>set</i> and you want it to point to the old installation, then, in theory, this should not be a problem, since when setting up Android Studio we will point it to the SDK.  Problems can arise if this variable uses any of the applications included in the Android SDK. <br><br><h5>  3. Now proceed to install Android Studio. </h5><br>  You need to download Android Studio for your system from the <a href="http://developer.android.com/sdk/installing/studio.html">official page</a> and install it.  By default, if you select ‚ÄúInstall only for me‚Äù, it is placed in <i>\ Users \ &lt;user&gt; \ AppData \ Local \ Android \ android-studio \</i> , otherwise it is placed in <i>\ Program FIles (x86) \ Android \ android-studio \</i> .  You can select another folder. <br><br>  After installation, run Android Studio. <br><div class="spoiler">  <b class="spoiler_title">We see this dialogue</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/f46/52a/c53/f4652ac531c0395ab08fb76a4cd48778.png"></div></div><br>  In it we do the following: <br><ul><li>  Check for updates and, if necessary, update (to do this, click on <i>Check</i> at the bottom of the window) </li><li>  Go to <i>Configure-&gt; SDK Manager</i> (just in case: SDK Manager is not part of Android Studio, but a utility from Android SDK) and install what you need.  If you do not know what is necessary, then it is better to install everything that he offers. <br><div class="spoiler">  <b class="spoiler_title">That's what he installed with me</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/f60/3d7/a35/f603d7a359d1dd24750619d568ee0b94.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/136/458/3c1/1364583c11b5b4921c59e93379f40f86.png"><br></div></div></li><li>  Then I changed the subject to Darcula. <br><div class="spoiler">  <b class="spoiler_title">How to do it</b> <div class="spoiler_text">  you need to go to <i>Configure-&gt; Settings-&gt; Appearance</i> : <br><img src="https://habrastorage.org/getpro/habr/post_images/9e8/931/0eb/9e89310eb78f3870fc587ee19dbc8246.png"><br></div></div></li><li>  Next, go to <i>Configure-&gt; Project Defaults-&gt; Project Structure</i> and change the SDK Location to the path to your Android SDK, and the JDK Location to the path to the JDK. <br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/213/994/5af/2139945af2601ee236de5de1f558f2f2.png"></div></div></li></ul><br><h4>  Project creation </h4><br><h5>  1. New Project </h5><br>  Click <i>New Project</i> . <br><div class="spoiler">  <b class="spoiler_title">There is such a dialogue</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/ee0/f8c/093/ee0f8c0935417c5ded53725f51aae228.png"></div></div><br>  In it you can configure: <br><ul><li>  Project name (I left by default: <i>My Application</i> ) </li><li>  The domain of the company, by default <i>&lt;username&gt; .example.com</i> , in my case <i>markedone.example.com</i> </li><li>  The package name can also be edited by clicking on <i>Edit to the</i> right.  The default is generated from the project name and company domain and looks like com.example. &lt;Username&gt;. &lt;Project name in lowercase without spaces&gt;, I changed it to <i>com.example.markedone.myapp</i> . </li><li>  The path where the project will be saved.  I have specified my folder for any test projects. </li></ul><br>  When everything is entered, click <i>Next</i> . <br><br><h5>  2. Form Factors </h5><br>  In this dialog, select target platforms and APIs. <br><div class="spoiler">  <b class="spoiler_title">The dialogue looks like this</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/776/696/e56/776696e56fee6052ade1be863ba9bd05.png"></div></div><br>  Here I left everything by default: Phone and Tablet and 4.0.3 IceCreamSandwich.  If the API for some platforms is not installed, a Not Insatlled message is displayed.  For example, as seen in the screenshot, I do not have libraries for Google Glass installed (this can be done via the SDK Manager). <br><br><div class="spoiler">  <b class="spoiler_title">Also pay attention to Help me choose, cool stuff.</b> <div class="spoiler_text">  If you click <i>Help me choose</i> , then this interesting dialog opens. <br><img src="https://habrastorage.org/getpro/habr/post_images/34b/34c/50c/34b34c50c647ad36457988789d73d646.png"><br>  It contains information on the coverage of devices when choosing a particular version of the API.  The rectangles of the API versions are clickable, a list of the functionality available in them will be displayed on the right.  For example, for the default Ice Cream Sandwich: <br><img src="https://habrastorage.org/getpro/habr/post_images/f52/d45/d9b/f52d45d9bb5458e174ce6a6ac028323f.png"><br></div></div><br>  Click <i>Next</i> . <br><br><h5>  3. Add Activity </h5><br><div class="spoiler">  <b class="spoiler_title">On the next screen, we are asked to select an Activity.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/d3c/d6f/067/d3cd6f067209fe28489e3e57712f7511.png"></div></div><br>  Naturally, I could not get past the Fullscreen Activity and chose it.  You can choose another Activity, but in this case we will have different source codes in Java, and you will have to add a call to the native method from Java yourself (however, there is nothing complicated about this). <br>  Make a choice, click <i>Next</i> . <br><div class="spoiler">  <b class="spoiler_title">The following dialog appears.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/a1f/13e/383/a1f13e383f3123c86acf3425e4c20350.png"></div></div><br>  Here we are invited to configure the Activity. <br><ul><li>  <i>Activity Name</i> - class name, I left the default: <i>FullscreenActivity</i> . </li><li>  <i>Layout Name</i> - the layout name, for the UI editor, is also left by default. </li><li>  <i>Title</i> - the default is FullscreenActivity, I put a space: <i>Fullscreen Activity</i> . </li></ul><br>  Click <i>Finish</i> . <br><div class="spoiler">  <b class="spoiler_title">As a result, the project should open</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/775/c61/937/775c61937c55ef40335560591fb5df68.png"></div></div><br><h4>  Build and Run </h4><br><h5>  1. Build the project </h5><br>  We launch the build via the menu: <i>Build-&gt; Make Project</i> (icons and hot keys are shown for menu items, so it‚Äôs easy to figure out with them). <br>  I had an error during the first build: <br><img src="https://habrastorage.org/getpro/habr/post_images/84e/0b1/c6a/84e0b1c6afd599498da32d2b58c99add.png"><br>  It happened in the file <i>MyApplication / app / build.gradle</i> <br>  In order to understand what's the matter, just hover over the underlined line: <br><img src="https://habrastorage.org/getpro/habr/post_images/365/711/846/365711846267342e1b3b2778eb96d7a2.png"><br>  Everything is simple, version 19 is indicated here, and we have only 20 installed, and in the project settings we indicated 20 as the target one.  Just change the number: <br><img src="https://habrastorage.org/getpro/habr/post_images/e49/2f6/1c2/e492f61c206f773d77c5c225cd69c917.png"><br>  As you can see, the studio has not calmed down on this, and offers to install an even newer version.  But now we do not need it. <br><br>  <i>Run Build-&gt; Make Project</i> again.  This time I got everything together.  I hope you have too. <br><br><h5>  2. Configure the virtual device </h5><br>  In order to run the program in the emulator, you need to configure a virtual device.  Go to <i>Tools-&gt; Android-&gt; AVD Manager</i> (this, like the SDK Manager, is a utility from the Android SDK).  We need the first tab, <i>Android Virtual Device</i> , it is open by default.  On the right, we find the <i>Create</i> button <i>...</i> and click it. <br><div class="spoiler">  <b class="spoiler_title">The virtual device setup dialog will appear.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/ad5/ce9/87a/ad5ce987a7d8286917f9ff435ab0a596.png"></div></div><br><ul><li>  <i>AVD Name</i> - the name of the virtual device, I entered <i>TestPhone</i> .  Then I, however, chose the tablet, but did not change the name. </li><li>  <i>Device</i> - various preset device settings, the value is selected from the available in the drop-down list, I chose <i>7 '' WSVGA (Tablet) (1024 x 600: mdpi)</i> . </li><li>  Target - the target version of the API, only those available in the SDK are available.  You can install them through the SDK Manager. <br><img src="https://habrastorage.org/getpro/habr/post_images/6b1/cd6/afc/6b1cd6afc8312e95a0ec3737b1f84b68.png"><br>  W in the name means Wear, the version for wearable devices (watches, etc.).  Since we chose Tablet &amp; Phone in the project settings, we need another item: <i>Android L (Preview) - API Level L.</i> <br></li><li>  <i>CPU / ABI</i> - platform, I chose <i>ARM (armeabi-v7a)</i> . </li><li>  <i>Keyboard</i> - here, I think, everything is clear. </li><li>  <i>Skin</i> - as I understood it, the appearance of the device, I chose the value corresponding to the set value of <i>Device</i> : <i>WSVGA</i> . </li><li>  <i>Front Camera</i> and <i>Back Camera</i> - the availability of cameras. </li><li>  <i>Memory Options</i> - RAM. </li><li>  <i>Internal Storage</i> - device hard disk. </li><li>  <i>SD Card</i> - I think it is clear. </li><li>  <i>Emulation options</i> : <i>Snapshot</i> - allows the emulator to maintain its state between launches, <i>Use Host GPU</i> - allows you to use a computer graphics card for OpenGL ES.  I turned on the last option, but the OpenGL application later fell on this emulator on startup.  Probably because of ARM vs x86_64. </li></ul><br>  At the bottom of the dialog you can see what error you made when setting up.  For example, you cannot enter spaces in the device name, and some fields are required.  When there is no label below, everything is entered correctly.  Click <i>OK</i> . <br><div class="spoiler">  <b class="spoiler_title">The device appears in the list</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/a0f/14b/cb4/a0f14bcb4ee7aeea160bdb9313413242.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">A couple of words about the Device Definitions tab</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/d0e/f4a/6f2/d0ef4a6f2edc3f90b58e493d423da6d3.png"><br>  It specifies the available devices (those that are then displayed in the <i>Device</i> drop-down list when creating a new virtual device).  To create a new device, you need to click on the <i>Create Device ...</i> button and take care of filling in the following dialog: <br><img src="https://habrastorage.org/getpro/habr/post_images/b1e/0f5/61c/b1e0f561c98310e90f91fda13af5dda9.png"><br></div></div><br>  Close the AVD Manager and return to the main window of Android Studio. <br><br><h5>  3. Run on emulator </h5><br>  <i>Run Run-&gt; Run 'app'</i> . <br>  We'll have to wait until the project builds to run. <br><div class="spoiler">  <b class="spoiler_title">In the end, the device selection window will appear.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/cc2/27d/aab/cc227daab70ef629cfbc65bbc8b7492e.png"><br></div></div>  Here, the only available option to choose from is our virtual device.  He proposed to us immediately, so just click <i>OK</i> . <br><br><div class="spoiler">  <b class="spoiler_title">Emulator runs for quite a while.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/bc7/cf0/668/bc7cf06686356ce7c64e70810c8f3015.png"></div></div><br>  You can open <i>Tools-&gt; Android-&gt; Android Device Monitor</i> (utility from Android SDK) to see the logs from the emulator.  It should automatically pick up the virtual device and immediately start displaying the log. <br><div class="spoiler">  <b class="spoiler_title">Android Device Monitor</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/144/e4f/683/144e4f6833b00db19d2b5abbcc13df9a.png"></div></div><br>  But after the emulator started up, the application did not open for me the first time, I had to click <i>Run-&gt; Run 'app'</i> again. <br><div class="spoiler">  <b class="spoiler_title">There is a little changed dialogue.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/182/a84/d9e/182a84d9e6e0743511982b623566e07b.png"></div></div>  Here the device migrated from the list to run in the list of already running.  In this list, by itself, there are also real devices. <br><br>  After that, it went, and the application quickly installed and started. <br><div class="spoiler">  <b class="spoiler_title">Full screen mode</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/8df/565/f3a/8df565f3afb42725e2cc0b6290a5a9b3.png"></div></div><div class="spoiler">  <b class="spoiler_title">And if you tap the application, it looks like this</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/90f/ef3/300/90fef33002723ce68e226174ababb7fa.png"></div></div>  This is not the behavior of the system, the processing of a click occurs in the application (FullscreenActivity.java file): <br><pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Set up the user interaction to manually show or hide the system UI. contentView.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View view) { if (TOGGLE_ON_CLICK) { mSystemUiHider.toggle(); } else { mSystemUiHider.show(); } } });</span></span></code> </pre>  After launch, Android Studio suggested that I turn off the Android Device Monitor in order to integrate the output directly into the IDE. <br><div class="spoiler">  <b class="spoiler_title">This is what integration looks like.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/9b0/12e/120/9b012e120a8ac816eed1f2a56132d392.png"></div></div><br><h5>  4. Run in Debug mode </h5><br>  <i>Run-&gt; Debug 'app'</i> <br><div class="spoiler">  <b class="spoiler_title">Already familiar to us dialogue</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/182/a84/d9e/182a84d9e6e0743511982b623566e07b.png"></div></div>  Click OK. <br><br>  We are waiting for the application to start and connect the debugger.  I put a breakpoint when I clicked on the Dummy Button. <br><div class="spoiler">  <b class="spoiler_title">Android Studio in debug</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/497/0eb/1a8/4970eb1a80ea34f7dd1722fbd4558485.png"></div></div><br>  A little annoying lack of panels with all sorts of Step Into, Step Out etc. <br><div class="spoiler">  <b class="spoiler_title">All this is in the Run menu.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/8f7/3bd/b9b/8f73bdb9b42027acbc02a8d70b661d30.png"></div></div><br><h5>  5. Running on 4.0.3 </h5><br>  In the process of creating and launching a project, you probably noticed that we created an application compatible with version 4.0.3, but ran it only on the latest version of Android.  Now we fix it.  To do this, you need to install version 4.0.3 through <i>Tools-&gt; Android-&gt; SDK Manager</i> . <br><div class="spoiler">  <b class="spoiler_title">Necessary ticked on a screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/536/6df/9ef/5366df9efa0b0ff257155134fc59629c.png"></div></div><br>  These are the <i>SDK Platform</i> , <i>ARM EABI v7a System Image</i> and <i>Intel x86 Atom System Image</i> .  In fact, we ran the ARM emulator, and we don‚Äôt need to install Intel now.  I put it especially because it is installed for Android L. <br>  Now create another device for the new old version of Android (or you can edit the old one). <br><div class="spoiler">  <b class="spoiler_title">New device settings</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/bf4/a18/266/bf4a18266e7e2be721452bf118071af7.png"></div></div><br>  Run ( <i>Run-&gt; Run 'app'</i> ). <br><div class="spoiler">  <b class="spoiler_title">In the dialogue, select a new device to run.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/584/093/d93/584093d93d9e455636ab5c409182ddbf.png"></div></div><br>  And we look how the new emulator looks like - obviously more brutal. <br><div class="spoiler">  <b class="spoiler_title">Launch</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/a78/0a6/719/a780a6719e1bca4ae0b8c67a5318d997.png"></div></div><div class="spoiler">  <b class="spoiler_title">Full screen mode</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/d18/f1b/9fb/d18f1b9fb3082c2ddc52e7a221e77fa4.png"></div></div><div class="spoiler">  <b class="spoiler_title">After clicking</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/69b/d6a/28a/69bd6a28aa9b3442f5d71987034042b8.png"></div></div><br><h5>  5. Run on device </h5><br>  Before moving to work with NDK, let's run the project on a real device.  I will run on the phone <br><div class="spoiler">  <b class="spoiler_title">Huawei Ascend G300 with Android 4.0.3</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/cb6/364/60f/cb636460f1fb94e51f4cff1cb242ebbf.png"></div></div><br>  The first thing to do is install the adb driver.  Everything is quite simple with me, the driver is right on the phone, the only thing to do is to plug the cord into the computer, go into the mounted disk and run the executable file, which will install the adb driver.  For other devices, things can be more complicated.  For example, for the Prestigio tablet I once had to register Vendor ID in a special file (to use the standard Google driver), Samsung needs their own Kies, there was a separate driver for HTC and so on.  In general, you will have to figure out how to install a driver for your device. <br><br>  After the driver has been installed, you need to enable USB debugging on the device.  On my phone for this you need to go to <i>Settings-&gt; For Developers-&gt; USB Debugging</i> .  But for different devices, as well as assemblies and versions of Android, the location of this menu item may differ. <br><br>  Now the phone will be Android SDK, and the developed applications will be installed.  However, for Huawei, this is not all: there are no logs from the phone, you need to turn them on. <br><div class="spoiler">  <b class="spoiler_title">How to enable logs on Huawei</b> <div class="spoiler_text">  Dial as a phone number: * # * # 2846579 # * # <br>  The service menu appears. <br>  Go to <i>ProjectMenu-&gt; Background Setting-&gt; Log Setting</i> <br>  Open the <i>Log switch</i> and set it to <i>ON</i> . <br>  Open the <i>Log level setting</i> and set the required logging level (I set <i>verbose</i> ). <br>  Reboot the phone. </div></div><br>  Now you can run the application on the device: <i>Run-&gt; Run 'app'</i> <br><div class="spoiler">  <b class="spoiler_title">The real device appeared in the device selection dialog.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/05a/d39/26a/05ad3926ac38ea32aeaf0e04dff7f791.png"></div></div><br>  Run on the phone. <br><div class="spoiler">  <b class="spoiler_title">The result of the launch.</b> <div class="spoiler_text">  Application in portrait: <br><ul><li>  Full screen <br><img src="https://habrastorage.org/getpro/habr/post_images/e38/b70/1a9/e38b701a96f28c52087d39a1323a6250.png"><br></li><li>  After clicking <br><img src="https://habrastorage.org/getpro/habr/post_images/067/d1f/950/067d1f9509da41cbe77b9c1da4528729.png"><br></li></ul><br>  Application in the landscape: <br><ul><li>  Full screen <br><img src="https://habrastorage.org/getpro/habr/post_images/22d/541/911/22d5419115e63c1237e2fa1be4a55265.png"></li><li>  After clicking <br><img src="https://habrastorage.org/getpro/habr/post_images/2de/e61/753/2dee61753f0ad6efc02748a8652dcb7d.png"></li></ul></div></div><br><a name="NDK"></a><h4>  Install and configure Android NDK </h4><br><h5>  1. Installing NDK </h5><br>  The Android SDK, as we have already found out, is included in the Android Studio package, but the NDK is not.  Download the NDK that fits your system <a href="http://developer.android.com/tools/sdk/ndk/index.html">from here</a> .  We unpack the archive and put it in some folder, for example, in <i>D: \ ndk</i> , so that the <i>ndk-build.cmd</i> file is right in it.  <b>Important</b> : it is necessary that there are no gaps in the path to the NDK. <br><br><h5>  2. Add the variable ANDROID_NDK_HOME </h5><br>  Go to <i>Control Panel \ System and Security \ System</i> , select <i>Additional System Settings</i> on the left, in the opened dialog, press the <i>Environment Variables</i> button.  Create a variable with the name <i>ANDROID_NDK_HOME</i> and the value <i>D: \ ndk</i> (the path to your NDK). <br><br>  Alternatively, instead of specifying a global variable, you can set the path to ndk in the local.properties file of your project (right in the root folder: <i>MyApplication \ local.properties</i> ).  The contents of the file will look something like this (note the double backslashes, since this is critical for Windows): <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">## This file is automatically generated by Android Studio. # Do not modify this file -- YOUR CHANGES WILL BE ERASED! # # This file should *NOT* be checked into Version Control Systems, # as it contains information specific to your local configuration. # # Location of the SDK. This is only used by Gradle. # For customization when using a Version Control System, please read the # header note. sdk.dir=C:\\Users\\&lt;user&gt;\\AppData\\Local\\Android\\android-studio\\sdk ndk.dir=D:\\ndk</span></span></code> </pre><br>  Do not believe the disclaimer about "your changes will be discarded," in this case it is not.  Please note that this file is recommended to be excluded from version control, as it contains only local information for the user.  For a change in this we did not lie.  And, of course, this change will not affect your other projects.  When <i>ANDROID_NDK_HOME is</i> set, it is not <i>necessary to</i> register the path in local.properties. <br><br><h5>  3. Install the required version of the Android API </h5><br>  Go to the <i>NDK \ platforms</i> (I have this <i>D: \ ndk \ platforms</i> ) and see the maximum version of the available APIs.  In my case, the maximum version is 19. But at the same time, we only have versions 20 and 15 installed in the SDK. So, go to the SDK Manager and download the SDK Platform version 19, otherwise nothing will come together. <br><div class="spoiler">  <b class="spoiler_title">What to download</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/960/1f7/b25/9601f7b2513f1210bc6a19a4579af87c.png"></div></div><br><a name="GradleNDK"></a><h5>  4. Configure gradle to work with NDK </h5><br>  I took the information from the samples, you can download them <a href="http://tools.android.com/tech-docs/new-build-system">here at the bottom of the page</a> .  I downloaded samples for version 0.11.  I took ndkSanAngeles as the main example. <br><br><div class="spoiler">  <b class="spoiler_title">How to run ndkSanAngeles</b> <div class="spoiler_text">  After the samples are downloaded, they need to be unpacked.  Then you need to open the ndkSanAngeles project.  For Android Studio, the project is a folder, so you have to open it.  To do this, run <i>File-&gt; Open</i> , or, if you are in the Welcome dialog, <i>Open Project</i> .  We are looking for the ndkSanAngeles folder through the open file dialog. <br><img src="https://habrastorage.org/getpro/habr/post_images/7ff/8a6/ffa/7ff8a6ffa06d3a18c8dfc6b08fe9d9b9.png"><br><br><br>  After opening the project, you should look at the file <i>build.gradle</i> .  Here is its original: <br><pre> <code class="java hljs">buildscript { repositories { mavenCentral() } dependencies { classpath <span class="hljs-string"><span class="hljs-string">'com.android.tools.build:gradle:0.11.0'</span></span> } } apply plugin: <span class="hljs-string"><span class="hljs-string">'android'</span></span> android { compileSdkVersion <span class="hljs-number"><span class="hljs-number">19</span></span> buildToolsVersion <span class="hljs-string"><span class="hljs-string">'19.1.0'</span></span> defaultConfig { ndk { moduleName <span class="hljs-string"><span class="hljs-string">"sanangeles"</span></span> cFlags <span class="hljs-string"><span class="hljs-string">"-DANDROID_NDK -DDISABLE_IMPORTGL"</span></span> ldLibs <span class="hljs-string"><span class="hljs-string">"GLESv1_CM"</span></span>, <span class="hljs-string"><span class="hljs-string">"dl"</span></span>, <span class="hljs-string"><span class="hljs-string">"log"</span></span> stl <span class="hljs-string"><span class="hljs-string">"stlport_static"</span></span> } <span class="hljs-comment"><span class="hljs-comment">// This actual the app version code. Giving ourselves 1,000,000 values versionCode = 123 } buildTypes.debug.jniDebugBuild true productFlavors { x86 { ndk { abiFilter "x86" } // this is the flavor part of the version code. // It must be higher than the arm one for devices supporting // both, as x86 is preferred. versionCode = 3 } arm { ndk { abiFilter "armeabi-v7a" } versionCode = 2 } mips { ndk { abiFilter "mips" } versionCode = 1 } fat { // fat binary, lowest version code to be // the last option versionCode = 0 } } // make per-variant version code applicationVariants.all { variant -&gt; // get the single flavor def flavorVersion = variant.productFlavors.get(0).versionCode // set the composite code variant.mergedFlavor.versionCode = flavorVersion * 1000000 + defaultConfig.versionCode } }</span></span></code> </pre><br>  But the modified version, so that the project was collected from me: <br><pre> <code class="java hljs">buildscript { repositories { mavenCentral() } dependencies { classpath <span class="hljs-string"><span class="hljs-string">'com.android.tools.build:gradle:0.12.+'</span></span> } } apply plugin: <span class="hljs-string"><span class="hljs-string">'android'</span></span> android { compileSdkVersion <span class="hljs-number"><span class="hljs-number">19</span></span> buildToolsVersion <span class="hljs-string"><span class="hljs-string">'20.0.0'</span></span> defaultConfig { ndk { moduleName <span class="hljs-string"><span class="hljs-string">"sanangeles"</span></span> cFlags <span class="hljs-string"><span class="hljs-string">"-DANDROID_NDK -DDISABLE_IMPORTGL"</span></span> ldLibs <span class="hljs-string"><span class="hljs-string">"GLESv1_CM"</span></span>, <span class="hljs-string"><span class="hljs-string">"dl"</span></span>, <span class="hljs-string"><span class="hljs-string">"log"</span></span> stl <span class="hljs-string"><span class="hljs-string">"stlport_static"</span></span> } <span class="hljs-comment"><span class="hljs-comment">// This actual the app version code. Giving ourselves 1,000,000 values versionCode = 123 } buildTypes.debug.jniDebugBuild true productFlavors { x86 { ndk { abiFilter "x86" } // this is the flavor part of the version code. // It must be higher than the arm one for devices supporting // both, as x86 is preferred. versionCode = 3 } arm { ndk { abiFilter "armeabi-v7a" } versionCode = 2 } mips { ndk { abiFilter "mips" } versionCode = 1 } fat { // fat binary, lowest version code to be // the last option versionCode = 0 } } // make per-variant version code applicationVariants.all { variant -&gt; // get the single flavor def flavorVersion = variant.productFlavors.get(0).versionCode // set the composite code variant.mergedFlavor.versionCode = flavorVersion * 1000000 + defaultConfig.versionCode } }</span></span></code> </pre><br>  The changes are as follows: <br><ul><li>  The missed version of the gradle plugin ( <i>classpath 'com.android.tools.build:gradle 11.11'</i> ) will be discussed when attempting to build and the correct version number is suggested.  I have this 0.12. +. </li><li>  <i>compileSdkVersion</i> 19 remains as it is the maximum version for the current NDK. </li><li>  <i>buildToolsVersion</i> has changed to 20. Installed versions can be viewed in the SDK Manager, others can also be installed there. </li></ul><br>  After that, ndkSanAngeles should pack up.  Be careful, check the versions you have installed. <br></div></div><br>  In our project, you need to select the correct build.gradle file, since there are two of them here.  The fact is that MyApplication is a project, and the app is a project module (or subproject), and they have their own build.gradle.  First consider the project file <br><div class="spoiler">  <b class="spoiler_title">MyApplication-&gt; build.gradle</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Top-level build file where you can add configuration options common to all sub-projects/modules. buildscript { repositories { jcenter() } dependencies { classpath 'com.android.tools.build:gradle:0.12.+' // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">NOTE:</span></span></span><span class="hljs-comment"> Do not place your application dependencies here; they belong // in the individual module build.gradle files } } allprojects { repositories { jcenter() } }</span></span></code> </pre></div></div><br>  From the comments in the code it is clear that we need a module file. <br><div class="spoiler">  <b class="spoiler_title">MyApplication-&gt; app-&gt; build.gradle</b> <div class="spoiler_text"><pre> <code class="java hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'com.android.application'</span></span> android { compileSdkVersion <span class="hljs-number"><span class="hljs-number">20</span></span> buildToolsVersion <span class="hljs-string"><span class="hljs-string">"20.0.0"</span></span> defaultConfig { applicationId <span class="hljs-string"><span class="hljs-string">"com.example.markedone.myapp"</span></span> minSdkVersion <span class="hljs-number"><span class="hljs-number">15</span></span> targetSdkVersion <span class="hljs-number"><span class="hljs-number">20</span></span> versionCode <span class="hljs-number"><span class="hljs-number">1</span></span> versionName <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> } buildTypes { release { <span class="hljs-function"><span class="hljs-function">runProguard </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">false</span></span></span><span class="hljs-function"> proguardFiles </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefaultProguardFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'proguard-android.txt'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, 'proguard-rules.pro' } } } dependencies </span></span>{ <span class="hljs-function"><span class="hljs-function">compile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dir: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'libs'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, include: [</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'*.jar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">// You must install or update the Support Repository through the SDK manager to use this dependency. //compile 'com.android.support:support-v4:19.+' compile 'com.android.support:support-v4:20.+' }</span></span></span></span></code> </pre><br></div></div><br>  We configure it to work with NDK using build.gradle from ndkSanAngeles as a ‚Äúdonor‚Äù. <br><br>  For a start, replace <br> <code>compileSdkVersion 20</code> <br>  on <br> <code>compileSdkVersion 19</code> <br>  since the NDK is limited to version 19. <br><br>  <i>We</i> ‚Äôll add the <i>ndk</i> settings to <i>defaultConfig</i> and also replace <i>targetSdkVersion</i> with 19: <br><pre> <code class="java hljs">defaultConfig { applicationId <span class="hljs-string"><span class="hljs-string">"com.example.markedone.myapp"</span></span> minSdkVersion <span class="hljs-number"><span class="hljs-number">15</span></span> targetSdkVersion <span class="hljs-number"><span class="hljs-number">19</span></span> versionCode <span class="hljs-number"><span class="hljs-number">1</span></span> versionName <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> ndk { moduleName <span class="hljs-string"><span class="hljs-string">"myapp"</span></span> cFlags <span class="hljs-string"><span class="hljs-string">"-DANDROID_NDK"</span></span> ldLibs <span class="hljs-string"><span class="hljs-string">"log"</span></span> stl <span class="hljs-string"><span class="hljs-string">"stlport_static"</span></span> } }</code> </pre>  NDK settings include <br><ul><li>  <i>moduleName</i> - the name of the module that will be used to name the * .so file </li><li>  <i>cFlags</i> - flags C </li><li>  <i>ldLibs</i> - the libraries that you want to connect to the native code </li><li>  <i>stl</i> - version of the library STL </li></ul><br>  In buildTypes, enable debug JNI build for debug: <br><pre> <code class="java hljs"> buildTypes { release { <span class="hljs-function"><span class="hljs-function">runProguard </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">false</span></span></span><span class="hljs-function"> proguardFiles </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefaultProguardFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'proguard-android.txt'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, 'proguard-rules.pro' } debug.jniDebugBuild </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">true</span></span></span><span class="hljs-function"> }</span></span></code> </pre><br>  Now add the <i>productFlavors</i> .  Here we indicate which collected * .so libraries to include in the assembly for a specific architecture.  Thus, * .apk compiled for arm will contain the library version only for arm, under x86 - for x86 and so on.  This piece is completely copied from ndkSanAngeles.  Explanation of <i>versionCode</i> values ‚Äã‚Äãfrom comments: for x86 we set the maximum value to <i>versionCode</i> , since if the device supports both x86 and arm, then the x86 build is preferable (apparently, since it has a larger version, then it will be installed), and the minimum <i>versionCode is written</i> for <i>fat</i> (in theory, it should be ‚Äúthick‚Äù * .apk, containing all possible versions of libraries at once). <br><pre> <code class="java hljs"> productFlavors { x86 { ndk { abiFilter <span class="hljs-string"><span class="hljs-string">"x86"</span></span> } <span class="hljs-comment"><span class="hljs-comment">// this is the flavor part of the version code. // It must be higher than the arm one for devices supporting // both, as x86 is preferred. versionCode = 3 } arm { ndk { abiFilter "armeabi-v7a" } versionCode = 2 } mips { ndk { abiFilter "mips" } versionCode = 1 } fat { // fat binary, lowest version code to be // the last option versionCode = 0 } }</span></span></code> </pre><br>  ‚Äú <i>Build</i> ‚Äù the <i>versionCode</i> value for each of the build options: <br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">// make per-variant version code applicationVariants.all { variant -&gt; // get the single flavor def flavorVersion = variant.productFlavors.get(0).versionCode // set the composite code variant.mergedFlavor.versionCode = flavorVersion * 1000000 + defaultConfig.versionCode }</span></span></code> </pre><br>  Finally, the last section, <i>dependencies</i> .  If you remember, here we changed <i>compile 'com.android.support:support-v4:19.+'</i> to <i>compile 'com.android.support:support-v4:20.+'</i> to build with the only library version we have installed.  Now you have to change back to 19. <br><pre> <code class="java hljs">dependencies { <span class="hljs-function"><span class="hljs-function">compile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dir: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'libs'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, include: [</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'*.jar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">// You must install or update the Support Repository through the SDK manager to use this dependency. compile 'com.android.support:support-v4:19.+' }</span></span></span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Full listing of the modified build.gradle file</b> <div class="spoiler_text"><pre> <code class="java hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'com.android.application'</span></span> android { compileSdkVersion <span class="hljs-number"><span class="hljs-number">19</span></span> buildToolsVersion <span class="hljs-string"><span class="hljs-string">"20.0.0"</span></span> defaultConfig { applicationId <span class="hljs-string"><span class="hljs-string">"com.example.markedone.myapp"</span></span> minSdkVersion <span class="hljs-number"><span class="hljs-number">15</span></span> targetSdkVersion <span class="hljs-number"><span class="hljs-number">19</span></span> versionCode <span class="hljs-number"><span class="hljs-number">1</span></span> versionName <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> ndk { moduleName <span class="hljs-string"><span class="hljs-string">"myapp"</span></span> cFlags <span class="hljs-string"><span class="hljs-string">"-DANDROID_NDK"</span></span> ldLibs <span class="hljs-string"><span class="hljs-string">"log"</span></span> stl <span class="hljs-string"><span class="hljs-string">"stlport_static"</span></span> } } buildTypes { release { <span class="hljs-function"><span class="hljs-function">runProguard </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">false</span></span></span><span class="hljs-function"> proguardFiles </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefaultProguardFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'proguard-android.txt'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, 'proguard-rules.pro' } debug.jniDebugBuild </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">true</span></span></span><span class="hljs-function"> } productFlavors </span></span>{ x86 { ndk { abiFilter <span class="hljs-string"><span class="hljs-string">"x86"</span></span> } <span class="hljs-comment"><span class="hljs-comment">// this is the flavor part of the version code. // It must be higher than the arm one for devices supporting // both, as x86 is preferred. versionCode = 3 } arm { ndk { abiFilter "armeabi-v7a" } versionCode = 2 } mips { ndk { abiFilter "mips" } versionCode = 1 } fat { // fat binary, lowest version code to be // the last option versionCode = 0 } } // make per-variant version code applicationVariants.all { variant -&gt; // get the single flavor def flavorVersion = variant.productFlavors.get(0).versionCode // set the composite code variant.mergedFlavor.versionCode = flavorVersion * 1000000 + defaultConfig.versionCode } sourceSets { main { jni.srcDirs = ['src/main/jni', 'src/main/jni/'] } } } dependencies { compile fileTree(dir: 'libs', include: ['*.jar']) // You must install or update the Support Repository through the SDK manager to use this dependency. compile 'com.android.support:support-v4:19.+' }</span></span></code> </pre></div></div><br><h5>  5. Create jni folder </h5><br>  In the jni folder, we will save C / C ++ files.  This is what NDK expects of us.  We need to create a <i>folder</i> in <i>MyApplication / app / src / main</i> .  This can be done directly from Android Studio, and in two ways. <br>  First, you can right-click on main and simply create a folder through <br><div class="spoiler">  <b class="spoiler_title">New-&gt; Directory</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/161/461/4b9/1614614b919306fd0f07c9cb3f4b33e1.png"></div></div><br>  Secondly, you can use a special menu item. <br><div class="spoiler">  <b class="spoiler_title">New-&gt; Folder-&gt; JNI Folder</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/0e0/b15/cbc/0e0b15cbcfedfe2297b92cae54240eff.png"></div></div><div class="spoiler">  <b class="spoiler_title">It starts the folder creation wizard.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/2e0/45c/d4c/2e045cd4cfbefa26c5c9fd72337141af.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/bc9/a9d/acf/bc9a9dacf32ce87deabb3ecdc0b84017.png"><br>  In the first dialog, we select for which part of the module the jni folder will be created, and in the second, you can change its location. <br></div></div><br><h5>  6. Add C ++ files </h5><br>  There is no wizard for C ++ files, so to create the file we right-click on the <i>jni</i> folder and select <br><div class="spoiler">  <b class="spoiler_title">New-&gt; File</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/7e3/c04/c7e/7e3c04c7ece24218a1c1c108582936b8.png"></div></div><br>  First, create the header file <i>myapp.h</i> : <br><pre> <code class="hljs smalltalk"><span class="hljs-symbol"><span class="hljs-symbol">#pragma</span></span> once <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;jni.h&gt; <span class="hljs-symbol"><span class="hljs-symbol">#ifdef</span></span> __cplusplus extern <span class="hljs-comment"><span class="hljs-comment">"C"</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">#endif</span></span> <span class="hljs-type"><span class="hljs-type">JNIEXPORT</span></span> jstring <span class="hljs-type"><span class="hljs-type">JNICALL</span></span> <span class="hljs-type"><span class="hljs-type">Java_com_example_markedone_myapp_FullscreenActivity_stringFromJNI</span></span>(<span class="hljs-type"><span class="hljs-type">JNIEnv</span></span>* env, jclass clazz); <span class="hljs-symbol"><span class="hljs-symbol">#ifdef</span></span> __cplusplus } <span class="hljs-symbol"><span class="hljs-symbol">#endif</span></span></code> </pre><div class="spoiler">  <b class="spoiler_title">Description</b> <div class="spoiler_text"><ul><li>  <code>#pragma once</code> - instead of the standard (# ifndef / # define / # endif) protection against re-activation.  Now <code>#pragma once</code> is understood by most C ++ compilers. </li><li>  <code>#include &lt;jni.h&gt;</code> - <code>#include &lt;jni.h&gt;</code> JNI header so that you can use the types declared there. </li><li>  <code>#ifdef __cplusplus ... #endif</code> - the code inside will be compiled only in C ++ (but not in C). </li><li>  <code>extern "C" { ... }</code> - we get rid of name mangling (what it is and why, it is <a href="http://www.gamedev.ru/code/forum/%3Fid%3D56367)">well described here</a> ). </li><li> <code>JNIEXPORT jstring JNICALL Java_com_example_markedone_myapp_FullscreenActivity_stringFromJNI(JNIEnv* env, jclass clazz);</code>  - declaration of the function that we will implement. <br>  Let us examine this announcement in more detail. <br><ul><li>  <i>JNIEXPORT is</i> necessary for proper linking. </li><li>  <i>JNICALL</i> for the correct calling agreement. </li><li>  <i>jstring</i> is the return type of the function, in this case it is a string compatible with the Java string. </li><li>  <i>Java_com_example_markedone_myapp_FullscreenActivity_stringFromJNI</i> - the name of the function, consisting of: <br>  <i>Java</i> is the language that calls. <br>  <i>com_example_markedone_myapp</i> is the application id ( <i>com.example.markedone.myapp</i> ). <br>  <i>FullscreenActivity</i> is the name of the Java class that contains the declaration of the method representing the native function. <br>  <i>stringFromJNI</i> is actually the name of the function (it will be like this in Java). </li><li>  <code>JNIEnv* env, jclass clazz</code> - required parameters passed from Java. <br>  <code>JNIEnv* env</code> - a pointer to an object, which is a JNI environment. <br>  <code>jclass clazz</code> is the class to which the native method declaration in Java belongs.  Here we need to make a reservation that jclass clazz is for a static native ( <i>static native</i> ) method.  For a non-static method, you will need to write a <code>jobject obj</code> . </li></ul></li></ul></div></div><br>  Now create an implementation file, myapp.cpp.  In it we will write the following code: <br><pre> <code class="hljs mel">#include &lt;android/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>.h&gt; #include &lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; #include <span class="hljs-string"><span class="hljs-string">"myapp.h"</span></span> JNIEXPORT jstring JNICALL Java_com_example_markedone_myapp_FullscreenActivity_stringFromJNI(JNIEnv* <span class="hljs-keyword"><span class="hljs-keyword">env</span></span>, jclass clazz) { std::<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> tag(<span class="hljs-string"><span class="hljs-string">"GREETING"</span></span>); std::<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> message(<span class="hljs-string"><span class="hljs-string">"Hello from C++!"</span></span>); __android_log_print(ANDROID_LOG_INFO, tag.c_str(), <span class="hljs-string"><span class="hljs-string">"%s"</span></span>, message.c_str()); std::<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> jniMessage(<span class="hljs-string"><span class="hljs-string">"Hello from JNI!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">env</span></span>-&gt;NewStringUTF(jniMessage.c_str()); }</code> </pre> <div class="spoiler">  <b class="spoiler_title">Description</b> <div class="spoiler_text"><ul><li>  <code>#include &lt;android/log.h&gt;</code> - <code>#include &lt;android/log.h&gt;</code> log, for which we even added the library ( <i>ldLibs "log"</i> ) </li><li> <code>#include -  std::string,       STL.</code> <br>  <code>#include "myapp.h"</code> - connect our header file. <br> <code>JNIEXPORT jstring JNICALL Java_com_example_markedone_myapp_FullscreenActivity_stringFromJNI(JNIEnv* env, jclass clazz) { ... } -  ,   "myapp.h".</code> <br> <code>std::string tag("GREETING"); std::string message("Hello from C++!");</code>  - create lines for output to the log. <br> <code>__android_log_print(ANDROID_LOG_INFO, tag.c_str(), "%s", message.c_str());</code>  - output to log.  Please note that you need to specify 4 parameters: the type of message in the log, the tag, the format of the string, and, finally, the message itself. <br> <code>std::string jniMessage("Hello from JNI!");</code>  - a string that we will pass in java. <br> <code>return env-&gt;NewStringUTF(jniMessage.c_str());</code>  - return value, using JNIEnv, create a jstring from a C-string.  Please note that we do not need the construction of the form <code>(*env)-&gt;</code> , since we write in C ++, and not in C. </li></ul><br>  And now we will create another file: stub.cpp, and leave it empty.  The fact is that if you leave only one * .cpp file in the jni folder, then ndk-build will generate an error "no rule to make target". <br><br><h5>  7. Add a call to the native function from Java </h5><br>  Open the file <i>MyApplication / app / src / main / java / com.example.markedone.myapp.FullscreenActivity</i> .  In fact, it has a java extension, and com, example, markedone and myapp are folders, but Android Studio hides it. <br><div class="spoiler">  <b class="spoiler_title">File contents</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.example.markedone.myapp; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.example.markedone.myapp.util.SystemUiHider; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.annotation.TargetApi; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Activity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Build; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Handler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.MotionEvent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-comment"><span class="hljs-comment">/** * An example full-screen activity that shows and hides the system UI (ie * status bar and navigation/system bar) with user interaction. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@see</span></span></span><span class="hljs-comment"> SystemUiHider */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FullscreenActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Whether or not the system UI should be auto-hidden after * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> #AUTO_HIDE_DELAY_MILLIS} milliseconds. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> AUTO_HIDE = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * If {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> #AUTO_HIDE} is set, the number of milliseconds to wait after * user interaction before hiding the system UI. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> AUTO_HIDE_DELAY_MILLIS = <span class="hljs-number"><span class="hljs-number">3000</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * If set, will toggle the system UI visibility upon interaction. Otherwise, * will show the system UI visibility upon interaction. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> TOGGLE_ON_CLICK = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * The flags to pass to {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> SystemUiHider#getInstance}. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> HIDER_FLAGS = SystemUiHider.FLAG_HIDE_NAVIGATION; <span class="hljs-comment"><span class="hljs-comment">/** * The instance of the {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> SystemUiHider} for this activity. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SystemUiHider mSystemUiHider; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_fullscreen); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> View controlsView = findViewById(R.id.fullscreen_content_controls); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> View contentView = findViewById(R.id.fullscreen_content); <span class="hljs-comment"><span class="hljs-comment">// Set up an instance of SystemUiHider to control the system UI for // this activity. mSystemUiHider = SystemUiHider.getInstance(this, contentView, HIDER_FLAGS); mSystemUiHider.setup(); mSystemUiHider .setOnVisibilityChangeListener(new SystemUiHider.OnVisibilityChangeListener() { // Cached values. int mControlsHeight; int mShortAnimTime; @Override @TargetApi(Build.VERSION_CODES.HONEYCOMB_MR2) public void onVisibilityChange(boolean visible) { if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB_MR2) { // If the ViewPropertyAnimator API is available // (Honeycomb MR2 and later), use it to animate the // in-layout UI controls at the bottom of the // screen. if (mControlsHeight == 0) { mControlsHeight = controlsView.getHeight(); } if (mShortAnimTime == 0) { mShortAnimTime = getResources().getInteger( android.R.integer.config_shortAnimTime); } controlsView.animate() .translationY(visible ? 0 : mControlsHeight) .setDuration(mShortAnimTime); } else { // If the ViewPropertyAnimator APIs aren't // available, simply show or hide the in-layout UI // controls. controlsView.setVisibility(visible ? View.VISIBLE : View.GONE); } if (visible &amp;&amp; AUTO_HIDE) { // Schedule a hide(). delayedHide(AUTO_HIDE_DELAY_MILLIS); } } }); // Set up the user interaction to manually show or hide the system UI. contentView.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View view) { if (TOGGLE_ON_CLICK) { mSystemUiHider.toggle(); } else { mSystemUiHider.show(); } } }); // Upon interacting with UI controls, delay any scheduled hide() // operations to prevent the jarring behavior of controls going away // while interacting with the UI. findViewById(R.id.dummy_button).setOnTouchListener(mDelayHideTouchListener); } @Override protected void onPostCreate(Bundle savedInstanceState) { super.onPostCreate(savedInstanceState); // Trigger the initial hide() shortly after the activity has been // created, to briefly hint to the user that UI controls // are available. delayedHide(100); } /** * Touch listener to use for in-layout UI controls to delay hiding the * system UI. This is to prevent the jarring behavior of controls going away * while interacting with activity UI. */ View.OnTouchListener mDelayHideTouchListener = new View.OnTouchListener() { @Override public boolean onTouch(View view, MotionEvent motionEvent) { if (AUTO_HIDE) { delayedHide(AUTO_HIDE_DELAY_MILLIS); } return false; } }; Handler mHideHandler = new Handler(); Runnable mHideRunnable = new Runnable() { @Override public void run() { mSystemUiHider.hide(); } }; /** * Schedules a call to hide() in [delay] milliseconds, canceling any * previously scheduled calls. */ private void delayedHide(int delayMillis) { mHideHandler.removeCallbacks(mHideRunnable); mHideHandler.postDelayed(mHideRunnable, delayMillis); } }</span></span></code> </pre><br></div></div><br>  Add the following code to the FullscreenActivity class: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { System.loadLibrary(<span class="hljs-string"><span class="hljs-string">"myapp"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">native</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stringFromJNI</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre>  Here, the library is loaded first and then the declaration of the <i>stringFromJNI</i> method, which corresponds to our function in C ++.  Please note that it is declared as static (this affects the (jclass or jobject) as the second parameter of the C ++ function) and native.  You do not need to implement the native method, we have already done this in C ++, and the rest is JNI will do for us. <br><br>  Now we, in general, can already call our function.  If you, like me, have chosen FullscreenActivity, then we have a Dummy Button, which, in fact, does nothing.  And even there is already a touch listener, though not the best (it will be called many times while the finger is on the screen), but in order not to produce extra code, we use it. <br><br>  First, add to the import list: <br> <code>import android.widget.Button;</code> <br>  so that you can work normally with the button. <br><br>  Find the following code: <br><pre> <code class="java hljs"> View.OnTouchListener mDelayHideTouchListener = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnTouchListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view, MotionEvent motionEvent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (AUTO_HIDE) { delayedHide(AUTO_HIDE_DELAY_MILLIS); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } };</code> </pre><br>  and add a few lines before <code>return false</code> . <br><pre> <code class="java hljs"> View.OnTouchListener mDelayHideTouchListener = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnTouchListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view, MotionEvent motionEvent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (AUTO_HIDE) { delayedHide(AUTO_HIDE_DELAY_MILLIS); } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String message = stringFromJNI(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Button button = (Button)findViewById(R.id.dummy_button); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String actualText = button.getText().toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(message.equals(actualText)) { button.setText(<span class="hljs-string"><span class="hljs-string">"Dummy Button"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { button.setText(message); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } };</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Description of the code added</b> <div class="spoiler_text"><ul><li> <code>final String message = stringFromJNI();</code>  - get a string from C ++.  The call to the native method is what it was all about. </li><li> <code>final Button button = (Button)findViewById(R.id.dummy_button);</code>  - find the button object. </li><li> <code>final String actualText = button.getText().toString();</code> ‚Äî    . </li><li> <code>if(message.equals(actualText))</code> ‚Äî  ,   C++,   . <ul><li> <code>button.setText("Dummy Button");</code> ‚Äî  ,     Dummy Button. </li><li> <code>button.setText(message);</code> ‚Äî  ,    ,   C++. </li></ul></li></ul><br></div></div><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.example.markedone.myapp; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.example.markedone.myapp.util.SystemUiHider; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.annotation.TargetApi; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Activity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Build; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Handler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.MotionEvent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-comment"><span class="hljs-comment">/** * An example full-screen activity that shows and hides the system UI (ie * status bar and navigation/system bar) with user interaction. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@see</span></span></span><span class="hljs-comment"> SystemUiHider */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FullscreenActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { System.loadLibrary(<span class="hljs-string"><span class="hljs-string">"myapp"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">native</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stringFromJNI</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Whether or not the system UI should be auto-hidden after * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> #AUTO_HIDE_DELAY_MILLIS} milliseconds. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> AUTO_HIDE = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * If {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> #AUTO_HIDE} is set, the number of milliseconds to wait after * user interaction before hiding the system UI. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> AUTO_HIDE_DELAY_MILLIS = <span class="hljs-number"><span class="hljs-number">3000</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * If set, will toggle the system UI visibility upon interaction. Otherwise, * will show the system UI visibility upon interaction. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> TOGGLE_ON_CLICK = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * The flags to pass to {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> SystemUiHider#getInstance}. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> HIDER_FLAGS = SystemUiHider.FLAG_HIDE_NAVIGATION; <span class="hljs-comment"><span class="hljs-comment">/** * The instance of the {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> SystemUiHider} for this activity. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SystemUiHider mSystemUiHider; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_fullscreen); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> View controlsView = findViewById(R.id.fullscreen_content_controls); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> View contentView = findViewById(R.id.fullscreen_content); <span class="hljs-comment"><span class="hljs-comment">// Set up an instance of SystemUiHider to control the system UI for // this activity. mSystemUiHider = SystemUiHider.getInstance(this, contentView, HIDER_FLAGS); mSystemUiHider.setup(); mSystemUiHider .setOnVisibilityChangeListener(new SystemUiHider.OnVisibilityChangeListener() { // Cached values. int mControlsHeight; int mShortAnimTime; @Override @TargetApi(Build.VERSION_CODES.HONEYCOMB_MR2) public void onVisibilityChange(boolean visible) { if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB_MR2) { // If the ViewPropertyAnimator API is available // (Honeycomb MR2 and later), use it to animate the // in-layout UI controls at the bottom of the // screen. if (mControlsHeight == 0) { mControlsHeight = controlsView.getHeight(); } if (mShortAnimTime == 0) { mShortAnimTime = getResources().getInteger( android.R.integer.config_shortAnimTime); } controlsView.animate() .translationY(visible ? 0 : mControlsHeight) .setDuration(mShortAnimTime); } else { // If the ViewPropertyAnimator APIs aren't // available, simply show or hide the in-layout UI // controls. controlsView.setVisibility(visible ? View.VISIBLE : View.GONE); } if (visible &amp;&amp; AUTO_HIDE) { // Schedule a hide(). delayedHide(AUTO_HIDE_DELAY_MILLIS); } } }); // Set up the user interaction to manually show or hide the system UI. contentView.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View view) { if (TOGGLE_ON_CLICK) { mSystemUiHider.toggle(); } else { mSystemUiHider.show(); } } }); // Upon interacting with UI controls, delay any scheduled hide() // operations to prevent the jarring behavior of controls going away // while interacting with the UI. findViewById(R.id.dummy_button).setOnTouchListener(mDelayHideTouchListener); } @Override protected void onPostCreate(Bundle savedInstanceState) { super.onPostCreate(savedInstanceState); // Trigger the initial hide() shortly after the activity has been // created, to briefly hint to the user that UI controls // are available. delayedHide(100); } /** * Touch listener to use for in-layout UI controls to delay hiding the * system UI. This is to prevent the jarring behavior of controls going away * while interacting with activity UI. */ View.OnTouchListener mDelayHideTouchListener = new View.OnTouchListener() { @Override public boolean onTouch(View view, MotionEvent motionEvent) { if (AUTO_HIDE) { delayedHide(AUTO_HIDE_DELAY_MILLIS); } final String message = stringFromJNI(); final Button button = (Button)findViewById(R.id.dummy_button); final String actualText = button.getText().toString(); if(message.equals(actualText)) { button.setText("Dummy Button"); } else { button.setText(message); } return false; } }; Handler mHideHandler = new Handler(); Runnable mHideRunnable = new Runnable() { @Override public void run() { mSystemUiHider.hide(); } }; /** * Schedules a call to hide() in [delay] milliseconds, canceling any * previously scheduled calls. */ private void delayedHide(int delayMillis) { mHideHandler.removeCallbacks(mHideRunnable); mHideHandler.postDelayed(mHideRunnable, delayMillis); } }</span></span></code> </pre><br></div></div><br><h5> 17.     </h5><br>  Build-&gt;Make Project.     Java-. <br>  Run-&gt;Run 'app'.   ,   ,    C++ .     - ,      .   ,      , ,   OK  . <br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/971/48f/4a1/97148f4a1407f0b03410a92dbc251099.png"><img src="https://habrastorage.org/getpro/habr/post_images/6ea/6ec/25d/6ea6ec25d1e6cbf2e558c280a105fbc1.png"></div></div><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/462/a07/218/462a07218c6a451f5ed821c850126231.png"></div></div><br><h4>  Conclusion </h4><br>  ,  Android Studio .  Android SDK   ,   ,     .    , ,  Help me choose.     ‚Äî Gradle, ‚Äî     :     . <br><br> , ,   NDK  ,      .  ,   -    C++-. <br><br> PS  C++    . </div></div></div><p>Source: <a href="https://habr.com/ru/post/228365/">https://habr.com/ru/post/228365/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../228355/index.html">"Stories" from Google. Pure user experience</a></li>
<li><a href="../228357/index.html">New free courses virtual academy Microsoft Virtual Academy, July 2014</a></li>
<li><a href="../228359/index.html">How we created a massive accounting service. Experience of the company "Singuru"</a></li>
<li><a href="../228361/index.html">404 post</a></li>
<li><a href="../228363/index.html">My favorite feature of generators</a></li>
<li><a href="../228367/index.html">Tic-tac-toe: compiler against man - extreme metaprogramming</a></li>
<li><a href="../228369/index.html">Simulation of the world and dynamic systems</a></li>
<li><a href="../228371/index.html">Link Doctrine Entity and Doctrine Document on the form in the Sonata Admin Bundle</a></li>
<li><a href="../228373/index.html">The eight queen problem on Oracle SQL (another solution)</a></li>
<li><a href="../228375/index.html">Effective or effective? Master class on creating a site design</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>