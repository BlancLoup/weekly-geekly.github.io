<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Saving JS and CSS resources in the browser's local storage</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The question of whether to keep javascript and css resources of a web page in the browser's LocalStorage or to allow it to work out caching itself doe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Saving JS and CSS resources in the browser's local storage</h1><div class="post__text post__text-html js-mediator-article">  The question of whether to keep javascript and css resources of a web page in the browser's LocalStorage or to allow it to work out caching itself does not have a definite answer.  There are pros and cons.  From my point of view, the main plus - download speed - outweighs the rest.  This is very well felt by users of EDGE and 3G. <br><br>  For fans of the standard browser cache, proudly pointing to the word ‚ÄúCached‚Äù in Developer Tools, I advise you to open Fiddler and see that for every cached resource, a 304 HTTP response is still sent.  Then I advise you to go to something like pingdom.com and see that the actual transfer of data in the entire execution time of the request takes interest.  That is, the sense in absolute terms of such caching - the cat wept, especially if the files are small. <a name="habracut"></a><br><br>  The proposed storage scheme for resources in LocalStorage is quite simple. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First of all, tracking of changes in files is implemented; for this, the time of the last change of the file as its "version" is used.  When it changes, the resource is reloaded into local storage. <br><br>  The resource is linked as follows: <br><br><pre><code class="php hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(<span class="hljs-string"><span class="hljs-string">"ls.js"</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> requireResource( <span class="hljs-string"><span class="hljs-string">'mobile.css'</span></span>, <span class="hljs-string"><span class="hljs-string">'css'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;?php echo filemtime(__DIR__ . "/css/mobile.css") ?&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;?php echo "/css/mobile.css?" . filemtime(__DIR__ . "/css/mobile.css") ?&gt;'</span></span>); &lt;/script&gt;</code> </pre> <br>  The requireResource function is passed the name of the resource (under this name it will go to the local storage), the type, version and url of the resource.  The ls.js code logic is simple - if the resource is in the repository and its version matches the specified one, it is inline.  If not, it is loaded again, placed in the repository, and inline into the HTML code. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_cacheResource</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name, t, version, url</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xmlhttp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); <span class="hljs-comment"><span class="hljs-comment">// code for IE7+, Firefox, Chrome, Opera, Safari xmlhttp.onreadystatechange = function() { if (xmlhttp.readyState == 4) { if (xmlhttp.status == 200) { localStorage.setItem(name, JSON.stringify({ content: xmlhttp.responseText, type: t, version: version })); } else { console.warn('error loading '+url); } } } xmlhttp.open("GET", url, true); xmlhttp.send(); } function _loadResource(url, type, name, version, callback) { if (type == "js") { document.write('&lt;script id="' + name + '" src="', url, '"&gt;&lt;\/script&gt;\n'); } else if (type == "css") { document.write('&lt;link id="' + name + '" rel="stylesheet" href="', url, '" /&gt;\n'); } var s = document.getElementById(name); if (s.readyState) { //IE s.onreadystatechange = function() { if (s.readyState == "loaded" || s.readyState == "complete") { s.onreadystatechange = null; _cacheResource(name, type, version, url); if (callback) callback(); } }; } else { //Others s.onload = function() { _cacheResource(name, type, version, url); if (callback) callback(); }; } } function _injectResource(content, url, name, version, callback) { var c = JSON.parse(content); // cached version is not the request version, clear the cache, this will trigger a reload next time if (c.version != version) { localStorage.removeItem(name); _loadResource(url, c.type, name, version, callback); return; } if (c.type == "js") { var s = document.createElement('script'); s.type = "text/javascript"; } else if (c.type == "css") { var s = document.createElement('style'); s.type = "text/css"; } var scriptContent = document.createTextNode(c.content); s.appendChild(scriptContent); document.getElementsByTagName("head")[0].appendChild(s); if (callback) callback(); } function requireResource(name, type, version, url, callback) { var c = localStorage.getItem(name); if (c == null) { _loadResource(url, type, name, version, callback); } else { _injectResource(c, url, name, version, callback); } }</span></span></code> </pre><br>  There is a choice how to inline code - or through document.write ();  or by inserting an element into the DOM.  In the first case, we get a copy of how the resource was picked up by the page itself.  The second, in turn, is logically more correct, but there are downsides - js code is not executed, for example.  It is necessary to carry out initialization in manual mode - which is easy, but you need to remember this. <br><br>  Another point - the order of loading resources.  If a certain order is needed, it must be provided for - either by arranging the resources in this order in one file, or by synchronous loading. <br><br>  This example uses 2 types of resources - js and css.  In principle, you can expand on everything that can be serialized into the browser's local storage. <br><br>  The result is obvious - my css and js files no longer appear in the Browser Development Tools and Fiddler (if they are not updated on the server).  The site opens significantly faster.  The process of js and css debugging on production is not very difficult.  And on the development machine, all js and css files are loaded separately for ease of operation. <br><br>  It should be borne in mind that the means of measuring the speed and performance of a site like Google Pagespeed do not understand such self-made caching and will not show a performance boost. <br><br>  The basis of js code is taken from <a href="">GitHub</a> and improved. </div><p>Source: <a href="https://habr.com/ru/post/354630/">https://habr.com/ru/post/354630/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354620/index.html">Kotlin playground</a></li>
<li><a href="../354622/index.html">3 common design mistakes that are easy to fix</a></li>
<li><a href="../354624/index.html">Backend United # 1. Vinaigrette - video, photo report, presentations and feedback from listeners</a></li>
<li><a href="../354626/index.html">Linux Mood Color, Mac OS Mood Color</a></li>
<li><a href="../354628/index.html">Erlang cluster on the knee</a></li>
<li><a href="../354632/index.html">Installing and configuring OpenVPN server using docker-compose</a></li>
<li><a href="../354636/index.html">Visualization in CAD: why we wrote another 3D engine and how it works</a></li>
<li><a href="../354638/index.html">FIDO2 - Passwords must die</a></li>
<li><a href="../354640/index.html">The history of moving the system administrator in Germany. Part Two: Moving and First Steps</a></li>
<li><a href="../354642/index.html">Conclusion of the Telegram channel on your website</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>