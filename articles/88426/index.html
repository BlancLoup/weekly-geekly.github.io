<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating easy access to resources from a ZF controller</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It would be very nice to be able to access resources loaded into bootstrap from application controllers. For example, I would like to access the ‚ÄúDB‚Äù ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating easy access to resources from a ZF controller</h1><div class="post__text post__text-html js-mediator-article">  It would be very nice to be able to access resources loaded into bootstrap from application controllers.  For example, I would like to access the ‚ÄúDB‚Äù resource from the controller as follows $ this-&gt; db; <br>  To do this, we write Action Helper, which will load certain resources into the application controller: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> My_ResourceInjector extends Zend_Controller_Action_Helper_Abstract <br> { <br> <font color="#0000ff">protected</font> $_resources; <br> <br> <font color="#0000ff">public</font> function __construct(array $resources = array()) <br> { <br> $ <font color="#0000ff">this</font> -&gt;_resources = $resources; <br> } <br> <br> <font color="#0000ff">public</font> function preDispatch() <br> { <br> $bootstrap = $ <font color="#0000ff">this</font> -&gt;getBootstrap(); <br> $controller = $ <font color="#0000ff">this</font> -&gt;getActionController(); <br> <font color="#0000ff">foreach</font> ($ <font color="#0000ff">this</font> -&gt;_resources <font color="#0000ff">as</font> $name) { <br> <font color="#0000ff">if</font> ($bootstrap-&gt;hasResource($name)) { <br> $controller-&gt;$name = $bootstrap-&gt;getResource($name); <br> } <br> } <br> } <br> <br> <font color="#0000ff">public</font> function getBootstrap() <br> { <br> <font color="#0000ff">return</font> $ <font color="#0000ff">this</font> -&gt;getFrontController()-&gt;getParam( <font color="#A31515">'bootstrap'</font> ); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  and initialize it in bootstrap: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> Bootstrap extends Zend_Application_Bootstrap_Bootstrap <br> { <br> <font color="#0000ff">protected</font> function _initResourceInjector() <br> { <br> Zend_Controller_Action_HelperBroker::addHelper( <br> <font color="#0000ff">new</font> My_ResourceInjector(array( <br> <font color="#A31515">'db'</font> , <br> <font color="#A31515">'layout'</font> , <br> <font color="#A31515">'navigation'</font> , <br> )); <br> ); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The code above will create links to resources: db, layout, and navigation.  This means that you can now access them directly from the controllers. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> FooController extends Zend_Controller_Action <br> { <br> <font color="#0000ff">public</font> function barAction() <br> { <br> $ <font color="#0000ff">this</font> -&gt;layout-&gt;disableLayout(); <br> $model = $ <font color="#0000ff">this</font> -&gt;getModel(); <br> $model-&gt;setDbAdapter($ <font color="#0000ff">this</font> -&gt;db); <br> $ <font color="#0000ff">this</font> -&gt;view-&gt;assign( <br> <font color="#A31515">'model'</font> =&gt; $ <font color="#0000ff">this</font> -&gt;model, <br> <font color="#A31515">'navigation'</font> =&gt; $ <font color="#0000ff">this</font> -&gt;navigation, <br> ); <br> } <br> <br> <font color="#008000">// ...</font> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  This solution leads to some simplification - now there is no need to pull the bootstrap out of the initialization object, and then pull out the resource. <br>  But, this solution has several problems: How do we know what resources were associated with the controller?  How can we control this? <br>  From here, the decision follows to create a pool of necessary resources for the controller. <br><a name="habracut"></a><br>  New Action Helper resource download will now look like this: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> My_ResourceInjector extends Zend_Controller_Action_Helper_Abstract <br> { <br> <font color="#0000ff">protected</font> $_resources; <br> <br> <font color="#0000ff">public</font> function preDispatch() <br> { <br> $bootstrap = $ <font color="#0000ff">this</font> -&gt;getBootstrap(); <br> $controller = $ <font color="#0000ff">this</font> -&gt;getActionController(); <br> <br> <font color="#0000ff">if</font> (!isset($controller-&gt;dependencies) <br> || !is_array($controller-&gt;dependencies) <br> ) { <br> <font color="#0000ff">return</font> ; <br> } <br> <br> <font color="#0000ff">foreach</font> ($controller-&gt;dependencies <font color="#0000ff">as</font> $name) { <br> <font color="#0000ff">if</font> ($bootstrap-&gt;hasResource($name)) { <br> $controller-&gt;$name = $bootstrap-&gt;getResource($name); <br> } <br> } <br> } <br> <br> <font color="#0000ff">public</font> function getBootstrap() <br> { <br> <font color="#0000ff">return</font> $ <font color="#0000ff">this</font> -&gt;getFrontController()-&gt;getParam( <font color="#A31515">'bootstrap'</font> ); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  You still have to register it with bootstrap, but now without specifying a list of resources: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> Bootstrap extends Zend_Application_Bootstrap_Bootstrap <br> { <br> <font color="#0000ff">protected</font> function _initResourceInjector() <br> { <br> Zend_Controller_Action_HelperBroker::addHelper( <br> <font color="#0000ff">new</font> My_ResourceInjector(); <br> ); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Instead, the required list of resources you now define in the controller itself: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> FooController extends Zend_Controller_Action <br> { <br> <font color="#0000ff">public</font> $dependencies = array( <br> <font color="#A31515">'db'</font> , <br> <font color="#A31515">'layout'</font> , <br> <font color="#A31515">'navigation'</font> , <br> ); <br> <br> <font color="#0000ff">public</font> function barAction() <br> { <br> $ <font color="#0000ff">this</font> -&gt;layout-&gt;disableLayout(); <br> $model = $ <font color="#0000ff">this</font> -&gt;getModel(); <br> $model-&gt;setDbAdapter($ <font color="#0000ff">this</font> -&gt;db); <br> $ <font color="#0000ff">this</font> -&gt;view-&gt;assign( <br> <font color="#A31515">'model'</font> =&gt; $ <font color="#0000ff">this</font> -&gt;model, <br> <font color="#A31515">'navigation'</font> =&gt; $ <font color="#0000ff">this</font> -&gt;navigation, <br> ); <br> } <br> <br> <font color="#008000">// ...</font> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  This creates a clearer understanding of what resources are needed by the controller, and also, each controller receives exactly the resources that it will use. <br><br>  Another improvement that we can add to the resource loader is that if a dependent resource was not found, an exception will be thrown: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> My_ResourceInjector extends Zend_Controller_Action_Helper_Abstract <br> { <br> <font color="#0000ff">protected</font> $_resources; <br> <br> <font color="#0000ff">public</font> function preDispatch() <br> { <br> $bootstrap = $ <font color="#0000ff">this</font> -&gt;getBootstrap(); <br> $controller = $ <font color="#0000ff">this</font> -&gt;getActionController(); <br> <br> <font color="#0000ff">if</font> (!isset($controller-&gt;dependencies) <br> || !is_array($controller-&gt;dependencies) <br> ) { <br> <font color="#0000ff">return</font> ; <br> } <br> <br> <font color="#0000ff">foreach</font> ($controller-&gt;dependencies <font color="#0000ff">as</font> $name) { <br> <font color="#0000ff">if</font> (!$bootstrap-&gt;hasResource($name)) { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> DomainException( <font color="#A31515">"Unable to find dependency by name '$name'"</font> ); <br> } <br> $controller-&gt;$name = $bootstrap-&gt;getResource($name); <br> } <br> } <br> <br> <font color="#0000ff">public</font> function getBootstrap() <br> { <br> <font color="#0000ff">return</font> $ <font color="#0000ff">this</font> -&gt;getFrontController()-&gt;getParam( <font color="#A31515">'bootstrap'</font> ); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This gives us a better understanding and tracking of dependent resources.  Resources are determined by the object that needs them, and the missing resources will cause an exception. <br><br>  One potential improvement that can be made is an indication of the list of resources that are automatically downloaded for each controller.  To implement this, it will be necessary to merge the default list with the resources defined in the controller.  I leave this task to my readers. <br><br>  The area of ‚Äã‚ÄãAction Helpers is poorly explored by ZF users.  I hope this post shows how strongly Action Helpers can automate repetitive and common tasks. <br><br>  <em>This article is a partial translation of the article by <a href="http://weierophinney.net/matthew/archives/235-A-Simple-Resource-Injector-for-ZF-Action-Controllers.html">Matthew Weier O'Phinney A Simple Resource Injector for ZF Action Controllers</a> .</em> </div><p>Source: <a href="https://habr.com/ru/post/88426/">https://habr.com/ru/post/88426/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../88417/index.html">TSLab - trading systems laboratory</a></li>
<li><a href="../88419/index.html">We add devices in the sealed case or "How to cram in nevi"</a></li>
<li><a href="../88422/index.html">Programmers got to the newborns</a></li>
<li><a href="../88423/index.html">Portable Lie Detector Test</a></li>
<li><a href="../88425/index.html">The whole truth about Money@Mail.Ru</a></li>
<li><a href="../88427/index.html">Moon car</a></li>
<li><a href="../88428/index.html">Must Have Software for Nexus One. Personal experience</a></li>
<li><a href="../88429/index.html">Asus-O! Play-HDP-R3 - what it is</a></li>
<li><a href="../88430/index.html">Opera 10.51 for Windows has been released</a></li>
<li><a href="../88431/index.html">Opera 10.51 for Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>