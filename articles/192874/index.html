<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Evolution of modular javascript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most likely, when Brendan Ike designed JavaScript, he could not imagine how his project would evolve twenty years later. At the moment, there are alre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Evolution of modular javascript</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/2ce/d17/13e/2ced1713ed394e28b5d894d1679474bd.jpg"><br><br>  Most likely, when Brendan Ike designed JavaScript, he could not imagine how his project would evolve twenty years later.  At the moment, there are already six main specifications of the language, and the work on its improvement is still ongoing. <br><br>  Let's not be cunning: JavaScript has never been an ideal programming language.  One of the weaknesses in JS was modularity, or rather its absence.  Indeed, why in the scripting language, which animates the snowflakes falling on the page and validates the form, to take care of code isolation and dependencies?  After all, everything can live beautifully and communicate with each other in one global area - the window. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Over time, JavaScript was transformed into a general purpose language, so it began to be used to build complex applications in various environments (browser, server).  At the same time, it was impossible to rely on the old approaches to the interaction of program components through the global area: as the code grew, the application became very fragile.  As a result, various modularity implementations were created to simplify the development process. <br><br>  This article appeared as a result of communication with TC39 participants and framework developers, as well as reading source codes, blogs and books.  We consider the following approaches / formats: Namespace, Module, Detached Dependency Definitions, Sandbox, Dependency Injection, CommonJS, AMD, UMD, Labeled Modules, YModules, and ES2015 Modules.  In addition, we will restore the historical context of their appearance and development. <br><a name="habracut"></a><br><h2>  Content </h2><br><ul><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">Terms Used</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">More about problems</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">Directly Defined Dependencies (1999)</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">Namespace Pattern (2002)</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">Module Pattern (2003)</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">Template Defined Dependencies (2006)</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">Comment Defined Dependencies (2006)</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">Externally Defined Dependencies (2007)</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">Sandbox Pattern (2009)</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">Dependency Injection (2009)</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">CommonJS Modules (2009)</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">AMD (2009)</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">UMD (2011)</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">Labeled Modules (2012)</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">YModules (2013)</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">ES2015 Modules (2015)</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/192874/">Total</a> </li></ul><br><a name="defining-the-used-terms"></a><h2>  Terms Used </h2><br>  Modularity solves the <a href="http://blog.calyptus.eu/seb/2011/10/choosing-a-javascript-module-syntax/">following tasks</a> : providing support for code isolation, determining dependencies between modules, and delivering code to the runtime environment.  Some of the approaches listed above solved only one or two of these problems ‚Äî we will call such solutions ‚Äúpatterns‚Äù, and those where all three tasks are solved ‚Äî ‚Äúmodular systems‚Äù. <br><br>  The specific structure of the source code with the definition of imported and exported entities (the second type includes objects, functions, etc.) will be called the "format of modules". <br><br>  The term ‚Äúdetached definition of dependencies‚Äù (detached dependency definition, DDD) will be understood as such dependency definition approaches that can be used independently of modular systems. <br><br><br><a name="a-little-more-about-problems"></a><h2>  More about problems </h2><br>  Before diving into the world of modularity, let's look more closely at what problems we face. <br><br><h4>  Name collision </h4><br>  Since its inception, JavaScript has used the global window object as a repository of all defined variables without the <code>var</code> keyword.  In 1995-1999, it was very convenient because of the small amount of client JavaScript code on the pages.  But with the increase in the amount of code, this feature began to lead to frequent errors due to the name collision.  Let's look at an example: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  greeting.js var helloInLang = { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }; function writeHello(lang) { document.write(helloInLang[lang]); } //  hello.js function writeHello() { document.write('The script is broken'); }</span></span></code> </pre><br><br>  When <code>greeting.js</code> connected to the page and then <code>hello.js</code> , we will receive the message ‚ÄúThe script is broken‚Äù instead of a greeting because of a collision. <br><br>  Obviously, in large projects this can cause a lot of headaches.  Moreover, you cannot be sure that third-party scripts connected to the page will break nothing in your application. <br><br><h4>  Large code base support </h4><br>  Another uncomfortable point when using out-of-the-box javascript to build large applications is the need to explicitly specify the included scripts using the script tag. <br><br>  If you make sure that the source code is convenient for support, you break it down into independent parts.  Thus, there may be a lot of code files.  With a large number of files, manual management of scripts (that is, the definition of connected scripts via the script tag) is very complicated: first, you need to remember to connect the necessary scripts to the page, and second, to distribute the sequence of script tags so that all dependencies between files were allowed. <br><br><br><a name="directly-defined-dependencies-1999"></a><h2>  Directly Defined Dependencies (1999) </h2><br>  The first attempt to introduce a modular structure in JavaScript, as well as the first implementation of a separate definition of dependencies, was the direct definition of dependencies in code (directly defined dependencies).  <a href="https://github.com/arv">Erik Arvidsson</a> (now a member of TC39) was one of the first to use this pattern back in 1999. <br><br>  Eric then worked in a startup where a platform was created for launching GUI applications in the browser ‚Äî WebOS (note: this is not about Palm‚Äôs webOS).  WebOS was a proprietary platform ‚Äî I could not get its source code.  Therefore, we consider the implementation of the pattern on the example of the Dojo library, which since 2004 has been developed by Alex Russell and Dylan Skiemann. <br><br>  The essence of the direct definition of dependencies is to load the code of the modules (in terms of Dojo - resources) with the explicit execution of the function <code>dojo.require</code> (which, in addition, initialized the loaded module).  With this approach, dependencies are determined by the place of demand, right in the code. <br><br>  Let's redo our example using Dojo 1.6: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  greeting.js dojo.provide("app.greeting"); app.greeting.helloInLang = { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }; app.greeting.sayHello = function (lang) { return app.greeting.helloInLang[lang]; }; //  hello.js dojo.provide("app.hello"); dojo.require('app.greeting'); app.hello = function(x) { document.write(app.greeting.sayHello('es')); };</span></span></code> </pre><br><br>  Here we see that modules are defined using the <code>dojo.provide</code> function, and the code itself is loaded when the <code>dojo.require</code> function is <code>dojo.require</code> .  This is a fairly simple approach that was used in Dojo before version 1.7 and is still used in the <a href="https://github.com/google/closure-library">Google Closure Library</a> . <br><br><br><a name="the-namespace-pattern-2002"></a><h2>  Namespace Pattern (2002) </h2><br>  The first attempt to solve the problem of name collision was to introduce agreements.  For example, one could add a certain prefix to the names of all variables and functions: <code>myApp_</code> ( <code>myApp_address</code> , <code>myApp_validateUser()</code> ) or some other.  Of course, this did not fundamentally change the situation, so that later developers began to use a key feature of JavaScript: the functions in it are first-class objects. <br><br>  An object of the first class is an entity that can be assigned to variables and properties of objects and returned from other functions.  That is, you can create objects with the same function properties (methods) as for the document and window objects ( <code>document.write()</code> , <code>window.alert()</code> ). <br><br>  One of the first significant projects where this feature was used is the Bindows UI element library.  Erik Arvidsson, already familiar to us, began working on it in 2002.  Instead of prefixes in the names of functions and variables, he used a global object whose properties contained the data and logic of the library.  Thus, pollution of the global area has been significantly reduced.  Now a similar pattern for organizing code is known as the Namespace Pattern. <br><br>  Let's put this idea to our example. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  app.js var app = {}; //  greeting.js app.helloInLang = { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }; //  hello.js app.writeHello = function (lang) { document.write(app.helloInLang[lang]);</span></span></code> </pre><br><br>  As we can see, the logic and data are now contained in the properties of the <code>app</code> object.  This reduces the pollution of the global area, but we continue to have access to the necessary parts of the application from different files. <br><br>  To date, the Namespace Pattern is probably the most popular pattern that can be found in JS.  After Bindows, similar logic appeared in Dojo (2005), YUI (2005) and many other libraries and frameworks.  It is worth noting that Eric <a href="https://twitter.com/erikarvidsson/status/819368206984826880">does not consider</a> himself the author of this approach, but unfortunately he could not recall which project inspired him to use the pattern. <br><br><br><a name="the-module-pattern-2003"></a><h2>  Module Pattern (2003) </h2><br>  Thanks to Namespace, the organization of the code became a little less erratic, but it was obvious that this was not enough: the problem of isolating code and data had not yet been solved. <br><br>  The pioneer in solving this problem is the ‚ÄúModule‚Äù pattern.  The idea behind the pattern is to encapsulate data and code using a closure and make it accessible through methods that, in turn, are accessible from the outside.  Here is a basic example of such a module: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> greeting = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = {}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> helloInLang = { <span class="hljs-attr"><span class="hljs-attr">en</span></span>: <span class="hljs-string"><span class="hljs-string">'Hello world!'</span></span>, <span class="hljs-attr"><span class="hljs-attr">es</span></span>: <span class="hljs-string"><span class="hljs-string">'¬°Hola mundo!'</span></span>, <span class="hljs-attr"><span class="hljs-attr">ru</span></span>: <span class="hljs-string"><span class="hljs-string">', !'</span></span> }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.getHello = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">lang</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> helloInLang[lang]; }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.writeHello = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">lang</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.write(<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.getHello(lang)) }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>; }());</code> </pre><br><br>  Here we see a self-calling function ‚Äî one that runs immediately after the declaration.  It returns a <code>module</code> object, where there is a <code>getHello()</code> method that accesses the <code>helloInLang</code> object through a closure.  Thus, <code>helloInLang</code> becomes inaccessible from the outside world and we get an atomic piece of code that can be inserted into any other script without a name conflict - even if the <code>helloInLang</code> object <code>helloInLang</code> been declared <code>helloInLang</code> . <br><br>  The first mention of this approach appeared on the network in 2003, when Richard Cornford gave <a href="https://groups.google.com/forum/">an example of a</a> module in the comp.lang.javascript group as an illustration of the use of closures.  In 2005‚Äì2006, this approach was adopted by the developers of the YUI framework from Yahoo!  under the direction of Douglas Crockford.  But the greatest impulse for its distribution was given in 2008, when Douglas described the ‚ÄúModule‚Äù pattern in his book JavaScript JavaScript Good Parts. <br><br>  But that's not all.  In the article <a href="http://www.adequatelygood.com/JavaScript-Module-Pattern-In-Depth.html">"JavaScript Module Pattern: In-Depth"</a> (here is a <a href="https://habrahabr.ru/post/117069/">translation in Habrahabr</a> ) there are many different options for implementing a module.  I recommend to look. <br><br><br><a name="template-defined-dependencies-2006"></a><h2>  Template Defined Dependencies (2006) </h2><br>  The template definition of dependencies is the next pattern in the family of separate definitions.  The earliest project I found where this approach is involved is <a href="">Prototype 1.4</a> (2006), but I suspect that it was used in earlier versions of the library. <br><br>  Prototype has been developed since 2005 by <a href="https://github.com/sstephenson">Sam Stephensen</a> as a client part of the Ruby on Rails framework.  Since Sam worked a lot with Ruby, it's no wonder that for managing dependencies between files, he chose regular templating with erb. <br><br>  If you try to summarize, you can say that dependencies in this pattern are determined by including special labels in the target file.  Both common templates (erb, jinja, smarty) and special build tools, such as <a href="https://github.com/borschik/borschik">borshik,</a> can be used <a href="https://github.com/borschik/borschik">here</a> . <br><br>  When using template dependencies - in contrast to the previously considered patterns of separate definition - a preliminary assembly step is required. <br><br>  Let's transform our example using the described style.  To do this, use borshik: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  app.tmp.js /*borschik:include:../lib/main.js*/ /*borschik:include:../lib/helloInLang.js*/ /*borschik:include:../lib/writeHello.js*/ //  main.js var app = {}; //  helloInLang.js app.helloInLang = { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }; //  writeHello.js app.writeHello = function (lang) { document.write(app.helloInLang[lang]); };</span></span></code> </pre><br><br>  Here the app.tmp.js file defines the included scripts and their order.  If you reflect on the example, it becomes clear that this approach does not fundamentally change the life of the developer.  Instead of using script tags, other labels in the js file are simply used.  In other words, we can still forget something or confuse the order of the connected scripts.  Therefore, the main purpose of this approach is to ensure the assembly of a single js-file from many others. <br><br><br><a name="comment-defined-dependencies-2006"></a><h2>  Comment Defined Dependencies (2006) </h2><br>  Another subtype of separate definition of dependencies is the definition of dependencies using comments.  It is very similar to the direct definition, but in this case, comments are used instead of language constructions that contain information about the dependencies of the module. <br><br>  An application using this approach should be pre-built - as was done in 2006 to build <a href="">MooTools</a> , which <a href="https://github.com/kamicane">Valerio Proietti</a> developed, - or it should parse the source code at the execution stage and then load all dependencies that were defined using comments.  On the basis of the latter approach, the <a href="https://github.com/bevacqua/lazyjs">LazyJS</a> library of <a href="https://github.com/bevacqua">Nicholas Bevacqua is implemented</a> . <br><br>  This is how our example will look like if you rewrite it using LazyJS: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  helloInLang.js var helloInLang = { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }; //  sayHello.js /*! lazy require scripts/app/helloInLang.js */ function sayHello(lang) { return helloInLang[lang]; } //  hello.js /*! lazy require scripts/app/sayHello.js */ document.write(sayHello('en'));</span></span></code> </pre><br><br>  The most famous library where this approach is used is MooTools.  LazyJS was an interesting experiment, but it appeared after CommonJS and AMD and therefore did not receive much attention from the developers. <br><br><br><a name="externally-defined-dependencies-2007"></a><h2>  Externally Defined Dependencies (2007) </h2><br>  Let's look at the last pattern in the DDD family.  When externally defining dependencies, they are all defined outside the main context - for example, in the configuration file or in the code as an object or an array.  At the same time, there is a stage of preliminary preparation, during which the application is initialized with loading all dependencies in the correct order based on the information about them. <br><br>  The earliest use of this approach, which I could find, dates back to 2007.  We are talking about the library <a href="">MooTools 1.1</a> . <br><br>  In the simplest case, we can implement our example using this pattern as follows (as a sample I will use my own experimental implementation of the <a href="https://github.com/myshov/eddloader">loader</a> , where the desired pattern is involved): <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  deps.json { "files": { "main.js": ["sayHello.js"], "sayHello.js": ["helloInLang.js"], "helloInLang.js": [] } } //  helloInLang.js var helloInLang = { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }; //  sayHello.js function sayHello(lang) { return helloInLang[lang]; } //  main.js console.log(sayHello('en'));</span></span></code> </pre><br><br>  The <code>deps.json</code> file is the external context where all dependencies are defined.  When the application starts, the loader gets the file, reads dependencies from it, which are defined as an array, loads them and connects to the page in the correct order. <br><br>  At the moment, this approach is used in some libraries to create custom assemblies, for example, in <a href="">lodash</a> . <br><br><br><a name="the-sandbox-pattern-2009"></a><h2>  Sandbox Pattern (2009) </h2><br>  The Yahoo! programmers who worked on the new modular system YUI3 solved the problem of using different versions of the library on the same page.  Before YUI3, the modular system in the framework was implemented by a combination of the Module and Namespace patterns.  Obviously, with such a scheme, the root object containing the library code could be only one and, therefore, it was difficult to use several versions at once. <br><br>  To solve this problem, one of the developers of YUI3, <a href="https://twitter.com/admo/with_replies">Adam Moore,</a> suggested using the Sandbox.  A simple implementation of modularity using this pattern might look like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  sandbox.js function Sandbox(callback) { var modules = []; for (var i in Sandbox.modules) { modules.push(i); } for (var i = 0; i &lt; modules.length; i++) { this[modules[i]] = Sandbox.modules[modules[i]](); } callback(this); } //  greeting.js Sandbox.modules = Sandbox.modules || {}; Sandbox.modules.greeting = function () { var helloInLang = { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }; return { sayHello: function (lang) { return helloInLang[lang]; } }; }; //  app.js new Sandbox(function(box) { document.write(box.greeting.sayHello('es')); });</span></span></code> </pre><br><br>  The essence of the approach is in two words - instead of a global object, a global constructor is used, and modules in turn can be defined as its properties. <br><br>  The sandbox served as an interesting solution to the problem of modularity, but was not particularly popular outside of YUI3.  If you want to learn more about Sandbox, I recommend the article <a href="https://www.kenneth-truyers.net/2016/04/25/javascript-sandbox-pattern/">"Javascript Sandbox Pattern"</a> , as well as the official YUI documentation about creating <a href="http://yuilibrary.com/yui/docs/yui/create.html">new</a> library <a href="http://yuilibrary.com/yui/docs/yui/create.html">modules</a> . <br><br><br><a name="dependency-injection-2009"></a><h2>  Dependency Injection (2009) </h2><br>  In 2004, Martin Fowler introduced the concept of ‚Äú <a href="https://martinfowler.com/articles/injection.html">dependency injection</a> ‚Äù (DI) to describe the new component communication mechanism in Java.  The main point is that all dependencies "come" from outside the component.  In other words, the component is not responsible for initializing its dependencies, but only using them. <br><br>  Five years later, <a href="https://github.com/mhevery">Mishko Heveri</a> , a former employee of Sun and Adobe (where he was involved, including development in Java), started designing a JavaScript framework for his startup, where dependency injection was a key mechanism for interconnecting components.  The idea of ‚Äã‚Äãa business has not proven its effectiveness, but the source code of the framework was decided to be put on the getangular.com startup domain.  Most people know what happened next: Google took Mischko and his project under the wing and now Angular is one of the most well-known JavaScript frameworks. <br><br>  Modules in Angular are implemented using the DI mechanism.  However, modularity is not the primary purpose of DI: Mishko also clearly speaks about this in response to the <a href="http://www.alexrothenberg.com/2013/02/11/the-magic-behind-angularjs-dependency-injection.html">corresponding question</a> . <br><br>  To illustrate the approach, let's rewrite our example using the first version of Angular (yes, the example was extremely synthetic): <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  greeting.js angular.module('greeter', []) .value('greeting', { helloInLang: { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }, sayHello: function(lang) { return this.helloInLang[lang]; } }); //  app.js angular.module('app', ['greeter']) .controller('GreetingController', ['$scope', 'greeting', function($scope, greeting) { $scope.phrase = greeting.sayHello('en'); }]);</span></span></code> </pre><br><br>  If you open a page with an example in the browser, then the code will <a href="http://www.alexrothenberg.com/2013/02/11/the-magic-behind-angularjs-dependency-injection.html">magically</a> work out and we will see the result on the page. <br><br>  Now the DI mechanism is used in the <a href="https://github.com/angular/angular">Angular 2</a> and <a href="https://github.com/2gis/slot">Slot</a> frameworks.  There are also a large number of libraries that simplify the use of this approach in applications that are independent of any frameworks. <br><br><br><a name="commonjs-modules-2009"></a><h2>  CommonJS Modules (2009) </h2><br>  Together with browser-based JavaScript engines, even before the advent of Node.js, <a href="https://en.wikipedia.org/wiki/Comparison_of_server-side_JavaScript_solutions">server development platforms were developed</a> using JavaScript as the main language.  Due to the lack of relevant specifications, server solutions did not provide a unified API for working with the operating system and the external environment (file system, network, environment variables, etc.), thus creating problems with code distribution.  For example, scripts written for the old Netscape Enterprise Server did not work in Rhino and vice versa. <br><br>  In 2009, a turning point came - Mozilla employee <a href="https://github.com/dangoor">Kevin Dangur</a> published a <a href="http://www.blueskyonmars.com/2009/01/29/what-server-side-javascript-needs/">post</a> about server-side JavaScript issues.  In a post, he called on all interested to join an informal committee to discuss and develop a server-side JavaScript API.  The project that started the work was named ServerJS;  but later it was renamed CommonJS. <br><br>  Work has begun to boil.  Developers received the most attention from the specification of the format of modules in JavaScript - <a href="http://www.commonjs.org/specs/modules/1.0/">CommonJS Modules</a> (sometimes called CJS or just CommonJS), which was ultimately implemented in Node.js. <br><br>  To demonstrate the CommonJS module, let's adapt our module as follows: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  greeting.js var helloInLang = { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }; var sayHello = function (lang) { return helloInLang[lang]; } module.exports.sayHello = sayHello; //  hello.js var sayHello = require('./lib/greeting').sayHello; var phrase = sayHello('en'); console.log(phrase);</span></span></code> </pre><br><br>  Here we see that for the implementation of modularity, new entities of <code>require</code> and <code>exports</code> (aliases on <code>module.exports</code> ) are <code>module.exports</code> , which make it possible to load the module and provide its interface to the outside world.  It is worth noting that neither <code>require</code> , nor <code>exports</code> , nor module are the keywords of the language - they appear in Node.js due to the wrapper, where all modules are wrapped, before going to run in a JavaScript engine: <br><br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">exports, require, module, __filename, __dirname</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... // Your code is injected here! // ... });</span></span></code> </pre><br><br>  The CommonJS specification defines only the minimum necessary for interoperability of modules in various environments.  So, CommonJS mechanisms can be expanded.  For example, Node.js does this by adding to the <code>require</code> property a <a href="https://nodejs.org/api/modules.html">main</a> , which indicates the <code>module</code> if the file with the module was launched directly. <br><br>  Babel also expands the <code>require</code> for a module with a default export in the format of ES2015 Modules (we will talk about this modular system at the end of the article): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> something;</code> </pre><br><br>  Babel converts a similar export to a CommonJS module, where the default value is exported using the corresponding property.  That is, simply, the following code is obtained: <br><br><pre> <code class="javascript hljs">exports.default = something;</code> </pre><br><br>  The webpack build system also uses various extensions, such as <code>require.ensure</code> , <code>require.cache</code> , <code>require.context</code> , but discussing them lies outside the context of the article. <br><br>  Today CommonJS is the most common format for modules.  This format is used not only in Node.JS - it can also be used when developing client web applications, collecting all modules into a single file using <a href="http://browserify.org/">Browserify</a> or <a href="https://webpack.js.org/">webpack</a> . <br><br><br><a name="amd-2009"></a><h2>  AMD (2009) </h2><br>  When the development of the CommonJS specification was well under way, there was occasional <a href="https://groups.google.com/forum/">vigorous discussion</a> in the mailing list about adding asynchronous module loading capabilities to the specification.  It would allow to speed up the loading of web applications consisting of a large number of files and eliminate the need to build to deliver code to users. <br><br>  Kevin's fellow worker at Mozilla, <a href="https://github.com/jrburke">James Burke,</a> was one of the most active supporters of asynchronous loading in all discussions.  James could be an expert because he was the author of an asynchronous modular system in the Dojo 1.7 framework.  In addition, it was he who in 2009 developed the <a href="http://requirejs.org/">require.js</a> loader. <br><br>  ,    , ‚Äî        (  ,    );        .          ,    AMD (Asynchronous Module Definition). <br><br>         AMD,     : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// file lib/greeting.js define(function() { var helloInLang = { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }; return { sayHello: function (lang) { return helloInLang[lang]; } }; }); // file hello.js define(['./lib/greeting'], function(greeting) { var phrase = greeting.sayHello('en'); document.write(phrase); });</span></span></code> </pre><br><br>   hello.js     .     <code>define</code> ,   .         .      ,        <code>define</code> ,  ,      .              . <br><br>  2011      :           AMD,     CommonJS     <a href="https://groups.google.com/forum/">  </a> . <br><br>     ,  AMD      ,         npm    bower    AMD    . <br><br><br><a name="umd-2011"></a><h2> UMD (2011) </h2><br>           ,  AMD   CommonJS Modules.     AMD   ,           .   CommonJS Modules -   Node.js   Browserify    . <br><br>      ,       . AMD-        ,   CommonJS Modules (Node.js),   CommonJS     ,  AMD: RequireJS, curl.js. ,     RequireJS    CommonJS-,         .               UMD ‚Äî <a href="https://github.com/umdjs/umd">Universal Module Definition</a> . <br><br>        ‚Äî    .        UMD  GitHub <a href="https://github.com/addyosmani"> </a> .  <a href="https://twitter.com/addyosmani/status/732834573340528640%3Freplies_view%3Dtrue%26cursor%3DABAXCjjOKwo">  </a>    <a href="https://github.com/kriskowal"> </a> ,  ,   ,      <a href="https://github.com/kriskowal/q">Q</a> . <br><br>      Q     :   (     script)     Node.js  Narwhal ( CommonJS Modules).  ,         Q  AMD.           ,    UMD.             UMD. <br><br>              CommonJS  AMD: <br><br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">define</span></span></span><span class="hljs-function">) </span></span>{ define(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> helloInLang = { <span class="hljs-attr"><span class="hljs-attr">en</span></span>: <span class="hljs-string"><span class="hljs-string">'Hello world!'</span></span>, <span class="hljs-attr"><span class="hljs-attr">es</span></span>: <span class="hljs-string"><span class="hljs-string">'¬°Hola mundo!'</span></span>, <span class="hljs-attr"><span class="hljs-attr">ru</span></span>: <span class="hljs-string"><span class="hljs-string">', !'</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">sayHello</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">lang</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> helloInLang[lang]; } }; }); }( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> === <span class="hljs-string"><span class="hljs-string">'object'</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> define !== <span class="hljs-string"><span class="hljs-string">'function'</span></span> ? <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">factory</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = factory(); } : define ));</code> </pre><br><br>        ,         .       : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">factory</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = factory(); }</code> </pre><br><br>      CommonJS-.      AMD-,      define.           . <br><br>   ,          ,   Node.js,    UMD.   UMD     ,   <a href="">moment.js</a>  <a href="">lodash</a> . <br><br><br><a name="labeled-modules-2012"></a><h2> Labeled Modules (2012) </h2><br>  2010    39        JavaScript.      ES6 Modules.  2012     ,     .    , <a href="https://github.com/sebmarkbage"> </a> (      React),       . ,        ,    ES3,     ,   ,    .    <a href="https://github.com/sebmarkbage/labeled-modules-spec/wiki">Labeled Modules</a> . <br><br>   ‚Äî  <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/label"></a> (labels).    import  export   ,          :    ‚Äî exports,   ‚Äî require. <br><br>  ,    ,     . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  greeting.js var helloInLang = { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }; exports: var greeting = { sayHello: function (lang) { return helloInLang[lang]; } }; //  hello.js require: './lib/greeting'; var phrase = greeting.sayHello('es'); document.write(phrase);</span></span></code> </pre><br><br>     ,  Labeled Modules,   <a href=""></a> . <br><br>   ,   .    2012     CommonJS  AMD,     .  ,    Labeled Modules    <a href="https://webpack.github.io/docs/api-in-modules.html">webpack</a> ,    JS-     . <br><br><br><a name="ymodules-2013"></a><h2> YModules (2013) </h2><br>                   ;).      - ,       CommonJS  AMD?   ,             ,        CommonJS,  AMD  . <br><br>     .    API ( API .)  ,  JS-        .  ,      <a href="https://ru.bem.info/methodology/key-concepts/">  </a> ,   ‚Äî  . <br><br>  2013          ,      <a href="https://github.com/dfilatov"> </a> <a href="https://habrahabr.ru/users/dfilatov/" class="user_link">dfilatov</a> . <br><br>       <a href="https://github.com/ymaps/modules">YModules</a> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  greeting.js modules.define('greeting', function(provide) { provide({ helloInLang: { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }, sayHello: function (lang) { return this.helloInLang[lang]; } }); }); //  app.js modules.require(['greeting'], function(greeting) { document.write(greeting.sayHello('ru')); }); // : ", !"</span></span></code> </pre><br><br> YModules     AMD.   ‚Äî           <code>provide</code> ,   <code>return</code> . <br><br>     ¬´¬ª    ,         . ,     greeting.js -   (   ‚Äî <code>setTimeout</code> ),   ,    ,   : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  greeting.js modules.define('greeting', function(provide) { //     1  setTimeout(function () { provide({ helloInLang: { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }, sayHello: function (lang) { return this.helloInLang[lang]; } }); }, 1000); }); // : app.js modules.require(['greeting'], function(greeting) { document.write(greeting.sayHello('ru')); }); // : ", !"</span></span></code> </pre><br><br>    ,     YModules      .     . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  moduleOnLevel1.js modules.define('greeting', function(provide) { provide({ helloInLang: { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }, sayHello: function (lang) { return this.helloInLang[lang]; } }); }); //  moduleOnLevel2.js modules.define('greeting', function(provide, module) { //   sayHello module.sayHello = function (lang) { return module.helloInLang[lang].toUpperCase(); }; provide(module); }); //  app.js modules.require(['greeting'], function(greeting) { document.write(greeting.sayHello('ru')); }); // : ", !"</span></span></code> </pre><br><br>    ,  <code>sayHello</code>     <code>greeting</code>   ,        .   ,   YModules               (, <code>module</code>    ). <br><br>    YModules    .        <a href="https://ru.bem.info/platform/i-bem/">i-bem.js</a> . <br><br><br><a name="es2015-modules-2015"></a><h2> ES2015 Modules (2015) </h2><br>   ECMAScript (TC39), ,   ,     JavaScript.  ,        . <br><br>  2010      <a href="http://wiki.ecmascript.org/doku.php%3Fid%3Dharmony:modules%26rev%3D1300916920"> </a>     Mozilla <a href="https://github.com/dherman"> </a> .        ,      .               asm.js, emscripten, servo. <br><br>  ,  2015     ES2015, ,   ,      <a href="http://www.ecma-international.org/ecma-262/6.0/"> </a> .      : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  lib/greeting.js const helloInLang = { en: 'Hello world!', es: '¬°Hola mundo!', ru: ', !' }; export const greeting = { sayHello: function (lang) { return helloInLang[lang]; } }; //  hello.js import { greeting } from "./lib/greeting"; const phrase = greeting.sayHello("ru"); document.write(phrase);</span></span></code> </pre><br><br>   ,    <a href="https://hacks.mozilla.org/2015/08/es6-in-depth-modules/">  </a>       <code>import</code>      <code>export</code> . <br><br> - ,         ,     ,   Module Loader API,        ,   ,            . <br><br> , ES2015       .       ,     ES5,      <a href="https://github.com/babel/babel">Babel</a> :    . <br><br><br><a name="conclusion"></a><h2>  Total </h2><br>         JS.        ,  <a href="http://requirejs.org/docs/api.html"> </a> ,     <a href=""> </a> ,  -    <a href=""> </a> .    ‚Äî   ,      -    .   , ,       ,   -     ,     . <br><br>       <a href="https://habrahabr.ru/post/181536/">¬´ JavaScript ¬ª</a>  ,        ,             . <br><br>      <a href="https://github.com/myshov/history_of_javascript/tree/master/4_evolution_of_js_modularity">GitHub</a> . </div><p>Source: <a href="https://habr.com/ru/post/192874/">https://habr.com/ru/post/192874/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192858/index.html">Broadcasting iOS application development in 48 hours</a></li>
<li><a href="../192862/index.html">HEX - $ 49 Opensource Quadcopter</a></li>
<li><a href="../192868/index.html">SAAS - Customer Life Cycle</a></li>
<li><a href="../192870/index.html">Mongodb 3.2 release some details</a></li>
<li><a href="../192872/index.html">How specifically to release the Internet</a></li>
<li><a href="../192876/index.html">Do not put all your eggs in someone else's basket (from the book Passionate Programmer by Chad Fowler)</a></li>
<li><a href="../192882/index.html">The invisible release of FreeType 2.5 - a breakthrough in font rendering</a></li>
<li><a href="../192884/index.html">Suricata as IPS</a></li>
<li><a href="../192886/index.html">New for web designer # 8 for August 2013</a></li>
<li><a href="../192888/index.html">DivX 10 released with support for HEVC video compression standard</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>