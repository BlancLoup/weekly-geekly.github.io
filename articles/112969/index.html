<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>So we put a factory into your algorithm or how not to consider factorials</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the translator: In this post, the tendency of some developers to use significantly more complex solutions than the situation requires is ridicule...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>So we put a factory into your algorithm or how not to consider factorials</h1><div class="post__text post__text-html js-mediator-article">  From the translator: <i>In this post, the tendency of some developers to use significantly more complex solutions than the situation requires is ridiculed.</i>  <i>A simple factorial calculation algorithm is taken as an example.</i> <br><br>  Many would not be philosophizing slyly and wrote like: <br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FactorialUtil</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">factorial</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ret = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= n; ++i) ret *= i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } }</code> </pre>  The thoughtful reader probably exclaimed now: ‚ÄúOh, horror, what if the factorial value will be more than fit into an int ?!‚Äù, and is ready to rewrite the code using BigInteger, or at least long: <br><a name="habracut"></a><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FactorialUtil</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> BigInteger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">factorial</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ BigInteger ret = BigInteger.ONE; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= n; ++i) ret = ret.multiply(BigInteger.valueOf(i)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } }</code> </pre>  Notice that we still have not done anything so that each time we recalculate intermediate values ‚Äã‚Äãfrom 1 to n.  If you cache these values, you can save a lot of operations!  You can, for example, using a recursive algorithm, save already calculated values: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FactorialUtil</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> HashMap&lt;Integer,BigInteger&gt; cache = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;Integer,BigInteger&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> BigInteger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">factorial</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ BigInteger ret; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BigInteger.ONE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> != (ret = cache.get(n))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; ret = BigInteger.valueOf(n).multiply(factorial(n-<span class="hljs-number"><span class="hljs-number">1</span></span>)); cache.put(n, ret); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } }</code> </pre><br>  Pretty simple, huh? <br><br>  Obviously, all these methods have their advantages and disadvantages, so since we can then want to use this library, we should use the technique that many other libraries use: a tricky mechanism that allows you to choose a calculation algorithm (slow but economical) memory, or fast, but requiring a lot of space).  So we need to make a singleton class that has a link to the selected algorithm.  This class has the same interface ( <i>for backward compatibility</i> - approx. Transl.), But uses a separate (new and improved!) Engine for algorithms: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FactorialUtil</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> FactorialUtil singleton; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FactorialAlgorithm algorithm; <span class="hljs-comment"><span class="hljs-comment">/** *    ,     */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FactorialUtil</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ algorithm = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CachedFactorialImplementation(); } <span class="hljs-comment"><span class="hljs-comment">/** *  ,     * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> algorithm */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FactorialUtil</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FactorialAlgorithm a)</span></span></span><span class="hljs-function"> </span></span>{ algorithm = a; } <span class="hljs-comment"><span class="hljs-comment">/** *    ,   , *        * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> n * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> BigInteger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">factorial</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (singleton == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//       singleton = new FactorialUtil(); } return singleton.doFactorial(n); } /** *  ,      *     * @param n * @return */ private BigInteger doFactorial(int n) { //    return algorithm.factorial(n); } }</span></span></code> </pre><br>  Please note that this class is responsible for creating the singleton and for choosing the algorithm.  We have the opportunity to use the class in the old way and in a new way.  The algorithm interface we have is: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FactorialAlgorithm</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">BigInteger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">factorial</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span></span>; }</code> </pre><br><br>  This is how the implementation of factorial counting with caching will look like: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CachedFactorialImplementation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FactorialAlgorithm</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> HashMap&lt;Integer,BigInteger&gt; cache = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;Integer,BigInteger&gt;(); <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BigInteger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">factorial</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ BigInteger ret; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BigInteger.ONE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> != (ret = cache.get(n))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; ret = BigInteger.valueOf(n).multiply(factorial(n-<span class="hljs-number"><span class="hljs-number">1</span></span>)); cache.put(n, ret); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } }</code> </pre><br><br>  Just look how simple and beautiful!  You can easily add a non-recursive algorithm without a cache: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoopedFactorialImplementation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FactorialAlgorithm</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BigInteger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">factorial</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ BigInteger ret = BigInteger.ONE; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= n; ++i) ret = ret.multiply(BigInteger.valueOf(i)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } }</code> </pre><br>  Obviously, the weak point of this design: we will not be able to select the algorithm on the fly, and this was an important feature that we planned.  So we, of course, must keep the algorithm in the config.  You can put its name in the properties of the system, because it is quite convenient, and then you can easily connect to external storage ( <i>for example, XML</i> - note. Trans.).  Ideally, our main method would be: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ System.getProperties().setProperty(<span class="hljs-string"><span class="hljs-string">"com.chaosinmotion.factorialalgorithm"</span></span>, <span class="hljs-string"><span class="hljs-string">"cachedAlgorithm"</span></span>); System.out.println(<span class="hljs-string"><span class="hljs-string">"5! = "</span></span> + FactorialUtil.factorial(<span class="hljs-number"><span class="hljs-number">5</span></span>)); }</code> </pre><br>  So we need a factory of algorithms.  We will store both the instances of singletons and classes so as not to create algorithms before we use them (in fact: why call so many designers and allocate a lot of resources while you do not need to do this?) <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * ,        * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@author</span></span></span><span class="hljs-comment"> wwoody * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FactorialAlgorithmFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> HashMap&lt;String,FactorialAlgorithm&gt; mapping = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;String,FactorialAlgorithm&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> HashMap&lt;String,Class&lt;? extends FactorialAlgorithm&gt;&gt; classMapping = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;String,Class&lt;? extends FactorialAlgorithm&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> FactorialAlgorithm defaultAlgorithm = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CachedFactorialImplementation(); <span class="hljs-comment"><span class="hljs-comment">/**      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Class.forName(<span class="hljs-string"><span class="hljs-string">"com.chaosinmotion.factorial.LoopedFactorialImplementation"</span></span>); Class.forName(<span class="hljs-string"><span class="hljs-string">"com.chaosinmotion.factorial.CachedFactorialImplementation"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ClassNotFoundException e) { <span class="hljs-comment"><span class="hljs-comment">//    } } /**        */ public static FactorialAlgorithm getDefaultAlgorithm() { if (defaultAlgorithm == null) { // :   ,  CachedFactorialImplementation // -   classpath defaultAlgorithm = getAlgorithm("cachedAlgorithm"); } return defaultAlgorithm; } /**     */ public static FactorialAlgorithm getAlgorithm(String name) { FactorialAlgorithm f = mapping.get(name); if (f == null) { //      Class&lt;? extends FactorialAlgorithm&gt; c = classMapping.get(name); if (c != null) { //    try { f = c.newInstance(); mapping.put(name, f); return f; } catch (Exception e) { //   Logger.getLogger("com.chaosinmotion.factorial"). warning("Unable to instantiate algorithm " + c.getCanonicalName() + ", named " + name); } } return getDefaultAlgorithm(); //  - } else return f; } /**  ,       */ public static void registerAlgorithm(String name, Class&lt;? extends FactorialAlgorithm&gt; f) { classMapping.put(name, f); } }</span></span></code> </pre><br>  Now we rewrite our class FactorialUtil to use the named algorithms: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FactorialUtil</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> FactorialUtil singleton; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FactorialAlgorithm algorithm; <span class="hljs-comment"><span class="hljs-comment">/** *    ,     */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FactorialUtil</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ String name = System.getProperty(<span class="hljs-string"><span class="hljs-string">"com.chaosinmotion.factorialalgorithm"</span></span>, <span class="hljs-string"><span class="hljs-string">"cachedAlgorithm"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { algorithm = FactorialAlgorithmFactory.getDefaultAlgorithm(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { algorithm = FactorialAlgorithmFactory.getAlgorithm(name); } } <span class="hljs-comment"><span class="hljs-comment">/** *  ,     * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> algorithm */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FactorialUtil</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FactorialAlgorithm a)</span></span></span><span class="hljs-function"> </span></span>{ algorithm = a; } <span class="hljs-comment"><span class="hljs-comment">/** *    .   FactorialAlgorithmFactory,     * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> name */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FactorialUtil</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ algorithm = FactorialAlgorithmFactory.getAlgorithm(name); } <span class="hljs-comment"><span class="hljs-comment">/** *    ,   , *        * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> n * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> BigInteger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">factorial</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (singleton == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// Use default constructor which uses default algorithm singleton = new FactorialUtil(); } return singleton.doFactorial(n); } /** *  ,      *     * @param n * @return */ private BigInteger doFactorial(int n) { //    return algorithm.factorial(n); } }</span></span></code> </pre><br><br>  Now we need to update our implementations of the algorithm so that they are registered in the factory: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CachedFactorialImplementation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FactorialAlgorithm</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> HashMap&lt;Integer,BigInteger&gt; cache = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;Integer,BigInteger&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { FactorialAlgorithmFactory.registerAlgorithm(<span class="hljs-string"><span class="hljs-string">"cachedAlgorithm"</span></span>, CachedFactorialImplementation.class); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BigInteger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">factorial</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ BigInteger ret; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> != (ret = cache.get(n))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; ret = BigInteger.valueOf(n).multiply(factorial(n-<span class="hljs-number"><span class="hljs-number">1</span></span>)); cache.put(n, ret); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } }</code> </pre><br>  and <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoopedFactorialImplementation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FactorialAlgorithm</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { FactorialAlgorithmFactory.registerAlgorithm(<span class="hljs-string"><span class="hljs-string">"loopedAlgorithm"</span></span>, LoopedFactorialImplementation.class); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BigInteger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">factorial</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ BigInteger ret = BigInteger.ONE; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= n; ++i) ret = ret.multiply(BigInteger.valueOf(i)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } }</code> </pre><br><br>  This architecture is beautiful in that we can add new algorithms and connect them to the singleton in FactorialUtil.  You just need to create a new implementation of the FactorialAlgorithm, which will register itself in the factory: <br><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecursiveFactorialImplementation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FactorialAlgorithm</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { FactorialAlgorithmFactory.registerAlgorithm(<span class="hljs-string"><span class="hljs-string">"recursiveAlgorithm"</span></span>, RecursiveFactorialImplementation.class); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BigInteger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">factorial</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BigInteger.ONE; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BigInteger.valueOf(n).multiply(factorial(n-<span class="hljs-number"><span class="hljs-number">1</span></span>)); } }</code> </pre><br>  And in the main method, make sure that our class is loaded and set the system property: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Class.forName(<span class="hljs-string"><span class="hljs-string">"com.chaosinmotion.factorial.RecursiveFactorialImplementation"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ClassNotFoundException e) { <span class="hljs-comment"><span class="hljs-comment">// if this fails, no matter; we'll still use the default implementation. } System.getProperties().setProperty("com.chaosinmotion.factorialalgorithm", "recursiveAlgorithm"); System.out.println("5! = " + FactorialUtil.factorial(5)); }</span></span></code> </pre><br><br>  And no problems!  This architecture allows you to connect and much more cunning algorithms, such as <a href="http://www.luschny.de/math/factorial/FastFactorialFunctions.htm">these</a> . </div><p>Source: <a href="https://habr.com/ru/post/112969/">https://habr.com/ru/post/112969/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../112963/index.html">Google launched a website with painting</a></li>
<li><a href="../112964/index.html">Is the trademark owner always right?</a></li>
<li><a href="../112965/index.html">Making a PDF book from a web comic with C # using the example of xkcd</a></li>
<li><a href="../112966/index.html">Rewrite project from Zend Framework to Rails</a></li>
<li><a href="../112968/index.html">Moving from SVN to Mercurial: personal experience</a></li>
<li><a href="../112973/index.html">33needs allows you to become a startup investor</a></li>
<li><a href="../112974/index.html">ACM ICPC World Programming Championship Final moved</a></li>
<li><a href="../112976/index.html">LSB steganography</a></li>
<li><a href="../112977/index.html">Visually about the execution thread in Node.js</a></li>
<li><a href="../112978/index.html">Google accuses Bing of copying its search results</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>