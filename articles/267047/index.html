<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bot for sapper with a twist</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably many people have it: there is nothing to do at work, or you need to think before performing the next task, yes, or there is simply nothing ta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bot for sapper with a twist</h1><div class="post__text post__text-html js-mediator-article">  Probably many people have it: there is nothing to do at work, or you need to think before performing the next task, yes, or there is simply nothing tasty for tea, then the hand automatically reaches for the mouse and starts playing sapper.  And in the rush of another attack of sapromania, I was struck with the thought that I no longer think, as before, where the mines are located, but simply on the machine, using the algorithm developed, to jog along the field, breaking the mouse.  And if I act on the algorithm, without much creative effort, then you can write a bot that will play instead of me, probably more attentively and quickly. <br><a name="habracut"></a><br>  Thus, instead of playing sapper in my spare time, I decided to train a bot to write a program in C # that would do the following: <br><br>  1) in the picture of the game window, fill in a matrix of sizes 16 * 30 (sapper field sizes in professional mode) with numbers in accordance with the disposition on the screen; <br>  2) drive this matrix through an algorithm that performs template actions; <br>  3) in the course of the algorithm, poke the field with the mouse, placing flags and opening the field, and return to the first item. <br>  4) since, due to the third point, the mouse is busy, then to stop the program, you must configure the interception of keystrokes in the operating system (because the sapper window is always active, not our program). <br>  5) Having mastered the four previous points, I decided to add a zest - to make the program at least a little more <br>  useful / usable - make it a screensaver, i.e.  automatically start the game in the sapper when the keyboard and mouse are idle after the time specified by the user (at the request of the user, of course). <br><br>  The program was written and tested for the classic sapper, which was in versions of Windows before XP, inclusive.  Then I decided to transfer it to MineSweeper too - a sapper from Windows7, about this at the end of the article. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So let's go in order. <br><br>  1) In the first paragraph, we create the eyes of our bot.  Get the picture with the game will help us the following code: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Emgu.CV; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Emgu.CV.Structure; ................. DllImport(<span class="hljs-string"><span class="hljs-string">"user32.dll"</span></span>, SetLastError = <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> IntPtr </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindWindow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lpClassName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lpWindowName</span></span></span><span class="hljs-function">)</span></span>; [DllImport(<span class="hljs-string"><span class="hljs-string">"user32.dll"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>: MarshalAs(UnmanagedType.Bool)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWindowRect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr hwnd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> RECT lpRect</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> RECT { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Left; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Top; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Right; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Bottom; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Bitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetScreenImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Rectangle rect</span></span></span><span class="hljs-function">)</span></span> { Bitmap bmp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bitmap(rect.Width, rect.Height, PixelFormat.Format32bppArgb); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (Graphics graphics = Graphics.FromImage(bmp)) { graphics.CopyFromScreen(rect.Left, rect.Top, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, rect.Size, CopyPixelOperation.SourceCopy); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bmp; } .................. RECT rect; <span class="hljs-comment"><span class="hljs-comment">//       IntPtr handle = FindWindow(null, ""); //    GetWindowRect(handle, out rect); Rectangle gameScreenRect = new System.Drawing.Rectangle(rect.Left, rect.Top, rect.Right - rect.Left, rect.Bottom - rect.Top); //      Bitmap gameBmp = GetScreenImage(gameScreenRect); Image&lt;Bgr, Byte&gt; img = new Emgu.CV.Image&lt;Bgr, byte&gt;(gameBmp)</span></span></code> </pre> <br>  At the exit, we got a color image of the window with the game - now our bot sees the same thing as we, but does not know yet what to do with it, stupid.  Now we need to fill in the matrix with 16 * 30 numbers from -1 to 10 (-1 is the flag set by the right key, 0 - the cell doesn‚Äôt touch any mines, 1-8 - the number of min-neighbors in this cell, 9 - undiscovered cell, 10 - mine (appears when undermined)).  That is, at the beginning of each game, the matrix must be filled with nines, and at a loss, at least one dozen should appear.  To fill in the matrix, I first wanted to use some sort of a character recognition library, but then I thought it was like shooting a gun at sparrows, because we have only 12 image variants, I decided to write my own module for recognition.  When I transferred the application under the sapper from Windows 7, I regretted my decision, as the number of images increased, and the method of distinguishing them from each other became much more complicated. <br><br>  The shell of the well-known <a href="http://opencv.org/">OpenCV library</a> for C # <a href="http://www.emgu.com/wiki/index.php/Main_Page">EmguCV</a> will help us to recognize the image and fill the matrix, it is very easy to connect and <br>  using.  Recognition in the application is as follows: from the large image with the game window obtained in the previous step, small images are cut out one by one - the cells and compared with the previously prepared standards.  For more effective comparison, we make the images black and white: if the gray intensity in a particular pixel is less than THRESHOLD, then it is painted white, otherwise it is black, then there is a pixel-by-pixel comparison. <br><br><pre> <code class="cs hljs">Image&lt;Gray, Byte&gt; normal = image.Convert&lt;Gray, Byte&gt;().ThresholdBinary(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Gray(THRESHOLD), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Gray(<span class="hljs-number"><span class="hljs-number">255</span></span>));</code> </pre><br>  2) Now our bot can see, we must teach him to think;  The game's algorithm is the brain of our bot, it consists of several parts. <br><br>  For ease of use of our table with numbers in the game passing algorithms, we will create the class SaperCell, in which in addition to the cell type and coordinates, we will define several properties: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SaperCell</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> X; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Y; <span class="hljs-comment"><span class="hljs-comment">//       public int numberOf9TypeNeighbours; // ,        public int numberOfFlags; //   ,        public float Probability; }</span></span></code> </pre><br>  The first part of the algorithm is the simplest one, in it we run over all open cells (numbers 1 through 8) and check whether the number of unopened neighbors of a given cell is equal to the number of mines it should relate to (the type of this cell).  If so, then we know that the mines are located in all the adjacent undiscovered cells.  After this part of the algorithm, all of the following situations will be handled: <br><br><img src="https://habrastorage.org/files/4ea/d33/727/4ead3372798745f6b79a7f6365f8b9cc.jpg"><br><br><img src="https://habrastorage.org/files/4f7/f5f/b83/4f7f5fb830bf426b9289f65f863a2928.jpg"><br><br><img src="https://habrastorage.org/files/fec/cd2/3eb/feccd23eba6a494f868b92d5f6749605.jpg"><br><br>  The second part of the algorithm catches all the typical situations that have developed in my time, when there was nothing tasty for tea.  There are several such templates: <br><br>  1) Troika 1, 2, 1 - in this case, the mines are opposite units. <br><br><img src="https://habrastorage.org/files/f99/753/283/f9975328370c44908bb975fd0f01368c.jpg"><br><br>  2) Quartet 1, 2, 2, 1 - in this case, the mines stand opposite the two. <br><br><img src="https://habrastorage.org/files/424/9bb/b27/4249bbb27f424d70b6a500eddc4fbdab.jpg"><br><br>  3) The closed triple 1, 1, 1 (this means that there are no undiscovered cells diagonally from the extreme units, that is, there are exactly three undiscovered cells opposite the triple) - in this case, the mine is opposite the central unit. <br><br><img src="https://habrastorage.org/files/6d0/203/89b/6d020389b1cc4dcd8ba1a4737244fc36.jpg"><br><br>  4) Four closed four, 1, 1, 1 - mines opposite extreme units. <br><br><img src="https://habrastorage.org/files/0e4/70d/b6f/0e470db6f66f4768bbd8fb3e2304202e.jpg"><br><br>  The third part of the algorithm (if you can call it that): run through all the cells that already touch the required number of mines, and simultaneously poke the left and right mouse buttons. <br><br>  The fourth part of the algorithm is a smart click, if the previous algorithms no longer produce results (they do not reveal anything new), then there is a search for cells that have no mines: if the set of undiscovered neighbors of cell A is a subset of undiscovered neighbors of cell B, and cell B should not touch more mines than cell A, then we can safely open all undiscovered neighbors of cell B, which are not neighbors of cell A. <br><br><img src="https://habrastorage.org/files/de6/fcd/ddf/de6fcdddfb2242098bd70b20ae4bd3b2.jpg"><br><br>  Next, in a similar way, there is a search for cells where exactly there is a mine. <br><br><img src="https://habrastorage.org/files/9ca/685/078/9ca68507878a422ca83525724a38da7f.jpg"><br><br>  3) Now our bot knows where exactly the mines are and where they are definitely not there, but cannot do anything, as they say there are no pens - no candies.  Let's attach our bot hand: here is the code that allows you to left-click with the mouse in the desired cell of the sapper window: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DllImport(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"user32.dll"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_event</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dwFlags, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dy, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dwData, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dwExtraInfo</span></span></span><span class="hljs-function">)</span></span>; [Flags] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> MouseEventFlags { LEFTDOWN = <span class="hljs-number"><span class="hljs-number">0x00000002</span></span>, LEFTUP = <span class="hljs-number"><span class="hljs-number">0x00000004</span></span>, MIDDLEDOWN = <span class="hljs-number"><span class="hljs-number">0x00000020</span></span>, MIDDLEUP = <span class="hljs-number"><span class="hljs-number">0x00000040</span></span>, MOVE = <span class="hljs-number"><span class="hljs-number">0x00000001</span></span>, ABSOLUTE = <span class="hljs-number"><span class="hljs-number">0x00008000</span></span>, RIGHTDOWN = <span class="hljs-number"><span class="hljs-number">0x00000008</span></span>, RIGHTUP = <span class="hljs-number"><span class="hljs-number">0x00000010</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LeftClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x</span></span></span><span class="hljs-function">)</span></span> { mouse_event((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(MouseEventFlags.MOVE | MouseEventFlags.ABSOLUTE), x * <span class="hljs-number"><span class="hljs-number">65536</span></span> / SCREEN_WIDTH, y * <span class="hljs-number"><span class="hljs-number">65536</span></span> / SCREEN_HEIGHT, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); mouse_event((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(MouseEventFlags.LEFTDOWN), (lx * <span class="hljs-number"><span class="hljs-number">65536</span></span> / SCREEN_WIDTH, y* <span class="hljs-number"><span class="hljs-number">65536</span></span> / SCREEN_HEIGHT, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); mouse_event((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(MouseEventFlags.LEFTDOWN), x * <span class="hljs-number"><span class="hljs-number">65536</span></span> / SCREEN_WIDTH, y * <span class="hljs-number"><span class="hljs-number">65536</span></span> / SCREEN_HEIGHT, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); System.Threading.Thread.Sleep(<span class="hljs-number"><span class="hljs-number">10</span></span>); mouse_event((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(MouseEventFlags.LEFTUP), x * <span class="hljs-number"><span class="hljs-number">65536</span></span> / SCREEN_WIDTH, y* <span class="hljs-number"><span class="hljs-number">65536</span></span> / SCREEN_HEIGHT, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre><br>  Now in the course of the algorithm, to click on a cell with coordinates (x, y) it is enough to write: <br><br><pre> <code class="cs hljs">mouse.LeftClick(x,y).</code> </pre><br>  Here, the mouse is a class that contains all kinds of clicks, making it easier to manipulate the mouse during the game. <br><br>  4) After the previous points, our bot is simply unstoppable - ready to play sapper until blue in the face, taking up the mouse.  Therefore, you need to attach his ears so that he can hear when to stop.  Since the mouse is busy, then to stop the program will have to use ... the keyboard, what else.  But there is a problem with this, since the sapper window is always active, you will have to catch all keystrokes in the operating system.  Searching on the Internet, I came across this ready- <a href="http://blogs.msdn.com/b/toub/archive/2006/05/03/589423.aspx">made solution</a> .  It remains to create two separate streams - in one our bot will work, in the second an interceptor of keystrokes, and also the mechanism of their interaction. <br><br><pre> <code class="cs hljs">Thread hooker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(KeyboardHook); hooker.IsBackground = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; hooker.Start(); Thread saper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(SaperGame); saper.IsBackground = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; saper.Start(); EventWaitHandle wh = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AutoResetEvent(<span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre><br>  In the KeyboardHook function when you press a key: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isPaused == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { isPaused = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { isPaused = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; wh.Set(); }</code> </pre><br>  In the SaperGame function: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isPaused == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { wh.Set(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { wh.WaitOne(); }</code> </pre><br>  When playing, the saper stream constantly checks if the variable isPaused, if it is equal to true (it means that the key was pressed), then the flow slows down and waits for the event handler to wait, and he gives it only when the key is pressed again. <br><br>  5) Now our bot not only plays well, but also became very obedient.  After all sorts of optimizations (bot record 5 seconds), I didn‚Äôt know what else to do with it, but I wanted to add some zest, which really fascinated me. <br><br>  As a result, I decided to convert my program into a screensaver, so that the computer is idle, it's better to play a sapper.  For Windows XP, this is very easy to do - change the file extension to .scr and put it with all the necessary files in C \\ WINDOWS \\ system32, then it will appear among other standard screen savers, you just have to select the interval and the program will start when the computer is idle.  But I decided to make a universal solution so that you can use the application in the seven.  To do this, I created a window application that hangs in the tray, with the ability to add to autoload (after all, the Windows splash screen works from the very beginning), and also screwed this <a href="http://blogs.msdn.com/b/toub/archive/2006/05/03/589468.aspx">class</a> to track mouse movements.  Now, with any activity of the mouse or keyboard, the timer is restarted and, if the detected time is longer than the specified interval, the game starts.  Of course, this is not a screensaver from Windows, only the keyboard and mouse are tracked here, but still I was pleased. <br><br>  Now I‚Äôll say a little about learning how to play Minesweeper from Windows7.  When the program worked like a clock under Windows XP, but I thought that just a couple of shadings would work for Windows7.  But it was not there, although, in fact, it was necessary only to redo the recognition process, but it took almost as much time as writing all the previous code.  The fact is that single-type cells in the sapper from Windows7 are very different in different parts of the field.  Therefore, for each type of cell, several standards had to be prepared at once, but this did not eliminate the recognition errors, since it was not possible to establish the same THRESHOLD for such a number of pictures.  Therefore, it was necessary for each cell on the move to calculate THRESHOLD as the average gray intensity of the entire image, due to this, the recognition time doubled.  Well, okay, the main thing is reliable, but even after that, the jambs periodically jumped, and they were not in step-by-step debugging.  The whole thing turned out to be a smooth update of the sapper window itself in Windows7, I had to make artificial pauses before each screen shot.  Everything seems simple, but until I got to that, I cursed that I took over the doping of the program under MineSweeper, and that I began to invent this limping bike with recognition.  But, fortunately, after a small optimization, the program began to spread the sapper in an acceptable time and almost did not stray. <br><br>  The source code of the program is available on <a href="">github</a> . <br><br>  In this way, I managed to write a rather interesting application, practice my programming skills and learn something new.  Anyone who read - thanks, and who downloaded and tried the bot in action - huge thanks! <br><br>  And here is a video with an example of the bot's work: <iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://rutube.ru/play/embed/7984528&amp;xid=17259,15700019,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg3VFNKRslPMFkT1PKfhZJwUSS2hw" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/267047/">https://habr.com/ru/post/267047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267035/index.html">The time series forecasting model for the maximum similarity sample: an explanation and an example</a></li>
<li><a href="../267037/index.html">A simple algorithm for determining the intersection of two segments</a></li>
<li><a href="../267039/index.html">Private Cloud Appliance - the best virtualization and private cloud for data centers</a></li>
<li><a href="../267041/index.html">Dissect t-SNE</a></li>
<li><a href="../267045/index.html">System backup of virtual machines or how to save money organization</a></li>
<li><a href="../267049/index.html">Ice started off: KC published a draft document on paperless transfer of .RU domains between registrars</a></li>
<li><a href="../267051/index.html">We are switching from STM32 to the Russian K1986BE92QI microcontroller. Practical application: We interrogate keys, we generate PWM. Comparison of CMSIS and SPL code (PWM + TIM + PORT). Part one</a></li>
<li><a href="../267053/index.html">What can I learn from WhatsApp</a></li>
<li><a href="../267055/index.html">‚ÄúMade and forgotten‚Äù: Why is it not so in the layout of email-letters</a></li>
<li><a href="../267057/index.html">SYNful knock on the OS of Cisco Systems routers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>