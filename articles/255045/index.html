<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>.NET development: switching between DEV and PROD environments. Part one</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 When developing and debugging a project in Visual Studio, you usually do this by compiling code in a Debug configuration. On the same c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>.NET development: switching between DEV and PROD environments. Part one</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  When developing and debugging a project in Visual Studio, you usually do this by compiling code in a Debug configuration.  On the same combat server project is laid out, compiled in the release configuration.  And each project sooner or later grows to such an extent that a certain ‚Äúdebugging‚Äù or ‚Äúrelease‚Äù code appears in it - that is, the code that should work only in one of the configurations.  And if the case was limited only to code, then the conditional compilation directive #if would solve all the problems.  But usually, the code specific for each of the configurations, and often the layout of web pages, is still pulled after the code.  At the very beginning, when such problems are just beginning to appear, and are not yet a severe headache, the usual commenting on unnecessary lines at a particular moment with code / markup / settings is usually used.  But this is Road To Hell in its purest form.  But I would like to tell you about Stairway To Heaven. <br><br><img src="https://habrastorage.org/files/d80/e7d/184/d80e7d184e7e4840b1c884668117fa79.png"><br><br>  When I first encountered such a problem and was already mired in crutches from comments and sets of various configuration files, then at some point I decided to take an interest in someone else‚Äôs experience, as well as better explore the possibilities of the development environment and the tools used.  And suddenly I found out that all my artificial crutches are absolutely redundant - the problem can be solved by standard means and without degrading the readability of the code.  I will describe the results of my research in a short series of articles, where I will review examples of environmental problems and mechanisms by which all code, settings and html markup can be automatically brought to the desired form when a project is published.  This will focus on the development of ASP.NET MVC applications, as an area in which I mostly work.  However, everything written will be applicable to any .NET-development in Visual Studio. <br><a name="habracut"></a><br><h4>  Transform a web.config file </h4><br>  In this article I will start with the first important tool - with the transformation of a web.config file.  If you are still not familiar with this technique, then this section is definitely worth reading. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Transformation appeared together with Visual Studio 2010 and immediately solved a huge number of problems associated with different settings for DEV and PROD environments.  In this case, the rules by which the transformation is performed, are extremely simple and flexible. <br><br>  You probably noticed that, starting from VS 2010, the web.config file suddenly began to appear in the project tree as a container, inside of which two new web.release.config and web.debug.config files now lie.  These are the files in which the transformation of the main web.config file is configured.  You may not use these two files at all and work with the main web.config as the only one, and this will not cause any problems.  But it will be better to comprehend this Zen, to subsequently practice it always and with the mind. <br><br>  Studying how transformation works, the most important thing is to clearly understand the two main things when setting it up: <br><br>  1. Transformation only works when publishing a project. <br><br>  2. The web.debug.config and web.release.config files <i>do not replace the</i> original web.config, but <i>change (transform)</i> it <br><br>  It would seem that the first paragraph imposes serious restrictions on the use of transformation in development.  And really, what can be the use of it when you are developing a project, for example, under IIS Express, that is, without publications?  But in fact, this is not a problem, but I will touch on this moment later. <br><br>  As for the second point, this is a common mistake of those who first encountered the transformation, including me: at first I decided that when publishing, the web.config file was replaced with the corresponding release / debug file.  Of course, the very first publication made me read the manual carefully, because it does not work at all. <br><br>  It works in the following way: in the transformation files, it is indicated exactly how the original web.config should be changed when published in the appropriate configuration.  We will not go far and consider the standard example.  The auto-generated web.release.config file by default already contains one standard transformation directive.  Here is its listing (with deleted comments): <br><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xdt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/XML-Document-Transform"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.web</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">compilation</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xdt:Transform</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RemoveAttributes(debug)"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.web</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  First, note the key point: the configuration element defines the xdt prefix for the XML-Document-Transform namespace.  In this namespace, two attributes are declared, with the help of which the transformation is defined: Locator and Transform.  The Locator attribute defines <i>what</i> you want to change in the configuration file, and the Transform attribute specifies <i>how</i> you want to do it.  In the given example, only Transform is used - its value tells us what we need in the compilation element of the original web.config file to remove the debug attribute (along with its value, of course). <br><br>  <u>Reference:</u> the debug attribute of the configuration / system.web / compilation element is responsible for compiling asp.net pages.  In the default web.config file, the value of this attribute is usually true, and this means that asp.net pages will be compiled with debug information added.  In the Release configuration (that is, in the configuration in which the project is usually compiled for laying out in PROD), this is not necessary, and for this purpose, the default command is inserted into the transformation file web.release.config to remove this attribute.  I will mention all of this in more detail, but later. <br><br>  Let's return to our example.  When a project is published in the Release configuration, the debug attribute in the configuration / system.web / compilation element will be removed from the final web.config file, regardless of what its meaning was and whether it was there at all.  Note that in the example the Locator attribute is missing, because the transformation is explicitly set for a specific element of the config file.  But using the Locator attribute, it is possible to more flexibly specify elements of a web.config file for transformation, in particular, using XPath expressions or specifying an explicit correspondence of attribute values.  Here is another example: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xdt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/XML-Document-Transform"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appSettings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Setting1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SettingValue"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xdt:Locator</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Condition(@key='key1')"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xdt:Transform</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Replace"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appSettings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  In this example, the source web.config will search for the configuration with the key1 key (this is specified via XPath in the Locator), and if such is found, it will be completely replaced <br><br>  (the Replace value of the Transform attribute) on the setting from the file with the transformation.  The Condition value of the Locator attribute contains an XPath expression applied to the element of the config file in which it is defined, and the element automatically becomes current for the XPath expression.  In addition to Condition, you can specify the value of XPath in the Locator attribute - it differs only in that the XPath expression will be considered in a global context. <br><br>  Another example: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xdt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/XML-Document-Transform"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.web</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">customErrors</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"On"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xdt:Transform</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Insert"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">statusCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"404"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">redirect</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Error404"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">statusCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"500"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">redirect</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Error500"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">customErrors</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.web</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  In this example, we add to the final web.config an entire customErrors settings section (by the way, a very useful and often used section for customizing the behavior of a web application in case of an error).  Note that using the Insert value of the Transform attribute, we assume the absence of this section in the original web.config.  If it is there, then we should use Replace instead of Insert. <br><br>  As a result, we have a powerful tool with which we can change the web.config file on the fly when publishing a project in various ways, namely: change, delete or add individual elements or attributes of elements (as well as entire groups of elements) and change values any attributes of any elements.  This allows us to get rid of the constant commenting on the settings in the web.config file or its regular substitution with a ‚Äútest‚Äù / ‚Äúcombat‚Äù when debugging.  A complete list of transformation attribute values ‚Äã‚Äãwith usage examples can be found in <a href="https://msdn.microsoft.com/en-us/library/dd465326(v%3Dvs.110).aspx">MSDN</a> . <br><br>  If we talk about the actual use of transformations in my projects, then of all the settings of the web.config file, the following are most often affected: <br><br>  1. Connection Strings or, in other words, all database connection settings.  This applies to the connection string itself and the settings of all ORM frameworks. <br><br>  2. Settings section appSettings.  All settings are transferred from development / debug mode to combat mode. <br><br>  3. Web application error handling settings - section /&lt;system.web&gt;/ in the example above.  When developing and testing, for me personally, it‚Äôs preferable to see all the errors with text and stack trace at once, rather than being thrown over to a beautiful blank page.  Of course, this is unacceptable for combat applications. <br><br>  4. Settings trace / log / debug.  In addition to the above settings /&gt; from the web.config, all settings related to debugging and tracing are cleared (or left but turned off).  And the log settings are transferred from the paranoid mode to the worker. <br><br>  5. Settings for caching profiles for web pages.  Http page caching is completely unnecessary when debugging, so the caching profiles in web.debug.config are simply disabled via the enabled = ‚Äùfalse‚Äù attribute.  (I hope you use caching profiles in the OutputCache attribute?) <br><br>  Of course, this is not a complete list - it all depends on the specific project.  But it is these settings that are affected by transformations in almost all cases. <br><br>  As for the development using IIS Express, in which publications do not occur, then, as I have already said, this is not a problem for the use of transformations.  I often develop web applications using IIS Express (that is, without publishing on a real web server), and I do it quite simply: the original web.config file contains all the necessary settings in the DEV version, and transformations are set only in the web .release.config.  That is, the original web.config, in fact, serves as a web.debug.config file. <br><br>  So, Visual Studio gives us the opportunity to flexibly control the operation of the application in the DEV and PROD environments, while not embedding it in the code, layout or settings with various crutches or stubs.  If you still do not own this technique, then this gap should be urgently closed.  In the following articles - about minification, bundles, scripts, DEBUG and how to use it correctly. </div><p>Source: <a href="https://habr.com/ru/post/255045/">https://habr.com/ru/post/255045/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255029/index.html">Creation of microservices</a></li>
<li><a href="../255033/index.html">What is under the hood of a dynamic magnetic strip?</a></li>
<li><a href="../255037/index.html">We start CloudLITE.ru cloud resource store</a></li>
<li><a href="../255039/index.html">Payler: PCI DSS Certification Update Updated to Version 3.0 - DONE</a></li>
<li><a href="../255043/index.html">Type casting on Go</a></li>
<li><a href="../255047/index.html">We collect your own smartphone</a></li>
<li><a href="../255049/index.html">Life hacking: How to combine two different commands in the Slack messenger</a></li>
<li><a href="../255051/index.html">Search for images in Android using Flickr</a></li>
<li><a href="../255053/index.html">MOOC Video Studio</a></li>
<li><a href="../255055/index.html">How I decided to go to game dev</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>