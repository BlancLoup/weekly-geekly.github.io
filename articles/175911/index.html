<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Win32 / Gapz: the last episode</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we publish the last part of the Win32 / Gapz bootkit analysis, and also want to submit a PDF that contains an analysis of this interesting threa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Win32 / Gapz: the last episode</h1><div class="post__text post__text-html js-mediator-article">  Today we publish the last part of the <b>Win32 / Gapz</b> bootkit analysis, and also want to submit a PDF that contains an analysis of this interesting threat with all the technical details.  His analysis took several months of intensive reverse.  In Gapz, we saw that the developers of these kinds of threats had reached a new level of complexity.  <b>We also believe that Win32 / Gapz, in fact, is the most complex bootkit of all that we have seen before.</b>  Detailed technical analysis of this threat can be found in our PDF document <a href="http://www.welivesecurity.com/wp-content/uploads/2013/04/gapz-bootkit-whitepaper.pdf">Mind the Gapz: The most complex bootkit ever analyzed?</a>  . <br><br>  Our colleagues <a href="https://twitter.com/vxradius">Yevgeny Rodionov</a> and <a href="https://twitter.com/matrosov">Alexander Matrosov</a> conducted an analysis of the Win32 / Gapz code, starting in December 2012.  This analysis revealed more and more interesting details about this threat. <br><br><a name="habracut"></a><img src="https://habrastorage.org/storage2/e9f/8eb/560/e9f8eb56028e7394453e85de366c41de.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We already wrote about Gapz earlier: <br><ul><li>  <a href="http://habrahabr.ru/company/eset/blog/174169/">Droppers Gapz and Redyms are based on the Power Loader code</a> </li><li>  <a href="http://habrahabr.ru/company/eset/blog/169131/">Modern bootkit technology and detailed analysis of Win32 / Gapz</a> </li></ul><br>  Win32 / Gapz has a fairly low prevalence level (since the beginning of its first detection, we recorded less than one hundred active samples).  Most of these detections were in Russia.  All known C &amp; C panels were already closed at the time of the analysis started in December 2012.  Domains for loading additional payload were registered through the DynDNS service.  Below is a list of such URLs that were found in the dropper after unpacking: <br><ul><li>  hxxp: //xpiracyrt.is-into-cars.com/apps/32.lz </li><li>  hxxp: //retguard.is-into-cars.com/apps/32.lz </li><li>  hxxp: //soparesolv.is-into-cars.com/apps/32.lz </li><li>  hxxp: //xpiracyrt.is-into-cars.com/upds/7/1/upd.lz </li><li>  hxxp: //retguard.is-into-cars.com/upds/7/1/upd.lz </li><li>  hxxp: //soparesolv.is-into-cars.com/upds/7/1/upd.lz </li></ul><br>  Modification of <b>Win32 / Gapz.C</b> , which contains the MBR infection functionality, sends debug information about the infection process to the following IP address: <br><br><img src="https://habrastorage.org/storage2/4e6/704/ead/4e6704ead038e7737e41d82c75ac651d.png"><br><br>  Hosting for this IP address is located in Germany and, at the time of publication, is still online. <br><br><img src="https://habrastorage.org/storage2/153/329/cc4/153329cc44333cfa47d66b7575310b1e.png"><br><br>  We found that this IP is associated with several domains: meetafora.ru, sukarabotay.com.  Both of these domains were registered in 2011, and they expire in mid-2013.  Now this IP has already stopped accepting debug information from the bot. <br><br>  In all versions of Gapz that contained the bootkit, the addresses of additional C &amp; Cs were extracted from the configuration file, which is stored in a hidden FS.  This file is embedded in the main kernel-mode component located on a hidden disk.  C &amp; C domains are generated as third level domains (the variable component is the third level domain) using the dynamic DNS service strangled.net (used in <b>Win32 / Gapz.A</b> ). <br><br><img src="https://habrastorage.org/storage2/93b/5ce/12b/93b5ce12b95599942f3a885d622a67eb.png"><br><br>  An example of networking with such a domain is presented below. <br><br><img src="https://habrastorage.org/storage2/bad/cf1/327/badcf1327a957d8201a1d6a528d7f14c.png"><br><br>  <b>Win32 / Gapz.C modification</b> uses a different domain generation scheme: <br><br><img src="https://habrastorage.org/storage2/561/fb4/904/561fb49042b313e6eebf41f7eb58e959.png"><br><br>  <b>Interaction with the network in kernel mode is based on the manual implementation of the TCP / IP stack and HTTP protocol in order to bypass the check using local IPS / IDS.</b>  Full information on the implementation of the stack, see <a href="http://www.welivesecurity.com/wp-content/uploads/2013/04/gapz-bootkit-whitepaper.pdf">here</a> . <br><br>  <b>We believe that the Win32 / Gapz family is the most complex bootkit we‚Äôve seen before.</b>  Below is a table of comparisons of Gapz features with other prominent members of bootkits: <br><br><img src="https://habrastorage.org/storage2/a03/982/f16/a03982f166a9b10e8561409cdf07b7a3.png"><br><br>  <b>Hidden File System Reader with FS Gapz support</b> <br><br>  To assist security professionals and AV resellers facing Gapz, we updated our Hidden File System Reader tool with the requirements for this bootkit.  Now it can also save hidden FS components from Gapz.  The utility can be downloaded <a href="http://www.eset.com/download/utilities/detail/family/173/">here</a> . <br><br><img src="https://habrastorage.org/storage2/e02/b28/2e5/e02b282e504d3f982f507f0064b4b806.png"></div><p>Source: <a href="https://habr.com/ru/post/175911/">https://habr.com/ru/post/175911/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../175887/index.html">Get rid of code repetition with DRY CRUD</a></li>
<li><a href="../175889/index.html">Once plywood, atmega, yes raspberry</a></li>
<li><a href="../175895/index.html">Centralized configuration of the lock screen and operating system power plan</a></li>
<li><a href="../175897/index.html">FullHD Butterfly Review: HTC Butterfly</a></li>
<li><a href="../175899/index.html">Script for receiving information from remote unix-like servers</a></li>
<li><a href="../175913/index.html">How accurate is the demographic targeting of Google?</a></li>
<li><a href="../175915/index.html">Note on Instructions (no claim to world domination)</a></li>
<li><a href="../175917/index.html">Ranking in Yandex: how to put machine learning on stream (post # 3)</a></li>
<li><a href="../175919/index.html">Arbor Pravail APS and DDOS</a></li>
<li><a href="../175921/index.html">Address Book Sharepoint 2010 from AD with synchronization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>