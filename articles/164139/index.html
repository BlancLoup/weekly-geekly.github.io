<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Androgenizer - a tool for assembling sources for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article only covers the adaptation of software build with source code for Unix / Linux on Android. 

 In my work, I mainly work on updating the f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Androgenizer - a tool for assembling sources for Android</h1><div class="post__text post__text-html js-mediator-article">  This article only covers the adaptation of software build with source code for Unix / Linux on Android. <br><br>  In my work, I mainly work on updating the functionality of the standard <a href="http://source.android.com/">AOSP</a> , so I often have to make decisions on transferring some libraries / applications from Linux to Android.  There are many English-language articles on the Internet describing the basic principles of transference and adaptation.  Therefore, I decided to collect all the material relating to the software build, put it together and share my experience.  The material presented implies that readers have experience building an <a href="http://source.android.com/">AOSP</a> and knowledge of the syntax of the Android.mk file. <br><br><a name="habracut"></a><br><h4>  Why do I need Androigenizer? </h4><br><blockquote>  <b>Android</b> has its own build system like <b>GNU make</b> .  However, most developers are not very happy when they have to add support for a new build system in open source projects (in most cases <b>autotools</b> are used), which, moreover, must be constantly monitored (and suddenly something will break in another version).  <b>Androgenizer</b> was created to avoid such situations. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Instead of adding an <b>Android.mk</b> file to each module of a project, you can add only one <b>Android.mk</b> file at the topmost level for automatic configuration for the pre-build stage.  Perform all steps in <b>autoconf / automake / configure</b> , and then call <b>make</b> in the appropriate directories to create <b>Android.mk</b> files in them. <br><br>  Each <b>Makefile.am</b> module that you want to compile for Android should contain a small snippet to generate <b>Android.mk</b> using <b>androgenizer</b> . <br><br>  Sometimes the contents of the <b>Android.mk</b> file depend on how the project will be built: using NDK or as part of AOSP.  <b>Androgenizer takes</b> this into account too. <br><br>  <b>Androgenizer</b> detects the build system based on the <b>ANDROID_BUILD_TOP</b> environment <b>variable</b> , if it is not installed or empty, then it is assumed to be built from under the NDK. </blockquote><br><br>  Consider an example of assembling mpeg2enc plug-in from gst-plugins-bad for gstreamer. <br><br><h4>  Introduction </h4><br>  The entire build will be done using <a href="http://source.android.com/">AOSP</a> : <br><ul><li>  The <b>Gstreamer</b> project and all plugins are located in the external / gstreamer-aggregate folder. </li><li>  The <b>Android.mk</b> file for preparing environment variables is located in the ‚Äúexternal / gstreamer-aggregate / jni‚Äù folder </li><li>  The <b>gst-plugins-bad</b> plugin is located in the ‚Äúexternal / gstreamer-aggregate / gst-plugins-bad‚Äù folder </li><li>  The <b>Android.mk</b> file, for configuring the <b>gst-plugins-bad</b> plugin, is located in the external / gstreamer-aggregate / gst-plugins-bad / Android.mk folder. </li></ul><br><h4>  Step 1. Preparing Environment Variables </h4><br>  Consider the creation of the Android.mk file, which will be located along the path ‚Äúexternal / gstreamer-aggregate / jni / Android.mk‚Äù.  Let's take the <a href="">Android.mk</a> file as a basis and take a closer look: <br><br><pre><code class="cmake hljs">LOCAL_PATH := $(call my-dir) <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $(CLEAR_VARS)</code> </pre> <br>  Setting the local path and clearing the values ‚Äã‚Äãof some variables. <br><br><pre> <code class="cmake hljs">GSTREAMER_AGGREGATE_TOP := $(abspath $(LOCAL_PATH))/..</code> </pre><br>  Setting the top of the directory where the <b>Gstremer</b> sources are <b>located</b> .  In our case, the variable GSTREAMER_AGGREGATE_TOP will point to "/ path / to / AOSP / external / gstreamer-aggregate". <br><br><pre> <code class="cmake hljs">ifneq ($(SYSROOT),) NDK_BUILD := <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> NDK_BUILD := <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span></code> </pre><br>  If the SYSROOT variable is set, then the build is performed using ndk-build, otherwise in the AOSP source code. <br><br><pre> <code class="cmake hljs">ifeq ($(gstreamer_TOP),) gstreamer_TOP := $(GSTREAMER_AGGREGATE_TOP)/gstreamer <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span> ifeq ($(GST_PLUGINS_GOOD_TOP),) GST_PLUGINS_GOOD_TOP := $(GSTREAMER_AGGREGATE_TOP)/gst-plugins-bad <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span> ifeq ($(GST_PLUGINS_BAD_TOP),) GST_PLUGINS_BAD_TOP := $(GSTREAMER_AGGREGATE_TOP)/gst-plugins-bad <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span></code> </pre><br>  Setting global variables where libraries, applications, plugins, etc. are located  We will need these variables later for assembly and configuration. <br><br><pre> <code class="cmake hljs">CONFIGURE_CC := $(TARGET_CC) CONFIGURE_CXX := $(TARGET_CXX) CONFIGURE_INCLUDES := CONFIGURE_LDFLAGS := -lc -ldl <span class="hljs-comment"><span class="hljs-comment"># as ndk-build ifeq ($(NDK_BUILD),true) CONFIGURE_CFLAGS := \ -nostdlib -Bdynamic \ -Wl,-dynamic-linker,/system/bin/linker \ -Wl,--gc-sections \ -Wl,-z,nocopyreloc \ $(call host-path,\ $(TARGET_CRTBEGIN_DYNAMIC_O) \ $(PRIVATE_OBJECTS)) \ $(call link-whole-archives,$(PRIVATE_WHOLE_STATIC_LIBRARIES))\ $(call host-path,\ $(PRIVATE_STATIC_LIBRARIES) \ $(TARGET_LIBGCC) \ $(PRIVATE_SHARED_LIBRARIES)) \ $(PRIVATE_LDFLAGS) \ $(PRIVATE_LDLIBS) \ $(call host-path,\ $(TARGET_CRTEND_O)) \ $(CONFIGURE_INCLUDES) CONFIGURE_LDFLAGS += -L$(SYSROOT)/usr/lib -L$(TARGET_OUT) CONFIGURE_INCLUDES += -I$(SYSROOT)/usr/include \ -I$(GSTREAMER_AGGREGATE_TOP)/libid3tag \ -I$(GSTREAMER_AGGREGATE_TOP)/libmad \ -I$(GSTREAMER_AGGREGATE_TOP)/faad/include CONFIGURE_CPP := $(TOOLCHAIN_PREFIX)cpp CONFIGURE_CXX := $(TOOLCHAIN_PREFIX)c++ LIB := $(SYSROOT)/usr/lib # as AOSP build else LIB := $(TARGET_OUT_SHARED_LIBRARIES) CONFIGURE_CC := $(patsubst %,$(PWD)/%,$(TARGET_CC)) CONFIGURE_CXX := $(patsubst %,$(PWD)/%,$(TARGET_CXX)) CONFIGURE_LDFLAGS += -L$(PWD)/$(TARGET_OUT_INTERMEDIATE_LIBRARIES) CONFIGURE_CFLAGS := \ -nostdlib -Bdynamic \ -Wl,-dynamic-linker,/system/bin/linker \ -Wl,--gc-sections \ -Wl,-z,nocopyreloc CONFIGURE_LDFLAGS += \ $(PWD)/$(TARGET_CRTBEGIN_DYNAMIC_O) \ $(call link-whole-archives,$(PRIVATE_WHOLE_STATIC_LIBRARIES))\ $(PRIVATE_STATIC_LIBRARIES) \ $(PWD)/$(TARGET_LIBGCC) \ $(PRIVATE_SHARED_LIBRARIES) \ $(PWD)/$(TARGET_CRTEND_O) CONFIGURE_CPP := $(PWD)/$(TARGET_TOOLS_PREFIX)cpp CONFIGURE_INCLUDES += \ $(foreach incdir, $(realpath $(C_INCLUDES) $(TARGET_C_INCLUDES)), -I$(incdir)) \ -I$(abspath $(TOP)/external/zlib) \ -I$(GSTREAMER_AGGREGATE_TOP)/libid3tag \ -I$(GSTREAMER_AGGREGATE_TOP)/libmad \ -I$(GSTREAMER_AGGREGATE_TOP)/faad/include endif CONFIGURE_CPPFLAGS := \ $(CONFIGURE_INCLUDES) CONFIGURE_CXXFLAGS := \ $(CONFIGURE_INCLUDES)</span></span></code> </pre><br>  Various environment variables required for compilation, linking, etc ... <br><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment"># configure as ./autogen.sh CONFIGURE := autogen.sh # or configure as ./configure CONFIGURE := configure</span></span></code> </pre><br>  Executable file to run the configuration. <br><br><pre> <code class="cmake hljs">CONFIGURE_PKG_CONFIG_LIBDIR := $(GLIB_TOP):$(gstreamer_TOP)/pkgconfig:$(GST_PLUGINS_BASE_TOP)/pkgconfig:$(GST_PLUGINS_GOOD_TOP)/pkgconfig:$(GST_PLUGINS_BAD_TOP)/pkgconfig:$(GSTREAMER_AGGREGATE_TOP)/x264 PKG_CONFIG := PKG_CONFIG_LIBDIR=$(CONFIGURE_PKG_CONFIG_LIBDIR) PKG_CONFIG_TOP_BUILD_DIR=<span class="hljs-string"><span class="hljs-string">"/"</span></span> pkg-config</code> </pre><br>  Environment variables for specifying the directories where package configuration files (pc-files) are located.  It does not always work, you often have to manually edit or even remove dependencies in files such as <b>configure.ac</b> to complete the configuration successfully. <br>  <b>Pkg-config</b> must be installed on the main system <br><br><pre> <code class="cmake hljs">GST_CFLAGS := \ -DD_GNU_SOURCE \ -DGST_DISABLE_DEPRECATED \ -DHAVE_CONFIG_H \ -I$(gstreamer_TOP)</code> </pre><br>  Specific global options for <b>Gstreamer</b> . <br><br><pre> <code class="cmake hljs">GST_CFLAGS += \ $(shell $(PKG_CONFIG) gstreamer --cflags)</code> </pre><br>  Add specific global options for <b>Gstreamer</b> from the configuration package.  This requires that the ‚Äúgstreamer‚Äù package is installed on the main system.  The option is not critical, but it is often useful. <br><br><h4>  Step 2. Preparing for configuration </h4><br>  Consider the creation of the Android.mk file, which will be located along the path ‚Äúexternal / gstreamer-aggregate / gst-plugins-bad / Android.mk‚Äù, to configure and create the final Android.mk files for building binary libraries / plug-ins.  Let's take the <a href="">Android.mk</a> file as a basis and take a closer look: <br><br><pre> <code class="cmake hljs">LOCAL_PATH := $(call my-dir) <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $(CLEAR_VARS)</code> </pre><br>  Setting the local path and clearing the values ‚Äã‚Äãof some variables. <br><br><pre> <code class="cmake hljs">GST_PLUGINS_BAD_TOP := $(LOCAL_PATH)</code> </pre><br>  Setting the top of the directory where <b>gst-plugins-bad</b> sources are located.  In our case, the variable GST_PLUGINS_BAD_TOP will point to "/ path / to / AOSP / external / gstreamer-aggregate / gst-plugins-bad". <br><br><pre> <code class="cmake hljs">GST_PLUGINS_BAD_BUILT_SOURCES := \ pkgconfig/gstreamer-plugins-bad-<span class="hljs-number"><span class="hljs-number">1.0</span></span>-uninstalled.pc \ pkgconfig/gstreamer-plugins-bad-<span class="hljs-number"><span class="hljs-number">1.0</span></span>.pc \ gst-libs/gst/baseparse/Android.mk \ gst-libs/gst/basecamerabinsrc/Android.mk \ gst-libs/gst/codecparsers/Android.mk \ gst-libs/gst/interfaces/Android.mk \ gst/h264parse/Android.mk \ ...</code> </pre><br>  This variable contains the paths and targets for make.  For example, we need to go into the folder ‚Äúgst / h264parse‚Äù and execute ‚Äúmake Android.mk‚Äù, for this we will execute the command ‚Äúcd gst / h264parse;  make Android.mk ", which is equivalent to the command" make -C 'gst / h264parse' Android.mk " <br><br><pre> <code class="cmake hljs">GST_PLUGINS_BAD_BUILT_SOURCES := $(patsubst %, $(abspath $(GST_PLUGINS_BAD_TOP))/%, $(GST_PLUGINS_BAD_BUILT_SOURCES))</code> </pre><br>  We change relative paths to absolute ones. <br><br><pre> <code class="cmake hljs">.PHONY: gst-plugins-bad-configure</code> </pre><br>  Add a "false" goal just in case. <br><br><pre> <code class="cmake hljs">gst-plugins-bad-configure: cd $(GST_PLUGINS_BAD_TOP) ; \ CC=<span class="hljs-string"><span class="hljs-string">"$(CONFIGURE_CC)"</span></span> \ CFLAGS=<span class="hljs-string"><span class="hljs-string">"$(CONFIGURE_CFLAGS)"</span></span> \ CXX=<span class="hljs-string"><span class="hljs-string">"$(CONFIGURE_CXX)"</span></span> \ CXXFLAGS=<span class="hljs-string"><span class="hljs-string">"$(CONFIGURE_CXXFLAGS)"</span></span> \ LD=$(TARGET_LD) \ LDFLAGS=<span class="hljs-string"><span class="hljs-string">"$(CONFIGURE_LDFLAGS)"</span></span> \ CPP=$(CONFIGURE_CPP) \ CPPFLAGS=<span class="hljs-string"><span class="hljs-string">"$(CONFIGURE_CPPFLAGS)"</span></span> \ PKG_CONFIG_LIBDIR=<span class="hljs-string"><span class="hljs-string">"$(CONFIGURE_PKG_CONFIG_LIBDIR)"</span></span> \ PKG_CONFIG_TOP_BUILD_DIR=/ \ $(abspath $(GST_PLUGINS_BAD_TOP))/$(CONFIGURE) \ --prefix=/system --host=arm-linux-androideabi \ --disable-gtk-doc \ --disable-valgrind &amp;&amp; \ for <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> in $(GST_PLUGINS_BAD_BUILT_SOURCES); do \ rm -f $$<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> &amp;&amp; \ make -C $$(dirname $$<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>) $$(basename $$<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>) ; \ done</code> </pre><br>  Create a <b>gst-plugins-bad-configure</b> target. <br>  When configuring, we always specify the option "--prefix = / system", since <b>by default in Android</b> all system libraries, applications, settings, etc.  located in the / system folder <br>  For ARM systems, be sure to specify the option "--host = arm-linux-androideabi". <br>  The remaining configuration options depend on your requirements, desires and capabilities. <br>  If necessary, you can use additional commands to clean the source "make distclean" and / or "autoreconf -fiv" before configuring. <br><br><pre> <code class="cmake hljs">-<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $(GST_PLUGINS_BAD_TOP)/gst-libs/gst/baseparse/Android.mk -<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $(GST_PLUGINS_BAD_TOP)/gst-libs/gst/basecamerabinsrc/Android.mk -<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $(GST_PLUGINS_BAD_TOP)/gst-libs/gst/codecparsers/Android.mk -<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $(GST_PLUGINS_BAD_TOP)/gst-libs/gst/interfaces/Android.mk -<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $(GST_PLUGINS_BAD_TOP)/gst/h264parse/Android.mk ...</code> </pre><br>  And at the very end are the paths to the Android.mk files that will collect libraries, applications, plugins, etc. <br><br><h4>  Step 3. Adding a target to the Makefile </h4><br>  Consider adding the ‚ÄúAndroid.mk‚Äù target to the Makefile.am file, which will be located along the path ‚Äúexternal / gstreamer-aggregate / gst-plugins-bad / ext / mpeg2enc / Makefile.am‚Äù, to build the Android.mk file to build the binary plugin.  Let's take the <a href="">Makefile.am</a> file as a basis and take a closer look: <br><br><pre> <code class="cmake hljs">plugin_LTLIBRARIES = libgstmpeg2enc.la</code> </pre><br>  Plugin name <br><br><pre> <code class="cmake hljs">libgstmpeg2enc_la_SOURCES = \ gstmpeg2enc.cc \ gstmpeg2encoptions.cc \ gstmpeg2encoder.cc \ gstmpeg2encstreamwriter.cc \ gstmpeg2encpicturereader.cc</code> </pre><br>  Source files required for build <br><br><pre> <code class="cmake hljs">libgstmpeg2enc_la_CXXFLAGS = \ $(GST_PLUGINS_BAD_CFLAGS) $(GST_PLUGINS_BASE_CFLAGS) $(GST_CXXFLAGS) $(MPEG2ENC_CFLAGS) libgstmpeg2enc_la_LIBADD = \ $(GST_PLUGINS_BASE_LIBS) -lgstvideo-@GST_API_VERSION@ \ $(GST_LIBS) $(MPEG2ENC_LIBS) libgstmpeg2enc_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS) libgstmpeg2enc_la_LIBTOOLFLAGS = --tag=disable-static</code> </pre><br>  Flags for compilation and linking <br><br><pre> <code class="cmake hljs">noinst_HEADERS = \ gstmpeg2enc.hh \ gstmpeg2encoder.hh \ gstmpeg2encoptions.hh \ gstmpeg2encstreamwriter.hh \ gstmpeg2encpicturereader.hh</code> </pre><br>  Header files <br><br>  We have everything you need to create the goal "Android.mk" <br><pre> <code class="cmake hljs">Android.mk: Makefile.am $(BUILT_SOURCES) androgenizer \ -:<span class="hljs-keyword"><span class="hljs-keyword">PROJECT</span></span> libgstmpeg2enc -:SHARED libgstmpeg2enc \ -:TAGS eng debug \ -:REL_TOP $(top_srcdir) -:ABS_TOP $(abs_top_srcdir) \ -:SOURCES $(libgstmpeg2enc_la_SOURCES) \ -:CFLAGS $(DEFS) $(DEFAULT_INCLUDES) $(libgstmpeg2enc_la_CXXFLAGS) \ -:LDFLAGS $(libgstmpeg2enc_la_LDFLAGS) \ $(libgstmpeg2enc_la_LIBADD) \ -ldl \ -:PASSTHROUGH LOCAL_ARM_MODE:=arm \ LOCAL_MODULE_PATH:='$$(TARGET_OUT)/lib/gstreamer-<span class="hljs-number"><span class="hljs-number">0.10</span></span>' \ LOCAL_CPP_EXTENSION:='.cc' \ &gt; $@</code> </pre><br>  It is necessary to pay attention to <b>LOCAL_CPP_EXTENSION</b> , I set the ".ss" forcibly, since by default Android uses the extension "cpp".  There are always problems if the project stores several files with different extensions ‚Äúcxx‚Äù, ‚Äúcpp‚Äù and ‚Äúcc‚Äù. <br><br>  Translation options <b>androgenizer</b> , which can be found in the <a href="http://cgit.collabora.com/git/android/androgenizer.git/tree/README.txt">README.txt</a> . <br><div class="spoiler">  <b class="spoiler_title">more</b> <div class="spoiler_text"><ul><li>  <b>-: PROJECT</b> Project name.  The parameter must be called first and only once. <br><br></li><li>  <b>-: SUBDIR</b> adds <b>-include</b> , in addition to the declared variable <b>‚Äπproject‚Ä∫ _TOP</b> <br><br></li><li>  Replacement path for <b>-I inclusions</b> <br><ul><li>  <b>-: ABS_TOP</b> sets the absolute path to the source folder </li><li>  <b>-: REL_TOP</b> sets the relative path to the source folder </li></ul><br>  It should always be: <i>-: REL_TOP $ (top_srcdir) -: ABS_TOP $ (abs_top_srcdir)</i> <br><br></li><li>  Types of modules created: <br><ul><li>  <b>-: STATIC</b> creates a static library for the target system (BUILD_STATIC_LIBRARY) </li><li>  <b>-: SHARED</b> creates a dynamic library for the target system (BUILD_SHARED_LIBRARY) </li><li>  <b>-: EXECUTABLE</b> creates an executable file for the target system (BUILD_EXECUTABLE) </li><li>  <b>-: HOST_STATIC</b> creates a static library for the host (BUILD_HOST_STATIC_LIBRARY) </li><li>  <b>-: HOST_SHARED</b> creates a dynamic library for the host (BUILD_HOST_SHARED_LIBRARY) </li><li>  <b>-: HOST_EXECUTABLE</b> creates an executable file for the host (BUILD_HOST_EXECUTABLE) </li></ul><br>  Multiple modules can be created using a single command line. <br><br></li><li>  Additional resources for modules (you must first declare a module!): <br><ul><li>  <b>-: SOURCES</b> source file list <br><br></li><li><ul><li>  <b>-: CFLAGS</b> flags for C compiler </li><li>  <b>-: CXXFLAGS</b> flags for C ++ compiler </li><li>  <b>-: CPPFLAGS</b> flags for C preprocessor </li></ul><br>  CPPFLAGS is used by C and C ++ compilers <br>  CFLAGS is used by C and C ++ compilers. <br>  CXXFLAGS is used only by the C ++ compiler <br><br>  Android uses various conventions, so don‚Äôt be surprised if CXXFLAGS is at the end of LOCAL_CPPFLAGS in Android.mk <br>  There is no way to pass only the C compiler flags to the Android build system. <br><br>  All <b>-I flags</b> in any of CFLAGS, CPPFLAGS or CXXFLAGS will be added to LOCAL_C_INCLUDES without "-I". <br><br>  some flags are deleted without warning: -Werror -pthread <br><br></li><li>  <b>-: LDFLAGS</b> linker options list: <br><ul><li>  <b>-l ‚Äπfoo‚Ä∫</b> add as lib ‚Äπfoo‚Ä∫ to LOCAL_SHARED_LIBRARIES </li><li>  <b>-L</b> and <b>-R</b> will be deleted without warning. </li><li>  <b>-pthread</b> and <b>-lpthread</b> will be deleted without warning </li><li>  <b>-lrt</b> will be deleted without warning (rt built-in library in bionic) </li><li>  <b>-no-undefined</b> will be deleted without warning. </li><li>  <b>-dlopen</b> , <b>-version-info</b> , and the words following them (optional arguments) will be deleted without warning </li><li>  Only files * .a and * .la are saved, the rest will be deleted without warning. </li></ul><br></li><li>  <b>-: LIBFILTER_STATIC</b> library list (without ‚Äúlib‚Äù prefix and extension) <br>  These libraries will be added to LOCAL_STATIC_LIBRARIES and excluded from LOCAL_SHARED_LIBRARIES. <br><br></li><li>  <b>-: LIBFILTER_WHOLE</b> library list (without ‚Äúlib‚Äù prefix and extension) <br>  These libraries will be added to LOCAL_WHOLE_STATIC_LIBRARIES. <br><br></li><li>  <b>-: TAGS</b> must include any of the parameters: optional user eng tests <br><br></li><li>  <b>-: HEADERS</b> header file list for LOCAL_COPY_HEADERS <br><br></li><li>  <b>-: HEADER_TARGET</b> sets LOCAL_COPY_HEADERS_TO, it may include several lines, but only the last one is saved <br><br></li><li>  <b>-: PASSTHROUGH</b> list of strings embedded in the current module configuration.  For example <b>LOCAL_ARM_MODE: = arm</b> <br><br></li><li>  <b>-: END</b> optional ... may be removed in the future.  Ends the description of the current module, and begins the description of the next one. </li></ul><br></li></ul><br></div></div><br><br><h4>  Step 4. Build </h4><br>  Download <a href="">androgenizer</a> , collect and put the program, where it will be visible from the PATH environment variable. <br>  Now we are ready to assemble the module.  To do this, go to the root <a href="http://source.android.com/">AOSP</a> and execute the command: <br><pre> <code class="bash hljs">make gst-plugins-bad-configure</code> </pre><br>  After some time, gst-plugins-bad will be configured and the output will be the finished Android.mk file: <br><div class="spoiler">  <b class="spoiler_title">external / gstreamer-aggregate / gst-plugins-bad / ext / mpeg2enc / Android.mk</b> <div class="spoiler_text"><pre> <code class="cmake hljs">LOCAL_PATH:=$(call my-dir) <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $(CLEAR_VARS) LOCAL_MODULE:=libgstmpeg2enc LOCAL_MODULE_TAGS:=eng debug LOCAL_SRC_FILES := \ gstmpeg2enc.cc \ gstmpeg2encoptions.cc \ gstmpeg2encoder.cc \ gstmpeg2encstreamwriter.cc \ gstmpeg2encpicturereader.cc LOCAL_SHARED_LIBRARIES:=\ libglib-<span class="hljs-number"><span class="hljs-number">2.0</span></span> \ libgobject-<span class="hljs-number"><span class="hljs-number">2.0</span></span> \ libgstreamer-<span class="hljs-number"><span class="hljs-number">0.10</span></span> \ libgstbase-<span class="hljs-number"><span class="hljs-number">0.10</span></span> \ libgstriff-<span class="hljs-number"><span class="hljs-number">0.10</span></span> \ libgsttag-<span class="hljs-number"><span class="hljs-number">0.10</span></span> \ libgstvideo-<span class="hljs-number"><span class="hljs-number">0.10</span></span> \ libdl LOCAL_LDFLAGS:=\ -module\ -avoid-version\ -<span class="hljs-keyword"><span class="hljs-keyword">export</span></span>-symbols-regex\ -no-undefined\ -Wl,-Bsymbolic-functions LOCAL_CFLAGS := \ -DHAVE_CONFIG_H \ -I. \ -I/path/to/AOSP/external/gstreamer-aggregate/gst-plugins-bad \ -I/path/to/AOSP/external/gstreamer-aggregate/gst-plugins-bad/gst-libs \ -I/path/to/AOSP/external/gstreamer-aggregate/gst-plugins-base \ -I/path/to/AOSP/external/gstreamer-aggregate/gst-plugins-base/gst-libs \ -I/path/to/AOSP/external/gstreamer-aggregate/gstreamer \ -I/path/to/AOSP/external/gstreamer-aggregate/glib/glib \ -I/path/to/AOSP/external/gstreamer-aggregate/glib \ -I/path/to/AOSP/external/gstreamer-aggregate/glib/gmodule \ -I/path/to/AOSP/external/gstreamer-aggregate/gstreamer/libs \ -DG_THREADS_MANDATORY \ -DG_DISABLE_DEPRECATED \ -Wall \ -Wdeclaration-after-statement \ -Wvla \ -Wpointer-arith \ -Wmissing-declarations \ -Wmissing-prototypes \ -Wredundant-decls \ -Wundef \ -Wwrite-strings \ -Wformat-nonliteral \ -Wformat-security \ -Winit-self \ -Wmissing-<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>-dirs \ -Waddress \ -Waggregate-<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> \ -Wno-multichar \ -Wnested-externs \ -Wno-unused \ -g \ -DGST_DISABLE_DEPRECATED LOCAL_PRELINK_MODULE := <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> LOCAL_ARM_MODE:=arm LOCAL_MODULE_PATH:=$(TARGET_OUT)/lib/gstreamer-<span class="hljs-number"><span class="hljs-number">0.10</span></span> LOCAL_CPP_EXTENSION:=.cc <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $(BUILD_SHARED_LIBRARY)</code> </pre><br></div></div><br><br><h4>  Results </h4><br>  Advantages: <br><ul><li>  Automatic generation of Android.mk files </li></ul><br>  Disadvantages: <br><ul><li>  Requires individual compilation and addition of Android.mk target to each Makefile </li><li>  It requires a file to work with each Android.mk file: very often some paths to the header files are not included, then extra options are added, etc. </li><li>  Embedding absolute paths in the file Android.mk, but I would like to be based on $ (LOCAL_PATH) </li></ul><br><br>  Articles used: <br><ul><li>  <a href="http://gstreamer.freedesktop.org/wiki/GstreamerAndroid_InstallInstructions">Gstreamer Android Install Instructions</a> </li><li>  <a href="http://blogs.igalia.com/eocanha/2012/01/30/from-source-code-to-ndk-build-using-autotools-and-androgenizer/">From source code to ndk-build using autotools and androgenizer</a> </li><li>  <a href="http://derekforeman.blogspot.ru/2012/04/androgenizer-porting-libtoolized.html">Androgenizer - porting libtoolized software to android, the easy way</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/164139/">https://habr.com/ru/post/164139/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../164125/index.html">Big Las Vegas Sony: Xperia Z and Xperia ZL</a></li>
<li><a href="../164127/index.html">New weather forecast</a></li>
<li><a href="../164131/index.html">Reverse Network Effects - What Big Networks Die From</a></li>
<li><a href="../164133/index.html">Answers Minister of Communications to the questions of users: part 3</a></li>
<li><a href="../164135/index.html">Russia and the United States will jointly fight free file sharing</a></li>
<li><a href="../164143/index.html">Microsoft Reporting Services Tips for Beginners</a></li>
<li><a href="../164145/index.html">Bitcoin Foundation holds a competition for projects on standardization, protection and promotion of Bitcoin</a></li>
<li><a href="../164147/index.html">Diskless network boot and life after it</a></li>
<li><a href="../164153/index.html">LLST: New Life Little Smalltalk</a></li>
<li><a href="../164157/index.html">App Annie: analysis of the mobile market in Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>