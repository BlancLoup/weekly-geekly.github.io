<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ceph as a connected storage: 5 practical conclusions from a large project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Given the growth of data in our time, it is increasingly often referred to software-defined and distributed data warehouses, with a lot of attention t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ceph as a connected storage: 5 practical conclusions from a large project</h1><div class="post__text post__text-html js-mediator-article">  Given the growth of data in our time, it is increasingly often referred to software-defined and distributed data warehouses, with a lot of attention traditionally paid to the open platform Ceph.  Today we want to talk about the findings to which we arrived in the process of implementing a project for storing data for one large Russian department. <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/jq/pm/iq/jqpmiqd9eymyfbnkqa8jjzk3kv4.png"><br><br>  When it comes to storing data of different types, of course, a distributed data warehouse immediately comes to mind.  Purely theoretically, there are many advantages of such solutions: you can use any disks, the system works on any servers (even very old ones), there is practically no limits to scaling.  That is why the introduction of such a system was launched several years ago in one of the major Russian departments with departments not only in all regions of the Russian Federation, but even in all more or less large cities. <br><br>  After analyzing the available solutions, the choice was made in favor of Ceph.  This decision was a number of reasons: <br>  ‚Ä¢ Ceph is a fairly mature product, and already today there are installations of Ceph on petabytes of information. <br>  ‚Ä¢ A large community (including us) is engaged in development, which means new features and improvements will appear for the repository. <br>  ‚Ä¢ Ceph already has a good API with support for various programming languages.  This was important because the product obviously needed to be finished to meet the requirements and expectations of the customer. <br>  ‚Ä¢ Licenses are not worth anything.  No, of course, the system needs to be refined, but in the case of specific customer tasks, it would be all the same to conduct additional development, so why not do it on the basis of a free product? <br>  ‚Ä¢ Finally, the sanctions.  State-owned companies should be insured from the fact that at the next moment in time someone comes up with the idea of ‚Äã‚Äãimposing restrictions on them, and therefore it is dangerous to rely on foreign and especially American products.  Another thing, Open Source. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Practical conclusions</b> <br>  The introduction of Ceph occurred gradually over several months.  First, the storage was launched in the central region, and then we replicated the solution, connecting regional data centers.  With the advent of each new network node, storage capacity increased, despite an increase in data flows within it, ensuring the transfer of information from the region to the region. <br>  A feature of the work of any large organization is the need to preserve heterogeneous information, which is often binary files.  As practice shows, employees simply have no time to figure out what kind of files they are, categorize them and process them in a timely manner - information manages to accumulate faster.  And in order not to lose the potentially important data for operating activities, it is necessary to organize their competent storage.  For example, on the basis of the distributed storage. <br>  And in the process of implementing such a project, we made several conclusions on the use of Ceph: <br><br>  <b>Conclusion 1: Ceph completely replaces all backup solutions.</b> <br>  As practice has shown, backup for most unstructured information is not performed at all, since it is extremely difficult to implement it.  When implementing Ceph, backup is obtained as if ‚Äúas a bonus.‚Äù  When setting up, we simply set the replication parameters ‚Äî the number of copies and their location.  If the customer has several data centers, a disaster-proof configuration is obtained, which simply does not require additional backups if there are - 3-4 copies of data on different drives and servers.  Such a system works guaranteed better than any hardware solution, at least for the time being about large amounts of data and geographically distributed systems. <br><br>  <b>Conclusion 2: With large installations, Ceph performance is 99% equal to network performance.</b> <br>  When we transferred data from a PostgreSQL database (more on this below) to a ceph-based storage, the ‚Äúfill‚Äù speed in most cases was equal to the data transmission network bandwidth.  If in some cases this was not the case, reconfiguring Ceph made it possible to achieve this speed.  Of course, here we are not talking about connections of 100 Gbps, but with data channels standard for geographically distributed infrastructures, it is quite possible to achieve Cephp performance at 10 Mbps, 100 Mbps or 1 Gbps.  It is enough to distribute disks correctly and set up information clustering. <br><br>  <b>Conclusion 3: The main thing is to correctly configure ph taking into account the peculiarities of the company's activity</b> <br>  By the way, about the settings - the largest part of the expertise in the work of Ceph is required at the stage of system configuration.  In addition to the replication parameters, the solution also allows you to specify access levels, data retention rules, and so on.  For example, if we have mini-computing centers throughout Russia, we can organize quick access to documents and files created in our region, as well as access to all corporate documents from anywhere.  The latter will work with somewhat greater delays and lower speed, but such a ‚Äúconcentration‚Äù of information at the place of ownership creates optimal conditions for the organization‚Äôs work. <br><br>  <b>Conclusion 4: When it is already configured, any Linux administrator can manage Ceph.</b> <br>  Perhaps one of the most pleasant features of Ceph is that the system works without unnecessary human involvement when it is already configured.  That is, it turned out that in the remote mini data centers it is enough to simply contain a Linux administrator, since the support for the next Ceph segment does not require any additional knowledge. <br><br>  <b>Conclusion 5: The addition of Ceph with an external indexing system makes the repository convenient for contextual search.</b> <br>  As you know, inside eph there is no index that can be used to search by context.  Therefore, when adding an object to the repository, you can save meta-data that serves as an index.  Their volume is rather small, and therefore the usual relational DBMS easily copes with them.  Of course, this is an additional system, but this approach allows you to quickly find information on the context among the huge amounts of unstructured data. <br><br><img src="https://habrastorage.org/webt/mm/fi/yl/mmfiylk06uevnxtcso-fkiak0a8.png"><br><br>  <b>A few words about data transfer</b> <br>  A large project involves many stages, but the most interesting for us, perhaps, was the process of transferring huge amounts of data from PostgreSQL to a new repository.  After launching Ceph, a task arose to migrate data from a variety of databases, without stopping services and business processes and ensuring the integrity of information. <br>  To do this, we had to contribute to the development of the open source project of Ceph and create the migration module pg_rbytea, the source code of which can be found at the link ( <a href="https://github.com/val5244/pg_rbytea">https://github.com/val5244/pg_rbytea</a> ).  The essence of the solution was to simultaneously transfer data from the specified database to the ceph storage.  The developed module allows you to simultaneously migrate data without stopping the database using the abstraction of the Rados object storage, the support of which is implemented in Ceph at the native level.  By the way, about this we made a report on PG Conf in early 2018 ( <a href="https://pgconf.ru/2018/107082">https://pgconf.ru/2018/107082</a> ). <br>  At the first stage, various binary data necessary for the functional work of the departments of the department were transferred to the repository.  In fact, all those files and objects that are not clear how to store because of their huge total volume and fuzzy structure.  Next, it is planned to transfer to Ceph various media content, storage of original documents that are created before recognition and attachments from corporate letters. <br>  In order for all this to work on top of the repository, RESTful services were developed, which made it possible to use Ceph for integration into customer systems.  Here again, the presence of a convenient API that allows you to create a plug-in service for various information systems played a role.  So Ceph and became the main repository, claiming more and more new volumes and types of information within the organization. <br><br>  <b>Conclusion</b> <br>  Different distributed data warehouses are on the market, including commercial solutions and other open source products.  Some of them use special optimizations, others work with compression or use Erasure Coding.  However, in practice we were convinced that Ceph is ideally suited for truly distributed environments and huge storage facilities, because in this case the system performance is limited only by the speed of the communication channels, and you save a lot of money on licenses by the number of servers or by the amount of data (depending on with which to compare the product).  A well-tuned Ceph system allows for optimal performance with minimal supervision by local local administrators.  And this is a serious advantage if you introduce a geographically distributed implementation. </div><p>Source: <a href="https://habr.com/ru/post/417613/">https://habr.com/ru/post/417613/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../417603/index.html">Announcement of mobile mitap: What to do when the application has become large?</a></li>
<li><a href="../417605/index.html">Basics of 3D modeling for 3D printing</a></li>
<li><a href="../417607/index.html">A / V tests do not work. Check what you are doing wrong</a></li>
<li><a href="../417609/index.html">Specialization in sports programming on Curser</a></li>
<li><a href="../417611/index.html">We start service of an assessment of employers on "My circle"</a></li>
<li><a href="../417615/index.html">Confessions of a burglar drives for Apple II: Secrets 4am</a></li>
<li><a href="../417617/index.html">Cassandra for storing metadata: successes and failures</a></li>
<li><a href="../417619/index.html">Win32 / Glupteba is no longer associated with the operation of Windigo</a></li>
<li><a href="../417621/index.html">What happened when we hacked the show?</a></li>
<li><a href="../417627/index.html">Hyper CRM or mini ERP? Business is confused</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>