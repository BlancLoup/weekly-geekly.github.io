<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automation against chaos</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The modern development of IT technology has allowed to curb huge data streams. 
 The business has a variety of tools: CRM, ERP, BPM, accounting system...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automation against chaos</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/qz/sq/j9/qzsqj9kwc7g4xeaponeocm3phxy.jpeg"><br><br>  The modern development of IT technology has allowed to curb huge data streams. <br>  The business has a variety of tools: CRM, ERP, BPM, accounting systems, or, as a last resort, just Excel and Word. <br><br>  Companies are also different.  Some consist of many separate branches.  In this case, the business has the problem of data synchronization in the zoo IT systems.  Moreover, the branches have different vendors or software versions.  And frequent changes in reporting requirements from the management company provoke attacks of uncontrollable ‚Äújoy‚Äù in the field. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This story is about a project in which I happened to face the chaos that needed to be systematized and automated.  A modest budget and tight deadlines limited the use of most industrial solutions, but opened up scope for creativity. <br><a name="habracut"></a><br><h2>  Universal format </h2><br>  The customer set the task of collecting data for reports from all branches of the company.  To understand the scale of a disaster, there are dozens of systems, among which there are both samopisnye and monsters like SAP, and, of course, 1C - where without it. <br><br>  In one report, data from: accounting, repairmen, PR managers, MES, meteorologists could cross. <br><br>  Prior to the start of the project, the main part of the data was sent to the parent company via email in the form of Word / Excel attachments.  Further, the process resembled the sunset manually: the data were processed by specially trained people and entered into a pair of systems.  The result of labor were dozens of reports, on the basis of which management decisions were taken. <br><br>  On the choice of the approach, we pushed the format of the files being sent, namely xlsx / docx.  Even the ‚Äúancient‚Äù systems in the branches didn‚Äôt support the uploading of data to these formats, well, or in extreme cases, copy-paste was not canceled. <br><br>  Our plan was stubborn: <br><br><ol><li>  we describe the structure of each report and the rules for its transmission; </li><li>  We lower the requirements for setting up systems for sending documents by email in accordance with the regulations.  Where there are no systems - sending, as before, by hands; </li><li>  develop a program that: <br><ul><li>  selects certain documents from incoming mail; </li><li>  extracts data from them; </li><li>  writes the extracted data to the database, as well as ‚Äúbeats the hands‚Äù of the violators of the regulations. </li></ul><br></li></ol><br><img src="https://habrastorage.org/webt/6b/na/ev/6bnaevbsj113vtojoryl6pkxt2s.png"><br><br><h2>  Implementation </h2><br><h3>  Organizational matters </h3><br>  At the stage of collecting and formalizing the requirements for the structure and regulations of the data transfer, it turned out that there was no description of the structure of the reports, at all.  Everything was stored in the heads of some of the employees and was transmitted as word-of-mouth by Russian folk tales.  But the real problems started later - when setting up data exchange. <br><br><h4>  Problem one </h4><br>  The difference in the structure of documents from the reference and data quality.  In the reports, the amounts sometimes did not converge, the columns were mixed up in places or had incorrect names.  The problem was mainly observed in the branches, where the data were driven in manually. <br><br>  The solution is the introduction of a three-step test: <br><br><ol><li>  Creating Excel reference documents with a rigid structure, means of Excel itself.  In such documents, only data entry cells were available.  On which checks were additionally superimposed: type, convergence of amounts, etc. </li><li>  Checks when extracting data from the report.  For example, comparison of the current date and date in the paragraph of the Word document or arithmetic checks for data from an Excel document (if they cannot be specified in the document itself). </li><li>  In-depth data analysis after collection.  For example, the detection of significant deviations in key indicators in comparison with previous periods. </li></ol><br><h4>  Problem two </h4><br>  A systematic violation of the data transfer schedule or unscrupulous attempts at sabotage: ‚ÄúWe never sent data to anyone, but here you are with yours ...‚Äù, ‚ÄúYes, I sent everything on time, this ping is probably bad.‚Äù <br><br>  The solution is feedback.  The system automatically notifies the responsible persons in the branch, in case of violation of the schedule.  Later, the feedback subsystem was screwed to the input data quality control system and to the final reports generation system, so that the branch immediately received a summary of its data and comparison with its ‚Äúneighbors‚Äù.  <s>To make it clear why he ogrebet.</s> <br><br><h3>  Subsystems developed </h3><br><br><ol><li>  The document data types configurator, where you can quickly describe: <br><ul><li>  attributes for document identification; </li><li>  transfer regulations; </li><li>  data extraction algorithm; </li><li>  other attributes like a code path that checks and stores data. </li></ul><br></li><li>  Recipient of the mail, moving attachments to an isolated storage (sandbox) and storing the accompanying information about the letter; </li><li>  Attachment parser, which defines document types and extracts data from them. </li></ol><br><img src="https://habrastorage.org/webt/7s/bp/ef/7sbpefc8oczlxcc6xyrauq4309y.png"><br><br><h4>  Configurator </h4><br>  Historically, all documents with data come to the general mail, where it is full of other important and not very letters.  Signs are needed by which the necessary documents will be determined.  The name of the document or the text in the body of the email is all unreliable and inconvenient for the sender.  Therefore, it was decided that the report will be determined only by the content of the document.  In addition, you need to uniquely determine what type of report contains a document. <br><br>  By brainstorming, the horse-radish thought up how many signs to identify the document: the color of the text in the cell, the font and so on.  But the most correct was the sign of the presence of a substring in a particular cell ‚Äúslot‚Äù or an array of cells for Excel and a paragraph or heading for Word.  For the ‚Äúslot,‚Äù simple formal logic was added: ‚Äúequal‚Äù, ‚Äúunequal‚Äù, ‚Äúmore‚Äù, ‚Äúless‚Äù, etc. Example for Excel: in the A2-E4 range, the cell text should be equal to ‚ÄúDaily equipment load summary‚Äù. <br><br><img src="https://habrastorage.org/webt/km/aj/ea/kmajeaf8og5y17cnfronq3x2wmq.png"><br><br>  Similarly, the document area is set up in which you need to search for the beginning and end of the data (approx. End search conditions: 2 blank lines in a row). <br><br><img src="https://habrastorage.org/webt/u1/9t/hh/u19thhrwphi6bbdfifx1bt6tk84.png"><br><br>  A list of other useful settings: a list of allowed senders, the type of document (Excel / Word) and the path to export data. <br><br>  At the output we get a JSON structure (template) describing the report. <br><br><h4>  Mail recipient </h4><br>  The mail reader, which places all the documents from attachments in the sandbox, saves the attributes of the letter and puts the documents in the task queue for parsing. <br><br>  There are 2 security questions: <br><br><ol><li>  What if the data is sent to another branch? </li><li>  What if data is sent by intruders? </li></ol><br>  The first question is solved by checking the email address of the sending branch and the branch specified in the report body. <br><br>  The second is using <a href="http://www.openspf.org/">SPF</a> . <br><br><h4>  Attachment parser </h4><br>  Almost all libraries for parsing Word and Excel have serious limitations on the supported versions, so first you need to convert the document.  Libre Office solves this problem on the top five. <br><br>  After conversion: <br><br><ol><li>  we remove the array of templates by basic features from the configurator (Word / Excel, sender ...); </li><li>  we run the document with the remaining templates; </li><li>  If the template is found, we retrieve the data and transfer it to the repository. </li></ol><br><h2>  Total </h2><br>  We made it! <br>  After two months of hard work, the head office began to regularly receive data for reports from all branches.  Moreover, the quality and completeness of the data was unprecedentedly different from what it was before, and the released human resources paid for the project costs by the end of the year. <br><br>  For ourselves, we learned that integration is not always painful and highlighted the main aspects of success: <br><br><ol><li>  we did not climb inside the systems in the branches; </li><li>  formalized and approved a single structure of reports and the rules for their transfer; </li><li>  created output formats for all systems that are generally available in the form of Excel and Word documents; </li><li>  Choose the most common method of data delivery - email. </li></ol><br>  And two main disadvantages: <br><br><ul><li>  Low speed data delivery. </li><li>  The size of the data packet should not exceed the size of a regular email attachment. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/421705/">https://habr.com/ru/post/421705/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../421693/index.html">The Story Of An API: How We Turned Frankenstein Into A Handsome Boy</a></li>
<li><a href="../421695/index.html">[Not] ordinary networks: how to detect water in your bag using Wi-Fi</a></li>
<li><a href="../421699/index.html">How to get rid of errors with tables of Active Object when restoring Jira from backup</a></li>
<li><a href="../421701/index.html">Sandbox and Python Learning Cheat Sheet</a></li>
<li><a href="../421703/index.html">Linux at home or ...</a></li>
<li><a href="../421707/index.html">FB2D - 2D framework for Linux Frame Buffer (Rust)</a></li>
<li><a href="../421709/index.html">New (and old) units of measure in CSS that you‚Äôd hardly heard of</a></li>
<li><a href="../421711/index.html">Analysis of service requests using machine learning</a></li>
<li><a href="../421713/index.html">How to find bots on YouTube: external commentator interaction patterns</a></li>
<li><a href="../421717/index.html">Where do analysts study?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>