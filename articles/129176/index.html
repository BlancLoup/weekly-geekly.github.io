<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to start and do not stop writing OS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Reading Habr during the last two years, I have seen only a few attempts to develop the OS (if specifically: from pehat and iley users (postponed indef...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to start and do not stop writing OS</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/3b4/85f/843/3b485f8438e61ad1c0e42702d716bde6.jpg" alt="Another bike" align="left">  Reading Habr during the last two years, I have seen only a few attempts to develop the OS (if specifically: from <a href="http://geektimes.ru/users/pehat/" class="user_link">pehat</a> and <a href="http://geektimes.ru/users/iley/" class="user_link">iley users</a> (postponed indefinitely) and <a href="http://geektimes.ru/users/igor1024/" class="user_link">Igor1024</a> (not abandoned, but so far more like the description of the work of protected mode x86-compatible processors, which undoubtedly also needs to be known for writing an OS under x86; and a description of the finished system from <a href="http://geektimes.ru/users/alman/" class="user_link">alman</a> (though not from scratch, although there is nothing bad about it, maybe even vice versa)).  For some reason I think that almost all system programmers (and some of them are applied) at least once, but thought about writing their own operating system.  In this connection, 3 OS from a large community of this resource seems a ridiculous number.  Apparently, most people who think about their own OS do not go further than that, and a small part stops after writing the bootloader, few write kernel pieces, and only hopelessly hard-nosed ones create something remotely resembling an OS (if compared with something like Windows / Linux) .  There are many reasons for this, but the main thing in my opinion is that people abandon the development (some even fail to start) due to the small number of descriptions of the process of writing and debugging the OS, which is quite different from what happens during development application software. <br><br>  I would like to show this small note that, if I start correctly, there is nothing particularly difficult in developing my own OS.  Under the cut is a brief and fairly general guide to action on writing the OS from scratch. <br><br><a name="habracut"></a><br><h5>  How <b>not to</b> start </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/ea8/17d/aff/ea817daff6be2127b130f21721ac8633.jpg" alt="Don't do that" align="left">  Please do not take the following text as an obvious criticism of someone's articles or manuals on writing the OS.  It‚Äôs just too often in such articles under loud headlines the emphasis is on the implementation of some minimal workpiece, and it is served as a prototype of the core.  In fact, you should think about the structure of the kernel and the interaction of parts of the OS as a whole, and consider that prototype as a standard ‚ÄúHello, World!‚Äù - an application in the world of application software.  As a small excuse for these remarks, it should be said that below there is a subsection ‚ÄúHello, World!‚Äù, Which in this case is given exactly as much attention as needed, and no more. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Do not write a bootloader.  Smart people came up with the <a href="http://ru.wikipedia.org/wiki/Multiboot_Specification">Multiboot Specification</a> , implemented and described in detail what it is and how to use it.  I do not want to repeat myself, I just say that it works, makes life easier, and it should be used.  Specification, by the way, it is better to read completely, it is small and even contains examples. <br><br>  No need to write the OS completely in assembler.  It's not that bad, rather the opposite - fast and small programs will always be in high esteem.  Just because this language requires much more development, the use of assembler will only lead to a decrease in enthusiasm and, as a result, to throwing the OS sources into a long box. <br><br>  No need to load a custom font in the video memory and display something in Russian.  No sense from this.  It is much easier and more versatile to use English, and leave the font change for later, loading it from the hard disk through the file system driver (at the same time there will be an additional incentive to do more than just start). <br><br><h5>  Training </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/a55/2a8/17c/a552a817ccabc0ac50015d6a39a51d85.jpg" alt="preparations" align="left">  To begin with, as always, you should familiarize yourself with the general theory in order to have some ideas about the forthcoming amount of work.  Good sources on this issue are the books of E. Tanenbaum, which have already been mentioned in other articles on writing OS on Habr√©.  There are also articles describing existing systems, and there are various guides / newsletters / articles / examples / sites with a bias in OS development, links to some of which are given at the end of the article. <br><br>  After the initial educational program, you need to decide on the main issues: <br><ul><li>  The target architecture is x86 (real / protected / long mode), PowerPC, ARM, ... </li><li>  kernel architecture / OS - monolith, modular monolith, microkernel, exo-kernel, various hybrids </li><li>  language and its compiler - C, C ++, ... </li><li>  kernel file format - elf, a.out, coff, binary, ... </li><li>  development environment (yes, it also plays an important role) - IDE, vim, emacs, ... </li></ul><br>  Further it is necessary to deepen knowledge according to the chosen and in the following areas: <br><ul><li>  video memory and work with it - the conclusion as proof of work is necessary from the very beginning </li><li>  HAL (Hardware Abstraction layer) - even if the support of several hardware architectures does not plan to properly separate the lowest-level parts of the kernel from the implementation of such abstract things as processes, semaphores, and so on, it will not be superfluous </li><li>  memory management - physical and virtual </li><li>  performance management - processes and flows, their planning </li><li>  device management - drivers </li><li>  virtual file systems - to provide a single interface to the contents of various filesystems </li><li>  API (Application Programming Interface) - how exactly applications will access the kernel </li><li>  IPC (Interprocess Communication) - sooner or later, processes will have to interact </li></ul><br><h5>  Instruments </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/371/1cb/385/3711cb385903a76e440144b35af99749.jpg" alt="tools" align="left">  Considering the chosen language and development tools, you should choose such a set of utilities and their settings, which in future will allow, by writing scripts, to simplify and speed up the assembly, preparing the image and launching the virtual machine with the project as much as possible.  Let us dwell in more detail on each of these points: <br><ul><li>  Any standard tools such as make, cmake, ... are suitable for building. Scripts for the linker and (specially written) utilities for adding a Multiboot header, checksums or for any other purposes can be used here. </li><li>  the preparation of the image means its mounting and copying files.  Accordingly, the image file format must be selected so that it is supported by both the mount / copy utility and the virtual machine.  Naturally, no one forbids to perform actions from this point either as the final part of the assembly, or as preparation for the launch of the emulator.  It all depends on the specific means and selected options for their use. </li><li>  starting a virtual machine of labor does not represent, but you need to remember to unmount the image first (unmounting at this point, since there is no real sense in this operation before starting the virtual machine).  Also, the script for running the emulator in debug mode (if one is available) will not be superfluous. </li></ul><br><h5>  Hello, World! </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/f9e/ac7/67b/f9eac767b1404ebf6eef95a54293ba95.jpg" alt="Hello, World!" align="left">  If all the previous steps are completed, you should write a minimal program that will boot as a kernel and display something on the screen.  In case of inconvenience or shortcomings of the chosen means, it is necessary to eliminate them (shortcomings), or, at worst, take them for granted. <br><br>  In this step, you need to test as many features of the development tools that you plan to use in the future.  For example, loading modules into GRUB or using a virtual machine with a physical disk / partition / flash drive instead of an image. <br><br>  After this stage is successful, the real development begins. <br><br><h5>  Providing run-time support </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/3f8/0b4/0e4/3f80b40e4764b86c5916ddda3bf8689f.jpg" alt="runtime" align="left">  Since it is proposed to write in high-level languages, care should be taken to provide support for some of the language tools that are usually implemented by the authors of the compiler package.  For example for C ++, these include: <br><ul><li>  function to dynamically allocate a block of data on the stack </li><li>  work with heap </li><li>  data block copy function (memcpy) </li><li>  function-entry point to the program </li><li>  calls to constructors and global object destructors </li><li>  a number of functions for working with exceptions </li><li>  stub for unrealized pure-virtual functions </li><li>  ... </li></ul><br>  When writing ‚ÄúHello, World!‚Äù, The absence of these functions may not be felt in any way, but as you add code, the linker will start complaining about unmet dependencies. <br><br>  Naturally, you should immediately mention the standard library.  A full implementation is not necessary, but the main subset of functions is worth realizing.  Then writing code will be much more familiar and faster. <br><br><h5>  Debugging </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/fae/161/ecb/fae161ecb14d5045044c21497fe891af.jpg" alt="debugging" align="left">  Do not look at debugging at the end of the article.  In fact, this is a very serious and difficult question in the development of the OS, since the usual means are not applicable here (with some exceptions). <br><br>  Can advise the following: <br><ul><li>  a matter of course debugging output </li><li>  assert with immediate debugger access (see next paragraph) </li><li>  some semblance of a console debugger </li><li>  check if the emulator does not allow to connect a debugger, symbol tables or something else </li></ul><br>  Without the debugger built into the kernel, finding errors has a very real chance of becoming a nightmare.  So from its writing at some stage of development just can not escape.  And since this is unavoidable, it is better to start writing it in advance and thus significantly facilitate development and save a lot of time.  It is important to be able to implement the debugger in a manner independent of the kernel, so that debugging has a minimal effect on the normal operation of the system.  Here are some types of commands that may be helpful: <br><ul><li>  part of the standard debugging operations: breakpoints, call stack, output values, print dump, ... </li><li>  commands for outputting various useful information, such as the execution queue of the scheduler or various statistics (it is not as useless as it may seem at first) </li><li>  commands for checking the consistency of the state of different structures: free / used memory lists, heap or message queue </li></ul><br><h5>  Development </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/09f/846/1a6/09f8461a63611d23d3d903ecccfa7c5f.jpg" alt="devel" align="left">  Next, you need to write and debug the basic elements of the OS, which at the moment should ensure its stable operation, and in the future - easy extensibility and flexibility.  In addition to memory managers / processes / (something else), the interface of drivers and file systems is very important.  Their design should be approached with great care, taking into account the variety of types of devices / FS.  Over time, they can of course be changed, but this is a very painful and error-prone process (and debugging the kernel is not an easy task), so just remember - think about these interfaces at least ten times before you take up their implementation. <br><br><h5>  Similarity SDK </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/3c4/b7e/555/3c4b7e555c36a424cd9c5ae5e4da2b4b.jpg" alt="Sdk" align="left">  As the project develops, new drivers and programs should be added to it.  Most likely, some common features (directory structure, assembly management files, specification of dependencies between modules, duplicate code in main or in system request handlers (for example, if the drivers themselves check their compatibility with the device )).  If so, then this is a sign of the need to develop templates for various types of programs for your OS. <br><br>  There is no need for documentation describing the process of writing one or another type of program.  But it is worth making a blank of standard elements.  This will not only make it easier to add programs (which you can do by copying existing programs and then changing them, but it will take more time), but it will also make it easier to update them with changes in interfaces, formats or something else.  It is clear that such changes ideally should not be, but since the development of the OS is not a typical thing, there are a lot of places for potentially wrong decisions.  But the understanding of the fallacy of the decisions taken will always come some time after their implementation. <br><br><h5>  Next steps </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/20e/1bf/07c/20e1bf07c533f75a8979ca8e7ebeb9ba.jpg" alt="continue" align="left">  In short, then: read about the operating systems (and first of all, about their device), develop your system (the pace is not really important, the main thing is not to stop at all and return to the project from time to time with new forces and ideas) and it is natural to correct errors in it (in order to find which it is sometimes necessary to start the system and ‚Äúplay‚Äù with it).  Over time, the development process will become easier and easier, mistakes will occur less frequently, and you will be enrolled in the list of "hopelessly hard-nosed", those few who, despite some absurdity in the idea of ‚Äã‚Äãdeveloping their own OS, have done so. <br><br><h5>  useful links </h5><br>  On Habr√©: <br>  <a href="http://habrahabr.ru/blogs/system_programming/101810/">Writing Your OS: Release 1</a> <br>  <a href="http://habrahabr.ru/blogs/system_programming/104988/">Writing Your OS: Release 2</a> <br>  <a href="http://habrahabr.ru/blogs/system_programming/118647/">We continue to write OSes.</a>  <a href="http://habrahabr.ru/blogs/system_programming/118647/">Step by step</a> <br>  <a href="http://habrahabr.ru/blogs/system_programming/118881/">What is Protected Mode and what it is eaten with</a> <br>  <a href="http://habrahabr.ru/blogs/system_programming/119058/">We learn system of paging addressing and interrupt handling</a> <br>  <a href="http://habrahabr.ru/blogs/system_programming/120685/">We start talking about multitasking</a> <br>  <a href="http://habrahabr.ru/blogs/system_programming/122171/">Memory and tasks</a> <br><br>  Other sources with a lot of information on OS development: <br>  <a href="http://wasm.ru/">wasm.ru</a> <br>  <a href="http://sysbin.com/">sysbin.com</a> <br>  <a href="http://wiki.osdev.org/">wiki on osdev.org</a> <br>  <a href="http://www.iakovlev.org/">iakovlev.org</a> <br>  <a href="http://www.osdever.net/">Bona fide os</a> </div><p>Source: <a href="https://habr.com/ru/post/129176/">https://habr.com/ru/post/129176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129170/index.html">Farminers: in the morning you present a startup, in the evening you get 150,000 dollars of investment!</a></li>
<li><a href="../129172/index.html">Crossbeam and XOS, what is it and how to cook them correctly</a></li>
<li><a href="../129173/index.html">We are taking away other cookies from mail.ru</a></li>
<li><a href="../129174/index.html">RedDwarf - server platform for developing online games in Java</a></li>
<li><a href="../129175/index.html">Digest Wanted.VC # 16</a></li>
<li><a href="../129177/index.html">If This Then That (ifttt). Web services binding mashup</a></li>
<li><a href="../129178/index.html">No one wants to pay for dry reports. Interview with Avinash Koshik</a></li>
<li><a href="../129179/index.html">Analysts: New tablet from Amazon will compete with iPad</a></li>
<li><a href="../129180/index.html">FreeRTOS: interprocess communication</a></li>
<li><a href="../129181/index.html">Methods of dealing with DDoS attacks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>