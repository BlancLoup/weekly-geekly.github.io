<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using the Troika card as a mandatory medical insurance policy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When the trees were a little higher, the grass is greener, the sun is brighter, and I studied at the institute, I had a student social card. I liked i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using the Troika card as a mandatory medical insurance policy</h1><div class="post__text post__text-html js-mediator-article">  When the trees were a little higher, the grass is greener, the sun is brighter, and I studied at the institute, I had a student social card.  I liked it for its functionality and thoughtfulness, but, like all good things, it expired and I had to forget about this good of Moscow civilization indefinitely.  It was replaced by Troika, which was partially able to absorb the advantages of SCS, but not all ... <br><a name="habracut"></a><br><h4>  Three + OMS policy =?  or how it all began </h4><br>  It all started with the fact that I got sick and found that I had lost my compulsory medical insurance card.  Despite the fact that I remembered the number by heart, I needed something that could be attached to the green infomat in the clinic, otherwise, I could not sign up to the doctor and get a legal sick leave.  There were many options: restore the policy (in order to find the old one at the first cleaning);  generate and print the barcode of the policy (the barcode on the paper is not solid), or take my old social card with me ... I settled on the last option.  To be more precise, I decided not to dwell on it, but to write my policy on the top three in the same way as it was recorded on the Muscovite's social card. <cut></cut><br><br><h4>  Tuning Three </h4><br>  Knowing the capabilities of Mifare Classic - compatible cards, I decided to combine Troika and an old student card for the sake of convenience and just out of interest in the result of the experiment. <br>  As we know, the Mifare Classic 1K and 4K cards were taken out of circulation due to vulnerabilities in favor of the more secure but compatible Mifare Plus S, Plus X 2k or Plus EV1 2k.  But the essence remained the same: both social and Troika cards have the same filling, with a difference only in volume (the number of protected sectors, which in our case is absolutely irrelevant). <br><br>  Armed with articles about Troika and Android security research using the Mifare Classic Tool application, I decided to first look inside the social card to find the place where the OMS policy number is recorded.  Thanks to the <a href="https://www.mos.ru/authority/documents/doc/22526220/">document of almost twenty years ago,</a> I already assumed that it would be in the 5th sector of the map, reserved as a medical application of MGFOMS, which was confirmed in practice. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/bj/1x/jk/bj1xjk-n4nfvpbhj5abmzlxw2um.jpeg"><br><br>  The required policy number was in the 5th sector on the second line from the 2nd to the 9th byte, that is, in this case " <b>7700009016811218</b> ".  Well, there‚Äôs a clue (or rather, there‚Äôs a clutch)! <br><br>  As for the Troika card, there the 5th sector is packed with zeros, that is, it is not yet used.  The keys A and B are different from those on the SCS, but this is fixable, they can be rewritten the same as there. <br><br><img src="https://habrastorage.org/webt/co/hj/zl/cohjzl-ris0psvj5wn5q2jdta9m.jpeg"><br><br><h4>  The experiments </h4><br>  In addition to the coveted CHI number, the sector also contained other data, the purpose of which is unknown to me.  Having read the articles about the 8th sector (electronic wallet) and its security with self-inserts, I suggested that here this data can play the same role as an self-insert or checksum to verify the integrity of data in the sector.  Therefore, I decided to check this by rewriting the entire sector on one Troika exactly as on SCS, and on the second - only the policy number.  No sooner said than done! <br><br>  He removed the full dump from the SCS, and recorded the entire 5th sector on the first Troika, and on the second - wrote the edited dump of the 5th sector, where only the policy number appears. <br><br><h4>  results </h4><br>  <b>Having walked to the clinic and checked both cards, I was able to enter the info from both of them and make an appointment with the doctor!</b>  Of course, as an authentication method, you should select ‚ÄúMuscovite Card‚Äù or ‚ÄúMuscovite Social Card‚Äù (both methods work) and attach the card to the reader. <br><br>  It follows that infomats only need the policy number in the space allotted for it and the keys they know from the fifth sector. <br><br>  Now it‚Äôs possible to surprise the clinic‚Äôs employees a lot by demonstrating the use of Troika as a mandatory medical insurance policy and through more convenient and modern contactless authentication, because even modern medical insurance policies do not support contactless information exchange ‚Äî they must be inserted into the infomat with a chip.  And the ‚ÄúTroika‚Äù is truly becoming the key to the city, in particular, to the clinics. <br><br>  Update 1: At the request of the workers, I‚Äôll tell you ‚Äúon fingers‚Äù how to do it.  As I wrote above, the Mifare Classic Tool for Android is great for this. <br>  Further: <br>  1. Click "Read tag" <br>  2. Check that the key files std.keys and extended-std.keys are selected <br>  3. We put the triple against the phone and click on Start mapping and read tag.  The phone will think for a while while it will pick up the keys. <br>  4. Upon completion, a dump will open (the card can be removed from the phone while editing).  In it we are interested in sector number 5. It looks like this: <br>  00000000000000000000000000000000 <br>  00000000000000000000000000000000 <br>  00000000000000000000000000000000 <br>  <font color="#00FF00">FBC2793D540B</font> <font color="#FF6600">7C378800</font> <font color="#009966">D3A297DC2698</font> <br>  Below are the keys <font color="#00FF00">A</font> and <font color="#009966">B</font> <br>  5. Our task right there is to edit this sector and bring it into this form: <br>  00000000000000000000000000000000 <br>  00 <font color="#0000FF">888888888888888888</font> 00000000000000 <br>  00000000000000000000000000000000 <br>  <font color="#00FF00">186D8C4B93F9</font> <font color="#FF6600">08778F02</font> <font color="#009966">9F131D8C2057</font> <br>  Where is <font color="#0000FF">888 ...</font> - Your OMS policy number.  Pay special attention when rewriting keys to sectors: if there is a typo there, then you risk losing all or part of the access to the sector. <br>  6. Click on the menu icon in the upper right corner and click Write Dump -&gt; WRITE DUMP, select only sector 5 (remove the rest of the daws);  attach the card to the phone -&gt; see that both daws are next to the key files and press START MAPPING AND WRITE DUMP.  Then, against the background of the dump, we should see the message "Data successfully written" <br>  The card is ready to go to the clinic! </div><p>Source: <a href="https://habr.com/ru/post/461303/">https://habr.com/ru/post/461303/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461291/index.html">Golang: specific performance issues</a></li>
<li><a href="../461297/index.html">What modern targeted attacks look like</a></li>
<li><a href="../461299/index.html">How the PC conquered the media industry with successful software: discussing Pro Tools and Media Composer</a></li>
<li><a href="../4613/index.html">Nine reasons to wait a bit with Firefox upgrade</a></li>
<li><a href="../46130/index.html">Web Directions Survey</a></li>
<li><a href="../461305/index.html">Company Network and MitM. Part 2</a></li>
<li><a href="../461307/index.html">We invite you to VK Hackathon 2019. This year's prize pool is two million rubles.</a></li>
<li><a href="../461309/index.html">Everything except Kotlin: Andrei Breslav on gender balance in IT, emotions and more</a></li>
<li><a href="../46131/index.html">Gay Test v.3</a></li>
<li><a href="../461313/index.html">Zimbra 8.8.15 LTS Released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>