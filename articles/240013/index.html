<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The house that built Klose or Leaf-Spine architecture: changing L2 to L3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For a long time, all the big projects related to the network, be it a web-project or a DC of a large enterprise, were one and the same structure. It w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The house that built Klose or Leaf-Spine architecture: changing L2 to L3</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/files/282/740/31d/28274031d73143b9b07605b1cd7349e7.jpg">  For a long time, all the big projects related to the network, be it a web-project or a DC of a large enterprise, were one and the same structure.  It was a characteristic tree architecture, differing only in the size of the tree and the density of the "branches", due to different requirements for reliability and performance.  But the digital world does not stand still, but is rapidly growing and developing, and not only in increasing volumes and speeds, but also changing its structure.  All sorts of Big Data, clouds and distributed computing have led to the fact that the network has become necessary to transfer huge amounts of data between a large number of end nodes, and, preferably, with minimal latency. <br><br>  All this led to the fact that the traditional tree-like architecture, consisting of access levels, traffic aggregation and the core, began to slip and openly falter.  There is a need to replace it.  For what? <br><a name="habracut"></a><br>  First, let's try to characterize the network structure in the so-called "traditional" Enterprise-projects: <br><ul><li>  from hundreds to several thousand knots; </li><li>  static routing; </li><li>  VLAN structure without server virtualization; </li><li>  vertically oriented (north-south) architecture </li><li>  1G-interconnects with 10G uplinks. </li></ul><br><br>  And here are the same characteristics for modern data center networks that work with such Web 2.0 projects as clouds, Big Data, distributed computing, and similar modern large projects: <br><ul><li>  from thousands to millions of nodes; </li><li>  dynamic routing; </li><li>  cloud structure with virtual servers; </li><li>  mostly horizontal (west-east) architecture; </li><li>  fast (hours, but not weeks) deployment of networks and addition of racks; </li><li>  Mostly 10G connections with 40G uplinks. </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/4b7/fd6/6f6/4b7fd66f61c7418ab0f849ab4fa78fad.png"></div><br>  <i>New World Needs</i> <br><br>  There is a significant difference requiring organizational change. <br>  If we summarize the various requirements for modern network infrastructure, they will be as follows: <br><ul><li>  good performance scalability; </li><li>  resilience to failures at all levels; </li><li>  high interchangeability to reduce costs; </li><li>  predictable latency; </li><li>  high availability of equipment; </li><li>  convenience of service. </li></ul><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/caa/729/07b/caa72907b3954fe6ad0dc5b276191784.png"></div><br>  <i>Traditional network infrastructure</i> <br><br>  What is completely dissatisfied with the traditional scheme? <br><ul><li>  Sharp decrease in performance at failure at the level of aggregation; </li><li>  Insufficient scalability caused by the level of aggregation: <br><ul><li>  MAC / ARP </li><li>  Vlans </li><li>  congestion of exchange points with horizontal traffic; </li></ul></li><li>  a sharp increase in the complexity of the structure with increasing reliability; </li><li>  Many proprietary variants of the protocols used (MLAG, vPC, STP, UDLD, Bridge Assurance, LACP, FHRP, VRRP, HSRP, GLBP, VTP, MVRP ...) </li></ul><br><br>  Decision?  As soon as we start talking about the scale, when the cost of service begins to exceed the cost of equipment (yes, so beloved by accountants and marketers, and unloved by the rest of CAPEX and OPEX), a long-known solution in the form of Clos networks goes on the scene, also known as <b>Leaf-Spine</b> architecture. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/970/adf/b33/970adfb334354af983967eec01e400ac.png"></div><br>  <i>Leaf spine</i> <br><br>  Important note for inattentive: the level of Spine is not at all identical to the level of aggregation.  At this level, there are no horizontal links between switches and they are not supposed to be and all the more it is not assumed that all traffic through this level is collected and goes towards the core or, say, the Internet. <br><br>  By itself, this architecture has been known for half a century and has been successfully used in telephone networks, but now there are all the prerequisites for its active implementation in the data center network.  On the one hand, the equipment became at the same time quite productive and inexpensive, while at the same time ensuring extremely small delays (hundreds of nanoseconds is no longer a fantasy, but quite a reality).  Well, on the other hand, the tasks themselves became such when the centralized architecture becomes suboptimal. <br><br>  What does Leaf-Spine provide in the annex to the structures we are considering? <br><ul><li>  The ability to rely on ECMP (_which since March 2014 is uniquely identified and recognized as the IEEE 802.1Qbp_ standard) in a continuous IP factory; </li><li>  Facilitate the elimination of equipment failures due to its homogeneity; </li><li>  Predictable latency; </li><li>  Featuring scalability; </li><li>  Ease of automation control; </li><li>  Lower network bandwidth loss due to equipment failure; </li><li>  TOR (Top of Rack) instead of EOR (End of Row).  <i>The specifics of TOR and EOR can be found here in this <a href="http://bradhedlund.com/2009/04/05/top-of-rack-vs-end-of-row-data-center-designs/">rather old, but still relevant article</a> )</i> </li></ul><br><br>  Want some bonuses?  You are welcome: <br><ul><li>  The default scheme is protected from the appearance of loops and does not require STP for this; </li><li>  If the port does not respond, the routing protocol considers it dropped and does not consider the possibility of its participation in routes, unlike STP. </li></ul><br><br>  To what extent can such networks be expanded?  A two-tier network on common and low-cost switches with forty-eight 10G ports and six 40G uplinks (Overprovisioning Ratio 1.6 when hosting forty servers per rack) allows you to connect up to 1920 servers.  Entering the third level increases this figure to 180 thousand.  If this is not enough for you, the levels can be increased further. <br><br>  Can and should this architecture be used on networks of much smaller sizes?  Why not, if, of course, your project does not have any specific requirements for L2 routing.  Calculate the cost of the classic solution and Leaf-Spine on BMS switches.  And if the latter turns out to be clearly advantageous for you - this is a weighty reason to think, right?  :) <br>  Of course, besides this, another condition must be fulfilled, which was fundamental when we talked about the need to change the network concept: the traffic in it should be mostly horizontal, the nodes are relatively equal in terms of traffic consumption, there is no explicitly designated direction in which the overwhelming part of the data volume.  This does not mean that such a network should not have external connections, but traffic in their direction should be commensurate with the flow between the nodes, and not be the main component. <br><br>  We, in turn, are ready to offer you everything you need for this. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1bf/273/2d3/1bf2732d3fd8419eb7d6fe5456813b7e.png"></div><br>  <i>Eos 420</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/21a/19f/e2d/21a19fe2d2c54b04af411194e32c1376.png"></div><br>  <i>Eos 520</i> <br><br>  For example, cost-effective switches without <br>  the pre-installed OS (Bare Metal Switch) on the Trident II matrixes, the price of 10G ports for which is less than $ 100: <a href="http://www.etegro.ru/configurator/network/eos420">ETegro Eos 420</a> (48 10G + 6 40G) for the Leaf level and <a href="http://www.etegro.ru/configurator/network/eos520">Eos 520</a> (32 40G) for the Spine level. <br>  Well, if necessary, provide them with the network OS Cumulus Linux, about the capabilities of which we <a href="http://habrahabr.ru/company/etegro/blog/231533/">wrote a little earlier</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b75/23d/cfc/b7523dcfcf6f4f96849e847a625f11e7.png"></div><br>  <i>Bare metal switch</i> <br><br>  Why do we stand for the BMS-version of network equipment?  Yes, simply because, in our opinion, it alone can provide both the flexibility needed by modern projects by choosing the OS with the necessary set of functions and low cost of ownership by refraining from paying for sometimes extremely expensive, but absolutely unnecessary vendor-specific features.  It is unlikely that someone will dispute the convenience of the fact that you can buy a server from one manufacturer, put another‚Äôs OS on it, and supplement it with third-party software.  In our opinion, it is time to bring this ideology of open systems and into the world of network equipment. <br><br>  If there is a desire to "touch" such switches and see what open network operating systems are capable of - write, we have the opportunity to organize testing. </div><p>Source: <a href="https://habr.com/ru/post/240013/">https://habr.com/ru/post/240013/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../239997/index.html">Smart Ring Ring - environmental management with gestures</a></li>
<li><a href="../240001/index.html">Cash self-service. Full review</a></li>
<li><a href="../240003/index.html">Introducing Laravel 5 simple blog with local development on VirtualBox + Vagrant</a></li>
<li><a href="../240007/index.html">Remote surveillance based on Synology EDS14 NAS</a></li>
<li><a href="../240011/index.html">Read Habr in the mail. results</a></li>
<li><a href="../240015/index.html">How to get rid of the step gradient after reinstalling Windows 8.1 on a laptop</a></li>
<li><a href="../240017/index.html">On the London hackathon "Mastercard" won the application for organizing parties with friends</a></li>
<li><a href="../240019/index.html">Git and Microsoft SQL Server</a></li>
<li><a href="../240021/index.html">Visualization algorithms for garbage collection</a></li>
<li><a href="../240025/index.html">Ruby on rails: production and deploy for dummies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>