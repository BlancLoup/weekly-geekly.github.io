<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with game controllers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings, dear readers! 

 In one of the projects I needed to work with game controllers , in particular with a game steering wheel. It was necessary...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with game controllers</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/089be1cb/dac9532a/b730a2ef/59333270.jpg"><br>  Greetings, dear readers! <br><br>  In one of the projects I needed to work with <a href="http://ru.wikipedia.org/wiki/%25D0%2598%25D0%25B3%25D1%2580%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B9_%25D0%25BA%25D0%25BE%25D0%25BD%25D1%2582%25D1%2580%25D0%25BE%25D0%25BB%25D0%25BB%25D0%25B5%25D1%2580">game controllers</a> , in particular with a game steering wheel.  It was necessary to get the state of the steering wheel - the angle of rotation, pressed buttons.  It was not a game that was created, it was an ordinary .net application, I will not go into the details of the project.  It will be about how to get information about the state of game controllers in .net. <br><a name="habracut"></a><br><h4>  Subject area </h4><br>  The task is to obtain data from the game steering.  First of all, it is necessary to study the subject area.  Where are the game wheels used?  Obviously in games.  Many games are developed using DirectX technology.  After reading <a href="http://ru.wikipedia.org/wiki/DirectX">Wikipedia</a> , you can find out that DirectX is divided into many interfaces.  Of interest to us is the interface DirectInput. <br><br><blockquote>  <b>DirectInput</b> is an interface used to process data from the keyboard, mouse, joystick, etc., of game controllers.  (c) <a href="http://ru.wikipedia.org/wiki/DirectX">Wikipedia.org</a> </blockquote><br><h4>  Used game controllers </h4><br>  To implement the project at my disposal was given a game wheel <a href="http://www.defender.ru/products/game/wheel/forsage-gtr/">Defender Forsage GTR</a> . <br>  I also did not miss the opportunity to experiment with my <a href="http://www.logitech.com/ru-ru/gaming/controllers/devices/264">Logitech Rumblepad 2</a> game joystick. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Managed directx </h4><br>  As you probably guessed, <a href="http://en.wikipedia.org/wiki/Managed_DirectX">Managed DirectX</a> is DirectX support from managed code, i.e.  of programs written using .net.  MDX is included in the DirectX SDK, starting with the ninth version. <br>  If you are interested in MDX, you can read Tom Miller‚Äôs DirectX 9 book with managed code.  Programming games and graphics.  The network has a lot of information on the topic. <br><br><h4>  Required Tools </h4><br>  It is logical that first of all it is necessary to install the driver of the manufacturer of the game controller, although, as it turned out, this is not a mandatory item, since  during my experiments with the Logitech joystick, I did not install any drivers for it, and it consistently answered my requests (running Windows 7). <br>  We use DirectX, so we need the DirectX SDK, you can download it <a href="http%253A%252F%252Fdownload.microsoft.com%252Fdownload%252FA%252FE%252F7%252FAE743F1F-632B-4809-87A9-AA1BB3458E31%252FDXSDK_Jun10.exe">here</a> .  Everything you need to work with .net is already there.  As an IDE, I used Visual Studio 2010. <br><br><h4>  Beginning of work </h4><br>  So, DirectX SDK is installed, launch Visual Studio, create a new project and connect Managed DirectX to it.  To do this, go to <b>References</b> -&gt; <b>Add Reference</b> , go to the <b>Browse</b> tab, go to the <b>\ Windows \ Microsoft.NET \ DirectX for Managed Code \ 1.0.2902.0 folder</b> and connect to the <b>Microsoft.DirectX.dll</b> and <b>Microsoft.DirectX.DirectInput.dll</b> project , respectively, do not forget about: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.DirectX; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.DirectX.DirectInput;</code> </pre> <br>  Of course, not without pitfalls.  In my projects, I mostly use .net framework 4.0, while MDX has problems with this version of the framework, and at the build stage of the project Visual Studio 2010 will just hang.  Therefore, we have two ways to solve the problem: <br><br>  1) use an earlier version of the .net framework. <br>  2) to tweak the project configs a bit, which we will do. <br><br>  Add a new <b>app.config</b> file with the following content to the project: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">startup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">useLegacyV2RuntimeActivationPolicy</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">supportedRuntime</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"v4.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sku</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".NETFramework,Version=v4.0,Profile=Client"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">startup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Now everything is ready, you can start working with game controllers. <br><br><h4>  Getting the status of the game wheel </h4><br>  Obviously, the first thing you need to know about all the connected game controllers: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (DeviceInstance instance <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Manager.GetDevices(DeviceClass.GameControl, EnumDevicesFlags.AttachedOnly)) { <span class="hljs-comment"><span class="hljs-comment">//         , , : instance.ProductName }</span></span></code> </pre><br>  Next, you need to initialize the gaming device.  For clarity, I mean that I have one: <br><br><pre> <code class="cs hljs">Device device; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (DeviceInstance instance <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Manager.GetDevices(DeviceClass.GameControl, EnumDevicesFlags.AttachedOnly)) { device = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Device(instance.ProductGuid); <span class="hljs-comment"><span class="hljs-comment">// Background - ,   ,           // NonExclusive -   ,         device.SetCooperativeLevel(null, CooperativeLevelFlags.Background | CooperativeLevelFlags.NonExclusive); //    foreach (DeviceObjectInstance doi in device.Objects) { //      -  if ((doi.ObjectId &amp; (int)DeviceObjectTypeFlags.Axis) != 0) { //        device.Properties.SetRange( ParameterHow.ById, doi.ObjectId, new InputRange(-90, 90)); } } //   device.Acquire(); }</span></span></code> </pre><br>  In the <a href="http://www.defender.ru/products/game/wheel/forsage-gtr/">characteristics of the</a> steering wheel it is said that the angle of rotation of the steering wheel is 180 degrees, therefore in <i>InputRange</i> I indicated the value of the angle of deviation to the left and to the right of 90 degrees. <br><br>  Unfortunately, we will not be able to subscribe to any events from the steering wheel or joystick like <i>KeyDown \ KeyUp</i> , and the state of the game controller will have to be manually polled: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//   DispatcherTimer timer = new DispatcherTimer(); timer.Tick += new EventHandler(timer_Tick); timer.Interval = new TimeSpan(0, 0, 0, 0, 10); timer.Start(); private void timer_Tick(object sender, EventArgs e) { //     JoystickState j = device.CurrentJoystickState; string info = ""; //     byte[] buttons = j.GetButtons(); for (int i = 0; i &lt; buttons.Length; i++) { //         if (buttons[i] != 0) { info += "Button: " + i + " "; } } // jX        textBlock1.Text = j.ToString(); textBlock2.Text = info; }</span></span></code> </pre><br>  For clarity, you can display the structure of <i>JoystickState</i> and see which fields change depending on the state of the game steering.  All this is also true for the joystick. <br><br><h4>  findings </h4><br>  It turns out that it is not so difficult to program the game controller to fit your needs, the majority of all kinds of joysticks / steering wheels, etc.  obey the DirectInput interface, now you can easily add their support to your projects / games.  As for the games, it remains only to implement the functional, giving the user the opportunity to ‚Äúhang‚Äù on the action buttons provided for by the logic of the game. <br><br><h4>  Links </h4><br>  1. <a href="http%253A%252F%252Fdownload.microsoft.com%252Fdownload%252FA%252FE%252F7%252FAE743F1F-632B-4809-87A9-AA1BB3458E31%252FDXSDK_Jun10.exe">DirectX Software Development Kit June 2010 \ 572 Mb</a> <br>  2. <a href="http://www.ozon.ru/context/detail/id/2167854/">Tom Miller - Managed DirectX 9 with Managed Code</a> <br>  3. <a href="http://narod.ru/disk/19952437001/WheelWpf.rar.html">Sources of the demonstration project</a> <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/124851/">https://habr.com/ru/post/124851/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../124842/index.html">Google bought a company specializing in photo recognition technology</a></li>
<li><a href="../124843/index.html">Unusual wind generator Sanya Skypump</a></li>
<li><a href="../124845/index.html">Android: Rotate on all four sides of AndEngine</a></li>
<li><a href="../124847/index.html">More tools to improve the management of the organization!</a></li>
<li><a href="../124849/index.html">Digest Wanted.VC # 7</a></li>
<li><a href="../124853/index.html">Tax-Free Shopping: nice euromeloch</a></li>
<li><a href="../124854/index.html">Productive and readable XSLT: a collection of tips</a></li>
<li><a href="../124856/index.html">Game Theory and the Sprague-Grande Function</a></li>
<li><a href="../124860/index.html">PostSharp. Problem solving logging and auditing</a></li>
<li><a href="../124861/index.html">Working with the mind, not with your hands: an example of increased text editing performance in Emacs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>