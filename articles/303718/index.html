<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Comments on the problem in Bitrix24 with commit for Mercurial</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With each semester, the 1C-Bitrix team presents a new functionality of the cloud corporate portals Bitrix24. One of the popular functions of the porta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Comments on the problem in Bitrix24 with commit for Mercurial</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/217/07b/232/21707b2322c0effaf0eb6c7cef6b6a39.png" alt="image">  With each semester, the 1C-Bitrix team presents a new functionality of the cloud corporate portals Bitrix24.  One of the popular functions of the portal can be called ‚ÄúTasks‚Äù, allowing Bitrix24 to occupy places in the rating of task trackers (for example, <a href="https://habrahabr.ru/post/302914/">Quantity and quality: how do task trackers develop in a competitive environment</a> ).  Therefore, many web studios, especially those associated with the development on 1C-Bitrix and Bitrix24, use the functionality of tasks in development. <br><br>  In each task can be director, and co-performers, and observers, including customers.  In most cases, working with a task lasts more than one day and it may turn out that the task (in the comments to it) does not observe the activity of the developer (developers), and it seems to observers that their task is not taken to work and is simply ‚Äúdynamized.‚Äù  In addition to the above problem, I want to have complete information about what happened to the task from its inception to its completion. <br><br>  In this connection, it became necessary to send information about the development process during commits, in order to capture all changes in task comments without being distracted by writing comments to it ‚Äî just add an informative comment when committing. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The paper uses VCS Mercurial, for which the setting of sending information about the commit in the comments of the portal task is described. <br><a name="habracut"></a><br>  To send comments when you commit Mercurial to the Bitrix24 portal, you need to do the following steps: <br><br><ol><li>  The site where the application will be located requires an SSL certificate. <br><br></li><li>  Install the following packages using composer: <br><ul><li>  mesilov / bitrix24-php-sdk - php wrapper for working with BX24 REST API </li><li>  defuse / php-encryption - required for generating an access key </li></ul><br>  Installation is carried out by the command <br><pre><code class="bash hljs">$ composer require <span class="hljs-string"><span class="hljs-string">"mesilov/bitrix24-php-sdk: ^0.2.0"</span></span> <span class="hljs-string"><span class="hljs-string">"defuse/php-encryption: ^2.0"</span></span></code> </pre> <br></li><li>  Upload application files to site: <br><ul><li>  install.php - application installation file for Bitrix24.  Required for an application to get access tokens when installing an application. <br><div class="spoiler">  <b class="spoiler_title">install.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** *  . * *     24     */</span></span> error_reporting(E_ALL &amp; ~E_NOTICE); <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/vendor/autoload.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/lib.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> === $_REQUEST[<span class="hljs-string"><span class="hljs-string">'DOMAIN'</span></span>] || <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> === $_REQUEST[<span class="hljs-string"><span class="hljs-string">'member_id'</span></span>] || <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> === $_REQUEST[<span class="hljs-string"><span class="hljs-string">'AUTH_ID'</span></span>] || <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> === $_REQUEST[<span class="hljs-string"><span class="hljs-string">'REFRESH_ID'</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">'     24'</span></span>); } $params = AddMessageToBitrix24Task::load(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> === count($params)) { $params = [ <span class="hljs-comment"><span class="hljs-comment">//    (    ) 'B24_APPLICATION_ID' =&gt; '&lt;CLIENT_ID&gt;', //     (    ) 'B24_APPLICATION_SECRET' =&gt; '&lt;CLIENT_SECRET&gt;', //     (    ) 'B24_APPLICATION_SCOPE' =&gt; ['task'], //URL    (    ) 'B24_REDIRECT_URI' =&gt; 'https://&lt;APP_DOMAIN&gt;/app.php', //  'DOMAIN' =&gt; $_REQUEST['DOMAIN'], //   'MEMBER_ID' =&gt; $_REQUEST['member_id'], //  'AUTH_ID' =&gt; $_REQUEST['AUTH_ID'], //  'REFRESH_ID' =&gt; $_REQUEST['REFRESH_ID'], ]; //     AddMessageToBitrix24Task::save($params); } //,     if (AddMessageToBitrix24Task::check()) { //      24   $params = AddMessageToBitrix24Task::load(); $result = ' .&lt;br&gt;'; $result .= '   hook.php  :&lt;br&gt;'; $result .= $params['KEY']; } else { $result = '  c .&lt;br&gt;'; } die($result);</span></span></code> </pre></div></div><br></li><li>  app.php is the main application file, adding comments to the tasks when Mercurial hook is triggered ... <br><div class="spoiler">  <b class="spoiler_title">app.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** *       */</span></span> error_reporting(E_ALL &amp; ~E_NOTICE); <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/vendor/autoload.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/lib.php'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  $params = AddMessageToBitrix24Task::load(); try { //    $key = $params['B24_APPLICATION_ID'] . $params['MEMBER_ID'] . $params['B24_APPLICATION_SECRET']; //       if (AddMessageToBitrix24Task::decrypt($_REQUEST['key']) !== $key) { die('  '); } } catch (Exception $e) { die('   '); } if (!is_numeric($_REQUEST['task'])) { die('   '); } if (null === $_REQUEST['message'] || '' === trim($_REQUEST['message'])) { die('  '); } try { //     Bitrix24 $bx24 = AddMessageToBitrix24Task::getBX24Instance($params); //    $result = AddMessageToBitrix24Task::add($bx24, $_REQUEST['task'], $_REQUEST['message']); die($result); } catch (Exception $e) { die('     '); }</span></span></code> </pre></div></div><br></li><li>  lib.php - a set of functions required for the application <br><div class="spoiler">  <b class="spoiler_title">lib.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** *    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Defuse</span></span>\<span class="hljs-title"><span class="hljs-title">Crypto</span></span>\<span class="hljs-title"><span class="hljs-title">Crypto</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Defuse</span></span>\<span class="hljs-title"><span class="hljs-title">Crypto</span></span>\<span class="hljs-title"><span class="hljs-title">Key</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *       24 * * Class AddMessageToBitrix24Task */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddMessageToBitrix24Task</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string    .       . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $config = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../bx24.auth'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $safeKey; <span class="hljs-comment"><span class="hljs-comment">/** *   * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $var    * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string   * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> \Defuse\Crypto\Exception\BadFormatException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> \Defuse\Crypto\Exception\EnvironmentIsBrokenException */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($var)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Crypto::encrypt($var, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::getKey()); } <span class="hljs-comment"><span class="hljs-comment">/** *   * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $var    * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string   * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> \Defuse\Crypto\Exception\BadFormatException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> \Defuse\Crypto\Exception\EnvironmentIsBrokenException */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($var)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Crypto::decrypt($var, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::getKey()); } <span class="hljs-comment"><span class="hljs-comment">/** *    * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> Key   * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> \Defuse\Crypto\Exception\BadFormatException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> \Defuse\Crypto\Exception\EnvironmentIsBrokenException */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> === <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$safeKey) { $params = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::load(); <span class="hljs-comment"><span class="hljs-comment">//    -  if (null === $params || null === $params['PRIVATE_KEY']) { self::$safeKey = Key::createNewRandomKey()-&gt;saveToAsciiSafeString(); } else { self::$safeKey = $params['PRIVATE_KEY']; } } return Key::loadFromAsciiSafeString(self::$safeKey); } /** *      Bitrix24 * * @param array $params     24 * * @return \Bitrix24\Bitrix24     24 * * @throws \Bitrix24\Bitrix24Exception * @throws \Defuse\Crypto\Exception\BadFormatException * @throws \Defuse\Crypto\Exception\EnvironmentIsBrokenException */ public static function getBX24Instance(array $params) { $bx24 = new \Bitrix24\Bitrix24(false); $bx24-&gt;setApplicationScope($params['B24_APPLICATION_SCOPE']); $bx24-&gt;setApplicationId($params['B24_APPLICATION_ID']); $bx24-&gt;setApplicationSecret($params['B24_APPLICATION_SECRET']); $bx24-&gt;setRedirectUri($params['B24_REDIRECT_URI']); $bx24-&gt;setDomain($params['DOMAIN']); $bx24-&gt;setMemberId($params['MEMBER_ID']); $bx24-&gt;setAccessToken($params['AUTH_ID']); $bx24-&gt;setRefreshToken($params['REFRESH_ID']); //     if ($bx24-&gt;isAccessTokenExpire()) { //    $temp = $bx24-&gt;getNewAccessToken(); //    $params['AUTH_ID'] = $temp['access_token']; $params['REFRESH_ID'] = $temp['refresh_token']; $bx24-&gt;setAccessToken($params['AUTH_ID']); $bx24-&gt;setRefreshToken($params['REFRESH_ID']); //   self::save($params); } return $bx24; } /** *     * * @param \Bitrix24\Bitrix24 $bx24     24 * @param int $task   * @param string $message  * * @return string */ public static function add(\Bitrix24\Bitrix24 $bx24, $task, $message) { $str = ''; try { //       $bx24-&gt;call( 'task.item.getdata', [ 'TASKID' =&gt; $task ] ); $str .= ' #' . $task . '   ' . $bx24-&gt;getDomain() . ' ' . PHP_EOL; //    $bx24-&gt;call( 'task.commentitem.add', [ 'TASKID' =&gt; $task, 'FIELDS' =&gt; [ 'POST_MESSAGE' =&gt; $message ] ] ); $str .= '    '; } catch (Exception $e) { $str .= '     '; } return $str; } /** *      * * @param array $params  * * @return bool * * @throws \Defuse\Crypto\Exception\BadFormatException * @throws \Defuse\Crypto\Exception\EnvironmentIsBrokenException */ public static function save(array $params) { //        $params['KEY'] = AddMessageToBitrix24Task::encrypt($params['B24_APPLICATION_ID'] . $params['MEMBER_ID'] . $params['B24_APPLICATION_SECRET']); //  $params['PRIVATE_KEY'] = self::$safeKey; //     $result = json_encode($params, JSON_UNESCAPED_UNICODE); return file_put_contents(self::$config, $result) &gt; 0; } /** *      * * @return array  */ public static function load() { if (!file_exists(self::$config)) { return []; } //   $params = file_get_contents(self::$config); return json_decode($params, true); } /** * ,       24. * * @return bool */ public static function check() { try { $params = AddMessageToBitrix24Task::load(); $bx24 = self::getBX24Instance($params); $result = $bx24-&gt;call('app.info'); return $result['result']['CODE'] === $params['B24_APPLICATION_ID']; } catch (\Exception $e) { return false; } } }</span></span></code> </pre></div></div></li></ul><br></li><li>  Upload the hghook-commit-to-bx24.php file to the web server where the VCS Mercurial is used to access the application at commit.  File must be placed outside the site root.  The script requires the following functions: <br><ul><li>  shell_exec - execute console commands to generate information about the commit </li><li>  curl_exec - to send data to the application </li></ul><div class="spoiler">  <b class="spoiler_title">hghook-commit-to-bx24.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** *      hg commit */</span></span> <span class="hljs-comment"><span class="hljs-comment">//  24 define('BX24_APP_URL', 'https://&lt;APP_DOMAIN&gt;/app.php'); //    .        define('KEY', '&lt;ACCESS_KEY&gt;'); echo '  Mercurial,        ' . PHP_EOL; if(!function_exists('shell_exec')){ echo ':  ¬´shell_exec¬ª ' . PHP_EOL; echo ' ' . PHP_EOL; exit(0); } if(!function_exists('curl_exec')){ echo ':  ¬´curl_exec¬ª ' . PHP_EOL; echo ' ' . PHP_EOL; exit(0); } //    Mercurial $hg = $_SERVER['HG']; if (!is_file($hg) || !is_executable($hg)) { echo ':     Mercurial' . PHP_EOL; echo ' ' . PHP_EOL; exit(0); } echo '   ' . PHP_EOL; //   ,    Mercurial $hostname = trim(shell_exec('hostname -f')); //     $pwd = $_SERVER['PWD']; //   Mercurial $branch = shell_exec("$hg branch"); //     $log = trim(shell_exec("$hg log -l 1")); //  $matches = null; $user = preg_match('/user:\s+(?&lt;user&gt;\S.*)/ium', $log, $matches) ? $matches['user'] : 'unknown'; //  $summary = preg_match('/summary:\s+(?&lt;summary&gt;\S.*)/ium', $log, $matches) ? $matches['summary'] : ''; //        $files = trim(shell_exec("$hg st -amr")); //    $filesCount = substr_count($files, PHP_EOL); //       Mercurial      echo '       ' . PHP_EOL; $task = 0; if (preg_match('/^task[#\@\$](?&lt;id&gt;\d+)/iu', $branch, $matches)) { $task = (int)$matches['id']; } elseif (preg_match('/^task[#\@\$](?&lt;id&gt;\d+)/iu', $summary, $matches)) { $task = (int)$matches['id']; } //   ,      if ($task &lt;= 0) { echo '   ' . PHP_EOL; echo '       Enter,  : '; $count = fscanf(STDIN, "%d\n", $task); if ($count &lt;= 0) { echo '   .' . PHP_EOL; echo '       ' . PHP_EOL; echo ' ' . PHP_EOL; exit(0); } } echo '     ' . PHP_EOL; $message = &lt;&lt;&lt;EOT      $user  $pwd  $hostname: $summary ======    : $log    ( $filesCount ): $files   . EOT; //   $postData = [ 'message' =&gt; $message, 'task' =&gt; $task, 'key' =&gt; KEY ]; //    $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, BX24_APP_URL); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); curl_setopt($ch, CURLOPT_POST, 1); curl_setopt($ch, CURLOPT_POSTFIELDS, $postData); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0); $result = curl_exec($ch); echo $result . PHP_EOL; echo ' ' . PHP_EOL;</span></span></code> </pre></div></div><br></li><li>  Add to hgrc the path to the downloaded file hghook-commit-to-bx24.php <br><pre> <code class="hljs pgsql">[hooks] <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span> = php -f /home/bitrix/hghook-<span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>-bx24.php</code> </pre><br></li><li>  Select in the left menu of the portal the item ‚ÄúAdd application‚Äù, if it is not visible, then expand the item ‚ÄúApplications‚Äù <br><br></li><li>  On the page, select the type of application ‚ÄúFor personal use‚Äù, since we are not going to spread it to the cloudy Marketplace. <br><div class="spoiler">  <b class="spoiler_title">Select the type of application</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/b88/69c/dc3/b8869cdc3062f350d83fdfc3b7a8346b.jpg" alt="image"><br></div></div><br></li><li>  On the settings page of the new application, specify <br><ul><li>  Application Name </li><li>  The name of the menu item in the desired language </li><li>  Set access rights to "Tasks (task)" </li><li>  Specify the link to the executable file of the application. </li><li>  Specify a link to the application installation file </li></ul><div class="spoiler">  <b class="spoiler_title">Application settings</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/1a0/c33/1ee/1a0c331eedd48bebac4b9334cff3c4de.jpg" alt="image"><br></div></div><br>  After entering all the settings, save the application.  Settings can always be edited and supplemented, if necessary, by selecting the appropriate item on the task list in the "My Applications" section <br><br></li><li>  After saving the application, we get to the page with a list of applications.  For each application, Bitrix24 assigns two unique parameters ‚ÄúApplication code (client_id)‚Äù and ‚ÄúApplication key (client_secret)‚Äù, which must be specified in the file install.php <br><div class="spoiler">  <b class="spoiler_title">Application list</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/be6/4a8/53f/be64a853f21a093ba89e34297a96c944.jpg" alt="image"><br></div></div><br></li><li>  Now you need to go to install the application by clicking on the link to the application in the left menu.  If everything is done correctly, a message of the form will be displayed. <br><pre> <code class="hljs pgsql"> .    hghook-<span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>-bx24.php  : &lt;ACCESS_KEY&gt;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Application installation</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/120/429/7ca/1204297cae60567012137360503738ca.jpg" alt="image"><br></div></div><br>  If nothing was displayed (white area instead of the application), then most likely you have the title <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Header</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> X-Frame-<span class="hljs-keyword"><span class="hljs-keyword">Options</span></span> SAMEORIGIN</code> </pre><br>  It prohibits showing your site in frames.  To fix this, in the application directory it is enough to create (or edit) the .htaccess file by adding the line <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Header</span></span> unset X-Frame-<span class="hljs-keyword"><span class="hljs-keyword">Options</span></span></code> </pre><br>  The resulting access code must be written to the file hghook-commit-to-bx24.php <br><br></li><li>  If everything is correctly configured, then to add information about commit to the task, you will need its number.  The task number in Bitrix24 is displayed near its name. <br><div class="spoiler">  <b class="spoiler_title">The task in the portal</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/b3b/1ef/d85/b3b1efd853cd13e99a0f7f0827dbaa44.jpg" alt="image"><br></div></div><br>  To add information about a commit to a task, you can specify a number in the commit text at the very beginning after ‚Äútask #‚Äù, ‚Äútask @‚Äù or ‚Äútask $‚Äù. <br><pre> <code class="bash hljs">[bitrix@dhcppc5 www]$ hg st M composer.json [bitrix@dhcppc5 www]$ hg ci -u testuser -m <span class="hljs-string"><span class="hljs-string">'task#62   #1 :  -  -'</span></span>   Mercurial,                            <span class="hljs-comment"><span class="hljs-comment">#62   &lt;PORTAL_NAME&gt;.bitrix24.ru         [bitrix@dhcppc5 www]$</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Comment on problem # 1</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/d63/020/99f/d6302099f7716c4719c9de6097df085e.jpg" alt="image"><br></div></div><br>  You can also get the task number from the name of the Mercurial work branch if it has a name starting with ‚Äútask #‚Äù, ‚Äútask @‚Äù, or ‚Äútask $‚Äù. <br><br>  If the task number is not found either in the comment or in the name of the branch, you can enter it manually. <br><pre> <code class="bash hljs">[bitrix@dhcppc5 www]$ hg ci -u testuser -m <span class="hljs-string"><span class="hljs-string">'  #2 :  -  -'</span></span>   Mercurial,                                Enter,  : 62        <span class="hljs-comment"><span class="hljs-comment">#62   &lt;PORTAL_NAME&gt;.bitrix24.ru         [bitrix@dhcppc5 www]$</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Comment on problem # 2</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/073/e50/9b4/073e509b46e274e65a447dba1678afa5.jpg" alt="image"><br></div></div><br>  If the task number entry is omitted, the comment will not be sent. <br><pre> <code class="bash hljs">[bitrix@dhcppc5 www]$ hg ci -u testuser -m <span class="hljs-string"><span class="hljs-string">'  #3 :  -  -'</span></span>   Mercurial,                                Enter,  :               [bitrix@dhcppc5 www]$</code> </pre><br>  If a non-existing task number is indicated, an appropriate error notification will be displayed. <br><pre> <code class="bash hljs">[bitrix@dhcppc5 www]$ hg ci -u testuser -m <span class="hljs-string"><span class="hljs-string">'task$65445642   #3 :  -  -'</span></span>   Mercurial,                                   [bitrix@dhcppc5 www]$</code> </pre> </li></ol><br>  <a href="https://github.com/gebvlad/bitrix24-hg-commit-hook">Code from the article</a> . <br><br>  Used materials: <br><ul><li>  <a href="https://www.selenic.com/mercurial/hgrc.5.html">Mercurial - hgrc</a> </li><li>  <a href="http://dev.1c-bitrix.ru/rest_help/">Bitrix24 REST API</a> </li><li>  <a href="https://github.com/mesilov/bitrix24-php-sdk">bitrix24-php-sdk</a> </li><li>  <a href="https://github.com/defuse/php-encryption">defuse / php-encryption</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/303718/">https://habr.com/ru/post/303718/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303708/index.html">A hundred oldies can be thrown out</a></li>
<li><a href="../303710/index.html">Application on API hh.ru. We recommend vacancies for your resume</a></li>
<li><a href="../303712/index.html">Edsger Dijkstra: in search of the ‚Äúshortest path‚Äù to conscious programming</a></li>
<li><a href="../303714/index.html">Building perfect optics in Zemax</a></li>
<li><a href="../303716/index.html">HL7: Your HL7 CDA document does not comply with the standard</a></li>
<li><a href="../303722/index.html">QtQuick / QML as a game UI</a></li>
<li><a href="../303724/index.html">Full list of tools and utilities for Microsoft SQL Server</a></li>
<li><a href="../303726/index.html">Node.js web scraping and bot protection</a></li>
<li><a href="../303730/index.html">My experience using WebRTC in an iOS application</a></li>
<li><a href="../303732/index.html">Mobius 2016: a new way of mobile development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>