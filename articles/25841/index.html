<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Map / Reduce DIY - Apache CouchDb</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I warn you - my opinion does not pretend to any objectivity at all. But the relational database never inspired me, to put it mildly. 

 No, I fully un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Map / Reduce DIY - Apache CouchDb</h1><div class="post__text post__text-html js-mediator-article"> <a href=""><img height="155" alt="CouchDb logo" src="http://www.ajaxie.com/images/mapreduceApacheCouchdb_EB06/couchdblogo_thumb.png" width="174" align="right" hspace="10" vspace="10"></a>  I warn you - my opinion does not pretend to any objectivity at all.  But the relational database never inspired me, to put it mildly. <br><br>  No, I fully understand when you <strong>really have an</strong> application focused on processing and storing large amounts of data.  Well, ERP-systems, all sorts of storage, statistics there, "last month they sold a hundred thousand pencils, this two hundred." <br><br>  On the other hand, in most cases, when it comes to desktop (or web) applications, where there is no need to roll millions of primitive records, and the application works with relatively high-level, complex objects, the essence of ‚Äúdatabase design and engineering‚Äù is to repeat two action: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  a) split these high-level objects into a bunch of simple fields ‚Äî numbers, strings, and complex dependencies between them, and scatter between dozens of tables.  This is usually not very difficult, but some (or many?) Data types are not so pleasantly and organically arranged in this model - for example, tags in blog entries; <br><br>  b) then persistently collect these fields into objects back, using four-story JOINs, megabytes of wrappers code, curves and not very <a href="http://en.wikipedia.org/wiki/Object-relational_mapping">ORM</a> layers - depending on the developer‚Äôs qualifications, in general, overcome the infamous <a href="http://en.wikipedia.org/wiki/Object-Relational_impedance_mismatch">O / R impedance mismatch</a> in every possible way.  At the same time, handwritten JOINs do not show the wonders of performance and flexibility, and those generated automatically by a smart layer of wrappers are even more so. <br><br> <a href="http://true.programmer.blog.googlepages.com/SageCRMSalesLogix_v7_Database_Schem.html"><img height="240" alt="CRM SalesLogix 7 database schema" src="http://www.ajaxie.com/images/mapreduceApacheCouchdb_EB06/SageCRMSalesLogix_v7_Database_Schema_thumb.gif" width="167" align="left" hspace="10" vspace="10"></a>  In principle, ORM libraries in dynamic languages ‚Äã‚Äã(see <a href="http://www.sqlalchemy.org/">SQLAlchemy</a> ) are quite pleasant to use, however, they do not allow elegantly solving another painful issue - with the upgrade of the scheme. <br><br>  In general, many applications use databases to store complex data structures, and at the same time, really complex queries using internal dependencies to this data are rarely needed in practice or not needed at all (except for mega-JOINs in order to just back pick out your structures from the database).  It seems that the usual RDBMS is not very suitable for them - the problems mentioned above are rather painfully solved, and millions of man-hours are spent by database developers on the realization of other features that are useless for them. <br><br>  One solution is object-oriented storage, they are really becoming quite popular and deserve a separate discussion.  They solve the problem with ORM transparently, but if we talk about web applications (which are very interesting for us in the light of the promised version of <a href="http://defun.ru/">defun.ru</a> :), object-oriented databases are not exactly what the doctor prescribed - they do not solve horizontal problems scalability and distribution of data, and the web is first of all a lot of textual information, it would be nice to somehow take this into account. <br><br>  So, <a href="http://incubator.apache.org/couchdb/">CouchDb</a> is a document- <a href="http://incubator.apache.org/couchdb/">oriented</a> database.  She is able to store <strong>documents</strong> - objects consisting of a heap of fields with an arbitrary structure.  Each document has only two required service fields: the name and version, the names are unique and are in linear space - imagine a giant directory with document files, like this: <br><br><pre>  { 
  "_id": "63086444D554D3094C080F96D5005B03",
  "_rev": "1837603925",
  "author": "lrrr",
  "tags": ["baz", "test", "ru"],
  "url": "http: \ / \ / incubator.apache.org/couchdb",
  "title": "couchdb home",
  "description": "boo boo ba ba",
  "type": "story",
  "comments": 1,
  "votes": 2
 } </pre><br><br>  Versions are needed to organize parallel access to the database - remember how your version control system works - if we want to change the document, we just take it, change it and try to put it back - if its version has not changed, everything is fine, if it has changed - you can simply try to make the same changes again, with a new document, or else somehow make a merge (depending on the application).  This is called optimistic locking, the main plus is that no one locks the document for the duration of the editing, and therefore no need to wait for unlocking.  By the way, such a mechanism can also be applied in some modern RDBMS, only at the row level in the table (see <a href="http://www.google.com/search%3Fq%3D%2522row%2Bversioning%2522">http://www.google.com/search?q=%22row+versioning%22</a> ). <br><br> <a href=""><img height="244" alt="CouchDb Architecture" src="http://www.ajaxie.com/images/mapreduceApacheCouchdb_EB06/image_thumb.png" width="210" align="left" hspace="10" vspace="10"></a> <br>  The interface to CouchDb is HTTP only, <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">REST</a> exclusively, and the response from the server comes in <a href="http://www.json.org/">JSON format</a> .  At first, this is somewhat alarming - not the most efficient protocol, but given the fact that high-level documents are stored in it in its entirety, it is not necessary to make 5-10 queries to the database for each one.  But there are a lot of advantages: firstly, any language can work with HTTP and JSON (and if it doesn‚Äôt know how to teach), secondly, it is easy to debug, thirdly CouchDb understands <a href="http://en.wikipedia.org/wiki/HTTP_ETag">HTTP Etag</a> and If-None-Match, which means effortlessly screwed to the base HTTP cache. <br><br>  But everything should be scaled in breadth perfectly - after all, Amazon SimpleDb and Google BigTable are built around this pattern.  Amazing, by the way, a coincidence, but SimpleDb and CouchDb are written in erlang;) <br><br>  What distinguishes CouchDb from Google and Amazon services is the more ‚Äúadvanced‚Äù functionality in the field of data queries. <br><br>  Naturally, less structured data is more difficult to process, and since we are so concerned about scalability, these requests should also be easily distributed across a cluster of database servers.  To do this, CouchDb uses the map / reduce pattern described in a <a href="http://labs.google.com/papers/mapreduce.html">famous article</a> by Google engineers. <br><div style="text-align:center;"><img height="130" alt="map &amp; amp; reduce" src="http://www.ajaxie.com/images/mapreduceApacheCouchdb_EB06/mapreduce_thumb.png" width="364" hspace="10" vspace="10"></div><br><br><br>  In practice, it looks like this: on the server, view-functions (the actual map () and reduce ()) are stored in special documents, which convert the set of documents as needed, and can be accessed using the same REST interface.  They are able to calculate gradually, with preservation of intermediate results, that is, if one or two documents were added or changed between two calls, the function will be called only for them.  They are written in JavaScript, but you can easily connect python / ruby ‚Äã‚Äã/ something else instead. <br><br>  As an added bonus - support for full-text document search, using any external library (while the authors screwed the <a href="http://lucene.apache.org/">Apache Lucene</a> search engine to CouchDb). <br><br>  * * * <br><br>  In the end, it is usually customary to kick a little at the technology in question, but I‚Äôm still sorry to kick CouchDb - it makes too pleasant impression.  Although, of course, this is still just an alpha version, with all the ensuing consequences (reduce, say, appeared in a trunk three days ago).  Yes, it is very slow - as long as it can handle dozens of insert orders per second (if you do not use bulk update mode) and yes, it eats a lot of disk space - since all intermediate versions of the document are saved unless they are periodically deleted with a special function ‚Äú Compact Database ‚Äù- however, this can be done in parallel without stopping the application.  However, for alpha, the system is very stable and already has, among other things, a very pleasant and functional web interface for administration and development. <br><br>  <em><a href="http://brainslugs.blogspot.com/2008/05/mapreduce-apache-couchdb.html">Original post</a></em> <br><br>  More links: <br><br><ul><li>  <a href="http://incubator.apache.org/couchdb/">Official site of the project</a> </li><li>  <a href="http://damienkatz.net/">Damien Katz - Lead CouchDb Programmer</a> </li><li>  Blogs for Two: <a href="http://www.cmlenz.net/">Christopher Lenz</a> , <a href="http://jan.prima.de/plok/">Jan Lehnardt</a> </li><li>  <a href="http://rashkovskii.com/articles/2008/4/26/top-10-reasons-to-avoid-document-databases-fud">Top 10 Reasons to Avoid Document Databases FUD</a> is a good article, why not be afraid of non-relational databases </li><li>  <a href="http://www.automatthew.com/2007/12/amazon-simpledb-and-couchdb-compared.html">Amazon SimpleDB and CouchDB compared</a> </li><li>  <a href="http://www.ajatus.info/">Ajatus</a> - a distributed CRM system using CouchDb </li></ul><br></div><p>Source: <a href="https://habr.com/ru/post/25841/">https://habr.com/ru/post/25841/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../25840/index.html">The role of sales in the IT-business</a></li>
<li><a href="../258403/index.html">Migrating from symfony 2.0 to 2.6</a></li>
<li><a href="../258405/index.html">Semantic Web Technologies</a></li>
<li><a href="../258407/index.html">Minimal mail server based on Postfix and Dovecot. Part 2: Postfix</a></li>
<li><a href="../258409/index.html">Day of Universal Accessibility Awareness (GAAD) 2015</a></li>
<li><a href="../258411/index.html">GammaRay - a means of introspection Qt-applications</a></li>
<li><a href="../258413/index.html">Luwrain - a working environment for people with visual impairments</a></li>
<li><a href="../258415/index.html">Recalculation of images for different cartographic projections in webGL</a></li>
<li><a href="../258419/index.html">10 networking tips for people who hate it</a></li>
<li><a href="../258423/index.html">PSR-7 adopted</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>