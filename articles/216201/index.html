<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Collect and analyze logs with Lumberjack + Logstash + Elasticsearch + RabbitMQ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 

 Logs are often and absolutely not deservedly deprived of the attention of developers. And when programmers need to parse log files, somet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Collect and analyze logs with Lumberjack + Logstash + Elasticsearch + RabbitMQ</h1><div class="post__text post__text-html js-mediator-article">  Good day. <br><br>  Logs are often and absolutely not deservedly deprived of the attention of developers.  And when programmers need to parse log files, sometimes from several dozens of servers at the same time, this task falls on the system administrators and takes them a lot of time and effort. <br><br>  Therefore, when problems occur and it is necessary to find an error in the logs of some service, it all depends on how strong the admin is and how programmers know what to look for.  And also on whether the logrotate has worked and whether the old data has not slammed ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://logstash.net/">Logstash</a> helps a <a href="http://logstash.net/">lot</a> in such situations.  He is actively developing the last year, has already done a lot of noise, and on the habr, for example, <a href="http://habrahabr.ru/post/166251/">here</a> and <a href="http://habrahabr.ru/post/165059/">here</a> , <a href="http://habrahabr.ru/post/165059/">there</a> are enough articles on how to install it and make it work on one server.  In this article I will touch upon Logstash as a processing server, because, as an agent, it didn‚Äôt suit us in some respects. <br><br>  Why?  Maxifier is a SaaS product with customers in the USA, Brazil, several European countries and Japan, so we have about a hundred servers scattered around the world.  For operational work, we need to have convenient access to the logs of our applications and a quick search for errors in them in case of problems on third-party services / api, the appearance of incorrect data, etc.  By the way, The Guardian (some of our clients) use a <a href="http://www.theguardian.com/info/developer-blog/2014/mar/25/monitoring-alerting-and-starting-from-scratch">similar logging system</a> . <br><br>  After several instances of building Rsync logs from multiple servers, we thought about an alternative, less long and laborious.  And recently we have developed our logging system for various applications.  I will share my own experience and description of how it works. <br><img src="https://habrastorage.org/getpro/habr/post_images/686/ff2/a34/686ff2a34d541d42e7317e84d258262e.jpg" alt="image"><br><a name="habracut"></a><br><br>  Our target applications from which we collect logs: <br>  1. Java daemons (Jetty / Native) <br>  2. Demons on Node.js <br>  3. Dynamic Java applications (for example, cluster nodes) <br><br>  Critical for programmers are errors and exceptions with multi-line spectra flying with such errors. <br>  Therefore, the main requirements were: <br><br>  1. Good support for multi-line messages. <br>  2. Ability to handle different message formats. <br>  3. Easy configuration of data sources. <br><br>  Without going deep into the configuration part, I will tell you about the component parts and why they are present in the scheme. <br>  In general, our log collection scheme looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/940/8c2/4c6/9408c24c6a0f3556cdd01ca1321b1763.jpg" alt="image"><br><br>  The diagram shows that we do not keep logstash, which would monitor application files on application servers.  We considered that it was inefficient to use a daemon, which consumes 128 MB of memory and a significant part of the processor's power during logging, and forcibly limited resources would look like a crutch.  Therefore, we began to look for other, less demanding solutions to the problem of transporting logs. <br><br><h4>  Agents </h4><br>  <b><a href="http://www.rsyslog.com/">Rsyslog</a></b> is a ready-made demon and can see everything, but it‚Äôs always in the details. <br><br>  <i>Benefits:</i> <br>  1. Fast. <br>  2. Able to track files. <br>  3. Able to <s>dig and not dig</s> encrypt and encrypt. <br>  4. Already have in the system. <br><br>  <i>Disadvantages:</i> <br>  1. Does not know how to send multiline messages (All attempts on the server to receive a multiline message were completely in vain). <br>  2. Cannot track files by mask. <br>  3. Badly handles file truncation. <br><br>  As already mentioned, the support for multi-line messages was important for us, so we continued searching, but temporarily hooked up the Rsyslog log collection, in order to organize a search for them later. <br><br>  <b><a href="https://github.com/elasticsearch/logstash-forwarder">Lumberjack</a></b> (now known as logstash-forwarder) is an <b>experimental</b> daemon for sending logs. <br><br>  <i>Benefits:</i> <br>  1. Fast. <br>  2. Minimalist (Unix-way). <br>  3. Able to use masks. <br>  4. Consumes a minimum of resources (written in Go). <br><br>  <i>Disadvantages:</i> <br>  1. Experimental. <br>  2. Independently does not support multiline messages. <br><br>  <b>Logstash</b> (agent only) <br><br>  <i>Benefits:</i> <br>  1. The same software for collecting logs everywhere. <br>  2. Enough productive. <br>  3. Able all that we need. <br><br>  <i>Disadvantages:</i> <br>  1. Java on all servers. <br>  2. High memory requirements can potentially affect the operation of other services. <br>  3. Difficult to configure. <br><br><h4>  Agent selection </h4><br>  We decided to test Lumberjack, and if the result is not satisfactory, roll back to the option with Logstash on each server. <br>  Since Logstash and Lumberjack were developed by <a href="https://github.com/elasticsearch/logstash-forwarder/graphs/contributors">the same people</a> , we also received nice buns: for example, additional fields - with them we were able to recognize the type of log application without parsing file names. <br><br>  We tested this demon, and the only bug found in it is that when the place ends, it cannot write the state file and sends repeated messages from the previous place, or it may not notice that the file has been cleaned.  We usually do not allow this, and everything comes back to normal when a place appears. <br><br>  In general, we liked Lumberjack as an agent.  The configuration is extremely simple, it can search by masks and perfectly tracks a large number of files.  Moreover, there is a good module for Puppet, with which we set up our servers without any problems.  In parallel with the choice of agent, we tested logstash - then it was still in version 1.1.12. <br><br><h6>  Logstash </h6><br>  First of all, we tried to process multiline messages with it, first from rsyslog, then from lumberjack. <br>  At first we tried the big regular expressions that Google gives out on GitHub Gist, but ultimately we came to the conclusion that the best option - everything that does not fall under our timestamp, should be considered part of the previous message.  Moreover, Lumberjack did not modify the messages from the service. <br><br>  As a result, there is such a simple pattern: <br><br><pre><code class="java hljs">filter { multiline { pattern =&gt; <span class="hljs-string"><span class="hljs-string">"(^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})"</span></span> negate =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> what =&gt; <span class="hljs-string"><span class="hljs-string">"previous"</span></span> } }</code> </pre> <br>  We set up one Logstash instance to process incoming logs, gave it several threads, and started connecting servers.  Everything seemed to be fine, but they began to notice that from time to time the server dropped connections, ran into memory, and occasionally fell.  Even at 16 Gb in Xmx did not give the desired effect. <br><br>  We decided to distribute the load on two types of instances, and in general did not lose. <br><br>  The first type of instances (1) only listens for tcp connections and saves raw files (it is convenient to debug filters on them), sticks together multi-line messages and sends them to the bus.  It copes well with its task, resulting in the loading of 100% of two cores at peak times (our peak is 2500-3000 messages per second). <br><br>  The second type of instances (2) takes messages from the bus, splits them into fields, puts them in elasticsearch and, just in case, into files.  And, as it turned out, it was the second type instances that were the most problematic - then there would be no more memory, or elasticsearch would quiver.  But thanks to the bus, the data was not lost, and in the instances of the first type (1), the logs continued to be collected. <br><br>  Unloading an instance of the first type led to the fact that the monitoring server as a whole consumes a minimum of resources and at the same time is able to withstand a sufficiently large number of messages per unit of time during the peaks.  Filtering instances (of the second type) can be limited in resources and you can not really care about their performance. <br><br>  This bundle worked for us for about a month until we met a very strange behavior.  Lumberjack agents on the servers began to feverishly reconnect to Logstash and immediately fell off with the message that they could not reach the listening Logstash and even i / o timeout, while listening to Logstash at a cursory glance at him seemed alive and even sent messages to the bus . <br>  Zabbix reported that PermGen was being pumped to the process, we increased the memory and restarted, in just 10 minutes the situation repeated. <br><br>  We started to figure out which server generates messages that lead to a stupor for Logstash.  After a brief search (by the way, it is easy to search for the one who sent the most messages - Lumberjack reports this in the Syslog), a server with a size of ~ 20 Gb was detected on one of the servers, and it included several lines of 2-3Gb in size.  It is not hard to guess what was happening: Logstash slowly formed this line in its memory until it rested on it and then tried to do something about it.  For such cases, we added a separator to filter such messages and asked the developers not to do that again. <br><br>  There were problems with too detailed logs, for example, <a href="https://github.com/trentm/node-bunyan">Noyan.js logyan bunyan</a> , at the output he had up to 30-40 (!) Fields, naturally in the interface it looked awful.  Here we judged simply: <br>  1) removed unnecessary fields; <br>  2) altered the priority of messages in a human-readable form. <br><br><h6>  Elasticsearch </h6><br>  Did not cause major problems for the period of use.  The 3-gig instance of Elasticsearch normally processes indexes and 5-6 GB of archived data per day.  The only thing that sometimes happens is OutOfMemory, when trying to stuff a big message or ask a too complex request.  But nobody canceled the JMX monitoring, and Zabbix normally notifies that the GC somehow works for a long time and it would be nice to look at the application. <br><br><h4>  Interface </h4><br>  The Kibana web interface in its original form turned out to be, to put it mildly, difficult even for programmers, and even more so for people far from IT (our analysts also sometimes look into the logs).  We took the original dashboard as a basis, set it up to fit our needs and replaced it with the default dashboard in Kibana.  Now it looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9f0/b47/385/9f0b4738514970f28c6a9682cbfe732c.jpg" alt="image"><br><br>  In particularly difficult cases, you have to additionally adjust filters and multi-search, but this rarely happens and does not cause major problems. <br><br><h4>  Short summary </h4><br>  1.Lumberjack - great for the role of a logging agent. <br>  2. Logstash - normally parses the stacktrace and absolute different logs and there are no problems with flexibility, but you need to adapt to your requirements. <br>  3. Kibana - again, you need to adapt to the consumer.  Sometimes even the simple renaming of fields simplifies the work. <br><br>  Of course, there are cases that this scheme does not cover, for example, when you just need to see the specific launch of the application and what happened - the web interface is probably not a helper here, although this is, of course, the taste and color. <br><br><h4>  Result </h4><br>  The described system of assembling logs made it possible to remove part of the load from admins and significantly reduced the waste of their time and nerves.  Yes, and programmers are so much more convenient - now that an error occurs, we simply give developers a link to the logs in the web interface instead of an uncomfortable heap of log files.  Now the system processes more than 1 million messages per day from more than 300 application instances, without creating a significant load.  This is not the limit of our needs, most likely, the figure will increase at least twice, and there is confidence that the system will be able to accept such a load. <br><br><h4>  Update </h4><br><div class="spoiler">  <b class="spoiler_title">Logstash listener</b> <div class="spoiler_text"><pre> <code class="java hljs">input { lumberjack { charset =&gt; <span class="hljs-string"><span class="hljs-string">"CP1252"</span></span> port =&gt; <span class="hljs-number"><span class="hljs-number">9999</span></span> ssl_certificate =&gt; <span class="hljs-string"><span class="hljs-string">"/etc/ssl/changeme.crt"</span></span> ssl_key =&gt; <span class="hljs-string"><span class="hljs-string">"/etc/ssl/changeme.key"</span></span> } } filter { multiline { pattern =&gt; <span class="hljs-string"><span class="hljs-string">"(^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})|(^\d+\))|(^{\")"</span></span> negate =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> what =&gt; <span class="hljs-string"><span class="hljs-string">"previous"</span></span> } } output { file { path =&gt; <span class="hljs-string"><span class="hljs-string">"/logs/raw/%{host}/%{+YYYY-MM-dd}.log"</span></span> } rabbitmq { durable =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> exchange =&gt; <span class="hljs-string"><span class="hljs-string">"logstash-exchange"</span></span> exchange_type =&gt; <span class="hljs-string"><span class="hljs-string">"direct"</span></span> host =&gt; <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span> key =&gt; <span class="hljs-string"><span class="hljs-string">"logstash-routing-key"</span></span> password =&gt; <span class="hljs-string"><span class="hljs-string">"changeme"</span></span> persistent =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> user =&gt; <span class="hljs-string"><span class="hljs-string">"logstash"</span></span> vhost =&gt; <span class="hljs-string"><span class="hljs-string">"logstash"</span></span> } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Logstash filter</b> <div class="spoiler_text"><pre> <code class="java hljs">input { rabbitmq { auto_delete =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> charset =&gt; <span class="hljs-string"><span class="hljs-string">"CP1252"</span></span> durable =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> exchange =&gt; <span class="hljs-string"><span class="hljs-string">"logstash-exchange"</span></span> exclusive =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> host =&gt; <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span> key =&gt; <span class="hljs-string"><span class="hljs-string">"logstash-routing-key"</span></span> password =&gt; <span class="hljs-string"><span class="hljs-string">"changeme"</span></span> prefetch_count =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> queue =&gt; <span class="hljs-string"><span class="hljs-string">"logstash-indexer"</span></span> type =&gt; <span class="hljs-string"><span class="hljs-string">"logstash-indexer-input"</span></span> user =&gt; <span class="hljs-string"><span class="hljs-string">"logstash"</span></span> vhost =&gt; <span class="hljs-string"><span class="hljs-string">"logstash"</span></span> } } filter { #ugly hack date { match =&gt; [<span class="hljs-string"><span class="hljs-string">"@timestamp"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO8601"</span></span>] } mutate { gsub =&gt; [<span class="hljs-string"><span class="hljs-string">'host'</span></span>, <span class="hljs-string"><span class="hljs-string">'.example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>] } #just in <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> types of applications <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [type] == <span class="hljs-string"><span class="hljs-string">"custom"</span></span> { grok { match =&gt; [<span class="hljs-string"><span class="hljs-string">"message"</span></span>, <span class="hljs-string"><span class="hljs-string">"(?m)(?&lt;date&gt;\d{4}-\d{2}-\d{2}) (?&lt;time&gt;\d{2}:\d{2}(?::\d{2}(?:\.\d+)?)?) \[%{LOGLEVEL:level}\s?\] - (?&lt;mxf_raw_message&gt;.*)"</span></span>] } grok { match =&gt; [<span class="hljs-string"><span class="hljs-string">"message"</span></span>, <span class="hljs-string"><span class="hljs-string">"(?m)(?&lt;mxf_datetime&gt;\d{4}-\d{2}-\d{2} \d{2}:\d{2}(?::\d{2}(?:\.\d+)?)?) "</span></span>] } mutate { replace =&gt; [<span class="hljs-string"><span class="hljs-string">"mxf_datetime"</span></span>, <span class="hljs-string"><span class="hljs-string">"%{date}T%{time}Z"</span></span> ] } date { match =&gt; [<span class="hljs-string"><span class="hljs-string">"mxf_datetime"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO8601"</span></span>] target =&gt; <span class="hljs-string"><span class="hljs-string">"mxf_timestamp"</span></span> } mutate { remove_field =&gt; [<span class="hljs-string"><span class="hljs-string">"mxf_datetime"</span></span>] } grep { match =&gt; [ <span class="hljs-string"><span class="hljs-string">"message"</span></span>, <span class="hljs-string"><span class="hljs-string">"\|"</span></span> ] add_tag =&gt; <span class="hljs-string"><span class="hljs-string">"have_id"</span></span> drop =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">"have_id"</span></span> in [tags] { grok { match =&gt; [<span class="hljs-string"><span class="hljs-string">"message"</span></span>, <span class="hljs-string"><span class="hljs-string">"\[@%{HOSTNAME:mxf_host} %{GREEDYDATA:mxf_thread} (?&lt;mxf_class&gt;[az]{1}[.]{1}[az]{1}[.]{1}[a-zA-Z]{1}.*):%{NUMBER:mxf_classline}\|(?&lt;mxf_id&gt;.*):%{NUMBER:mxf_linenum}\]$"</span></span>] } #ugly hack <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> correct mapping mutate { convert =&gt; [ <span class="hljs-string"><span class="hljs-string">"mxf_linenum"</span></span>, <span class="hljs-string"><span class="hljs-string">"integer"</span></span> ] } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { grok { match =&gt; [<span class="hljs-string"><span class="hljs-string">"message"</span></span>, <span class="hljs-string"><span class="hljs-string">"\[@%{HOSTNAME:mxf_host} %{GREEDYDATA:mxf_thread} (?&lt;mxf_class&gt;[az]{1}[.]{1}[az]{1}[.]{1}[a-zA-Z]{1}.*):%{NUMBER:mxf_classline}\]$"</span></span>] } } grok { match =&gt; [<span class="hljs-string"><span class="hljs-string">"message"</span></span>, <span class="hljs-string"><span class="hljs-string">"(?m).*\] - (?&lt;mxf_message&gt;.*)\[@.*"</span></span>] } grok { match =&gt; [<span class="hljs-string"><span class="hljs-string">"file"</span></span>, <span class="hljs-string"><span class="hljs-string">"\/opt\/apps\/%{GREEDYDATA:mxf_version}\/logs\/%{GREEDYDATA:mxf_account}\/%{WORD:mxf_logfilename}.log$"</span></span>] } mutate { gsub =&gt; [<span class="hljs-string"><span class="hljs-string">"mxf_aiid"</span></span>,<span class="hljs-string"><span class="hljs-string">"\|"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>] } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [type] == <span class="hljs-string"><span class="hljs-string">"nodejs"</span></span> { json { source =&gt; <span class="hljs-string"><span class="hljs-string">"message"</span></span> } mutate { rename =&gt; [<span class="hljs-string"><span class="hljs-string">"msg"</span></span>,<span class="hljs-string"><span class="hljs-string">"mxf_message"</span></span>] } mutate { rename =&gt; [<span class="hljs-string"><span class="hljs-string">"args.0.code"</span></span>,<span class="hljs-string"><span class="hljs-string">"mxf_response_code"</span></span>] } mutate { rename =&gt; [<span class="hljs-string"><span class="hljs-string">"data.service"</span></span>,<span class="hljs-string"><span class="hljs-string">"mxf_service"</span></span>] } mutate { rename =&gt; [<span class="hljs-string"><span class="hljs-string">"data.method"</span></span>,<span class="hljs-string"><span class="hljs-string">"mxf_method"</span></span>] } mutate { rename =&gt; [<span class="hljs-string"><span class="hljs-string">"t"</span></span>,<span class="hljs-string"><span class="hljs-string">"mxf_request_time"</span></span>] } mutate { rename =&gt; [<span class="hljs-string"><span class="hljs-string">"pid"</span></span>,<span class="hljs-string"><span class="hljs-string">"mxf_pid"</span></span>] } mutate { rename =&gt; [<span class="hljs-string"><span class="hljs-string">"err.name"</span></span>,<span class="hljs-string"><span class="hljs-string">"mxf_errname"</span></span>] } mutate { rename =&gt; [<span class="hljs-string"><span class="hljs-string">"err.stack"</span></span>,<span class="hljs-string"><span class="hljs-string">"mxf_stacktrace"</span></span>]} mutate { rename =&gt; [<span class="hljs-string"><span class="hljs-string">"err.message"</span></span>, <span class="hljs-string"><span class="hljs-string">"mxf_errmsg"</span></span>] } mutate { remove_field =&gt; [<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-string"><span class="hljs-string">"args"</span></span>, <span class="hljs-string"><span class="hljs-string">"http"</span></span>, <span class="hljs-string"><span class="hljs-string">"hostname"</span></span>, <span class="hljs-string"><span class="hljs-string">"msg"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>, <span class="hljs-string"><span class="hljs-string">"data"</span></span>, <span class="hljs-string"><span class="hljs-string">"err"</span></span>,<span class="hljs-string"><span class="hljs-string">"t"</span></span>, <span class="hljs-string"><span class="hljs-string">"pid"</span></span>,<span class="hljs-string"><span class="hljs-string">"io"</span></span>] } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [level] == <span class="hljs-number"><span class="hljs-number">60</span></span> { mutate { replace =&gt; [<span class="hljs-string"><span class="hljs-string">"level"</span></span>,<span class="hljs-string"><span class="hljs-string">"FATAL"</span></span>] } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [level] == <span class="hljs-number"><span class="hljs-number">50</span></span> { mutate { replace =&gt; [<span class="hljs-string"><span class="hljs-string">"level"</span></span>,<span class="hljs-string"><span class="hljs-string">"ERROR"</span></span>] } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [level] == <span class="hljs-number"><span class="hljs-number">40</span></span> { mutate { replace =&gt; [<span class="hljs-string"><span class="hljs-string">"level"</span></span>,<span class="hljs-string"><span class="hljs-string">"WARN"</span></span>] } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [level] == <span class="hljs-number"><span class="hljs-number">30</span></span> { mutate { replace =&gt; [<span class="hljs-string"><span class="hljs-string">"level"</span></span>,<span class="hljs-string"><span class="hljs-string">"INFO"</span></span>] } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [level] == <span class="hljs-number"><span class="hljs-number">20</span></span> { mutate { replace =&gt; [<span class="hljs-string"><span class="hljs-string">"level"</span></span>,<span class="hljs-string"><span class="hljs-string">"DEBUG"</span></span>] } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [level] == <span class="hljs-number"><span class="hljs-number">10</span></span> { mutate { replace =&gt; [<span class="hljs-string"><span class="hljs-string">"level"</span></span>,<span class="hljs-string"><span class="hljs-string">"TRACE"</span></span>] } } } } output { elasticsearch_http { host =&gt; <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span> } }</code> </pre><br></div></div><br>  <a href="https://gist.github.com/romeg/9968338">Kibana config</a> </div><p>Source: <a href="https://habr.com/ru/post/216201/">https://habr.com/ru/post/216201/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../216189/index.html">Undefined behavior in C ++</a></li>
<li><a href="../216191/index.html">Develop.re - social link aggregator for programmers</a></li>
<li><a href="../216193/index.html">Asterisk + Cisco SPA5XX, SPA3XX - DND with server notification</a></li>
<li><a href="../216197/index.html">Learning NAS Synology to route traffic to an OpenVPN tunnel with certificate authentication</a></li>
<li><a href="../216199/index.html">Logitech G700. One year later</a></li>
<li><a href="../216203/index.html">Notes for sales managers in a web-studio or ‚ÄúSay a word about a poor marketer‚Äù</a></li>
<li><a href="../216205/index.html">Raspbian and QEMU</a></li>
<li><a href="../216207/index.html">Implementing Koh-Zhao steganographic method on Ruby</a></li>
<li><a href="../216209/index.html">Law ‚Ññ139-–§–ó: view from a small provider</a></li>
<li><a href="../216213/index.html">How a designer find a job in IT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>