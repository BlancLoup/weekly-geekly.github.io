<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Uneven hours</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The idea of ‚Äã‚Äãthis watch is that the arrows on them move unevenly, then accelerating, then lagging behind, but nevertheless, on average, the clock sho...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Uneven hours</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/bf9dd90f/03f6244a/8fd92f8c/f37d2eed.gif" align="left"><br>  The idea of ‚Äã‚Äãthis watch is that the arrows on them move unevenly, then accelerating, then lagging behind, but nevertheless, on average, the clock shows the correct time.  Now I will tell how to make such. <br><a name="habracut"></a><br><h1>  Autopsy </h1><br>  The basis is taken wall quartz analog clock.  They can be decorated as you like, but in 99% of cases there is a standard Chinese mechanism with plastic parts inside.  Here is this: <br><img src="https://habrastorage.org/storage1/0df96aea/14554102/c5bbbe58/1213e6a6.jpg"><br><br>  We open the case, simultaneously noting the availability of free space, which is very good for us. <br><img src="https://habrastorage.org/storage1/8c418b73/9f959e4d/2c85947b/2cb75e31.jpg"><br><br>  Carefully disassemble the mechanism, trying not to forget which gear where to put. <br><img src="https://habrastorage.org/storage1/466ceb43/53ff84f3/3cbfc37c/099a3e6b.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The clock is driven by a stepper motor, which consists of a stator with a winding and a rotor with a permanent magnet.  Once a second, electric pulses are applied to the winding, and with each pulse the rotor rotates 180 ¬∞.  Here is the engine in disassembled form: <br><img src="https://habrastorage.org/storage1/9e9b049d/8d6f3747/6bfd56ed/de81e27b.jpg"><br><br>  The clock of the generator is fixed on the reverse side of the winding.  Here's what she looks like: <br><img src="https://habrastorage.org/storage1/d8fd6e1d/701dd57d/9f0d6fc0/b2ef1cc2.jpg"><br><br><h1>  Brain transplant </h1><br>  The clockwork will be controlled by the <b>ATtiny13A</b> microcontroller, chosen mainly on the principle of ‚Äúset what is‚Äù.  An alternating polarity pulse with a duration of approximately 100 ms must be applied to the motor.  Each pulse moves the second hand by one mark. <br>  As you can see, everything is very simple: we connect the controller with two leads to the winding, supply power ... Stop!  But after all, the clock is powered by one half-volt battery, and the minimum operating voltage for ATtiny13A is 1.8 volts.  How to be?  In fact, AVR controllers can operate at a supply voltage of 1 volt and even lower ( <a href="http://scanlime.org/2008/09/using-an-avr-as-an-rfid-tag/">for example</a> ), but under two conditions.  First, the clock frequency should be low, in the region of tens of kilohertz.  Secondly, clocking should be done from an external source. <br>  Where to get external clock signal?  The solution is obvious: from a regular clock generator.  It generates a signal with a frequency of <b>32 768 Hz</b> (2 <sup>15</sup> Hz), which can be removed from one of the findings of quartz (from which - determined experimentally).  We take our board and solder wires to it to remove power, a clock signal, and also to control the engine.  It is also necessary to cut the tracks from the native generator to the winding terminals. <br><img src="https://habrastorage.org/storage1/1de66236/dca72e90/f31577ee/b0c5dcdc.jpg"><br><br>  Wiring the microcontroller is as simple as two kopecks: <br><img src="https://habrastorage.org/storage1/23ffe31d/78d743ef/b88477ed/59285afd.gif"><br><br>  Just ask to pay attention to two points.  First, at extra low supply voltage, the output keys of the ports do not open completely, therefore, to reduce the resistance, the terminals are paralleled in pairs ( <b>PB0</b> with <b>PB1</b> , and <b>PB2</b> with <b>PB4</b> ).  Secondly, a tantalum capacitor should be placed in the power circuit, with a minimum leakage current. <br>  The controller is mounted on the trimming of the breadboard and is perfectly located in the free space in the corner of the case: <br><img src="https://habrastorage.org/storage1/90a2161f/52a3dab2/28cfd6e8/b8acc6cb.jpg"><br><br>  Since it is not possible to reflash the MC directly in the circuit, I strongly advise you not to solder it intentionally, but install it in the socket. <br><br><h1>  Firmware </h1><br>  The logic of the clock is as follows: the intervals between the steps of the second hand have a random duration, but it must take a full turn in exactly one minute to avoid the accuracy of the stroke.  Experimentally, it was found that the minimum interval between pulses is 1/4 of a second, an attempt to move the arrow faster leads to skipping steps.  From this we will make a start, let the duration of each interval be a multiple of this minimum value.  It will be convenient to divide a minute into 240 "ticks" of a quarter of a second each. <br>  The main problem that arose while writing the firmware was how to randomly split a minute into 60 intervals.  After spending a couple of hours and writing several sheets of paper, I made two algorithms.  The first was to form an array of 240 elements in which the numbers of all the ‚Äúticks‚Äù were placed.  Then, 59 elements were randomly selected from the array, each of which was the number of a ‚Äútick‚Äù on which the arrow would move.  The second algorithm consisted in dividing the four-second interval (16 "ticks") randomly into two parts, each of which was then also divided in two.  After performing these operations on 15 intervals, it turned out 60 values ‚Äã‚Äãin the range from 1 to 13 "ticks", and the sum of all these values ‚Äã‚Äãwas exactly 240. <br>  Unfortunately, neither the first nor the second algorithms I managed to implement on ATtiny13 due to the extremely small amount of memory of this MK (1 KB of FLASH and only 64 bytes of SRAM).  Probably, some assembler guru could do it, but I acted easier and rigidly scored one interval duration table in the code.  The fact that the rhythm of movement of the arrow will be repeated every minute should not immediately be evident. <br>  The program is organized as follows.  Each ‚Äútick‚Äù (1/4 second) timer generates an interrupt, during which the ‚Äútick‚Äù number is checked, and, if necessary, a voltage is applied to the motor winding, and the duration of the next interval is extracted from the table.  After 100 ms, a second interrupt is generated, through which the voltage applied to the winding is turned off.  The rest of the time, the controller is in sleep mode to reduce power consumption.  The link to the full source code is given at the end of the article. <br>  It is also necessary to flash the Fuse bits of the controller in order to enable the external clocking mode (values ‚Äã‚Äãother than the factory ones are highlighted): <br><br><h5>  SELFPRGEN = 1 <br>  DWEN = 1 <br>  BODLEVEL1 = 1 <br>  BODLEVEL0 = 1 <br>  RSTDISBL = 1 <br>  SPIEN = 0 <br>  EESAVE = 1 <br>  WDTON = 1 <br>  <b>CKDIV8 = 1</b> <br>  SUT1 = 1 <br>  SUT0 = 0 <br>  <b>CKSEL1 = 0</b> <br>  CKSEL0 = 0 <br></h5><br>  I hasten to note that after installing fusions in this way, the controller cannot be reflashed without an external clock source. <br><br><h1>  Assembly </h1><br>  So, the controller is programmed, installed on the board, which, in turn, is fixed in the case with a drop of glue.  You can assemble the mechanism back, fix the arrows and enjoy the result: <br><iframe width="560" height="315" src="https://www.youtube.com/embed/HKU-zmNFSxw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Yes, my watch also goes in the opposite direction, which additionally dements the casual observer. <br><br><h2>  Links </h2><br><ol><li>  Firmware source code: <a href="http://pastebin.com/P3y6wBUh">http://pastebin.com/P3y6wBUh</a> </li><li>  Similar project: <a href="http://www.waitingforfriday.com/index.php/Vetinari%27s_Clock">Vetinari's Clock</a> </li><li>  AVR operation at extra low voltage: <a href="http://scanlime.org/2008/09/using-an-avr-as-an-rfid-tag/">Using an AVR as an RFID tag</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/130594/">https://habr.com/ru/post/130594/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130588/index.html">"Weakly load 40 cores?" Or a simple parallel programming contest Acceler8 2011</a></li>
<li><a href="../130589/index.html">Why I do not believe in Dart</a></li>
<li><a href="../130590/index.html">Underline in username</a></li>
<li><a href="../130592/index.html">Only one cloud icon in the whole Universe</a></li>
<li><a href="../130593/index.html">QIWI Wallet in Q3 2011: numbers and events</a></li>
<li><a href="../130595/index.html">Cloud file storage support in 1C-Bitrix: Site Management 11</a></li>
<li><a href="../130596/index.html">Exchange of experience and informal communication on .NET development - all this is Ciklum .NET Subbotnik (22.10)</a></li>
<li><a href="../130597/index.html">Exception! = Error</a></li>
<li><a href="../130598/index.html">HP Innovative Worlds Forum</a></li>
<li><a href="../130600/index.html">Social network buttons on sites in the zone. RF</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>