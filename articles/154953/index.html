<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automate the business process on SharePoint with improvised tools</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Hello! 
 I want to share the experience of automating a single business process on the Sharepoint 2010 platform. 
 I think this article...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automate the business process on SharePoint with improvised tools</h1><div class="post__text post__text-html js-mediator-article"><h5>  Introduction </h5><br>  Hello! <br>  I want to share the experience of automating a single business process on the Sharepoint 2010 platform. <br>  I think this article will be interesting first of all to those users who for some reason do not want to write code in Visual Studio.  It‚Äôs about how you can get around the limitations of regular SharePoint functionality using various available solutions. <br><a name="habracut"></a><br>  Experience with the automation of various processes in the company allowed me to identify a fairly popular business process, maybe it even has some name, unless of course there is a similar classification.  This is a basic process that can have various derivatives that differ in details, for example: <br><br><ul><li>  The system of coordination of marketing actions - the region offers the implementation of the action and then it goes through a sequence of approvals and additions - right up to the center.  Each step is combined with instructions for specific users.  Ultimately, the share may be sent for sale or rejected. </li><li>  The system of collecting ideas from employees - the employee offers an idea and then can observe how it goes through the sequence of improvements and approvals - right up to the moment it is accepted for work, or returned for revision </li><li>  ... and many, many similar ones: working with problems, bugs and incidents, working with claims, working with assets - in a word, any task that requires consistent consideration by several users to make a decision. </li></ul><br>  The mechanism of all such systems is approximately the same: in general, a list is needed to store the main entities: action, idea, order, problem, etc.  Next - you need a list of tasks for the formation of instructions.  In addition, you probably need a number of reference lists, such as statuses, roles, regions, branches, etc. <br>  The platform has everything you need for this: the ability to quickly build lists for basic data, assignable tasks and directories, users already synchronized with AD, a ready access distribution mechanism and much more.  However, in order to fully automate the process and do without a coordinator, whose task is to assign tasks, tasks, process answers and transfer our essence from status to status ‚Äî for this, at least, you need to use workflows ‚Äî workflow.  Let's start with them. <br><br><h5>  Formulation of the problem </h5><br>  We will consider a special case of a business process - let's call it ‚ÄúOrders for regulatory procedures‚Äù <br>  In short: there is a list of ready-made generally accepted regulatory procedures - Regulations.  Nobody has direct access to the direct creation, modification or deletion of the elements of this list of procedures, but any user can suggest creating, changing or deleting a procedure. <br>  In order for this to happen, he creates a so-called Order.  An order passes a certain sequence of status steps, each of which assigns assignments to certain roles.  The order with which the order will be transferred depends on which decision the order is closed with.  In addition, the sequence of steps is individual for orders to create, modify and delete, and also depends on an additional feature express, which allows you to pass the Order in a simplified manner.  Thus, at each step, where the order goes will depend on three conditions: on its type, on the presence of the express feature and on the user's decision. <br>  When the Order passes the chain of approvals and additions, the corresponding Regulations will automatically be created / changed / deleted. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  General solution architecture </h5><br>  Main lists created for solving the problem: <br><br><ul><li>  Regulations </li><li>  Orders </li><li>  Tasks </li><li>  ... + Various directories <br></li></ul><br><br>  Process flow: <br><br> <a href=""><img title="Capture" alt="Capture" src="https://habrastorage.org/getpro/habr/post_images/866/d0b/fdb/866d0bfdb12f7e0daa02e069e98a7afc.jpg" width="244" height="116"></a> <br><br><h5>  Process automation </h5><br>  The screenshot below is a similar scheme made using Visio <br> <a href=""><img title="Capture1" alt="Capture1" src="https://habrastorage.org/getpro/habr/post_images/ddc/ef2/a6a/ddcef2a6aa2e2fa9b06cec5c64c342e3.jpg" width="244" height="171"></a> <br><br>  It can be exported to MS SharePoint Designer - a workflow will be automatically created with ‚Äúif ... then ...‚Äù conditions and tasks for users, but even this simplified scheme looks quite cumbersome.  Especially if you take into account the fact that at almost every step of the order you need to perform additional activities - for example, send a letter, in some steps you need to make changes to other lists.  This makes a linear workflow (and SP Designer allows you to make only linear) difficult to apply to our situation. <br><br>  To solve this problem, you can use this combination of two workflows, let's call it a ‚Äúring‚Äù: <br><br> <a href=""><img title="Capture2" alt="Capture2" src="https://habrastorage.org/getpro/habr/post_images/78d/111/b9c/78d111b9c2ef583dd88b92fc02213005.jpg" width="244" height="95"></a> <br><br>  The workflow ‚Äúring‚Äù successfully replaces the linear workflow. <br>  The idea is simple - we already have 2 lists, a list of orders and a list of tasks.  We place an uncomplicated workflow on the list of orders, which looks at the current status of the Order and, depending on this, creates a particular task.  We add an even more simple workflow to the task list, which, when the task is completed, updates the status in the linked Order, thereby initiating the re-execution of the workflow on the Order. <br><br>  In order not to describe all the steps and transitions directly in the body of the workflow, we will create several more reference lists: <br><br><ul><li>  tasklist - a list of all possible tasks assigned to users during the transition to the next step </li><li>  logicoftransitions - transition logic.  List consisting of fields: </li><li>  taskfrom - the task from which to perform the transition </li><li>  condition1 - condition 1 (in our case, this decision is Yes or No, taken by the user on the previous task) </li><li>  condition2 - condition 2 (in our case, the presence or absence of the ‚Äúexpress‚Äù feature) </li><li>  condition3 - condition 3 (in our case, the order type is RP creation, RP change, RP removal) </li><li>  taskto is a task to which the process should be transferred taking into account the previous conditions </li><li>  sendemail - the field Yes / No, whether to send a letter when the condition </li><li>  emailsubj - letter subject </li><li>  emailtext - letter text </li><li>  emailsendto - email recipients </li></ul><br><br>  These lists are enough to automate the process.  Of course, if we leave the taskfrom field empty, this will mean that the task is the first and has no previous tasks.  An empty taskto field means the absence of the next step - a task, and if you need to do something besides sending a letter, this situation must be further processed in the body of the workflow. <br><br>  The final workflow on the Orders list is quite short - judge for yourself (the picture is divided into 2 halves): <br><br> <a href=""><img title="Capture3_1" alt="Capture3_1" src="https://habrastorage.org/getpro/habr/post_images/c77/66a/c56/c7766ac562a010675c243dc7e3a7dd07.jpg" width="204" height="244"></a> <a href=""><img title="Capture3_2" alt="Capture3_2" src="https://habrastorage.org/getpro/habr/post_images/df6/953/218/df695321840c0695b00a15fd2383fb52.jpg" width="207" height="244"></a> <br><br>  The workflow for the Tasks list contains only one activity at all. <br><br> <a href=""><img title="Capture4" alt="Capture4" src="https://habrastorage.org/getpro/habr/post_images/ad7/0f7/71c/ad70f771c7459b38f182b358d419ceec.jpg" width="244" height="49"></a> <br><br>  There is another nuance.  In the workflow, you cannot just pick up and select an item from the list if several fields match.  One matching field is please, but no more.  However, the problem is solved in an elegant way.  We need to hang a small workflow or handler, or even just a calculated field on a list of logicoftransitions ‚Äî its task will be to simply fill in a hidden text field, which we will use for comparison.  So, for example, if a step depends on the state 'task name', solution 'yes / no', 'express sign' and 'order type', then the line will look like, for example, 'manager-yes-yes-creation of order'.  In the main workflow, there is a conditionstring variable, and we will compare it with our field. <br><br><br>  Advantages of such a decision: <br>  + It‚Äôs enough to make a blank node once, and turning it into a working node to automate a particular business process in the future will take quite a bit of time. <br>  + It is very easy to change the trajectory of the order - no need to change the workflow itself, just change the reference values ‚Äã‚Äãin the tasklist and logicoftransitions. <br>  + with the condition of minor refinement, you can realize the ability for the user to jump into an arbitrary step, or even assign individual trajectories to individual orders. <br>  Minuses: <br>  - you cannot look at the beautiful chart, where our order is currently located, how this can be done if you use the regular linear workflow <br>  In order to at least partially neutralize this drawback, you can display all related tasks in the DispForm, an order viewing form.  This will give a clear picture of the step at which the order is at the moment and the data from which user (s) are expected.  This is done simply: we want the tasks to be tied to the order ‚Äî it is enough to assign the value of the ID of the current element to the ‚ÄúOrder‚Äù substitution field.  It‚Äôs also easy to display them in the Order View Form; you just need to add a web part to the DispForm for the Orders list, a web form with a filter that displays the elements of the task list with the value of the lookup field: ID equal to the parameter taken from the browser's request string. <br><br><h5>  Creating related list items (Order linked to the Regulations).  Autocomplete and hide fields. </h5><br>  As follows from the terms of reference, it is necessary to be able to create Orders for changing and deleting Regulations.  To do this, obviously, the order must be tied to the Regulations. <br>  The wish of the customer of the system was auto-completion of the fields in these newly created orders - the fields from the Regulations were to be transferred to the Order. <br>  One of the tried ways was to create a finished Order by a workflow, and send the user a link to the resulting Order.  However, this practice has shown its inefficiency - the user does not want to be distracted by mail, he wants to see the Order being created on the screen with the possibility of making changes before it is created. <br>  Such a solution was invented.  We use the same Sharepoint Designer.  A new form is created for viewing the list of the Regulations, and it is desirable to create it by cloning the existing file DispForm.aspx <br>  Then, under the form that displays all the fields, create a form for creating a new item in the Orders list.  Thus, we have one form, in the upper part of which there are fields in the view mode, in the lower part - in the fill mode. <br>  To fill use the good old javascript.  The script code can be placed on our * .aspx - page after the line: <br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">asp:Content</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ContentPlaceHolderId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PlaceHolderMain"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">runat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"server"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  or in the new web part of the Content Editor located under all other web parts. <br>  Step one: take the value from the fields in the top web part.  The caveat is that these fields have the same id.  So, for example, if we have several fields with the ‚ÄúSingle-line text‚Äù type - they all will have the id ‚ÄúSPFieldText‚Äù This of course makes it difficult to find the desired value, and here is one of the ways to solve this problem: <br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//    TD var inputTags = document.getElementsByTagName('TD'); //        al = new Array(); nm = new Array(); lp = new Array(); bl = new Array(); ch = new Array(); //   for(var i=0;i&lt;inputTags.length;i++) if(inputTags[i].id == 'SPFieldNumber') al.push(inputTags[i]); else if(inputTags[i].id == 'SPFieldText') nm.push(inputTags[i]); else if(inputTags[i].id == 'SPFieldLookup') lp.push(inputTags[i]); else if(inputTags[i].id == 'SPFieldBoolean') bl.push(inputTags[i]); else if(inputTags[i].id == 'SPFieldChoice') ch.push(inputTags[i]);</span></span></code> </pre><br>  Now we have in the array element al [0] - the contents of the first tag with id ‚ÄúSPFieldNumber‚Äù, in al [1] - the second, and so on ... <br>  Step number two: write the values ‚Äã‚Äãin the appropriate fields.  In the editing form, unlike the viewing form, all fields have a unique id (by the way, you can view it in IE by clicking F12, then selecting the desired field with the search cursor): <br> <a href=""><img title="Capture5" alt="Capture5" src="http://lh4.ggpht.com/-IbTzILhVE8c/UH0XC02P26I/AAAAAAAAHac/Zs7yKZY02J4/Capture5_thumb.jpg?imgmax=800" width="244" height="184"></a> <br>  Each type of field requires its own individual approach, for example, for fields with the type ‚ÄúSingle line text‚Äù and ‚ÄúSelect‚Äù the contents of the tag look like this: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">valign</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"top"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ms-formbody"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"450px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SPFieldText"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- FieldName="" FieldInternalName="Title" FieldType="SPFieldText" --&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  and the values ‚Äã‚Äãfrom the contents of the tag can be taken as follows: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     nm0=nm[0].innerHTML; //      ,        end_comment = '--&gt;'; //    end_pos = nm0.indexOf( end_comment ); nm0=nm0.substr( end_pos + end_comment.length ); nm0 = nm0.replace(" ",""); //     document.getElementById("ctl00_m_g_41362970_e9f4_429e_b60f_f62d1e52e332_ff11_new_ctl00_ctl00_TextField").value = nm0</span></span></code> </pre><br>  For a field with ‚ÄúSubstitution‚Äù type, the contents of the tag look like this <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">valign</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"top"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ms-formbody"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"450px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SPFieldLookup"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- FieldName="" FieldInternalName="_x0418__x043d__x0441__x0442__x04" FieldType="SPFieldLookup" --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/it/d/dpp/nmc/Lists/InstanceForis/DispForm.aspx?ID=6&amp;RootFolder=*"</span></span></span><span class="hljs-tag">&gt;</span></span> ‚Äã<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  we only need the ID value, we can get it using regular expressions, like this: <br><pre> <code class="javascript hljs">lp0 = lp[<span class="hljs-number"><span class="hljs-number">0</span></span>].innerHTML; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = <span class="hljs-regexp"><span class="hljs-regexp">/ID=(\d+)/ig</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( r.test( lp0 ) ) { res = lp0.match( r ) lp0 = <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>.$<span class="hljs-number"><span class="hljs-number">1</span></span> }</code> </pre><br>  Now you need to set the ‚ÄúSubstitution‚Äù field to the desired value - there is quite a voluminous code, several functions are used, taken from here: <a href="http://blogs.msdn.com/b/sharepointdesigner/archive/2007/06/13/using-javascript-to-manipulate-a-list-form-field.aspx">http://blogs.msdn.com/b/sharepointdesigner/archive/2007/06/13/using-javascript- to-manipulate-a-list-form-field.aspx</a> <br>  These functions are copied to our page as is, unchanged.  After that, in order to set the ‚ÄúSubstitution‚Äù field to a value, just write, for example: <br><pre> <code class="javascript hljs">setLookupFromFieldName(<span class="hljs-string"><span class="hljs-string">"  "</span></span>, lp0); <span class="hljs-comment"><span class="hljs-comment">//    lp0</span></span></code> </pre><br>  or <br><pre> <code class="javascript hljs">setLookupFromFieldName(<span class="hljs-string"><span class="hljs-string">" "</span></span>, vals[<span class="hljs-string"><span class="hljs-string">"ID"</span></span>]); <span class="hljs-comment"><span class="hljs-comment">//  ,     </span></span></code> </pre> <br>  Thus, our Order becomes attached to the Regulations. <br>  Sometimes some fields need to be set to the desired values ‚Äã‚Äãexplicitly.  For example, for the ‚ÄúYes / No‚Äù field: <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"ctl00_m_g_41362970_e9f4_429e_b60f_f62d1e52e332_ff3_new_ctl00_ctl00_BooleanField"</span></span>).checked=<span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre><br>  Further, some fields need to be hidden in order to avoid changes by the user.  In our case, these are the fields ‚ÄúRelated regulations‚Äù and ‚ÄúOrder type‚Äù. <br>  To hide the fields for us there is a great solution in the jQuery library.  It is enough to connect these libraries, indicating the path to them as follows: <br><pre> <code class="javascript hljs">&lt;script language=<span class="hljs-string"><span class="hljs-string">"javascript"</span></span> type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"/jQuery%20Libraries/jquery-1.6.1.min.js"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br><br>  and now, in order to hide the line from the user, such a construction is enough: <br><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'#ctl00_m_g_41362970_e9f4_429e_b60f_f62d1e52e332_ff24_new_ctl00_Lookup'</span></span>).closest(<span class="hljs-string"><span class="hljs-string">'tr'</span></span>).hide();</code> </pre><br>  It would be wrong not to mention here about SPServices - a jQuery-based library written specifically for Sharepoint.  It was not useful in this project, but nevertheless there are a lot of useful functions.  For example, $ (). SPServices.SPCascadeDropdowns - allows you to filter drop-down values ‚Äã‚Äãof the ‚ÄúSubstitution‚Äù field depending on the selection in the previous fields and many other utilities.  Project address: <a href="http://spservices.codeplex.com/">http://spservices.codeplex.com</a> <br><br><h5>  Validation of entered fields </h5><br>  In SharePoint, there is an indication that the field is mandatory / optional and the ability to specify a formula for checking input values. <br>  Sometimes a regular field verification mechanism is not enough.  For example, if you want to make the input value dependent on other values. <br>  To implement field validation, you can use the capabilities of the SharePoint Power EventReceiver 2010 solution taken from here <a href="http://ilovesharepoint.codeplex.com/releases/view/55733">http://ilovesharepoint.codeplex.com/releases/view/55733</a> <br>  The installed solution adds 2 additional menu items to the list: <br> <a href=""><img title="Capture6" alt="Capture6" src="https://habrastorage.org/getpro/habr/post_images/aed/280/35f/aed28035fd35884b28073cdd38870240.jpg" width="182" height="54"></a> <br>  and allows you to write powershell code for any event handler.  In the case when we need to check the correctness of the input values, we need to define the ItemAdding and ItemUpdating functions. <br>  To do this, simply uncomment them and write code like this: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ItemUpdating</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( $properties.AfterProperties[<span class="hljs-string"><span class="hljs-string">"_x0413__x0440__x0443__x043f__x04"</span></span>] -eq <span class="hljs-number"><span class="hljs-number">0</span></span> ) { $atmsg=<span class="hljs-string"><span class="hljs-string">"  ; "</span></span> $warcnt=$warcnt+<span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(($properties.AfterProperties[<span class="hljs-string"><span class="hljs-string">"xpress"</span></span>] -eq <span class="hljs-string"><span class="hljs-string">"true"</span></span>) -<span class="hljs-keyword"><span class="hljs-keyword">and</span></span> ($warcnt)) { $properties.ErrorMessage = <span class="hljs-string"><span class="hljs-string">"&lt;b&gt;    :&lt;/b&gt;&lt;br&gt;$atmsg&lt;br&gt;        )"</span></span> $properties.Cancel = $true } }</code> </pre><br>  Be careful with the insidious Before- and AfterProperties, you can read more about them here: <a href="http://gandjustas.blogspot.com/2011/05/blog-post.html">gandjustas.blogspot.com/2011/05/blog-post.html</a> <br><br><h5>  Restriction of access to close the task, notifications about the overdue task. </h5><br>  Initially, in the newly created Tasks list, you can assign a task to only one person - however, this is easy to change, just by changing the ‚ÄúCan contain several values‚Äù property for the ‚ÄúTo whom‚Äù field <br>  It is more difficult to solve another moment - how to allow the task to be changed only to those users to whom it is directly assigned?  In SharePoint Designer there is an activity ‚ÄúGive permissions to a list item‚Äù - it is available in the so-called ‚ÄúImpersonation Step‚Äù, in which all activities are performed on behalf of the creator of the workflow.  However, this activity does not work with a field in which we have several users - it works only for one. <br>  Here you can use another solution from the creator of Power EventReceiver 2010 - it is called Advanced Workflow Actions for SharePoint Designer 2010, located at <a href="http://ilovesharepoint.codeplex.com/wikipage%3Ftitle%3DWorkflow%2520Actions%2520for%2520SharePoint%2520Designer%25202010%26amp%3BreferringTitle%3DDocumentation">http://ilovesharepoint.codeplex.com/wikipage?title=Workflow%20Actions%20for%20SharePoint%20Designer%202010&amp;referringTitle = Documentation</a> and allows you to perform additional activities in our workflow.  We are interested in the activity of Execute PowerShell Script - we will use it to divide the contents of the field ‚ÄúTo whom is assigned‚Äù into components - into separate users. <br>  Here is how the activity in workflow looks like (we start on creating a new task): <br> <a href=""><img title="Capture7" alt="Capture7" src="https://habrastorage.org/getpro/habr/post_images/e92/221/c20/e92221c205ba9b03f6a688ac9c8eebb6.jpg" width="244" height="52"></a> <br>  But its code is quite simple thanks to powershell: <br> <a href=""><img title="Capture8" alt="Capture8" src="https://habrastorage.org/getpro/habr/post_images/891/c8a/0da/891c8a0da186696f2fc9707e59f5b5e7.jpg" width="244" height="157"></a> <br>  Clearly, the limitation of this solution is a maximum of 5 users.  This is usually more than enough. <br>  Finally, how to organize notification of the user about the expiration of the task (or about the approaching of this period, or that the task expired 2 days ago - or about everything together) - one more workflow is needed with the activity ‚ÄúTake a pause until ...‚Äù wait for the desired date and send an alert. <br><br><h5>  Redirect to the desired page </h5><br>  From time to time it is required to redirect the user to any page by clicking the ‚ÄúSave‚Äù button. <br>  If it is always the same link, then simply delete the standard button and create your own with a code like this: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btnFormAction"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript: {ddwrt:GenFireServerEvent('__commit;__redirect={../orderz/myorders.aspx}')}"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  If the direction of the redirect depends on the selected fields, then the same Power EventReceiver 2010 will help. The code will look like this: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ItemAdding</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($properties.AfterProperties[<span class="hljs-string"><span class="hljs-string">"reqtype"</span></span>] -eq <span class="hljs-string"><span class="hljs-string">" "</span></span>) { $properties.Status = [Microsoft.SharePoint.SPEventReceiverStatus]::CancelWithRedirectUrl $properties.RedirectUrl = <span class="hljs-string"><span class="hljs-string">"../orderz/NewForm.aspx"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $properties.Status = [Microsoft.SharePoint.SPEventReceiverStatus]::CancelWithRedirectUrl $properties.RedirectUrl = <span class="hljs-string"><span class="hljs-string">"../regproc"</span></span> } }</code> </pre><br><br><h5>  Restricting access to create / modify without permissions </h5><br>  The user is not allowed to create, modify, or delete items in the Regulations list, however, if he is deprived of his permission to perform these actions, the workflow will not be able to do these operations (unless of course these actions are not performed in the impersonation step - but in this case the author will be which is not always convenient) <br>  One solution is to simply make new forms for the list - instead of the traditional NewForm, EditForm, create new ones, tick the ‚Äúdefault‚Äù checkbox on them and remove all the edit fields from there, replacing them with some text that explains why the user should create / delete Regulations can not be directly and what should be done instead - with links and instructions. <br><br><h5>  Conclusion </h5><br>  Of course, for the final delivery of the project, the customer still needs some ‚Äúpolishing‚Äù actions - hiding some fields, creating custom workstations with setting up views and menus depending on the role in the process.  However, I listed the main ‚Äútricks‚Äù in the article, I really hope that they will be useful to someone. </div><p>Source: <a href="https://habr.com/ru/post/154953/">https://habr.com/ru/post/154953/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../154939/index.html">Asus insists on a unique form factor and releases PadFone2</a></li>
<li><a href="../154945/index.html">How I started a project about startups, and how it developed in practice</a></li>
<li><a href="../154947/index.html">Linux ipsec decoding</a></li>
<li><a href="../154949/index.html">Personal personal documents will appear in Google personal search results.</a></li>
<li><a href="../154951/index.html">How to determine the language of the printed text? (European languages)</a></li>
<li><a href="../154957/index.html">We speed up the service from the client side several times. Ajax + preloading in the background + when you hover</a></li>
<li><a href="../154959/index.html">As I decided to quietly teach a python, but I got into the wilds of CS188.1x Artificial Intelligence</a></li>
<li><a href="../154963/index.html">Does LK write its operating system?</a></li>
<li><a href="../154969/index.html">Another bitcoin death. Now asic</a></li>
<li><a href="../154971/index.html">7 reasons why cloud technology needs Europe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>