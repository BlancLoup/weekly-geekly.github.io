<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ADB Uninstall plugin for Android Studio (IntelliJ IDEA)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It so happened that I lost one argument and I had to shave baldly. Since nothing else held back the flow of fresh ideas to my head, and it seemed a sh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ADB Uninstall plugin for Android Studio (IntelliJ IDEA)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage3/b92/49a/142/b9249a142d0cbfb8be0d8014dca9e4a4.png" align="left"><br>  It so happened that I lost one argument and I had to shave baldly.  Since  nothing else held back the flow of fresh ideas to my head, and it seemed a shame to appear on the street, then I set out to write a socially useful plugin for one of the best development environments.  The functionality is simple, like a maize cob, but very necessary (I‚Äôm not sure why I‚Äôm not sure why it's not built in by default).  So, today I will try to share the experience of developing a plug-in that will allow you to elegantly remove applications that you are working on connected Android devices. <br><a name="habracut"></a><br>  For those who just want to start using, here‚Äôs what it looks like (called by <em>AltGraph + U</em> ): <br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/d49/026/9ff/d490269ff24a5ed5b61289e7500de685.png"></div><br>  Download from here (ver. 1.0.1): <a href="https://github.com/Ghedeon/ADB-Uninstall/releases">github.com/Ghedeon/ADB-Uninstall/releases</a> <br>  Installation: <em><b>Settings ‚Üí Plugins ‚Üí Install plugin from disk ...</b></em> <br>  <em><b>Important:</b></em> The plugin is raw, so I really hope that those who have installed will unsubscribe about the problems.  I will correct as far as possible.  Reviews, comments, suggestions for expanding the functionality - everything is welcome! <br><br>  Here are some everyday scripts of Android developers (especially when working in a team): <br><br><h6>  Use-Case 1: </h6>  The team works on one application.  You have just exchanged devices with someone and patiently wait for the installation to complete.  What is the result?  That's right, <b>Failure [INSTALL_PARSE_FAILED_INCONSISTENT_CERTIFICATES].</b>  It is logical, because on the device there is an application from a colleague, <em>debug keys</em> , with which applications are signed are different, respectively, the <em>update</em> does not work.  Cursing, you climb into the command line, type <code>"adb uninstall &lt;package&gt;"</code> and almost physically feel how the program is being demolished bytes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  Use-Case 2: </h6>  All the same, only after <code>"adb uninstall"</code> nothing happens, because your system does not have one, but two devices and <em>adb</em> does not know from which to delete.  Having embraced the whole stupidity of the situation with your brain, in frustrated feelings you type <code>"adb devices"</code> , get a list of devices, then <code>"adb -s &lt;deviceId&gt; uninstall &lt;package&gt;"</code> and the world surrenders to you. <br><br><h6>  Use-Case 3: </h6>  You have several connected devices and you need to remove from all.  Well, here the laziest will go to write a script that at least somehow automates the whole kitchen. <br><br><h6>  Use-Case 4: </h6>  There are no problems, but you are just too lazy to write <code>"adb uninstall &lt;package&gt;"</code> . <br><br><h6>  Solutions: </h6><ul><li>  To use one <em>debug key by</em> all team members, then, from the point of view of the system, everything will look as if you are working on one computer. </li><li>  A self-written script and, preferably, smart enough not to ask you about the package name. </li></ul><br>  Actually, I was interrupted by the script until recently, and it completely suited me, until the authorities demanded to make more active contacts in the team.  The option to be interested in the health of someone's parrot, trying to withstand the sincerely concerned anxiety, was rejected as hopeless, so I decided to make a more cross-platform solution of my craft and go with it to people. <br><div class="spoiler">  <b class="spoiler_title">Script itself</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash package=`grep -o 'package=".*"' AndroidManifest.xml | grep -o \".* | sed 's/"//g'` #adb uninstall $package adb devices | tail -n +2 | awk '{print $1}' | xargs -I {} adb -s {} uninstall $package</span></span></code> </pre><br></div></div><br><h4>  Development </h4><br>  About plug-ins for IDEA on Habr√© has already been written, which is only worth a monumental translation in seven parts from <a href="https://habrahabr.ru/users/lucyfer/" class="user_link">Lucyfer</a> , so I‚Äôll omit the general structure and configuration of IDE.  In order to add your own item in the menu and / or toolbar, we inherit from <em>AnAction</em> and override the <em>actionPerformed ()</em> method.  First of all, we learn the absolute path to the <em>Android SDK</em> : <br><pre> <code class="java hljs">ProjectRootManager.getInstance(event.getProject()).getProjectSdk().getHomePath();</code> </pre><br>  if we add <code>/platfrom-tools</code> to this, then we will have the path to the working folder, from where we can run <em>adb</em> . <br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  Initially, I decided to go a different way: to hope that the user has all the paths to the <em>Android SDK</em> correctly configured in the environment variables and just pass them on to my process.  Then we do not need an absolute path, the interpreter will know about the commands that we want to run.  However, under <em>Linux</em> and <em>Mac OS</em> , environment variables, as you know, can be stuffed into a thousand and one relatively decent places, which prevented me from saying with certainty what I would have in <code>System.getenv()</code> .  In general, with certain settings of the system, this method collapsed and I decided to retreat.  Later, after digging into the source code of the android plug-in for IDEA, I discovered that they, like me, use absolute paths. <br></div></div><br>  Get the list of connected devices: <br><pre> <code class="java hljs">Process pr = Runtime.getRuntime().exec(toolPath + File.separator + <span class="hljs-string"><span class="hljs-string">"adb devices"</span></span>);</code> </pre><br>  I used Runtime.exec <code>Runtime.exec()</code> from Java, but at the same time IDEA offers a kosher <code>GeneralCommandLine</code> for such cases.  In truth, this transition is still in my <em>TODO</em> and I will be very grateful if someone shares their experience. <br><br>  Now you need to determine the name of the package that will be deleted.  There may be options.  An Android project may contain several executable modules with different package names.  There may still be <em>Library Projects</em> , but we are not talking about them.  The first thing that came to mind was to take the package name from the <em>AndroidManifest.xml of the</em> currently active module.  But it turned out to be not very convenient, you can work in the wrong module that you want to remove, so you had to first select the desired module with the mouse.  As a result, I stopped at a much more logical solution - to extract the package name from the manifest of the module specified in the current launch configuration.  I will explain.  As you know, to install an application, you need at least one <em>Run Configuration</em> .  When you create this very <em>Run Configuration</em> , in the <em>General</em> tab, you specify the <em>Module</em> .  From the manifest of the specified module we will take the package name.  If there are several configurations, we will take the one that is currently active. <br>  We get the active configuration: <br><pre> <code class="java hljs">RunManager runManager = RunManager.getInstance(event.getProject()); ModuleBasedConfiguration selectedConfiguration = (ModuleBasedConfiguration) runManager.getSelectedConfiguration().getConfiguration();</code> </pre><br>  The next step is to find the exact path to the folder with <em>AndroidManifest.xml</em> .  In the case of projects with the old structure, this will simply be the root of the module.  For <em>gradle-based</em> projects, this is typically the <em>currentModulePath / src / main</em> that needs to be considered.  The module root itself is obtained as follows: <br><pre> <code class="java hljs">Module <span class="hljs-keyword"><span class="hljs-keyword">module</span></span> = selectedConfiguration.getConfigurationModule().getModule(); currentModuleFilePath = <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.getModuleFilePath(); String currentModulePath = currentModuleFilePath.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, currentModuleFilePath.lastIndexOf(File.separator));</code> </pre><br>  Parsing the found <em>AndroidManifest.xml</em> with the same <em>StAX</em> parser, for the <em>package</em> attribute, is already a trivial task. <br><br>  In fact, the received data ( <em>deviceId</em> and <em>package</em> ) is enough to directly start running <em>adb uninstall</em> .  But before that, we will do another, mostly cosmetic, thing.  Distinguishing devices by <em>deviceId is</em> not very convenient, so let's try to provide the user with more <em>human-readable</em> ( <em>‚Äú</em> <em>human-readable</em> ?‚Äù) Information.  For this purpose, execute the following command for each device: <br><pre> <code class="bash hljs">adb -s &lt;deviceId&gt; shell cat /system/build.prop;</code> </pre><br>  The result of which will be a long list (in fact, this is an associative array) of various characteristics of the device.  We choose only the ones we need, namely: <br><pre> <code class="bash hljs">ro.product.manufacturer ro.product.model ro.build.version.release ro.build.version.sdk</code> </pre><br>  As a result, instead of the abstract spell <em>R32CC02G02Z, the</em> user will see the proud: <em>‚ÄúSamsung Nexus 10 Android 4.3 (API 18)‚Äù</em> . <br><br>  Things are easy, we show the user a modal window with all this good, we get a list of selected devices and, in the order of the live queue, run the coveted <em>adb uninstall</em> : <br><pre> <code class="java hljs">Process pr = Runtime.getRuntime().exec(toolPath + File.separator + <span class="hljs-string"><span class="hljs-string">"adb -s "</span></span> + device.getSerialNumber() + <span class="hljs-string"><span class="hljs-string">" uninstall "</span></span> + packageName);</code> </pre><br>  It's all. <br><br>  The source code of the project on <em>GitHub</em> : <a href="https://github.com/Ghedeon/ADB-Uninstall">github.com/Ghedeon/ADB-Uninstall</a> . <br><br><h5>  Addition: </h5><br><ul><li>  For logs and various messages addressed to the user, <code>Notifications.Bus.notify(&lt;notification&gt;)</code> .  Depending on the user settings, the message will appear in one or several places of the user interface: <em>Event Log, Balloon, Sticky Balloon, Tool window balloon</em> .  Either will not appear at all. </li><li>  In order to interact with the user, so that your add-ins look organic, it‚Äôs better to use not bare <em>Swing</em> , but the components that <a href="http://habrahabr.ru/post/188060/">IntelliJ IDEA</a> offers.  In particular, I used the <em>Dialog Wrapper</em> from this set. </li><li>  An important unrealized point for me is the collection of statistics, at least for failures in the plug-in.  At the moment, there is a curious situation when, in response to the crash of the IDEA plug-in, it offers to send a bug report to Google.  I would be grateful for the tip-off, if someone knows tools like <a href="http://try.crashlytics.com/">Crashlytics</a> , but only for <em>Swing</em> applications. </li></ul><br>  I would like to mark the users <a href="https://habrahabr.ru/users/lucyfer/" class="user_link">Lucyfer</a> and <a href="https://habrahabr.ru/users/yole/" class="user_link">yole</a> .  Thank you guys for good advice. </div><p>Source: <a href="https://habr.com/ru/post/194514/">https://habr.com/ru/post/194514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194492/index.html">Variable Length Data - DataSizeVariable (DSV)</a></li>
<li><a href="../194494/index.html">Printed circuit board production technology</a></li>
<li><a href="../194500/index.html">Ubuntu Touch will be released on October 17</a></li>
<li><a href="../194502/index.html">Literature without the past, or Down with the library</a></li>
<li><a href="../194512/index.html">IBM and Continental will develop systems for self-driving cars</a></li>
<li><a href="../194516/index.html">Microwave Repair Experience</a></li>
<li><a href="../194518/index.html">Impressions from entering Kikstarter</a></li>
<li><a href="../194520/index.html">Jaguar uses virtual technologies to organize sales</a></li>
<li><a href="../194526/index.html">As we studied project management in the mountains. Vertex # 2</a></li>
<li><a href="../194528/index.html">Adaptability</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>