<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I patch Zabbix</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day, I finally got around to updating Zabbix. 

 Since reading the article Zabbix 2.2 came out in the corresponding blog, I could not wait f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I patch Zabbix</h1><div class="post__text post__text-html js-mediator-article">  The other day, I finally got around to updating Zabbix. <br><br>  Since reading the article <a href="http://habrahabr.ru/company/zabbix/blog/201500/">Zabbix 2.2 came out</a> in the corresponding blog, I could not wait for Gentoo to unmask version 2.2.  Practically there was no such innovation in this version that I would not be interested in and useful in ‚Äúeveryday life‚Äù.  This monitoring of VMware, and system acceleration, and improvements in the LLDP, in short, almost every item. <br><br>  Months passed, and version 2.2 was not even disguised. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Sometimes I put the routine aside and do something ‚Äúparallel‚Äù with regard to urgent and important tasks and work.  This time I remembered the desire to upgrade Zabbix to version 2.2. <br><br>  Checked in masked *, well, finally, there is 2.2.5 <br><br>  All right, let's go, it's been a year since the release, the stable version doesn't exist, so whatever happens, we'll decide. <br><a name="habracut"></a><br>  We unmask, collect wherever we need (the server and the proxy are the main ones, of course), restart.  Reinstall the web interface iiii ... <br>  And nothing, is updating the database. <br>  The thing is not fast, my base is not small, and then the process is completely frozen. <br><br>  Well, I think it started, as they say, they did not have time to start, but everything is already bad. <br><br>  In the mysql logs there was an Error number 28 means 'No space left on device', there was more than enough space everywhere.  As they say ‚Äúin the presence of Google, I am godlike‚Äù (c), not immediately, but I managed to find / guess that this device is ibdata1 and ibdata2, the size of which is regulated by the innodb_data_file_path parameter.  After I changed max from 256M to 512M, the database update was completed successfully and the server started. <br><br>  The proxy also had problems, and also because of the database.  Just sqlite is not updated, so stop the proxy, delete the old database and run the proxy.  As they say read carefully Upgrade notes <br><br>  Of course, during the update, a lot of overdue data has accumulated, so we check what we can check that everything is shown in the interface, and wait until everything is fixed and updated. <br><br>  After a couple of hours, look at the schedule: <br><br><img src="https://habrastorage.org/files/0a8/386/fb3/0a8386fb3160434da93d18438029a61f.jpg" alt="image"><br><br>  The day was starting to get languid. <br><br>  We have a turn.  From where? .. The main overdue data from one of the proxies.  And what kind of data.  And the data received by SNMPv3. <br><br>  Fine.  I had questions to this functionality before, but all hands did not reach, but there was hope that the update would resolve these issues.  And then the system becomes practically inoperable.  At one time, reading about how people using a single server or proxy monitor hundreds of network devices, I could not understand what was the matter?  I have a few dozen devices, and everything works at the limit.  Already, the DB is utterly optimized, and the server is set to a fast datastor, and a lot of memory has been given to it. <br><br>  I didn‚Äôt want to roll back, so it was decided to try to deal with the problem by all means. <br><br>  I chose one of the proxies, for which the most SNMP devices, and began to understand. <br><br>  That's what we have in the logs on the proxy **: <br><pre><code class="hljs vhdl"><span class="hljs-number"><span class="hljs-number">4447</span></span>:<span class="hljs-number"><span class="hljs-number">20141218</span></span>:<span class="hljs-number"><span class="hljs-number">124053.605</span></span> SNMP agent item <span class="hljs-string"><span class="hljs-string">"ifAdminStatus.["</span></span><span class="hljs-number"><span class="hljs-number">10130</span></span><span class="hljs-string"><span class="hljs-string">"]"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> host <span class="hljs-string"><span class="hljs-string">"co-xx02"</span></span> failed: first network <span class="hljs-literal"><span class="hljs-literal">error</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">wait</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> seconds <span class="hljs-number"><span class="hljs-number">4468</span></span>:<span class="hljs-number"><span class="hljs-number">20141218</span></span>:<span class="hljs-number"><span class="hljs-number">124108.270</span></span> resuming SNMP agent checks <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> host <span class="hljs-string"><span class="hljs-string">"co-xx02"</span></span>: connection restored</code> </pre> <br>  And so randomly across all SNMP hosts, with different items. <br><br>  I definitely do not have network problems, but to be sure, I of course quickly checked the connectivity, speed and logs of the switches.  We check the SNMP itself using snmpwalk and we pull the whole tree.  No problem. <br>  Google  Somebody got pollers, someone had incorrect timeouts, some bug related to this was fixed in version 2.2.3.  Someone has a tricky network problem and lost UDP.  But this is not our case. <br>  What then? .. <br><br>  An interesting fact, if you restart the proxy <br><pre> <code class="bash hljs">/etc/init.d/zabbix-proxy restart</code> </pre><br>  That is seen as the queue starts to shrink, but then bang, something happens again and it instantly grows ***. <br><br><img src="https://habrastorage.org/files/af9/9cf/690/af99cf6909df4386bd2553208a9ec22e.jpg" alt="image"><br><br>  What is happening? .. <br>  Enable extended logging on zabbix-proxy <br>  DebugLevel = 4 <br>  Restart zabbix-proxy and wait for errors <br><br>  Now, instead of Network Error, we see more complete information. <br><br><div class="spoiler">  <b class="spoiler_title">It looks like this</b> <div class="spoiler_text"><pre> <code class="hljs css">5414<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:125955.481</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:-1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:94</span></span> 5414<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:125955.481</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">End</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>()<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:NETWORK_ERROR</span></span> 5414<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:125955.481</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">End</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_process_standard</span></span>()<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:NETWORK_ERROR</span></span> 5414<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:125955.481</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">In</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_close_session</span></span>() 5414<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:125955.481</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">End</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_close_session</span></span>() 5414<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:125955.481</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">getting</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SNMP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">values</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">failed</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cannot</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">connect</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> "192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xx</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:161"</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Too</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">long</span></span>. 5414<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:125955.481</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">End</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">get_values_snmp</span></span>() 5414<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:125955.481</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">In</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">deactivate_host</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">hostid</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10207</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">itemid</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:43739</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">type</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:6</span></span> 5414<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:125955.481</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">query</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[txnlev:1]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[begin;]</span></span> 5414<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:125955.481</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">query</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[txnlev:1]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[update hosts set snmp_errors_from=1418896795,snmp_disable_until=1418896810,snmp_error='Cannot connect to "192.168.xx:161": Too long.' where hostid=10207]</span></span> 5414<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:125955.481</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">query</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[txnlev:1]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[commit;]</span></span> 5414<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:125955.481</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SNMP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">agent</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">item</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">ifOperStatus</span></span>.<span class="hljs-selector-attr"><span class="hljs-selector-attr">["10143"]</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">on</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">host</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">co-xx04</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">failed</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">first</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">network</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">error</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">wait</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">for</span></span> 15 <span class="hljs-selector-tag"><span class="hljs-selector-tag">seconds</span></span> 5414<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:125955.481</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">deactivate_host</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">errors_from</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1418896795</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">available</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> 5414<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:125955.482</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">End</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">deactivate_host</span></span>()</code> </pre><br></div></div><br>  Status 1, error status -1, number of elements 94 <br>  Here is the conclusion that this is NETWORK_ERROR <br>  And just below decoding Too long and deactivating the host.  It is clear that if a host is deactivated, data cannot be obtained from it, data is queued, and that is the queue explanation. <br><br>  Immediately interested in the parameter errstat <br><br>  Make cat /var/log/zabbix/zabbix_proxy.log |  grep errstat <br><pre> <code class="hljs css">5412<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:130351.410</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11</span></span> 5433<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:130351.470</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:-1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:94</span></span> 5430<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:130351.476</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:-1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:94</span></span> 5417<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:130353.442</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5</span></span> 5420<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:130353.534</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:-1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:94</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Yeah, digging deeper.</b> <div class="spoiler_text">  There should be a picture We need to go deeper, but it won't.  I think she got everyone. <br></div></div><br><br>  Make cat /var/log/zabbix/zabbxi_proxy.log |  grep errstat: -1 <br><pre> <code class="hljs css">5416<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:130353.540</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:-1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:94</span></span> 5412<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:130355.571</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:-1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:94</span></span> 5417<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:130355.591</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:-1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:94</span></span> ... 5420<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:130453.187</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:-1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:94</span></span> 5412<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:130455.206</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:-1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:94</span></span> 5413<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:130455.207</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:-1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:94</span></span></code> </pre><br><br>  It's time to turn off monitoring of all devices for a proxy except one, because  otherwise, the log is too difficult to understand.  Anyway, the system in this form as it is now for monitoring is not suitable. <br>  Disable, do <br>  cat /var/log/zabbix/zabbxi_proxy.log |  grep mapping_num <br>  and restart the proxy <br>  No mistakes at first, and mapping_num is slowly growing from 1 more and more (separate lines are cut to show the principle) <br><br><div class="spoiler">  <b class="spoiler_title">You can always look at how growing mapping_num</b> <div class="spoiler_text"><pre> <code class="hljs css">7876<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:131251.660</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4</span></span> 7872<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:131251.681</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:6</span></span> 7872<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:131251.919</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8</span></span> 7876<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:131251.919</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9</span></span> 7868<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:131351.965</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:13</span></span> 10502<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:135237.884</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:31</span></span> 10507<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:135238.244</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:62</span></span> 12429<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:141637.942</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:31</span></span> 12429<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:141637.966</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:31</span></span> 12433<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:141651.142</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:-1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:94</span></span></code> </pre><br></div></div><br><br>  And then oppa 94, and -1 and too long.  Those.  Immediately after launching, the proxy tests the devices, sends them SNMP requests, increasing the number of items in one request.  The queue starts to shrink quickly.  Then he (I mean the proxy) reaches the magic number 94, it crashes and the devices begin to turn off with a zabbiks for 15 seconds, which in turn begins to dramatically increase the queue. <br><br>  As you can see, here is not a Network error at all, here is Too long. <br><br>  Okay, try to find something on zabbix snmp too long, nothing. <br><br>  Again, timeouts, poller overload ... In one interesting post there was information that such an error occurred when the OID for the item was incorrectly formed, so I double checked all my OIDs, including through snmpget <br><br>  Those.  In the end, Google could not help me. <br><br>  We will understand ourselves, this is useful. <br>  So what do we have? <br>  As soon as the number of items becomes 94 (i.e., large enough), something happens and the system gets lost. <br><br>  Here again, the picture, which will not;) <br><br>  It's time to climb into the code.  In gentoo, you don‚Äôt need to download anything, everything is already there, so I just unpacked everything into a working directory. <br><br>  We find first where the error is displayed.  We are looking for errstat <br>  Surprisingly, there are only two such places in the file with the talking title checks_snmp.c <br><br>  these two places are: <br>  from line 745 <br><pre> <code class="hljs vbscript">/* communicate <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> agent */ status = snmp_synch_response(ss, pdu, &amp;<span class="hljs-built_in"><span class="hljs-built_in">response</span></span>); zabbix_log(LOG_LEVEL_DEBUG, <span class="hljs-string"><span class="hljs-string">"%s() snmp_synch_response() status:%d errstat:%ld max_vars:%d"</span></span>, __function_name, status, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> == <span class="hljs-built_in"><span class="hljs-built_in">response</span></span> ? (long)<span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>-&gt;errstat, max_vars);</code> </pre><br>  and from line 938 <br><pre> <code class="hljs perl">status = snmp_synch_response(ss, pdu, &amp;response); zabbix_log(LOG_LEVEL_DEBUG, <span class="hljs-string"><span class="hljs-string">"%s() snmp_synch_response() status:%d errstat:%ld mapping_num:%d"</span></span>, __function_name, status, NULL == response ? (long)-<span class="hljs-number"><span class="hljs-number">1</span></span> : response-&gt;errstat, mapping_num);</code> </pre><br><br>  While we are interested in the second piece (assuming that the mapping_num is only in it) <br><br>  Not even the programmer sees that we have a NULL response, and why? .. <br><br>  Recall that with errstat: -1, which is now clear where it comes from, we have status: 1.  Those.  the snmp_synch_response function returns 1, but what does this mean? .. <br>  And this means STAT_ERROR (1) (and she can also STAT_TIMEOUT (2) and STAT_SUCCESS (0)) <br><br>  As they say it is not clear, but great ... <br>  Let's enter on the other hand, somewhere here in this file there should be a NETWORK_ERROR return. Let's try to figure out where and why. <br><br>  The very first entry in the function zbx_get_snmp_response_error (which, as it were, hints) <br><br><div class="spoiler">  <b class="spoiler_title">View code zbx_get_snmp_response_error</b> <div class="spoiler_text"><pre> <code class="hljs java"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zbx_get_snmp_response_error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> struct snmp_session *ss, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DC_INTERFACE *interface, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> status, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> struct snmp_pdu *response, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *error, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max_error_len)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ret; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (STAT_SUCCESS == status) { zbx_snprintf(error, max_error_len, <span class="hljs-string"><span class="hljs-string">"SNMP error: %s"</span></span>, snmp_errstring(response-&gt;errstat)); ret = NOTSUPPORTED; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (STAT_ERROR == status) { zbx_snprintf(error, max_error_len, <span class="hljs-string"><span class="hljs-string">"Cannot connect to \"%s:%hu\": %s."</span></span>, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addr</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">port</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">snmp_api_errstring</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ss</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s_snmp_errno</span></span></span><span class="hljs-class">))</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (ss-&gt;s_snmp_errno) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SNMPERR_UNKNOWN_USER_NAME: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SNMPERR_UNSUPPORTED_SEC_LEVEL: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SNMPERR_AUTHENTICATION_FAILURE: ret = NOTSUPPORTED; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: ret = NETWORK_ERROR; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (STAT_TIMEOUT == status) { zbx_snprintf(error, max_error_len, <span class="hljs-string"><span class="hljs-string">"Timeout while connecting to \"%s:%hu\"."</span></span>, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addr</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">port</span></span></span><span class="hljs-class">)</span></span>; ret = NETWORK_ERROR; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { zbx_snprintf(error, max_error_len, <span class="hljs-string"><span class="hljs-string">"SNMP error: [%d]"</span></span>, status); ret = NOTSUPPORTED; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre><br></div></div><br><br>  Yeah.  Those.  we with our STAT_ERROR enter the switch where we do not fall under any of the above conditions, and thus we get NETWORK_ERROR by default. <br>  We already understood that this default is disorienting us, we need to find out what kind of error it really is.  The error code is stored in ss-&gt; s_snmp_errno, we add the output of the variable to the log. <br><br>  The programmer from me is so-so, so quickly with the help of scrap and someone's mother (s) slayap patchch, like this: <br><pre> <code class="hljs vbscript">diff -urN zabbix<span class="hljs-number"><span class="hljs-number">-2.2</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span>/src/zabbix_server/poller/checks_snmp.c zabbix<span class="hljs-number"><span class="hljs-number">-2.2</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>/src/zabbix_server/poller/checks_snmp.c --- zabbix<span class="hljs-number"><span class="hljs-number">-2.2</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span>/src/zabbix_server/poller/checks_snmp.c <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-07</span></span><span class="hljs-number"><span class="hljs-number">-17</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">49</span></span>:<span class="hljs-number"><span class="hljs-number">45.000000000</span></span> +<span class="hljs-number"><span class="hljs-number">0400</span></span> +++ zabbix<span class="hljs-number"><span class="hljs-number">-2.2</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>/src/zabbix_server/poller/checks_snmp.c <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">31.000000000</span></span> +<span class="hljs-number"><span class="hljs-number">0400</span></span> @@ <span class="hljs-number"><span class="hljs-number">-938</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span> +<span class="hljs-number"><span class="hljs-number">938</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span> @@ status = snmp_synch_response(ss, pdu, &amp;<span class="hljs-built_in"><span class="hljs-built_in">response</span></span>); zabbix_log(LOG_LEVEL_DEBUG, <span class="hljs-string"><span class="hljs-string">"%s() snmp_synch_response() status:%d errstat:%ld mapping_num:%d"</span></span>, - __function_name, status, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> == <span class="hljs-built_in"><span class="hljs-built_in">response</span></span> ? (long)<span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>-&gt;errstat, mapping_num); + __function_name, status, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> == <span class="hljs-built_in"><span class="hljs-built_in">response</span></span> ? (STAT_ERROR == status ? (long) ss-&gt;s_snmp_errno : (long)<span class="hljs-number"><span class="hljs-number">-1</span></span>) : <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>-&gt;errstat, mapping_num); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (STAT_SUCCESS == status &amp;&amp; SNMP_ERR_NOERROR == <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>-&gt;errstat) {</code> </pre><br><br>  If the status is STAT_ERROR output ss-&gt; s_snmp_errno <br><br>  I threw the source of zabbiks into the local repository, quickly corrected the ebuild and forth. <br>  Compile, restart, wait. <br><br>  And here it is our real mistake. <br><pre> <code class="hljs css"> 11211<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:155253.362</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:18</span></span> 11210<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20141218</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:155253.393</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zbx_snmp_get_values</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp_synch_response</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">status</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errstat</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:-5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mapping_num</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:94</span></span></code> </pre><br><br>  Error -5 <br>  Enjoying Net-SNMP snmp_api.h <br><pre> <code class="hljs cs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SNMPERR_TOO_LONG (-5)</span></span></code> </pre><br><br>  Something similar was seen in the logs, but according to the phrase Too Long we could not find anything, let's see what kind of error it is and when it occurs. <br>  in snmp_api.c you can see it <br><div class="spoiler">  <b class="spoiler_title">some more code</b> <div class="spoiler_text"><pre> <code class="hljs php"><span class="hljs-comment"><span class="hljs-comment">/* * Make sure we don't send something that is bigger than the msgMaxSize * specified in the received PDU. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pdu-&gt;version == SNMP_VERSION_3 &amp;&amp; session-&gt;sndMsgMaxSize != <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; length &gt; session-&gt;sndMsgMaxSize) { DEBUGMSGTL((<span class="hljs-string"><span class="hljs-string">"sess_async_send"</span></span>, <span class="hljs-string"><span class="hljs-string">"length of packet (%lu) exceeds session maximum (%lu)\n"</span></span>, (unsigned long)length, (unsigned long)session-&gt;sndMsgMaxSize)); session-&gt;s_snmp_errno = SNMPERR_TOO_LONG; SNMP_FREE(pktbuf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* * Check that the underlying transport is capable of sending a packet as * large as length. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (transport-&gt;msgMaxSize != <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; length &gt; transport-&gt;msgMaxSize) { DEBUGMSGTL((<span class="hljs-string"><span class="hljs-string">"sess_async_send"</span></span>, <span class="hljs-string"><span class="hljs-string">"length of packet (%lu) exceeds transport maximum (%lu)\n"</span></span>, (unsigned long)length, (unsigned long)transport-&gt;msgMaxSize)); session-&gt;s_snmp_errno = SNMPERR_TOO_LONG; SNMP_FREE(pktbuf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br></div></div><br>  There are only two options: <br>  1. The length of the data we want to send is more than the msgMaxSize parameter defined in the received PDU <br>  2. The underlying transport is not able to send a packet of this length. <br><br>  There is a question how to fix this error.  It follows from the above that we need to look for whether we get msgMaxSize, whether we process it correctly, etc.  etc.  But I see the zabbix source for the first time, and C in the second (well, ok for the third). <br>  In short, it does not cause enthusiasm ... Yes, and perhaps you can break something. <br><br>  Lyrical digression: <br>  I must say that during the proceedings with this problem, I also stumbled upon the information about the SNMP mass processing.  Those.  zabbix can request multiple SNMP items in a single request. <br><br>  <a href="https://www.zabbix.com/documentation/2.2/manual/config/items/itemtypes/snmp">SNMP bulk processing details</a> <br><br>  The bottom line is that zabbix can query up to 128 values ‚Äã‚Äãin one request, but not all devices are able to process these 128 values ‚Äã‚Äãat once.  And zabbih uses the strategy of finding the maximum value for each specific device.  We by the way saw it in the logs.  Gradual increase mapping_num.  As soon as zabbix receives an error from the SNMPERR_TOO_BIG device, it, using a specific algorithm, searches for the maximum value that returns results without errors. <br><br>  What is it for me? <br>  The overflow error handling mechanism (let's call it this way) in zabbiks is, you just need to expand it for one more case. <br>  The algorithm itself is painted under the output of our error. <br><br><div class="spoiler">  <b class="spoiler_title">Again this code</b> <div class="spoiler_text"><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt; mapping_num &amp;&amp; ((STAT_SUCCESS == status &amp;&amp; SNMP_ERR_TOOBIG == <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>-&gt;errstat) || STAT_TIMEOUT == status)) { /* Since we are trying <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> obtain multiple values from the SNMP agent, the <span class="hljs-built_in"><span class="hljs-built_in">response</span></span> that it has <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> */ /* generate might be too big. It seems <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be required by the SNMP standard that <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> such cases the */ /* <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> status should be <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-string"><span class="hljs-string">"tooBig(1)"</span></span>. However, some devices simply <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> respond <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> such */ /* queries <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> we <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> a timeout. Moreover, some devices exhibit both behaviors - they either send */ /* <span class="hljs-string"><span class="hljs-string">"tooBig(1)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> respond at all. So what we <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> halve the number of variables <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> query - */ /* it should work <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the vast majority of cases, because, since we are <span class="hljs-built_in"><span class="hljs-built_in">now</span></span> querying <span class="hljs-string"><span class="hljs-string">"num"</span></span> values, */ /* we know that querying <span class="hljs-string"><span class="hljs-string">"num/2"</span></span> values succeeded previously. The <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> where it can still fail due */ /* <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> exceeded maximum <span class="hljs-built_in"><span class="hljs-built_in">response</span></span> size <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> we are <span class="hljs-built_in"><span class="hljs-built_in">now</span></span> querying values that are unusually large. So */ /* <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> querying <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> half the number of the last values does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> work either, we resort <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> querying */ /* values one by one, <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> configuration cache gives us items <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> query, it will give */ /* us less. */ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*min_fail &gt; mapping_num) *min_fail = mapping_num; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> == level) { /* halve the number of items */ <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> base; ret = zbx_snmp_get_values(ss, items, oids, results, errcodes, query_and_ignore_type, num / <span class="hljs-number"><span class="hljs-number">2</span></span>, level + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">error</span></span>, max_error_len, max_succeed, min_fail); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (SUCCEED != ret) <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; base = num / <span class="hljs-number"><span class="hljs-number">2</span></span>; ret = zbx_snmp_get_values(ss, items + base, oids + base, results + base, errcodes + base, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> == query_and_ignore_type ? <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> : query_and_ignore_type + base, num - base, level + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">error</span></span>, max_error_len, max_succeed, min_fail); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> == level) { /* resort <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> querying items one by one */ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; num; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (SUCCEED != errcodes[i]) continue; ret = zbx_snmp_get_values(ss, items + i, oids + i, results + i, errcodes + i, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> == query_and_ignore_type ? <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> : query_and_ignore_type + i, <span class="hljs-number"><span class="hljs-number">1</span></span>, level + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">error</span></span>, max_error_len, max_succeed, min_fail); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (SUCCEED != ret) <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; } } }</code> </pre><br></div></div><br>  That is, everything is simple, we need to add our condition without disrupting the existing ones.  For this we have all the data: <br><ul><li>  status must be STAT_ERROR </li><li>  ss-&gt; s_snmp_errno should be SNMPERR_TOO_LONG </li></ul><br>  We also take into account that we have two such places (as well as two outputs to the log file) and the resulting patch will be like this: <br><br><div class="spoiler">  <b class="spoiler_title">Finally</b> <div class="spoiler_text"><pre> <code class="hljs vbscript">diff -urN zabbix<span class="hljs-number"><span class="hljs-number">-2.2</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span>/src/zabbix_server/poller/checks_snmp.c zabbix<span class="hljs-number"><span class="hljs-number">-2.2</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>/src/zabbix_server/poller/checks_snmp.c --- zabbix<span class="hljs-number"><span class="hljs-number">-2.2</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span>/src/zabbix_server/poller/checks_snmp.c <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-07</span></span><span class="hljs-number"><span class="hljs-number">-17</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">49</span></span>:<span class="hljs-number"><span class="hljs-number">45.000000000</span></span> +<span class="hljs-number"><span class="hljs-number">0400</span></span> +++ zabbix<span class="hljs-number"><span class="hljs-number">-2.2</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>/src/zabbix_server/poller/checks_snmp.c <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">31.000000000</span></span> +<span class="hljs-number"><span class="hljs-number">0400</span></span> @@ <span class="hljs-number"><span class="hljs-number">-746</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span> +<span class="hljs-number"><span class="hljs-number">746</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span> @@ status = snmp_synch_response(ss, pdu, &amp;<span class="hljs-built_in"><span class="hljs-built_in">response</span></span>); zabbix_log(LOG_LEVEL_DEBUG, <span class="hljs-string"><span class="hljs-string">"%s() snmp_synch_response() status:%d errstat:%ld max_vars:%d"</span></span>, - __function_name, status, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> == <span class="hljs-built_in"><span class="hljs-built_in">response</span></span> ? (long)<span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>-&gt;errstat, max_vars); + __function_name, status, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> == <span class="hljs-built_in"><span class="hljs-built_in">response</span></span> ? (STAT_ERROR == status ? (long)ss-&gt;s_snmp_errno : (long)<span class="hljs-number"><span class="hljs-number">-1</span></span>) : <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>-&gt;errstat, max_vars); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt; max_vars &amp;&amp; - ((STAT_SUCCESS == status &amp;&amp; SNMP_ERR_TOOBIG == <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>-&gt;errstat) || STAT_TIMEOUT == status)) + ((STAT_SUCCESS == status &amp;&amp; SNMP_ERR_TOOBIG == <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>-&gt;errstat) || STAT_TIMEOUT == status || (STAT_ERROR == status &amp;&amp; SNMPERR_TOO_LONG == ss-&gt;s_snmp_errno))) { /* The logic of iteratively reducing <span class="hljs-built_in"><span class="hljs-built_in">request</span></span> size here <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> the same as <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> */ /* zbx_snmp_get_values(). Please refer <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the description there <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> explanation. */ @@ <span class="hljs-number"><span class="hljs-number">-938</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span> +<span class="hljs-number"><span class="hljs-number">938</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span> @@ status = snmp_synch_response(ss, pdu, &amp;<span class="hljs-built_in"><span class="hljs-built_in">response</span></span>); zabbix_log(LOG_LEVEL_DEBUG, <span class="hljs-string"><span class="hljs-string">"%s() snmp_synch_response() status:%d errstat:%ld mapping_num:%d"</span></span>, - __function_name, status, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> == <span class="hljs-built_in"><span class="hljs-built_in">response</span></span> ? (long)<span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>-&gt;errstat, mapping_num); + __function_name, status, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> == <span class="hljs-built_in"><span class="hljs-built_in">response</span></span> ? (STAT_ERROR == status ? (long) ss-&gt;s_snmp_errno : (long)<span class="hljs-number"><span class="hljs-number">-1</span></span>) : <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>-&gt;errstat, mapping_num); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (STAT_SUCCESS == status &amp;&amp; SNMP_ERR_NOERROR == <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>-&gt;errstat) { @@ <span class="hljs-number"><span class="hljs-number">-1001</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span> +<span class="hljs-number"><span class="hljs-number">1001</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span> @@ } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt; mapping_num &amp;&amp; - ((STAT_SUCCESS == status &amp;&amp; SNMP_ERR_TOOBIG == <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>-&gt;errstat) || STAT_TIMEOUT == status)) + ((STAT_SUCCESS == status &amp;&amp; SNMP_ERR_TOOBIG == <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>-&gt;errstat) || STAT_TIMEOUT == status || (STAT_ERROR == status &amp;&amp; SNMPERR_TOO_LONG == ss-&gt;s_snmp_errno))) { /* Since we are trying <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> obtain multiple values from the SNMP agent, the <span class="hljs-built_in"><span class="hljs-built_in">response</span></span> that it has <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> */ /* generate might be too big. It seems <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be required by the SNMP standard that <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> such cases the */</code> </pre><br></div></div><br>  Compile, restart ... <br><br>  And here is the result: <br><br><img src="https://habrastorage.org/files/ee2/d39/e13/ee2d39e134184baea2776f2178f0e61c.jpg" alt="image"><br><br>  Network Error Error disappeared from the logs. <br>  Hooray!.. <br><br><h4>  Afterword </h4><br>  Of course, in reality, the search for errors and solutions took more time.  I had to pick more sources and zabbix and net-snmp, in order to finally stop at two places in the code. <br>  But the feeling of victory over "inert matter" is priceless. <br><br>  * Desire rolled on October 7, and then 2.2.5 was still disguised.  By coincidence, it was unmasked on October 10; <br>  ** at the time, do not look, for writing the article imitated the situation later.  During the fights, the data was not pulled out of the logs at all; there was no time for the flow; <br>  *** yes, yes, I also modeled the picture.  Imagine that where there is green in the beginning, everything is red there;) And then I drank during restarts. <br><br>  <b>2014.12.31 UPD:</b> According to the results of the discussion of the article, a ticket was opened (thanx to <a href="https://habrahabr.ru/users/alexvl/" class="user_link">alexvl</a> ): <br>  <a href="https://support.zabbix.com/browse/ZBX-9163">SNMPv3 failure to send requests that are ‚ÄúToo long‚Äù is not handled properly by SNMP bulk</a> <br>  It has been successfully closed (thanx to Aleksandrs Saveljevs) since versions 2.2.9rc1, 2.4.4rc1, 2.5.0 </div><p>Source: <a href="https://habr.com/ru/post/240169/">https://habr.com/ru/post/240169/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../240149/index.html">Yii 2.0. Release</a></li>
<li><a href="../240151/index.html">From Ford T to 4G: a revolution in automotive technology</a></li>
<li><a href="../240155/index.html">Meeting on edcrunch</a></li>
<li><a href="../240161/index.html">Activate multisite support in a Wordpress installation on a VPS from Infobox in 5 minutes</a></li>
<li><a href="../240165/index.html">Introduction of modern DECT communication</a></li>
<li><a href="../240177/index.html">Ten trends that change modern data centers</a></li>
<li><a href="../240179/index.html">We invite you to the seminar "Practice of choosing solutions to protect against zero-day threats and targeted attacks"</a></li>
<li><a href="../240181/index.html">Yandex post office: how we made a service analyzing the results of mailings in realtime</a></li>
<li><a href="../240183/index.html">Small Hello World for a small microcontroller - at 24 bytes (and someone else's decision at 12 bytes)</a></li>
<li><a href="../240185/index.html">Empowering Tween Animations in NGUI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>