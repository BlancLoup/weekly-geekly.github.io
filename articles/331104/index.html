<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>This question must be addressed by the architect. Or not?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have some experience in the implementation of systems based on microservice architecture and I would like to share the questions (and answers) that ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>This question must be addressed by the architect. Or not?</h1><div class="post__text post__text-html js-mediator-article">  I have some experience in the implementation of systems based on microservice architecture and I would like to share the questions (and answers) that arise during the implementation of such projects.  Unfortunately, I do not have the right to spread about the projects in which I participated, so I invented my own spherical project in a vacuum.  In this project, we will meet many standard problems. <br><br>  I want to immediately note that the implementation will be rudimentary and only serves as a basis for asking questions.  In any case, I hope you will find in the article a couple of interesting thoughts and references. <br><br>  We will see how many interesting points can arise when writing all three classes and ask ourselves whether in this case the architect should decide or the developer can solve this problem himself. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/web/ec0/eff/85f/ec0eff85f4dd4381a9ab6076cefa05ef.jpg" alt="image"><br><a name="habracut"></a><br><h3>  <b>The main idea of ‚Äã‚Äãthe project</b> </h3><br>  So, imagine that a bright future has arrived and cars with autopilot are running briskly through cities and villages.  The question arises: do you need a personal car in such conditions? <br><br>  I offer you a different approach.  See, you go to my site, register, fill out the form.  The questionnaire will have something like this: I want every day from Monday to Friday at 8:15 am to leave the house (point A) to get into a Mercedes and get to work (point B).  Then in the evening at 18:00 to leave the office (point B) sit in the Audi and drive home (point A).  There you can still tick an item: I want to be able to leave work earlier, the car is ready to wait no more than 8 minutes. <br><br>  You can also call the car at any convenient time, the time of approach is not more than five minutes.  The only reservation for such cases, the car you will use no more than five hours a week.  This is for badly planned cases or, for example, for a trip to the store. <br><br>  For all the pleasure you will be asked 150 cu.  per month.  Sounds good, doesn't it? <br><br>  Naturally, under the hood, this service will have a lot of logic, since  there is a lot to consider.  For example, we must be competitive, i.e.  it is necessary to offer people a cheaper option.  To do this, you can provide joint trips.  We can see that the neighbor of our client, it turns out, is also going in the same direction, but 5 minutes later.  Can offer them a ride together, and offer a discount for it? <br><br>  Our service will give us a lot of data from which we can get a lot of interesting information: <br><br><ul><li>  who, where, when and with whom goes. </li><li>  who, where and how much time </li><li>  what, when, which models of cars breaks down </li><li>  who prefers what machines </li><li>  ... .. </li></ul><br>  Based on this information, we can draw useful conclusions.  For example, because  we know where and when our customers go, we can predict traffic jams and adjust the route in accordance with this so as not to fall into them. <br><br>  In order for this to be possible we need to provide for the possibility of collecting and analyzing information. <br><br>  In general, we are talking about a large and complex project that can be called the fashionable word ‚Äúcognitive solution‚Äù for a business with elements from the world of Internet of Things. <br><br><h3>  <b>Methodology of development and analysis of requirements</b> </h3><br>  Naturally, you first need to analyze all the requirements for the project, decide which methodology we apply (waterfall, rup, scrum, ...).  But in this case we will skip all these stages, since  almost all the questions raised in this article will arise in any case, regardless of the chosen methodology. <br><br><h3>  <b>Language, Framework, Architecture</b> </h3><br>  Initially, I am Java Developer, and therefore the implementation will be on java.  Do not blame me. <br><br>  By the way, the question immediately is whether the choice of a programming language is the task of the architect or is he "above it"? <br><br>  For those who think that there is no, that the programming language is secondary and, in general, only the command is important, I propose to conduct a small thought experiment.  Think about the language in which you would not exactly do such a project, i.e.  believe that this would be a uniquely wrong decision.  Now imagine that the architect decided to do the project in this language.  And when you are angry angrily, he will tell you: this is a minor issue, the main command! <br><br>  As it was said at the very beginning, we will do it on the basis of microservice architecture.  Someone will say that it would be more accurate to start with a monolith and we will agree with him, but we will start right away from microservices. <br><br>  And what framework we take?  If you google a little, it becomes clear that there are no special options, we will do it on the Spring Framework.  The reason is simple, Spring Cloud has everything we need. <br><br>  We will also have all sorts of API Gateways, Config Services, Message Brokers, Docker, Workflow, Rule Engine and many other abstruse words on trivia. <br><br><div class="spoiler">  <b class="spoiler_title">There are two main approaches to the design of microservice.</b> <div class="spoiler_text"><ul><li>  Domain Driven Design </li><li>  Functional driven </li></ul><br><br>  Domain Driven Design means defining domain objects and implementing all the necessary actions that your customer requires.  For example, a customer of some kind of pharmacy system says: I need to be able to bring a new medicine into the system, delete the old ones, but editing the already introduced medicine should be prohibited.  You make the ‚ÄúMedicine‚Äù class with all the required fields and implement the named functionality.  So you have <i>MedicineService</i> .  Those.  With this approach, the starting point is the domain objects. <br><br>  Functional Driven means that the necessary functionality is taken as a point of reference, and what kind of domain objects you will have to involve is a secondary matter. <br><br>  Personally, I always start with domain objects, and then check whether it is possible in this way to implement the necessary functionality.  If not, then I look, maybe you need to add another domain object to the service?  In theory, as soon as I had to do it, then it‚Äôs time to look towards the ‚Äúfunctional‚Äù approach. <br><br>  There are not many services with one domain object, you can immediately start with functionality, but it's easier for me. <br></div></div><br>  Let's define what services we need.  To do this, we will see which domain objects we really need, and then we will look at what services we push them. <br><br>  Let's start with the transport.  For example with <i>Car</i> .  Although just <i>Car</i> will not do.  I will explain.  For example, suddenly a person would be comfortable by car to the train station, transfer to the train, go to the city, and then ride the last two kilometers by bike?  After all, we also want to ask for money from this nice person?  And what if someone wants this very last mile on the mono-wheel?  Do not offend the same person, especially if he has money for it?  Let's rent him a monowheel!  So in the future we may need a lot of classes describing different vehicles. <br><br>  Let‚Äôs take the abstract <i>Vehicle</i> class as the starting point. <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vehicle</span></span></span><span class="hljs-class"> </span></span>{ ‚Ä¶. <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> String model; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> wheelNumber; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Date manufactureYear; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> EngineType engineType; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Producer producer; }</code> </pre> <br>  As we found out we will have a different <i>Vehicle</i> , let's do a couple: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Car</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vehicle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Car</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ wheelNumber = <span class="hljs-number"><span class="hljs-number">4</span></span>; } }</code> </pre> <br>  and one more for the poor but sporty: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bicycle</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vehicle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Bicycle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ wheelNumber = <span class="hljs-number"><span class="hljs-number">2</span></span>; } }</code> </pre> <br>  Wonderful.  Now we need the one for whom we all do this: our client, he is also a source of our income.  Call this entity Customer'om <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Customer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String firstName; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String lastName; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Date birthDay; }</code> </pre> <br>  We also need a contract with the client, which will indicate what kind of vehicle he will receive from us and how much money we will get for it. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Contract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> customerId; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> vehicleId; }</code> </pre> <br>  Total we have one class hierarchy with <i>Vehicle</i> on top, <i>Customer</i> and <i>Contract</i> .  I propose making them <i>VehicleService</i> , <i>ContractService</i> and <i>CustomerService</i> . <br><br><div class="spoiler">  <b class="spoiler_title">What does 'micro' in the word 'microservice' mean?</b> <div class="spoiler_text">  Previously, I was tormented by the question, but what does ‚Äúmicro‚Äù mean in the word ‚Äúmicroservice‚Äù?  In theory, this means "small."  But what does small mean? <br><br>  Often there is an opinion that microservice should be placed in the head of one person, or so that a team of three people and so on can do it.  This certainly makes sense, but I, as another option, offer a slightly different view on this question. <br><br>  When you implement, and it‚Äôs better, if you are still thinking of doing some kind of microservice, then ask yourself: if I am mistaken with this service, can I afford to throw it out and write a new one from absolute zero? <br><br>  If your answer is "yes", then this is microservice.  And if not, then no.  And what is important, ask yourself this question regularly as it is implemented.  If you suddenly have a no answer, start refactoring / crushing / rethinking this monster.  Although usually by this time all polymers are already &lt;.. censored ..&gt; <br></div></div><br>  You can look <a href="https://github.com/alexey-schroeder/Sharing">at the</a> rudimentary implementation of services <a href="https://github.com/alexey-schroeder/Sharing">here</a> . <br><br>  Now let's put the whole thing in a docker.  By the way, I was here recently at a meetup on the occasion of the fourth birthday of the docker.  An interesting <a href="http://training.play-with-docker.com/">link</a> was presented to us there, it was very bad in some places, I recommend to see <br><br>  To put our services in the docker, we need a plugin for mavena (see pom.xml docker-maven-plugin) and dockerfile. <br><br>  We will launch all services through docker-compose, for this, docker-compose.yml is in the root of the project. <br><br>  Pay attention to the .env file and its contents.  More on this file can be found in the <a href="https://docs.docker.com/compose/env-file/">documentation</a> .  Without this file, my Windows 7 machine failed to initialize MySQL. <br><br><h3>  <b>What did I do?</b> </h3><br>  Let's start with the pros: <br><br><ul><li>  this thing works. </li></ul><br>  Unfortunately, the advantages have ended <br><br>  Minuses: <br><br>  Unfortunately, there are a lot of them, so we‚Äôll only consider a couple of pieces selectively. <br><br>  Before I begin to understand the shortcomings, I want to mention one small, but extremely important point: the microservice architecture initially assumes that at least two instances of each service work in the system, which share the workload.  If this rule is not respected, then, in my opinion, talking about microservice architecture can be immediately stopped.  Yes, I know, this is debatable, but my opinion is exactly that. <br><br>  Unfortunately, redundancy does not guarantee 100% availability of services and therefore, if there is another reasonable way to maintain the system‚Äôs performance, then it can and should be used. <br><br><h4>  <b>Adding a new type of transport to the system</b> </h4><br><div class="spoiler">  <b class="spoiler_title">The class diagram is not an architecture.</b> <div class="spoiler_text">  I often hear the following statement: the class diagram is not an architecture.  It can be explained as follows: what and how is there in the module that is done does not interest me, what is important for me is what the modules do and how they communicate with each other.  As a rule, these are people who never worked as a programmer, but somehow immediately became architects.  What can I say to that?  Maybe they are really right, but my experience suggests otherwise.  And now we will consider just such a case. <br></div></div><br><br>  So, to begin with, let us ask ourselves, is the right approach to vehicle management solution we have applied?  I will clarify the question.  For example, we want to offer our customers a scooter rental. <br><br>  Now <i>VehicleService</i> looks like this. <br><br><img src="https://habrastorage.org/web/1aa/bd2/c9c/1aabd2c9cfe94efda54622e372512c24.png" alt="image"><br><br>  We need to add a new <i>Scooter</i> entity to the system.  We have everything built on inheritance, so the end result will look like this: <br><br><img src="https://habrastorage.org/web/b27/369/326/b27369326b824c4fbdab38828d517b27.png" alt="image"><br><br>  We will write a new <i>Scooter</i> class in <i>VehicleService</i> , test it, compile it, add it.  And if we have dozens of types of vehicles?  Every time we will write a new class, test, compile, etc.?  Is there another way? <br><br>  You can, for example, do so.  Make the <i>VehicleType</i> class. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VehicleType</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;VehicleProperty&gt; properties; ‚Ä¶. }</code> </pre> <br>  As you can see, <i>VehicleType</i> has a <i>VehicleProperty</i> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VehicleProperty</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> T value; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String description; ‚Ä¶.. }</code> </pre> <br>  Let's make another <i>Vehicle</i> class: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vehicle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> VehicleType vehicleType ; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;VehicleProperty&gt; customProperties; ‚Ä¶... }</code> </pre> <br>  Now, if we want to add a scooter to the system, we will first create a <i>VehicleType</i> "Scooter": <br><br><pre> <code class="java hljs">VehicleProperty wheelNumberProperty = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VehicleProperty&lt;Integer&gt;(<span class="hljs-string"><span class="hljs-string">"wheelNumber"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"number of wheels"</span></span>); ‚Ä¶‚Ä¶. VehicleType scooterType = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VehicleType(<span class="hljs-string"><span class="hljs-string">"Scooter"</span></span>); scooterType.addProperty( wheelNumberProperty); ‚Ä¶‚Ä¶..</code> </pre><br>  And if we need to create an instance of a scooter: <br><br><pre> <code class="java hljs">Vehicle scooter1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vehicle(scooterType); ‚Ä¶..</code> </pre> <br>  Thus, we can add as many new types to the system without creating new classes in <i>VehicleService</i> . <br><br><img src="https://habrastorage.org/web/4b3/c15/3f4/4b3c153f40c54f3d95b1fd373c12e76e.png" alt="image"><br><br>  Do you still remember the last lyrical digression about the class diagram and the question is whether it is the subject of architecture?  Here you have two class diagrams that describe two fundamentally different approaches to the implementation of the service.  Are they part of the architectural solution?  In my opinion, very much, because  in this case, the method of implementation even at the class level has far-reaching consequences and can turn the future life of the project into hell. <br><br><div class="spoiler">  <b class="spoiler_title">Hidden business case</b> <div class="spoiler_text">  In general, the question of changing something in the service requires special attention.  Let me explain by example. <br><br>  I had such a case.  At the rally I present our future architecture to the client.  Answered questions.  It seems everything is good, everyone likes everything, everyone is happy.  And here the main client IT specialist asks such a simple question: how quickly can you add a new field to the ‚ÄúABC‚Äù domain object?  A simple question, right?  I answered simply: add a field - 2 minutes, write tests from a few minutes to a couple of hours, then run all the tests (it can take hours), etc.  In general, I could not name any specific figure, and I think that no one can, as long as it has not been done at least once.  It seems like I answered correctly, but the feeling that the answer is incorrect did not leave me.  Then one day I realized how I had to answer. <br><br>  Today, my answer is: ‚ÄúHow often should this happen?‚Äù If this is an exceptional situation, then in principle it does not matter how long the addition of the field lasts, if only this period was adequate from a business point of view.  If this happens often, then the question should be asked: is this the Business case?  And if so, then this functionality should be initially laid into the system and then the answer should be: 20-30 minutes (this is a lie, of course, but it sounds good), it can take longer if the case is severe. <br><br>  Another question also arises: how is it that this business case has surfaced just now? <br>  And even more important question, are there any other similar business cases that we have missed? <br></div></div><br>  Next moment.  See if our <i>VehicleService</i> falls, then we can neither create a new copy of the bike in the system (for example, we purchased a new batch of bikes and want to add them to the system) or rent a bike.  Those.  Neither our clients nor our employees in the office can do anything.  It would be much better if, even in case of problems in the office, our clients could make orders and bring us money.  How can I do that?  It looks like we need to divide our <i>VehicleService</i> into two, one for customers and one for our employees. <br><br>  Remember, I talked about the domain and functional approach to the design of services.  The problem with the availability of the service for clients and our employees is an excellent example when we started with the domain approach, got into the problem and move on to the functional approach.  We need two services, the domain objects are basically the same, but the functionality is different. <br><br>  Suppose, again, our <i>VehicleService has</i> fallen.  This means that neither cars nor bicycles can be rented.  It would not be bad if the service for cars is not available, then the service for bikes would work further.  How can I do that?  <i>Split a VehicleService</i> into several services, one for each type of vehicle? <br><br>  In fact, the last two examples of possible problems are not entirely correct, because  they can be solved through redundancy, i.e.  Should work several instances of the service.  But, as I said at the beginning, no redundancy will give 100% availability.  That is why we must try to solve the issue of service availability in some other reasonable alternative way. <br><br>  There was a holiday on our street, a lot of clients came to us who wanted to rent a car from us.  The service does not cope, but this is not a problem, we will start another instance and everything is fine again.  But now we have two copies of the service, not only for cars, but also for bicycles.  Is it bad?  I do not know, but certainly not good.  It is quite possible that you can live with this, you have to look. <br><br>  After considering these problems, we can offer another option for implementing the service.  We will make a separate service for each type of transport.  But this question arises. <br>  Suppose you are a client, have visited the site and want to look at the list of all possible types of transport, i.e.  you want to see something like: <br><br><ul><li>  Car </li><li>  Bicycle </li><li>  Scooter </li><li>  Traktor </li><li>  ‚Ä¶‚Ä¶ </li></ul><br>  Where does this list come from?  Probably we need another service <i>VehicleTypesService</i> , which will know what types of vehicles exist in our system.  Where does he get this information from?  The first thing that comes to mind is to write with pens to the database.  If we provide another type of transport to services, then we write a service for it and do not forget to go to the <i>VehicleTypesService</i> and add one more line to it in the database. <br><br>  And can be different.  At the start, each service should knock to <i>VehicleTypesService</i> to inform it of its existence.  This solution seems to be looking good, but does not answer the question of what to do if we need not to add, but delete the view of the vehicle.  For example, after six months, we realized that nobody uses monowheels, we want to remove it from the system.  How do we do this? <br><br>  And here is another interesting question.  As you can see, <i>Vehicle</i> has an <i>EngineType</i> field. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vehicle</span></span></span><span class="hljs-class"> </span></span>{ ‚Ä¶... <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> EngineType engineType;</code> </pre><br>  In my rudimentary implementation, the EngineType has enums: <br><br><ul><li>  Gas </li><li>  Diesel </li><li>  Elektro </li></ul><br>  And now the actual question itself: how do we create a car with a hybrid power plant? <br><br>  <i>Will we</i> make <i>EngineType's</i> list instead of <i>EngineType</i> (and then 99% of the machines suddenly have a list with one element)? <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vehicle</span></span></span><span class="hljs-class"> </span></span>{ ‚Ä¶... <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> List&lt;EngineType&gt; engineTypes;</code> </pre><br>  Or maybe add a new type to enum, something like <i>Gibrid</i> ? <br><br>  Who in this case makes the decision and, accordingly, bears responsibility for it? <br><br>  Is it possible to say that this is a question of architecture or is this a too ‚Äúminor‚Äù question? <br><br>  Using the example of the <i>EngineType</i> field, <i>I</i> want to ask one more question: do we really need to know which engine is at the car?  After all, with a high degree of probability, our client doesn‚Äôt care at all, we pour diesel or gasoline into the tank.  But, for example, the ability to take a bicycle with you (i.e., a large trunk or whether there is a special fastener for a bicycle) can be very important. <br><br>  In fact, the type of engine is of course important, but not for the client, but for us, the company that provides this service.  One of the reasons is statistics (for example, for fuel costs or necessary repairs).  It will vary greatly for each type of engine.  This raises another question: shouldn't domain objects (or their representations) be different for our backend and frontend? <br><br>  How to answer questions of this kind?  I know only one way: you need to talk more often with people from the business, ask them what and where they want to see?  Unfortunately, they themselves often do not know the answers to these questions. <br><br><h4>  <b>Complex queries</b> </h4><br>  Suppose I want to see all clients with their contracts that live on Orange Street in the glorious city of Berlin.  Those.  I want to see something like this tablet: <br><table><tbody><tr><th>  Last Name, First Name </th><th>  Number of contract </th><th>  Date of signing the contract </th><th>  A machine </th></tr><tr><td>  Pupkin, Vasya </td><td>  12345 </td><td>  01.01.2017 </td><td>  Audi Q4 </td></tr><tr><td>  ...... </td><td>  ...... </td><td>  ...... </td><td>  ...... </td></tr></tbody></table><br>  As you can see, the table contains data from three microservices: <i>CustomerService</i> , <i>VehicleService</i> and <i>ContractService</i> .  How are we going to put them together?  In the case of a monolith, the question is solved by one request to the base, and what to do when we have three bases? <br><br><img src="https://habrastorage.org/web/197/055/9c9/1970559c90bb471eb721aa8da98a9fff.png" alt="image"><br><br>  There are different options for solving this small problem and next time we will discuss them. <br><br><div class="spoiler">  <b class="spoiler_title">Thanks, Cap!</b> <div class="spoiler_text">  And now a minute of attention.  When did you have to ask these questions?  Answer: Of course, before writing code.  And to answer these questions should including the architect. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">How does the decision making and reporting process to the team of programmers</b> <div class="spoiler_text">  And now a small ‚Äústream of consciousness‚Äù on the topic: how does the decision-making process and the reporting of these to the programmers team occur at all?  I know two theoretical possibilities, and everything else is just their mixes in various proportions: <br><br><ol><li>  Uncle comes and shows a presentation with all sorts of colors in the form of diagrams arched with tricky words.  Often he makes it clear that he has a lot of experience behind him, he understands what he is doing and so on, and therefore the decision has been made finally and irrevocably.  Hearing a murmur from a distant series, quickly declares that it is always open to new ideas. In fact, the architect here is a full-fledged dictator. </li><li>  The uncle comes, says that he is an ‚Äúartist‚Äù and sees the ‚Äúpicture‚Äù like this.  At the same time, he directly says that it is not he who will ‚Äúdraw‚Äù, but people in the ‚Äúhall‚Äù, and therefore it is in their vital interests to scold the picture and, if possible, offer alternatives.  In this case, the architect seeks to disclaim any responsibility. </li></ol><br>  Personally, I feel closer (again, closer, and not completely satisfied) with the second option.  There are probably dozens of reasons for this, consider some of them. <br><br>  I do not want to be responsible.  No seriously.  I, like any reasonable person, want to get a lot of money, do nothing and not be responsible for it.  But objective reality, unfortunately, shows that this is impossible.  Well, or I, at least, have not yet found the desired method. <br><br>  But for ‚Äúsharing with another responsibility‚Äù there is another reason and it is no less important.  When a programmer participates in a discussion (and thus indirectly in a decision), he implements it with a different level of diligence.  If a jamb suddenly comes out, he realizes that this is his fault, and not ‚Äúthis idiot architect invented garbage, but let me have it.‚Äù <br><br>  Another reason is incomplete knowledge of the system and its environment.  Imagine that after the presentation of the architecture you get the question: ‚Äúhow does this all fit in with the fact that we need to pull data from someone else‚Äôs billing system?‚Äù And then the architect suddenly finds out that it turns out there is a third-party system with which we need to integrate.  And everyone knows this, except the architect.  Yes, it happens too. <br><br>  It is important to explain why this decision was made, and not any other, what are the advantages and mention the disadvantages.  In this case, people understand what is happening, they become much more patient. <br><br>  True, it should be noted here that such a ‚Äúdemocracy‚Äù, when a decision is made by a bunch of people, has its limits.  Moreover, such a ‚Äúdemocratic‚Äù solution is not always possible.  For example, when everyone understands that each of the solutions discussed is bad, and no one knows the good.  In the end, if it suddenly turns out that the decision was wrong, the responsibility for this lies with the architect.  Rebuffed, they say, I asked everyone, it was a collective decision, unfortunately it will not work.  The architect is personally responsible for all decisions, regardless of how they were made. <br><br>  Lastly, two more thoughts. <br><br>  First of all, if you think that your architecture is good, it means that you have not shown it to anyone yet.  By the way, this also applies to the code. <br><br>  Secondly, I am a categorical supporter of the opinion that an architect should have practical programming experience so that he knows what it means to implement other people‚Äôs desires.  Even better, the architect is directly involved in the project, i.e.  writes code, or at least this same code revises.  The architect must regularly check that the code conforms to accepted architectural solutions. <br><br>  Once I missed this moment and only at the Sprint Review I learned absolutely by chance what the programmer did not do as he was told.  To the question: is it written in black in English, send ‚Äúevent‚Äù, why are you sending http request?  the answer was received: well, I thought that it would be better.  Naturally, it is impossible to control everything, you need to trust your team.  But as the Germans say, trust is good, but control is better. <br></div></div><br><h4>  <b>Change history</b> </h4><br>  Once someone clever wants to find out why customers cancel or not extend the contract and go to competitors?  Maybe the last time the car did not like / was late?  Or maybe a man traveled before with his colleague, who went over to our competitors and lured his companion to them? <br><br>  To answer such questions, we need to know what happened in the system, i.e.  we need a change history. <br><br>  How this can be done we will discuss in the next article. <br><br><h4>  <b>Infrastructure problems</b> </h4><br>  Microservice architecture imposes very specific requirements on the infrastructure of the entire application, namely, we need <br><br><ul><li>  single entry point, also known as API Gateway </li><li>  search for services, it‚Äôs also Service Discovery </li><li>  one configuration point, also known as Config Service </li><li>  central point of log collection and analysis </li><li>  monitoring </li><li>  ‚Ä¶‚Ä¶ </li></ul><br>  These and other questions in the next part. </div><p>Source: <a href="https://habr.com/ru/post/331104/">https://habr.com/ru/post/331104/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331092/index.html">Cricket Lee and Paul Vixie's Webinar on Network Security with DNS RPZ</a></li>
<li><a href="../331094/index.html">Security Week 24: 95 fixes from Microsoft, the router merges the data with LEDs, for MacOS there is a runner service</a></li>
<li><a href="../331096/index.html">Better to hear once than read seven times</a></li>
<li><a href="../331098/index.html">Create applications using Firebird, jOOQ and Spring MVC</a></li>
<li><a href="../331100/index.html">Casual C ++: isolating the C-style API</a></li>
<li><a href="../331114/index.html">A quick setup option for a wholesale company management system</a></li>
<li><a href="../331116/index.html">New plug-in for Sennheiser headsets and free upgrade to 3CX v15.5</a></li>
<li><a href="../331118/index.html">Catch data big and small! (Overview of Data Science courses from the Cognitive Class)</a></li>
<li><a href="../331120/index.html">How to write the most awful backend for a mobile application</a></li>
<li><a href="../331122/index.html">Android: dynamically load fragments from the network</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>