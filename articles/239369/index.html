<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dummy about Dummies and one exciting journey into the depths of Excel. Long-awaited RegExp in tables</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prologue, just prologue! 
 Of course, my article is not as cool as the story about game dev on VBA in ARIMI, but there are source codes located right ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dummy about Dummies and one exciting journey into the depths of Excel. Long-awaited RegExp in tables</h1><div class="post__text post__text-html js-mediator-article"><h4>  Prologue, just prologue! </h4><br>  Of course, my article is not as cool as the story about game dev on VBA in ARIMI, but there are source codes located right at the end of the article under the spoiler. <br><br><img src="https://habrastorage.org/files/9a4/768/bd8/9a4768bd84c642fbac6603d2917622c2.png"><br><br><h4>  Kryptonite for a teapot. </h4><br>  Meet me a kettle!  Actually, I'm really not very good at programming, but I feel particularly uncomfortable trying to create ‚Äúsomething‚Äù in a language I don't know.  In my story "Visual Basic for Applications" there is that language, which is unusual for me.  In fact, all this lyrical digression, nothing more than an attempt to understate your expectations. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      My story begins as a typical story of an office worker.  The only distinguishing feature is that I don‚Äôt have an office and I work at home (hell, no one is surprised by this).  But to everyone's happiness, I am as grumpy as the majority. <br><br>  Monday morning as always was disgusting.  Dissolving haze and barely noticeable breaking rain - an unpleasant sight.  The desire to work disappeared on Sunday.  As always, there is a lot of work, nothing is glued, and here also the Excel base of 300k lines fell into my hands.  Well, not something that fell, finished parsing.  And as you understand, a structured, formatted and homogeneous base didn‚Äôt smell there, otherwise how could the article come from.  So, at the exit, I received a huge amount of heterogeneous information, from which it was necessary to select the necessary information that I needed to work, cutting off everything else. <br><a name="habracut"></a><br><h4>  Kettle Exposure </h4><br>  Looking at that horror and chaos, I spent some time in a state of procrastination, mindlessly multiplying entropy.  By the way, I know excel quite badly, well, in a sense, I can fill the table with values ‚Äã‚Äã- and format the sheet too.  Even able to remove duplicates (even in 2007), but no more.  But, having come to himself a little and realizing that nothing was formed by itself, he began to look for a solution. <br><br>  Like any other sensible person, I turned for help to a special forum with a party of accountants and excel geeks.  I will not advertise the forums in which I asked for help, I will only note that out of 5 popular ones, only two agreed to help me.  Guys if you read this - thank you so much! <br><br>  In general, leaving my question, I began to look for a solution on my own. <br><br><h4>  Outline teapot </h4><br>  My tasks were very typical and simple.  The table contained the most necessary information: Name (along with the type of registration of the company), Phone (mobile and urban mixed), Address (rare dreb), Company website (here everything is surprisingly ok), email (unimportant info, but still for checkmarks - grabanul) and Branch / Rubric.  I needed to bring all this into proper form, for subsequent export to crm. <br><br>  Waiting for the long-awaited response, I began to put it into practice.  The bottom line is even worse.  Of course, I am exaggerating, but nevertheless that formula (by the way, hell, not formula), which was provided to me by one of the responsive forum users, turned out to be not entirely viable.  Of course, it performed its function, but it was all very dreary, long and terrible.  Realizing that formulas are not an option, I decided to write a macro. <br><br>  And ... Created another tearful topic on the above forum (black belt on forum-up).  In the old manner, I waited for an answer, and this time some not indifferent user wrote me a fairly tolerable macro suitable for my needs.  He was able to separate phones, as well as to separate the type of enterprise from the name (just to separate the columns by the last comma). <br><br>  The principle of its operation can not be simple.  On the basis of the dictionary, all extra characters were removed from the column with numbers using Replace: dashes, parentheses and commas.  Then the program went through the values ‚Äã‚Äãand separated those in which there is a designated operator code.  As a result, the Numbers * of course * were separated, but the formatting was broken and without that was not particularly aesthetic. <br><br>  And figs with him, but there was some understatement, incompleteness. <br><br><h4>  Kettle razor </h4><br>  Sitting in the evening in the chair and finishing his glass of bourbon ... Yeah, he sat and sawed another hack taken in freelance.  To my shame, I don‚Äôt remember what the essence was there (‚ÄúMore monotonous work is needed‚Äù (C) War3).  But the most important thing is that, applying RegExp to the e-mail verification field, it suddenly struck me, but what if ... Yes, after so many useless words, I finally came to the most important thing.  And what if you use regular expressions to juggle values ‚Äã‚Äãwithin a table? <br><br><img src="https://habrastorage.org/files/417/803/ca4/417803ca44a54f0eb0e5e0e8200c1b46.jpg"><br><br>  Scrolling through several foreign sites, nothing sensible was found.  Of course, there were macros that add functionality to form regeex, but this is not it.  Taking the formula macro code as a basis, I modified the source script and, surprisingly, it worked.  Eureka, I shouted and began to finish drinking <s>bourbon</s> . <br><br><h4>  Triumph kettle </h4><br>  The victory dance was interrupted by an error in the execution of my macro version 2.0.  By the way, I released major updates as often as turning around, to check if there is anyone behind my back.  Paranoia, you know. <br>  What am I talking about?  Oh yeah, it later turned out that the essence of the error was in the random variable in quotes and the wrong number of submatches.  Having fixed this defect, I began to finish the functionality specifically for my task.  After 2 hours I finished.  The final macro successfully formatted and separated the phone by operator code (differentiating by code as mobile, and the rest as urban ones), separated the company name and type of registration, and also separated the company‚Äôs city from the address and entered it into a separate column. <br><br>  Nothing special, you say?  And you will be absolutely right.  Most people who can work with excel at the ‚Äúadvanced user‚Äù level would do the same operation in 15 minutes using formulas and basic formatting functions.  But I was happy and decided to share this happiness with others. <br><br><img src="https://habrastorage.org/files/300/0fb/7a5/3000fb7a54c64313a73a895f7b6336bc.png"><br><br><h4>  The result, just the result! </h4><br>  At the bottom of the article I posted a detailed form code that allows other less advanced users, like me, to apply their own regular expressions to the data contained in the table.  In fact, my tweak (not exactly my course) can do the following: <br><br><img src="https://habrastorage.org/files/b76/f61/f5e/b76f61f5e0b24ab98f4dfc7d489cc62e.jpg"><br><br>  <b>Separate</b> - separates the values ‚Äã‚Äãfor a given mask into a new column, leaving the original column intact. <br>  Important note: due to lack of experience and knowledge, I did not manage to force the macro to create a new empty column to the right of the one being edited.  This means that the adjacent right column must be empty, otherwise the output \ final data will replace the original content. <br><br>  <b>Delete</b> - deletes values ‚Äã‚Äãby the specified mask.  It is noteworthy that I managed to get the macro to work in such a way that, provided the number of capture groups is more than 0 (from 1 to 3), only the surrounding information is deleted, and not the value that matches the mask in brackets. <br><br>  <b>Split</b> - splits the value into two groups.  Values ‚Äã‚Äãsuitable for RegExp are put into the new column, everything that does not match remains in the old one.  It also means that the adjacent right column must be empty. <br><br>  <b>TRUE / FALSE</b> - an additional tool for interacting with formulas.  When a mask matches, the values ‚Äã‚Äãin the adjacent column are TRUE; otherwise, FALSE. <br><br><h5>  Wishlist or additional options </h5><br>  <i>The number of capture groups</i> - the number of masks in brackets.  Example: \ d {3} \ s? (. *?), \ S (. *?) \.  - there are two of them. <br><br>  <i>Select column</i> - the name speaks for itself.  Select editable column. <br><br>  <i>Replace with \ add</i> - In case of deletion by mask, replaces the deleted values ‚Äã‚Äãwith the text entered by the user.  In the case of separation / separation - adds to the end of each value or group, the entered characters. <br><br>  <i>The result on a new sheet</i> is the result on a new sheet. <br><br><h4>  Winner epilogue </h4><br>  Forgive me for some pretentiousness and unusual habrastil.  Because of my innate inability to beautifully expose my thoughts to the text, as well as create an action, explaining the code, I decided that the article itself would describe the case better, and place well-commented code at the bottom of the article. <br><br><div class="spoiler">  <b class="spoiler_title">200 lines of terrible code</b> <div class="spoiler_text"><pre><code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> regexpmulti(S As Variant) <span class="hljs-comment"><span class="hljs-comment">'  '  Dim Sl As String, bRes As Boolean, RegExp As Object, oMatches As Object, n As Integer, P As String, Text As String, TextReplace As String Sl = "" ReDim x(1) As String bRes = False Set RegExp = CreateObject("VBScript.RegExp") '  RegExp.Global = True RegExp.IgnoreCase = False '    RegExp.Pattern = TextBox1.Text ' TextBox1.Text -    On Error Resume Next '         bRes = RegExp.test(S) If ComboBox1.Text = "" Then '  ,    p    P = 0 Else P = ComboBox1.Text End If If OptionButton2 Then '    " /" Text = "" TextReplace = TextBox2.Text Else Text = TextBox2.Text End If If bRes Then Set oMatches = RegExp.Execute(S) '  '       If P = 0 Or P &gt; 5 Then '     Sl Sl = oMatches(0) &amp; Text '     For n = 1 To oMatches.Count - 1 Sl = Sl &amp; oMatches(n) &amp; Text '    Next ElseIf P = 1 Then Sl = oMatches(0).subMatches(0) &amp; Text For n = 1 To oMatches.Count - 1 Sl = Sl &amp; oMatches(n).subMatches(0) &amp; Text Next ElseIf P = 2 Then Sl = oMatches(0).subMatches(0) &amp; oMatches(0).subMatches(1) &amp; Text For n = 1 To oMatches.Count - 1 Sl = Sl &amp; oMatches(n).subMatches(0) &amp; oMatches(n).subMatches(1) &amp; Text Next ElseIf P = 3 Then Sl = oMatches(0).subMatches(0) &amp; oMatches(0).subMatches(1) &amp; oMatches(0).subMatches(2) &amp; Text For n = 1 To oMatches.Count - 1 Sl = Sl &amp; oMatches(n).subMatches(0) &amp; oMatches(n).subMatches(1) &amp; oMatches(n).subMatches(2) &amp; Text Next End If If OptionButton2 Then '      S = RegExp.Replace(S, TextReplace) ' TextReplace -    End If End If Set RegExp = Nothing '   If OptionButton4 Then '   "/" '  If Sl &lt;&gt; x(0) Then x(0) = Sl: x(1) = "" regexpmulti = x Else x(0) = Sl: x(1) = "" regexpmulti = x End If Else x(0) = Sl: x(1) = S regexpmulti = x End If End Function Private Sub ComboBox1_DropButtonClick() ComboBox1.List = Array("0", "1", "2", "3") '     ComboBox1.style = fmStyleDropDownList '     End Sub Private Sub ComboBox2_DropButtonClick() ComboBox2.List = Array("A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z") ComboBox2.style = fmStyleDropDownList End Sub Private Sub CommandButton1_Click() '     On Error GoTo Error ' .       . '  Dim R, c Dim M(), RZ(), U(), S, P As String If ComboBox2.Text = "" Then '      S = "A" '     ,       A Else S = ComboBox2.Text End If P = S &amp; "1" &amp; ":" &amp; S '    "A1:A" M = ActiveSheet.Range(P &amp; ActiveSheet.Range(S &amp; Rows.Count).End(xlUp).Row).Value ' RZ -  ,    ,      . ReDim RZ(1 To UBound(M), 1 To UBound(M, 2) + 1) '    For R = 1 To UBound(M) If OptionButton3 Or OptionButton4 Then RZ(R, 1) = M(R, 1) '       End If c = regexpmulti(M(R, 1)) '    .  "M(R, 1)" -       If OptionButton2 Then '      -          If ComboBox1.Text &gt; 0 Then RZ(R, 1) = c(0) &amp; c(1) Else RZ(R, 1) = c(1) End If End If If OptionButton3 Then RZ(R, 2) = c(0) End If If OptionButton1 Then RZ(R, 1) = c(1) RZ(R, 2) = c(0) End If If OptionButton4 Then RZ(R, 2) = c(1) End If Next R If CheckBox1.Value = True Then '   ,      Worksheets.Add '    Range("A1").Resize(UBound(RZ), UBound(RZ, 2)) = RZ '     Else Range(S &amp; "1").Resize(UBound(RZ), UBound(RZ, 2)) = RZ End If ' \ \ Cells.Columns.AutoFit Cells.Rows.AutoFit GoTo Skip '      Error: '      MsgBox "       .   -  ", vbCritical, ",    =(" GoTo 111 '      (Unload Me)   ,      Skip: Unload Me 111: End Sub Private Sub Label2_Click() End Sub Private Sub OptionButton1_Click() Label2.ForeColor = &amp;H80000012 '   Label* Label3.ForeColor = &amp;H80000012 Label3.Caption = ":" '  Label* Label2.ControlTipText = "  -     .  - '\s?\d{3}( )\s'.        ,  - ." Label3.ControlTipText = "      ." '  ComboBox1.Enabled = True ComboBox1.BackColor = vbWindowBackground TextBox2.Enabled = True TextBox2.BackColor = vbWindowBackground End Sub Private Sub OptionButton2_Click() Label2.ForeColor = &amp;H80000012 Label3.ForeColor = &amp;HFF&amp; Label3.Caption = " :" Label2.ControlTipText = "  -     .  - '\s?\d{3}( )\s'.       0 -    ,   ." Label3.ControlTipText = "  ,   ." ComboBox1.Enabled = True ComboBox1.BackColor = vbWindowBackground TextBox2.Enabled = True TextBox2.BackColor = vbWindowBackground End Sub Private Sub OptionButton3_Click() Label3.ForeColor = &amp;H80000012 Label2.ForeColor = &amp;H80000012 Label3.Caption = ":" Label2.ControlTipText = "  -     .  - '\s?\d{3}( )\s'.        ,  - ." Label3.ControlTipText = "      ." ComboBox1.Enabled = True ComboBox1.BackColor = vbWindowBackground End Sub Private Sub OptionButton4_Click() Label3.ForeColor = &amp;H80000000 Label2.ForeColor = &amp;H80000000 Label2.ControlTipText = "   -  ." Label3.ControlTipText = "   -  ." ComboBox1.Enabled = False '  ComboBox ComboBox1.BackColor = vbButtonFace '   TextBox2.Enabled = False TextBox2.BackColor = vbButtonFace End Sub</span></span></code> </pre> <br></div></div><br>  <b>Link to working scripts</b> : <a href="http://rghost.ru/58353541">download</a> . <br><br><img src="https://habrastorage.org/files/841/dba/1e6/841dba1e6f804910bcfd5288a7104dfc.jpg"><br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/239369/">https://habr.com/ru/post/239369/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../239357/index.html">Reviewing resumes of female techies is more profitable than men</a></li>
<li><a href="../239359/index.html">Microsoft ActiveDirectory - update user passwords in external repositories</a></li>
<li><a href="../239361/index.html">DSL Application Development and Code Generation</a></li>
<li><a href="../239365/index.html">Spherical screens for UAV operators and remotely controlled vehicles</a></li>
<li><a href="../239367/index.html">Wal Commander - Far Manager replacement for OS X and Linux</a></li>
<li><a href="../239373/index.html">Pitfalls of responsive web design</a></li>
<li><a href="../239375/index.html">New solutions to the old problem</a></li>
<li><a href="../239377/index.html">The best gift is a book. We make a beautiful cover</a></li>
<li><a href="../239379/index.html">Study: internal threats in large companies turned out to be more dangerous than viruses</a></li>
<li><a href="../239381/index.html">Storage systems: how to choose?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>