<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Static code analysis in PHP: regular expressions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuing to develop the topic of static analysis, which is generally engaged in the search for any defects in the source code of programs, let's tou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Static code analysis in PHP: regular expressions</h1><div class="post__text post__text-html js-mediator-article">  Continuing to develop the topic of static analysis, which is generally engaged in the search for any defects in the source code of programs, let's touch on the validation of regular expressions. <br><br>  The topic of regular expressions for PHP is pretty ticklish (about how to manipulate arrays), so I‚Äôll briefly remind you of what we are dealing with. <br><br>  Regular expressions are used to analyze and process text, such as checking the correctness of an email address or phone number.  Despite their flexibility, it is difficult for a person to perceive regular expressions ‚Äî you can easily make a mistake in describing a pattern and choosing modifiers.  Often there is the use of regular expressions where you can get by with simple string functions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, let's take a look at the example of many familiar ZF2 and Symfony2, which of the mentioned problems can be found using static analysis. <br><a name="habracut"></a><br><h2>  Instruments </h2><br>  <a href="https://www.jetbrains.com/phpstorm/">PhpStorm</a> and the <a href="https://plugins.jetbrains.com/plugin/7622%3Fpr%3DphpStorm">Php Inspections</a> static code analyzer <a href="https://plugins.jetbrains.com/plugin/7622%3Fpr%3DphpStorm">(EA Extended)</a> , which is installed as an extension (plugin), were used as tools. <br><br>  Php Inspections (EA Extended) contains a large set of rules, divided into groups.  If you have not used this plugin yet, then the first thing to do is to analyze the entire project.  The second is to customize the Code Style inspections (Settings -&gt; Editor -&gt; Inspections -&gt; PHP -&gt; Php Inspections (EA Extended)) in order to focus on other messages. <br><br>  And, of course, you should not blindly believe analyzers: the semantics of projects is not a trivial thing.  Make sure that the code is covered with tests before making changes - working with static analyzers requires some safety precautions. <br><br><h1>  Defect examples </h1><br>  Basically, minor bugs and only one mistake were found.  This is not surprising, since both frameworks are well optimized and tested: it is very difficult to find something serious. <br><br><h2>  ZF2 </h2><br><blockquote>  Warning: 'str_replace ("-", ...)' can be used instead </blockquote><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> preg_replace(<span class="hljs-string"><span class="hljs-string">'#-#'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;separator, $value); <span class="hljs-comment"><span class="hljs-comment">/* *     , * ..       . * * return str_replace('-', $this-&gt;separator, $value); */</span></span></code> </pre> <br><blockquote>  Warning: '0 === strpos ("...", "get")' can be used instead </blockquote><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (preg_match(<span class="hljs-string"><span class="hljs-string">'/^get/'</span></span>, $method)) { ... } <span class="hljs-comment"><span class="hljs-comment">/* * ,   ,  *        . * * if (0 === strpos($method, 'get')) { * ... * } */</span></span></code> </pre><br><blockquote>  Warning: '[0-9]' can be replaced with '\ d' (safe in non-unicode mode) </blockquote><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!preg_match(<span class="hljs-string"><span class="hljs-string">'/^([0-9]{1,3}\.){3}[0-9]{1,3}$/'</span></span>, $host)) { ... } <span class="hljs-comment"><span class="hljs-comment">/* *             /u *  /u     -, ,  . * * if (!preg_match('/^(\d{1,3}\.){3}\d{1,3}$/', $host)) { * ... * } */</span></span></code> </pre><br><blockquote>  Warning: '[^ \ s]' can be replaced with '\ S' (as options: \ D, \ W) </blockquote><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($property-&gt;isPublic() &amp;&amp; preg_match_all(<span class="hljs-string"><span class="hljs-string">'/@var\s+([^\s]+)/m'</span></span>, $property-&gt;getDocComment(), $matches)) { ... } <span class="hljs-comment"><span class="hljs-comment">/* *   \S   ,  , ,    . */</span></span></code> </pre><br><blockquote>  Warning: 'i' modifier is ambiguous here (no az in given pattern) </blockquote><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (preg_match(<span class="hljs-string"><span class="hljs-string">'/([^.]{2,10})$/iu'</span></span>, end($domainParts), $matches) || (array_key_exists(end($domainParts), <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;validIdns))) { ... } <span class="hljs-comment"><span class="hljs-comment">/* * /i , ..     . */</span></span></code> </pre><br><br><h2>  Symfony2 </h2><br><blockquote>  Warning: 'false! == strpos ("...", "file")' can be used instead </blockquote><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> preg_match(<span class="hljs-string"><span class="hljs-string">'/file/'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getFilename()); <span class="hljs-comment"><span class="hljs-comment">/* *     , * ..       . * * return false !== strpos($this-&gt;getFilename(), 'file'); */</span></span></code> </pre><br><blockquote>  Warning: '[^ A-Za-z0-9_]' can be replaced with '\ W' (safe in non-unicode mode) </blockquote><br><pre> <code class="php hljs"> $gotoname = <span class="hljs-string"><span class="hljs-string">'not_'</span></span>.preg_replace(<span class="hljs-string"><span class="hljs-string">'/[^A-Za-z0-9_]/'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, $name); <span class="hljs-comment"><span class="hljs-comment">/* *   \W   ,  , ,    . */</span></span></code> </pre><br><blockquote>  Warning: '[a-zA-Z0-9_]' can be replaced with '\ w' (safe in non-unicode mode) </blockquote><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> === $name || <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> === $name || preg_match(<span class="hljs-string"><span class="hljs-string">'/^[a-zA-Z0-9_][a-zA-Z0-9_\-:]*$/D'</span></span>, $name); <span class="hljs-comment"><span class="hljs-comment">/* *   \w   ,  , ,    . */</span></span></code> </pre><br><blockquote>  Warning: Probably / s modifier is missing (nested tags are not recognized) </blockquote><br><pre> <code class="php hljs"> $content = preg_replace(<span class="hljs-string"><span class="hljs-string">'#&lt;esi\:remove&gt;.*?&lt;/esi\:remove&gt;#'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, $content); <span class="hljs-comment"><span class="hljs-comment">/* *     :       . *    /s */</span></span></code> </pre><br><br><h1>  Instead of conclusion </h1><br>  First, I want to emphasize that static analyzers are a tool like, say, XDebug.  For example, with Php Inspections (EA Extended), the analysis of possible errors occurs in the process of writing code.  The cost of this ‚Äúimplementation‚Äù is zero, and the complexity of peer review and training of colleagues is markedly reduced. <br><br>  Secondly, I want to thank <a href="https://bitbucket.org/dryabov">Denis Ryabov</a> , who proposed the idea and worked out the specification for the analysis of regular expressions in Php Inspections (EA Extended), thank him very much for that. </div><p>Source: <a href="https://habr.com/ru/post/260185/">https://habr.com/ru/post/260185/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260169/index.html">Understanding the Web Interface Architecture</a></li>
<li><a href="../260173/index.html">LiveReload - javascript update without full page reload (for example, mithril)</a></li>
<li><a href="../260179/index.html">Detailed App Store Optimization Guide for 2015 - Part 1: Apple App Store</a></li>
<li><a href="../260181/index.html">PushAll can send notifications to the Chrome browser without installing applications and add-ons</a></li>
<li><a href="../260183/index.html">Implementing Single Sign On in a Symfony2 Application</a></li>
<li><a href="../260187/index.html">Emulation of 1-wire slave devices on MSP430</a></li>
<li><a href="../260191/index.html">Apple plans to integrate its data centers using high-speed network</a></li>
<li><a href="../260193/index.html">Fun starts 2: for_each vs accumulate</a></li>
<li><a href="../260197/index.html">Elvish programming language</a></li>
<li><a href="../260201/index.html">Upgrade to Middle PHP developer in 3 months</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>