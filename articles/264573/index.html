<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How not to build networks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 
 In fact, I never thought that I would write an article about such trivial things, but for the fifth time I come across a disregard for the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How not to build networks</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/d44/dc6/667/d44dc6667be5f4f3c8c5dbb8716a8a67.jpg" alt="image"><br><br>  Good day. <br>  In fact, I never thought that I would write an article about such trivial things, but for the fifth time I come across a disregard for the simplest rules for building networks.  If we were talking about some small desks, but this is the case with large providers, banks and government offices, whose names I will not disclose for some reason. <br><a name="habracut"></a><br>  At once I will make a reservation that everything written below is purely my opinion, which I do <b>not impose on</b> anyone.  I would also say that we are talking mainly about ip networks, where are we without ip in the modern world? <br>  Actually, all the problems of any organization involved in communication networks can be divided into several groups: <br><ul><li>  Physical structure of SCS </li><li>  The logical structure of the SCS </li><li>  Monitoring </li><li>  Access control, security and remote access </li><li>  Application processing system </li><li>  Backup system </li></ul><br>  It would seem that all this is so clear, known and chewed, and there is no need to say, however, the reality is more severe. <br><br>  Let's start with item number one - <b>Physical structure of SCS</b> <br>  In order not to go far for an example, right now I am seeing a picture of how ruthless road workers cripple optics, which were lying on the ground and were not suspended for several months for reasons I do not understand.  The most interesting thing in this situation is that the optics are working ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But back to the more mundane things - data center, server, NOC, etc. <br><br>  I changed the order of five jobs, from large providers and state offices to banks and everywhere, in every place it was like in the picture in the cap.  The only thing in one major provider was several exemplary nodes, which drove the authorities.  With the rest of the nodes it was all sad. <br><br>  I think we should not talk about the need to buy organizers, carefully lay the wires, stick stickers, do not leave kilometer "snot", keep a cross magazine.  These simplest manipulations will not turn into this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/661/384/7cf/6613847cf0683c4fd811a2e5a905fab4.jpg" alt="image"><br><br>  In it: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3d8/600/e18/3d8600e18c81bef9f0854a3a1613c5a2.jpg" alt="image"><br><br>  I remember, with my colleagues, I somehow put things in order in such "snot", but since we had access not only to the node, a month later the cobweb grew again.  The main problem of such "snot" is that all tasks are set with the term "yesterday", installers do not really care about "beauty" and throw wires at random, and because of the lack of control who and what threw, it is impossible to apply punitive measures and the hellish web grows.  If everything is not so bad with the schemes of laying and unwinding of optical cables, then everything is sad with the circuits inside the rooms. <br><br>  Also, it is worth periodically blowing dust on the communication centers, this is better, about half of my employers have been doing this.  But, he was a real witness of how dust stalactites hung from routers. <br><br>  My most "sore" point is the <b>logical structure of the SCS</b> . <br>  I will speak with you not as an abstract narrator, but as a person who has served a rather big network with static routing, lack of an address plan and complete anarchy for more than a year.  All arguments on the need to introduce dynamic routing were broken against the phrase - ‚Äúthe most reliable statics‚Äù. <br><br>  Of course, in some small local area network static is quite appropriate, but when the geography of your network grows beyond the borders of your cozy office, it's time to give up on static. <br><br>  Although there is another sad example when there was a network with IGP - OSPF, with several hundred routers in one AREA.  The person simply did not suspect that it is necessary to break the network into zones, not to mention the fact that there are zones of different types.  Any questions had an answer - ‚Äúit still works.‚Äù <br><br>  <i>Descript was</i> invented for a reason, sign ports, vlan, subinterfaces, vlan interface - write everything.  Since the person who comes after you or to help you, you don‚Äôt want to study the kilometers of arp and mac tables, walk through a dozen switches and routers to understand how everything works.  Also, specify the bandwidth, even if it is not taken into account in calculating the cost of the route, you can always find out the bandwidth, besides, it will be useful for monitoring (see below). <br><br>  Draw schemes!  I did not have normal circuits at any place of work, let alone separate L2 / L3 circuits.  But then, in every enterprise there is the most ‚Äúvaluable‚Äù worker, who is valuable in that he remembers how we connected this damned channel.  When asked to provide a scheme, at best, an ancient volume is extracted from the safe, which shows a small cloud with two lines. <br><br>  There is another example, when the operator sent me the circuit on the channel, where all the devices were drawn in the form of squares, the circuit was completely unreadable.  Icons for router, switch, satellite, etc.  invented for a reason, draw readable diagrams, gentlemen! <br><br>  Targeted plan - this is what should be a priori at the stage of the origin of the network.  But in reality it happens that he either simply does not exist, or he is ‚Äúbitten‚Äù by pieces from different ranges, sometimes even with intersections.  In combination with L3 statics, a loop is guaranteed to you and not one. <br><br>  In addition to the address plan, it would be nice to keep a sign with vlan'mi, and even better to raise QinQ, especially if you are a provider, and provide communication services, since vlan tend to run out and overlap. <br><br>  Also, there is such a thing as web design.  Saving on it leads to sad consequences.  There is one well-known large operator, which provides IP-TV service, due to the fact that the multicast runs in one vlan, and ADSL is used as the last mile, incorrect settings of vpi, vci on the subscriber's modem lead to the emergence of L2 loops, television is strewing, Internet It works badly, all subscribers suffer. <br><br>  Another very sensitive topic is vlan1.  Why, why do they continue to use it for control, sometimes even for data transmission and to be surprised with L2 loops?  Why can not choose another vlan and make it native?  It is especially ‚Äúpleasant‚Äù to look for a loop when there is an unmanaged switch on access. <br><br>  Next on the agenda - <b>Monitoring</b> <br>  For some reason, many small providers prefer to respond to problems solely by calling from subscribers.  For larger ones, at best, all monitoring is based only on <i>icmp</i> . <br><br>  There are a lot of excellent open monitoring systems: Zabbix, Cacti, Dude, etc.  Also, being a bunch of paid.  I think it is not necessary to say how important monitoring is, that besides <i>icmp</i> , there is also <i>snmp</i> . <br><br>  However, I still came across an employer who claimed that he had excellent monitoring of Zabbix, which monitors absolutely everything.  In fact, the person who set it up did not bother to read the documentation, the pullers were overloaded, respectively, the data was lost, little data was collected, all the data on the nodes were entered manually.  MySQL configuration was standard. <br><br>  Now this monitoring is brought into divine form, <i>LLD</i> (low-level detection) is configured, which automatically adds and removes interfaces, tunnels, modules, fans, power supplies, etc.  The information in the signature of the graphs is taken from <i>descript</i> , the speed of the interfaces is taken from the bandwitch, that's why you need to update this information.  The only thing that, as for me, is done in Zabbix is ‚Äã‚Äãbad - housekeeping - for large installations, partitioning is necessary. <br><br>  Collect syslog from hardware, not from everything, but at least from critical nodes.  It is possible to do this through Zabbix, but it seems to me that the decision will be too ‚Äúheavy‚Äù (there is a corresponding article on the Zabbix blog). <br><br>  Deploy several NetFlow collectors, install some analyzer and you will always see who and what is overloading your channels.  If there is any billing, you can use it. <br><br>  Not the least important point - <b>Access control, security and remote access</b> <br>  As a rule, at the word AAA, I heard only - "what is it"?  - or - "but I know - this is a battery"!  Therefore, either one local account is used for all, or each has its own.  In any case, when an employee leaves, especially when he doesn‚Äôt gorge himself, everyone starts running around with bulging eyes, looking for where else he is registered.  I have an article about how to deploy Tacacs +, believe that it will make your life much easier.  In addition, in the logs you will see who did what with the equipment. <br><br>  Some use RADIUS, invents something else.  I personally like Tacaca +, almost all modern equipment supports this protocol. <br><br>  Also set the ACL for access, at least on the equipment that has "white" addresses, as our narrow-eyed friends are not asleep. <br><br>  Do not release control out, that is - ssh, telnet, rdp and so on.  If you are already releasing, set at least the firewall on certain ip.  Personally, I always opened openvpn for access, generating an individual key for each employee. <br>  In order not to go far for examples, at the current place of work I have a network on Cisco equipment, with a bunch of local accounts and different passwords for the privileged mode, which of course no one remembers.  By superhuman will power, Tacacs + was deployed on this network - two servers with redundancy, geographically separated, synchronized.  But despite this, with the setup of new equipment continue to set up a million local accounts, instead of one.  To the assertion that local records do not work when Tacacs + is running, the answer is ‚Äúlocal accounts are reliable, but what happens?‚Äù <br><br>  Also, when I launched Tacacs +, I saw a bunch of entries in the authorization logs - attempts to log in as ‚Äúroot‚Äù, ‚Äúguest‚Äù, etc.  from our Chinese friends.  On the question of the ACL access got round eyes.  By the way, now it was about a large bank ... <br><br>  Actually, I did not think to include the <b>application processing system</b> in the list, but there was a case that in the state office dealing with telecommunications services, which has several thousand subscribers, applications were received by phone, printed and delivered to the performer, drum roll, fax!  But in general, in this regard, everything is fine, except that the ‚Äúusability‚Äù of all the systems with which I had to work at zero. <br><br>  We go further - <b>System backups</b> <br>  I think it is not necessary to explain that the equipment can fail from a voltage surge, fire, flood, cleaning woman and other natural disasters.  To quickly replace it, we need its configuration.  I witnessed how a person ‚Äúgave up‚Äù from memory the configuration of a burned-out router, simultaneously smoking smoke from the ears and other parts of the body.  I do not urge to raise something global, for example Rancid + SVN (as suggested by Mr. <a href="http://habrahabr.ru/users/evilmause/" class="user_link">EvilMause</a> , Rancid can be forced to make backups from the equipment of any vendors).  But to write the simplest script in bash or in another language that will run through routers, you can give everyone the command to copy the configuration file to ftp / tftp and sort into folders, and Tacacs + will allow you to create an account with limited rights. <br><br>  By the way, Cisco equipment supports changing and copying configuration over snmp in the case of the RW community, but the community must be tied to an ACL, otherwise ... Especially if it is snmp 1 or v2c.  In the same bank, a lot of where the RW snmp community was configured without being tied to an ACL, and the community was no more difficult than ‚Äúpublic‚Äù.  But one day, as legends say, a certain ‚Äúhacker‚Äù penetrated the bank‚Äôs network and turned off ip routing.  How did he do it ?! <br><br>  For servers, you can use something like Bacula, if you‚Äôre really lazy and a server without a RAID controller, use at least SoftRAID 1, for example Linux mdad, but not the built-in FakeRAID.  There will be at least some data backup.  And best of all, since we live in an age of modern technology, use virtualization.  However, just with the server part, most operators are not so bad.  But, with backups trouble.  In banks, this is much better, since all the work is tied to the AU. <br><br>  <b>Summarize</b> <br>  The conversation was only about the ip network, if you look in the direction of satellite networks SCPS - suffer from the "interference" of an unidentified source.  In VSAT, time slots are miraculously ended.  I personally witnessed how well a person set up HUB iDirect.  In this model, there are two Protocol Processors that can balance the load among themselves, respectively, we need dynamics, the only protocol that this system supports is RIPv2.  But a bunch of router - Protocol Processor, this person made a static, wrapping everything on one Protocol Processor, without even bothering to make a route to the second, with a larger metric.  Accordingly, half of the modems did not work for an "inexplicable" reason, and in the case of a load transfer to the second Protocol Processor, everything did not work.  Or a designer who tried to assure everyone that the calculation was correct and he does not understand why the antenna is precisely aligned to the pole alone standing in the field (a real case, by the way).  Fortunately, I have never touched PDH and SDH, although apparently, things are a little more fun there.  I can‚Äôt talk about telephony, I have never worked with it. <br><br>  It would seem that these are all such obvious things that we should not even talk about, but ... But we have what we have.  Perhaps in other regions the situation is radically different, but hard to believe. <br><br>  It seems to me that all this happens for the following reasons: <br><ul><li>  Commercial companies are focused primarily on the needs of the business and rightly so, but the ‚Äúhigh‚Äù executives are focused not on the good of the company, but on the personal good.  In consequence of that - unrealistic deadlines for tasks, lack of payment for processing, and then search for the guilty.  In the state to delete the words "business" and "commerce". </li><li>  In consequence of the first, a certain attitude of the workers to their work is formed. </li><li>  Desire will save on personnel, instead of a staff of competent specialists to hire one and ten yesterday students or humanities scholars who have not taken anywhere else. </li><li>  Lack of competent local managers who would act as a stratum between technical specialists and directors.  As a rule, managers are either not competent and everything falls on the shoulders of subordinates, or they have long been beaten for everything. </li><li>  The desire to save or "drank" money on purchases.  This leads to the fact that equipment is purchased that is completely unable to cope with the duties assigned to it, incompatible, or simply not necessary. <br></li><br><br>  To those who have had the patience to finish reading this stream of consciousness to the end, it may seem like I just whine, and I would agree with you, but after the fifth time the same problems, it's hard to hold back. <br><br>  Let me remind you once again that all that is stated in the article is purely my opinion and is based on personal experience.  This is written with the hope that someone will not make such mistakes. <br><br>  Thank. </ul></div><p>Source: <a href="https://habr.com/ru/post/264573/">https://habr.com/ru/post/264573/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264561/index.html">An example of working with iBeacon technology using Swift</a></li>
<li><a href="../264565/index.html">Crowdsourcing map service for works of art</a></li>
<li><a href="../264567/index.html">Cthulhi in the bank: how we solved ICFPC 2015</a></li>
<li><a href="../264569/index.html">BEMIT: The next step in the development of BEM according to Harry Roberts</a></li>
<li><a href="../264571/index.html">Incremental update backup as DBMS backup strategy</a></li>
<li><a href="../264575/index.html">I have no idea what the hell I'm doing</a></li>
<li><a href="../264577/index.html">Game Development with Unity and Intel RealSense 3D Cameras</a></li>
<li><a href="../264579/index.html">SQL Insert Injection in one online store</a></li>
<li><a href="../264581/index.html">Untouchable oracle</a></li>
<li><a href="../264583/index.html">Lightweight module for HTTP requests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>