<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Training course. Creating a complex data model for an ASP.NET MVC application, part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is an extension of a series of articles devoted to developing with the Entity Framework and ASP.NET MVC 3. You can find the first chapters at the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Training course. Creating a complex data model for an ASP.NET MVC application, part 2</h1><div class="post__text post__text-html js-mediator-article">  This is an extension of a series of articles devoted to developing with the Entity Framework and ASP.NET MVC 3. You can find the first chapters at the following links: <br><ul><li>  <a href="http://blogs.msdn.com/b/vyunev/archive/2011/10/04/entity-framework-asp-net-mvc.aspx">Creating the Entity Framework data model for an ASP.NET MVC application</a> </li><li>  <a href="http://blogs.msdn.com/b/vyunev/archive/2011/10/05/crud-entity-framework-asp-net-mvc.aspx">Implement basic CRUD functionality with the Entity Framework in an ASP.NET MVC application</a> . </li><li>  <a href="http://blogs.msdn.com/b/vyunev/archive/2011/10/06/entity-framework-asp-net-mvc-part4.aspx">Sorting, filtering and paging with the Entity Framework in an ASP.NET MVC application</a> </li><li>  <a href="http://blogs.msdn.com/b/vyunev/archive/2011/10/07/asp-net-mvc-p6.aspx">Creating a complex data model for an ASP.NET MVC application</a> </li></ul>  In previous lessons you learned how to work with a simple data model consisting of three entities.  In this lesson you will add a few entities and links between them and learn how to work with annotations to manage classes of models. <br><br><h4>  Changes to Entity Course </h4><br> <a href=""><img title="image42" alt="image42" src="https://habrastorage.org/getpro/habr/post_images/8b4/fa6/4a4/8b4fa64a4257a3823f0f3a621b0d5f5d.png" width="282" height="237"></a> <a name="habracut"></a><br><br>  In <i>Models</i> <i>\</i> <i>Course</i> <i>.</i>  <i>cs</i> replace the previously created code with: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ComponentModel.DataAnnotations; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ContosoUniversity.Models</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Course</span></span> { [DatabaseGenerated(DatabaseGeneratedOption.None)] [Display(Name = <span class="hljs-string"><span class="hljs-string">"Number"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CourseID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Title is required."</span></span>)] [MaxLength(<span class="hljs-number"><span class="hljs-number">50</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Title { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Number of credits is required."</span></span>)] [Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,ErrorMessage=<span class="hljs-string"><span class="hljs-string">"Number of credits must be between 0 and 5."</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Credits { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">"Department"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> DepartmentID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Department Department { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ICollection&lt;Enrollment&gt; Enrollments { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ICollection&lt;Instructor&gt; Instructors { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre> <br><h5>  DatabaseGenerated attribute </h5><br>  The DatabaseGenerated attribute with the None parameter specified for the CourseID property determines that the primary key value is set by the user and not generated by the database. <br><br><pre> <code class="hljs pgsql">[DatabaseGenerated(DatabaseGeneratedOption.<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>)] [Display(<span class="hljs-type"><span class="hljs-type">Name</span></span> = "Number")] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> CourseID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br>  By default, the Entity Framework assumes the auto-generation of primary keys by the database, which is necessary in most situations.  However, for the Course entity, numerical user-defined values ‚Äã‚Äãare used, such as 1000 for one department, 2000 for another, and so on. <br><br><h5>  Foreign Key and Navigation Properties </h5><br>  Properties-foreign keys and navigation properties in essence Course reflect the following connections: <br>  The course is associated with one faculty, thus, there is a foreign key DepartmentID and Department navigation property: <br><br>  public int DepartmentID {get;  set;  } <br>  public virtual Department Department {get;  set;  } <br><br>  An unlimited number of students can attend a course, so there is an Enrollments navigation property: <br><br>  public virtual ICollection Enrollments {get;  set;  } <br><br>  The course can be taught by various teachers, therefore the Instructors navigation property is available: <br><br>  public virtual ICollection &lt;Instructor&gt; Instructors {get;  set;  } <br><br><h4>  Creating an entity Department </h4><br> <a href=""><img title="image47" alt="image47" src="https://habrastorage.org/getpro/habr/post_images/077/c87/95a/077c8795ae51b4351e087d399f452928.png" width="239" height="236"></a> <br><br>  Create <i>Models</i> <i>\</i> <i>Department</i> <i>.</i>  <i>cs</i> with the following code: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ComponentModel.DataAnnotations; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ContosoUniversity.Models</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Department</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> DepartmentID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Department name is required."</span></span>)] [MaxLength(<span class="hljs-number"><span class="hljs-number">50</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DisplayFormat(DataFormatString=<span class="hljs-string"><span class="hljs-string">"{0:c}"</span></span>)] [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Budget is required."</span></span>)] [Column(TypeName=<span class="hljs-string"><span class="hljs-string">"money"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span>? Budget { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DisplayFormat(DataFormatString=<span class="hljs-string"><span class="hljs-string">"{0:d}"</span></span>, ApplyFormatInEditMode=<span class="hljs-literal"><span class="hljs-literal">true</span></span>)] [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Start date is required."</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTime StartDate { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Display(Name=<span class="hljs-string"><span class="hljs-string">"Administrator"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>? InstructorID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Instructor Administrator { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ICollection&lt;Course&gt; Courses { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre><br><h5>  Column attribute </h5><br>  Earlier we used the Column attribute to change the mapping of the column name.  In the code for the Department entity, this attribute is used to change the mapping of the SQL data type, that is, the column will be defined in the database with the SQL Server data type: <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">Column(TypeName=</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"money"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span>? Budget { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br>  This is usually not necessary because the Entity Framework automatically selects the most appropriate data type based on the CLR type that is defined for the property.  Suppose the CLR type decimal becomes SQL Server type decimal.  But in this case, you know for sure that the property will contain currency-related numbers, and the money type will be the most suitable for this property. <br><br><h5>  Foreign Key and Navigation Properties </h5><br>  Foreign keys and navigation properties reflect the following links: <br>  The faculty may or may not contain an administrator, and the administrator is always = teacher.  Therefore, the InstructorID property is defined as a foreign key for the Instructor entity, and a question mark after the int type indicates that the property may be nullable.  Navigation property Administrator contains Instructor entity: <br><br>  public int?  InstructorID {get;  set;  } <br><br>  public virtual Instructor Administrator {get;  set;  } <br>  A faculty can have many courses, so there is a Courses navigation property: <br><br>  public virtual ICollection Courses {get;  set;  } <br><br>  <b>Note The</b> conventions state that the Entity Framework cascadingly deletes non-nullable foreign keys and in many-to-many communication cases.  This can lead to iterative cascading deletion, causing an exception when running code.  Suppose, if you do not define the Department. InstructorID as nullable, you will get the following exception when: "The referential relationship will not be allowed." <br><br><h4>  Changes related to the Student entity </h4><br>  In <i>Models</i> <i>\</i> <i>Student</i> <i>.</i>  <i>cs</i> replace the code with: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ComponentModel.DataAnnotations; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ContosoUniversity.Models</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Student</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> StudentID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Last name is required."</span></span>)] [Display(Name=<span class="hljs-string"><span class="hljs-string">"Last Name"</span></span>)] [MaxLength(<span class="hljs-number"><span class="hljs-number">50</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"First name is required."</span></span>)] [Column(<span class="hljs-string"><span class="hljs-string">"FirstName"</span></span>)] [Display(Name = <span class="hljs-string"><span class="hljs-string">"First Name"</span></span>)] [MaxLength(<span class="hljs-number"><span class="hljs-number">50</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstMidName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Enrollment date is required."</span></span>)] [DisplayFormat(DataFormatString = <span class="hljs-string"><span class="hljs-string">"{0:d}"</span></span>, ApplyFormatInEditMode = <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] [Display(Name = <span class="hljs-string"><span class="hljs-string">"Enrollment Date"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTime? EnrollmentDate { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FullName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> LastName + <span class="hljs-string"><span class="hljs-string">", "</span></span> + FirstMidName; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ICollection&lt;Enrollment&gt; Enrollments { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre><br><h4>  Enrollment Entity Changes </h4><br> <a href=""><img title="image52" alt="image52" src="https://habrastorage.org/getpro/habr/post_images/55c/8e2/ec4/55c8e2ec43ff0af18dee1d495677b024.png" width="211" height="221"></a> <br><br>  In <i>Models</i> <i>\</i> <i>Enrollment</i> <i>.</i>  <i>cs</i> replace the code with: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ComponentModel.DataAnnotations; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ContosoUniversity.Models</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Enrollment</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> EnrollmentID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CourseID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> StudentID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DisplayFormat(DataFormatString=<span class="hljs-string"><span class="hljs-string">"{0:#.#}"</span></span>,ApplyFormatInEditMode=<span class="hljs-literal"><span class="hljs-literal">true</span></span>,NullDisplayText=<span class="hljs-string"><span class="hljs-string">"No grade"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span>? Grade { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Course Course { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Student Student { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre><br><h5>  Foreign Keys and Navigation Properties </h5><br>  Foreign keys and navigation properties reflect the following connections: <br>  Each course entry corresponds to one course; therefore, the foreign key CourseID and Course navigation property is present: <br><br>  public int CourseID {get;  set;  } <br><br>  public virtual Course Course {get;  set;  } <br>  Each student enrolled in the course corresponds to one student; therefore, the student ID and Student navigation property are present: <br><br>  public int StudentID {get;  set;  } <br><br>  public virtual Student Student {get;  set;  } <br><br><h5>  Many-to-many connections </h5><br>  The entities Student and Course are connected to each other by a many-to-many relationship, and the essence of the Enrollment corresponds to many-to-many join table.  This means that the Enrollment table contains additional data besides foreign keys for the joined tables (in our case, the primary key and the Grade property). <br><br>  The image below shows the relationships in the form of an entity diagram generated by the Entity Framework designer. <br><br> <a href=""><img title="image55" alt="image55" src="https://habrastorage.org/getpro/habr/post_images/9a7/279/baf/9a7279bafa0d9876eb7b6410b9d3ae5d.png" width="347" height="450"></a> <br><br>  The line of each link has 1 at one end and * at the other, denoting a one-to-many connection. <br><br>  If the Enrollment table does not contain grades, it is necessary to have only two foreign keys, CourseID and StudentID.  In this case, it would be possible to join the table.  The Instructor and Course entities are connected by a similar many-to-many relationship, and, as you can see, there is no entity class between them: <br><br> <a href=""><img title="image58" alt="image58" src="https://habrastorage.org/getpro/habr/post_images/590/565/d26/590565d269c4a1e18430ef49d55e98bb.png" width="318" height="450"></a> <br><br>  Although a merged table is required: <br><br> <a href=""><img title="image61" alt="image61" src="https://habrastorage.org/getpro/habr/post_images/5f2/e4e/264/5f2e4e264c2fd1a28a5474c42026e91d.png" width="527" height="333"></a> <br><br>  The Entity Framework automatically creates the CourseInstructor table, which is accessed indirectly, namely through Instructor.Courses and Course. Instructors navigation properties. <br><br><h5>  DisplayFormat attribute </h5><br>  The DisplayFormat attribute for the Grade property determines the formatting for the element: <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">DisplayFormat(DataFormatString=</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{0:#.#}"</span></span></span><span class="hljs-meta">,ApplyFormatInEditMode=true,NullDisplayText=</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"No grade"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span>? Grade { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br><ul><li>  The score is displayed in the format "3.5" or "4.0". <br></li><li>  The same formatting assessment has in the mode. <br></li><li>  If there is no grade, the inscription "No grade" is displayed. <br></li></ul><br><h4>  Relationships on the entity diagram </h4><br>  The diagram below shows the linking system for the School model. <br><br> <a href=""><img title="image64" alt="image64" src="https://habrastorage.org/getpro/habr/post_images/557/482/0be/5574820becc7e58e7c692cc9ab140908.png" width="332" height="450"></a> <br><br>  In addition to many-to-many (* - *) and one-to-many (1- *) relationships, you can also see a one-to-zero-or-one relationship (1-0..1) between Instructor and OfficeAssignment entities and zero-to-one-or-to-many (0..1 - *) Department and Instructor. <br><br><h4>  Database Context Tuning </h4><br>  Next, we will add new entities to the SchoolContext class and configure the mapping.  In some cases, it will be necessary to use methods instead of attributes due to the fact that for some functionality the attributes simply do not exist.  In other cases, you can choose to use methods or attributes (some people prefer not to use attributes). <br><br>  Replace the code in <i>DAL</i> <i>\</i> <i>SchoolContext</i> <i>.</i>  <i>cs</i> on: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Data.Entity; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ContosoUniversity.Models; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Data.Entity.ModelConfiguration.Conventions; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ContosoUniversity.Models</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SchoolContext</span></span> : <span class="hljs-title"><span class="hljs-title">DbContext</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DbSet&lt;Course&gt; Courses { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DbSet&lt;Department&gt; Departments { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DbSet&lt;Enrollment&gt; Enrollments { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DbSet&lt;Instructor&gt; Instructors { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DbSet&lt;Student&gt; Students { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DbSet&lt;OfficeAssignment&gt; OfficeAssignments { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnModelCreating</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DbModelBuilder modelBuilder</span></span></span><span class="hljs-function">)</span></span> { modelBuilder.Conventions.Remove&lt;PluralizingTableNameConvention&gt;(); modelBuilder.Entity&lt;Instructor&gt;() .HasOptional(p =&gt; p.OfficeAssignment).WithRequired(p =&gt; p.Instructor); modelBuilder.Entity&lt;Course&gt;() .HasMany(c =&gt; c.Instructors).WithMany(i =&gt; i.Courses) .Map(t =&gt; t.MapLeftKey(<span class="hljs-string"><span class="hljs-string">"CourseID"</span></span>) .MapRightKey(<span class="hljs-string"><span class="hljs-string">"InstructorID"</span></span>) .ToTable(<span class="hljs-string"><span class="hljs-string">"CourseInstructor"</span></span>)); modelBuilder.Entity&lt;Department&gt;() .HasOptional(x =&gt; x.Administrator); } } }</code> </pre><br>  The OnModelCreating method defines the following relationships: <br>  One-to-zero-or-one between Instructor and OfficeAssignment: <br><br>  modelBuilder.Entity &lt;Instructor&gt; (). HasOptional (p =&gt; p.OfficeAssignment) .WithRequired (p =&gt; p.Instructor); <br><br>  Many-to-many between Instructor and Course.  The code defines the table and the columns for the joined table.  Code First can configure many-to-many relationships without a code, but if you do not call it, standard names will be taken for the columns, such as InstructorInstructorID for InstructorID. <br><br>  modelBuilder.Entity &lt;Course&gt; () <br>  .HasMany (c =&gt; c.Instructors) .WithMany (i =&gt; i.Courses) <br>  .Map (t =&gt; t.MapLeftKey ("CourseID") <br>  .MapRightKey ("InstructorID") <br>  .ToTable ("CourseInstructor")); <br><br>  One-to-zero-or-one between the Department and the Instructor, using the Department.Administrator navigation property: <br><br>  modelBuilder.Entity &lt;Department&gt; (). HasOptional (x =&gt; x.Administrator); <br><br>  For more information on what is being done ‚Äúbehind the scenes,‚Äù read the <a href="http://blogs.msdn.com/b/aspnetue/archive/2011/05/04/entity-framework-code-first-tutorial-supplement-what-is-going-on-in-a-fluent-api-call.aspx" rel="nofollow">Fluent API</a> on the ASP.NET User Education Team blog. <br><br><h4>  Filling the database with test data </h4><br>  Before that, you created the <i>DAL</i> <i>\</i> <i>SchoolInitializer</i> <i>.</i>  <i>cs</i> to fill the database with test data.  Now replace the old code with the new one, which takes into account the presence of new entities. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Web; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Data.Entity; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ContosoUniversity.Models; namespace ContosoUniversity.DAL { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> SchoolInitializer : DropCreateDatabaseIfModelChanges&lt;SchoolContext&gt; { protected override <span class="hljs-type"><span class="hljs-type">void</span></span> Seed(SchoolContext context) { var students = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Student&gt; { <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Student { FirstMidName = "Carson", LastName = "Alexander", EnrollmentDate = DateTime.Parse("2005-09-01") }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Student { FirstMidName = "Meredith", LastName = "Alonso", EnrollmentDate = DateTime.Parse("2002-09-01") }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Student { FirstMidName = "Arturo", LastName = "Anand", EnrollmentDate = DateTime.Parse("2003-09-01") }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Student { FirstMidName = "Gytis", LastName = "Barzdukas", EnrollmentDate = DateTime.Parse("2002-09-01") }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Student { FirstMidName = "Yan", LastName = "Li", EnrollmentDate = DateTime.Parse("2002-09-01") }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Student { FirstMidName = "Peggy", LastName = "Justice", EnrollmentDate = DateTime.Parse("2001-09-01") }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Student { FirstMidName = "Laura", LastName = "Norman", EnrollmentDate = DateTime.Parse("2003-09-01") }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Student { FirstMidName = "Nino", LastName = "Olivetto", EnrollmentDate = DateTime.Parse("2005-09-01") } }; students.<span class="hljs-keyword"><span class="hljs-keyword">ForEach</span></span>(s =&gt; context.Students.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(s)); context.SaveChanges(); var instructors = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Instructor&gt; { <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Instructor { FirstMidName = "Kim", LastName = "Abercrombie", HireDate = DateTime.Parse("1995-03-11") }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Instructor { FirstMidName = "Fadi", LastName = "Fakhouri", HireDate = DateTime.Parse("2002-07-06") }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Instructor { FirstMidName = "Roger", LastName = "Harui", HireDate = DateTime.Parse("1998-07-01") }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Instructor { FirstMidName = "Candace", LastName = "Kapoor", HireDate = DateTime.Parse("2001-01-15") }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Instructor { FirstMidName = "Roger", LastName = "Zheng", HireDate = DateTime.Parse("2004-02-12") } }; instructors.<span class="hljs-keyword"><span class="hljs-keyword">ForEach</span></span>(s =&gt; context.Instructors.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(s)); context.SaveChanges(); var departments = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Department&gt; { <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Department { <span class="hljs-type"><span class="hljs-type">Name</span></span> = "English", Budget = <span class="hljs-number"><span class="hljs-number">350000</span></span>, StartDate = DateTime.Parse("2007-09-01"), InstructorID = <span class="hljs-number"><span class="hljs-number">1</span></span> }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Department { <span class="hljs-type"><span class="hljs-type">Name</span></span> = "Mathematics", Budget = <span class="hljs-number"><span class="hljs-number">100000</span></span>, StartDate = DateTime.Parse("2007-09-01"), InstructorID = <span class="hljs-number"><span class="hljs-number">2</span></span> }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Department { <span class="hljs-type"><span class="hljs-type">Name</span></span> = "Engineering", Budget = <span class="hljs-number"><span class="hljs-number">350000</span></span>, StartDate = DateTime.Parse("2007-09-01"), InstructorID = <span class="hljs-number"><span class="hljs-number">3</span></span> }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Department { <span class="hljs-type"><span class="hljs-type">Name</span></span> = "Economics", Budget = <span class="hljs-number"><span class="hljs-number">100000</span></span>, StartDate = DateTime.Parse("2007-09-01"), InstructorID = <span class="hljs-number"><span class="hljs-number">4</span></span> } }; departments.<span class="hljs-keyword"><span class="hljs-keyword">ForEach</span></span>(s =&gt; context.Departments.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(s)); context.SaveChanges(); var courses = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Course&gt; { <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Course { CourseID = <span class="hljs-number"><span class="hljs-number">1050</span></span>, Title = "Chemistry", Credits = <span class="hljs-number"><span class="hljs-number">3</span></span>, DepartmentID = <span class="hljs-number"><span class="hljs-number">3</span></span>, Instructors = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Instructor&gt;() }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Course { CourseID = <span class="hljs-number"><span class="hljs-number">4022</span></span>, Title = "Microeconomics", Credits = <span class="hljs-number"><span class="hljs-number">3</span></span>, DepartmentID = <span class="hljs-number"><span class="hljs-number">4</span></span>, Instructors = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Instructor&gt;() }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Course { CourseID = <span class="hljs-number"><span class="hljs-number">4041</span></span>, Title = "Macroeconomics", Credits = <span class="hljs-number"><span class="hljs-number">3</span></span>, DepartmentID = <span class="hljs-number"><span class="hljs-number">4</span></span>, Instructors = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Instructor&gt;() }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Course { CourseID = <span class="hljs-number"><span class="hljs-number">1045</span></span>, Title = "Calculus", Credits = <span class="hljs-number"><span class="hljs-number">4</span></span>, DepartmentID = <span class="hljs-number"><span class="hljs-number">2</span></span>, Instructors = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Instructor&gt;() }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Course { CourseID = <span class="hljs-number"><span class="hljs-number">3141</span></span>, Title = "Trigonometry", Credits = <span class="hljs-number"><span class="hljs-number">4</span></span>, DepartmentID = <span class="hljs-number"><span class="hljs-number">2</span></span>, Instructors = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Instructor&gt;() }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Course { CourseID = <span class="hljs-number"><span class="hljs-number">2021</span></span>, Title = "Composition", Credits = <span class="hljs-number"><span class="hljs-number">3</span></span>, DepartmentID = <span class="hljs-number"><span class="hljs-number">1</span></span>, Instructors = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Instructor&gt;() }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Course { CourseID = <span class="hljs-number"><span class="hljs-number">2042</span></span>, Title = "Literature", Credits = <span class="hljs-number"><span class="hljs-number">4</span></span>, DepartmentID = <span class="hljs-number"><span class="hljs-number">1</span></span>, Instructors = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Instructor&gt;() } }; courses.<span class="hljs-keyword"><span class="hljs-keyword">ForEach</span></span>(s =&gt; context.Courses.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(s)); context.SaveChanges(); courses[<span class="hljs-number"><span class="hljs-number">0</span></span>].Instructors.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(instructors[<span class="hljs-number"><span class="hljs-number">0</span></span>]); courses[<span class="hljs-number"><span class="hljs-number">0</span></span>].Instructors.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(instructors[<span class="hljs-number"><span class="hljs-number">1</span></span>]); courses[<span class="hljs-number"><span class="hljs-number">1</span></span>].Instructors.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(instructors[<span class="hljs-number"><span class="hljs-number">2</span></span>]); courses[<span class="hljs-number"><span class="hljs-number">2</span></span>].Instructors.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(instructors[<span class="hljs-number"><span class="hljs-number">2</span></span>]); courses[<span class="hljs-number"><span class="hljs-number">3</span></span>].Instructors.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(instructors[<span class="hljs-number"><span class="hljs-number">3</span></span>]); courses[<span class="hljs-number"><span class="hljs-number">4</span></span>].Instructors.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(instructors[<span class="hljs-number"><span class="hljs-number">3</span></span>]); courses[<span class="hljs-number"><span class="hljs-number">5</span></span>].Instructors.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(instructors[<span class="hljs-number"><span class="hljs-number">3</span></span>]); courses[<span class="hljs-number"><span class="hljs-number">6</span></span>].Instructors.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(instructors[<span class="hljs-number"><span class="hljs-number">3</span></span>]); context.SaveChanges(); var enrollments = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Enrollment&gt; { <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Enrollment { StudentID = <span class="hljs-number"><span class="hljs-number">1</span></span>, CourseID = <span class="hljs-number"><span class="hljs-number">1050</span></span>, Grade = <span class="hljs-number"><span class="hljs-number">1</span></span> }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Enrollment { StudentID = <span class="hljs-number"><span class="hljs-number">1</span></span>, CourseID = <span class="hljs-number"><span class="hljs-number">4022</span></span>, Grade = <span class="hljs-number"><span class="hljs-number">3</span></span> }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Enrollment { StudentID = <span class="hljs-number"><span class="hljs-number">1</span></span>, CourseID = <span class="hljs-number"><span class="hljs-number">4041</span></span>, Grade = <span class="hljs-number"><span class="hljs-number">1</span></span> }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Enrollment { StudentID = <span class="hljs-number"><span class="hljs-number">2</span></span>, CourseID = <span class="hljs-number"><span class="hljs-number">1045</span></span>, Grade = <span class="hljs-number"><span class="hljs-number">2</span></span> }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Enrollment { StudentID = <span class="hljs-number"><span class="hljs-number">2</span></span>, CourseID = <span class="hljs-number"><span class="hljs-number">3141</span></span>, Grade = <span class="hljs-number"><span class="hljs-number">4</span></span> }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Enrollment { StudentID = <span class="hljs-number"><span class="hljs-number">2</span></span>, CourseID = <span class="hljs-number"><span class="hljs-number">2021</span></span>, Grade = <span class="hljs-number"><span class="hljs-number">4</span></span> }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Enrollment { StudentID = <span class="hljs-number"><span class="hljs-number">3</span></span>, CourseID = <span class="hljs-number"><span class="hljs-number">1050</span></span> }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Enrollment { StudentID = <span class="hljs-number"><span class="hljs-number">4</span></span>, CourseID = <span class="hljs-number"><span class="hljs-number">1050</span></span>, }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Enrollment { StudentID = <span class="hljs-number"><span class="hljs-number">4</span></span>, CourseID = <span class="hljs-number"><span class="hljs-number">4022</span></span>, Grade = <span class="hljs-number"><span class="hljs-number">4</span></span> }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Enrollment { StudentID = <span class="hljs-number"><span class="hljs-number">5</span></span>, CourseID = <span class="hljs-number"><span class="hljs-number">4041</span></span>, Grade = <span class="hljs-number"><span class="hljs-number">3</span></span> }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Enrollment { StudentID = <span class="hljs-number"><span class="hljs-number">6</span></span>, CourseID = <span class="hljs-number"><span class="hljs-number">1045</span></span> }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Enrollment { StudentID = <span class="hljs-number"><span class="hljs-number">7</span></span>, CourseID = <span class="hljs-number"><span class="hljs-number">3141</span></span>, Grade = <span class="hljs-number"><span class="hljs-number">2</span></span> }, }; enrollments.<span class="hljs-keyword"><span class="hljs-keyword">ForEach</span></span>(s =&gt; context.Enrollments.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(s)); context.SaveChanges(); var officeAssignments = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;OfficeAssignment&gt; { <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OfficeAssignment { InstructorID = <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Location</span></span> = "Smith 17" }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OfficeAssignment { InstructorID = <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Location</span></span> = "Gowan 27" }, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OfficeAssignment { InstructorID = <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Location</span></span> = "Thompson 304" }, }; officeAssignments.<span class="hljs-keyword"><span class="hljs-keyword">ForEach</span></span>(s =&gt; context.OfficeAssignments.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(s)); context.SaveChanges(); } } }</code> </pre><br>  Pay attention to the processing of the Course entity, which is connected by a many-to-many relationship with the Instructor entity: <br><br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> courses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">List</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Course { CourseID = <span class="hljs-number"><span class="hljs-number">1050</span></span>, Title = <span class="hljs-string"><span class="hljs-string">"Chemistry"</span></span>, Credits = <span class="hljs-number"><span class="hljs-number">3</span></span>, DepartmentID = <span class="hljs-number"><span class="hljs-number">3</span></span>, Instructors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>() }, ... }; courses.<span class="hljs-keyword"><span class="hljs-keyword">ForEach</span></span>(s =&gt; context.Courses.Add(s)); context.SaveChanges(); courses[<span class="hljs-number"><span class="hljs-number">0</span></span>].Instructors.Add(instructors[<span class="hljs-number"><span class="hljs-number">0</span></span>]); ... context.SaveChanges();</code> </pre><br>  When creating the Course object as an empty collection (Instructors = new List ()), it makes possible the addition of Instructor entities associated with the Course using the Instructor.Add () method.  If you have not created an empty List, you will not be able to add such relationships, because the Instructors property will be null and will not have an Add method. <br><br>  <b>Note</b> Remember to delete the entire base initialization code before deploying a project to a production server. <br><br><h4>  Delete and re-create database </h4><br>  Run the project and select the Student Index page. <br><br> <a href=""><img title="image67" alt="image67" src="https://habrastorage.org/getpro/habr/post_images/48b/9ae/dda/48b9aeddab763b6960db58556ed26ab5.png" width="445" height="450"></a> <br><br>  The page looks the same as it did before, but ‚Äúbehind the scenes‚Äù the database was deleted and re-created. <br><br>  If the page does not open or you receive an error that the School.sdf file is already in use (image below), you must open Server Explorer again and close the connection to the database and then try to open the page again. <br><br> <a href=""><img title="image70" alt="image70" src="https://habrastorage.org/getpro/habr/post_images/6ff/fc1/eb5/6fffc1eb53c1ed0a6c6ff18352bb3092.png" width="550" height="356"></a> <br><br>  After that, open the database in Server Explorer and look in the Tables for new tables. <br><br> <a href=""><img title="image75" alt="image75" src="https://habrastorage.org/getpro/habr/post_images/854/d88/23f/854d8823f73a01993e3143910ad32a1b.png" width="281" height="358"></a> <br><br>  In addition to EdmMetadata, notice the table for which you did not create the CourseInstructor class.  This is a table from the Instructor and Course. <br><br>  Click on the CourseInstructor table and click <b>Show Table Data</b> to make sure that the data added earlier on the Course.Instructors navigation property is available. <br><br> <a href=""><img title="image80" alt="image80" src="https://habrastorage.org/getpro/habr/post_images/1a9/095/c47/1a9095c4761f61c6776503e344cb8b4f.png" width="328" height="311"></a> <br><br>  You now have a complex data model and corresponding database.  Next we will learn different ways to access data. <br><br><h4>  Acknowledgments </h4><br>  Thanks for the help in the translation of Alexander Belotserkovsky ( <a href="http://habrahabr.ru/users/ahriman/">ahriman</a> ). </div><p>Source: <a href="https://habr.com/ru/post/134160/">https://habr.com/ru/post/134160/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134152/index.html">Opera 11.60 Finally, the bookmarks indicator !!!</a></li>
<li><a href="../134153/index.html">December 10-11, Yekaterinburg will host HackDay # 21</a></li>
<li><a href="../134154/index.html">The difficulty of administering guest hotspots. Practice (part 2)</a></li>
<li><a href="../134157/index.html">Vulnerability in Facebook has opened access to private photo users (including Zuckerberg)</a></li>
<li><a href="../134158/index.html">Registering global hotkeys using WPF</a></li>
<li><a href="../134161/index.html">Lenovo has released a secure laptop for students and schoolchildren.</a></li>
<li><a href="../134163/index.html">Data mining in online games</a></li>
<li><a href="../134165/index.html">Distributive for assessing the decentralized file system Tahoe-LAFS</a></li>
<li><a href="../134167/index.html">Automatic parsing of letters coming to tech support</a></li>
<li><a href="../134168/index.html">Public election control using cloud IT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>