<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I tried Microsoft Project Oxford + Telegram Bot API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think, as the name implies, it will be about such things as Microsoft Project Oxford and the Telegram API. 

 What is Microsoft Project Oxford is a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I tried Microsoft Project Oxford + Telegram Bot API</h1><div class="post__text post__text-html js-mediator-article">  I think, as the name implies, it will be about such things as Microsoft Project Oxford and the Telegram API. <br><br>  What is Microsoft Project Oxford is a set of ready-made REST APIs that in an accessible form give developers the full power of machine vision, natural language analysis and voice recognition algorithms for use in their applications.  It is worth noting that the availability of services in the form of a REST API allows you to use it on absolutely any platform and using your favorite development technologies, not limited to those proposed by Microsoft.  In more detail - <a href="https://www.microsoft.com/cognitive-services/">here</a> or <a href="https://habrahabr.ru/company/microsoft/blog/263635/">here</a> . <br><br>  Telegram Bot API - ( <s>I think, and so many people know</s> ) who do not know go <a href="https://core.telegram.org/bots/api">here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first thing that occurred to me was <s>the easiest</s> to make a bot, which determines the age and gender of the person in the photo.  To do this, we need the Face API and the API key, all of which can be obtained from the <a href="https://www.microsoft.com/cognitive-services/">official website</a> . <br><br>  So, let's start (to talk about how to create a bot, I will not, because a lot of information about this).  After we registered the bot, webhooks and got the API key, we break the spelling. <br><br>  I decided to write in PHP.  Why?  <s>devil lured</s> <br><a name="habracut"></a><br>  1) Receive a message from the user: <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'/home/edalqrmq/php/HTTP/Request.php'</span></span>; define(<span class="hljs-string"><span class="hljs-string">'BOT_TOKEN'</span></span>, <span class="hljs-string"><span class="hljs-string">'Token'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'API_URL'</span></span>, <span class="hljs-string"><span class="hljs-string">'https://api.telegram.org/bot'</span></span>.BOT_TOKEN.<span class="hljs-string"><span class="hljs-string">'/'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'FILE_URL'</span></span>, <span class="hljs-string"><span class="hljs-string">'https://api.telegram.org/file/bot'</span></span>.BOT_TOKEN.<span class="hljs-string"><span class="hljs-string">'/'</span></span>);<span class="hljs-comment"><span class="hljs-comment">//     $content = file_get_contents("php://input"); $update = json_decode($content, true); $chatID = $update["message"]["chat"]["id"];</span></span></code> </pre> <br>  Something like this JSON: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"update_id"</span></span>:<span class="hljs-number"><span class="hljs-number">3405704853232</span></span>, _<span class="hljs-string"><span class="hljs-string">"message"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"message_id"</span></span>:<span class="hljs-number"><span class="hljs-number">238</span></span>, <span class="hljs-string"><span class="hljs-string">"from"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">138183417332</span></span>, <span class="hljs-string"><span class="hljs-string">"first_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Kirill"</span></span>, <span class="hljs-string"><span class="hljs-string">"last_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Dudka"</span></span> }, <span class="hljs-string"><span class="hljs-string">"chat"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1381834173</span></span>, <span class="hljs-string"><span class="hljs-string">"first_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Kirill"</span></span>, <span class="hljs-string"><span class="hljs-string">"last_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Dudka"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"private"</span></span> }, <span class="hljs-string"><span class="hljs-string">"date"</span></span>:<span class="hljs-number"><span class="hljs-number">1461168940323</span></span>, <span class="hljs-string"><span class="hljs-string">"photo"</span></span>:[ { <span class="hljs-string"><span class="hljs-string">"file_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"AgADAgADw6gxG_mCPAjHE7knq2P_UUJfLyLw4AAgI"</span></span>, <span class="hljs-string"><span class="hljs-string">"file_size"</span></span>:<span class="hljs-number"><span class="hljs-number">1211</span></span>, <span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">67</span></span> }, { <span class="hljs-string"><span class="hljs-string">"file_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"AgADAgADw6gxG_mCPAjHE7knDjERzAUtSA0ABGwI"</span></span>, <span class="hljs-string"><span class="hljs-string">"file_size"</span></span>:<span class="hljs-number"><span class="hljs-number">16846</span></span>, <span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">320</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">240</span></span> }, { <span class="hljs-string"><span class="hljs-string">"file_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"AgADAgADw6gxG_mCPAjHE7knBB_ZFZmQI"</span></span>, <span class="hljs-string"><span class="hljs-string">"file_size"</span></span>:<span class="hljs-number"><span class="hljs-number">55547</span></span>, <span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">800</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">600</span></span> } ] } }</code> </pre><br><br>  2) Check for the presence of a photo and form a link to the image: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($update[<span class="hljs-string"><span class="hljs-string">"message"</span></span>][<span class="hljs-string"><span class="hljs-string">"photo"</span></span>]){ $photoId = $update[<span class="hljs-string"><span class="hljs-string">"message"</span></span>][<span class="hljs-string"><span class="hljs-string">"photo"</span></span>][<span class="hljs-string"><span class="hljs-string">"2"</span></span>][<span class="hljs-string"><span class="hljs-string">"file_id"</span></span>]; $url_json = file_get_contents(API_URL.<span class="hljs-string"><span class="hljs-string">"getFile?file_id="</span></span>.$photoId); $massURL = json_decode($url_json, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $photoURL = FILE_URL.$massURL[<span class="hljs-string"><span class="hljs-string">"result"</span></span>][<span class="hljs-string"><span class="hljs-string">"file_path"</span></span>]; }</code> </pre><br>  3) Next, we need to send the image for analysis, for more details, see <a href="https://dev.projectoxford.ai/docs/services/563879b61984550e40cbbe8d/operations/563879b61984550f30395236">here</a> <br><br><pre> <code class="php hljs">$req = &amp;<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HTTP_Request(<span class="hljs-string"><span class="hljs-string">'https://api.projectoxford.ai/face/v1.0/detect'</span></span>); $req-&gt;setMethod(HTTP_REQUEST_METHOD_POST); $req-&gt;addHeader(<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>,<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>); $req-&gt;addHeader(<span class="hljs-string"><span class="hljs-string">'Ocp-Apim-Subscription-Key'</span></span>,<span class="hljs-string"><span class="hljs-string">'key'</span></span>); $req-&gt;addQueryString(<span class="hljs-string"><span class="hljs-string">'returnFaceId'</span></span>, <span class="hljs-string"><span class="hljs-string">'true'</span></span>); $req-&gt;addQueryString(<span class="hljs-string"><span class="hljs-string">'returnFaceLandmarks'</span></span>, <span class="hljs-string"><span class="hljs-string">'false'</span></span>); $req-&gt;addQueryString(<span class="hljs-string"><span class="hljs-string">'returnFaceAttributes'</span></span>, <span class="hljs-string"><span class="hljs-string">'age,gender,smile'</span></span>);<span class="hljs-comment"><span class="hljs-comment">//     $req-&gt;setBody('{"url":"'.$photoURL.'"}');</span></span></code> </pre><br>  In response, we receive something like this: <br><br><pre> <code class="javascript hljs">Pragma: no-cache Cache-Control: no-cache <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>: Wed, <span class="hljs-number"><span class="hljs-number">20</span></span> Apr <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span> GMT X-AspNet-Version: <span class="hljs-number"><span class="hljs-number">4.0</span></span><span class="hljs-number"><span class="hljs-number">.30319</span></span> X-Powered-By: ASP.NET Content-Length: <span class="hljs-number"><span class="hljs-number">143</span></span> Content-Type: application/json; charset=utf<span class="hljs-number"><span class="hljs-number">-8</span></span> Expires: <span class="hljs-number"><span class="hljs-number">-1</span></span> [ { <span class="hljs-string"><span class="hljs-string">"faceId"</span></span>: <span class="hljs-string"><span class="hljs-string">"a194a7b3-7e86-46fc-9b73-166e09127546581b"</span></span>, <span class="hljs-string"><span class="hljs-string">"faceRectangle"</span></span>: { <span class="hljs-string"><span class="hljs-string">"top"</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-string"><span class="hljs-string">"width"</span></span>: <span class="hljs-number"><span class="hljs-number">162</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>: <span class="hljs-number"><span class="hljs-number">162</span></span> }, <span class="hljs-string"><span class="hljs-string">"faceAttributes"</span></span>: { <span class="hljs-string"><span class="hljs-string">"age"</span></span>: <span class="hljs-number"><span class="hljs-number">23.3</span></span> } } ]</code> </pre><br><br>  4) Next thing is small, send the data to the user: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $req-&gt;sendRequest(); $face_json = $req-&gt;getResponseBody(); $massFace = json_decode($face_json, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $age = $massFace[<span class="hljs-string"><span class="hljs-string">"0"</span></span>][<span class="hljs-string"><span class="hljs-string">"faceAttributes"</span></span>][<span class="hljs-string"><span class="hljs-string">"age"</span></span>]; $gender_En = $massFace[<span class="hljs-string"><span class="hljs-string">"0"</span></span>][<span class="hljs-string"><span class="hljs-string">"faceAttributes"</span></span>][<span class="hljs-string"><span class="hljs-string">"gender"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!$massFace[<span class="hljs-string"><span class="hljs-string">"0"</span></span>][<span class="hljs-string"><span class="hljs-string">"faceAttributes"</span></span>]){ $sendto = API_URL.<span class="hljs-string"><span class="hljs-string">"sendmessage?chat_id="</span></span>.$chatID.<span class="hljs-string"><span class="hljs-string">"&amp;text= ,    "</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($gender_En==<span class="hljs-string"><span class="hljs-string">"male"</span></span>){ $gender = <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($gender_En==<span class="hljs-string"><span class="hljs-string">"female"</span></span>){ $gender = <span class="hljs-string"><span class="hljs-string">""</span></span>; } } $sendto = API_URL.<span class="hljs-string"><span class="hljs-string">"sendmessage?chat_id="</span></span>.$chatID.<span class="hljs-string"><span class="hljs-string">"&amp;text= : "</span></span>.$gender.<span class="hljs-string"><span class="hljs-string">" : "</span></span>.$age; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (HttpException $ex) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $ex; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $sendto = API_URL.<span class="hljs-string"><span class="hljs-string">"sendmessage?chat_id="</span></span>.$chatID.<span class="hljs-string"><span class="hljs-string">"&amp;text=  "</span></span>; } file_get_contents($sendto);</code> </pre><br>  Actually, this is all, in the end we got this picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/701/399/dd1/701399dd1cf252fc83627d785f3bb3c8.png" alt="image"><br><br>  Total left an hour and some coffee.  The bot displays information only about the first person found, did not set itself the task of writing a bot for the prod ( <s>for now</s> ), Microsoft Project Oxford is quite an interesting API that deserves attention. <br><br>  Thanks to all. <br><br>  Next <a href="https://habrahabr.ru/post/282231/">We determine gender and age using Microsoft Project Oxford and C #</a> <br>  May your neurons be with you! </div><p>Source: <a href="https://habr.com/ru/post/282125/">https://habr.com/ru/post/282125/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282115/index.html">Essay tool: from idea to monetization</a></li>
<li><a href="../282117/index.html">Free Practical Courses on Basic JavaScript Programming</a></li>
<li><a href="../282119/index.html">We write a simple file parser (for beginners)</a></li>
<li><a href="../282121/index.html">The new cryptographer CryptoBit is distributed through exploit kits that affect the browser.</a></li>
<li><a href="../282123/index.html">Manage database structure without pain</a></li>
<li><a href="../282127/index.html">Striving for nil: how the prices for mobile communications have changed in a quarter of a century</a></li>
<li><a href="../282129/index.html">Work with geofences (geofences) in Android. Update</a></li>
<li><a href="../282131/index.html">Introduction to Shader Programming: Part 3</a></li>
<li><a href="../282133/index.html">SpyEye authors were given 24 years for two</a></li>
<li><a href="../282139/index.html">IT Center at the DUMP-2016 Conference</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>