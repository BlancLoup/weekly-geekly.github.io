<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Do you want a 6.5 deposit? Calculation of the rate of return on shares and full return using the Moex API and the dividend parser</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A little about the text below. 


 The laziest portfolio investor usually does this: goes to a financial manager, they together constitute the investo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Do you want a 6.5 deposit? Calculation of the rate of return on shares and full return using the Moex API and the dividend parser</h1><div class="post__text post__text-html js-mediator-article"><h3>  A little about the text below. </h3><br><img src="https://habrastorage.org/webt/j5/jr/qe/j5jrqevbgp2pggujyqroiyy_dai.jpeg"><br><br>  The laziest portfolio investor usually does this: goes to a financial manager, they together constitute the investor profile and, based on this profile, they collect a portfolio of assets that correspond to the risk / return indicators that the portfolio investor is willing to accept. <br><br>  If an investor is very long-term and the portfolio is correct, then he can buy the paper at any time and at any price, a 10-year time period will smooth the difference through dividend payments (of course, we should look for securities with a constant cash flow). <br>  Consider a situation in which you need to find securities (hereinafter I will mean a specific type of securities - stocks, everything is clear with bonds, there is a coupon) that the cash flow brings in the form of dividends, satisfying your financial plan.  The simplest example is to find a stock whose cash flow exceeds the inflation value, i.e.  4% (according to Rosstat) <br><a name="habracut"></a><br>  Let's consider the second factor of this risk / return pair - the actual <b>return</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i><b>The profitability of a stock</b></i> is <i>an indicator that allows you to assess how much profit you can get from the moment you purchase a security.</i>  <i>Yield can be not only positive, but also negative - in the case when the stock brought the investor a loss.</i>  <i>In general, the profitability of the stock is calculated using the following simple formula:</i> <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>V</mi><mo>=</mo><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>D</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>P</mi></mrow><mo stretchy=&quot;false&quot;>)</mo><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>100</mn><mi mathvariant=&quot;normal&quot;>&amp;#x0025;</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="27.37ex" height="2.66ex" viewBox="0 -832 11784.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMATHI-56" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMAIN-3D" x="1047" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMAIN-28" x="2103" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMATHI-66" x="2743" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMATHI-72" x="3293" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMATHI-61" x="3745" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMATHI-63" x="4274" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMATHI-44" x="4708" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMATHI-50" x="5536" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMAIN-29" x="6288" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMATHI-74" x="6927" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMATHI-69" x="7289" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMATHI-6D" x="7634" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMATHI-65" x="8513" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMATHI-73" x="8979" y="0"></use><g transform="translate(9449,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345696/&amp;xid=17259,1500001,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiQ5u0gNsjOHRVbUuKhNZAsCyJeaw#MJMAIN-25" x="10950" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>V</mi><mo>=</mo><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>D</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>P</mi></mrow><mo stretchy="false">)</mo><mtext>&nbsp;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mn>100</mn><mi mathvariant="normal">%</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> V = (\ frac {D} {P}) \ times 100 \% </script></p><br><h3>  Aggregators </h3><br>  Immediately give a couple of resources that already contain the data that we need.  There are data on the yields of securities and factors that need to be paid attention to when buying them.  I myself also occasionally look at these resources: <a href="https://dohod.ru/ik/analytics/dividend">Income.ru</a> and the <a href="https://dohod.ru/ik/analytics/dividend">SmartLab</a> <a href="https://smart-lab.ru/dividends">Investment section</a> . <br><br>  You can safely use them, but I set myself the task to automate a certain process + to be able to work with data on dividend payments for a certain possible period of time. <br><br><h3>  We write a parser </h3><br>  After going through several options, I stopped at phpQuery, although I had tried to implement a parser on Simple HTML DOM before.  The result was processed for a very long time, so I had to change.  Data parsim from <a href="http://stocks.investfunds.ru/stocks/">investfunds.ru</a> <br><br><div class="spoiler">  <b class="spoiler_title">Parser code</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDivsFromCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($code)</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  -    ,   . include_once './phpQuery.php'; if ( $curl = curl_init () ) //  { curl_setopt ($curl, CURLOPT_URL, 'http://stocks.investfunds.ru/stocks/'.$code.'/dividend/');//   curl_setopt ($curl, CURLOPT_RETURNTRANSFER, 1); curl_setopt ($curl, CURLOPT_POST, true); curl_setopt ($curl, CURLOPT_HEADER, 0); $result = curl_exec ($curl);//  curl_close ($curl);//  } $html = phpQuery::newDocumentHTML($result); phpQuery::selectDocument($html); $a = [1,3,5]; //      (,    ) $emitent_string = htmlentities(pq('h1')-&gt;text(),ENT_COMPAT,'UTF-8'); if ($emitent_string === ""){ $divs['emitent'] = ' '; return $divs; } $re = ['  , ', '  , ','  ','  ']; $emi = str_replace($re,'',$emitent_string); $divs['emitent'] = $emi; $divs['code'] = $code; /*  ,   */ $i = pq('[cellpadding="0"] tr td:nth-child(1)'); $l = substr_count($i,'td style'); /*,     */ if ($l === 0){ $divs['data']= 'No divs'; return $divs; } /******     css************************/ for ($i =3;$i&lt;$l+3;$i++){ foreach ($a as $j){ switch ($j) { case 1: $divs['data'][$i-2]['year'] = str_replace(' ','',htmlentities(pq("[cellpadding='0'] tr:nth-child($i) td:nth-child($j)")-&gt;text(),ENT_COMPAT,'UTF-8')); break; case 3: $divs['data'][$i-2]['date'] = str_replace(' ','',htmlentities(pq("[cellpadding='0'] tr:nth-child($i) td:nth-child($j)")-&gt;text(),ENT_COMPAT,'UTF-8')); break; case 5: $string = htmlentities(pq("[cellpadding='0'] tr:nth-child($i) td:nth-child($j)")-&gt;text(),ENT_SUBSTITUTE,'UTF-8'); $re = '/[ \s]|[]/'; $divs['data'][$i-2]['price'] = (float)preg_replace($re,'',$string); break; default: break; } } } /* ,      ,  ,      */ return $divs; }</span></span></code> </pre> <br></div></div><br>  the result of the function will be an array of data on one issuer.  Next, I import the result into companies.json <br><br><div class="spoiler">  <b class="spoiler_title">import</b> <div class="spoiler_text"><pre> <code class="php hljs">$divs = $emitent-&gt;getDivsFromCode($i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($divs[<span class="hljs-string"><span class="hljs-string">'emitent'</span></span>] != <span class="hljs-string"><span class="hljs-string">' '</span></span>){ array_push($json_div, $divs); } } file_put_contents(<span class="hljs-string"><span class="hljs-string">'companies_part1.json'</span></span>,json_encode($json_div,JSON_UNESCAPED_UNICODE));</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Array example</b> <div class="spoiler_text"><pre> <code class="hljs json">[{<span class="hljs-attr"><span class="hljs-attr">"emitent"</span></span>:<span class="hljs-string"><span class="hljs-string">", (RU0009071187, AVAZ)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"code"</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {<span class="hljs-attr"><span class="hljs-attr">"1"</span></span>: {<span class="hljs-attr"><span class="hljs-attr">"year"</span></span>:<span class="hljs-string"><span class="hljs-string">"2007"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"date"</span></span>:<span class="hljs-string"><span class="hljs-string">"16.05.2008"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"price"</span></span>:<span class="hljs-number"><span class="hljs-number">0.29</span></span>}, <span class="hljs-attr"><span class="hljs-attr">"2"</span></span>: {<span class="hljs-attr"><span class="hljs-attr">"year"</span></span>:<span class="hljs-string"><span class="hljs-string">"2006"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"date"</span></span>:<span class="hljs-string"><span class="hljs-string">"06.04.2007"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"price"</span></span>:<span class="hljs-number"><span class="hljs-number">0.1003</span></span>}, <span class="hljs-attr"><span class="hljs-attr">"3"</span></span>: {<span class="hljs-attr"><span class="hljs-attr">"year"</span></span>:<span class="hljs-string"><span class="hljs-string">"2005"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"date"</span></span>:<span class="hljs-string"><span class="hljs-string">"07.04.2006"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"price"</span></span>:<span class="hljs-number"><span class="hljs-number">0.057</span></span>} } }]</code> </pre><br></div></div><br><blockquote>  <b>Minuses of the parser:</b> at first I thought that I would have to parse about 1000 pages, because after 800 I only came across additional issues.  But then, not finding one of the issuers, I decided to continue the parsing and it turned out that even after 5k pages something might happen.  The solution is to rewrite the parser using <b>multicurl</b> for processing speed.  Before that, my hands did not reach me (I began to read), but for the right one, I should have done just that.  Maybe someone from the readers will help me.  Again, the base with divas can be updated once every six months.  That's enough if you operate with annual yields. </blockquote><br><h3>  Calculate the rate of return and the total return of the stock from the date of purchase </h3><br>  I have already given the formula above.  For automation, I wrote a script that uses raw data entered manually and counts the required indicators. <br><br><pre> <code class="php hljs">$name = <span class="hljs-string"><span class="hljs-string">'GAZP'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  $year_buy = 2015; //   $buy_price = 130; //   $year_last_div = 2016; //    $v_need = 4; // </span></span></code> </pre><br>  For convenience, I wrote a small function.  which by ticker finds the issuer data in json <br><br><div class="spoiler">  <b class="spoiler_title">Ticker Search</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDivsFromName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span></span>{ $file = file_get_contents(<span class="hljs-string"><span class="hljs-string">'companies.json'</span></span>); $array = json_decode($file,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($array <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $emitent) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((stristr($emitent[<span class="hljs-string"><span class="hljs-string">'emitent'</span></span>],$name))&amp;&amp;(!stristr($emitent[<span class="hljs-string"><span class="hljs-string">'emitent'</span></span>],$name.<span class="hljs-string"><span class="hljs-string">'-'</span></span>))){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $emitent; } } }</code> </pre> <br></div></div><br>  Now we can calculate the data we are interested in.  To get the current price ( <i>$ today_price</i> variable) I use the function in which I wrote in my <a href="https://habrahabr.ru/post/343688/">previous post</a> and which uses the Moscow Exchange API.  All formulas are taken from <a href="https://utmagazine.ru/posts/14570-norma-pribyli-po-akcii">this</a> article. <br><br><pre> <code class="php hljs">$emitent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> emitent(); $v_today; <span class="hljs-comment"><span class="hljs-comment">//  ; $v_need = $v; //  ; $div = $emitent-&gt;getDivsFromName($name); $sum = $emitent-&gt;getSumDivs($year_buy, $div); $last_div = $emitent-&gt;getSumDivs($year_last_div, $div,1); //  c   /*r = (D + (P1 - P0))/P0 * 100% * P0 -   * P1 -   * D -   * */ $today_price = $emitent-&gt;getPrice($name, '.json'); $r = ($sum + ($today_price-$buy_price))/$buy_price*100; $v_today = $last_div/$today_price*100; $P = ($last_div/$v_need)*100; //  </span></span></code> </pre><br>  Now a little analysis of the results.  For example, I take two large companies that are included INDEX MSCI RUSSIA <br><br>  Gazprom <br><br><img src="https://habrastorage.org/webt/es/_6/is/es_6isjui7l-ngabk5oqg8ohkrw.jpeg"><br>  and Alrosa (Suppose we took it for 60r. in 2015.) <br><br><img src="https://habrastorage.org/webt/sx/ps/7t/sxps7ts-d1fqchzmtvjjf0hq-0q.jpeg"><br><br>  As you can see, despite the fact that the price of a share of Gazprom is practically the same as the purchase price, we still have a yield of 12% due to dividends.  Alrosa is even better off.  We can recalculate for the rates of return on deposits from the site of <a href="http://www.banki.ru/products/deposits/search/moskva/%3Fsort%3Drate%26order%3Ddesc%26amount%3D100000%26currency%3DRUB%26period%3D3y%26excluded_special%255B%255D%3D1%26excluded_special%255B%255D%3D2%26excluded_special%255B%255D%3D4%26excluded_special%255B%255D%3D5%26excluded_special%255B%255D%3D6%26excluded_special%255B%255D%3D7%26excluded_special%255B%255D%3D8%26excluded_special%255B%255D%3D9%26show_special_first%3D1%26capitalization%255B%255D%3D1%26capitalization%255B%255D%3D2%26top_hundred_place%3D50">banks.ru</a> from the list of top-50 banks.  Now banks give us 6.5% <br><br><img src="https://habrastorage.org/webt/2t/jx/h4/2tjxh4sv2jjezct4tbaoy3a4l7a.jpeg"><br><br><img src="https://habrastorage.org/webt/wd/tz/h0/wdtzh0rmwczr2-ll90ddwemskk8.jpeg"><br><br>  <b><u>Accordingly, you can, by varying the desired rate of return, understand whether the current stock price satisfies your needs and your financial goals.</u></b> <b><u><br></u></b> <br><blockquote>  I note that, as in the previous article, this is only the finding of one of the factors that influence decision making. </blockquote><br>  Many investors do the above calculations in Excel.  This tool provides many formulas for calculating profit, cash flow, etc.  But I aimed to automate the collection of data on dividends and the automated processing of this data. <br>  The article this time includes less theory and more code because the theory is very extensive, and to bind this task to the general theory of portfolio construction, you need to write a series of articles.  Yes, and the Habra format does not imply the writing of purely investment articles, especially now in the vast expanses of the network there are a great many. <br><br>  <a href="https://habrahabr.ru/post/343688/">Previous article</a> <br>  <b>Thanks for attention!</b> </div><p>Source: <a href="https://habr.com/ru/post/345696/">https://habr.com/ru/post/345696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345674/index.html">Product Design Digest, December 2017</a></li>
<li><a href="../345688/index.html">How to capture / protect an open-source project</a></li>
<li><a href="../345690/index.html">Harmful spells in programming</a></li>
<li><a href="../345692/index.html">Installing 1C Fresh from scratch using Linux and PostgreSQL</a></li>
<li><a href="../345694/index.html">My experience is to get into IT in comparison with a tambovka taxi driver</a></li>
<li><a href="../345698/index.html">We turn speakers into speakers on the example of HighLoad ++</a></li>
<li><a href="../345700/index.html">Mobile retargeting - the main tool for promoting mobile applications in 2018</a></li>
<li><a href="../345702/index.html">The story of the emergence of financial accounting in my life</a></li>
<li><a href="../345704/index.html">Amazon EC2 vs Atlex Cloud VDC: Performance Comparison</a></li>
<li><a href="../345706/index.html">Distributed backends for 2GIS video advertising on .NET Core and Kubernetes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>