<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Anti-DDoS Voxility: what the pizzeria war taught us</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You can not even imagine what dramas can unfold in such a seemingly peaceful industry, like pizza trading. In one of them, we had the opportunity to p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Anti-DDoS Voxility: what the pizzeria war taught us</h1><div class="post__text post__text-html js-mediator-article">  You can not even imagine what dramas can unfold in such a seemingly peaceful industry, like pizza trading.  In one of them, we had the opportunity to participate as a cloud provider: in December 2013, Pizza Empire, one of <a href="http://cloud4y.ru/">Cloud4Y's</a> clients and the largest pizza delivery network in Moscow and the Moscow region, began an intensive expansion into new territories that other players already attended . <br><br><img src="https://habrastorage.org/files/47b/1fb/f41/47b1fbf41fb946caa3306f69f2f6388a.jpg"><br>  <i>And pizza has a dark side</i> <br><br>  All anything, but the imperial price policy in the provision of fast food services for its competitors had a dumping character.  The war began on all fronts, and soon DDoS attacks began to turn. <br><a name="habracut"></a><br><h2>  Start </h2><br>  The Empire of Pizza has launched an active advertising campaign in a large network of cities in the Moscow region, ranging from printed products and ending with an online advertising campaign.  The problems began when competitors ‚Äî other pizza chains ‚Äî noticed this activity and switched to an offensive. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  First offensive </h2><br><img src="https://habrastorage.org/files/214/7c4/147/2147c41473fd4cac87b7753b78346a62.jpg"><br><br>  On December 24, 2013, the pizzeria network war turned into high technology fields.  The DDoS attack of all the Internet resources of our client, which were located with us, began. <br><br>  In the first stages of the beginning of the attack on the "Empire", we removed their Internet resources from the attack by moving to other address ranges.  Such a policy did not work for very long, because the attackers tracked the location of the client and the botnet was quickly reconfigured.  The attack after a short period of time moved again towards the client, blocking its services.  This continued until December 31, 2013, after which a massive attack of all address ranges of Cloud4Y began. <img src="http://habr.habrastorage.org/post_images/330/ed7/08a/330ed708a1aa493498f25de98a59cf09.gif"><br><br><h2>  Start a mass attack </h2><br>  On January 1, 2014, a massive DDoS attack of the entire address range of Cloud4Y, where the client was located, began.  The intensity of the attack scored the entire external peering with other operators and hit the ceiling of the bandwidth of all external communication channels. <br><br>  As a matter of urgency, the flood sensors of the built-in DDoS protection technologies on the grouping of external routers were reconfigured, however, they did not bring enough benefit in this situation.  The routers themselves successfully maintained external routing volumes, but problems also began with higher-level telecom operators (part of the external peers periodically went down, not coping with the switching and routing of such data streams). <br><br>  In attempts to somehow unload external communication channels, we asked external operators to restrict UDP streams in order to allocate free bandwidths for the work of the services of our other Clients. <br>  Internet services of our client, despite any attempts of service administrators, were inoperable.  Servers lost control after a few seconds after launch.  Firewall rules and restrictions did not help.  In order to eliminate the impact of an attack on the work of other Cloud4Y clients, the virtual resources of the pizzeria network were moved to individual hypervisors.  However, due to the intensity of the attack, the SLA services provided by Cloud4Y suffered enough: <br><br><img src="https://habrastorage.org/files/789/688/63d/78968863dadb4afabe66e491108eb77e.jpg"><br><br>  More information about the incident can be found on our <a href="http://cloud4y.ru/">website</a> (SLA-monitor is available on the main page).  Despite such an intense DDoS attack, Cloud4Y cloud services were accessible to external clients. <br><br><h2>  "Gypsum is removed, the client leaves" </h2><br>  Our client, in search of a solution to resume the operation of its Internet resources, began to duplicate its resources at the facilities of other cloud operators.  After transferring the DNS to new locations, other cloud operators (we will not call them) almost immediately became inaccessible (since we also monitored the situation not only from the interests of curiosity). <br><br><img src="https://habrastorage.org/files/1c0/42a/8c1/1c042a8c1f174eca9462a2a6a1dedac2.jpg"><br><br>  Having wandered across the expanses of the runet, the Internet resources of the pizzeria network constantly moved between the data centers of Europe, where the picture with the consequences of the attack was repeated.  The latest data centers, where our client switched, were in Europe (Netherlands, Germany, Czech Republic).  At the time of this writing, the client‚Äôs Internet resources were located in a data center on the islands of Virginia. <br><br>  I think our managers were not very upset after moving this client, because with his switch to other data centers, the intensity of the attack on Cloud4Y dropped, but the preventive ‚Äúpouring shit‚Äù into the addressing area of ‚Äã‚Äãthe former client‚Äôs location lasted a few more weeks. <br><br><h2>  Conclusion </h2><br>  Once under this distribution, it was decided to maximize the DDoS protection of the external Cloud4Y peering, as a result of which we had a direct dedicated channel to Voxility (the leading operator of protection against all types of attacks, including DDoS). <br><br>  Having received maximum protection from DDoS as a service, during the year after the last attack, Cloud4Y had temporary workloads related to the activity of clients, as well as small loads due to possibly small and short-term DDoS attacks.  But the attacks of power, with which digging in this very pizzeria, no longer happened.  What to do? <br><br><h2>  Tests </h2><br>  In order to test Voxility's DDoS protection in action, Cloud4Y decided to attack itself, for which a separate subnet was allocated, separate virtualization tools and separate Internet resources (guinea pigs) were created, on which it was planned to conduct the toughest tests. <br><br><img src="https://habrastorage.org/files/280/2cb/4b5/2802cb4b578a42559b7bfa5f35d5ba19.jpg"><br><br><h2>  Training </h2><br>  To carry out tests through the Internet, the performers of our order were found who could realize a DDoS attack of this level, and which we experienced at the end of 2013 - the beginning of 2014.  Such performers always work anonymously and there was no direct contact with them by phone, however, to realize their plans, they had to be in constant contact with us in order to be able to stop the attack if something went wrong.  Such a performer was found. <br><br>  Previously, the grouping of external routers was reconfigured and the subnets attacked with short BGP prefixes were routed through Voxility.  The protection technology implemented by Voxility has the following architecture: <br><br><img src="https://habrastorage.org/files/b1e/1e5/202/b1e1e5202cc24aecb256e1c3a1abfcab.png"><br><br><ol><li>  The visitor of the protected resource first of all gets into the Voxility protection cloud, where by default all traffic is initially passed only in the ‚ÄúAnalysis‚Äù mode. </li><li>  In case of detection of hazards, the Voxility cloud switches to protection mode and access to services is skipped only if the traffic composition meets the Analytical Purity Rules. </li><li>  If necessary, the traffic to the service is cleared of malicious components and enters the protected services for processing. </li><li>  The traffic processed by the terminal service returns to the consumer requesting it. </li></ol><br>  Tests were planned in two stages: <br><br><ol><li>  Trial attack of guinea pigs with an intensity of 300 Mbit per second for 30 minutes (in order to determine the Voxility reaction). </li><li>  The main attack with an intensity of 15 Gbit. Per second for 2 hours. </li></ol><br>  In the process of testing, we supplemented this plan with the third stage, which will be described later.  Before testing, we carried out self-testing, i.e.  initiated a DDoS attack of their resources by their own means.  The attacked rabbits were located in our data center in Moscow, while we initiated our attack from our Data Center in the Netherlands.  We will not divulge the attack technology, but we can say that we managed to successfully overwhelm our rabbits through Voxility, and our attack remained even unnoticed by the Voxility cloud and the rabbit was attacked with technological attack.  Say at once - it was not a flood attack, the purpose of which was to score all external channels.  Thus, we only experienced the technological advantages of Voxility in detecting complex types of attacks.  Unfortunately, he didn‚Äôt find a complex attack, guinea pigs armed with NGINX-based caching systems were successfully overwhelmed for a long time, and Voxility‚Äôs sensors didn‚Äôt detect and deactivate our invasion. <br><br><img src="https://habrastorage.org/files/346/178/211/346178211a684dfe872faaa9062d7fba.jpg"><br><br><h2>  Testing </h2><br>  Starting a self-test, we quite strongly risked the fact that: <br>  1. Protection of Voxility could not cope; <br>  2. We could lose contact with the attackers and could not stop the attack (communication with the attackers was carried out exclusively by ICQ); <br>  3. In the event of a peering crash with Voxility, we could get a real DDoS attack on all of our resources, the consequences of which could be similar to the New Year and New Year's attack of 2013-2014. <br><br><h5>  <b>First stage</b> </h5><br>  The attack with a small power (about 300 Mbit) was initially missed by Voxility and during the first 10 minutes our guinea pig produced an error 502. After 10 minutes Voxility detected our test attack and switched to the protection mode of our communication channel.  Guinea pigs came to life, the work of services was restored.  Voxility reported to us about the last DDoS attack and its reflection: <br><br><img src="https://habrastorage.org/files/620/f59/ee0/620f59ee07cc4fd296190b74b3f7ee88.jpg"><br><br><img src="https://habrastorage.org/files/912/571/51b/91257151b5e14762867385ac08d0c946.jpg"><br><br><h5>  <b>Second phase</b> </h5><br>  After 20 minutes of trial attack, we asked the attackers to raise the intensity of the attack to 15 gigabits.  The reaction of our communication channel with Voxility at the first and second stage is reflected in the graph below: <br><br><img src="https://habrastorage.org/files/51d/54c/0af/51d54c0afabe4bb5b73e195c2240fd84.jpg"><br><br>  Voxility successfully repelled the second wave of the attack, despite the fact that it exceeded the first trial 45 times.  The intensity of the second wave of attack corresponded to the intensity of the attack, which we grabbed for the New Year holidays on the Internet resources of the Moscow Pizzeria Network. <br>  Services on guinea pigs remained operational, Voxility completely closed some services on the attacked subnet (ICMP). <br><br><h5>  <b>Third stage</b> </h5><br>  Having made sure that the protection of Voxility works, as well as the absence of problems with our external peering, we asked the attackers to show everything they can, and maybe they turned out to be quite a lot (the third wave is visible on the graph): <br><br><img src="https://habrastorage.org/files/395/5e4/745/3955e474514d457596b7d89c022a7f92.jpg"><br><br>  The intensity of the attack was raised from 15 gigabit to 50-120 gigabit, and as we can see part of the SYN traffic, Voxility did not have time to study the cloud, and some of the malicious traffic began to get into our channel, but in any case, half - remained available for the passage of useful Client traffic.  On our monitoring systems, the attack looked as follows: <br><br><img src="https://habrastorage.org/files/6be/91b/4ee/6be91b4ee59e44f7b25adcdc12ec11a6.jpg"><br><br><h2>  Total </h2><br>  According to the results of the test, we concluded that there is no universal and perfect protection against DDoS and other types of attacks, however, our applied protection against VDoS "as a service" DDoS attacks works and allows us to provide customer service even in the most adverse conditions. <br><br>  Thank you for your attention, I will be happy to answer your questions. <br><br>  <i>War is war, and hosting is scheduled!</i> <br> <a href="http://www.cloud4y.ru/"><img src="https://habrastorage.org/files/31f/8fc/453/31f8fc4530484596acea6369784fc512.jpg"></a> </div><p>Source: <a href="https://habr.com/ru/post/243647/">https://habr.com/ru/post/243647/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243631/index.html">How decrepit large offices</a></li>
<li><a href="../243633/index.html">How to work with foreign currency accounts?</a></li>
<li><a href="../243635/index.html">The future in the prism of mobile technology: Russian App Day</a></li>
<li><a href="../243643/index.html">Operation "Modernization": how to improve the learning process at the university with the help of monoblocks?</a></li>
<li><a href="../243645/index.html">HDConf conference: video report</a></li>
<li><a href="../243649/index.html">Short news: Azure has dropped. Some services work</a></li>
<li><a href="../243651/index.html">Mosh - SSH with blackjack and roaming</a></li>
<li><a href="../243655/index.html">Time-lapse camera on STM32L</a></li>
<li><a href="../243657/index.html">Ways to transfer financial data # 2: FAST protocol</a></li>
<li><a href="../243659/index.html">[Peter] Meeting with the OpenSource TechSlide Embox OS: Modern firmware and Tanenbaum classics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>