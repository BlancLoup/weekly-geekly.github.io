<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integration of Intel Threading Building Blocks in your CMake project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, dear readers habrahabr. In this blog, we would like to announce that we now have CMake modules that allow you to download, build and simply use In...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integration of Intel Threading Building Blocks in your CMake project</h1><div class="post__text post__text-html js-mediator-article"> <abbr title="Picture To Attract Attention"><img src="https://habrastorage.org/web/89e/6a8/a5b/89e6a8a5b14441d99d44bad03d0c5372.png"></abbr> <br><br>  Hi, dear readers habrahabr.  In this blog, we would like to announce that we now have CMake modules that allow you to download, build and simply use Intel Threading Building Blocks (Intel TBB) in your CMake projects.  Modules are available in <a href="https://github.com/01org/tbb/tree/tbb_2017/cmake">the Intel TBB project repository on GitHub</a> , as well as in <a href="https://github.com/01org/tbb/releases/latest">binary packages</a> for Linux * OS, Windows * OS and macOS *, starting with the release of Intel TBB 2017 Update 7. <br><a name="habracut"></a><br><h2>  <font color="#0071c5">Using Intel TBB CMake Modules</font> </h2><br>  The new modules allow simple integration of Intel TBB binary packages into the project, as well as more complex options with downloading certain versions from GitHub and building the library from the source code.  Detailed technical description of the modules can be found in the <a href="https://github.com/01org/tbb/tree/tbb_2017/cmake">documentation</a> . <br><br><h3>  <font color="#0071c5">Library integration into the project</font> </h3><br>  The TBBConfig.cmake and TBBConfigVersion.cmake configuration files allow you to get the necessary variables and imported targets for using Intel TBB.  The files are located in the &lt;tbb_root&gt; / cmake folder in binary packages for Linux * OS, Windows * OS or macOS *, starting with the release of Intel TBB 2017 Update 7. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Algorithm: <br><br><ol><li>  Download and unpack the binary package. </li><li>  Add the location of the root folder of the connected library to the <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_PREFIX_PATH.html">CMAKE_PREFIX_PATH</a> variable or the path to the configuration files to the TBB_DIR variable. </li><li>  Call the <a href="https://cmake.org/cmake/help/latest/command/find_package.html">find_package</a> (TBB) function, adding the necessary parameters if necessary. </li><li>  Use received variables and / or imported targets. </li></ol><br>  The required library components can be listed after the COMPONENTS or REQUIRED keyword when calling the <a href="https://cmake.org/cmake/help/latest/command/find_package.html">find_package</a> function, for example, tbb, tbbmalloc, tbb_preview, etc.  By default, the tbb, tbbmalloc and tbbmalloc_proxy components are available.  For each component, an imported TBB :: &lt;component&gt; format target is created. <br><br>  The following variables are defined: <br><table><tbody><tr><td>  TBB_FOUND <br></td><td>  Intel TBB Search Success Flag <br></td></tr><tr><td>  TBB_ &lt;component&gt; _FOUND <br></td><td>  flag of success of the search for a separate component <br></td></tr><tr><td>  TBB_IMPORTED_TARGETS <br></td><td>  all created imported targets <br></td></tr><tr><td>  TBB_VERSION <br></td><td>  Intel TBB version (format: &lt;major&gt;. &lt;minor&gt;) <br></td></tr><tr><td>  TBB_INTERFACE_VERSION <br></td><td>  Intel TBB interface version <br></td></tr></tbody></table><br>  At the moment, when specifying the desired version of the library, there is a restriction: only compatibility of the versions of the &lt;major&gt;. &lt;Minor&gt; format itself is automatically checked, but compatibility of various updates within the same version is not checked.  The interface version can be checked using the TBB_INTERFACE_VERSION variable. <br><br><h3>  <font color="#0071c5">Build Intel TBB from source code using TBBBuild</font> </h3><br>  The TBBBuild.cmake module provides the <i>tbb_build</i> function, which allows <i>building a</i> library from source code using the native library infrastructure (Makefile).  Building on Linux * OS and macOS * requires the make-utility, and on Windows * OS - gmake.  After directly assembling, the necessary configuration files are created in the &lt;tbb_root&gt; / cmake folder. <br><br>  The tbb_build function takes the following parameters: <br><table><tbody><tr><td>  TBB_ROOT &lt;variable&gt; <br></td><td>  path to the root folder of the library you want to collect <br></td></tr><tr><td>  CONFIG_DIR &lt;variable&gt; <br></td><td>  variable in which the full path to the folder with the created configuration files is written; <br>  &lt;variable&gt; -NOTFOUND will be returned in case of a build error <br></td></tr><tr><td>  MAKE_ARGS &lt;custom_make_arguments&gt; <br></td><td>  custom arguments for make commands; <br>  The following arguments are defined and passed automatically if they are not redefined in &lt;custom_make_arguments&gt;: <br><ul><li>  compiler = &lt;compiler&gt; </li><li>  tbb_build_dir = &lt;tbb_build_dir&gt; </li><li>  tbb_build_prefix = &lt;tbb_build_prefix&gt; </li><li>  -j &lt;n&gt; </li></ul><br></td></tr></tbody></table><br>  Example of using the module: <br><br><pre><code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(&lt;path-to-tbb-cmake-modules&gt;/TBBBuild.cmake) tbb_build(TBB_ROOT &lt;tbb_root&gt; CONFIG_DIR TBB_DIR) <span class="hljs-keyword"><span class="hljs-keyword">find_package</span></span>(TBB &lt;options&gt;)</code> </pre> <br><h3>  <font color="#0071c5">Downloading Intel TBB using TBBGet</font> </h3><br>  The TBBGet.cmake module provides the <i>tbb_get</i> function, which allows you to download and unpack binary packages and source packages for <a href="https://github.com/01org/tbb/releases">Intel TBB official releases with GitHub</a> .  For binary packages older than Intel TBB 2017 Update 7, configuration files are automatically created in the &lt;tbb_root&gt; / cmake folder. <br><br>  The <i>tbb_get</i> function takes the following parameters: <br><table><tbody><tr><td>  TBB_ROOT &lt;variable&gt; <br></td><td>  a variable in which the full path to the root folder of the downloaded and unpacked package will be written; <br>  &lt;variable&gt; -NOTFOUND will be returned in case of an error while downloading <br></td></tr><tr><td>  RELEASE_TAG &lt;release_tag&gt; | LATEST <br></td><td>  release tag for download; <br>  default value is LATEST <br></td></tr><tr><td>  SAVE_TO &lt;path&gt; <br></td><td>  path to unpack the downloaded package; <br>  $ { <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_CURRENT_BINARY_DIR.html">CMAKE_CURRENT_BINARY_DIR</a> } is the <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_CURRENT_BINARY_DIR.html">default</a> } / tbb_downloaded <br></td></tr><tr><td>  SYSTEM_NAME Linux | Windows | Darwin <br></td><td>  OS for which you need to download a binary package; <br>  the default value is <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_SYSTEM_NAME.html">CMAKE_SYSTEM_NAME</a> <br></td></tr><tr><td>  CONFIG_DIR &lt;variable&gt; <br></td><td>  variable in which the full path to the configuration files will be written; <br>  the parameter is ignored if the SOURCE_CODE flag is specified <br></td></tr><tr><td>  SOURCE_CODE <br></td><td>  flag indicating the need to download a source package instead of a binary package <br></td></tr></tbody></table><br>  Examples of using the module: <br><br><ol><li>  Download and connect the latest binary package for the current OS <br><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(&lt;path-to-tbb-cmake-modules&gt;/TBBGet.cmake) tbb_get(TBB_ROOT tbb_root CONFIG_DIR TBB_DIR) <span class="hljs-keyword"><span class="hljs-keyword">find_package</span></span>(TBB &lt;options&gt;)</code> </pre> <br></li><li>  Download, build and connect the latest source package <br><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(&lt;path-to-tbb-cmake-modules&gt;/TBBGet.cmake) <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(&lt;path-to-tbb-cmake-modules&gt;/TBBBuild.cmake) tbb_get(TBB_ROOT tbb_root SOURCE_CODE) tbb_build(TBB_ROOT <span class="hljs-variable"><span class="hljs-variable">${tbb_root}</span></span> CONFIG_DIR TBB_DIR) <span class="hljs-keyword"><span class="hljs-keyword">find_package</span></span>(TBB &lt;options&gt;)</code> </pre></li></ol><br><h3>  <font color="#0071c5">Demo projects based on the GettingStarted / sub_string_finder example with an Intel TBB connection</font> </h3><br><div class="spoiler">  <b class="spoiler_title">Connecting a binary package on Windows * OS</b> <div class="spoiler_text">  In this example, we will create a CMake project based on GettingStarted / sub_string_finder with the connection of the Intel TBB binary package.  The example is written for Windows * OS (Microsoft * Visual Studio), but with minor changes it can be used for other OS. <br>  The key words &lt;version&gt; and &lt;date&gt; should be replaced with actual values ‚Äã‚Äãfor the loaded package. <br><br>  Minimum requirements: <br><br><ul><li>  CMake 3.0.0 </li><li>  Microsoft * Visual Studio 11 (for Intel TBB 2017 Update 7) </li><li>  Intel TBB 2017 Update 7 </li></ul><br>  Instruction: <br><br><ol><li>  Download Intel TBB for Windows * OS and extract it to C: \ demo_tbb_cmake </li><li>  In the folder C: \ demo_tbb_cmake \ tbb &lt;version&gt; _ &lt;date&gt; oss \ examples \ GettingStarted \ sub_string_finder create a file CMakeLists.txt with the following contents: <br><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">cmake_minimum_required</span></span>(VERSION <span class="hljs-number"><span class="hljs-number">3.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> FATAL_ERROR) <span class="hljs-keyword"><span class="hljs-keyword">project</span></span>(sub_string_finder CXX) <span class="hljs-keyword"><span class="hljs-keyword">add_executable</span></span>(sub_string_finder sub_string_finder.cpp) <span class="hljs-comment"><span class="hljs-comment">#  find_package  TBBConfig,   # CMAKE_PREFIX_PATH  TBB_DIR. find_package(TBB REQUIRED tbb) # "TBB::tbb"    "${TBB_IMPORTED_TARGETS}" target_link_libraries(sub_string_finder ${TBB_IMPORTED_TARGETS})</span></span></code> </pre></li><li>  Launch the CMake GUI and <br><ul><li>  Fill in the fields (you can use the buttons ‚ÄúBrowse Source ...‚Äù and ‚ÄúBrowse Build ...‚Äù): <br>  "Where is the source code": <br>  C: / demo_tbb_cmake / tbb &lt;version&gt; _ &lt;date&gt; oss / examples / GettingStarted / sub_string_finder <br>  "Where to build the binaries": <br>  C: / demo_tbb_cmake / tbb &lt;version&gt; _ &lt;date&gt; oss / examples / GettingStarted / sub_string_finder / build </li><li>  Add a new variable to the cache with the ‚ÄúAdd Entry‚Äù button: <br>  Name: CMAKE_PREFIX_PATH <br>  Type: PATH <br>  Value: C: / demo_tbb_cmake / tbb &lt;version&gt; _ &lt;date&gt; oss </li><li>  Create a Microsoft * Visual Studio project by clicking the ‚ÄúGenerate‚Äù button. </li></ul></li><li>  Now the resulting project can be opened in Microsoft * Visual Studio (for example, by clicking the ‚ÄúOpen Project‚Äù button in CMake GUI) and build.  Path to the generated project: <br>  C: \ demo_tbb_cmake \ tbb &lt;version&gt; _ &lt;date&gt; oss \ examples \ GettingStarted \ sub_string_finder \ build \ sub_string_finder.sln. <br><br>  CMake GUI window after project generation: <br><br><img src="https://habrastorage.org/web/65a/adb/a1c/65aadba1cdf6432da0bd978102d3aae1.jpg"><br></li></ol></div></div><br><div class="spoiler">  <b class="spoiler_title">Build a library from source code and connect to a project</b> <div class="spoiler_text">  In this example, we will create a CMake project based on GettingStarted / sub_string_finder, in which we will build and connect Intel TBB with <a href="https://www.threadingbuildingblocks.org/docs/help/reference/appendices/preview_features/what_is_a_preview_feature.html">Community Preview Features (CPF)</a> enabled.  The example is written for Linux * OS, but with minor changes it can be used for other OS. <br><br>  Minimum requirements: <br><br><ul><li>  CMake 3.0.0 </li></ul><br>  Instruction: <br><br><ol><li>  Clone the Intel TBB repository to the ~ / demo_tbb_cmake folder: <br><pre> <code class="bash hljs">mkdir ~/demo_tbb_cmake <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/demo_tbb_cmake git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/01org/tbb.git</code> </pre><br></li><li>  In the folder ~ / demo_tbb_cmake / tbb / examples / GettingStarted / sub_string_finder create a file CMakeLists.txt with the following contents: <br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">cmake_minimum_required</span></span>(VERSION <span class="hljs-number"><span class="hljs-number">3.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> FATAL_ERROR) <span class="hljs-keyword"><span class="hljs-keyword">project</span></span>(sub_string_finder CXX) <span class="hljs-keyword"><span class="hljs-keyword">add_executable</span></span>(sub_string_finder sub_string_finder.cpp) <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(<span class="hljs-variable"><span class="hljs-variable">${TBB_ROOT}</span></span>/cmake/TBBBuild.cmake) <span class="hljs-comment"><span class="hljs-comment">#  Intel TBB   Community Preview Features (CPF). tbb_build(TBB_ROOT ${TBB_ROOT} CONFIG_DIR TBB_DIR MAKE_ARGS tbb_cpf=1) find_package(TBB REQUIRED tbb_preview) # "TBB::tbb_preview"    "${TBB_IMPORTED_TARGETS}". target_link_libraries(sub_string_finder ${TBB_IMPORTED_TARGETS})</span></span></code> </pre><br></li><li>  Create a folder to build your project and go there: <br><br><pre> <code class="bash hljs">mkdir ~/demo_tbb_cmake/tbb/examples/GettingStarted/sub_string_finder/build <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/demo_tbb_cmake/tbb/examples/GettingStarted/sub_string_finder/build</code> </pre> </li><li>  Launch CMake, specifying the Intel TBB root folder: <br><pre> <code class="bash hljs">cmake -DTBB_ROOT=<span class="hljs-variable"><span class="hljs-variable">${HOME}</span></span>/demo_tbb_cmake/tbb ..</code> </pre> </li><li>  Build and run the project: <br><pre> <code class="bash hljs">make ./sub_string_finder</code> </pre></li></ol><br></div></div><br><h2>  <font color="#0071c5">Conclusion</font> </h2><br>  The Intel TBB team is interested in easily integrating the library into custom CMake projects.  New modules are created just to solve this problem.  They provide a simple and flexible interface with many use cases.  We hope you try these modules and look forward to your feedback. <br><br>  Links and contacts: <br><br><ul><li>  Our mail: <a href="">inteltbbdevelopers@intel.com</a> . </li><li>  Our <a href="https://github.com/01org/tbb">project on github</a> . </li><li>  Our <a href="https://software.intel.com/en-us/forums/intel-threading-building-blocks/">forum</a> . </li></ul><br>  * other names and brands may be declared the intellectual property of others. </div><p>Source: <a href="https://habr.com/ru/post/335346/">https://habr.com/ru/post/335346/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335336/index.html">CRM-system: full implementation algorithm</a></li>
<li><a href="../335338/index.html">Expand Emercoin testnet and get a lot of free coins</a></li>
<li><a href="../335340/index.html">In a section: the news aggregator on Android with backend. Java Crawl Library (crawler4j)</a></li>
<li><a href="../335342/index.html">How artificial intelligence can save email</a></li>
<li><a href="../335344/index.html">How does participation in professional IT communities affect career?</a></li>
<li><a href="../335350/index.html">Do not think about the minutes down</a></li>
<li><a href="../335352/index.html">Basic accessibility errors when developing a site</a></li>
<li><a href="../335354/index.html">As I wrote a mobile application on react-native</a></li>
<li><a href="../335356/index.html">How do we help for Renga</a></li>
<li><a href="../335360/index.html">Investigation of compliance of online stores with Law 152 of the Federal Law "On Personal Data"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>