<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing ‚Äúfast MongoDB‚Äù - TokuMX in conditions close to reality</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the latest issue of Radio T, we mentioned TokuMX - High-Performance MongoDB Distribution . This product sounds interesting - 9-fold data compressio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing ‚Äúfast MongoDB‚Äù - TokuMX in conditions close to reality</h1><div class="post__text post__text-html js-mediator-article">  In the latest issue of <a href="http://radio-t.com/">Radio T,</a> we mentioned <a href="http://www.tokutek.com/products/tokumx-for-mongodb/">TokuMX - High-Performance MongoDB Distribution</a> .  This product sounds interesting - 9-fold data compression complete with a 20-fold increase in speed and transaction support.  At the same time, the transition from mongo to tokumx is quite simple and from the point of view of an external observer, it is completely transparent.  Such magic seemed to me more than attractive and I decided to check how well everything is in practice. <br><a name="habracut"></a><br>  Now I use several mongodb systems of different sizes, both in AWS and in private data centers.  My usage pattern is mainly focused on a rare but massive data recording (once a day), somewhat more frequent massive read operations (a variety of different analyzes), and constant reads in the front-end data mode.  I have no special problems with Monga, except for the disk problem (calculated after 6 months).  Data from our system is never deleted and in the end will no longer fit on the disks.  In AWS, Monga runs on relatively expensive EBS volumes with guaranteed IOPS.  I was already planning a conventional solution to the lack of disk space (transferring old data to a separate Mong in a cheap configuration), but then I caught the eye of TokuMX with the promise of compression 9 times, which would postpone my problem for the next 4 years.  In addition, the rollback of the entry in the mongee is done only by the client, and it would be nice to do without it, but transfer it to the server level. <br><br>  If you're wondering exactly how TokuMX magic works, then welcome <a href="http://www.tokutek.com/resources/product-docs/">to their website</a> .  Here I will not tell what it is and how to configure it, but I will share the results of surface testing.  My tests do not pretend to scientific accuracy and have the main purpose to show what will happen in my real systems if I switch from Mongi to current. <br><br>  <b>Transparency transition:</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      With this, everything is fine.  None of my tests covering work with Monga (about 200) had any problems.  Everything that worked with Monga works with current.  Integration tests also did not reveal any problems, i.e.  in my case, you can redirect client systems to TokuMX addresses and they will continue to work without noticing the substitution.  I did not test the mode of hybrid work with a current in one replica set, but I suspect that this will work as well. <br><br>  <b>Recording Testing:</b> <br><br>  Tests were performed on 2 identical virtual machines with 2 processors for each, 20G disk and 1G RAM.  The host computer is MBPR i7, SSD, 16G RAM.  Entry (trade candles) in one day, total 1.4M candles.  The average record size is 270 bytes.  3 additional indexes (one simple, 2 composite). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f63/7ba/697/f637ba697c2d881abcdfceeb497d2eff.png" alt="image"><br>  As you can see, there is a difference and TokuMX is really faster.  Of course not in the promised 20 times, but not bad either.  Although at the same time there is a significantly greater load on the processor, but this can be expected due to compression. <br><br>  The size of the data + indexes in TokuMX was also smaller than that of Mongi, but only <b>1.6 times</b> . <br><br>  <b>Reading Testing:</b> <br><br>  Reading was tested in a mode close to real use.  All quick queries (by ticker) were carried out repeatedly for a random sample of 200 tickers, only 10,000 queries, the result was averaged.  Interval (in time) requests were conducted for 10 random intervals and also repeatedly.  The same requests were sent to Mongu and current in the same order.  The main goal of this test was to create an activity as close as possible to the real one.  The time is given in microseconds. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5be/053/cab/5be053cab0f328c253e6930391f4a5bc.png" alt="image"><br>  Not believing my eyes, I conducted these tests many times and a similar result (with small fluctuations) was repeated steadily.  In all my tests, a similar difference, where mongo overtakes tokumx one and a half to three times, was invariably reproduced. <br><br>  Deciding that the possible thing is that TokuMX needs more CPU, I had an unequal battle where a virtual machine with toku with 4 processors competed with Monga on two.  The result is somewhat better, but still the mongo remains faster even in these unequal conditions (the difference is 1.4 times on average).  The only test in which the current went around Mongu (almost 2 times) is the last one - all the candles for the day. <br><br>  Thinking how to test all this again, I reduced the amount of RAM for both contestants so that the data set does not fit in memory.  Here are the results: <br><img src="https://habrastorage.org/getpro/habr/post_images/384/e90/610/384e906104f1cbd6aa95057751456b3b.png" alt="image"><br>  In general, this result looks even worse and the difference of 12 times does not cause much optimism.  However, the first two tests are noticeably closer to Monga, and in my case, the overall result will probably be comparable, since  I have many times more similar ‚Äúimproved‚Äù requests than sagging heavily. <br><br>  In the process of testing in a small amount of memory, I came across some strange current feature - if the specified cache size does not fit in the available RAM, the current simply cuts off the answer and of course the client side from this comes in great bewilderment and starts screaming that the data ended earlier than expected. <br><br>  And one more thing - in all these tests was mongo ‚Äúout of the box‚Äù.  For TokuMX, I relaxed in the last test - I activated direct IO and set the cache size as recommended by them in the manual. <br><br>  <b>Findings:</b> <br>  My preliminary conclusion is: the fact that TokuMX writes about itself, namely ‚Äú20 times faster and 9 times smaller out of the box,‚Äù is not entirely true in my case.  Virtually all read operations were slower (sometimes much slower) in TokuMX and the frighteningly quiet circumcision of the answer is also not encouraging.  For me, transaction support, write acceleration by 1.4 times (there is no lock to the base, but only to the document) and a 1.6-fold gain in data size does not cost much of the performance of all read operations. </div><p>Source: <a href="https://habr.com/ru/post/217617/">https://habr.com/ru/post/217617/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../217605/index.html">99 amazing facts about the business of the future</a></li>
<li><a href="../217607/index.html">80 meetings in 3 days: how we played big in Vegas</a></li>
<li><a href="../217609/index.html">German scientists measured the electron mass 13 times more accurately than before.</a></li>
<li><a href="../217611/index.html">Remote in Russian. New book from 37signals</a></li>
<li><a href="../217615/index.html">Lectorium launches MOOC direction</a></li>
<li><a href="../217625/index.html">First look at the prototype Yotaphone 2</a></li>
<li><a href="../217627/index.html">Asynchronous C # program update</a></li>
<li><a href="../217629/index.html">VPS as an anonymous proxy and not only ...</a></li>
<li><a href="../217631/index.html">Python-digest # 20. News, interesting projects, articles and interviews [March 23, 2014 - March 30, 2014]</a></li>
<li><a href="../217633/index.html">Automatic update programs in C #. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>