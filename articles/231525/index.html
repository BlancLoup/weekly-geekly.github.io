<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write on Kotlin for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About two years ago, I discovered that there are no convenient applications for me in the Android Market to account for the time spent on different pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write on Kotlin for Android</h1><div class="post__text post__text-html js-mediator-article">  About two years ago, I discovered that there are no convenient applications for me in the Android Market to account for the time spent on different projects.  As a real bummer, I decided not to look for the required, but to write it myself.  It turned out to be a bit more complicated than it seemed at the beginning, and <s>I abandoned everything</s> in the sluggish hobby mode: the embodiment of my desire lived for more than a year, slowly moving from the idea to the alpha version. <br><br>  And then all of a sudden, kind people offered to tell me how to write for Android on Kotlin.  It seemed to me that this is a good sign, and I quickly rewrote the application on Kotlin, finished it and posted it on Google Play. <br><br>  An important clarification: this article is just about how to write under Android on Kotlin.  It will be interesting only to those who want to try Kotlin, and to those who want to understand why to try it.  The application I wrote is very, very simple (and by itself does not apply to JetBrains).  In his code, it is guaranteed that something can be improved; it is <a href="https://github.com/philipto/Kotime">laid out on Github</a> for example only, and not as a sample of a delightful code.  It works, and if you want to try it, you can put it <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.philipto.kotime.kotime">here</a> .  But once again: this is a demo, its goal is to be not a perfect application, but an introduction to Kotlin for Android. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Again something new.  And why should I know? </h4><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/efa/435/bc5/efa435bc5b68b8c9964427c7f3bc5f30.jpg"></a> <br><a name="habracut"></a><br>  So as not to delay the most interesting, we mention only the most important advantages of Kotlin: <br><ul><li>  compact code.  Quick to write, easy to read, fewer induced errors; </li><li>  Built-in error protection, first of all, nullability, i.e. the requirement for the programmer to explicitly indicate that a certain variable can be null; </li><li>  ease of development (in my opinion, even a novice Java developer will master Kotlin without difficulty). </li></ul><br>  On Kotlin, you can write much faster than on Jav, and the code, in my opinion, is more beautiful. <br><br>  By the way, on github'e already more than 200 repositories with code on Kotlin'e, and if we talk about mobile applications, then Kotlin was used in the development of the Telegram messenger. <br><br><h4>  Well, well, where to start something? </h4><br>  IDE is required for work  For obvious reasons, I prefer IntelliJ IDEA, however JetBrains makes the Kotlin plugin for Eclipse, and vim lovers can use a separate language compiler. <br><br>  Next, we will assume that anyone who wants to try Kotlin in the Android case will use IntelliJ IDEA.  To work, you will need to install the Kotlin plugin and make sure that the computer is gradle and the Android SDK (this has nothing to do with Kotlin, this is necessary for developing for Android on anything). <br><br><h4>  Java was first </h4><br>  I already had a partially written application when I decided to bring it to the end.  Everything was written in Java. <br><br>  The essence of the application: there is a list of red tasks on the screen, if you click on a task, it turns green and time goes: this means that the user is working on the task.  Once stopped, he clicks on it again, and the task turns red again, showing how little time he spent on it.  The application blindly trusts the user without checking it in any way: this is not ‚Äúbig brother watching you‚Äù from oDesk. <br><br>  I wanted to rewrite what was written in Java on Kotlin, the soul requested 100% code on Kotlin, despite the fact that in one project you can use Java and Kotlin code at the same time.  It turned out that everything is simple with the inherited code: next to <i>src / main / java</i> we create the folder <i>src / main / kotlin</i> , and put classes in it.  Files in Kotlin do not end in <i>.java</i> , but in <i>.kt</i> .  There was a pleasant moment to the place: Kotlin does not require a ‚Äúone class - one file‚Äù correspondence.  You can stuff as many classes into one file as you want according to the logic of the application.  In my application there were only two logical parts - working with a database and a screen user interface, so that the number of files could be reduced. <br><br>  The Kotlin plugin for IntelliJ IDEA can convert <i>.java</i> files to <i>.kt</i> files by performing a neat translation from Java to Kotlin.  You can do this by right-clicking on the file and the context menu, but you can do it right when copying Java code to a <i>.kt</i> file (the plugin will ask if it will be converted). <br><br><h4>  We write code on Kotlin'e </h4><br>  Kotlin code is compact: for example, a class with a constructor and getters / setters are described like this: <br><br><pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Item</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">project</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">status</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">secondsSpent</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lastactivated</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><br>  Let's look at the code that creates a dialog for entering text by clicking on the button. <br><br>  Java: <br><pre> <code class="java hljs">addButton.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OnClickListener() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ AlertDialog.Builder alert = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AlertDialog.Builder (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); alert.setPositiveButton(<span class="hljs-string"><span class="hljs-string">"OK"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DialogInterface.OnClickListener() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DialogInterface dialog, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> which)</span></span></span><span class="hljs-function"> </span></span>{ result = input.getText().toString() } }); } }</code> </pre><br><br>  Kotlin: <br><pre> <code class="java hljs">addButton.setOnClickListener() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> alert = AlertDialog.Builder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); alert.setPositiveButton(<span class="hljs-string"><span class="hljs-string">""</span></span>) { dialog, whichButton -&gt; result = input.getText().toString() } }</code> </pre><br><br>  Agree, the code on Kotlin'e is easier to read.  For the attentive reader, we note that this is, of course, only a code fragment, since when creating a dialogue, not only the ‚ÄúOK‚Äù button is needed, but also the ‚ÄúCancel‚Äù button.  The complete code <a href="https://github.com/philipto/Kotime">is laid out on Github</a> . <br><br>  What makes it possible to shorten the code?  For example, in Kotlin'e this form of writing is possible: if an instance of a class with one abstract method is expected as a parameter, you can simply pass a lambda there: this is exactly what is shown in the example above. <br><br>  Please note that in Kotlin'e you can omit the type of the variable, since it will be derived from the right side of the assignment: <br><br><table><tbody><tr><th>  Java </th><th>  Kotlin </th></tr><tr><td>  AlertDialog.Builder alert = new AlertDialog.Builder (this); </td><td>  val alert = AlertDialog.Builder (this) </td></tr></tbody></table><br>  An interesting feature of the syntax in Kotlin is: if parameters are passed to a function, and the last parameter is a function, then it can be taken out of the brackets.  This is what we see in the fragment, where lambda is transmitted in setPositiveButton, which will work when the ‚ÄúOK‚Äù button is pressed: <br><br><pre> <code class="java hljs">alert.setPositiveButton(<span class="hljs-string"><span class="hljs-string">""</span></span>) { dialog, whichButton -&gt; result = input.getText().toString() }</code> </pre><br>  The same can be written as <br><br><pre> <code class="java hljs">alert.setPositiveButton(<span class="hljs-string"><span class="hljs-string">""</span></span>, { dialog, whichButton -&gt; result = input.getText().toString() } )</code> </pre><br>  You are free to choose which option seems easier to read. <br><br><h5>  Using Java libraries in Kotlin code </h5><br>  Another nice thing is the ability to directly use libraries written in Java from code in Kotlin. <br><br>  For example, to properly process special characters and Unicode in project names when saving them in SQLite, I used the functions <i>StringEscapeUtils.escapeJava</i> and <i>StringEscapeUtils.unescapeJava</i> from the popular library, which is enough to import with the import statement (and fit the dependencies in the project properties): <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.commons.lang3.StringEscapeUtils</code> </pre><br><h5>  Return value </h5><br>  In Kotlin, functional literals (aka lambda functions) are not allowed to use return, since the functional literal returns the value calculated in the last expression.  So, in the <i>setOnTouchListener</i> call, <i>it</i> is expected that the last call parameter is a function that returns a <i>boolean</i> .  This value actually returns the <i>gestureDetector.onTouchEvent (aEvent)</i> . <br><br>  Java: <br><pre> <code class="java hljs">gestureListener = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnTouchListener() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v, MotionEvent event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gestureDetector.onTouchEvent(event); } };</code> </pre><br>  Kotlin: <br><pre> <code class="java hljs">getListView()?.setOnTouchListener() { v, aEvent -&gt; gestureDetector.onTouchEvent(aEvent) }</code> </pre><br>  You cannot write <i>return gestureDetector.onTouchEvent (aEvent)</i> in the code of the functional literal on Kotlin, the result of calling <i>gestureDetector.onTouchEvent (aEvent)</i> will be returned. <br><br><blockquote>  In fact, there are special cases where a nonlocal return should be used in a functional literal.  If interested, the details are in the <a href="http://kotlinlang.org/docs/reference/returns.html">documentation for Kotlin</a> </blockquote><br><br>  Similarly, returning values ‚Äã‚Äãby functions defined by the "=" sign works like this: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= data.size()</code> </pre><br><h5>  String patterns </h5><br>  To get rid of long strings that are difficult to read and give a suboptimal byte code, Kotlin uses string templates: <br><br><pre> <code class="java hljs">setMessage(<span class="hljs-string"><span class="hljs-string">" $projectToDelete?"</span></span>)</code> </pre><br>  Here projectToDelete is a string variable.  The syntax of this pattern is familiar to anyone who has dealt with environment variables in UNIX, for example.  Templates for strings composed of text and the values ‚Äã‚Äãof many variables, especially with formatting, are especially convenient: <br><br><pre> <code class="java hljs">secondsSpent.setText(<span class="hljs-string"><span class="hljs-string">"${format("</span></span>%<span class="hljs-number"><span class="hljs-number">02</span></span>d<span class="hljs-string"><span class="hljs-string">", hours)}:${format("</span></span>%<span class="hljs-number"><span class="hljs-number">02</span></span>d<span class="hljs-string"><span class="hljs-string">",minutes)}:${format("</span></span>%<span class="hljs-number"><span class="hljs-number">02</span></span>d<span class="hljs-string"><span class="hljs-string">", seconds)}"</span></span>)</code> </pre><br>  By the way, an interesting story came out with formatting along the way: the <i>String</i> type in Kotlin is its own, and there is no <i>format</i> method in it, so I had to import <i>java.lang.String.format</i> explicitly and then access it.  Surprisingly, by the way, neither Java nor Kotlin still has the secondsToHumanReadableString method that converts an integer number of seconds into a format string <pre>  HH: MM: SS. </pre><br><h5>  when and with </h5><br>  It is very convenient to use <i>when</i> for multiple choice and <i>with with</i> to reduce calls to methods and properties - both are enough even in a small Android application.  In my case, this made the code easier to read, for example: <br><br><pre> <code class="java hljs">with (alert) { setPositiveButton(<span class="hljs-string"><span class="hljs-string">""</span></span>) { dialog, whichButton -&gt; ...      ... } setNegativeButton(<span class="hljs-string"><span class="hljs-string">""</span></span>) { dialog, whichButton -&gt; } <span class="hljs-comment"><span class="hljs-comment">//  ""      create() show() }</span></span></code> </pre><br>  Without <i>with</i> would be <i>alert.setPositiveButton, alert.setNegativeButton, alert.create, alert.show</i> .  When also improves readability: <br><br><pre> <code class="java hljs">when (item.status) { <span class="hljs-string"><span class="hljs-string">"active"</span></span> -&gt; { item.status = <span class="hljs-string"><span class="hljs-string">"inactive"</span></span> ...      ... } <span class="hljs-string"><span class="hljs-string">"inactive"</span></span> -&gt; { item.status = <span class="hljs-string"><span class="hljs-string">"active"</span></span> ...     ... } }</code> </pre><br><h4>  Compiling with Gradle </h4><br>  If you create <i>build.gradle</i> with your hands and / or build a project with gradle without an IDE, then read <a href="http://kotlinlang.org/docs/reference/using-gradle.html">how to make friends with gradle, Kotlin and Android</a> on <a href="http://kotlinlang.org/">Kotlinlang.org</a> . <br><br>  I don‚Äôt know if Android Studio users have such a problem, but for a person familiar with IntelliJ IDEA, working with Gradle may raise the question of how to compile <i>.apk</i> for a release, not for debugging. <br><br>  To do this, IDEA has a Gradle plugin, which opens by clicking on the tab to the right: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f85/282/021/f85282021583cfc744389122ee050f44.png"><br><br>  By default IDEA collects <i>* -debug-unsigned.apk</i> , i.e.  what you don't put on google play.  To make it <i>* -release-signed.apk</i> , you need to generate a key for the signature, put it in the keystore, and enter a few lines in the <i>build.gradle of</i> your project so that Gradle knows where to get the key.  To build a release, select the <i>assembleRelease</i> task in the Gradle window by double-clicking on it. <br><br>  You either already know about how to create a key and sign an application, or you can <a href="http://stackoverflow.com/questions/18328730/how-to-create-a-release-signed-apk-file-using-gradle">read more on stackoverflow</a> . <br><br><h4>  On a note </h4><br>  Recently opened our new site about Kotlin <a href="http://kotlinlang.org/">kotlinlang.org</a> , which is hosted on Jekyll + Github.  Than this decision is good, on Habr√© recently <a href="http://habrahabr.ru/post/228337/">already wrote</a> . <br><br>  If in the article some code examples seemed beautiful to you, then this is undoubtedly the merit of <i>Natalia Ukhorska</i> , who works with us in the Kotlin team.  I am very grateful to Natasha for the advice, without which this article would have been shorter, and the code less similar to the classic Kotlin. <br><br>  We will be very happy if the hours saved by using Kotlin can be spent on the beach.  Good <s>rest of</s> summer! <br><br>  <b>UPD from 07/31/1412, 18:55</b> : corrected some terms and formulations. </div><p>Source: <a href="https://habr.com/ru/post/231525/">https://habr.com/ru/post/231525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../231511/index.html">What languages ‚Äã‚Äãshould I translate my product into?</a></li>
<li><a href="../231513/index.html">Creating audio plugin, part 14</a></li>
<li><a href="../231519/index.html">How to respond to freelancing projects</a></li>
<li><a href="../231521/index.html">The Head of the Ministry of Communications and Mass Media proposed Apple and SAP to disclose their source codes to Russian specialists.</a></li>
<li><a href="../231523/index.html">Binding session to server in nginx. Nginx-sticky-module</a></li>
<li><a href="../231527/index.html">SERP Yandex and Google: Analyzing competitors, researching industries - advodka.com</a></li>
<li><a href="../231529/index.html">cool-old-term - good old terminal</a></li>
<li><a href="../231531/index.html">The evolution of search engine algorithms</a></li>
<li><a href="../231533/index.html">Cumulus Linux for the network in the data center</a></li>
<li><a href="../231535/index.html">American scientists have created an air light guide, which repeatedly improves the propagation of a laser beam in the air.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>