<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I made a game under AVR</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It has long been the desire to write an article on some crafts. But day after day, reading another article about the next "smart home" or "smart weath...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I made a game under AVR</h1><div class="post__text post__text-html js-mediator-article">  It has long been the desire to write an article on some crafts.  But day after day, reading another article about the next "smart home" or "smart weather station on Ar ..." less and less wanted to write exactly the same thing, but from a different angle, and so I had not much.  And then one day ... <br><br><img src="https://habrastorage.org/files/1f6/6f0/a99/1f66f0a99be4476387c6d4f3d755f071.png"><br><br>  Attention!  Under the cut curve code, a couple of images and a lot of water. <br><a name="habracut"></a><br>  It all started with the fact that once I noticed my soul mate playing a game about the once popular Internet meme "Nyan Cat", I liked it so much that I uncontrollably wanted to make a game with it!  A quick search for similar articles on GT and H gave zero results.  In principle, it is not surprising, few people today will bother and do something like this (I know that there is a GameBuino, but on GT and H there is not a single mention).  Well, once empty, then fill this emptiness! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  The essence </h3><br>  Do something retro style, something simple ... And of course!  Immediately comes to mind the classics of the genre - Space Invaders.  What could be easier than making your clone? <br><br>  We make a cat that shoots (no matter what) at the invaders, simultaneously dodging return fire.  It turned out not so simple.  More precisely, I made myself not easy. <br><br><h3>  Iron </h3><br>  Atmel AVR ATmega328P microcontroller at 16 MHz (Arduino Nano board).  Screen ILI9341 SPI TFT 2.4 ‚Äù320x240 and resistive touch screen on driver XPT2046 (Chinese clone ADS7846).  The screen with Ali was ordered (intended for an oscilloscope on an STM32), which I regretted first, since there are almost no normally working libraries for a touch screen driver.  Subsequently, this was a profit in the form of a workable library, albeit assembled from pieces. <br><br><h3>  Soft </h3><br>  Unfortunately, due to its titanic laziness, the Arduino IDE was used at first.  Then, because of the expanded project, it became crowded there, and I switched to Sublime Text 2 and then screwed on the Arduino IDE (libraries, compiler ‚Äî too hard to refuse).  In the end, for the sake of sporting interest and optimization, I collected everything in Atmel Studio (Someone would say that they needed to write there right away! As I already wrote: just laziness).  As a result, he left everything under the Arduino IDE, based on the considerations that not everyone has the desire to install and understand Atmel Studio. <br><br><h3>  Images </h3><br>  Since the resources of the controller are very modest, then some ideas were later abandoned (for example, the background became monochrome, although there was texture in the plans).  Moreover, I had to re-read a bunch of articles on NES, it was from them that I learned some optimization tricks. <br><br>  The first problem began with the images, namely because of their size.  Places just not enough.  The screen accepts colors of 16 bits per pixel, i.e.  we draw pictures in RGB565.  Reading images via SPI from an SD card without DMA is very expensive and time consuming. <br>  For example, the picture below takes up at a size of 51x20 - 1360 bytes, but for normal animation, these need 6! <br><br><div class="spoiler">  <b class="spoiler_title">One of 6 frames</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/0d8/8b6/656/0d88b665681b4a1b982b3b14bfd29f7d.png"><br></div></div><br>  We proceed to the <s>curvature of the</s> compression <s>space of the</s> image.  The first solution that was found instantly is to use duplicate elements. <br><br>  For example, a rainbow can be made from two pictures, which is four less!  Next is the body.  This is the same body in all 6 frames!  Instead of 6 we use one!  Identical with the head.  The rest does not contain repetitions (or can be neglected). <br><br>  It all comes together <i>on the</i> screen, because it does not clear the image, but stores it in the internal buffer, which also imposes certain restrictions.  For example, if you first draw the head, and then the body, then it will look like this: <br><br><div class="spoiler">  <b class="spoiler_title">Not to look nervous!</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ab3/460/35d/ab346035d3914d5d91f97720d31638a8.png"><br></div></div><br>  After a set of individual images remains, they still occupy a lot (5504 bytes instead of 8160). <br><br>  I will continue with the rainbow.  If you use only the colors of the rainbow instead of the entire image and draw a rainbow code. <br><br><div class="spoiler">  <b class="spoiler_title">So:</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawRainbow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// rainbow size: 24x21 (WxH) uint8_t countRainbow; // count of colors uint8_t rbElementY = 0; // pos of small block in Y uint8_t rbElementX = 0; // position of each block in X uint8_t rbElementNum = 2; // first up, after down blocks uint16_t color; rainbowState = !rainbowState; // invert rainbow // Full rainbow consist of 4 blocks: 2 blocks up, 2 blocks down while(rbElementNum--) { // 6 colors + 2 color of background; just overdraw colors for(countRainbow=0; countRainbow &lt;= 7; countRainbow++) { color = PGRW_U16(pCatsRainbow, countRainbow); // 6 - width; 3 - heigth tftFillRect(rbElementX, rbElementY + nyan.base.posY + (rainbowState ? 1 : 0), 6, 3, color); tftFillRect(rbElementX+6, rbElementY + nyan.base.posY + (rainbowState ? 0 : 1), 6, 3, color); rbElementY += 3; } rbElementY = 0; // reset position rbElementX += 12; // now second - up or down bloks } }</span></span></code> </pre> <br></div></div><br>  The size of the rainbow will decrease from 2016 bytes to 16 bytes + approximately 200 bytes per code.  At the same time, a little lost in performance. <br><br>  Subtotal number 1. <br><br>  Approximately 1,800 bytes were freed up (the whole cat occupies 3,704).  Can you do less?  Of course!  Instead of huge arrays with colors, use two arrays: one color table with the uint16_t type, the second image, but instead of colors, the indices of the desired color in the color table.  For this, uint8_t is quite suitable (for 255 colors, that‚Äôs enough, hi GIF). <br><br>  Sub-total number 2. <br><br>  1944 bytes were released (the whole cat now occupies 1760).  Can you do less?  Can!  Carefully look at the arrays and see colossal sequences of the same type!  We run to read about <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25B4%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25B4%25D0%25BB%25D0%25B8%25D0%25BD_%25D1%2581%25D0%25B5%25D1%2580%25D0%25B8%25D0%25B9">RLE</a> compression (a funny coincidence, after a while, when a coder and a decoder were already done, several articles on RLE appeared on H, as I did not have enough of them a little earlier). <br><br>  If there were no problems with the decoder, I clearly knew what I would have at the entrance and what I would do with all this, then with the coder just the opposite ... <br><br>  The decoder goes to: <br><br>  - coordinates on the screen where we display the image; <br>  - height and width in pixels; <br>  - a table with color indices; <br>  - color table; <br>  - the size of the compressed image. <br><br><div class="spoiler">  <b class="spoiler_title">Decoder</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawBMP_RLE_PGR</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> w, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> h, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *colorInd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *colorTable, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sizePic)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// This is used when need maximum pic compression, // and you can waste some CPU resources for it; // It use very simple RLE compression; // Also draw background color; uint16_t count = 0; uint16_t repeatColor; uint8_t tmpInd, repeatTimes; // for big pics need uin16_t tftSetAddrWindow(x, y, x+w-1, y+h-1); while(count &lt; sizePic ) { // compressed pic size! // get color index or repeat times tmpInd = pgm_read_byte(colorInd + count ); if(~tmpInd &amp; 0x80) { // is it color index? repeatTimes = 1; } else { // nope, just repeat color repeatTimes = tmpInd - 0x80; // get previous color index to repeat tmpInd = pgm_read_byte(colorInd + (count - 1)); } // get color from colorTable by tmpInd color index repeatColor = PGRW_U16(colorTable, tmpInd); do { --repeatTimes; tftPushColor(repeatColor); } while (repeatTimes); ++count; } }</span></span></code> </pre><br></div></div><br>  The encoder <s>wrote</s> as smog on Qt (collected the Qt 4.8.6 statics under OS X).  The essence of the encoder: compress identical sequences in image files and place the result in header files. <br><br>  He came out very fastidious to the input images.  It is necessary to remove the alpha channel and export as raw data RGB565, well, at least in the Gimp this is done easily.  Usage: we place in the folder with the program * .data image files, run, and the output header files. <br><br>  Subtotal number 3. <br><br>  The place became the most for 229 bytes (all together it takes 1531).  Why so little?  Do not forget that because of some problems with drawing (incorrect color overlay), only the body was compressed by RLE.  Also, I did not consider the images of Invaders and gift, which were also compressed by RLE and reduced their size from 3456 bytes to 722 bytes. <br><br>  Further, most likely, there will be a much greater drop in performance on unpacking or a lack of memory (depending on the algorithm), so I‚Äôll stop on this. <br><br><h3>  Multitasking </h3><br>  The second problem came with an increase in the number of tasks.  In the beginning, there were few tasks and everything was performed sequentially, quite quickly - 20-28 frames per second.  Over time, the growth in the number of tasks led to a drop of up to 7-10 frames per second!  At first I was thinking about the banal lack of resources of the CPU, I had already planned to switch to a more serious MC.  But it dawned on me!  After all, I do actions that, in fact, do not require constant execution in each cycle!  It is necessary to smear tasks in time, to make something like multitasking! <br><br>  The first thing that came to mind: FreeRTOS ... Unfortunately, at 16 (17 if the output is debug info) tasks, this turned out to be beyond the capabilities of this AVR. <br><br>  The search for a solution led mainly to the <a href="https://geektimes.ru/users/dihalt/" class="user_link">DIHALT</a> articles.  After studying them, I made my <s>bike</s> task manager.  What is: <br><br>  - adding a task (as without it); <br>  - delete all or one task; <br>  - replace one task with another; <br>  - The number of tasks to 254 (in fact, how much memory is enough); <br>  - 9 bytes per task (less possible). <br>  - use timer 0 as the system timer; <br>  - Task call timeout (for the sake of it all was done); <br>  - flag of the need to perform the task; <br>  <s>- Stupid protection against non-allocation of blue screen memory;</s> <br>  <s>- pointers, many pointers;</s> <br>  <s>- ???;</s> <br>  <s>- PROFIT !!!</s> <br><br>  And some little else that I needed for my task manager <s>bike</s> .  Principle of operation: <br><br>  - create a structure (in it a pointer to an array and the number of current tasks); <br>  - we indicate that this is our main array of tasks; <br>  - add all the tasks you need; <br>  - call the runTasks () function and don't return from there anymore. <br><br><div class="spoiler">  <b class="spoiler_title">Thanks to this, the main loop began to look like this:</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runTasks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> currentMillis; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> count; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(;;) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(count=<span class="hljs-number"><span class="hljs-number">0</span></span>; count &lt; pCurrentArrTasks-&gt;tasksCount; count++) { <span class="hljs-comment"><span class="hljs-comment">// Have func and need execute? if(pCurrentArrTasks-&gt;pArr[count].pTaskFunc &amp;&amp; pCurrentArrTasks-&gt;pArr[count].execute) { currentMillis = TIMER_FUNC; // check timeout if((currentMillis - pCurrentArrTasks-&gt;pArr[count].previousMillis) &gt; pCurrentArrTasks-&gt;pArr[count].timeToRunTask) { pCurrentArrTasks-&gt;pArr[count].previousMillis = currentMillis; pCurrentArrTasks-&gt;pArr[count].pTaskFunc(); } } } } }</span></span></code> </pre><br></div></div><br>  In the main loop, the whole array of tasks is sorted.  Tasks are performed only by timeout and if the flag is executed in truth. <br>  I won‚Äôt say anything about the effectiveness of the decision, I‚Äôll just write that it‚Äôs much better!  Even this implementation curve has unloaded the CPU and the drop in the frame rate has disappeared completely from the word. <br><br><h3>  A space flight </h3><br>  In the original, the cat flies in space past the stars (judging by the blue background flies on near-light), it does not matter that we will fasten the stars and we will move them! <br><br>  Remember that memory is not as much as we would like.  Therefore, after adding the necessary tasks and only after that, if there is enough free space, stars are created. <br><br><div class="spoiler">  <b class="spoiler_title">We create as follows:</b> <div class="spoiler_text"><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>((maxStars &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; (starStruct == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">// if we cant make so much stars if((starStruct = (tStarType*) malloc(sizeof(tStarType) * maxStars)) == NULL) --maxStars; // we try to make for one less }</span></span></code> </pre><br></div></div><br>  But the stars on the screen can fit a lot, do you really have to write coordinates for each?  No, we assign pseudo-random values.  Let's take the temperature value from the 8th ADMUX channel (we don't care for accuracy, the more accurate the better) and load it into the srand (if the temperature is always the same, then the rand will be identical). <br><br><div class="spoiler">  <b class="spoiler_title">Measure the temperature:</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> getTemp(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// The internal temperature has to be used // with the internal reference of 1.1V. // Set the internal reference and mux. ADMUX = ((1&lt;&lt;REFS1) | (1&lt;&lt;REFS0) | (1&lt;&lt;MUX3)); ADCSRA |= (1&lt;&lt;ADEN); // enable the ADC ADCSRA |= (1&lt;&lt;ADSC); // Start the ADC // Detect end-of-conversion while(ADCSRA &amp; (1&lt;&lt;ADSC)); return ADC; }</span></span></code> </pre><br></div></div><br>  If at least one star was created, then we apply the parameters for each: <br><br><div class="spoiler">  <b class="spoiler_title">pseudorandom:</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(maxStars) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> count =<span class="hljs-number"><span class="hljs-number">0</span></span>; count &lt; maxStars; count++) { starStruct[count].state = randNum() % STAR_STEP; starStruct[count].posX = randNum() % TFT_W + <span class="hljs-number"><span class="hljs-number">22</span></span>; starStruct[count].posY = randNum() % TFT_H + <span class="hljs-number"><span class="hljs-number">22</span></span>; } }</code> </pre><br></div></div><br><h3>  Invaders </h3><br>  They are.  There are five of them (it fits so well in a row) and they are like a terminator (they come back all the time). <br><br><h3>  Optimization </h3><br>  After transferring to Atmel Studio (pulling out what you need from Arduino), where you could easily get an asm listing and understand something that I did, I began to rewrite the used libraries and some code constructs (some will notice that I did not understand the unknown garbage, and will be right). <br><br>  What did it do?  It freed up about 6 Kbytes of ROM, reduced the amount of RAM used, and increased the speed of data transmission over SPI (having sacrificed some features). <br><br><h3>  Total </h3><br>  Although the game is primitive, it works quite well and can take some time.  Moreover, 10 KB of free RAM and about 1 KB of RAM remain. <br><br>  What are the plans: <br><br>  - Adding sound.  Without it, it's boring to press the stylus on the screen. <br>  - Add more different animations for a more lively game. <br>  <s>- Win minor bugs.</s> <br>  - Transfer to a more serious MK and the addition of new buns, or those that did not fit. <br><br>  <a href="https://drive.google.com/file/d/0BwykwCFSBD5aaVk2Z1B4Y2NHQ2M/view%3Fusp%3Dsharing">Archive with the game.</a> <br><br>  <a href="https://drive.google.com/file/d/0BwykwCFSBD5aR3l2YUNsQXRNNFE/view%3Fusp%3Dsharing">Archive with coder.</a> <br><br>  Actually, the game looks like: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/88LUGoa6RLg%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjjElmG-osIpvkrR23ofdZbhdW38w" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/371713/">https://habr.com/ru/post/371713/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../371695/index.html">How to listen to Soviet citizens. A bit of history and modern realities</a></li>
<li><a href="../371697/index.html">Genetics using CRISPR have removed the defective gene, leading to retinal degeneration</a></li>
<li><a href="../371699/index.html">France will build a 1000-kilometer road of solar panels</a></li>
<li><a href="../371701/index.html">What is the best rocket engine?</a></li>
<li><a href="../371707/index.html">NASA unveiled video of the Dawn probe span over Ceres</a></li>
<li><a href="../371715/index.html">Set to turn any apartment into a "smart home"</a></li>
<li><a href="../371717/index.html">Removing Facebook can increase the life of your smartphone by 20%.</a></li>
<li><a href="../371719/index.html">Satellite surveillance</a></li>
<li><a href="../371723/index.html">Review and comparative testing of PC "Elbrus 401 ‚Äë PC". Part Two - Software</a></li>
<li><a href="../371725/index.html">In Russia, earned a registry of domestic software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>