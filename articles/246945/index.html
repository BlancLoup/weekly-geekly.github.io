<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>TorrentLocker - a new modification of the FileCoder encryption Trojan, part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Extorcists (ransomware) are a special class of malicious software that is used by attackers to encrypt various files on a user's computer, as well as ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>TorrentLocker - a new modification of the FileCoder encryption Trojan, part 1</h1><div class="post__text post__text-html js-mediator-article">  Extorcists (ransomware) are a special class of malicious software that is used by attackers to encrypt various files on a user's computer, as well as prohibiting the launch of various applications in the system in order to get a ransom from the user.  After performing its actions in the system, the malicious program gives the user a special message.  The message indicates that in order to obtain further access to a computer or encrypted files, the user needs to transfer a certain amount of money to the account of the intruders. <br><br><img src="https://habrastorage.org/files/f64/24c/03b/f6424c03b7ed4f8da5a0fe0d52e59bcd.jpg"><br><br><a name="habracut"></a>  <b>Win32 / Filecoder.DI malware</b> , also known as <b>TorrentLocker</b> , specializes in encrypting user documents, image files, and other file types.  In this case, for deciphering from the user, money is extorted in Bitcoin currency.  The extorted amount for decrypting files is 4,081 bitcoins, which is approximately $ 1,500.  Only Bitcoin cryptocurrency is accepted for payment. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The very name TorrentLocker was assigned to this modification by FileCoder by iSIGHT Partners, the first mention refers to their next post.  It was taken from the name of the Bit Torrent Application registry key that was used by the malicious program to store configuration information.  Although its latest modifications no longer used this registry key.  Below is the path to this section in the system registry. <br><br>  <i>HKEY_CURRENT_USER \ Software \ Bit Torrent Application \ Configuration</i> <br><br>  Cybercriminals have assigned a special name to their development project TorrentLocker, it is called <b>Racketeer</b> .  Some function names in malware code begin with the ‚Äúrack‚Äù prefix, for example, rack_init, rack_encrypt_pc.  The names of the script files on the C &amp; C server also begin with this prefix, for example, rack_cfg.php, rack_admin.php.  The English word ‚Äúracket‚Äù in Russian means ‚Äúracket‚Äù and well describes the purpose of TorrentLocker, namely, it creates a problem for the user, which can be solved only by purchasing a special tool from attackers through which you can decrypt files on your computer. <br><br>  Below are the key aspects that were found when analyzing this malware and its distribution campaign. <br><br><ul><li>  The malware infected 39,670 computers, and users of 570 of them paid attackers for decoding. </li><li>  The total amount of payments of these victims is from $ 292,700 to $ 585,401 in bitcoins. </li><li>  In accordance with the data that we received from the managers of the C &amp; C servers, about 285 million documents were encrypted during the entire period of the malicious campaign. </li><li>  We believe that the attacker group that distributed TorrentLocker is the same criminal group that previously specialized in distributing <a href="http://habrahabr.ru/company/eset/blog/193318/">Hesperbot</a> banking malware. </li><li>  Special spam mailings that attackers used to distribute TorrentLocker were sent to certain countries.  A list of such countries is presented below. <br><ul><li>  Australia </li><li>  Austria </li><li>  Canada </li><li>  Czech </li><li>  Italy </li><li>  Ireland </li><li>  France </li><li>  Germany </li><li>  Holland </li><li>  New Zealand </li><li>  Spain </li><li>  Turkey </li><li>  Great Britain </li></ul><br></li><li>  The authors resorted to changing the file encryption algorithm and instead of using the CTR mode of the AES algorithm, they began to use the CBC mode.  This allowed them to close a loophole, which previously could be used to decrypt files without the involvement of a malicious tool. </li><li>  The first in-the-wild detections of this malware were recorded by our telemetry system in February 2014. </li></ul><br>  <b>Infection vector</b> <br><br>  The data we received from victims of TorrentLocker infections indicates that the infection vector has always been a phishing email with an attachment in the form of an executable file.  This executable file was disguised as an Office document and was a malicious program dropper.  ESET telemetry data show that phishing messages were the only TorrentLocker distribution vector since August 2014. The infection process consists of several sequential steps, which are shown in the diagram below. <br><br><img src="https://habrastorage.org/files/47a/271/517/47a27151798748d3a3b420cab8cc3008.png"><br>  Figure 1. Scheme of infection of a user with a TorrentLocker malware. <br><br>  As shown in fig.  1, there are various ways to install a TorrentLocker dropper into the system, starting from the stage when the user opened the email message.  We witnessed all the paths that are shown above in the figure.  For example, the executable file of a malicious program could be located in a .zip archive, which was an attachment.  In other cases, the message contained a URL link to download such an archive.  And to lull the vigilance of the user, the attackers used a special captcha. <br><br>  We recorded several phishing emails that were used by attackers: <br><br><ul><li>  Unpaid invoice. </li><li>  Notification on the status of the sent parcel. </li><li>  Unpaid speeding penalty. </li></ul><br>  In all these cases, the text of messages was compiled in the native language of the countries listed above.  In addition, the attackers used special fake domains in their email addresses to send phishing emails.  At the same time, domains are very similar to their legitimate counterparts belonging to a particular private or public organization. <br><br>  A download web page is an effective way to deliver a malicious program that was used by hackers.  The message prompted the user to navigate through the URL to such a web page.  After the user made the transition, the TorrentLocker file was downloaded to his computer.  These web pages were visible only in the specific country for which the phishing emails were intended.  In the event that a user who does not belong to such a country finds himself on such a web page, he is redirected to the Google search page.  This filtering of users was carried out on the basis of checking the IP addresses of visitors.  The same applies to users of mobile devices, but in their case it was proposed to go for viewing on a PC.  This message is presented below in the screenshot. <br><br><img src="https://habrastorage.org/files/70a/684/1fd/70a6841fdf864ab89f7072782477ca4d.png"><br>  Fig.  2. Download web page with notification for mobile users. <br><br>  The attackers behind this malicious campaign specifically purchased domains that looked like legitimate ones.  They were used to generate email addresses and URLs to malware.  The table below shows a list of such domains. <br><br><img src="https://habrastorage.org/files/6ad/13a/711/6ad13a711d034c8199d566354256062d.png"><br><br>  To put down the vigilance of potential victims, a malicious mechanism called CAPTCHA was used on malicious websites.  In the first versions of such web pages, to download malicious content, the user only had to enter any character in the CAPTCHA field.  In newer versions, the entered characters must strictly correspond to the CAPTCHA. <br><br><img src="https://habrastorage.org/files/5c5/ba3/6ad/5c5ba36adebc46bbb1a1b9491b3f1e8f.png"><br>  Fig.  3. Examples of malicious web pages. <br><br>  In November 2014, we observed a new method for distributing malicious files TorrentLocker.  The attackers still used phishing messages, but now the malicious .zip archive was placed as an attachment to an e-mail message.  In addition, the archive itself now contained not a executable file of TorrentLocker, but a .doc file with a script on VBA.  This script (script) is used to download and execute the TorrentLocker dropper.  The script itself is obfuscated. <br><br><img src="https://habrastorage.org/files/6a3/93d/e9d/6a393de9d6254c5d84b49a3018f7d47f.png"><br>  Fig.  4. Original obfuscated VB code. <br><br><img src="https://habrastorage.org/files/133/381/d68/133381d6851e4b66a30bbb0b3c270fad.png"><br>  Fig.  5. Code without obfuscation. <br><br>  This VB code downloads the executable file from a remote server and then launches it for execution.  The file name is disguised as an .png image file. <br><br>  <b>General scheme of work</b> <br><br><img src="https://habrastorage.org/files/efa/843/406/efa8434060184f1fb53c3402c33e2a2e.png"><br>  Fig.  6. The general scheme of the malware. <br><br>  When the main part (core) of the TorrentLocker malware is launched, it requests from the C &amp; C server a web page requesting a ransom.  This web page contains the text of the notification for the user that the files are encrypted and he needs to pay the necessary amount to decrypt them.  If the remote download operation of this page was successful, TorrentLocker generates a special 256-bit AES-key.  This key will be encrypted with a public 2048-bit RSA key, which is hardcoded in the body of the malware.  It will then be sent to a remote C &amp; C server.  The malware then initiates the process of encrypting files of a certain type using this AES key.  The list of file types is extensive and hard-wired in the body of the TorrentLocker executable file. <br><br>  As soon as TorrentLocker has finished the file encryption operation, it destroys the key in memory by calling <i>memset (aes_key, 0, aes_key_size)</i> .  Thus, for researchers of this malware, it becomes impossible to get a key from memory when debugging it.  The mentioned memset call is made for each copy of the key, if it has been duplicated by the code of the malicious program in its process.  After that, TorrentLocker displays the previously downloaded web page to the user. <br><br><img src="https://habrastorage.org/files/c19/101/475/c191014750b3408f848e474167b9e36b.png"><br>  Fig.  7. Example of a redemption web page in English. <br><br>  The above ransom web page contains a link to the payment page that is located on the .onion domain, that is, it belongs to the Tor network.  It is interesting to note that this domain also appears as one of the C &amp; C servers accessed by the TorrentLocker code.  The screenshot above shows a reference to another type of cryptographer - <a href="http://habrahabr.ru/company/eset/blog/207532/">CryptoLocker</a> .  Perhaps this is done in order to mislead the victim. <br><br><img src="https://habrastorage.org/files/e7f/330/4a2/e7f3304a29fd4251945f6fdb9289ae28.png"><br>  Fig.  8. Sample payment web page in English for UK users. <br><br>  In the next part, we will focus on analyzing the code of this malicious program and the mechanisms for its work with the C &amp; C server. </div><p>Source: <a href="https://habr.com/ru/post/246945/">https://habr.com/ru/post/246945/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246935/index.html">The digest of interesting materials for the mobile developer # 85 (December 22-28)</a></li>
<li><a href="../246937/index.html">Thermal barriers, tombstones and other delights of printed circuit boards</a></li>
<li><a href="../246939/index.html">Review of the most interesting materials on data analysis and machine learning ‚Ññ28 (December 22 - 28, 2014)</a></li>
<li><a href="../246941/index.html">Vkontakte analysis on the example of the book preferences of participants of cultural communities</a></li>
<li><a href="../246943/index.html">A simple typing tutor for programmers</a></li>
<li><a href="../246947/index.html">Creating a synchronization barrier using C ++ 11</a></li>
<li><a href="../246951/index.html">Playing with genetic algorithms</a></li>
<li><a href="../246953/index.html">Why does OpenVPN slow down?</a></li>
<li><a href="../246955/index.html">FLProg and penguins</a></li>
<li><a href="../246957/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ140 (December 22 - 28, 2014)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>