<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Generating invitations similar to invites from habrahabr</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The script generates invitations to register on the site in the form of a picture of 51x51 pixels of PNG format, written in PHP, uses MySQL as a datab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Generating invitations similar to invites from habrahabr</h1><div class="post__text post__text-html js-mediator-article">  The script generates invitations to register on the site in the form of a picture of 51x51 pixels of PNG format, written in PHP, uses MySQL as a database.  Made for the sake of interest, it will be interesting only for beginners. <br><a name="habracut"></a><br>  With the help of the <a title="GD" href="http://www.boutell.com/gd/">GD</a> library, you can easily create and edit images of various formats.  To create images we need several functions: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">int</font> imagecolorallocate(resource image, <font color="#0000ff">int</font> red, <font color="#0000ff">int</font> green, <font color="#0000ff">int</font> blue)</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  and <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">int</font> imagecolorallocatealpha(resource image, <font color="#0000ff">int</font> red, <font color="#0000ff">int</font> green, <font color="#0000ff">int</font> blue, <font color="#0000ff">int</font> alpha)</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  both functions return a color id for the image.  The only difference in the alpha parameter, which sets the transparency of the image.  But since there have been problems with PNG transparency in IE since ancient times, it is better to use the first function.  The first <em>image</em> argument can be obtained using the function: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">resource imagecreate( <font color="#0000ff">int</font> x, <font color="#0000ff">int</font> y)</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  it returns an image id representing an empty x-by-y palette image. <br><br>  First you need to create a table in the database: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">TABLE</font> <font color="#0000ff">IF</font> <font color="#0000ff">NOT</font> <font color="#0000ff">EXISTS</font> `di_invite` ( <br> `invite_id` <font color="#0000ff">int</font> (15) unsigned <font color="#0000ff">NOT</font> <font color="#0000ff">NULL</font> AUTO_INCREMENT, <br> `invite_hash` <font color="#0000ff">varchar</font> (32) <font color="#0000ff">COLLATE</font> utf8_unicode_ci <font color="#0000ff">DEFAULT</font> <font color="#0000ff">NULL</font> , <br> `invite_serialize` text <font color="#0000ff">COLLATE</font> utf8_unicode_ci, <br> `invite_username_owner` <font color="#0000ff">varchar</font> (25) <font color="#0000ff">COLLATE</font> utf8_unicode_ci <font color="#0000ff">DEFAULT</font> <font color="#0000ff">NULL</font> , <br> `invite_username_recipient` <font color="#0000ff">varchar</font> (25) <font color="#0000ff">COLLATE</font> utf8_unicode_ci <font color="#0000ff">DEFAULT</font> <font color="#0000ff">NULL</font> , <br> <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> (`invite_id`) <br> ) ENGINE=MyISAM <font color="#0000ff">DEFAULT</font> CHARSET=utf8 <font color="#0000ff">COLLATE</font> =utf8_unicode_ci AUTO_INCREMENT=1 ; <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  The database will store the unique identifier of each invitation (invite_id), invitation hash (invite_hash), an array with four RGB components, a byte-stream representation (invite_serialize), the nickname of the invitation owner (invite_username_owner) and the nickname of the user who activated it (invite_username_recipient). <br><br>  Now you need to create an array of 3x4, with the values ‚Äã‚Äãof the red, green and blue components for each of the four colors and write it in the database. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  function add_invite () { </li><li>  <font color="#008000">// Creates four random colors and writes them into an array</font> </li><li>  $ rgb_array = Array (); </li><li>  <font color="#0000ff">for</font> ($ idx = 0; $ idx &lt;4; ++ $ idx) { </li><li>  $ rgb = array (); </li><li>  <font color="#0000ff">for</font> ($ idx2 = 0; $ idx2 &lt;3; ++ $ idx2) $ rgb [] = mt_rand (0, 255); </li><li>  $ rgb_array [] = $ rgb; </li><li>  } </li><li>  <font color="#008000">// Transposes the array to a byte-stream representation for writing to the database.</font> </li><li>  $ serialize = serialize ($ rgb_array); </li><li>  <font color="#008000">// Hash invite</font> </li><li>  $ hash = md5 ($ serialize); </li><li>  <font color="#008000">// Inserts</font> </li><li>  $ _CORE [ <font color="#A31515">'db'</font> ] -&gt; query ( <font color="#A31515">'INSERT INTO `di_invite` (` invite_hash`, `invite_serialize`,` invite_username_owner`) VALUES (?,?,?);'</font> , $ Hash, $ serialize, $ _CORE [ <font color="#A31515">'user'</font> ] -&gt; user_info [ <font color="#A31515">'user_name'</font> ]); </li><li>  <font color="#0000ff">if</font> ($ _CORE [ <font color="#A31515">'db'</font> ] -&gt; affected_rows () == 1) <font color="#0000ff">return</font> array ( <font color="#0000ff">true</font> , <font color="#A31515">'Invite' '</font> . $ hash. <font color="#A31515">' "created '</font> ); </li><li>  <font color="#0000ff">else</font> <font color="#0000ff">return</font> array ( <font color="#0000ff">false</font> , <font color="#A31515">'ERROR - database error'</font> ); </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  We need to think about how this invitation to give to the user.  Of course, this can be done most easily by presenting it in the form of a picture.  When generating an image, you should take into account that instead of an activated invite, you should give a black and white picture, otherwise a full-fledged four-color invite. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">if</font> (isset ($ _ GET [ <font color="#A31515">'hash'</font> ] {31})) { </li><li>  <font color="#008000">// searches the database for an invite with such a hash</font> </li><li>  $ result = $ _CORE [ <font color="#A31515">'db'</font> ] -&gt; query ( <font color="#A31515">'SELECT `di_invite``ininite_serialize`,` di_invite``ininite_username_recipient` FROM `di_invite` WHERE` di_invite``invite_hash` =?;'</font> , $ hash ); </li><li>  <font color="#008000">// if found</font> </li><li>  <font color="#0000ff">if</font> ($ result &amp;&amp; $ _CORE [ <font color="#A31515">'db'</font> ] -&gt; num_rows () == 1) { </li><li>  <font color="#008000">// if the invitee has already been used, then give the black and white picture</font> </li><li>  <font color="#0000ff">if</font> ($ _CORE [ <font color="#A31515">'db'</font> ] -&gt; result ($ result, 0, <font color="#A31515">'invite_username_recipient'</font> )! = = <font color="#A31515">'</font> )) { </li><li>  <font color="#008000">// Give the browser information that this is a picture</font> </li><li>  header ( <font color="#A31515">'Content-type: image / png'</font> ); </li><li>  <font color="#008000">// create a square 51px at 51px</font> </li><li>  $ im = ImageCreate (51, 51) or die ( <font color="#A31515">'Error creating image'</font> ); </li><li>  <font color="#008000">// selects two colors gray and white, and white will be used as a background for the image</font> </li><li>  $ color [1] = imagecolorallocate ($ im, 255, 255, 255); </li><li>  $ color [2] = imagecolorallocate ($ im, 200, 200, 200); </li><li>  <font color="#008000">// draws two gray rectangles diagonally</font> </li><li>  ImageFilledRectangle ($ im, 26, 0, 50, 25, $ color [2]); </li><li>  ImageFilledRectangle ($ im, 0, 25, 25, 50, $ color [2]); </li><li>  <font color="#008000">// Display the image in the browser</font> </li><li>  ImagePng ($ im); </li><li>  <font color="#008000">// Destroys it</font> </li><li>  imagedestroy ($ im); </li><li>  <font color="#008000">// otherwise, if the invite is not yet used</font> </li><li>  } <font color="#0000ff">else</font> { </li><li>  <font color="#008000">// restores the array</font> </li><li>  $ rgb_array = unserialize (mysql_result ($ result, 0, <font color="#A31515">'invite_serialize'</font> )); </li><li>  header ( <font color="#A31515">'Content-type: image / png'</font> ); </li><li>  $ im = ImageCreate (51, 51) or die ( <font color="#A31515">'Error creating image'</font> ); </li><li>  <font color="#008000">// selects 4 colors from the array values</font> </li><li>  <font color="#0000ff">for</font> ($ i = 0; $ i &lt;4; ++ $ i) </li><li>  $ color [$ i] = imagecolorallocate ($ im, $ rgb_array [$ i] [0], $ rgb_array [$ i] [1], $ rgb_array [$ i] [2]); </li><li>  <font color="#008000">// draws three rectangles, the fourth (i.e., the zero element of the array) the default color is the background of the image</font> </li><li>  ImageFilledRectangle ($ im, 0, 0, 25, 25, $ color [1]); </li><li>  ImageFilledRectangle ($ im, 26, 0, 50, 25, $ color [2]); </li><li>  ImageFilledRectangle ($ im, 0, 25, 25, 50, $ color [3]); </li><li>  ImagePng ($ im); </li><li>  imagedestroy ($ im); </li><li>  } </li><li>  } <font color="#0000ff">else</font> { </li><li>  exit (); </li><li>  } </li><li>  } <font color="#0000ff">else</font> { </li><li>  exit (); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  It remains the case for small, namely, to check the validity of the invitation.  To do this, it is enough to count the color value in the four corners of the picture into an array, and try to find the hash of the resulting array in the database. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  function validate_invite ($ hash_serialize, $ userfile) { </li><li>  <font color="#008000">// if there were no errors when loading the image, the image size does not exceed the allowable one and the type is adequate</font> </li><li>  <font color="#0000ff">if</font> (isset ($ userfile) &amp;&amp; is_uploaded_file ($ userfile [ <font color="#A31515">'tmp_name'</font> ]) &amp;&amp; $ userfile [ <font color="#A31515">'size'</font> ] &lt;5 * 1024 &amp;&amp; $ userfile [ <font color="#A31515">'type'</font> ] == <font color="#A31515">'image / png'</font> &amp;&amp; $ userfile [ <font color="#A31515">' error '</font> ] == 0) { </li><li>  <font color="#008000">// create an image based on the loaded</font> </li><li>  $ source = ImageCreateFromPNG ($ userfile [ <font color="#A31515">'tmp_name'</font> ]); </li><li>  <font color="#008000">// determine the points at which the color will be checked</font> </li><li>  $ x [] = 48;  $ y [] = 48;  $ x [] = 2;  $ y [] = 2;  $ x [] = 48;  $ y [] = 2;  $ x [] = 2;  $ y [] = 48; </li><li>  $ rgb_array = Array (); </li><li>  <font color="#0000ff">for</font> ($ i = 0; $ i &lt;4; ++ $ i) { </li><li>  <font color="#008000">// gets the color index at point</font> </li><li>  $ color_index = imagecolorat ($ source, $ x [$ i], $ y [$ i]); </li><li>  <font color="#008000">// gets the color for the index</font> </li><li>  $ color_tran = imagecolorsforindex ($ source, $ color_index); </li><li>  <font color="#008000">// written to array</font> </li><li>  $ rgb = Array (); </li><li>  $ rgb [] = $ color_tran [ <font color="#A31515">'red'</font> ]; </li><li>  $ rgb [] = $ color_tran [ <font color="#A31515">'green'</font> ]; </li><li>  $ rgb [] = $ color_tran [ <font color="#A31515">'blue'</font> ]; </li><li>  $ rgb_array [] = $ rgb; </li><li>  } </li><li>  <font color="#008000">// converts the array to a byte-stream representation for matching with the entry in the array</font> </li><li>  $ serialize_rgb_array = serialize ($ rgb_array); </li><li>  <font color="#008000">// gets hash</font> </li><li>  $ hash_serialize_rgb_array = md5 ($ serialize_rgb_array); </li><li>  <font color="#008000">// searches record in db</font> </li><li>  $ _CORE [ <font color="#A31515">'db'</font> ] -&gt; query ( <font color="#A31515">'SELECT `di_invite``ininite_id` FROM` di_invite` WHERE `di_invite`.`invite_hash` =?;'</font> , $ Hash_serialize_rgb_array); </li><li>  <font color="#008000">// if found, clears the memory, and returns true, otherwise clears the memory and returns false</font> </li><li>  <font color="#0000ff">if</font> ($ _CORE [ <font color="#A31515">'db'</font> ] -&gt; num_rows () &lt;1) { </li><li>  imagedestroy ($ source); </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; </li><li>  } <font color="#0000ff">else</font> { </li><li>  imagedestroy ($ source); </li><li>  $ hash_serialize = $ hash_serialize_rgb_array; </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; </li><li>  } </li><li>  } <font color="#0000ff">else</font> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  It turns out that something similar to: <br><img src="https://habrastorage.org/storage/2c9f85ee/ddffdba9/b7815f9f/393ddf63.png"><br><br>  PS When building the image, one inaccuracy was allowed, due to which the images are not symmetrical. </div><p>Source: <a href="https://habr.com/ru/post/121921/">https://habr.com/ru/post/121921/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121912/index.html">Mail.Ru Group launches ICQ On-Site</a></li>
<li><a href="../121914/index.html">Samsung Galaxy Tab 8.9: millimeters</a></li>
<li><a href="../121915/index.html">Relaxing text editors for Linux</a></li>
<li><a href="../121916/index.html">Seminar "Java Card - extending the capabilities of smart cards using Java"</a></li>
<li><a href="../121920/index.html">Typography on the Web</a></li>
<li><a href="../121922/index.html">Salary Survey Results</a></li>
<li><a href="../121923/index.html">LulzSec "put" several well-known game servers</a></li>
<li><a href="../121924/index.html">Visual scripting</a></li>
<li><a href="../121925/index.html">MPI Basics</a></li>
<li><a href="../121926/index.html">KnockoutJS usage example</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>