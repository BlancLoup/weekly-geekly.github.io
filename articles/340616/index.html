<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OSX / Proton backdoor distributed with Trojanized Elmedia Player</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On October 19, our specialists noticed that Eltima , the developer of the popular free Elmedia Player, distributes an OSX / Proton- infected version o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OSX / Proton backdoor distributed with Trojanized Elmedia Player</h1><div class="post__text post__text-html js-mediator-article">  On October 19, our specialists noticed that <a href="https://www.eltima.com/">Eltima</a> , the developer of the popular free Elmedia Player, distributes an <a href="http://www.virusradar.com/en/OSX_Proton">OSX / Proton-</a> infected version of the application from the official website.  We contacted Eltima as soon as the problem was confirmed, and the company employees remained in touch throughout the incident. <br><br><img src="https://habrastorage.org/webt/59/ea/43/59ea43fd6b871272519044.jpeg"><br><br>  We publish a post, despite the fact that the study is not completed.  Information is preliminary and may be updated as new data becomes available. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><h3>  Chronology: </h3><br>  October 19: Trojansized package confirmed <br>  03:35 (MSK): sent a message to Eltima <br>  07:25 (MSK): Eltima has started troubleshooting <br>  08:10 (MSK): Eltima confirmed that the infrastructure has been cleared and distribution of legitimate applications has been resumed <br>  The 20th of October <br>  14:12 (MSK): a message has been posted on the Eltima website about the elimination of trojanized versions of Elmedia Player and Folx <br><br><h3>  Is my computer infected? </h3><br>  ESET advises anyone who has recently downloaded Elmedia Player software to check the system for compromise.  An infection is indicated by the presence of any of the listed files or directories: <br><br><ul><li> <code>/tmp/Updater.app/ /Library/LaunchAgents/com.Eltima.UpdaterAgent.plist /Library/.rand/ /Library/.rand/updateragent.app/</code> </li> <li> <code>/tmp/Updater.app/ /Library/LaunchAgents/com.Eltima.UpdaterAgent.plist /Library/.rand/ /Library/.rand/updateragent.app/</code> </li> <li> <code>/tmp/Updater.app/ /Library/LaunchAgents/com.Eltima.UpdaterAgent.plist /Library/.rand/ /Library/.rand/updateragent.app/</code> </li> <li> <code>/tmp/Updater.app/ /Library/LaunchAgents/com.Eltima.UpdaterAgent.plist /Library/.rand/ /Library/.rand/updateragent.app/</code> </li> </ul><br>  The presence of at least one file or directory means that the Elmedia Player application has been executed in the system and, with a high degree of probability, OSX / Proton is already running. <br><br>  If you downloaded Elmedia Player on October 19 before 08:15 (MSK) and started it, your system is compromised. <br><br>  According to our information, only the player version downloaded from the official Eltima website was compromised.  The built-in automatic update mechanism was probably not affected. <br><br><h3>  OSX / Proton Functions </h3><br>  OSX / Proton - backdoor with extensive data theft.  It may collect the following data: <br><br><ul><li>  Operating system information: equipment serial number (IOPlatformSerialNumber), current user's full name, node name, System Integrity Protection <code>csrutil status</code> ( <code>csrutil status</code> ), gateway information ( <code>route -n get default | awk '/gateway/ { print $2 }'</code> ) , current time and time zone </li><li>  Information from browsers Chrome, Safari, Opera and Firefox: history, cookies, bookmarks, logins and passwords, etc. </li><li>  Cryptocurrency wallets: Electrum: ~ / .electrum / wallets;  Bitcoin Core: ~ / Library / Application Support / Bitcoin / wallet.dat;  Armory: ~ / Library / Application Support / Armory </li><li>  SSH confidential data (all .ssh content) </li><li>  MacOS keychain data using a modified <a href="https://github.com/n0fate/chainbreaker/">chainbreaker</a> version </li><li>  Tunnelblick VPN Configuration (~ / Library / Application Support / Tunnelblick / Configurations) </li><li>  GnuPG data (~ / .gnupg) </li><li>  Data 1Password (~ / Library / Application Support / 1Password 4 and ~ / Library / Application Support / 1Password 3.9) </li><li>  List of installed applications </li></ul><br><h3>  How to clean the system? </h3><br>  As in any incident with a compromised administrator account, the only reliable way to get rid of malware is to completely reinstall the operating system.  It is necessary to take into account that the data listed in the previous section are likely to be compromised. <br><br><h3>  Supply-chain attack on Mac </h3><br>  In 2016, Transmission, a Bittorrent client for Mac, was used twice to distribute malware.  The <a href="https://habrahabr.ru/company/eset/blog/278749/">OSX / KeRanger encryption</a> featured in the first incident, and the <a href="https://habrahabr.ru/company/eset/blog/278749/">OSX / Keydnap</a> password theft tool in the second.  This year the Handbrake application for coding video on Mac was infected with <a href="https://blog.malwarebytes.com/threat-analysis/mac-threat-analysis/2017/05/handbrake-hacked-to-drop-new-variant-of-proton-malware/">OSX / Proton</a> . <br><br>  Now we have found that another popular Mac software, Elmedia Player, is used to distribute OSX / Proton, which, by the way, has reached 1 million users this summer. <br><br><img src="https://habrastorage.org/webt/59/ea/43/59ea43fee45ff530588861.png"><br>  <i>Source: <a href="https://twitter.com/Elmedia_Player/status/895995031802261504">twitter.com/Elmedia_Player/status/895995031802261504</a></i> <br><br><h3>  Technical analysis </h3><br>  OSX / Proton - Remote Access Trojan (RAT) Trojan sold on underground forums.  He was briefly described by <a href="https://www.cybersixgill.com/proton-a-new-mac-os-rat/">Sixgill</a> at the beginning of this year, then it was examined by <a href="https://blog.malwarebytes.com/threat-analysis/mac-threat-analysis/2017/05/handbrake-hacked-to-drop-new-variant-of-proton-malware/">Thomas Reed</a> from MalwareBytes, <a href="https://www.cybereason.com/labs-blog/labs-proton-b-what-this-mac-malware-actually-does">Amit Serper</a> from CyberReason and <a href="https://objective-see.com/blog/blog_0x1F.html">Patrick Wardle</a> from Objective-See. <br><br>  In our case, the attacker created a signed shell around the legitimate Elmedia Player and Proton.  In fact, we observed that shells were repackaged and re-signed in real time, all with the same valid Apple Developer ID.  (Certificate withdrawn by Apple.) <br><br>  <b>Clean application</b> <br>  (time stamps - EDT, EST) <br><br><img src="https://habrastorage.org/webt/59/ea/48/59ea4849afe4f002052830.png"><br><br>  <b>Triple Application</b> <br><br><img src="https://habrastorage.org/webt/59/ea/48/59ea4849acf64821576628.png"><br><br>  First, the shell launches the real Elmedia Player, stored in the application‚Äôs Resources folder: <br><img src="https://habrastorage.org/webt/59/ea/43/59ea43fd9d776801588941.png"><br><br>  Next, extracts and launches OSX / Proton: <br><br><img src="https://habrastorage.org/webt/59/ea/43/59ea43fdea9ae849894797.png"><br><br>  As you can see from the previous cases, OSX / Proton shows a fake login window for admin rights: <br><img src="https://habrastorage.org/webt/59/ea/43/59ea43fdd1899196478756.png"><br><br><h3>  Persistence </h3><br>  OSX / Proton provides persistence by adding LaunchAgent to all users when an administrator enters their password.  It creates the following files on the system: <br><br><ul><li>  /Library/LaunchAgents/com.Eltima.UpdaterAgent.plist </li><li>  /Library/.rand/updateragent.app </li></ul><br> <code>$ plutil -p /Library/LaunchAgents/com.Eltima.UpdaterAgent.plist <br> { <br> "ProgramArguments" =&gt; [ <br> 0 =&gt; "/Library/.rand/updateragent.app/Contents/MacOS/updateragent" <br> ] <br> "KeepAlive" =&gt; 1 <br> "RunAtLoad" =&gt; 1 <br> "Label" =&gt; "com.Eltima.UpdaterAgent" <br> }</code> <br> <br><h3>  Backdoor Commands </h3><br>  As already mentioned, OSX / Proton is a backdoor with a wide range of data theft functions.  The backdoor components studied can execute the following commands: <br><br><ul><li>  archive - archive files in zip </li><li>  copy - copy file locally </li><li>  create - locally create a directory or file </li><li>  delete - locally delete the file </li><li>  download - download file from URL </li><li>  file_search - search for files (executes find / -iname \ "% @ \" 2&gt; / dev / null) </li><li>  force_update - self-update with digital signature verification </li><li>  phonehome </li><li>  remote_execute - execute a binary file inside a zip-archive or a given shell command </li><li>  tunnel ‚Äî create an SSH tunnel through port 22 or 5900 </li><li>  upload - upload a file to the C &amp; C server </li></ul><br><br><h3>  C &amp; C server </h3><br>  Proton uses the domain of the management server that mimics the Eltima legitimate domain - the same principle as in the Handbrake case: <br><br><img src="https://habrastorage.org/webt/59/ea/4a/59ea4a2007b11786170749.png"><br><br><h3>  Indicators of compromise </h3><br>  The URL that distributes the trojan application at the time of detection: <br><br><ul><li>  hxxps: // mac [.] eltima [.] com / download / elmediaplayer.dmg </li><li>  hxxp: //www.elmedia-video-player.com/download/elmediaplayer.dmg </li></ul><br><h3>  C &amp; C Servers: </h3><br>  eltima [.] in / 5.196.42.123 (domain registered October 15, 2017) <br><br><h3>  Hashes </h3><br><img src="https://habrastorage.org/webt/59/ea/4b/59ea4b9a20c44961641786.png"></div><p>Source: <a href="https://habr.com/ru/post/340616/">https://habr.com/ru/post/340616/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340600/index.html">In search of perfect architecture</a></li>
<li><a href="../340602/index.html">How I stopped selling food on the street and started working in top technology companies</a></li>
<li><a href="../340604/index.html">Your own std :: code_error</a></li>
<li><a href="../340610/index.html">UI design in games on the example of NieR: Automata</a></li>
<li><a href="../340612/index.html">Classes of matrices and vectors in Delphi</a></li>
<li><a href="../340618/index.html">Security Week 42: KRACK WiFi, a hole in Intel processors, 250 Oracle patches</a></li>
<li><a href="../340620/index.html">A bug in finding emails on Mail.Ru</a></li>
<li><a href="../340626/index.html">The world in which IPv6 is well invented</a></li>
<li><a href="../340630/index.html">Work with Arduino's COM port from a Java application</a></li>
<li><a href="../340632/index.html">Chess for common development: the history of the development program</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>