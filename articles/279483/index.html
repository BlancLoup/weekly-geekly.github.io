<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Critical vulnerabilities in the client and server side of Git allow remote code execution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Information security researcher La√´l Cellier discovered two critical vulnerabilities in the client and server side of Git (CVE-2016-2324 and CVE ‚Äë 201...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Critical vulnerabilities in the client and server side of Git allow remote code execution</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/company/pt/blog/279483/"><img src="https://habrastorage.org/files/04c/abf/be4/04cabfbe415242c2a46ab21795b565fc.png"></a> <br><br>  Information security researcher La√´l Cellier <a href="http://seclists.org/oss-sec/2016/q1/645">discovered</a> two critical vulnerabilities in the client and server side of Git (CVE-2016-2324 and CVE ‚Äë 2016‚Äë2315). <br><br>  Using them, attackers can perform remote code execution.  To do this, you need to create a repository with a tree of files with very long names, and then send the "push" to the remote vulnerable server or allow the vulnerable client to pull out. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Two errors leading to problems are contained in a function called path_name (), which is used to add the file name to the end of the path in the repository tree.  The path and file name can be used by an attacker to run malicious code - to perform a successful attack, you need to overcome various defenses, such as ASLR, but <a href="http://security.stackexchange.com/questions/20497/stack-overflows-defeating-canaries-aslr-dep-nx/20502">you can</a> do it. <br><br>  This is how <a href="">revision.c</a> looked like for Git versions up to 2.7.0: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">path_name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> struct name_path *path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name_path</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *n, *m; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nlen = <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(name); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> len = nlen + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (p = path; p; p = p-&gt;up) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p-&gt;elem_len) len += p-&gt;elem_len + <span class="hljs-number"><span class="hljs-number">1</span></span>; } n = xmalloc(len); m = n + len - (nlen + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">strcpy</span></span>(m, name); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (p = path; p; p = p-&gt;up) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p-&gt;elem_len) { m -= p-&gt;elem_len + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(m, p-&gt;elem, p-&gt;elem_len); m[p-&gt;elem_len] = <span class="hljs-string"><span class="hljs-string">'/'</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n; }</code> </pre> <br>  Errors in the code lead to the possibility of integer overflow and buffer overflow. <br><br>  In addition, Positive Technologies researchers managed to create a valid exploit.  Vulnerability CVE-2016-1285 is the lack of validation of the field types of the RNDC control packet.  A specially crafted package can cause assertion failure in the modules sexpr.c or alist.c.  To conduct an attack, an unauthenticated attacker must be on a network from which named is allowed to receive control packets (the control section of the named.conf file). <br><br>  Packets transmitted by a TCP transport have a field-value table structure in which various fields can be binary data, nested tables or lists. <br><br>  Here is the code responsible for the lib / isccc / cc.c authorization check: <br><br><pre> <code class="cpp hljs"> _auth = isccc_alist_lookup(alist, <span class="hljs-string"><span class="hljs-string">"_auth"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_auth == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (ISC_R_FAILURE); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (algorithm == ISCCC_ALG_HMACMD5) hmac = isccc_alist_lookup(_auth, <span class="hljs-string"><span class="hljs-string">"hmd5"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> hmac = isccc_alist_lookup(_auth, <span class="hljs-string"><span class="hljs-string">"hsha"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hmac == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (ISC_R_FAILURE);</code> </pre><br><img src="https://habrastorage.org/files/07b/feb/21c/07bfeb21c8f34c679776cb1c546a0fbe.gif" alt="image"><br><br>  The essence of the patch closing the vulnerability is to further check the result of the iscc_alist_lookup function: <br><br>  For example, diff at <a href="https://source.isc.org/cgi-bin/gitweb.cgi%3Fp%3Dbind9.git%3Ba%3Dblobdiff%3Bf%3Dlib/isccc/cc.c%3Bh%3D6d95e3dfd874f4f2daf4ed60f319fb22ce8435ce%3Bhp%3D9759b40f9b5be6e3d46f2cbee48ca9c0d823f6a5%3Bhb%3Da2b15b3305acd52179e6f3dc7d073b07fbc40b8e%3Bhpb%3D0c9af52e8ff870126d837c52f1d30d8ad0608733">this link</a> : <br><br><pre> <code class="cpp hljs"> _auth = isccc_alist_lookup(alist, <span class="hljs-string"><span class="hljs-string">"_auth"</span></span>); - <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_auth == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) + <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isccc_alist_alistp(_auth)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (ISC_R_FAILURE);</code> </pre><br><br>  The isccc_alist_alistp function performs additional checking of nested fields: <br>  isccc_alist_alistp (isccc_sexpr_t * alist) <br><br><pre> <code class="cpp hljs">{ <span class="hljs-keyword"><span class="hljs-keyword">isccc_sexpr_t</span></span> *car; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (alist == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || alist-&gt;type != ISCCC_SEXPRTYPE_DOTTEDPAIR) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (ISC_FALSE); car = CAR(alist); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (car == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || car-&gt;type != ISCCC_SEXPRTYPE_STRING) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (ISC_FALSE); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(car-&gt;value.as_string, ALIST_TAG) != <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (ISC_FALSE); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (ISC_TRUE); }</code> </pre><br>  Problems remained unnoticed for several years - vulnerable versions of Git to 2.7.0, including branches 1.9 and 1.7.  Both vulnerabilities were fixed in version 2.7.1, which was released in February 2016, but Git developers have not announced the correction of errors, so many users and administrators have not yet updated their systems. <br><br>  Celle handed over information about the vulnerabilities he discovered to GitHub for which <a href="https://bounty.github.com/researchers/ytrezq.html">he received</a> 5000 points as part of a bug bounty service program - such awards are given for finding extremely serious vulnerabilities. <br><br>  In the future, a GitHub employee <a href="http://thread.gmane.org/gmane.comp.version-control.git/286008">corrected</a> errors and published a new version of Git 2.7.1, which was provided to corporate users, however, there were no separate announcements about this.  GitLab also <a href="https://about.gitlab.com/2016/03/16/gitlab-8-dot-5-dot-7-released/">updated</a> its software by implementing support for Git <a href="https://raw.githubusercontent.com/git/git/master/Documentation/RelNotes/2.7.3.txt">2.7.3</a> , which contains fixes and other bugs. <br><br>  Positive Technologies experts recommend that all users and administrators of Git-servers update the version of the software they use.  Download the new version by the <a href="https://github.com/git/git">link</a> . </div><p>Source: <a href="https://habr.com/ru/post/279483/">https://habr.com/ru/post/279483/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279461/index.html">What are PHP trends saying in 2016?</a></li>
<li><a href="../279469/index.html">Plotti.co: the easiest microservice to monitor live graphs</a></li>
<li><a href="../279477/index.html">How to write custom activation for a business process for cloud Bitrix24</a></li>
<li><a href="../279479/index.html">Peculiarities of national support: in 6 languages ‚Äã‚Äãfrom Moscow, plus Delhi, Bangalore, Bucharest and Tokyo teams</a></li>
<li><a href="../279481/index.html">Interesting cases of work organization on the second line of technical support</a></li>
<li><a href="../279487/index.html">Dynamic code verification - minimizing fraud risk while maintaining the convenience of making purchases online</a></li>
<li><a href="../279491/index.html">We build reliable data processing - lambda architecture inside Google BigQuery</a></li>
<li><a href="../279493/index.html">The main tool of every UX expert</a></li>
<li><a href="../279495/index.html">Prototypes as a product presentiment</a></li>
<li><a href="../279497/index.html">Pwn2Own 2016: first results</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>