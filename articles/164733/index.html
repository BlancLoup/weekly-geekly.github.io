<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a captcha with your own hands.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I recently decided that a captcha should be urgently put on the registration page, the bots became so impudent that they feel good there and even more...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a captcha with your own hands.</h1><div class="post__text post__text-html js-mediator-article">  I recently decided that a captcha should be urgently put on the registration page, the bots became so impudent that they feel good there and even more bots are called. <br>  Upon request in the search engine <i>"Captcha Script"</i> , there are so many ready-made options - that it is a sin to complain, but they all do not suit me - some are too scary, others are too sophisticated. <br>  Resolved!  Making a captcha with your own hands.  The topic is certainly beaten, but I will share the process of work. <br><br>  From the captcha I expect, first of all, ergonomics, my site is colorful and the captcha should be appropriate. <br><br>  On a white background, drawing numbers is not for me, so we make a rectangle and fill it with different squiggles. <br>  The size of the background is 3 times larger than the size of the future captcha.  in the process of generating a picture, this background will randomly change its position - making each captcha unique. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="http://niesoft.ru/shots/1356742985.jpeg" alt="image"><br><a name="habracut"></a><br>  Now we need numbers.  In the variants of scripts offered to me - which generate captcha, the figures were drawn with text - their color and size changed. <br>  I went the other way and drew 30 different numbers - with 3 different fonts and painted them with a gradient in the colors of the site. <br><br><img src="http://niesoft.ru/shots/1356743166.jpeg" alt="image"><br><br>  Saving each digit to a separate file and setting it to the height: 22px;  I'm starting to code: <br><br>  Captcha will consist of 6 digits therefore.  Numbers are assigned randomly. <br><br><pre><code class="php hljs">$pic1 = rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>); $pic2 = rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>); $pic3 = rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>); $pic4 = rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>); $pic5 = rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>); $pic6 = rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>);</code> </pre> <br><br>  For each variable, a random number from 1 to 30 is taken, the maximum threshold is the number of files with numbers (each file is signed from 0.png to 30.png).  Since the numbers are stored in the correct order, you can find out which of them is drawn in the file by determining the last digit from the file name: <br><br><pre> <code class="php hljs">$pic1_value = substr($pic1, strlen($pic1)<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); $pic2_value = substr($pic2, strlen($pic2)<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); $pic3_value = substr($pic3, strlen($pic3)<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); $pic4_value = substr($pic4, strlen($pic4)<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); $pic5_value = substr($pic5, strlen($pic5)<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); $pic6_value = substr($pic6, strlen($pic6)<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br><br>  That is, the number 2 can be stored in the file 2.png, 12.png, 22.png, etc. <br><br>  Be sure to remember the captcha code and write it into the session. <br><br><pre> <code class="php hljs">session_start(); $_SESSION[<span class="hljs-string"><span class="hljs-string">'captha'</span></span>] = <span class="hljs-string"><span class="hljs-string">"{$pic1_value}{$pic2_value}{$pic3_value}{$pic4_value}{$pic5_value}{$pic6_value}"</span></span>;</code> </pre> <br><br>  Now, when we know the numbers - we need to draw them in a 112x38px picture; <br><br><pre> <code class="php hljs">$dest = imagecreatetruecolor(<span class="hljs-number"><span class="hljs-number">112</span></span>,<span class="hljs-number"><span class="hljs-number">38</span></span>); <span class="hljs-comment"><span class="hljs-comment">#      $back = imagecreatefromjpeg("../../pic/captha/back.jpg"); #  </span></span></code> </pre><br><br>  We also open the numbers we need: <br><br><pre> <code class="php hljs">$var1 = imagecreatefrompng(<span class="hljs-string"><span class="hljs-string">"../../pic/captha/{$pic1}.png"</span></span>); $var2 = imagecreatefrompng(<span class="hljs-string"><span class="hljs-string">"../../pic/captha/{$pic2}.png"</span></span>); $var3 = imagecreatefrompng(<span class="hljs-string"><span class="hljs-string">"../../pic/captha/{$pic3}.png"</span></span>); $var4 = imagecreatefrompng(<span class="hljs-string"><span class="hljs-string">"../../pic/captha/{$pic4}.png"</span></span>); $var5 = imagecreatefrompng(<span class="hljs-string"><span class="hljs-string">"../../pic/captha/{$pic5}.png"</span></span>); $var6 = imagecreatefrompng(<span class="hljs-string"><span class="hljs-string">"../../pic/captha/{$pic6}.png"</span></span>);</code> </pre><br>  The background is randomly moved horizontally and vertically so that the background does not go beyond the captcha. <br><br><pre> <code class="php hljs">imagecopyresampled($dest, $back, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">224</span></span>), rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">106</span></span>), <span class="hljs-number"><span class="hljs-number">112</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>, <span class="hljs-number"><span class="hljs-number">112</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>);</code> </pre> <br><br>  We also copy the numbers in the captcha - randomly changing the position vertically and horizontally, as well as the size of the digit by a maximum of 4px. <br><br><pre> <code class="php hljs">imagecopyresampled ($dest, $var1, rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>), rand(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, imagesx($var1) - rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), imagesy($var1) - rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), imagesx($var1), imagesy($var1)); imagecopyresampled ($dest, $var2, rand(<span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">24</span></span>), rand(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, imagesx($var2) - rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), imagesy($var2) - rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), imagesx($var2), imagesy($var2)); imagecopyresampled ($dest, $var3, rand(<span class="hljs-number"><span class="hljs-number">36</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>), rand(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, imagesx($var3) - rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), imagesy($var3) - rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), imagesx($var3), imagesy($var3)); imagecopyresampled ($dest, $var4, rand(<span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>), rand(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, imagesx($var4) - rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), imagesy($var4) - rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), imagesx($var4), imagesy($var4)); imagecopyresampled ($dest, $var5, rand(<span class="hljs-number"><span class="hljs-number">72</span></span>, <span class="hljs-number"><span class="hljs-number">78</span></span>), rand(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, imagesx($var5) - rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), imagesy($var5) - rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), imagesx($var5), imagesy($var5)); imagecopyresampled ($dest, $var6, rand(<span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">96</span></span>), rand(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, imagesx($var6) - rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), imagesy($var6) - rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), imagesx($var6), imagesy($var6));</code> </pre> <br>  In principle, everything is ready to be set only in the beginning of the php file the desired title: <br><br><pre> <code class="html hljs xml">header('Content-type: image/jpeg');</code> </pre> <br><br>  And display the drawn captcha in the browser: <br><pre> <code class="php hljs">imagejpeg($dest);</code> </pre> <br><br>  Well, of course, do not forget to clear the buffer: <br><br><pre> <code class="php hljs">imagedestroy($back); imagedestroy($dest); imagedestroy($var1); imagedestroy($var2); imagedestroy($var3); imagedestroy($var4); imagedestroy($var5); imagedestroy($var6);</code> </pre> <br><br>  Save, check. <br><br><img src="http://niesoft.ru/shots/1356744193.jpeg" alt="image"><br><br>  We put in the right place on the site. <br><br><img src="http://niesoft.ru/shots/1356744246.jpeg" alt="image"><br><br>  If the entered code <pre> <code class="php hljs">!= $_SESSION[<span class="hljs-string"><span class="hljs-string">'captha'</span></span>]</code> </pre>  - then we deduce the corresponding error. <br><br><img src="http://niesoft.ru/shots/1356744330.jpeg" alt="image"><br><br>  As needed, additional numbers can be copied to the captcha folder and the maximum threshold in the lines: <br><br> <code>$pic1 = rand(1, 30);</code>  - increase. <br><br>  On this our self-made improved and simple captcha is ready.  Thank you for your attention and do not judge strictly.  If someone likes an example, use on health. <habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/164733/">https://habr.com/ru/post/164733/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../164721/index.html">Porting Qt4 application to Qt5</a></li>
<li><a href="../164725/index.html">Experience creating a game for smartphones</a></li>
<li><a href="../164727/index.html">How to add realism to path tracing</a></li>
<li><a href="../164729/index.html">Tricks sysadmins</a></li>
<li><a href="../164731/index.html">Solve 9 Windows Server 2008 management tasks using PowerShell. Part 1</a></li>
<li><a href="../164735/index.html">Will it rain?</a></li>
<li><a href="../164737/index.html">Nexus 7 as a navigator in -32. Minitest</a></li>
<li><a href="../164739/index.html">Scala 2.10 release</a></li>
<li><a href="../164741/index.html">Robotism - futurological forecast</a></li>
<li><a href="../164745/index.html">Ingress. New - countdown</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>