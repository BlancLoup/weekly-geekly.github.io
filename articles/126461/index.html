<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Go Language. Small client server application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This code is written for the purpose of self-learning. To fix the material, I decided to comment a little on the work done. 
 I must say: I did not wr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Go Language. Small client server application</h1><div class="post__text post__text-html js-mediator-article">  This code is written for the purpose of self-learning.  To fix the material, I decided to comment a little on the work done. <br>  I must say: I did not write in compiled languages. <br><br><h3>  What the application does </h3><br>  [to] - client <br>  [c] - server <br>  1. On the established TCP connection, [to] sends the public key rsa. <br>  2. Using the received public key, [c] encrypts and sends messages [to] <br>  3. [to] decrypts and displays messages. <br><br>  Here‚Äôs how it looks in the console: <br><img src="https://habrastorage.org/getpro/habr/post_images/0a1/1da/abb/0a11daabb2fc929651a51ebb72fe4bba.gif" alt="image"><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Server </h3><br><pre><code class="cpp hljs">package main</code> </pre> <br>  We import the necessary packages <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span>( <span class="hljs-comment"><span class="hljs-comment">//   / .      "fmt" //      Unix networks sockets, including TCP/IP, UDP . //      TCP . "net" //        "os" //   / "bufio" //           "crypto/rsa" //       "crypto/rand" //     sha1 "crypto/sha1" //           "strconv" //      "big" )</span></span></code> </pre>  Further access to the package will occur by its name through a dot. <br>  For example: <code>fmt</code> <strong>.</strong>  <code>Println()</code> , <code>os</code> <strong>.</strong>  <code>Exit()</code> , etc. <br>  If you are not sure what name of the package you need, then you can look at the source code of the package for the topmost code line. <br>  For example for <a href="http://golang.org/pkg/crypto/rsa/">crypto / rsa</a> <a href="">Sixth line rsa.go</a> <br>  With the <a href="http://golang.org/cmd/goinstall/">goinstall</a> command <a href="http://golang.org/cmd/goinstall/">,</a> you can install packages from other <a href="http://godashboard.appspot.com/package">developers</a> . <br>  In this case, you'll import something like this ‚Äúbitbucket.org/user/project‚Äù, ‚Äúgithub.com/user/project‚Äù or ‚Äúproject.googlecode.com/hg‚Äù <br><br>  We declare the constants we need <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span>( <span class="hljs-comment"><span class="hljs-comment">//  tcp  tcpProtocol = "tcp4" //   rsa  keySize = 1024 //       readWriterSize = keySize/8 )</span></span></code> </pre><br><br>  In order to hold together the connection ‚Äúc‚Äù and the key from this connection ‚ÄúpubK‚Äù we will declare the data type remoteConn as a structure: <br><pre> <code class="cpp hljs">type remoteConn <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> c *net.TCPConn pubK *rsa.PublicKey }</code> </pre>  An asterisk "*", before the variable type, means that the variable is a link to the data of the declared type <br>  <a href="http://golang.org/pkg/net/">net.TCPConn</a> is a data type that contains the structure of the TCP connection information. <br>  <a href="http://golang.org/pkg/crypto/rsa/">rsa.PublicKey</a> is a data type.  Needed to encrypt transmitted messages. <br><br>  In order to familiarize, we will handle the errors that occur in this way: <br>  The function takes a single value <code><b>err</b></code> whose type is <a href="http://golang.org/pkg/os/">os.Error</a> . <br>  In this case, we are working with the <a href="http://golang.org/pkg/os/">Error</a> type from the <a href="http://golang.org/pkg/os/">os</a> package ( <code>os.Error</code> ). <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkErr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err os.Error)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != nil { <span class="hljs-comment"><span class="hljs-comment">//    fmt.Println(err) //   os.Exit(1) } }</span></span></code> </pre><br><br>  <code><b>listenAddr</b></code> declare the global variable <code><b>listenAddr</b></code> which will be a reference to the structure of type <a href="http://golang.org/pkg/net/">net.TCPAddr</a> <br><pre> <code class="cpp hljs">var listenAddr = &amp;net.TCPAddr{IP: net.IPv4(<span class="hljs-number"><span class="hljs-number">192</span></span>,<span class="hljs-number"><span class="hljs-number">168</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>), Port: <span class="hljs-number"><span class="hljs-number">0</span></span>}</code> </pre>  Ampersand "&amp;" before <a href="http://golang.org/pkg/net/">net.TCPAddr</a> will return a reference to this type. <br>  ‚ÄúPort: 0‚Äù in this case means any free port. <br><br>  The following function combines a connection and a public key to encrypt this connection into a <code><b>remoteConn</b></code> structure. <br>  And returns the link to <code>remoteConn</code> and not the value. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRemoteConn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *net.TCPConn)</span></span></span><span class="hljs-function"> *remoteConn</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;remoteConn{c: c, pubK: waitPubKey(bufio.NewReader())} }</code> </pre>  <code><b>bufio.NewReader()</b></code> - creates a buffer byte from the connection "c".  Return type <code><b>*bufio.Reader</b></code> (link to <code>bufio.Reader</code> ) <br>  <code><b>waitPubKey()</b></code> - expects from the "client" when he in a certain sequence passes <code><b>PublicKey</b></code> <br><br>  The function accepts a reference to the buffer ( <code><b>*bufio.Reader</b></code> ) which in turn contains all the bytes coming from the connection "c" <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//      rsa.PublicKey func waitPubKey(buf *bufio.Reader) (*rsa.PublicKey) { //     line, _, err := buf.ReadLine(); checkErr(err) //    line - []byte ( ) //      &lt;code&gt;&lt;b&gt;line&lt;/b&gt;&lt;/code&gt;   if string(line) == "CONNECT" { //         ,       line, _, err := buf.ReadLine(); checkErr(err) //  PublicKey.N //   rsa.PublicKey pubKey := rsa.PublicKey{N: big.NewInt(0)} // pubKey.N == 0 //  pubKey.N big.Int http://golang.org/pkg/big/#Int //       pubKey.N big.Int pubKey.N.SetString(string(line), 10) //  SetString()  2 : // string(line) -      // 10 -       // (2 , 8 , 10 , 16  ...) //       pubKey.E line, _, err = buf.ReadLine(); checkErr(err) //   strconv    string   int pubKey.E, err = strconv.Atoi(string(line)); checkErr(err) //    rsa.PublicKey return &amp;pubKey } else { //        .  : //    fmt.Println("Error: unkown command ", string(line)) os.Exit(1) //   } return nil }</span></span></code> </pre><br><br>  The following function is a method for referencing variables of type <code><b>remoteConn</b></code> <br>  Performs a series of actions to encrypt and send the message. <br><pre> <code class="cpp hljs">func (rConn *remoteConn) sendCommand(comm <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   eComm, err := rsa.EncryptOAEP(sha1.New(), rand.Reader, rConn.pubK, []byte(comm), nil) // sha1.New()    hash.Hash //       sha512.New() sha256.New() ... // rand.Reader   io.Reader       //    /dev/unrandom   Linux  CryptGenRandom API   Windows // rConn.pubK -       func waitPubKey // []byte(comm) -   comm    ([]byte) checkErr(err) //    //        rConn.c.Write(eComm) // rConn.c  ? - net.TCPConn     Write() // http://golang.org/pkg/net/#TCPConn.Write }</span></span></code> </pre><br><br>  Below is a function that operates with previously declared functions and ultimately sends the name of the server and greetings in different languages ‚Äã‚Äãto the ‚Äúclient‚Äù. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     l, err := net.ListenTCP(tcpProtocol, listenAddr); checkErr(err) //    fmt.Println("Listen port: ", l.Addr().(*net.TCPAddr).Port) // l == *net.TCPListener ==     // .Addr() http://golang.org/pkg/net/#TCPListener.Addr ==   *net.TCPListener   "" // net.Addr http://golang.org/pkg/net/#Addr        TCPAddr - *net.TCPAddr //    Network()  String() c, err := l.AcceptTCP(); checkErr(err) //             // AcceptTCP() -   *net.TCPListener http://golang.org/pkg/net/#TCPListener.AcceptTCP //     fmt.Println("Connect from:", c.RemoteAddr()) //  3     fmt.Print[f|ln]()    // 1. c.RemoteAddr() // 2. c.RemoteAddr().(*net.TCPAddr) // 3. c.RemoteAddr().String() //     : fmt.Println(), fmt.Print(), fmt.Printf()    String() //       //             rConn := getRemoteConn() //     rConn.sendCommand("Go Language Server v0.1 for learning") rConn.sendCommand("!") rConn.sendCommand("—ñ!") rConn.sendCommand("—ñ!") rConn.sendCommand("Hello!") rConn.sendCommand("Salut!") rConn.sendCommand("„Éè„Ç§!") rConn.sendCommand("ÊÇ®Â•Ω!") rConn.sendCommand("ÏïàÎÖï!") rConn.sendCommand("Hej!") }</span></span></code> </pre><br><br>  This review server is over <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ listen() }</code> </pre><br><br><h3>  Customer </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">package main </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">import</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"fmt"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"net"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"os"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"bufio"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"crypto/rsa"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"crypto/rand"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"crypto/sha1"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"strconv"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( tcpProtocol = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"tcp4"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> keySize = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1024</span></span></span></span><span class="hljs-function"><span class="hljs-params"> readWriterSize = keySize/</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">8</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function"> func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkErr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err os.Error)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != nil { fmt.Println(err) os.Exit(<span class="hljs-number"><span class="hljs-number">1</span></span>) } } var connectAddr = &amp;net.TCPAddr{IP: net.IPv4(<span class="hljs-number"><span class="hljs-number">192</span></span>,<span class="hljs-number"><span class="hljs-number">168</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>), Port: <span class="hljs-number"><span class="hljs-number">0</span></span>} <span class="hljs-comment"><span class="hljs-comment">//             func connectTo() *net.TCPConn{ //   "Enter port:"      fmt.Print("Enter port:") //        "%d" fmt.Scanf("%d", &amp;connectAddr.Port) // Scanf           fmt.Println("Connect to", connectAddr) //     c ,err := net.DialTCP(tcpProtocol, nil, connectAddr); checkErr(err) return c } //      PublicKey func sendKey(c *net.TCPConn, k *rsa.PrivateKey) { //       PublicKey c.Write([]byte("CONNECT\n")) //  N  *big.Int c.Write([]byte(k.PublicKey.N.String() + "\n")) // String()  *big.Int  string //  E  int c.Write([]byte(strconv.Itoa(k.PublicKey.E) + "\n")) // strconv.Itoa()  int  string // []byte()  ""    } //       //    func getBytes(buf *bufio.Reader, n int) []byte { //  n  bytes, err:= buf.Peek(n); checkErr(err) //  n  skipBytes(buf, n) return bytes } // ,     func skipBytes(buf *bufio.Reader, skipCount int){ for i:=0; i&lt;skipCount; i++ { buf.ReadByte() } } func main() { //    c := connectTo() //       "c" buf := bufio.NewReader() //           k, err := rsa.GenerateKey(rand.Reader, keySize); checkErr(err) //     sendKey(c, k) //        for { //      cryptMsg := getBytes(buf, readWriterSize) //   msg, err := rsa.DecryptOAEP(sha1.New(), rand.Reader, k, cryptMsg, nil) //    checkErr(err) //    fmt.Println(string(msg)) } }</span></span></code> </pre><br><br>  Sources without a single comment can be found here: <br>  <a href="https://code.google.com/p/learning-go-language/source/browse/">code.google.com/p/learning-go-language/source/browse</a> </div><p>Source: <a href="https://habr.com/ru/post/126461/">https://habr.com/ru/post/126461/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126453/index.html">New simple JavaScript editor in Firefox</a></li>
<li><a href="../126455/index.html">7 reasons to suffer the customer</a></li>
<li><a href="../126456/index.html">SmartOS: fully modern OS</a></li>
<li><a href="../126458/index.html">Expansion of functionality without source code</a></li>
<li><a href="../126459/index.html">Life abroad</a></li>
<li><a href="../126463/index.html">HTC launched a service to unlock the bootloader in Sensation</a></li>
<li><a href="../126465/index.html">PlayStation on GamesCom</a></li>
<li><a href="../126466/index.html">American scientists have developed micro robots</a></li>
<li><a href="../126467/index.html">Foursquare and Skype will be in Playstation Vita</a></li>
<li><a href="../126469/index.html">Moscow GTUG - Crystallization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>