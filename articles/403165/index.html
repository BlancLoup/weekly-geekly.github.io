<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HiDPI in Linux, in particular in KDE</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Monitors in 4K resolution are no longer considered the lot of the bourgeoisie and are gradually entering the life of the common people. As well as oth...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HiDPI in Linux, in particular in KDE</h1><div class="post__text post__text-html js-mediator-article">  Monitors in 4K resolution are no longer considered the lot of the bourgeoisie and are gradually entering the life of the common people.  As well as other high-resolution monitors.  A couple of years ago, I said about the support of such monitors in Linux that ‚Äúno, rather than yes.‚Äù  There was some kind of support, but the number of glitches with it made the whole process meaningless, and really wanted to switch the monitor to a smaller resolution.  What some 4K monitors do not allow to do in Linux so far.  The fact is that NVidia drivers, when connected via DisplayPort, naively believe in the monitor's EDID, and if only one maximum resolution is registered there, they are not allowed to install any other.  You must either roll back to the Nouveau, or configure HiDPI.  We will customize!  (The article is intended for a person who knows the basics of Linux and what is the X server). <br><a name="habracut"></a><br><h3>  About DPI in general and HiDPI in particular </h3><br>  <b>DPI</b> <i>(dots per inch)</i> is a value that says how many pixels of a screen is the physical centimeter of its area.  If the monitor works in non-native resolution, then we are talking about virtual pixels of resolution.  From ancient times to quite recently, the value in 96 DPI was the standard - that is, if ordinary monitors differed from it, then so much so that it could be neglected.  120 DPI was once the maximum value that was usually tested. <br><br>  Not surprisingly, for so many years, program developers have taken this value as an unshakable constant.  Suddenly monitors came with 160-192 DPI and started.  All programs that at least some size in the interface were set in pixels, received panels hitting each other, signatures, cropped to the first letter, and buttons, for the successful pressing of which you need to give a cash prize. <br><br>  The word HiDPI refers to the situation on monitors with DPI&gt; 160.  The DPI of the operating system is not necessarily the DPI of the screen.  On the contrary, the DPI of the system can be rotated in order to make the interface larger and smaller.  Moreover, the systems distinguish DPI total, DPI fonts and DPI, given to full-screen applications. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  What about the others? </h3><br>  Makos rescued her authoritarian rule.  Since almost all programs create their own interface through the same API, it was simply corrected, and it worked out right away.  Separate indestructible shoals only emphasize how generally all is well. <br><br>  Android was born on systems with a wide scatter of DPI, so he knew everything from the cradle, and the textbooks for programmers took it all into account. <br><br>  Windows allowed to rotate DPI fonts always.  That's just the DPI graphics from this has not changed.  Individual elements were resized because they were tied to the size of the font, or the screen.  But the dimensions specified in pixels did not move.  In Win 10, finally, there was normal support for HiDPI, but only for programs written for Win 10. For the rest, a crutch was written, making just a graphic increase in the program window with translation of the position of clicks.  Zooming out makes the window blurry, and the translation is crooked.  Worse, this magnification tries to run for fullscreen applications, too, so to play it, you need to turn it off, and to work, turn it on. <br><br><h3>  What about Linux? </h3><br>  And in Linux, as always, orgy.  We have two major GUI dial-ups (Qt and GTK), each of which relatively recently experienced rewriting from scratch, so the old and new versions are still in use.  Plus a few smaller sets (EFL, wxWidgets).  Plus, there are several languages ‚Äã‚Äãthat use their own tools, for example, Java.  Plus, there are several ancient libraries, on which nobody already writes, but the necessary software on them still happens.  (GTK 1, Motif) Even if the X server and the window manager correctly handle the DPI, it‚Äôs not a fact that the whole zoo will accept this information and work fine. <br><br>  There is a lot to dislike Ubuntu with Unity, but one thing I have to say.  I do not know how to configure HiDPI in Unity because everything always worked out of the box.  All other DE: Cinnamon, KDE, XFCE, also have a corresponding flag.  This flag configures DE itself, applications written in its main library (only the new version) and a couple of flags for Qt / GTK.  And the rest is all sideways.  As a result, for example, in the players, the Play button remains tiny.  And the tray icons are small, but not all.  A year after such a system - and a person in Overwatch only plays for McCrack, because a person has pixel pixel accuracy on a mouse and he hates everyone. <br><br>  I will tell you how to configure KDE.  Not as according to the instructions, but so that everything worked.  Deadbeef, Yakuake, Blender.  I checked it mostly in Archa.  In other distributions, it may be that something of what I describe is already done or done differently.  Think with your head or write in the comments - let's figure it out. <br><br><h3>  X Setup </h3><br>  The first thing you need to check, and if I know X, that we have HiDPI?  To do this, we need a xdpyinfo <code>xdpyinfo</code> - it is in turnips.  Set, if not set, the native resolution of the monitor, (and restart X).  Launch in the console inside X (that is, not Ctrl-Alt-F *). <br><br><pre> <code class="bash hljs">xdpyinfo | grep -B 2 resolution screen <span class="hljs-comment"><span class="hljs-comment">#0: dimensions: 3840x2160 pixels (621x341 millimeters) resolution: 157x161 dots per inch</span></span></code> </pre> <br>  We see three pairs of values ‚Äã‚Äã- screen resolution, real screen sizes, and DPI (separately vertically and horizontally). If all three pairs look like truth, then turn away from the monitor and give praise to the highest entity of your choice;  for if xdpyinfo returns nonsense and DPI = 96, then your higher nature sends you ordeal. <br><br>  The most common causes of irregular DPI are EDID curves and branded video card firewood.  I will not say anything about ATi video cards, since I‚Äôm avoiding them.  Not that they are bad, but ATi + Linux = superfluous problems.  With Intel, everything should work by itself.  NVidia, until recently, stubbornly defiled DPI.  First, turn off G-sync in <code>nvidia-settings</code> , anyway, no composite manager is friends with it.  If it does not help, enable KMS.  Kernel Mode Setting is the method by which the screen resolution is managed by the Linux kernel, and not by X.  In addition to the direct appointment, it allows you to bypass a lot of the buggy code 20 years ago in the Xs.  Unfortunately, the procedure for enabling KMS on Nvidia‚Äôs proprietary drivers is distributionally dependent, so I‚Äôll only describe in general terms.  You need to add the modules <code>nvidia, nvidia_modeset, nvidia_uvm, nvidia_drm</code> to the initramfs, rebuild it, and then add the kernel parameter <code>nvidia-drm.modeset=1</code> .  Google <br><br>  If you didn‚Äôt understand anything in the previous paragraph, then you can simply give up NVidia brand firewood and use Nouveau for now - there is a KMS out of the box.  In Kubunt, this is done through a program that manages the drivers. <br><br>  If all of the above did not help and xdpyinfo still writes garbage, then maybe not the video drivers, but the monitor's EDID curves are to blame.  First run <code>xrandr --dpi 192</code> in the same console.  And run some program.  If it has become more, then the method works.  Paste this command into <code>.xprofile</code> and restart <code>.xprofile</code>  In the future I will talk a lot about <code>.xprofile</code> .  This is a file in the home folder of each user who customizes the work of graphic applications.  If not, just create it: <code>touch ~/.xprofile</code> .  If everything worked - Hooray!  If not, first verify that your distribution does not have <code>.xprofile</code> cut out from KDE.  For which, add something like <code>touch ~/net_ne_vyrezali</code> and reload again. <br><br>  Still not working?  Let's write DPI in Iksa manually.  Create, if not already, the file <i>/etc/X11/xorg.conf.d/90-monitor.conf</i> and write to it: <br><br><pre> <code class="bash hljs">Section <span class="hljs-string"><span class="hljs-string">"Monitor"</span></span> Identifier <span class="hljs-string"><span class="hljs-string">"Prikolny monitor"</span></span> DisplaySize 286 179 <span class="hljs-comment"><span class="hljs-comment">#   EndSection</span></span></code> </pre> <br>  And for branded firewood Nvidia <br><br><pre> <code class="bash hljs">Section <span class="hljs-string"><span class="hljs-string">"Monitor"</span></span> Identifier <span class="hljs-string"><span class="hljs-string">"Prikolny monitor"</span></span> Option <span class="hljs-string"><span class="hljs-string">"DPI"</span></span> <span class="hljs-string"><span class="hljs-string">"192 x 192"</span></span> EndSection</code> </pre> <br>  Please note that everywhere I put the forced DPI value at 192, more precisely at any value multiple of 96. It works more precisely than the real DPI, because gladiolus.  Here the designer's paradox works: <br><br><ul><li>  If the DPI is a multiple of 96, fonts are better rendered in text-based applications.  Especially in applications on Cairo. </li><li>  If the DPI is equal to this monitor's DPI, then the 1: 1 scale on the screen will be the same size as on paper. </li></ul><br>  I wrote the stupid name of the monitor so that in all graphical utilities it was clear that our setting is readable and tries to be applied. <br><br>  Save, restart X and rejoice.  Or we drink bitter and wait for Wayland to finish. <br><br><h3>  Setup in KDE </h3><br>  So finally, we configure HiDPI in KDE correctly.  In the <i>menu ‚Üí System Settings ‚Üí Display and Monitor</i> at the very bottom there is a large <i>Scale Display</i> button.  By pressing it, a window with a single <i>Scale</i> slider comes out.  Now attention!  If you did not manage to adjust the DPI in X, close this article, set the slider value to taste, and rejoice in what works.  And what does not work - reconcile (This is usually Chrome, Skype, QtCreator, Yakuake, GTK). <br><br>  If you have the correct DPI in X, then do not touch this slider!  Ideally, even, do not twist it back and forth, because it seems that he is writing something somewhere.  Close this window nafig.  According to an article in the <a href="http://blog.davidedmundson.co.uk/blog/high_dpi_again">blog of the creator of</a> this slider (salt in the comments), it overrides the system DPI and sets a few more variables.  The problem is that not all programs see this redefinition, and it turns out to be porridge.  Therefore, we will not touch the slider, and adjust everything manually. <br><br>  In general, at this stage, if the DPI is correct, then everything should be quite large.  We pass in <i>System Settings ‚Üí Fonts</i> .  By default, there is a font size of 11. If you need 10-14 to achieve harmony - put it, the applications will be pulled.  If more or less - it makes sense to try podshamanit system DPI as it is stated above.  Below is the Force Font DPI field.  You can tweak it, if you want, but note that not all applications read this value.  Not even that.  Some applications do not read this value with all their parts.  So if you try to fix the system DPI here at 96, there will be porridge.  But you can raise the DPI 167 monitor to the ideal 192. <br><br>  Close the Fonts window.  In general, now is the time to restart X and see what happened.  It should work and have a convenient KDE size, all its settings and applications.  The plasma panel, by the way, does not grow by itself.  But it is a vector, and you can always stretch it - click the sandwich on the left and the buttons will appear.  The same size in Dolphin must be set manually.  If somewhere else in KDE applications the buttons and panels are too small, you need to shuffle the sizes of the icons in System Settings ‚Üí Icons. <br><br><h3>  Configure other applications </h3><br><h4>  Chrome, Atom and others </h4><br>  These applications read DPI directly from where it will turn out and follow it as a knight to the code.  If they read something wrong, then they will look somehow wrong.  Usually they ignore the settings in the System Settings and follow the DPI that xdpyinfo returns.  If there is 96, then for Chrome you can use the argument <code>--force-device-scale-factor=2</code> , for the Atom there is a curve <code>hidpi</code> plugin in the official turnips, for other programs there are crutches. <br><br><h4>  QtCreator, Yakuake, and other Qt5 apps </h4><br>  In general, they <a href="https://doc.qt.io/qt-5/highdpi.html">should work</a> .  But QtCreator doesn‚Äôt scale the toolbar, and Yakuake has a tab bar.  The reason is in the bug and in the <code>QT_AUTO_SCREEN_SCALE_FACTOR</code> environment <code>QT_AUTO_SCREEN_SCALE_FACTOR</code> .  When it is <code>1</code> , Qt5 tries to find the DPI value itself, and when <code>0</code> waits for it to be given in other variables.  The bug is that KDE passes garbage. <br><br>  In short, these applications need to set the variable <code>QT_AUTO_SCREEN_SCALE_FACTOR=1</code> and everything will work.  This can be done either selectively or globally.  Optionally - in the Menu Editor.  Just do not forget to add the application to the panel and in the autorun.  This is necessary because .desktop records are copied, not linked.  The second option is to set this variable all-system, in <i>.xprofile</i> or even <i>/ etc / environment</i> , or where variables are written in your distribution.  There are two nuances.  First, KDE forcibly resets this variable to 0 in the <i>/ usr / bin / startkde script</i> .  You will have to open and edit it by <code>#export QT_AUTO_SCREEN_SCALE_FACTOR=0</code> line <code>#export QT_AUTO_SCREEN_SCALE_FACTOR=0</code> .  After that, you need to remember to repeat this fix every time KDE is updated.  The second caveat is that the KDE developers warn in the comments: setting this variable globally can lead to some Qt5 applications being increased twice.  But this is not happening to me.  Further, if the system DPI is incorrect, you need to set the variable <code>QT_SCALE_FACTOR=2</code> in <i>.xprofile</i> . <br><br>  Remember that the <code>QT_DEVICE_PIXEL_RATIO</code> variable <code>QT_DEVICE_PIXEL_RATIO</code> deprecated.  If you put it somewhere, you need to remove it. <br><br><h4>  Qt4 Applications </h4><br>  These applications, in general, poorly able to HiDPI.  But all is not lost.  Qt4 creates a very flexible interface.  Run <code>qtconfig-qt4</code> .  First, see the font and set a convenient size.  Then, on the Interface tab, find a crutch called ‚Äú <i>Global strut</i> ‚Äù (in translation - global crutch.) This setting means that QWidget instances and its descendants cannot be smaller than this size in pixels, so that they are not used.  With the help of <i>Minimum Width,</i> you can set the width of the scrollbars, and with the help of <i>Minimum Height</i> - the height of the toolbars. <br><br><h4>  GTK3 applications </h4><br>  Everything is simple here.  You need to set two variables in <i>.xprofile</i> : <br><br>  <code>GDK_SCALE=2</code> Commands GTK to increase everything 2 times.  The value must be integer.  <code>GDK_DPI_SCALE</code> adjusts the font increase.  If after <code>GDK_SCALE</code> fonts are huge, you need to set <code>GDK_DPI_SCALE=0.5</code> <br><br><h4>  GTK2 Applications </h4><br>  Everything is complicated here.  GTK2 cannot do HiDPI at all.  But there is a hack.  Software called Oomox is a GTK theme (skins) generator.  Including, with its help, you can collect such a topic under GTK2, which will <a href="https://www.reddit.com/r/unixporn/comments/4s1bn5/awesome_wm_oomox_imitates_hidpi_in_gtk2_theme_and/">imitate</a> HiDPI.  Or find a theme <a href="https://github.com/af2005/Arc-theme-HiDPI">ready</a> . <br><br><h4>  Applications on Qt3, Gtk1, Motif </h4><br>  Everything is quite complicated here.  There are two possible hacks.  First, you can take advantage of Kwin's ability to enlarge the entire screen.  <i>System Settings ‚Üí Desktop Effects ‚Üí Desktop Effects ‚Üí Zoom</i> .  The middle button on the left is the settings, including the keys for turning it on and off.  The second way is to run the application in the remote desktop server and connect to it locally.  I will simply insert a <a href="https://github.com/kaueraal/run_scaled">link to the script</a> , because setting it up is a matter of a separate article. <br><br><h4>  Java applications </h4><br>  More cool and commercial Java programs behave like Chrome: they read DPI from X and follow it.  <code>-Dsun.java2d.uiScale=2</code> programs can be fixed with one of two arguments: <code>-Dsun.java2d.uiScale=2</code> increases the interface 2 times, and <code>-Dswing.defaultlaf=com.sun.java.swing.plaf.gtk.GTKLookAndFeel</code> tells it to use for drawing sizes from GTK .  Let me remind you that in <i>.xprofile</i> you can create the variable <code>export _JAVA_OPTIONS='-Dawt.useSystemAAFontSettings=on -Dswing.aatext=true -Dswing.defaultlaf=com.sun.java.swing.plaf.gtk.GTKLookAndFeel'</code> .  The above example includes anti-aliasing in fonts and GTK. <br><br>  Well, so somehow. </div><p>Source: <a href="https://habr.com/ru/post/403165/">https://habr.com/ru/post/403165/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../403153/index.html">Mirai botnet started mining bitcoins on DVRs and camcorders</a></li>
<li><a href="../403157/index.html">CINEMOOD Storyteller: a miniature cinema for children and adults</a></li>
<li><a href="../403159/index.html">Tim Berners-Lee suggests that AI will start managing financial corporations</a></li>
<li><a href="../403161/index.html">Central Bank: the issue of legalization of cryptocurrency in Russia is still at the discussion stage</a></li>
<li><a href="../403163/index.html">Network theft</a></li>
<li><a href="../403169/index.html">Moto mods: details about all four interchangeable modules for Moto Z and Z Play smartphones</a></li>
<li><a href="../403171/index.html">MinFin: software from foreign sites should not be taxed by Google</a></li>
<li><a href="../403173/index.html">ZUS: 16% in 15 minutes. Charging to a car with Bluetooth tag features</a></li>
<li><a href="../403175/index.html">Great post about projectors: technology, appointment, choice, development prospects</a></li>
<li><a href="../403177/index.html">Nintendo discontinues NES Classic Edition</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>