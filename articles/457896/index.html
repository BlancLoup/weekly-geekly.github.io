<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zimbra and server overload protection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="E-mail has been firmly established as a standard for business communication. Due to the high economic efficiency of e-mails, as well as a number of fe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zimbra and server overload protection</h1><div class="post__text post__text-html js-mediator-article">  E-mail has been firmly established as a standard for business communication.  Due to the high economic efficiency of e-mails, as well as a number of features associated with citing text and attachment of attachments, e-mails are the best suited for the role of a universal way for exchanging documents and polite business communication.  These same features were the reason why spammers fell in love with e-mail.  As a result, today e-mail is a huge raging ocean of spam, in the waters of which only occasionally there are business letters.  That is why one of the priorities of the administrator of any mail server is to protect against spam e-mails.  Let's look at what can be done with this in the Zimbra Collaboration Suite Open-Source Edition. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e98/93d/7d9/e9893d7d9f995c2a24dce02df7fa5d51.png" alt="image"><br><a name="habracut"></a><br>  Despite the free solution, Zimbra OSE is able to provide the system administrator with a lot of extremely effective tools to solve the problem of receiving unwanted emails.  We have already written about utilities such as Amavis, SpamAssassin, ClamAV and cbpolicyd, which allow you to securely filter incoming mail, eliminating spam, as well as infected and phishing emails.  However, their key disadvantage is that they all work with already received email messages and spend on filtering useless messages system resources, which can always be used much better.  But what if your company turned out to be under the gun of a large botnet that constantly throws your mail server with so many junk emails that it takes the lion's share of MTA server capacity to filter them alone? <br><br>  In theory, you can protect yourself from this by connecting a cloud service to filter incoming mail, but in practice this method of protection will not suit every enterprise, because in this case you will have to entrust the third parties with processing not only spam, but also business correspondence, which is not always safe, and often directly contradicts the company's security policy.  In addition, there are risks associated with the reliability of the cloud spam filter.  The solution to this situation could be the organization of server protection on its own.  Especially for these purposes, the Postscreen utility was built into Zimbra, which is designed to protect the mail server from emails sent by botnets without loading the mail server. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The essence of Postscreen is that this utility scans all requests to connect to the mail server and does not allow clients that seem to be suspicious to connect to the server.  Since, according to statistics, about 90% of spam in the world is sent by botnets, Postscreen is often used as the first level of protection for the mail server from unwanted mailings.  Due to this, the mail server can work stably without overloading even in the face of strong spam attacks from large botnets. <br><br>  The operation of Postscreen is quite simple, the utility is capable of conducting a series of simple checks for incoming emails before transferring them to the mail server or other services that conduct a deeper and more detailed check of incoming emails.  Each of the checks, respectively, may be passed, and may not be passed.  Based on the results of each of the checks, Postscreen can take one of three actions to choose a Zimbra administrator: <b>Drop</b> , <b>Ignore</b> or <b>Enforce</b> .  The <b>Drop</b> action forcibly breaks the connection with the client if the check fails, the <b>Ignore</b> action allows you to ignore the test results when making the final decision, but to collect information and statistics about the checks, and the <b>Enforce</b> action allows you to take into account the results of the checks made when making the final decision, but at the same time continue to perform all the tests that are scheduled by the system administrator. <br><br>  A simple principle does not mean ease of use and configuration.  The fact is that an incorrectly configured Postscreen can be the reason why a number of important letters for an enterprise do not reach the addressee.  That is why the setting up of such a powerful tool as the Postscreen must be approached with great care and be constantly tested for behavior in certain situations. <br><br>  Postscreen in Zimbra is included initially, but many may not be satisfied with the initial configuration.  Now we will consider the best in terms of security and no risk option settings Postscreen.  Its essence lies in the fact that after the failure of any of the checks, Postscreen will not break the connection with the client without talking, and will carry out all checks to the end and if these checks fail, will give an error message.  This will allow the live sender to be notified that the letter is not delivered in the event that Postscreen considers it as spam.  This is achieved by setting the enforce value in the inspection parameters.  It is this value that allows you to complete the started checks to the end, without breaking the connection with the client at the first failure, but at the same time after their completion you still block the spam letter without delivering it to the server. <br><br>  In order to enable the necessary checks, enter the following commands: <br><br>  <b>zmprov mcf zimbraMtaPostscreenDnsblSites' b. ..7] * 6 'zimbraMtaPostscreenDnsblSites' zen.spamhaus.org = 127.0.0.3 * 4' zimbraMtaPostscreenDnsblSites' zen.spamhaus.org = 127.0.0.2 * 3 '</b> <br><br>  This command allows you to add a DNS check for incoming connections on the two most popular public spam databases and rate letters depending on which of the bases the sender's address is found in.  The more penalty "stars" the client dials, the more likely he is a spammer. <br><br>  <b>zmprov mcf zimbraMtaPostscreenDnsblAction enforce</b> <br><br>  This team determines the action that takes place on the basis of passing the DNS-check.  In this case, the result of the check is remembered, and the letter itself continues to pass further tests. <br><br>  <b>zmprov mcf zimbraMtaPostscreenGreetAction enforce</b> <br><br>  Since in the SMTP protocol, after a direct connection, the server first starts communicating with the client and, accordingly, Postscreen can send a greeting to the client.  Due to the fact that many spam clients, without waiting for the end of the greeting, begin to send commands, they can be easily recognized.  This command allows you to take into account the results of this test, but at the same time continue to perform further tests. <br><br>  <b>zmprov mcf zimbraMtaPostscreenNonSmtpCommandAction drop</b> <br><br>  As part of this verification, Postscreen allows you to filter out connections that do not originate from email clients.  Since they do not send any letters, you can disconnect them from the server without any fear. <br><br>  <b>zmprov mcf zimbraMtaPostscreenPipeliningAction enforce</b> <br><br>  This check is based on the fact that by default in the SMTP protocol the client can send only one command at a time and then wait for the server to respond to this command.  However, many spam bots behave differently, sending many commands without waiting for a response from the server.  This allows virtually unmistakable identification of spam bots. <br><br>  In principle, these checks for Postscreen will be more than enough to cut off the bulk of spam bots from the server and to achieve a significant reduction in the load on your mail server.  At the same time, living people will receive a message that their letter was not delivered, which significantly reduces the risk of losing important emails due to the Postscreen settings.  In the event that this happens, you can add a trusted sender to the white list of Postscreen.  In order to create whitelisting and blacklists of Postscreen, you must first create the file <b>/ opt / zimbra / conf / postfix / postscreen_wblist</b> . <br><br>  In it we will add the list of allowed and prohibited ip-addresses and subnets in the format of the table CIDR.  For example, we block the subnet 121.144.169. *, But allow the connection to a single ip-address from this subnet: <br><br><blockquote>  # Rules are evaluated in order. <br>  # Blacklist 121.144.169. * Except 121.144.169.196. <br>  121.144.169.196/32 permit <br>  121.144.169.0/24 reject </blockquote><br>  We draw your attention to the importance of the order of records.  The fact is that Postscreen will scan the file with white and black lists before the first match, and if the blocked subnet will stand before the resolved IP address, then the check simply does not reach the record that this IP address is added to the white list and connection with the server will not happen. <br><br>  After the white and black lists file has been edited and saved, you can enable the corresponding check using the following commands: <br><br><blockquote>  zmprov mcf zimbraMtaPostscreenAccessList "permit_mynetworks, cidr: / opt / zimbra / conf / postfix / postscreen_wblist" <br>  zmprov mcf zimbraMtaPostscreenBlacklistAction enforce </blockquote><br>  Now, Postscreen, in addition to the checks we have already specified, will also access the file with white and black lists, which will allow the administrator to easily resolve issues with the inability to connect to the server of reliable senders. </div><p>Source: <a href="https://habr.com/ru/post/457896/">https://habr.com/ru/post/457896/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../457884/index.html">Sovereign Online - Clarifying Orders</a></li>
<li><a href="../457886/index.html">Two-factor authentication on the site using a USB token. Now for Linux</a></li>
<li><a href="../457888/index.html">Mutation Testing: Testing Tests</a></li>
<li><a href="../457892/index.html">Professor who beat roulette</a></li>
<li><a href="../457894/index.html">Work with Proxmox Cluster: Installation, Network Configuration, ZFS, Common Problem Solving</a></li>
<li><a href="../4579/index.html">Digital TV: investments set the stage for growth</a></li>
<li><a href="../45790/index.html">Create your own magnetic prototype</a></li>
<li><a href="../457900/index.html">Federal Communications Commission Fights Meteorologists Again</a></li>
<li><a href="../457902/index.html">Mitap for Data Science</a></li>
<li><a href="../457904/index.html">Atomic Radio - the first ever musical show was made</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>