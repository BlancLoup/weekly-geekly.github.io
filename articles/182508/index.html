<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Experiments with VMware</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post, I present to the habrasoobshchestvo the results of their inept and unsystematic experiences with VMware vSphere 4.1 

 About work 
 I co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Experiments with VMware</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/84d/874/c44/84d874c44197aaef3a854b92be88d447.jpg"><br>  In this post, I present to the habrasoobshchestvo the results of their inept and unsystematic experiences with VMware vSphere 4.1 <br><a name="habracut"></a><br><h3>  About work </h3><br>  I conducted this research in the framework of a special section of my graduation project. <br>  The research part is based on the translation of the NIST SP 800-125 standard (see <a href="http://habrahabr.ru/post/166623/">post</a> ). <br>  A special section was tasked with examining the most likely threats, so a model of an intruder was chosen. <br><br><h3>  About stand </h3><br>  The stand is a cluster of 3 ESX 4.1 servers on which 4 VMs spin (two for Ubuntu 12.10, two for WinServer 2008 R2), each with two vNICs: a common lab VLAN routed to the local segment and an isolated VLAN. <br>  From the application software used: <br><ul><li>  Wireshark 1.8.7 for Windows </li><li>  Tcpdump and dsniff packages </li></ul><br><h3>  Experiences </h3><br>  <b>Sniffing</b> <br>  The first thing I started to explore is the promiscuous virtual switch mode.  Already in the process I came across a good comprehensive article on the VMware Community.  Since  the original is always better than retelling, I recommend using a <a href="http://communities.vmware.com/people/Deshifrator/blog/2011/05/16/promiscuous-mode">direct link</a> . <br><br>  <b>MAC spoofing</b> <br>  Physical enough "smart" switches have mechanisms that prevent attacks such as Substitution of MAC addresses.  These are, for example, the port security settings in Cisco Systems switches, which can be used to strictly specify the allowed addresses for each port of the device. <br>  In a virtual environment has its own specifics.  All VM settings, including the MAC address, are stored in VM files, which only the virtualized infrastructure administrator is authorized to change.  Only VMs can create VMs and connect them to groups of virtual ports, as well as to VLANs.  In addition, there is a MAC Address Changes - Accept / Reject setting that permits or prohibits the guest OS from accessing the network with an address different from that recorded in the VM file (which, by the way, allows substitution by default). <br>  It would be logical to prohibit the change of address, however, it is not difficult to imagine a situation where the customer of the IaaS service (Infrastructure as a service - infrastructure as a service) will need this opportunity (for example, to test their software). <br>  One of the options: do the same as with the previous threat - split the VLAN into parts with different settings. <br>  Consider the second option, when the administrator of the IVI for incompetence or in the hope of the providence of VMware developers, leaves the default settings (the Promiscuous mode for the port group is not enabled). <br><div class="spoiler">  <b class="spoiler_title">Simple attack scheme</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/283/ae9/02c/283ae902c998de7b72e9af30224fa378.jpg"></div></div><br>  Let ICMP exchange between one of the VMs under Windows with an external host (from the local network) be the target information flow. <br>  All that an attacker should have: the victim's MAC address and the rights of the local administrator of the guest OS in his VM. <br>  Attack: <br>  <i>sudo su -</i> <i><br></i>  <i>ifconfig eth0 down</i> <i><br></i>  <i>ifconfig eth0 hw ether NEW_MAC</i> <i><br></i>  <i>ifconfig eth0 up</i> <i><br></i>  <i>tcpdump ‚Äìn src host 10.106.30.104</i> <i><br></i> <br>  Result: the attacker intercepts the entire exchange.  In addition, the attack is very difficult to detect.  The frequency of requests coming to the attacked VM has not changed and is equal to the frequency of intercepted requests on the attacker, which means that the virtual switchboard simply duplicates the packets.  The interconnection of machines is also not disturbed.  Only direct exchange between these VMs becomes impossible. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>MAC flood</b> <br>  The most "unclean" experiment, conducted without thought, but which led to interesting consequences and, of course, requiring a more detailed study. <br><br>  Each physical switch operates with data CAM (Content Addressable Memory) or, simply, a switching table.  Its volume for different models varies.  For example (the data is charred where it does not claim to be a scientific truth): <br><ul><li>  Cisco Catalyst 2960 - up to 8000 MAC addresses; </li><li>  Cisco Catalyst 3560 - up to 12000 MAC addresses; </li><li>  Cisco Catalyst 6500 - up to 96000 MAC addresses. </li></ul><br>  When the CAM table overflows, new entries will not be added, all traffic will pass to all ports (although, in general, switches may behave differently).  The attacker can "listen" to all network traffic and receive confidential information. <br>  To suppress such an attack, you need to specify that the switch port to which the user is connected may have, for example, no more than one MAC address, and if more than one appears, put the port into a disabled state and send a message to the administrator about the security breach (for example, port security settings in Cisco). <br>  In VMware, there is a setting Forged Transmits - Accept / Reject, but, as already discussed above, there may be situations where it is not possible to use it.  Therefore, there is a need to clarify the possible consequences of such attacks in order to manage risks. <br>  To implement the attack, the macof program from the dsniff package was used. <br><div class="spoiler">  <b class="spoiler_title">Attack pattern</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/5f8/22a/f5a/5f822af5a8578b33d0e3f7d0909b15a3.jpg"></div></div><br>  I must say about the shortcomings of the experiment: <br><ol><li>  The first one is the main one: the attackers were in the routed VLAN, the attacked ones were in the isolated one.  It would be much better to do the opposite. </li><li>  The second is a circuit flaw.  Due to the use of a cluster, it is difficult to judge the results. </li></ol>  But first things first. <br><br>  With the beginning of the attack, packet jitter immediately increased, <div class="spoiler">  <b class="spoiler_title">(see ping)</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/5bf/09e/d38/5bf09ed383f0f95a5c71aa29cb3e45bd.jpg"></div></div>  but so far nothing critical. <br>  After a couple of minutes, the VM consoles began to noticeably ‚Äúslow down‚Äù, individual packets began to get lost. <br><div class="spoiler">  <b class="spoiler_title">(see dump)</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/373/ebb/51c/373ebb51c4ecec6d7da48864c98b715b.jpg"></div></div>  Finally, somewhere in 5-7 minutes after the start, everything collapsed: before the client connection to the vCenter fell off, it managed to notice the unavailability messages of individual VMs, the VM consoles did not open - the rack switch refused (Top of Rack). <br>  In practice, this means not only the DoS of the public service, but also, possibly, some of the internal services of the provider, which cannot be an acceptable risk, which means that countermeasures are required. <br><br>  I must say, I did not fix the switch to virtual hub mode (at least, the VLANs were divided to the last). <br><br>  Due to the shortcomings of the test described above, it is difficult to say what exactly happened and what was the true reason (at least for me).  I would be very happy if anyone in comments (or hp) will be able to decompose the result on the shelves. <br><br>  This is all the most interesting work I have done. <br>  Waiting for feedback: suggestions, advice, corrections, and all else.  =) Thank you for your attention. </div><p>Source: <a href="https://habr.com/ru/post/182508/">https://habr.com/ru/post/182508/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../182488/index.html">Can I cash in on users? 3 easy ways to increase application monetization</a></li>
<li><a href="../182494/index.html">Microsoft released another set of updates, June 2013</a></li>
<li><a href="../182502/index.html">High Availability Optical Ring</a></li>
<li><a href="../182504/index.html">IT infrastructure health metrics, thresholds and users of IT services</a></li>
<li><a href="../182506/index.html">Porting code to iOS / Android mobile devices</a></li>
<li><a href="../182512/index.html">Ekovozhdeniye with the new Cellocator IQ 50 terminal: a practical overview</a></li>
<li><a href="../182516/index.html">New chipsets from Texas Instruments will speed up charging time and increase battery life for smartphones and tablets</a></li>
<li><a href="../182518/index.html">How to make qmake always rebuild a project from scratch when changing macros</a></li>
<li><a href="../182520/index.html">Indexing nonatomic attributes</a></li>
<li><a href="../182522/index.html">Yandex's position on the new draft law on Internet regulation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>