<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Last line effect</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I studied a lot of errors resulting from copying code. And I assert that most often errors are made in the last fragment of the same type of code. I h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Last line effect</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/d41/e16/fe8/d41e16fe8d628e4668044a507f00e2dc.png" alt="Copy paste" align="left"><br>  I studied a lot of errors resulting from copying code.  And I assert that most often errors are made in the last fragment of the same type of code.  I have never met in the books describing this phenomenon, so I decided to write about it.  I called it the ‚Äúlast line effect‚Äù. <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  My name is Andrey Karpov.  I am engaged in an unusual occupation.  I examine the application code with a static analyzer and describe the errors and shortcomings found.  I do this because of pragmatic and selfish motives.  So our company advertises the tool PVS-Studio.  Found errors.  Described in the article.  Attracted attention.  Profit.  But today the article is not about the analyzer. <br><br>  In the process of analyzing projects, I save the noticed errors and the corresponding code fragments in a special database.  By the way, anyone can get acquainted with the contents of this database.  We turn it into a set of html-pages and post them on the website in the section " <a href="http://www.viva64.com/ru/examples/">Identified errors</a> ". <br><br>  The base is unique!  Now it contains about 1500 code fragments with errors.  She is waiting for people who will be able to identify patterns in these errors.  This can be the basis of many studies and materials for books and articles. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Specifically, I did not do any research accumulated material.  Nevertheless, one pattern manifests itself so clearly that I decided to study it in more detail.  In articles I often have to write "pay attention to the last line."  I decided that this is not casual. <br><br><h2>  Last line effect </h2><br>  In the source code of a program, it is often necessary to write several similar constructions in succession.  Typing the same type code several times is boring and inefficient.  Therefore, the Copy-Paste method is used.  The code fragment is copied several times, after which the edits are made.  Everyone knows that this method is bad.  It is easy to forget to change something and as a result, the code will contain an error.  Unfortunately, there is often no good alternative. <br><br>  Now about the patterns.  I found out that most often the error is allowed in the most recent copied block of code. <br><br>  A simple short example: <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> Vector3int32&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>+=(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Vector3int32&amp; other) { x += other.x; y += other.y; z += other.y; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre> <br>  Pay attention to the line "z + = other.y;".  They forgot to change 'y' to 'z'. <br><br>  The example seems artificial.  But this code is taken from a real application.  Further I will convincingly show that this is a very common and common situation.  This is exactly what the ‚Äúlast line effect‚Äù looks like.  A person most often makes a mistake at the very end of making similar corrections. <br><br>  I heard somewhere that climbers often fall in the last ten meters of ascent.  Not because they are tired.  They just rejoice that there is quite a bit left.  They anticipate the sweet taste of victory over the summit.  As a result, they weaken attention and make a fatal mistake.  Apparently, something like this happens with programmers. <br><br>  Now a few numbers. <br><br>  After examining the error base, I identified 84 code fragments, which, it seems to me, were written using Copy-Paste.  Of these, 41 fragments contain an error somewhere in the middle of the copied blocks.  Here is an example: <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(argv[argidx], <span class="hljs-string"><span class="hljs-string">"CAT="</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(argv[argidx], <span class="hljs-string"><span class="hljs-string">"DECOY="</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>) &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(argv[argidx], <span class="hljs-string"><span class="hljs-string">"THREADS="</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>) &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(argv[argidx], <span class="hljs-string"><span class="hljs-string">"MINPROB="</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>)) {</code> </pre> <br>  The length of the string "THREADS =" is not 6, but 8 characters. <br><br>  In the remaining 43 cases, the error was found in the most recent copied block. <br><br>  At first glance, the number 43 is quite a bit more than 41. But keep in mind that there are quite a few blocks of the same type.  And the error can be in the first, second, fifth or even in the tenth block.  We obtain a relatively even distribution of errors in the blocks and a sharp jump at the end. <br><br>  On average, I took that the number of blocks of the same type is 5. <br><br>  It turns out that the first 4 blocks account for 41 errors.  Or about 10 errors per block. <br><br>  The last fifth block has 43 errors! <br><br>  For clarity, you can build such an approximate graph: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bda/2b5/bc3/bda2b5bc3f0461ebba14455c75ab6995.png" alt="Figure 1. A rough graph of the number of errors in five blocks of similar code."><br><br>  Figure 1. A rough graph of the number of errors in five blocks of similar code. <br><br>  It turns out: <br><br>  <b>The probability of making a mistake in the last copied block is 4 times greater than in any other.</b> <br><br>  I do not draw any grand conclusions from this.  Just an interesting observation.  From a practical point of view, it is useful to know about it.  Then you can force yourself not to relax at the very end. <br><br><h2>  Examples </h2><br>  It remains to convince readers that this is not my fantasies, but the realities of life.  For this, I will demonstrate examples that confirm my words. <br><br>  I, of course, will not give all examples.  I confine myself to the most simple or revealing. <br><br><h3>  Source Engine SDK </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ix=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> iy=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> iz=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> iw = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function"> </span></span>{ SetX( ix ); SetY( iy ); SetZ( iz ); SetZ( iw ); }</code> </pre> <br>  At the end, it was necessary to call the SetW () function. <br><br><h3>  Chromium </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (access &amp; FILE_WRITE_ATTRIBUTES) output.append(ASCIIToUTF16(<span class="hljs-string"><span class="hljs-string">"\tFILE_WRITE_ATTRIBUTES\n"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (access &amp; FILE_WRITE_DATA) output.append(ASCIIToUTF16(<span class="hljs-string"><span class="hljs-string">"\tFILE_WRITE_DATA\n"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (access &amp; FILE_WRITE_EA) output.append(ASCIIToUTF16(<span class="hljs-string"><span class="hljs-string">"\tFILE_WRITE_EA\n"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (access &amp; FILE_WRITE_EA) output.append(ASCIIToUTF16(<span class="hljs-string"><span class="hljs-string">"\tFILE_WRITE_EA\n"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre> <br>  Matches the last and the penultimate block. <br><br><h3>  ReactOS </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*ScanString == L'\<span class="hljs-string"><span class="hljs-string">"' || *ScanString == L'^' || *ScanString == L'\"')</span></span></code> </pre> <br><h3>  Multi theft auto </h3><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CWaterPolySAInterface</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: WORD m_wVertexIDs[<span class="hljs-number"><span class="hljs-number">3</span></span>]; }; CWaterPoly* CWaterManagerSA::CreateQuad (....) { .... pInterface-&gt;m_wVertexIDs [ <span class="hljs-number"><span class="hljs-number">0</span></span> ] = pV1-&gt;GetID (); pInterface-&gt;m_wVertexIDs [ <span class="hljs-number"><span class="hljs-number">1</span></span> ] = pV2-&gt;GetID (); pInterface-&gt;m_wVertexIDs [ <span class="hljs-number"><span class="hljs-number">2</span></span> ] = pV3-&gt;GetID (); pInterface-&gt;m_wVertexIDs [ <span class="hljs-number"><span class="hljs-number">3</span></span> ] = pV4-&gt;GetID (); .... }</code> </pre> <br>  The last line is written by inertia and is redundant.  There are only 3 elements in the array. <br><br><h3>  Source Engine SDK </h3><br><pre> <code class="cpp hljs">intens.x=OrSIMD(AndSIMD(BackgroundColor.x,no_hit_mask), AndNotSIMD(no_hit_mask,intens.x)); intens.y=OrSIMD(AndSIMD(BackgroundColor.y,no_hit_mask), AndNotSIMD(no_hit_mask,intens.y)); intens.z=OrSIMD(AndSIMD(BackgroundColor.y,no_hit_mask), AndNotSIMD(no_hit_mask,intens.z));</code> </pre> <br>  In the last line they forgot to replace ‚ÄúBackgroundColor.y‚Äù by ‚ÄúBackgroundColor.z‚Äù. <br><br><h3>  Trans-Proteomic Pipeline </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPepMaxProb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> max4 = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> max5 = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> max6 = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> max7 = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( pep3 ) { ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( use_joint_probs &amp;&amp; prob &gt; max3 ) ... } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( pep4 ) { ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( use_joint_probs &amp;&amp; prob &gt; max4 ) ... } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( pep5 ) { ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( use_joint_probs &amp;&amp; prob &gt; max5 ) ... } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( pep6 ) { ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( use_joint_probs &amp;&amp; prob &gt; max6 ) ... } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( pep7 ) { ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( use_joint_probs &amp;&amp; prob &gt; max6 ) ... } .... }</code> </pre> <br>  In the last condition, we forgot to replace ‚Äúprob&gt; max6‚Äù with ‚Äúprob&gt; max7‚Äù. <br><br><h3>  Seqan </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Value&lt;Pipe&gt;::Type <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>*() { tmp.i1 = *in.in1; tmp.i2 = *in.in2; tmp.i3 = *in.in2; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; }</code> </pre> <br><h3>  Slimdx </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>; i++ ) { sliders[i] = joystate.rglSlider[i]; asliders[i] = joystate.rglASlider[i]; vsliders[i] = joystate.rglVSlider[i]; fsliders[i] = joystate.rglVSlider[i]; }</code> </pre> <br>  The last line should have used the rglFSlider array. <br><br><h3>  Qt </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (repetition == QStringLiteral(<span class="hljs-string"><span class="hljs-string">"repeat"</span></span>) || repetition.isEmpty()) { pattern-&gt;patternRepeatX = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; pattern-&gt;patternRepeatY = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (repetition == QStringLiteral(<span class="hljs-string"><span class="hljs-string">"repeat-x"</span></span>)) { pattern-&gt;patternRepeatX = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (repetition == QStringLiteral(<span class="hljs-string"><span class="hljs-string">"repeat-y"</span></span>)) { pattern-&gt;patternRepeatY = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (repetition == QStringLiteral(<span class="hljs-string"><span class="hljs-string">"no-repeat"</span></span>)) { pattern-&gt;patternRepeatY = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; pattern-&gt;patternRepeatY = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> exception: SYNTAX_ERR }</span></span></code> </pre> <br>  In the very last block they forgot about 'patternRepeatX'.  It should be: <br><pre> <code class="cpp hljs">pattern-&gt;patternRepeatX = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; pattern-&gt;patternRepeatY = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre> <br><h3>  ReactOS </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> istride = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(tmp[<span class="hljs-number"><span class="hljs-number">0</span></span>]) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(tmp[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> jstride = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(tmp[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(tmp[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mistride = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(mag[<span class="hljs-number"><span class="hljs-number">0</span></span>]) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(mag[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mjstride = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(mag[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(mag[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]);</code> </pre> <br>  The variable 'mjstride' will always be equal to one.  The last line should be: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mjstride = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(mag[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(mag[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]);</code> </pre> <br><h3>  Mozilla firefox </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (protocol.EqualsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"http"</span></span>) || protocol.EqualsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"https"</span></span>) || protocol.EqualsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"news"</span></span>) || protocol.EqualsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ftp"</span></span>) || &lt;&lt;&lt;--- protocol.EqualsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"file"</span></span>) || protocol.EqualsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"javascript"</span></span>) || protocol.EqualsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ftp"</span></span>)) { &lt;&lt;&lt;---</code> </pre> <br>  Suspicious string "ftp" at the end.  This line has already been compared. <br><br><h3>  Quake-III-Arena </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">fabs</span></span>(dir[<span class="hljs-number"><span class="hljs-number">0</span></span>]) &gt; test-&gt;radius || <span class="hljs-built_in"><span class="hljs-built_in">fabs</span></span>(dir[<span class="hljs-number"><span class="hljs-number">1</span></span>]) &gt; test-&gt;radius || <span class="hljs-built_in"><span class="hljs-built_in">fabs</span></span>(dir[<span class="hljs-number"><span class="hljs-number">1</span></span>]) &gt; test-&gt;radius)</code> </pre> <br>  Did not check value from dir cell [2]. <br><br><h3>  Clang </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (ContainerBegLine &lt;= ContaineeBegLine &amp;&amp; ContainerEndLine &gt;= ContaineeEndLine &amp;&amp; (ContainerBegLine != ContaineeBegLine || SM.getExpansionColumnNumber(ContainerRBeg) &lt;= SM.getExpansionColumnNumber(ContaineeRBeg)) &amp;&amp; (ContainerEndLine != ContaineeEndLine || SM.getExpansionColumnNumber(ContainerREnd) &gt;= SM.getExpansionColumnNumber(ContainerREnd)));</code> </pre> <br>  At the very end, the expression "SM.getExpansionColumnNumber (ContainerREnd)" is compared to itself. <br><br><h3>  MongoDB </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>==(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MemberCfg&amp; r) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _id==r._id &amp;&amp; votes == r.votes &amp;&amp; h == rh &amp;&amp; priority == r.priority &amp;&amp; arbiterOnly == r.arbiterOnly &amp;&amp; slaveDelay == r.slaveDelay &amp;&amp; hidden == r.hidden &amp;&amp; buildIndexes == buildIndexes; }</code> </pre> <br>  Lost at the very end about the "r.". <br><br><h3>  Unreal Engine 4 </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PositionIsInside</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Position.X &gt;= Control.Center.X - BoxSize.X * <span class="hljs-number"><span class="hljs-number">0.5f</span></span> &amp;&amp; Position.X &lt;= Control.Center.X + BoxSize.X * <span class="hljs-number"><span class="hljs-number">0.5f</span></span> &amp;&amp; Position.Y &gt;= Control.Center.Y - BoxSize.Y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span> &amp;&amp; Position.Y &gt;= Control.Center.Y - BoxSize.Y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; }</code> </pre> <br>  The last line forgot to make 2 edits.  First, you need to replace "&gt; =" with "&lt;=. Secondly, replace the minus with a plus. <br><br><h3>  Qt </h3><br><pre> <code class="cpp hljs">qreal x = ctx-&gt;callData-&gt;args[<span class="hljs-number"><span class="hljs-number">0</span></span>].toNumber(); qreal y = ctx-&gt;callData-&gt;args[<span class="hljs-number"><span class="hljs-number">1</span></span>].toNumber(); qreal w = ctx-&gt;callData-&gt;args[<span class="hljs-number"><span class="hljs-number">2</span></span>].toNumber(); qreal h = ctx-&gt;callData-&gt;args[<span class="hljs-number"><span class="hljs-number">3</span></span>].toNumber(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!qIsFinite(x) || !qIsFinite(y) || !qIsFinite(w) || !qIsFinite(w))</code> </pre> <br>  In the most recent call to the qIsFinite function, the 'h' variable must be used as an argument. <br><br><h3>  Openssl </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(vstart, <span class="hljs-string"><span class="hljs-string">"ASCII"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>)) arg-&gt;format = ASN1_GEN_FORMAT_ASCII; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(vstart, <span class="hljs-string"><span class="hljs-string">"UTF8"</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>)) arg-&gt;format = ASN1_GEN_FORMAT_UTF8; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(vstart, <span class="hljs-string"><span class="hljs-string">"HEX"</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)) arg-&gt;format = ASN1_GEN_FORMAT_HEX; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(vstart, <span class="hljs-string"><span class="hljs-string">"BITLIST"</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)) arg-&gt;format = ASN1_GEN_FORMAT_BITLIST;</code> </pre> <br>  The length of the string "BITLIST" is not 3, but 7 characters. <br><br>  On this stop.  I think these examples are more than enough. <br><br><h2>  Conclusion </h2><br>  In this article, you learned that when using Copy-Paste, the probability of making a mistake in the last copied block is 4 times higher than in any other block. <br><br>  This is a feature of human psychology, not his professional skills.  In the article, we saw that even highly skilled developers of projects such as Clang or Qt are prone to mistakes in the end. <br><br>  I hope my observation will be useful.  And, perhaps, will push people to research the accumulated base of errors.  I think it will allow you to find many interesting patterns and formulate new recommendations for programmers. <br><br><h2>  This article is in English. </h2><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Karpov.  <a href="http://www.viva64.com/en/b/0260/">The Last Line Effect</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected the answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio and CppCat, version 2014</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/224783/">https://habr.com/ru/post/224783/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224771/index.html">I want to! Or the world of advertising upside down</a></li>
<li><a href="../224773/index.html">Google's XSS-game</a></li>
<li><a href="../224775/index.html">To be in 3d or not to be? How I scanned and printed myself on a 3d printer</a></li>
<li><a href="../224777/index.html">Simple Science - Digest of Experiences # 33</a></li>
<li><a href="../224779/index.html">Gitchain: a mix of github with bitcoin</a></li>
<li><a href="../224785/index.html">Lessons from space accidents: the hard road to soft landing of the E-6 program</a></li>
<li><a href="../224789/index.html">Ballad of Selling Letters</a></li>
<li><a href="../224791/index.html">Version 1.0 of the Socket.IO library released</a></li>
<li><a href="../224793/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ111 (May 25 - 31, 2014)</a></li>
<li><a href="../224795/index.html">Making a visual web-editor of documents based on LibreOffice, jodconverter and TinyMCE</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>