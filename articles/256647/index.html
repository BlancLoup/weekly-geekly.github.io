<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Container in linux, linux in egg, egg in python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, {{username}} 

 I am DevOps and really love Linux. It is clear that with such a bundle I just could not help loving LinuX Containers (especiall...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Container in linux, linux in egg, egg in python</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/1e9/487/009/1e948700995555f0c7512350c77ab485.jpg" alt="tux in egg in python"><br><br>  Hello, {{username}} <br><br>  I am DevOps and really love Linux.  It is clear that with such a bundle I just could not help loving LinuX Containers (especially since BSD and Solaris have long been pleased with similar capabilities of their users). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Naturally, the business also saw an attractive opportunity and container management programs began to grow and multiply: <a href="https://github.com/docker/docker">docker</a> , <a href="https://github.com/coreos/rkt">rocket</a> , <a href="https://github.com/tailhook/vagga">vagga</a> , <a href="https://linuxcontainers.org/">lxc</a> , <a href="https://wiki.archlinux.org/index.php/Systemd-nspawn">systemd-nspawn</a> , etc ... <br><br>  Docker became the de facto standard primarily due to the content creation and delivery system.  But the main docker daemon runs as root, and, in my opinion, this is a minus of this project ( <a href="https://fosterelli.co/privilege-escalation-via-docker.html">Proof</a> ). <br><br>  Rocket and vagga went the other way, and this path is called unprivileged containers.  You no longer need root privileges to run the process in new namespaces, and this opens up interesting prospects for building test sites and a safe environment. <br><br>  But in all these projects there is one fatal flaw: they are all written using c, go, and rust, and I love python and cannot participate in their development.  Agree, it's a pity to miss all the fun. <br><br>  So, under the cut, you will find a library for running processes in the new <a href="http://man7.org/linux/man-pages/man7/user_namespaces.7.html">linux user namespaces</a> : <br><a name="habracut"></a><br><h4>  <a href="https://pypi.python.org/pypi/pyspaces">Pyspaces</a> </h4><br>  <i>Baby you just space</i> <br><br><h5>  <b>Goals</b> </h5><br>  Now there is no convenient way to work with linux namespaces from python: <br><ul><li>  you can use <a href="">asylum</a> - the project looks dead and is hosted incomprehensibly where </li><li>  or you can try <a href="">python-libvirt</a> binding with a high level of abstraction </li><li>  use c code like vagga and lxc do </li><li>  or pull glibc calls using ctypes </li><li>  otherwise, subprocess.Popen remains. </li></ul><br>  I want to change this: I want to create native python bindings to the glibc library with an interface like in multiprocessing.Process.  And a few more goals: <br><ul><li>  popularize linux </li><li>  popularize python </li><li>  participate in the creation of a popular open source project </li><li>  become famous </li><li>  popularity and girls will be a nice bonus </li></ul><br>  PS: just look at <a href="https://github.com/zalando/python-nsenter">python-nsenter</a> - it looks great! <br><br><h5>  <b>Example</b> </h5><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pyspaces <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Container <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(argv)</span></span></span><span class="hljs-function">:</span></span> os.execvp(argv[<span class="hljs-number"><span class="hljs-number">0</span></span>], argv) cmd = <span class="hljs-string"><span class="hljs-string">"mount -t proc proc /proc; ps ax"</span></span> c = Container(target=execute, args=((<span class="hljs-string"><span class="hljs-string">'bash'</span></span>, <span class="hljs-string"><span class="hljs-string">'-c'</span></span>, cmd),), uid_map=<span class="hljs-string"><span class="hljs-string">'0 1000 1'</span></span>, newpid=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, newuser=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, newns=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> ) c.start() print(<span class="hljs-string"><span class="hljs-string">"PID of child created by clone() is %ld\n"</span></span> % c.pid) c.join() print(<span class="hljs-string"><span class="hljs-string">"Child returned: pid %s, status %s"</span></span> % (c.pid, c.exitcode))</code> </pre> <br><pre> <code class="bash hljs">PID of child created by <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span>() is 15978 PID TTY STAT TIME COMMAND 1 pts/19 S+ 0:00 bash -c mount -t proc proc /proc; ps ax 3 pts/19 R+ 0:00 ps ax Child returned: pid 15978, status 0</code> </pre><br><h5>  <b>CLI</b> </h5><br><pre> <code class="bash hljs">space -v execute --pid --fs --user --uid <span class="hljs-string"><span class="hljs-string">'0 1000 1'</span></span> bash -c <span class="hljs-string"><span class="hljs-string">'mount -t proc /proc; ps ax'</span></span> space chroot --pid --uid <span class="hljs-string"><span class="hljs-string">'0 1000 1'</span></span> ~/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share/lxc/ubuntu/rootfs/ /bin/ls /home/</code> </pre><br><h5>  <b>Todo</b> </h5><br><ol><li>  [x] clone &amp; Container </li><li>  [x] CLI </li><li>  [x] chroot </li><li>  [] process list </li><li>  [] inject </li><li>  [] move CLI to separate package </li><li>  [] addons </li><li>  [] support for lxc, vagga, rocket, docker, etc ... </li><li>  [] ... </li><li>  [] one tool for rule them all !! 1 </li></ol><br><h5>  <b>Links</b> </h5><br> <a href="https://github.com/Friz-zy/pyspaces"><img src="https://habrastorage.org/getpro/habr/post_images/63a/010/b5e/63a010b5e29ee3678e4e2a257f8fdeb9.png" alt="github"></a> <a href="https://pypi.python.org/pypi/pyspaces/"><img src="https://pypip.in/download/pyspaces/badge.svg" alt="pypi"></a> <a href="https://pyspaces.readthedocs.org/en/latest/"><img src="https://readthedocs.org/projects/pyspaces/badge/" alt="docs"></a> <br><br>  License - MIT, but also going to add BSD and Apache 2.0 <br><br><h5>  <b>It's not the end</b> </h5><br>  There is a lot of work to be done: we need normal tests, documentation, new features and pleasant cli.  The postponement of the announcement on the back burner was interrupted by the guys from <a href="https://ru-ru.facebook.com/MinskPythonMeetup">Minsk Python Meetup</a> , for which many thanks to them.  Now I hope for community support and interest;) <br><br>  And in conclusion, I would like to quote the creator of scipy &amp; numpy: <br><blockquote>  Keys to success: Hard work - specially up front <br>  Often lonely - not yours.  Others need some 'proof' before they join you. <br>  It will be you. <br><br>  I spent 18 months not publishing papers to write NumPy <br>  (despite many people telling me it was foolish) <br>  <a href="https://youtu.be/oXRvpBJ-Dkc%3Ft%3D967">Travis oliphant</a> <br></blockquote><br>  PS: you can chat live with me on the topic and not only at the next <a href="https://ru-ru.facebook.com/MinskPythonMeetup">Minsk Python Meetup</a> </div><p>Source: <a href="https://habr.com/ru/post/256647/">https://habr.com/ru/post/256647/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../256635/index.html">How to create a template for Joomla</a></li>
<li><a href="../256637/index.html">We close the project CppCat</a></li>
<li><a href="../256639/index.html">A modern approach to HTTP with PHPixie and PSR-7</a></li>
<li><a href="../256641/index.html">To help the fisherman - bite warning device</a></li>
<li><a href="../256643/index.html">Material Design. Dynamic Toolbar on a live example</a></li>
<li><a href="../256649/index.html">PHP Digest number 61 - interesting news, materials and tools (April 13 - 26, 2015)</a></li>
<li><a href="../256651/index.html">93 video lectures on Scala</a></li>
<li><a href="../256653/index.html">Microsoft SQL Server Data Tools</a></li>
<li><a href="../256655/index.html">All about triggers in Oracle</a></li>
<li><a href="../256659/index.html">Anatomy of IPsec. Check the strength of the legendary protocol</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>