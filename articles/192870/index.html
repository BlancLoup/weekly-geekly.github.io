<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mongodb 3.2 release some details</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently a new stable release mongodb released. In this version, a number of innovations were added, such as a new GUI for visual work with mongodb , ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mongodb 3.2 release some details</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e36/58a/ca6/e3658aca69ab496895f5bc53c7357632.jpeg"><br>  Recently a new stable release <code>mongodb</code> released.  In this version, a number of innovations were added, such as a new <code>GUI</code> for visual work with <code>mongodb</code> , <code>LEFT JOIN</code> , document validation, etc.  we will look at some of these properties with small examples below. <br><ul><li>  <a href="https://habr.com/ru/post/192870/">Partial (partial) index</a> </li><li>  <a href="https://habr.com/ru/post/192870/">Validation</a> </li><li>  <a href="https://habr.com/ru/post/192870/">Innovations of the aggregation framework</a> </li><li>  <a href="https://habr.com/ru/post/192870/">New options in import export utilities</a> </li><li>  <a href="https://habr.com/ru/post/192870/">Innovations in CRUD</a> </li><li>  <a href="https://habr.com/ru/post/192870/">WiredTiger and fsyncLock</a> </li><li>  <a href="https://habr.com/ru/post/192870/">New GUI compass</a> </li></ul><br><a name="habracut"></a><br><h3><a name="0"></a>  <font color="orange">Partial (partial) index</font> </h3><br>  <code>MongoDB 3.2</code> provides the ability to create indexes only for those collection documents that will match the specified filter.  Indexing only parts of the required documents in the collection has a number of advantages, such as lower storage requirements, and lower performance costs, to create and maintain an index.  You can specify the <code>partialFilterExpression</code> option for all <code>MongoDB</code> index <a href="https://docs.mongodb.org/manual/core/index-types/">types</a> . <br><br>  To create a partial index, use the <code>db.collection.createIndex()</code> method with the new <code>partialFilterExpression</code> option.  In the following example, we will create a composite index that will index only those documents that have a rating greater than 5. <br><pre> <code class="python hljs">db.restaurants.createIndex( { cuisine: <span class="hljs-number"><span class="hljs-number">1</span></span>, name: <span class="hljs-number"><span class="hljs-number">1</span></span> }, { partialFilterExpression: { rating: { $gt: <span class="hljs-number"><span class="hljs-number">5</span></span> } } } )</code> </pre><br><h4>  Comparison with sparse index. </h4><br>  A partial index provides a larger set of capabilities than a sparse index and is therefore preferable.  The partial index offers a more expressive mechanism for specifying which documents are better to index. <br>  Sparse indexes select documents to be indexed solely based on the presence of an indexed field. <br>  An example of a sparse index behavior using a partial index: <br><pre> <code class="python hljs">db.contacts.createIndex( { name: <span class="hljs-number"><span class="hljs-number">1</span></span> }, { partialFilterExpression: { name: { $exists: true } } } )</code> </pre><br><br>  Consider another example with a partial index, here the field by which the <code>name</code> will be indexed, and the field by which documents will be filtered, another: <br><pre> <code class="python hljs">db.contacts.createIndex( { name: <span class="hljs-number"><span class="hljs-number">1</span></span> }, { partialFilterExpression: { email: { $exists: true } } } )</code> </pre><br>  The following query can use an index: <br><pre> <code class="python hljs">db.contacts.find( { name: <span class="hljs-string"><span class="hljs-string">"xyz"</span></span>, email: { $regex: /\.org$/ } } )</code> </pre><br>  And for this request, the index can not be used: <br><pre> <code class="python hljs">db.contacts.find( { name: <span class="hljs-string"><span class="hljs-string">"xyz"</span></span>, email: { $exists: false } } )</code> </pre><br><h4>  Restrictions </h4><br>  In <code>mongodb</code> you cannot create multiple versions of an index that differ only in parameters.  You cannot create many partial indexes that differ only in filter parameters. <br>  In earlier versions of <code>mongodb</code> , partial indexes were not supported.  All <code>sharded</code> clusters, replica sets and all nodes should work on <code>mongodb 3.2</code> . <br>  <code>_id</code> index cannot be a partial index. <br>  The key of the shard also cannot be a partial index. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Consider a collection of <code>restaurants</code> that contains the following documents and looks like this: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"5641f6a7522545bc535b5dc9"</span></span>), <span class="hljs-string"><span class="hljs-string">"address"</span></span> : { <span class="hljs-string"><span class="hljs-string">"building"</span></span> : <span class="hljs-string"><span class="hljs-string">"1007"</span></span>, <span class="hljs-string"><span class="hljs-string">"coord"</span></span> : [ <span class="hljs-number"><span class="hljs-number">-73.856077</span></span>, <span class="hljs-number"><span class="hljs-number">40.848447</span></span> ], <span class="hljs-string"><span class="hljs-string">"street"</span></span> : <span class="hljs-string"><span class="hljs-string">"Morris Park Ave"</span></span>, <span class="hljs-string"><span class="hljs-string">"zipcode"</span></span> : <span class="hljs-string"><span class="hljs-string">"10462"</span></span> }, <span class="hljs-string"><span class="hljs-string">"borough"</span></span> : <span class="hljs-string"><span class="hljs-string">"Bronx"</span></span>, <span class="hljs-string"><span class="hljs-string">"cuisine"</span></span> : <span class="hljs-string"><span class="hljs-string">"Bakery"</span></span>, <span class="hljs-string"><span class="hljs-string">"rating"</span></span> : { <span class="hljs-string"><span class="hljs-string">"date"</span></span> : ISODate(<span class="hljs-string"><span class="hljs-string">"2014-03-03T00:00:00Z"</span></span>), <span class="hljs-string"><span class="hljs-string">"grade"</span></span> : <span class="hljs-string"><span class="hljs-string">"A"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span> }, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Morris Park Bake Shop"</span></span>, <span class="hljs-string"><span class="hljs-string">"restaurant_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"30075445"</span></span> }</code> </pre><br>  We could add an index to the <code>borough</code> and <code>cuisine</code> fields by filtering only those documents where <code>rating.grade == A</code> <br><pre> <code class="python hljs">db.restaurants.createIndex( { borough: <span class="hljs-number"><span class="hljs-number">1</span></span>, cuisine: <span class="hljs-number"><span class="hljs-number">1</span></span> }, { partialFilterExpression: { <span class="hljs-string"><span class="hljs-string">'rating.grade'</span></span>: { $eq: <span class="hljs-string"><span class="hljs-string">"A"</span></span> } } } )</code> </pre><br>  The following query for a collection of <code>restaurants</code> using a partial index will return all the restaurants in <code>Bronx</code> where <code>rating.grade</code> equivalent to <code>A</code> <br><pre> <code class="python hljs">db.restaurants.find( { borough: <span class="hljs-string"><span class="hljs-string">"Bronx"</span></span>, <span class="hljs-string"><span class="hljs-string">'rating.grade'</span></span>: <span class="hljs-string"><span class="hljs-string">"A"</span></span> } )</code> </pre><br>  And this query will not be able to use the index, because there are no fields corresponding to <code>rating.grade</code> <br><pre> <code class="python hljs">db.restaurants.find( { borough: <span class="hljs-string"><span class="hljs-string">"Bronx"</span></span>, cuisine: <span class="hljs-string"><span class="hljs-string">"Bakery"</span></span> } )</code> </pre><br><h4>  Partial uniqueness index </h4><br>  A partial index can be applied to documents that contain <a href="https://docs.mongodb.org/manual/core/index-unique/">a unique constraint</a> . <br><br>  For example, take the <code>users</code> collection containing the following documents: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"56424f1efa0358a27fa1f99a"</span></span>), <span class="hljs-string"><span class="hljs-string">"username"</span></span> : <span class="hljs-string"><span class="hljs-string">"david"</span></span>, <span class="hljs-string"><span class="hljs-string">"age"</span></span> : <span class="hljs-number"><span class="hljs-number">29</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"56424f37fa0358a27fa1f99b"</span></span>), <span class="hljs-string"><span class="hljs-string">"username"</span></span> : <span class="hljs-string"><span class="hljs-string">"amanda"</span></span>, <span class="hljs-string"><span class="hljs-string">"age"</span></span> : <span class="hljs-number"><span class="hljs-number">35</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"56424fe2fa0358a27fa1f99c"</span></span>), <span class="hljs-string"><span class="hljs-string">"username"</span></span> : <span class="hljs-string"><span class="hljs-string">"rajiv"</span></span>, <span class="hljs-string"><span class="hljs-string">"age"</span></span> : <span class="hljs-number"><span class="hljs-number">57</span></span> }</code> </pre><br>  The following operation will create an index that imposes a unique restriction on the <code>username</code> field and a partial filter for the expression <code>age: { $gte: 21 }</code> <br><pre> <code class="python hljs">db.users.createIndex( { username: <span class="hljs-number"><span class="hljs-number">1</span></span> }, { unique: true, partialFilterExpression: { age: { $gte: <span class="hljs-number"><span class="hljs-number">21</span></span> } } } )</code> </pre><br>  The index prevents the insertion of the following documents, because documents with the specified name already exist and the <code>age</code> field is greater than 21: <br><pre> <code class="python hljs">db.users.insert( { username: <span class="hljs-string"><span class="hljs-string">"david"</span></span>, age: <span class="hljs-number"><span class="hljs-number">27</span></span> } ) db.users.insert( { username: <span class="hljs-string"><span class="hljs-string">"amanda"</span></span>, age: <span class="hljs-number"><span class="hljs-number">25</span></span> } ) db.users.insert( { username: <span class="hljs-string"><span class="hljs-string">"rajiv"</span></span>, age: <span class="hljs-number"><span class="hljs-number">32</span></span> } )</code> </pre><br>  And these documents will be inserted: <br><pre> <code class="python hljs">db.users.insert( { username: <span class="hljs-string"><span class="hljs-string">"david"</span></span>, age: <span class="hljs-number"><span class="hljs-number">20</span></span> } ) db.users.insert( { username: <span class="hljs-string"><span class="hljs-string">"amanda"</span></span> } ) db.users.insert( { username: <span class="hljs-string"><span class="hljs-string">"rajiv"</span></span>, age: null } )</code> </pre><br><br><h3><a name="1"></a>  <font color="orange">Validation</font> </h3><br>  Starting with version <code>3.2</code> , mongodb provides the ability to validate documents during the update and paste process.  Validation rules are specified when an explicit collection is created using the <code>validator</code> option, or using the <a href="https://docs.mongodb.org/manual/reference/command/collMod/">collMod command</a> for an existing collection.  The <code>validator</code> option accepts a document that matches certain expressions, with the exception of <code>$geoNear</code> , <code>$near</code> , <code>$nearSphere</code> , <code>$text</code> and <code>$where</code> . <br><br>  Consider the following example of creating a validation when creating a <code>contacts</code> collection: <br><pre> <code class="python hljs">db.createCollection( <span class="hljs-string"><span class="hljs-string">"contacts"</span></span>, { validator: { $<span class="hljs-keyword"><span class="hljs-keyword">or</span></span>: [ { phone: { $type: <span class="hljs-string"><span class="hljs-string">"string"</span></span> } }, { email: { $regex: /@mongodb\.com$/ } }, { status: { $<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: [ <span class="hljs-string"><span class="hljs-string">"Unknown"</span></span>, <span class="hljs-string"><span class="hljs-string">"Incomplete"</span></span> ] } } ] } } )</code> </pre><br>  <code>MongoDB</code> also provides a <code>validationLevel</code> option that determines how strictly <code>MongoDB</code> applies validation rules for existing documents during their update, and the <code>validationAction</code> option that determines whether mongodb should reject documents that violate validation rules. <br><br><h4>  Behavior </h4><br>  Validation occurs during the update and insertion of documents.  When adding validations to a collection, existing documents are not modified. <br><br><h4>  Existing documents </h4><br>  You can control how <code>mongodb</code> processes existing documents using the <code>validationLevel</code> option. <br>  By default, <code>validationLevel</code> is <code>strict</code> , and <code>mongodb</code> applies validation rules for all inserts and updates.  If <code>validationLevel</code> set to <code>moderate</code> , then validation rules for inserting and updating documents apply only to documents that fully meet the validation criteria. <br><br>  Consider the following documents in the <code>contacts</code> collection: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"125876"</span></span> <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Anne"</span></span>, <span class="hljs-string"><span class="hljs-string">"phone"</span></span>: <span class="hljs-string"><span class="hljs-string">"+1 555 123 456"</span></span>, <span class="hljs-string"><span class="hljs-string">"city"</span></span>: <span class="hljs-string"><span class="hljs-string">"London"</span></span>, <span class="hljs-string"><span class="hljs-string">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"Complete"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"860000"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Ivan"</span></span>, <span class="hljs-string"><span class="hljs-string">"city"</span></span>: <span class="hljs-string"><span class="hljs-string">"Vancouver"</span></span> }</code> </pre><br>  Run the command to add validation to the <code>contacts</code> collection: <br><pre> <code class="python hljs">db.runCommand( { collMod: <span class="hljs-string"><span class="hljs-string">"contacts"</span></span>, validator: { $<span class="hljs-keyword"><span class="hljs-keyword">or</span></span>: [ { phone: { $exists: true } }, { email: { $exists: true } } ] }, validationLevel: <span class="hljs-string"><span class="hljs-string">"moderate"</span></span> } )</code> </pre><br>  Now the <code>contacts</code> collection has a validator.  And now if we update the document with <code>{_id: 125876}</code> , <code>mongodb</code> will apply the validation rules, since the existing document meets the criteria.  And for the document <code>{ _id:860000 }</code> , mongodb will not apply validation rules for updates, since the document does not match the validation rule. <br>  If we need to disable validation, we can set the <code>validationLevel</code> option to <code>off</code> . <br><h4>  Accept or reject defective documents </h4><h4>  In the <code>validationAction</code> option, it is defined how to deal with documents that violated the validation rules. <br>  By default, <code>validationAction</code> is set to <code>error</code> and <code>MongoDB</code> rejects any insertions and updates of documents, if there is a violation of the validation rule.  When <code>validationAction</code> set to <code>warn</code> , <code>MongoDB</code> logs documents, but allows inserts and updates. <br><br>  The following example creates a <code>contacts</code> collection with a validator indicating that inserted or updated documents must meet at least one of the following three conditions: <br><ul><li>  the <code>phone</code> field must be a string </li><li>  The <code>email</code> field must be checked by regular expressions for consistency. </li><li>  The <code>status</code> field must be either Unknown or Incomplete. </li></ul><br><pre> <code class="python hljs">db.createCollection( <span class="hljs-string"><span class="hljs-string">"contacts"</span></span>, { validator: { $<span class="hljs-keyword"><span class="hljs-keyword">or</span></span>: [ { phone: { $type: <span class="hljs-string"><span class="hljs-string">"string"</span></span> } }, { email: { $regex: /@mongodb\.com$/ } }, { status: { $<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: [ <span class="hljs-string"><span class="hljs-string">"Unknown"</span></span>, <span class="hljs-string"><span class="hljs-string">"Incomplete"</span></span> ] } } ], validationAction: <span class="hljs-string"><span class="hljs-string">"warn"</span></span> } } )</code> </pre><br>  The next insert should fail, but since the validation rule <code><code><code>validationAction   warn</code> ,         . <br> <code class="python">2015-10-15T11:20:44.260-0400 W STORAGE [conn3] Document would fail validation collection: example.contacts doc: { _id: ObjectId('561fc44c067a5d85b96274e4'), name: "Amanda", status: "Updated" }</code> <br></code></code> <code><code><code>validationAction   warn</code> ,         . <br> <code class="python">2015-10-15T11:20:44.260-0400 W STORAGE [conn3] Document would fail validation collection: example.contacts doc: { _id: ObjectId('561fc44c067a5d85b96274e4'), name: "Amanda", status: "Updated" }</code> <br></code></code> <pre> <code class="hljs css"><code><code class="python"><code><span class="hljs-selector-tag"><span class="hljs-selector-tag">validationAction</span></span>   <span class="hljs-selector-tag"><span class="hljs-selector-tag">warn</span></span></code> ,         . <br> 2015<span class="hljs-selector-tag"><span class="hljs-selector-tag">-10-15T11</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:44.260-0400</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">W</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">STORAGE</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[conn3]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Document</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">would</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fail</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">validation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">collection</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">example</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.contacts</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">doc</span></span>: { <span class="hljs-attribute"><span class="hljs-attribute">_id</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">ObjectId</span></span>(<span class="hljs-string"><span class="hljs-string">'561fc44c067a5d85b96274e4'</span></span>), name: <span class="hljs-string"><span class="hljs-string">"Amanda"</span></span>, status: <span class="hljs-string"><span class="hljs-string">"Updated"</span></span> } <br></code></code></code> </pre> <code><code><code>validationAction   warn</code> ,         . <br> <code class="python">2015-10-15T11:20:44.260-0400 W STORAGE [conn3] Document would fail validation collection: example.contacts doc: { _id: ObjectId('561fc44c067a5d85b96274e4'), name: "Amanda", status: "Updated" }</code> <br></code></code> </h4><h4>  Restrictions </h4><br>  You cannot assign validation to <code>admin</code> , <code>local</code> . <br>  And you cannot specify a validator for <code>system.*</code> Collections <br><br><h3><a name="2"></a>  <font color="orange">Innovations of the aggregation framework and LEFT JOIN</font> </h3><br>  <code>$lookup</code> - linking multiple collections. <br>  Although this operator called their <code>left join</code> for <code>mongodb</code> it still seems to me that this question is a bit wider, and it should be considered in the context of linking different types of documents, not collections.  I described this question in some detail <a href="http://habrahabr.ru/post/259219/">here</a> . <br>  <code>$lookup</code> has the following syntax: <br><pre> <code class="python hljs">{ $lookup: { <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: &lt;  &gt;, localField: &lt;   &gt;, foreignField: &lt;     &gt;, <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>: &lt; &gt; } }</code> </pre><br>  In the example we have two collections: <br>  The <code>orders</code> collection contains the following documents: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"item"</span></span> : <span class="hljs-string"><span class="hljs-string">"abc"</span></span>, <span class="hljs-string"><span class="hljs-string">"price"</span></span> : <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-string"><span class="hljs-string">"quantity"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"item"</span></span> : <span class="hljs-string"><span class="hljs-string">"jkl"</span></span>, <span class="hljs-string"><span class="hljs-string">"price"</span></span> : <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"quantity"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span> }</code> </pre><br>  And the <code>inventory</code> collection containing documents: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"sku"</span></span> : <span class="hljs-string"><span class="hljs-string">"abc"</span></span>, description: <span class="hljs-string"><span class="hljs-string">"product 1"</span></span>, <span class="hljs-string"><span class="hljs-string">"instock"</span></span> : <span class="hljs-number"><span class="hljs-number">120</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"sku"</span></span> : <span class="hljs-string"><span class="hljs-string">"def"</span></span>, description: <span class="hljs-string"><span class="hljs-string">"product 2"</span></span>, <span class="hljs-string"><span class="hljs-string">"instock"</span></span> : <span class="hljs-number"><span class="hljs-number">80</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"sku"</span></span> : <span class="hljs-string"><span class="hljs-string">"ijk"</span></span>, description: <span class="hljs-string"><span class="hljs-string">"product 3"</span></span>, <span class="hljs-string"><span class="hljs-string">"instock"</span></span> : <span class="hljs-number"><span class="hljs-number">60</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">"sku"</span></span> : <span class="hljs-string"><span class="hljs-string">"jkl"</span></span>, description: <span class="hljs-string"><span class="hljs-string">"product 4"</span></span>, <span class="hljs-string"><span class="hljs-string">"instock"</span></span> : <span class="hljs-number"><span class="hljs-number">70</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">"sku"</span></span>: null, description: <span class="hljs-string"><span class="hljs-string">"Incomplete"</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span> }</code> </pre><br>  The following aggregation operation, for the <code>orders</code> collection, links documents from <code>orders</code> to documents from the <code>inventory</code> collection, using the <code>item</code> field from <code>orders</code> and the <code>sku</code> field from <code>inventory</code> : <br><pre> <code class="python hljs">db.orders.aggregate([ { $lookup: { <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: <span class="hljs-string"><span class="hljs-string">"inventory"</span></span>, localField: <span class="hljs-string"><span class="hljs-string">"item"</span></span>, foreignField: <span class="hljs-string"><span class="hljs-string">"sku"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>: <span class="hljs-string"><span class="hljs-string">"inventory_docs"</span></span> } } ])</code> </pre><br>  At the exit, this operation will return the following documents: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"item"</span></span> : <span class="hljs-string"><span class="hljs-string">"abc"</span></span>, <span class="hljs-string"><span class="hljs-string">"price"</span></span> : <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-string"><span class="hljs-string">"quantity"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"inventory_docs"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"sku"</span></span> : <span class="hljs-string"><span class="hljs-string">"abc"</span></span>, description: <span class="hljs-string"><span class="hljs-string">"product 1"</span></span>, <span class="hljs-string"><span class="hljs-string">"instock"</span></span> : <span class="hljs-number"><span class="hljs-number">120</span></span> } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"item"</span></span> : <span class="hljs-string"><span class="hljs-string">"jkl"</span></span>, <span class="hljs-string"><span class="hljs-string">"price"</span></span> : <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"quantity"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"inventory_docs"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">"sku"</span></span> : <span class="hljs-string"><span class="hljs-string">"jkl"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"product 4"</span></span>, <span class="hljs-string"><span class="hljs-string">"instock"</span></span> : <span class="hljs-number"><span class="hljs-number">70</span></span> } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"inventory_docs"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">"sku"</span></span> : null, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"Incomplete"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span> } ] }</code> </pre><br>  <code>$sample</code> - randomly selects a specified number of documents from the input stream. <br>  Syntax: <br><pre> <code class="python hljs">{ $sample: { size: &lt;positive integer&gt; } }</code> </pre><br>  In the example we have a collection of <code>users</code> consisting of the following documents: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"q1"</span></span> : true, <span class="hljs-string"><span class="hljs-string">"q2"</span></span> : true } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"q1"</span></span> : false, <span class="hljs-string"><span class="hljs-string">"q2"</span></span> : false } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"q1"</span></span> : true, <span class="hljs-string"><span class="hljs-string">"q2"</span></span> : true } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"q1"</span></span> : true, <span class="hljs-string"><span class="hljs-string">"q2"</span></span> : false } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"q1"</span></span> : false, <span class="hljs-string"><span class="hljs-string">"q2"</span></span> : true } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"q1"</span></span> : true, <span class="hljs-string"><span class="hljs-string">"q2"</span></span> : true } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"q1"</span></span> : false, <span class="hljs-string"><span class="hljs-string">"q2"</span></span> : true }</code> </pre><br>  The aggregation operation will randomly select three documents from the collection: <br><pre> <code class="python hljs">db.users.aggregate( [ { $sample: { size: <span class="hljs-number"><span class="hljs-number">3</span></span> } } ] )</code> </pre><br>  <code>PostgreSQL 9.5</code> , which is about to be released, also has a similar feature. <br><br>  <code>$indexStats</code> - returns usage statistics for each index. <br>  Returns usage statistics for each index in the collection.  If running with access control, the user must have privileges that include <code>indexStats</code> . <br><br>  Syntax: <br><pre> <code class="python hljs">{ $indexStats: { } }</code> </pre><br>  For example, take the <code>orders</code> collection containing the following documents: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"item"</span></span> : <span class="hljs-string"><span class="hljs-string">"abc"</span></span>, <span class="hljs-string"><span class="hljs-string">"price"</span></span> : <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-string"><span class="hljs-string">"quantity"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"apparel"</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"item"</span></span> : <span class="hljs-string"><span class="hljs-string">"jkl"</span></span>, <span class="hljs-string"><span class="hljs-string">"price"</span></span> : <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"quantity"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"electronics"</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"item"</span></span> : <span class="hljs-string"><span class="hljs-string">"abc"</span></span>, <span class="hljs-string"><span class="hljs-string">"price"</span></span> : <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"quantity"</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"apparel"</span></span> }</code> </pre><br>  Create the following two indices on the collection: <br><pre> <code class="python hljs">db.orders.createIndex( { item: <span class="hljs-number"><span class="hljs-number">1</span></span>, quantity: <span class="hljs-number"><span class="hljs-number">1</span></span> } ) db.orders.createIndex( { type: <span class="hljs-number"><span class="hljs-number">1</span></span>, item: <span class="hljs-number"><span class="hljs-number">1</span></span> } )</code> </pre><br>  Perform some queries: <br><pre> <code class="python hljs">db.orders.find( { type: <span class="hljs-string"><span class="hljs-string">"apparel"</span></span>} ) db.orders.find( { item: <span class="hljs-string"><span class="hljs-string">"abc"</span></span> } ).sort( { quantity: <span class="hljs-number"><span class="hljs-number">1</span></span> } )</code> </pre><br>  To view statistics on the use of the index for the <code>orders</code> collection, perform the following operation: <br><pre> <code class="python hljs">db.orders.aggregate( [ { $indexStats: { } } ] )</code> </pre><br>  The operation will return documents containing the use of statistics for each index: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"item_1_quantity_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"key"</span></span> : { <span class="hljs-string"><span class="hljs-string">"item"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"quantity"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span> }, <span class="hljs-string"><span class="hljs-string">"host"</span></span> : <span class="hljs-string"><span class="hljs-string">"examplehost.local:27017"</span></span>, <span class="hljs-string"><span class="hljs-string">"accesses"</span></span> : { <span class="hljs-string"><span class="hljs-string">"ops"</span></span> : NumberLong(<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-string"><span class="hljs-string">"since"</span></span> : ISODate(<span class="hljs-string"><span class="hljs-string">"2015-10-02T14:31:53.685Z"</span></span>) } } { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"_id_"</span></span>, <span class="hljs-string"><span class="hljs-string">"key"</span></span> : { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span> }, <span class="hljs-string"><span class="hljs-string">"host"</span></span> : <span class="hljs-string"><span class="hljs-string">"examplehost.local:27017"</span></span>, <span class="hljs-string"><span class="hljs-string">"accesses"</span></span> : { <span class="hljs-string"><span class="hljs-string">"ops"</span></span> : NumberLong(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-string"><span class="hljs-string">"since"</span></span> : ISODate(<span class="hljs-string"><span class="hljs-string">"2015-10-02T14:31:32.479Z"</span></span>) } } { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"type_1_item_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"key"</span></span> : { <span class="hljs-string"><span class="hljs-string">"type"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"item"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span> }, <span class="hljs-string"><span class="hljs-string">"host"</span></span> : <span class="hljs-string"><span class="hljs-string">"examplehost.local:27017"</span></span>, <span class="hljs-string"><span class="hljs-string">"accesses"</span></span> : { <span class="hljs-string"><span class="hljs-string">"ops"</span></span> : NumberLong(<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-string"><span class="hljs-string">"since"</span></span> : ISODate(<span class="hljs-string"><span class="hljs-string">"2015-10-02T14:31:58.321Z"</span></span>) } }</code> </pre><br><br>  <code>$stdDevSamp</code> ‚Äî <code>$stdDevSamp</code> standard deviation of a sample of input values. <br>  It is accessible from <code>$group</code> and <code>$project</code> , ignores non-numeric values ‚Äã‚Äãand, if such is provided, returns <code>null</code> . <br>  For example, take the <code>users</code> collection: <br><pre> <code class="python hljs">{_id: <span class="hljs-number"><span class="hljs-number">0</span></span>, username: <span class="hljs-string"><span class="hljs-string">"user0"</span></span>, age: <span class="hljs-number"><span class="hljs-number">20</span></span>} {_id: <span class="hljs-number"><span class="hljs-number">1</span></span>, username: <span class="hljs-string"><span class="hljs-string">"user1"</span></span>, age: <span class="hljs-number"><span class="hljs-number">42</span></span>} {_id: <span class="hljs-number"><span class="hljs-number">2</span></span>, username: <span class="hljs-string"><span class="hljs-string">"user2"</span></span>, age: <span class="hljs-number"><span class="hljs-number">28</span></span>}</code> </pre><br>  To calculate the standard deviation of a random sample of users, first use the <code>$sample</code> operator to sample 100 users, and then use <code>$stdDevSamp</code> for costing. <br><pre> <code class="python hljs">db.users.aggregate( [ { $sample: { size: <span class="hljs-number"><span class="hljs-number">100</span></span> } }, { $group: { _id: null, ageStdDev: { $stdDevSamp: <span class="hljs-string"><span class="hljs-string">"$age"</span></span> } } } ] )</code> </pre><br>  Result: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : null, <span class="hljs-string"><span class="hljs-string">"ageStdDev"</span></span> : <span class="hljs-number"><span class="hljs-number">7.811258386185771</span></span> }</code> </pre><br><br><h4>  New aggregation arithmetic operators </h4><br>  <code>$sqrt</code> - calculates the square root. <br>  Syntax <br><pre> <code class="python hljs">{ $sqrt: &lt;number&gt; }</code> </pre><br>  Simple examples: <br><pre> <code class="python hljs">{ $sqrt: <span class="hljs-number"><span class="hljs-number">25</span></span> } <span class="hljs-number"><span class="hljs-number">5</span></span> { $sqrt: <span class="hljs-number"><span class="hljs-number">30</span></span> } <span class="hljs-number"><span class="hljs-number">5.477225575051661</span></span> { $sqrt: null } null</code> </pre><br>  There is a collection of <code>points</code> with documents: <br><pre> <code class="python hljs">{ _id: <span class="hljs-number"><span class="hljs-number">1</span></span>, p1: { x: <span class="hljs-number"><span class="hljs-number">5</span></span>, y: <span class="hljs-number"><span class="hljs-number">8</span></span> }, p2: { x: <span class="hljs-number"><span class="hljs-number">0</span></span>, y: <span class="hljs-number"><span class="hljs-number">5</span></span>} } { _id: <span class="hljs-number"><span class="hljs-number">2</span></span>, p1: { x: <span class="hljs-number"><span class="hljs-number">-2</span></span>, y: <span class="hljs-number"><span class="hljs-number">1</span></span> }, p2: { x: <span class="hljs-number"><span class="hljs-number">1</span></span>, y: <span class="hljs-number"><span class="hljs-number">5</span></span>} } { _id: <span class="hljs-number"><span class="hljs-number">3</span></span>, p1: { x: <span class="hljs-number"><span class="hljs-number">4</span></span>, y: <span class="hljs-number"><span class="hljs-number">4</span></span> }, p2: { x: <span class="hljs-number"><span class="hljs-number">4</span></span>, y: <span class="hljs-number"><span class="hljs-number">0</span></span>} }</code> </pre><br>  The following example uses <code>$sqrt</code> to calculate the distance between <code>p1</code> and <code>p2</code> : <br><pre> <code class="python hljs">db.points.aggregate([ { $project: { distance: { $sqrt: { $add: [ { $pow: [ { $subtract: [ <span class="hljs-string"><span class="hljs-string">"$p2.y"</span></span>, <span class="hljs-string"><span class="hljs-string">"$p1.y"</span></span> ] }, <span class="hljs-number"><span class="hljs-number">2</span></span> ] }, { $pow: [ { $subtract: [ <span class="hljs-string"><span class="hljs-string">"$p2.x"</span></span>, <span class="hljs-string"><span class="hljs-string">"$p1.x"</span></span> ] }, <span class="hljs-number"><span class="hljs-number">2</span></span> ] } ] } } } } ])</code> </pre><br>  The output is the following result: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"distance"</span></span> : <span class="hljs-number"><span class="hljs-number">5.830951894845301</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"distance"</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"distance"</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span> }</code> </pre><br>  <code>$abs</code> - returns the absolute value of a number. <br>  Syntax <br><pre> <code class="python hljs">{ $abs: &lt;number&gt; }</code> </pre><br>  A simple example: <br><pre> <code class="python hljs">{ $abs: <span class="hljs-number"><span class="hljs-number">-1</span></span> } <span class="hljs-number"><span class="hljs-number">1</span></span> { $abs: <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-number"><span class="hljs-number">1</span></span> { $abs: null } null</code> </pre><br><br>  The <code>ratings</code> collection has documents: <br><pre> <code class="python hljs">{ _id: <span class="hljs-number"><span class="hljs-number">1</span></span>, start: <span class="hljs-number"><span class="hljs-number">5</span></span>, end: <span class="hljs-number"><span class="hljs-number">8</span></span> } { _id: <span class="hljs-number"><span class="hljs-number">2</span></span>, start: <span class="hljs-number"><span class="hljs-number">4</span></span>, end: <span class="hljs-number"><span class="hljs-number">4</span></span> } { _id: <span class="hljs-number"><span class="hljs-number">3</span></span>, start: <span class="hljs-number"><span class="hljs-number">9</span></span>, end: <span class="hljs-number"><span class="hljs-number">7</span></span> } { _id: <span class="hljs-number"><span class="hljs-number">4</span></span>, start: <span class="hljs-number"><span class="hljs-number">6</span></span>, end: <span class="hljs-number"><span class="hljs-number">7</span></span> }</code> </pre><br>  The following example calculates the difference between the initial and final ratings: <br><pre> <code class="python hljs">db.ratings.aggregate([ { $project: { delta: { $abs: { $subtract: [ <span class="hljs-string"><span class="hljs-string">"$start"</span></span>, <span class="hljs-string"><span class="hljs-string">"$end"</span></span> ] } } } } ])</code> </pre><br>  At the exit: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"delta"</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"delta"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"delta"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">"delta"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span> }</code> </pre><br><br>  <code>$log</code> - calculates the logarithm. <br>  Syntax <br><pre> <code class="python hljs">{ $log: [ &lt;number&gt;, &lt;base&gt; ] }</code> </pre><br>  Calculates the logarithm of a number, and returns the result as a fraction. <br>  There is a collection of <code>examples</code> : <br><pre> <code class="python hljs">{ _id: <span class="hljs-number"><span class="hljs-number">1</span></span>, positiveInt: <span class="hljs-number"><span class="hljs-number">5</span></span> } { _id: <span class="hljs-number"><span class="hljs-number">2</span></span>, positiveInt: <span class="hljs-number"><span class="hljs-number">2</span></span> } { _id: <span class="hljs-number"><span class="hljs-number">3</span></span>, positiveInt: <span class="hljs-number"><span class="hljs-number">23</span></span> } { _id: <span class="hljs-number"><span class="hljs-number">4</span></span>, positiveInt: <span class="hljs-number"><span class="hljs-number">10</span></span> }</code> </pre><br>  The following example uses <code>log2</code> to determine the number of bits required to represent a positiveInt value. <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; } <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] ) <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] } : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> { exp: &lt;number&gt; } <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; } <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; } <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> { floor: &lt;number&gt; } <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <h4> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </h4> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] } <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] } <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <h4> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </h4> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 } <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] ) <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] } <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <h3> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </h3> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018 <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <h3> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </h3> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code><code><code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <h3> <code><code><code><code><code><code><code><code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2 ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </h3> <code><code><code><code><code><code><code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <h3> <code><code><code><code><code><code><code><code><code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </h3> <code><code><code><code><code><code><code><code><code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code><code><code><code><code><code><code><code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code><code><code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code><code><code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code><code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code><code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code><code><code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> </pre> <code><code><code><code><code><code><code><code><code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code><code><code><code><code><code><code><code><code class="bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code><code><code><code><code><code><code><code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code> <pre> <code class="hljs bash"><code><code><code><code><code><code><code><code><code class="bash"><code class="python">. <br> : <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 3 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 2 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 5 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"bitsNeeded"</span></span> : 4 }</code> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ln</span></span></code> -    . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, sales: 8700000 } { _id: 2, year: <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, sales: 5000000 } { _id: 3, year: <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { x: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$year</span></span></span><span class="hljs-string">"</span></span>, y: { <span class="hljs-variable"><span class="hljs-variable">$ln</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sales</span></span></span><span class="hljs-string">"</span></span> } } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2000"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.978833583624812 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2005"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.424948470398375 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"x"</span></span> : <span class="hljs-string"><span class="hljs-string">"2010"</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 15.648092021712584 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$pow</span></span></code> -      (  ). <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, 2 ] } 25 { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 85 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave2"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 90 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 71 } ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"scores"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiz"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 96 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"annT"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 77 }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { variance: { <span class="hljs-variable"><span class="hljs-variable">$pow</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$stdDevPop</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scores</span></span></span><span class="hljs-string">.score"</span></span> }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"variance"</span></span> : 64.66666666666667 }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$exp</span></span></code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 0 } 1 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: 2 } 7.38905609893065 { <span class="hljs-variable"><span class="hljs-variable">$exp</span></span>: -2 } 0.1353352832366127</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$trunc</span></span></code> -     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 0 } 0 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$trunc</span></span>: -2.3 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$ceil</span></span></code> -    ,     . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: &lt;number&gt; }</code> <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: 7.80 } 8 { <span class="hljs-variable"><span class="hljs-variable">$ceil</span></span>: -2.8 } -2</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$floor</span></span></code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 1 } 1 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: 7.80 } 7 { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { value: 1, floorValue: { <span class="hljs-variable"><span class="hljs-variable">$floor</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 9.25, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 9 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 8.73, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 8 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : 4.32, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : 4 } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : -5.34, <span class="hljs-string"><span class="hljs-string">"floorValue"</span></span> : -6 }</code> <br> <br>        <br> <code><span class="hljs-variable"><span class="hljs-variable">$slice</span></span></code> -   . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;n&gt; ] }  { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } <br> { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, favorites: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { name: 1, threeFavorites: { <span class="hljs-variable"><span class="hljs-variable">$slice</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$favorites</span></span></span><span class="hljs-string">"</span></span>, 3 ] } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"dave123"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"cake"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"li"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ahn"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"ty"</span></span>, <span class="hljs-string"><span class="hljs-string">"threeFavorites"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span></code> -       . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 0 ] } 1 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], -2 ] } 2 { <span class="hljs-variable"><span class="hljs-variable">$arrayElemAt</span></span>: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span></code> -  . <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span> ] { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span>] ] } [ <span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"world"</span></span> ], <span class="hljs-string"><span class="hljs-string">"again"</span></span> ]</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$isArray</span></span></code> - ,     . <br>  <br> { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, instock: [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span> ], ordered: [ <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, instock: [ <span class="hljs-string"><span class="hljs-string">"apples"</span></span>, <span class="hljs-string"><span class="hljs-string">"pudding"</span></span>, <span class="hljs-string"><span class="hljs-string">"pie"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, instock: [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>], ordered: [ <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, instock: [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { items: { <span class="hljs-variable"><span class="hljs-variable">$cond</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span> }, { <span class="hljs-variable"><span class="hljs-variable">$isArray</span></span>: <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> } ] }, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>: { <span class="hljs-variable"><span class="hljs-variable">$concatArrays</span></span>: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instock</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ordered</span></span></span><span class="hljs-string">"</span></span> ] }, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } } } } ]) { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"chocolate"</span></span>, <span class="hljs-string"><span class="hljs-string">"butter"</span></span>, <span class="hljs-string"><span class="hljs-string">"apples"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 2, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : <span class="hljs-string"><span class="hljs-string">"One or more fields is not an array."</span></span> } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 3, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"pears"</span></span>, <span class="hljs-string"><span class="hljs-string">"pecans"</span></span>, <span class="hljs-string"><span class="hljs-string">"cherries"</span></span> ] } { <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : 4, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"ice cream"</span></span> ] }</code> <br> <br> <code><span class="hljs-variable"><span class="hljs-variable">$filter</span></span></code> -     . <br>  <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ <span class="hljs-variable"><span class="hljs-variable">$filter</span></span>: { input: [ 1, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, 2, null, 3.1, NumberLong(4), <span class="hljs-string"><span class="hljs-string">"5"</span></span> ], as: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, cond: { <span class="hljs-variable"><span class="hljs-variable">$and</span></span>: [ { <span class="hljs-variable"><span class="hljs-variable">$gte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"-9223372036854775807"</span></span>) ] }, { <span class="hljs-variable"><span class="hljs-variable">$lte</span></span>: [ <span class="hljs-string"><span class="hljs-string">"$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$num</span></span></span><span class="hljs-string">"</span></span>, NumberLong(<span class="hljs-string"><span class="hljs-string">"9223372036854775807"</span></span>) ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <br>  <code>mongodb 3.2</code> ,  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"x"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"y"</span></span> : 1 }</code> <br>  <code><span class="hljs-variable"><span class="hljs-variable">$project</span></span></code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { <span class="hljs-variable"><span class="hljs-variable">$project</span></span>: { myArray: [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">"</span></span> ] } } ] )</code> <br> : <br> <code class="python">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : ObjectId(<span class="hljs-string"><span class="hljs-string">"55ad167f320c6be244eb3b95"</span></span>), <span class="hljs-string"><span class="hljs-string">"myArray"</span></span> : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span> } )</code> <br>  <code>ordered : <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> <br>  - <code>db.collection.remove( , <span class="hljs-literal"><span class="hljs-literal">true</span></span> )  db.collection.remove( , { justOne: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   <span class="hljs-literal"><span class="hljs-literal">true</span></span>. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code>db.collection.update( , , { multi: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, ... })    multi</code>   <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <code>db.collection.updateOne()</code> -  <code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash"><span class="hljs-string"><span class="hljs-string">"C:\mongodb\bin\mongod.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\mongodb\mongod.cfg"</span></span> --install</code> <br>    : <br> net start MongoDB <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code></code> </pre> <code><code><code><code><code><code><code><code><code><code class="python">. <br> : <br> { "_id" : 1, "bitsNeeded" : 3 } { "_id" : 2, "bitsNeeded" : 2 } { "_id" : 3, "bitsNeeded" : 5 } { "_id" : 4, "bitsNeeded" : 4 }</code> <br> <code>$ln</code> -    . <br>  <br> <code class="python">{ $ln: &lt;number&gt; }</code> <br> <code class="python">{ _id: 1, year: "2000", sales: 8700000 } { _id: 2, year: "2005", sales: 5000000 } { _id: 3, year: "2010", sales: 6250000 }</code> <br>   ,    : <br> <code class="python">db.sales.aggregate( [ { $project: { x: "$year", y: { $ln: "$sales" } } } ] )</code> <br> : <br> <code class="python">{ "_id" : 1, "x" : "2000", "y" : 15.978833583624812 } { "_id" : 2, "x" : "2005", "y" : 15.424948470398375 } { "_id" : 3, "x" : "2010", "y" : 15.648092021712584 }</code> <br> <br> <code>$pow</code> -      (  ). <br> : <br> <code class="python">{ $pow: [ &lt;number&gt;, &lt;exponent&gt; ] }</code> : <br> <code class="python">{ $pow: [ 5, 0 ] } 1 { $pow: [ 5, 2 ] } 25 { $pow: [ 5, -2 ] } 0.04</code> <br> <code class="python">{ "_id" : 1, "scores" : [ { "name" : "dave123", "score" : 85 }, { "name" : "dave2", "score" : 90 }, { "name" : "ahn", "score" : 71 } ] } { "_id" : 2, "scores" : [ { "name" : "li", "quiz" : 2, "score" : 96 }, { "name" : "annT", "score" : 77 }, { "name" : "ty", "score" : 82 } ] }</code> <br>  ,     : <br> <code class="python">db.quizzes.aggregate([ { $project: { variance: { $pow: [ { $stdDevPop: "$scores.score" }, 2 ] } } } ])</code> <br> : <br> <code class="python">{ "_id" : 1, "variance" : 64.66666666666667 } { "_id" : 2, "variance" : 64.66666666666667 }</code> <br> <br> <code>$exp</code> -     . <br>  <br> <code class="python">{ exp: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $exp: 0 } 1 { $exp: 2 } 7.38905609893065 { $exp: -2 } 0.1353352832366127</code> <br> <br> <code>$trunc</code> -     . <br> : <br> <code class="python">{ $trunc: &lt;number&gt; }</code> <br> <code class="python">{ $trunc: 0 } 0 { $trunc: 7.80 } 7 { $trunc: -2.3 } -2</code> <br> <br> <code>$ceil</code> -    ,     . <br> : <br> <code class="python">{ $ceil: &lt;number&gt; }</code> <br> <code class="python">{ $ceil: 1 } 1 { $ceil: 7.80 } 8 { $ceil: -2.8 } -2</code> <br> <br> <code>$floor</code> -    ,     . <br> : <br> <code class="python">{ floor: &lt;number&gt; }</code> <br> : <br> <code class="python">{ $floor: 1 } 1 { $floor: 7.80 } 7 { $floor: -2.8 } -3</code> <br> <br> <code class="python">{ _id: 1, value: 9.25 } { _id: 2, value: 8.73 } { _id: 3, value: 4.32 } { _id: 4, value: -5.34 } db.samples.aggregate([ { $project: { value: 1, floorValue: { $floor: "$value" } } } ]) { "_id" : 1, "value" : 9.25, "floorValue" : 9 } { "_id" : 2, "value" : 8.73, "floorValue" : 8 } { "_id" : 3, "value" : 4.32, "floorValue" : 4 } { "_id" : 4, "value" : -5.34, "floorValue" : -6 }</code> <br> <br>        <br> <code>$slice</code> -   . <br> : <br> <code class="python">{ $slice: [ &lt;array&gt;, &lt;n&gt; ] }  { $slice: [ &lt;array&gt;, &lt;position&gt;, &lt;n&gt; ] }</code> <br> { "_id" : 1, "name" : "dave123", favorites: [ "chocolate", "cake", "butter", "apples" ] } <br> { "_id" : 2, "name" : "li", favorites: [ "apples", "pudding", "pie" ] } <br> { "_id" : 3, "name" : "ahn", favorites: [ "pears", "pecans", "chocolate", "cherries" ] } <br> { "_id" : 4, "name" : "ty", favorites: [ "ice cream" ] } <br>   ,       <code>favorites</code>   : <br> <code class="python">db.users.aggregate([ { $project: { name: 1, threeFavorites: { $slice: [ "$favorites", 3 ] } } } ]) { "_id" : 1, "name" : "dave123", "threeFavorites" : [ "chocolate", "cake", "butter" ] } { "_id" : 2, "name" : "li", "threeFavorites" : [ "apples", "pudding", "pie" ] } { "_id" : 3, "name" : "ahn", "threeFavorites" : [ "pears", "pecans", "chocolate" ] } { "_id" : 4, "name" : "ty", "threeFavorites" : [ "ice cream" ] }</code> <br> <br> <code>$arrayElemAt</code> -       . <br> : <br> <code class="python">{ $arrayElemAt: [ &lt;array&gt;, &lt;idx&gt; ] }</code> <br> : <br> <code class="python">{ $arrayElemAt: [ [ 1, 2, 3 ], 0 ] } 1 { $arrayElemAt: [ [ 1, 2, 3 ], -2 ] } 2 { $arrayElemAt: [ [ 1, 2, 3 ], 15 ] }</code> <br> <br> <code>$concatArrays</code> -  . <br> : <br> <code class="python">{ $concatArrays: [ &lt;array1&gt;, &lt;array2&gt;, ... ] }</code> <br> : <br> <code class="python">{ $concatArrays: [ [ "hello", " "], [ "world" ] ] } [ "hello", " ", "world" ] { $concatArrays: [ [ "hello", " "], [ [ "world" ], "again"] ] } [ "hello", " ", [ "world" ], "again" ]</code> <br> <br> <code>$isArray</code> - ,     . <br>  <br> { $isArray: [ ] } <br>     <code>warehouses</code>   : <br> <code class="python">{ "_id" : 1, instock: [ "chocolate" ], ordered: [ "butter", "apples" ] } { "_id" : 2, instock: [ "apples", "pudding", "pie" ] } { "_id" : 3, instock: [ "pears", "pecans"], ordered: [ "cherries" ] } { "_id" : 4, instock: [ "ice cream" ], ordered: [ ] }</code> <br> <br>  ,     <code>instock</code> ,   <code>ordered</code> ,  ,    ,   ,    : <br> <br> <code class="python">db.warehouses.aggregate([ { $project: { items: { $cond: { if: { $and: [ { $isArray: "$instock" }, { $isArray: "$ordered" } ] }, then: { $concatArrays: [ "$instock", "$ordered" ] }, else: "One or more fields is not an array." } } } } ]) { "_id" : 1, "items" : [ "chocolate", "butter", "apples" ] } { "_id" : 2, "items" : "One or more fields is not an array." } { "_id" : 3, "items" : [ "pears", "pecans", "cherries" ] } { "_id" : 4, "items" : [ "ice cream" ] }</code> <br> <br> <code>$filter</code> -     . <br>  <br> <code class="python">{ $filter: { input: &lt;array&gt;, as: &lt;string&gt;, cond: &lt;expression&gt; } }</code> <br> : <br> <code class="python">{ $filter: { input: [ 1, "a", 2, null, 3.1, NumberLong(4), "5" ], as: "num", cond: { $and: [ { $gte: [ "$$num", NumberLong("-9223372036854775807") ] }, { $lte: [ "$$num", NumberLong("9223372036854775807") ] } ] } } } [ 1, 2, 3.1, NumberLong(4) ]</code> <br> <br>    $project <br>  <code>mongodb 3.2</code> ,  <code>$project</code> ,      <code>[]</code> ,       . <br>    : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "x" : 1, "y" : 1 }</code> <br>  <code>$project</code>   <code>x</code>  <code>y</code>    <code>myArray</code> : <br> <code class="python">db.collection.aggregate( [ { $project: { myArray: [ "$x", "$y" ] } } ] )</code> <br> : <br> <code class="python">{ "_id" : ObjectId("55ad167f320c6be244eb3b95"), "myArray" : [ 1, 1 ] }</code> <br> <a name="3"></a> <font color="orange">    , </font> <br> mongorestore  mongodump     ,   ,     ,     . <br> <br>      <code>test.20150715.archive</code>   <code>test</code> .   . <br> <code class="bash">mongorestore --archive=test.20150715.archive --db test</code> <br>     ,   <code>mongorestore</code>   <code>archive</code>    . : <br> <code class="python">mongodump --archive --db test --port 27017 | mongorestore --archive --port 27018</code> <br> <br> <a name="5"></a> <font color="orange">  CRUD</font> <br> <br>    <code>CRUD (Create/Read/Update/Delete) API</code> ,  <code>mongo shell</code>    . <br> <br> <code>db.collection.bulkWrite()</code> -    ,      . <br>  ,    <code>bulkWrite()</code> ,   : <br> <code class="python">db.collection.bulkWrite( [ { insertOne : &lt;document&gt; }, { updateOne : &lt;document&gt; }, { updateMany : &lt;document&gt; }, { replaceOne : &lt;document&gt; }, { deleteOne : &lt;document&gt; }, { deleteMany : &lt;document&gt; } ], { ordered : false } )</code> <br>  <code>ordered : false</code> ,    . , <code>deleteOne</code>  <code>deleteMany</code>             <code>insertOne</code> , <code>updateOne</code> , <code>updateMany</code>  <code>replaceOne</code> . <br> <br> <code>db.collection.deleteMany()</code> -  <code>db.collection.remove()</code> . <br> <code>db.collection.deleteOne()</code> -  <code>db.collection.remove()</code>   <code>justOne</code>   <code>true</code> <br>  - <code>db.collection.remove( , true )  db.collection.remove( , { justOne: true } ). <br> db.collection.findOneAndDelete()</code> -  <code>db.collection.findAndModify()</code>   remove   true. <br> <code>db.collection.findOneAndReplace()</code> -  <code>db.collection.findAndModify()</code> . <br> <code>db.collection.findOneAndUpdate()</code> -  <code>db.collection.findAndModify()</code>     update  . <br> <code>db.collection.insertMany()</code> -  <code>db.collection.insert()</code>      . <br> <code>db.collection.insertOne()</code> -  <code>db.collection.insert()</code>     . <br> <code>db.collection.replaceOne()</code> -   <code>db.collection.update( , )       . <br> db.collection.updateMany()</code> -  <code>db.collection.update( , , { multi: true, ... })    multi</code>   <code>true</code> . <br> <code>db.collection.updateOne()</code> -  <code>db.collection.update( , ) <br> <br> <a name="6"></a> <font color="orange">WiredTiger  fsyncLock</font> <br>   MongoDB 3.2</code> ,  <code>WiredTiger</code>   <a href="https://docs.mongodb.org/manual/reference/command/fsync/">fsync</a>   <code>lock</code>   <code>mongo shell db.fsyncLock().  ,   WiredTiger</code> ,    ,     ,       . <br>     <code>WiredTiger</code>    . <br> <br> <a name="7"></a> <font color="orange"> GUI compass</font> <br>   <code>Mongodb</code> , ,    GUI    .   <code>MongoDB Compass</code> .              compass    c web .   nosql   <code>couchdb</code>      <code>futon</code> . <br> <br>    compass,    ,      Mac OS  Windows.       ,      ,     . <br> <br> ,       GUI   Windows mongoDB   ,   : <br> ,     ‚Äú‚Äù      <code>C:\mongodb</code> . <br>           : <br> <code class="bash">mkdir c:\data\db mkdir c:\data\log</code> <br>        <code>C:\mongodb\mongod.cfg</code>     : <br> <code class="bash">systemLog: destination: file path: c:\data\log\mongod.log storage: dbPath: c:\data\db</code> <br>   mongodb : <br> <code class="bash">"C:\mongodb\bin\mongod.exe" --config "C:\mongodb\mongod.cfg" --install</code> <br>    : <br> <code class="bash">net start MongoDB</code> <br>  , .                 , <code>c:\mongodb\mongo.exe</code> <br> <br>     <a href="http://www.mongodb.com/download-center"></a>  compass,        .       : <br> <img src="https://habrastorage.org/getpro/habr/post_images/d07/04d/ab2/d0704dab22b12771949ff76e4ee1a214.png"> <br>         ,      ,         .      ,     . <br> <br>   ,  ,        (,   )      json. <br> <img src="https://habrastorage.org/getpro/habr/post_images/826/906/b65/826906b656d6679961c8fd643dd02890.gif" width="100%"> <br> <br>  ,   ,  GUI    ,   -   . <br> <br> <i>PS          .</i> <br> <br> <a href="https://docs.mongodb.org/v3.0/tutorial/install-mongodb-on-windows/"> mongodb  windows</a> <br> <a href="https://docs.mongodb.org/manual/products/compass/">  compass</a> <br> <a href="http://www.mongodb.com/download-center"> mongodb compass</a> <br> <br> <a href="https://docs.mongodb.org/manual/release-notes/3.2/">   </a> <br> <a href="https://docs.mongodb.org/manual/core/index-partial/"> </a> <br> <a href="https://docs.mongodb.org/manual/core/document-validation/"> </a></code></code></code></code></code></code></code></code></code>  </div><p>Source: <a href="https://habr.com/ru/post/192870/">https://habr.com/ru/post/192870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192854/index.html">Release Firefox 24 and Firefox 24 ESR</a></li>
<li><a href="../192856/index.html">$ 1.5k creepy robotop available for order</a></li>
<li><a href="../192858/index.html">Broadcasting iOS application development in 48 hours</a></li>
<li><a href="../192862/index.html">HEX - $ 49 Opensource Quadcopter</a></li>
<li><a href="../192868/index.html">SAAS - Customer Life Cycle</a></li>
<li><a href="../192872/index.html">How specifically to release the Internet</a></li>
<li><a href="../192874/index.html">Evolution of modular javascript</a></li>
<li><a href="../192876/index.html">Do not put all your eggs in someone else's basket (from the book Passionate Programmer by Chad Fowler)</a></li>
<li><a href="../192882/index.html">The invisible release of FreeType 2.5 - a breakthrough in font rendering</a></li>
<li><a href="../192884/index.html">Suricata as IPS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>