<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing and configuring CentOS Linux 5.5 under Hyper-V</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Let's continue the series of articles on the launch of Unix and Linux systems under Hyper-V R2. Today we will see how to install and configure CentOS ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing and configuring CentOS Linux 5.5 under Hyper-V</h1><div class="post__text post__text-html js-mediator-article">  Let's continue the series of articles on the launch of Unix and Linux systems under Hyper-V R2.  Today we will see how to install and configure CentOS 5.5 running our virtualization system.  Why exactly CentOS?  Quite simply, it is the most popular among RedHat fans of similar distributions. <br><br>  For those who are too lazy to read, I can say that CentOS works very well under Hyper-V and is ready for use in a production environment.  By the way, everything I write below can be applied with the same success for RHEL. <br><br>  Well, let's get started? <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Create a virtual machine.  And add to it the network adapter Legacy.  It is useful for us to update CentOS and to install the components of the integration of Hyper-V. <br><br> <a href=""><img title="Centos_hyperv_network_settings" alt="Centos_hyperv_network_settings" src="https://habrastorage.org/getpro/habr/post_images/b3b/0c4/7fb/b3b0c47fbdc4f1f460f8deae534bfa3d.png" width="244" height="229"></a> <br><br>  Run the OS installation.  In order for the testing script to be the most realistic, we will use dynamic hard disks VHD.  Please note that the guest system works fine with disks up to 2 TB.  The use of dynamic disks automatically expanding when necessary will help us more realistic to calculate the average performance of disk operations. <br><br> <a href=""><img title="Centos_2TB_VHD_Disk" alt="Centos_2TB_VHD_Disk" src="https://habrastorage.org/getpro/habr/post_images/82a/106/ed0/82a106ed094eea1986a33a0c84718206.png" width="244" height="211"></a> <br><br>  Also in the installation process, you can configure the network interface Legacy. <a href=""><img title="Centos_legacy_network_dhcp_settings" alt="Centos_legacy_network_dhcp_settings" src="https://habrastorage.org/getpro/habr/post_images/fe8/8aa/f6e/fe88aaf6e216d094e4f8f5b95c284a0f.png" width="244" height="211"></a> <br><br>  After that, the OS installation is performed, as well as on ordinary physical equipment.  After the installation is completed and the first reboot, we enter the guest system and check the network operation. <a href=""><img title="Centos_legacy_network" alt="Centos_legacy_network" src="https://habrastorage.org/getpro/habr/post_images/8e2/c86/5e1/8e2c865e1b60ee513089d665ffe44f25.png" width="244" height="203"></a> <br><br> <a href=""><img title="Centos_legacy_network_test" alt="Centos_legacy_network_test" src="https://habrastorage.org/getpro/habr/post_images/e67/b08/635/e67b08635e5e0319a1e6ea7cbc236220.png" width="244" height="203"></a> <br><br>  Now we have a network adapter with a speed of 100 Mbps.  For many tasks this is enough, but you want higher speeds?  Soon we will come to this. <br><br>  Please note that even without integration services with Hyper-V, the system is able to work with several virtual processors.  The maximum number of virtual processors 4. <br><br> <a href=""><img title="Centos_SMP_Hyperv" alt="Centos_SMP_Hyperv" src="https://habrastorage.org/getpro/habr/post_images/74f/23b/031/74f23b031890a7d330765fb5316d24ed.png" width="244" height="203"></a> <br><br>  As you can see, the basic functionality works quite normally.  Now let's get started installing the Hyper-V integration services.  What will it give us? <br><br><ul><li>  Synthetic drivers for hard drives and network controllers optimized specifically for Hyper-V R2. </li><li>  Fastpath Boot allows hard drives from which the guest OS boots faster. </li><li>  Time synchronization of guest OS with Hyper-V clock. </li><li>  Correctly shutting down the Linux guest OS using the Shutdown command from Hyper-V, System Center Virtual Machine Manager, or Powershell. </li><li>  Heartbeat is a periodic guest heartbeat check. </li></ul> <br><br>  Before installing Hyper-V integration services, update the guest OS through a graphical interface or using the commands: <br><br> <code># yum update <br> # reboot <br></code> <br><br> <a href=""><img title="Centos_system_update" alt="Centos_system_update" src="https://habrastorage.org/getpro/habr/post_images/1db/39e/767/1db39e767e68cde5b7752db3673c034b.png" width="244" height="203"></a> <br><br>  After a reboot, it would be nice to make a snapshot (snapshot) using Hyper-V, if something goes wrong, we can always roll back. <br><br>  Now install the kernel headers and developer tools <br><br> <code># yum install kernel-devel <br> # yum groupinstall "development tools" <br></code> <br><br>  Download <a href="http://www.microsoft.com/downloads/en/details.aspx%3FFamilyID%3Deee39325-898b-4522-9b4c-f4b5b9b64551">integration services for Hyper-V</a> unpack them and connect the ISO to the guest CentOS. <br><br>  We assemble and install core modules for synthetic devices. <br><br> <code># mkdir /opt/linux_is <br> # cp -R /media/CDROM/* /opt/linux_is <br> # cd /opt/linux_is <br> # make <br> # make install</code> <br> <br>  Check that the modules are loaded using the command <br><br> <code># lsmod | grep vsc</code> <br> <br> <a href=""><img title="Centos_hyperv_integration_services" alt="Centos_hyperv_integration_services" src="https://habrastorage.org/getpro/habr/post_images/522/e21/6e0/522e216e046fd543181c3f72b122aab0.png" width="244" height="203"></a> <br><br>  Turn off the guest OS using poweroff.  Remove the Legacy network adapter from it and add a synthetic adapter.  We start OS and we configure the new network adapter seth0. <br><br> <a href=""><img title="Centos_hyperv_synthetic_device_netwok" alt="Centos_hyperv_synthetic_device_netwok" src="https://habrastorage.org/getpro/habr/post_images/c5b/8f8/d1f/c5b8f8d1fa14cf89a175d0b73b6c97a9.png" width="244" height="203"></a> <br><br>  Now you can test the speed of the synthetic network adapter using iperf. <br><br> <a href=""><img title="Centos_synthetic_network_speed" alt="Centos_synthetic_network_speed" src="https://habrastorage.org/getpro/habr/post_images/a91/7af/ec3/a917afec341f43911bd12b2636dc0784.png" width="244" height="203"></a> <br><br>  As you can see, the speed on the network interface seth0 is on average 492.5 Mbit / s.  Pretty good result for a virtual machine. <br><br>  Unfortunately, Hyper-V can only boot the guest OS from IDE disks, so it is recommended that only the / boot partition be located on them.  For all other partitions, it is recommended to use SCSI disks as hard disks.  In this case, we can achieve a much higher speed. <br><br> <a href=""><img title="Centos_scsi_disk" alt="Centos_scsi_disk" src="https://habrastorage.org/getpro/habr/post_images/f98/82d/53c/f9882d53c6e9f93e591fea647653ed65.png" width="244" height="229"></a> <br><br> <a href=""><img title="Centos_scsi_disk_benchmark" alt="Centos_scsi_disk_benchmark" src="https://habrastorage.org/getpro/habr/post_images/a8d/a3b/003/a8da3b00312394a7f329b43862640bac.png" width="244" height="203"></a> <br><br>  If you need to do so, by connecting via RDP to the Hyper-V console, you can control the CentOS using the mouse in graphical mode, we install the driver of the synthetic mouse device. <br><br>  Download them from the <a href="http://www.xen.org/products/satori.html">Citrix Satori</a> project page, attach the ISO file to the virtual machine, copy the sources, and install the compiled driver. <br><br> <code># mkdir /opt/mouse_is <br> # cp -R /media/CDROM/* /opt/mouse_is <br> # cd /opt/mouse_is <br> # ./setup.pl inputdriver <br></code> <br><br>  At this installation of all components of the integration can be considered complete. <br><br>  Let's take a look at how CentOS feels like in real big production environments.  For this, I gave him the resources that were available on the test server - 44 GB of RAM and 4 processors.  Unfortunately, I did not have more resources.  It would be interesting to see how CentOS feels if you give it 2TB of RAM. <br><br> <a href=""><img title="Centos_45gb_memory_4_cpu" alt="Centos_45gb_memory_4_cpu" src="https://habrastorage.org/getpro/habr/post_images/b90/b9f/94c/b90b9f94c2bd03785b1241b4ff7fc7c8.png" width="244" height="184"></a> <a href=""><img title="Centos_45gb_memory_4_cpu_1" alt="Centos_45gb_memory_4_cpu_1" src="https://habrastorage.org/getpro/habr/post_images/ca0/8bb/b23/ca08bbb2368f41e3df7838ba9d1aa0b1.png" width="244" height="184"></a> <br><br>  Then, over several days, using scripts running in several threads, I created dd files up to 2TB in size and downloaded them via ftp and scp to another server.  Any problems and failures were not found. <br><br>  Therefore, I conclude that CentOS can be used as a virtual system under Hyper-V for projects with a rather heavy load. </div><p>Source: <a href="https://habr.com/ru/post/113993/">https://habr.com/ru/post/113993/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113984/index.html">iText: write to PDF in Russian</a></li>
<li><a href="../113985/index.html">Sandbox files corruption rating, Part 1. Online services</a></li>
<li><a href="../113988/index.html">Internet is not a priority</a></li>
<li><a href="../113991/index.html">kedDroid - S02E02. Video review software for Android</a></li>
<li><a href="../113992/index.html">Web application load scaling</a></li>
<li><a href="../113994/index.html">Mumburum - music search engine</a></li>
<li><a href="../113995/index.html">Chain of Responsibility Design Pattern</a></li>
<li><a href="../113996/index.html">The evolution of computing power of CPU and GPU</a></li>
<li><a href="../113997/index.html">NetBeans IDE 7.0 Beta 2</a></li>
<li><a href="../113998/index.html">Just a song: Code Monkey</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>