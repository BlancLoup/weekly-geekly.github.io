<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automation IP-network. Part 2 - Monitoring the speed of opening Web pages</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue a series of articles on affordable automation in the IP network. Each of the engineers working with the Internet, in one way or another, p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automation IP-network. Part 2 - Monitoring the speed of opening Web pages</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/ee5/03b/70c/ee503b70c56b4b24afbafd2928fcefa8.jpg" alt="image alt" align="left">  We continue a series of articles on affordable automation in the IP network.  Each of the engineers working with the Internet, in one way or another, periodically has the need to measure the speed of loading of the web page.  There are many tools for this, one of them is the wget utility.  For example, to measure the download speed, you can use the following command from the console (Unix / Linux): <br><br><pre><code class="hljs mel">[root@localhost ~]# wget -E -H -p -Q300K --user-agent=Mozilla --no-cache --no-cookies --<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>-after --timeout=<span class="hljs-number"><span class="hljs-number">15</span></span> --tries=<span class="hljs-number"><span class="hljs-number">2</span></span> habrahabr.ru <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;&amp;<span class="hljs-number"><span class="hljs-number">1</span></span> | grep Downloaded Downloaded: <span class="hljs-number"><span class="hljs-number">7</span></span> files, <span class="hljs-number"><span class="hljs-number">411</span></span>K <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0.3</span></span>s (<span class="hljs-number"><span class="hljs-number">1.22</span></span> MB/s)</code> </pre> <br>  It should be noted that the Q300K restriction is sufficient to understand the download speed, especially if the network delay to the site is more than 10 ms.  However, the speed results will not be obvious if the amount of downloaded information is less than 100K. <br><br>  But what if there is a need to track the resource loading speed on an ongoing basis?  You can try to solve the issue with a small script, monitoring system (able to run scripts) and waterproofing tape. <br><a name="habracut"></a><br>  To write the script, take Python3, as an example, take Cacti 0.8.8h. <br>  The script will look like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Python code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python # -*- coding: utf-8 -*- import datetime import re import os import subprocess import argparse parser = argparse.ArgumentParser() parser.add_argument("-h_page", "--hostname_page", dest = "hostname_page") args = parser.parse_args() curent_time=str(datetime.datetime.now().strftime("%Y-%m-%d_%H:%M:%S_")) pid=os.getpid() fweb=open('/usr/TEST_Script/TMP_FILES/web_temp'+curent_time+str(pid)+'.txt', 'w') web=subprocess.call(["timeout 120 wget -E -H -p -Q300K --user-agent=Mozilla --no-cache --no-cookies --delete-after --timeout=15 --tries=2 "+args.hostname_page+" 2&gt;&amp;1 | grep '\([0-9.]\+ [KM]B/s\)'"], bufsize=0, shell=True, stdout=(fweb)) fweb.close() fweb=open('/usr/TEST_Script/TMP_FILES/web_temp'+curent_time+str(pid)+'.txt', 'r') data=fweb.read() os.remove('/usr/TEST_Script/TMP_FILES/web_temp'+curent_time+str(pid)+'.txt') speed_temp=re.findall(r's \((.*?)B/s', str(data)) speed_temp_si=re.findall(r's \((.*?) [KM]B/s', str(data)) try: if re.findall(r'M', str(speed_temp))==[] and re.findall(r'K', str(speed_temp))==[]: speed_="{0:.3f}".format(float(speed_temp_si[0])*0.001*8) elif re.findall(r'M', str(speed_temp))!=[]: speed_="{0:.3f}".format(float(speed_temp_si[0])*1000*8) elif re.findall(r'K', str(speed_temp))!=[]: speed_="{0:.3f}".format(float(speed_temp_si[0])*1*8) except: speed_='no_data' print ('web_speed_test:'+speed_)</span></span></code> </pre><br></div></div><br>  To test it, you can run it from the console: <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">root@localhost ~</span></span>]<span class="hljs-meta"><span class="hljs-meta"># python3.3 /usr/TEST_Script/web_open.py -h_page habrahabr.ru web_speed_test:10160.000</span></span></code> </pre> <br>  Now you need to perform standard manipulations in Cacti to run scripts, they are well documented on the <a href="https://www.cacti.net/">Cacti</a> website, you can also use the hint below. <br><br><div class="spoiler">  <b class="spoiler_title">Cacti comics</b> <div class="spoiler_text">  1. Console -&gt; Data Input Methods <br><img src="https://habrastorage.org/web/cc6/ee5/683/cc6ee5683b3a4f8fa9426d85e4bdc232.jpg"><br>  2. Console -&gt; Data Templates <br><img src="https://habrastorage.org/web/136/394/336/1363943365054249a406ecf751d8b199.jpg"><br>  3. Console -&gt; Graph Templates <br><img src="https://habrastorage.org/web/e88/1be/8aa/e881be8aa4b9415cb178ffc6c62c0c3f.jpg"><br>  4. Console -&gt; Devices <br><img src="https://habrastorage.org/web/be5/e2b/53a/be5e2b53ae7048a195451e2fcbdd8e77.jpg"><br>  5. Console -&gt; Create New Graphs <br><img src="https://habrastorage.org/web/975/123/880/975123880d6a4cebbfe5842b73cf2a85.jpg"><br><img src="https://habrastorage.org/web/654/316/0e5/6543160e5282454b95b26133d4cfe004.jpg"><br></div></div><br>  If done correctly, you should end up with similar graphics: <br><br><img src="https://habrastorage.org/web/07d/d4d/f11/07dd4df11ced4bd4a74be2bd5a501e26.jpg"><br><br>  The thin line is the measured data, have a sawtooth view.  the measurement in this case takes place simultaneously and is displayed on the graph, while when loading for example network interfaces we see the average speed value for the measured period (usually 5 minutes by default).  The thick line is a trend line that helps approximate the visualization.  On the presented graph, the actual measured values ‚Äã‚Äãfor one of the Web sites.  A drawdown in the center, technical problems confirmed by the site administrator, and further partial restoration. <br><br>  You found this article useful for you, then perhaps in this section you will also be interested in the following non-standard monitoring features: <br><br>  - Monitoring TCP retransmission when measuring the download speed of the site. <br>  - Monitoring ICMP RTD from any router on your Internet network (Juniper, Huawei, Cisco) to Web resources. <br>  - Monitoring RTD latency to sites with closed ICMP protocol. <br><br>  Write in the comments if you need to continue.  Thank you for your time. </div><p>Source: <a href="https://habr.com/ru/post/332690/">https://habr.com/ru/post/332690/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332678/index.html">Understanding oracles in the blockchain</a></li>
<li><a href="../332682/index.html">Oracle Data Integrator. SubstitutionAPI: The order of the substitutions. Part 1</a></li>
<li><a href="../332684/index.html">Vulnerability VKontakte: send a message with the page recovery code to someone else's number</a></li>
<li><a href="../332686/index.html">Meet Apache BookKeeper - a replicable log service</a></li>
<li><a href="../332688/index.html">Lecture about two libraries of Yandex for working with big data</a></li>
<li><a href="../332692/index.html">Binary image segmentation using the level set method</a></li>
<li><a href="../332694/index.html">Configuring BGP Looking glass based on OpenBSD 6.1</a></li>
<li><a href="../332698/index.html">The digest of interesting materials for the mobile developer # 211 (July 03 - July 09)</a></li>
<li><a href="../332700/index.html">Quotes program data collection</a></li>
<li><a href="../332704/index.html">Announcement Heisenbag 2017 Moscow: Double the Benefit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>