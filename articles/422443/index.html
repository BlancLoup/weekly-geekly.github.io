<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Corona SDK exact timer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. In this brief article I will tell you how to make a timer with an acceptable reading accuracy in your application on the Corona SDK. Also consi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Corona SDK exact timer</h1><div class="post__text post__text-html js-mediator-article">  Hello.  In this brief article I will tell you how to make a timer with an acceptable reading accuracy in your application on the Corona SDK.  Also consider what are the problems of the standard timer. <br><br>  The article will solve the following problem: Make an application that will show the elapsed time since the application was turned on with its update 1 time per second. <br><a name="habracut"></a><br><h3>  1. Obvious standard solution. </h3><br>  Create a standard timer and display its ticks. <br><br><pre><code class="lua hljs">timeout = <span class="hljs-number"><span class="hljs-number">1000</span></span> timer.performWithDelay( timeout,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(event.count) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  Everything seems to be obvious, but there are features in the work of this solution: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Firstly, the standard timer is able to correctly and accurately work out timeouts starting from 300-400ms, and everything below this value starts to lag very significantly, but our case is different since the timeout is more than the specified limits.  <i>The minimum possible period for timer ticks (if you specify 1 ms) is 1 / fps, i.e.</i>  <i>16. (6) ms for 60 frames or 33. (3) ms for 30 frames.</i> </li><li>  Secondly, even at the specified relatively accurate period, there is a random error of about 5-10 ms from each tick, i.e.  in an hour the error of 15-30 seconds accumulates.  <i>This problem can be partially solved by subtracting 5 ms from the value specified in the parameter when creating the timer, i.e.</i>  <i>instead of 1000, indicate 995.</i> </li><li>  Thirdly, if in your application there will be small friezes caused by the result of the work of another code or unstable operation of the device, these friezes will also be added to the piggy bank of the time lag in the timer. </li><li>  Fourthly, if you minimize the application for a while and then re-deploy it, all the time that the application was minimized will be excluded from the number of seconds the application is running. </li></ul><br><h3>  2. Good decision. </h3><br>  To solve the problems of the past method, we use the following construction, in this method we use a timer with the maximum possible speed, but the signal for the tick timer will be a calculation based on the exact time source of the system. <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> timeout = <span class="hljs-number"><span class="hljs-number">1000</span></span><span class="hljs-comment"><span class="hljs-comment">-- socket = require "socket" local start_time = socket.gettime()*1000--  ( ) local good_time = 0 timer.performWithDelay( 1,function(event) local new_time = socket.gettime()*1000--   local total_time = new_time - start_time--      local num = math.floor(total_time/timeout)--      timeout if num &gt; good_time then--     good_time = num--  print(good_time) end end,0)</span></span></code> </pre> <br>  We analyze the features of this method.  Despite the fact that we indicate the frequency of ticks 1ms as described above, the real quanta of ticks will be performed every 16 (33) -50ms, and this will determine the maximum possible error of the above method, the error will vary in the range of 0..50ms from tick to tick, i.e.  the frequency of following ticks will be less stable than in the first method, but the magnitude of this error at any distance (even length in years) will be the same, i.e.  even in a year, our next tick will have an error within the same limits relative to the very first tick. <br><br><h3>  3. Verification of results </h3><br>  I will give an example of how you can verify the justice of all the above.  The given source will, once per second, display the current time elapsed since the application was turned on for two timers (separately) and show the error accumulated during operation. <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> timeout = <span class="hljs-number"><span class="hljs-number">1000</span></span> socket = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">"socket"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> start_time = socket.gettime()*<span class="hljs-number"><span class="hljs-number">1000</span></span><span class="hljs-comment"><span class="hljs-comment">--   local good_time = 0--   local bad_time = 0--   --  timer.performWithDelay( timeout,function(event) bad_time = event.count local bad_delta = (socket.gettime()*1000 - start_time) - (bad_time*timeout) print('Bad tick: '..bad_time, 'Delta: '..bad_delta) end,0) --  timer.performWithDelay( 1,function(event) local new_time = socket.gettime()*1000 local total_time = new_time - start_time local num = math.floor(total_time/timeout) if num &gt; good_time then good_time = num local good_delta = (socket.gettime()*1000 - start_time) - (good_time*timeout) print('Good tick: '..good_time, 'Delta: '..good_delta) end end,0)</span></span></code> </pre> <br>  Good luck to all! </div><p>Source: <a href="https://habr.com/ru/post/422443/">https://habr.com/ru/post/422443/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../422433/index.html">Solar panels and asphalt roads. Symbiosis of technology</a></li>
<li><a href="../422435/index.html">Timer - start</a></li>
<li><a href="../422437/index.html">User Perception Games and Website and Application Speed</a></li>
<li><a href="../422439/index.html">Struggle with Yandex: how I spent more than a year to bring the site to the top</a></li>
<li><a href="../422441/index.html">Found a formula for a painless transition to .Net Core</a></li>
<li><a href="../422445/index.html">BottomAppBar implementation. Part 3: Behaviors for Android</a></li>
<li><a href="../422447/index.html">bytes.Buffer in Go: optimizations that don't work</a></li>
<li><a href="../422449/index.html">Senators vs. Amazon: what an online store is wrong for</a></li>
<li><a href="../422451/index.html">Listen to the marketing of games and the place of script writer in the gaming industry 26.09 at VSBI</a></li>
<li><a href="../422453/index.html">SmartData 2018: First canceled conference of the JUG.ru Group</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>