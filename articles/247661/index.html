<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using AWS Lambda to create an archive of specific files with AWS S3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="AWS Lambda is a computing service that runs your code in certain events and automatically manages your computing resources. Overview of the concept, p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using AWS Lambda to create an archive of specific files with AWS S3</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/637/9b2/9da/6379b29da68f40f69ec5ba364c052ff6.png" alt="image"><br><br>  AWS Lambda is a computing service that runs your code in certain events and automatically manages your computing resources.  Overview of the concept, principles of operation, prices and the like is already on the habr ( <a href="http://habrahabr.ru/company/epam_systems/blog/245949/">habrahabr.ru/company/epam_systems/blog/245949</a> ), I will try to show a practical example of using this service. <br><br>  So, as the name implies, we will use AWS Lambda to create an archive of the files we have stored on AWS S3.  Go! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h3>  Creating a new feature in the AWS console </h3><br>  <i>AWS Lambda is in the ‚Äúpreview‚Äù stage, so if you use it for the first time, you will need to fill out a request and wait a few days for access.</i> <br><br>  To create a new function in the AWS console, click on the Create a Lambda function button and get to the form of setting the parameters of the new function. <br>  First of all, we are asked the name and description of the new function: <br><img src="https://habrastorage.org/files/94b/fa7/c95/94bfa7c95d6b4e9e872dd1de7af0f76e.png" alt="image"><br><br>  Then its code: <br><img src="https://habrastorage.org/files/a42/3ca/933/a423ca933481449a848aa211042f5ef7.png" alt="image"><br>  You can either write the code directly to the editor or upload a specially prepared zip archive.  The first option is only suitable for code without additional dependencies, and the second at the time of writing this article did not work through the web.  Therefore, at this stage we create a function with the code from the editor, without changing the text of the proposed example, and later we will load the code we need with all the dependencies using software. <br><br>  Role name determines what access rights to various AWS objects a function will have.  I will not focus on this now, I‚Äôll just say that the rights offered by default when creating a new role provide access to AWS S3 and therefore are sufficient for this example. <br><br>  You must also specify the allocated amount of memory and the timeout of execution: <br><img src="https://habrastorage.org/files/685/c18/66b/685c1866b05a4d95840bd007b0c8f73f.png" alt="image"><br>  The allocated amount of memory affects the price of the function (the more, the more expensive).  However, allocated processor resources are also tied to it.  Since the task of creating an archive is highly dependent on processor resources, we choose the maximum available amount of memory ‚Äî the increase in price is fully compensated by the reduction in processing time. <br><br>  After completing the form, click the Create Lambda function and leave the AWS console in order to proceed to the direct creation of our function. <br><br><h3>  Function code, as well as its packaging and unloading in AWS </h3><br>  To solve our problem, we will use several third-party libraries, as well as the grunt-aws-lambda library for the convenience of developing, packaging and unloading the finished function. <br><br>  We create packaje.json as follows: <br><pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"zip-s3"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"AWS Lamda Function"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"private"</span></span>: <span class="hljs-string"><span class="hljs-string">"true"</span></span>, <span class="hljs-string"><span class="hljs-string">"devDependencies"</span></span>: { <span class="hljs-string"><span class="hljs-string">"aws-sdk"</span></span>: <span class="hljs-string"><span class="hljs-string">"^2.1.4"</span></span>, <span class="hljs-string"><span class="hljs-string">"grunt"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.4.5"</span></span>, <span class="hljs-string"><span class="hljs-string">"grunt-aws-lambda"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.3.0"</span></span> }, <span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: { <span class="hljs-string"><span class="hljs-string">"promise"</span></span>: <span class="hljs-string"><span class="hljs-string">"^6.0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"s3-upload-stream"</span></span>: <span class="hljs-string"><span class="hljs-string">"^1.0.7"</span></span>, <span class="hljs-string"><span class="hljs-string">"archiver"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.13.1"</span></span> }, <span class="hljs-string"><span class="hljs-string">"bundledDependencies"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"promise"</span></span>, <span class="hljs-string"><span class="hljs-string">"s3-upload-stream"</span></span>, <span class="hljs-string"><span class="hljs-string">"archiver"</span></span> ] }</code> </pre> <br>  and install dependencies: <br><pre> <code class="bash hljs">npm install</code> </pre> <br>  The bundledDependencies archive in package.json contains dependencies that will be packaged along with our function upon upload. <br><br>  After that, create the index.js file in which the function code will be located. <br>  First, let's see how the code of a function looks like that does nothing: <br><pre> <code class="javascript hljs">exports.handler = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data, context</span></span></span><span class="hljs-function">) </span></span>{ context.done(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); }</code> </pre> <br>  A call to context.done indicates that the function is completed, while AWS Lambda stops its execution, counts the time used, and so on. <br><br>  The data object contains the parameters passed to the function.  The structure of this object we will have the following form: <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">bucket</span></span> : <span class="hljs-string"><span class="hljs-string">'from-bucket'</span></span>, <span class="hljs-attr"><span class="hljs-attr">keys</span></span> : [<span class="hljs-string"><span class="hljs-string">'/123/test.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">'/456/test2.txt'</span></span>], <span class="hljs-attr"><span class="hljs-attr">outputBucket</span></span> : <span class="hljs-string"><span class="hljs-string">'to-bucket'</span></span>, <span class="hljs-attr"><span class="hljs-attr">outputKey</span></span> : <span class="hljs-string"><span class="hljs-string">'result.zip'</span></span> }</code> </pre> <br>  Let's start writing the actual function code. <br>  We connect the necessary libraries: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> AWS = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'aws-sdk'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'promise'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s3Stream = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'s3-upload-stream'</span></span>)(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AWS.S3()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> archiver = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'archiver'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AWS.S3();</code> </pre> <br>  Create objects that will archive files and stream download the resulting archive to AWS S3. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> archive = archiver(<span class="hljs-string"><span class="hljs-string">'zip'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> upload = s3Stream.upload({ <span class="hljs-string"><span class="hljs-string">"Bucket"</span></span>: data.outputBucket, <span class="hljs-string"><span class="hljs-string">"Key"</span></span>: data.outputKey }); archive.pipe(upload);</code> </pre> <br>  Create a promise to call context.done when the result is finished loading: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> allDonePromise = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolveAllDone</span></span></span><span class="hljs-function">) </span></span>{ upload.on(<span class="hljs-string"><span class="hljs-string">'uploaded'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">details</span></span></span><span class="hljs-function">) </span></span>{ resolveAllDone(); }); }); allDonePromise.then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ context.done(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); });</code> </pre> <br>  We get the files at the specified addresses and add them to the archive.  After the download of all files, close the archive: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getObjectPromises = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data.keys) { (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">itemKey</span></span></span><span class="hljs-function">) </span></span>{ itemKey = <span class="hljs-built_in"><span class="hljs-built_in">decodeURIComponent</span></span>(itemKey).replace(<span class="hljs-regexp"><span class="hljs-regexp">/\+/g</span></span>,<span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getPromise = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolveGet</span></span></span><span class="hljs-function">) </span></span>{ s3.getObject({ <span class="hljs-attr"><span class="hljs-attr">Bucket</span></span>: data.bucket, <span class="hljs-attr"><span class="hljs-attr">Key</span></span> : itemKey }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, fileData</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(itemKey, err, err.stack); resolveGet(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> itemName = itemKey.substr(itemKey.lastIndexOf(<span class="hljs-string"><span class="hljs-string">'/'</span></span>)); archive .append(fileData.Body, { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: itemName }); resolveGet(); } }); }); getObjectPromises.push(getPromise); })(data.keys[i]); } <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.all(getObjectPromises).then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ archive.finalize(); });</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">All Code Assembly</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> AWS = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'aws-sdk'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'promise'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s3Stream = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'s3-upload-stream'</span></span>)(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AWS.S3()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> archiver = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'archiver'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AWS.S3(); exports.handler = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data, context</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> archive = archiver(<span class="hljs-string"><span class="hljs-string">'zip'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> upload = s3Stream.upload({ <span class="hljs-string"><span class="hljs-string">"Bucket"</span></span>: data.outputBucket, <span class="hljs-string"><span class="hljs-string">"Key"</span></span>: data.outputKey }); archive.pipe(upload); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> allDonePromise = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolveAllDone</span></span></span><span class="hljs-function">) </span></span>{ upload.on(<span class="hljs-string"><span class="hljs-string">'uploaded'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">details</span></span></span><span class="hljs-function">) </span></span>{ resolveAllDone(); }); }); allDonePromise.then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ context.done(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getObjectPromises = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data.keys) { (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">itemKey</span></span></span><span class="hljs-function">) </span></span>{ itemKey = <span class="hljs-built_in"><span class="hljs-built_in">decodeURIComponent</span></span>(itemKey).replace(<span class="hljs-regexp"><span class="hljs-regexp">/\+/g</span></span>,<span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getPromise = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolveGet</span></span></span><span class="hljs-function">) </span></span>{ s3.getObject({ <span class="hljs-attr"><span class="hljs-attr">Bucket</span></span>: data.bucket, <span class="hljs-attr"><span class="hljs-attr">Key</span></span> : itemKey }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(itemKey, err, err.stack); resolveGet(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> itemName = itemKey.substr(itemKey.lastIndexOf(<span class="hljs-string"><span class="hljs-string">'/'</span></span>)); archive .append(data.Body, { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: itemName }); resolveGet(); } }); }); getObjectPromises.push(getPromise); })(data.keys[i]); } <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.all(getObjectPromises).then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ archive.finalize(); }); };</code> </pre> <br></div></div><br>  To package and upload files to AWS, create Gruntfile.js with the following content: <br><div class="spoiler">  <b class="spoiler_title">Gruntfile.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">grunt</span></span></span><span class="hljs-function">) </span></span>{ grunt.initConfig({ <span class="hljs-attr"><span class="hljs-attr">lambda_invoke</span></span>: { <span class="hljs-attr"><span class="hljs-attr">default</span></span>: { } }, <span class="hljs-attr"><span class="hljs-attr">lambda_package</span></span>: { <span class="hljs-attr"><span class="hljs-attr">default</span></span>: { } }, <span class="hljs-attr"><span class="hljs-attr">lambda_deploy</span></span>: { <span class="hljs-attr"><span class="hljs-attr">default</span></span>: { <span class="hljs-attr"><span class="hljs-attr">function</span></span>: <span class="hljs-string"><span class="hljs-string">'zip-s3'</span></span> } } }); grunt.loadNpmTasks(<span class="hljs-string"><span class="hljs-string">'grunt-aws-lambda'</span></span>); };</code> </pre></div></div><br>  And the ~ / .aws / creadentials file with AWS access keys: <br><pre> <code class="hljs haskell">[<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>] aws_access_key_id = ... aws_secret_access_key = ...</code> </pre> <br>  We pack and unload our function in AWS Lambda: <br><pre> <code class="bash hljs">grunt lambda_package lambda_deploy</code> </pre> <br><h3>  Calling the created function from our application </h3><br>  We will call the function from the application in java. <br>  To do this, prepare the data: <br><pre> <code class="java hljs">JSONObject requestData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSONObject(); requestData.put(<span class="hljs-string"><span class="hljs-string">"bucket"</span></span>, <span class="hljs-string"><span class="hljs-string">"from-bucket"</span></span>); requestData.put(<span class="hljs-string"><span class="hljs-string">"outputBucket"</span></span>,<span class="hljs-string"><span class="hljs-string">"to-bucket"</span></span>); requestData.put(<span class="hljs-string"><span class="hljs-string">"outputKey"</span></span>, <span class="hljs-string"><span class="hljs-string">"result.zip"</span></span>); JSONArray keys = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSONArray(); keys.put(URLEncoder.encode(<span class="hljs-string"><span class="hljs-string">"/123/1.txt"</span></span>,<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)); keys.put(URLEncoder.encode(<span class="hljs-string"><span class="hljs-string">"/456/2.txt"</span></span>,<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)); requestData.put(<span class="hljs-string"><span class="hljs-string">"keys"</span></span>, keys);</code> </pre> <br>  And directly call the function: <br><pre> <code class="java hljs">AWSCredentials myCredentials = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicAWSCredentials(accessKeyID, secretKey); AWSLambdaClient awsLambda = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AWSLambdaClient(myCredentials); InvokeAsyncRequest req = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvokeAsyncRequest(); req.setFunctionName(<span class="hljs-string"><span class="hljs-string">"zip-s3"</span></span>); req.setInvokeArgs(requestData.toString()); InvokeAsyncResult res = awsLambda.invokeAsync(req);</code> </pre> <br>  The function will be executed asynchronously - we will immediately get the result that the execution request has been successfully received by AWS Lambda, and the execution itself will take some time. </div><p>Source: <a href="https://habr.com/ru/post/247661/">https://habr.com/ru/post/247661/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247647/index.html">Java logging. Hello world</a></li>
<li><a href="../247649/index.html">Installing OpenSolaris snv_134b SPARC on SunFire v100</a></li>
<li><a href="../247651/index.html">The story of another game on Libgdx + Box2d</a></li>
<li><a href="../247657/index.html">About programming on 1C Enterprise 8</a></li>
<li><a href="../247659/index.html">Visual Studio + Roslyn = configurator for 1C: Enterprise</a></li>
<li><a href="../247663/index.html">We program Arduino on pure C</a></li>
<li><a href="../247665/index.html">A drone based on the Raspberry Pi. Part 1</a></li>
<li><a href="../247667/index.html">Guide to the Car Tutorial (Unity3d) part 1 of 3</a></li>
<li><a href="../247669/index.html">Fast Data Recipe Based on Big Data Solution</a></li>
<li><a href="../247671/index.html">How to create a robotic startup: a textbook for the entrepreneur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>