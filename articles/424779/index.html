<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multi-page SPA on Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bridge between Python and React 

 An owl is a nano-framework that can be embedded into other frameworks. 
 A picture from sova.online, which runs 3 h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multi-page SPA on Python</h1><div class="post__text post__text-html js-mediator-article">  <b>Bridge between Python and React</b> <br><br>  An owl is a nano-framework that can be embedded into other frameworks. <br>  A picture from sova.online, which runs 3 http servers: <br>  <a href="http://sova.online/">http://sova.online/</a> - just Falcon <br>  <a href="http://sova.online:8000/">http://sova.online:8000/</a> - just Django <br>  <a href="http://sova.online:8001/">http://sova.online:8001/</a> - just Python (login: 1, password: 1) <br>  There are source codes and installation instructions.  There is no advertising. <br><br><img src="https://habrastorage.org/webt/gx/yn/h9/gxynh9nwwhuq9ik8ius_k7lvjgo.jpeg"><br><a name="habracut"></a><br>  The idea to make sites on Python with drawing on React is not new.  There is a wonderful framework <a href="https://plot.ly/products/dash/">https://plot.ly/products/dash/</a> , why do something else? <br>  I explain: Owl is not designed for site development.  It is a tool for replacing thick clients with browser-based applications (desktop applications). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      - What is a web client? <br>  - Not.  This is not a web client.  This application works in a browser. <br>  - I do not understand. <br>  - Unfortunately, many developers do not understand. <br><br>  As a general, I actively worked with several Internet applications. <br><br>  <b>Online client of the bank Ugra (bank closed).</b> <br>  It was a good application, but it was a Java applet, i.e.  fat client launched from browser.  And the Bank of Ugra, and applets in the past. <br><br>  <b>Online client of VTB-24 Bank (bank closed).</b> <br>  I am a humanist, but after working with this miracle, cruel thoughts like: ‚ÄúMake the developer register 1000 payment orders in it‚Äù began to appear. <br>  At the same time as a web client, he is beautiful.  Animation, opens on a mobile phone.  Wow  Cool! <br>  I asked an accountant friend: how do you work with him? <br>  She says: beautiful!  I load the data in 1s, I work in 1s, I upload the results back. <br><br>  <b>Sberbank online client</b> <br>  Satisfactory customer, you can work.  When I was asked to rate him, I gave him 3 points out of 5 and gave a list of comments.  This is with my 10 payments per month.  Those who make 100 bills a day are likely to upload information. <br><br>  Filling payment. <br><img src="https://habrastorage.org/webt/kx/0a/h2/kx0ah27hdkvgc6ob0-16ifdx5oq.jpeg"><br>  The green area that occupies 20% of the screen is the menu.  It does not just interfere (position: fixed), it says that the developer is not a professional.  If I started making a payment, on the db screen.  3 buttons: ‚ÄúCreate‚Äù, ‚ÄúSave as template‚Äù, ‚ÄúCancel‚Äù.  These buttons are (for some reason below).  This is not a multi-page SPA: go through the menu item - the data in the form will disappear. <br>  The one who did this will not even understand what the hitting is: ‚ÄúIt‚Äôs normally done, everyone is doing it, such a library, people are working ...‚Äù.  And he is right.  You need to ask the project manager, and for the manager, the main thing is the database and the layers in the conceptual model.  And the forms - we will hire boys, they will draw.  And they are proud, perhaps, of this hack. <br><br>  <b>Trading platforms (5 pieces, 44 FZ)</b> <br>  These are really applications (not web clients).  But I don't like field controllers. <br>  Examples: <br><img src="https://habrastorage.org/webt/ap/wl/in/apwlinkughplv39l_m4qsopioza.jpeg"><br><br>  Aligned strangely, the width of the field is clearly insufficient, there is no autoheight in the input field. <br><br>  Another example.  In the field ‚ÄúDate of publication‚Äù there is no template dd.mm.yyyy, the calendar with an error, the calendar icon scares: <br><img src="https://habrastorage.org/webt/zl/lk/6z/zllk6zxsfvaoxyq9qk7p9unosjw.jpeg"><br><br>  List on rts-tender: there is a current record highlighted in color, you can move through the list with arrows, but there is no autoscrolling (you can run off the screen), neither Enter nor a space opens the link, the tab is not tied to the current record.  Although you can only open the link with the mouse, I appreciate the control with a plus sign.  This functionality (remember and highlight the current document) is not enough for me in mail.ru <br><br>  It seems like little things.  But a professional application differs from a semi-professional in just trifles.  The end user does not care what your database is and how many layers there are in the conceptual model.  It works with screen forms and it has 3 requirements: functionally, conveniently, quickly. <br>  Unfortunately, the choice of the system is determined by IT specialists and managers who did not work with the system themselves and will not work.  They will appreciate the speed, the functionality will be assessed as they understand it, and they do not care about convenience, the main thing is that it is beautiful. <br>  Pavel Valerievich Durov did not invent either the social network or the instant messenger.  He did what users want, comfortable and beautiful.  And people appreciated it, including materially. <br><br>  Owl is a tool for building a professional interface. <br>  What does this mean, for example, SED. <br><br>  There are EDS, it has 3 user groups: <br>  Bosses <br>  Specialists preparing documents <br>  Clerks. <br><br>  Chiefs, they are like children.  They need to just and beautiful.  Ideally, 1 button and 1 field.  And to ponte more.  Web client and, of course, mobile client to show off. <br><br>  Specialists.  Web client, a social network / mailer mix.  Do not forget that there are a lot of specialists and they need to be trained.  The more familiar the environment is to them, the better.  A mobile client is also useful if the security service allows it. <br><br>  Clerks.  This is where the Owl comes in handy.  Clerks are a backbone user group.  All others can get sick / go on vacation / stop using, - SED will work.  If registration stops, everything will come up. <br>  Office work is a conveyor, and here everything is important, any trifle: fonts, half tones, automatic filling, checking values, ease of entry, etc. <br>  SED "Delo".  Performers' cabinets are made on the web client, the office is a fat client.  Everything is fine, but it will work until the government bans Windows in state structures.  I love Win 7, but if I were the ruler, the it-market would cheer up with new orders, and MS would remain in bright memory.  By the way, on December 6, Anton Siluanov signed a <a href="https://www.vedomosti.ru/technology/articles/2018/12/16/789399-siluanov-trebuet-ot-goskompanii">directive</a> on switching to domestic software. <br><br>  <b>Sova.online</b> <br><br>  How owl opens the form. <br>  Without multi-page. <br>  The central element of the Owl is the Document component.  By pressing ctrl-U on the start page, you will see everything you need to create a Document class object: <br>  - data fields of the database; <br>  - form url to display; <br>  - dbAlias, unid - to work with the database; <br>  - something else there. <br><br>  To some extent, Document is the equivalent of a Redux form. <br>  The form is loaded as a JSON string, then the former dictionary becomes an object having style, className and an array (list) of elements.  The array will be inserted into the element with id = root as <pre><code class="plaintext hljs">&lt;div style className&gt;‚Ä¶‚Ä¶&lt;/div&gt;</code> </pre> <br>  Array elements are objects that describe tags. <pre> <code class="plaintext hljs">&lt;div&gt;, &lt;a&gt;, &lt;img&gt;, &lt;button&gt;</code> </pre>  or array, or components. <br>  For parsing an array, the boxing function is responsible.  If an element containing an array is encountered, it will recursively call itself. <br>  Navel of the earth, of course, div. <br>  In the simplest case, this is the string: dict (div = 'Hello', className = 'h2') <br>  But maybe an array (array of arrays): <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">style</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(**par)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-string"><span class="hljs-string">'style'</span></span>: {**par}} dict( <span class="hljs-comment"><span class="hljs-comment">#     sova.online style(position='relative'), readOnly = 1, div = [ dict( style(width=1000, margin='auto', paddingTop=20), div=[ { 'div': subFormTop.panel() }, { 'div': [subFormLeft.panel(), subFormRight.panel()], 'className': 'row' }, # { 'div': [subFormDown.panel()] }, ]), ] )</span></span></code> </pre> <br><br>  Here are 3 panels (each in a separate file: subFormTop.py, etc.). <br>  subFormTop.panel () returns an array to build the top panel. <br>  subFormLeft.panel () and subFormRight.panel () are combined into a row ('className': 'row') and describe the left and right panels. <br>  subFormDown.panel () is commented out (not useful). <br><br>  It may seem difficult.  But this is Python: everything can be simplified. <br>  An example of a form from the magazine "Reports".  The labField function (label, field_name_BD) returns an array of two dictionaries (table row): 1st dictionary is {'div': label}, the second {'field': [database_name, 'tx']}. <br><pre> <code class="python hljs">div = [ docTitle(<span class="hljs-string"><span class="hljs-string">''</span></span>), dict ( wl=<span class="hljs-string"><span class="hljs-string">'40mm'</span></span>, className=<span class="hljs-string"><span class="hljs-string">'cellbg-green'</span></span>, div=_table( labField(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'nodafd'</span></span>), labField(<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'_STARTINGTIME'</span></span>), labField(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'_ENDTIME'</span></span>), labField(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'CREATOR'</span></span>), labField(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'REPORTCAT'</span></span>), labField(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'REPORTNAME'</span></span>), labField(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'REPORTTITLE'</span></span>), labField(<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'dt1'</span></span>), labField(<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'dt2'</span></span>), labField(<span class="hljs-string"><span class="hljs-string">'  2'</span></span>, <span class="hljs-string"><span class="hljs-string">'dt3'</span></span>), labField(<span class="hljs-string"><span class="hljs-string">'  2'</span></span>, <span class="hljs-string"><span class="hljs-string">'dt4'</span></span>), labField(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'LBYEARS'</span></span>), labField(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'GRGROUP'</span></span>), labField(<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'QUERYMAIN'</span></span>), labField(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'NOTES'</span></span>), )), sent(), ]</code> </pre><br><br><img src="https://habrastorage.org/webt/7u/ah/tw/7uahtweb5axodfbphubw5v3-okw.jpeg"><br><br>  Examples from sova / api / forms / home / top.py (starting at sova.online): <br><br>  python dictionary <br>  {'a': 'React v16', 'href': 'https://reactjs.org'} <br>  Gives clear React component <br><pre> <code class="plaintext hljs">&lt;a href={'https://reactjs.org'}&gt;React v16&lt;/a&gt;</code> </pre> <br><br>  Img is smarter than the standard - in props you can set href and target: <br><br>  Python: <br>  dict (img = 'image? react.ico', style = {'width': 16}, href = 'https: //reactjs.org') <br><br>  Fragment of the parser that converts an array of objects into components (boxing.js): <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( td.img ) { <span class="hljs-comment"><span class="hljs-comment">// td ‚Äì    let img = &lt;img src={td.img} _/&gt;; return td.href ? &lt;a href={td.href} key={i} target={td.target}&gt;{img}&lt;/a&gt; : img; }</span></span></code> </pre><br><br>  Type in the search engine "react component library".  The result is predictable - a lot.  But all this abundance is intended for websites, not applications: <br>  Smart-textarea - perhaps the only control that gave me. <br>  React-select - simplified and redid the dropdown list <br>  Data-picker / calendar - did not find anything suitable.  I wrote my own, taking as a model built into G.Chrome. <br>  Upload / Download - nothing suitable, wrote your own. <br><br>  Imho: websites have a sad future.  The vast majority of users will no longer use browsers (or have already ceased) in the near future.  The phone will be merged with the tablet, and 1 dash of 10 applications will fully meet your needs. <br>  I have already come across twice with programmers who do not know how to write an e-mail address correctly.  Why should they remember what they do not use.  The world is changing. <br><br>  In the Sovet, the controllers are not ideal, but they were designed for the operator, not the web user. <br>  As an example, the ‚ÄúTransmission Mark‚Äù form.  A fairly universal form, used where there is a boss.  Red on the screenshot encircled fields that control the hide.  Additional resolutions open automatically as they are completed, if there are several instructions in the operative part for different groups of performers with different terms.  Two terms per group: 1st term to the 1st performer, 2nd term co-performers. <br><img src="https://habrastorage.org/webt/yg/2q/f4/yg2qf4g9p3umqggkpduhnv4rgis.jpeg"><br><br>  You can touch the form <a href="http://sova.online/docopen%3FSOVA/SITE%265C6945A82CB55D8E314456DA2FAB9A38%26edit">HERE</a> <br><br>  The controller is the React component associated with the database field. <br>  A detailed description of the controllers with the ability to check their work is on Sova.online. <br>  Pay attention to the types of rtf and json.  Rtf is displayed as text, but if the text contains the {_ {object} _} construct, the Owl will perform json.parse for this construct and add the result to the form.  The field with the json type must store the description of the array of markup elements: [{element1}, {element2}, ...].  json.parse is executed before rendering. <br>  Fields with such types allow you to store markup in the database or in files.  Useful when generating reports and writing documentation. <br><br>  List of controllers for all field types (controllers.js): <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> controller = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prop</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (prop.type) { <span class="hljs-comment"><span class="hljs-comment">//  case 'chb': return &lt;Checkbox {...prop}/&gt;; case 'lbse': // listbox single enable (    ) case 'lbme': // listbox multivalue enable // lbse/lbme -     ,   case 'tx': return &lt;Text {...prop}/&gt;; // smart-textarea case 'lbsd': // listbox single disables (    ) case 'lbmd': return &lt;ListBox {...prop}/&gt;; case 'dt': return (prop.readOnly ? &lt;Text {...prop} xValue={Util.dtRus(prop.xValue)} /&gt; : &lt;Datepicker {...prop}/&gt;); case 'fd': return &lt;ForDisplayOnly {...prop}/&gt;; case 'table': case 'gr': return &lt;Table {...prop}/&gt;; case 'rtf': return &lt;RTF {...prop}/&gt;; case 'json': return &lt;JsonArea {...prop}/&gt;; case 'list': return &lt;List {...prop}/&gt;; case 'view': return &lt;View {...prop}/&gt;; default: console.warn('  ', prop.xName, prop.type); return &lt;Text {...prop}/&gt;; }; };</span></span></code> </pre><br><br>  The application requires a manipulation mechanism for the controllers. <br>  In the board, all document controllers are stored in a document variable. <br>  this.register <br>  I did not dare to use refs due to rumors that the redoxophiles would cancel it. <br>  The controller can have the following interfaces: <br>  getValue (param) <br>  setValue (value, param) <br>  setFocus () <br>  changeDropList () <br><br>  In order to access the desired field, there are document methods <br>  getField (fieldName, param) <br>  setField (fieldName, value, param) <br>  changeDropList (fieldName, param) <br>  setFocus (fieldName) <br>  For fields of type FileShow there is a method fileShow ['FILES1 _']. HasAtt (), where FILES1_ is the name of the file area.  Returns true if there are attachments.  In the mark of the transfer of such areas 2. <br><br>  Controllers can generate a recalc event.  If a handler is registered for this field, it will be executed.  Handlers are in loadable js-files. <br>  An example and a somewhat simplified description: <br>  There is a ‚ÄúTransmission Mark‚Äù form (o.py).  It contains the uploaded o.js file <br>  Handlers are registered in o.js <br><pre> <code class="javascript hljs">recalc: { <span class="hljs-attr"><span class="hljs-attr">PROJECTO</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function"> =&gt;</span></span> doc.forceUpdate(), <span class="hljs-attr"><span class="hljs-attr">WHOPRJ2</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function"> =&gt;</span></span> doc.forceUpdate(), <span class="hljs-attr"><span class="hljs-attr">WHOPRJ3</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function"> =&gt;</span></span> doc.forceUpdate(), ‚Ä¶   }</code> </pre> <br>  , as well as the conditions for hiding are specified (project, op, prj1, prj2‚Ä¶ prj5 - this is the ‚Äúname‚Äù property in the description of the divs): <br><pre> <code class="javascript hljs">hide: { <span class="hljs-attr"><span class="hljs-attr">project</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function"> =&gt;</span></span> !doc.getField(<span class="hljs-string"><span class="hljs-string">'projectO'</span></span>), <span class="hljs-comment"><span class="hljs-comment">// ,   PROJECTO  op: doc =&gt; doc.getField('projectO'), // ,   PROJECTO   prj1: doc =&gt; !doc.getField('projectO'), prj2: doc =&gt; !doc.getField('projectO'), prj3: doc =&gt; !doc.getField('projectO') || (!doc.getField('whoPrj2') &amp;&amp; !doc.getField('whoPrj3')), prj4: doc =&gt; !doc.getField('projectO') || (!doc.getField('whoPrj3') &amp;&amp; !doc.getField('whoPrj4')), prj5: doc =&gt; !doc.getField('projectO') || (!doc.getField('whoPrj4') &amp;&amp; !doc.getField('whoPrj5')), },</span></span></code> </pre> <br><br>  How it works: the PROJECTO field is the checkbox; when the value changes, the controller generates a recalc event, the document calls the recalc.PROJECTO (this) handler. <br>  The handler simply calls forceUpdate () to redraw the document. <br>  When redrawing, it is checked whether the components have a name in the name, whether the hide [props.name] function has a name for this, and whether it returns true. <br>  prj3: doc =&gt;! doc.getField ('projectO') ||  (! doc.getField ('whoPrj2') &amp;&amp;! doc.getField ('whoPrj3')) <br>  Hide the third resolution (area with props.name === 'prj3'), if the projectO checkbox is OFF or the resolution 2 and 3 fields are not entered (both 'whoPrj2' and 'whoPrj3' fields are empty). <br>  The name of a field when calling functions is case-insensitive. <br>  WHOPRJ2 is a combo box, when choosing a value, the controller will also generate a recalc event, which will also cause a redraw.  Selecting the artist in the second resolution, you will open the third one. <br><br>  In loadable js-files you can: <br>  - manage the hide; <br>  - manage reading only; <br>  - respond to changes in fields; <br>  - execute commands of buttons; <br>  - do validation of fields and forms before saving; <br><br>  Loadable file for form 'fo': <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.sovaActions = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.sovaActions || {}; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.sovaActions.fo = { <span class="hljs-comment"><span class="hljs-comment">// fo ‚Äì      recalc: { //           PROJECTO: doc =&gt; doc.forceUpdate(), }, hide: { //   ,  true project: doc =&gt; !doc.getField('projectO'), }, readOnly: { //     ,  true who: doc =&gt; doc.getField('SENTFROMDB'), }, validate: { //         who: doc =&gt; doc.getField('who') ? '' : '   " "', form: doc =&gt; new Promise( (yes, no) =&gt; { let disableAutoOrder = false; for (let i = 1; i &lt;= 5; i++) { let val = doc.getField('RESPRJ' + i); disableAutoOrder |= /  /.test(val); } disableAutoOrder &amp;&amp; doc.setField('AUTOORDER', ''); yes(); }), }, cmd: { //    logoff: doc =&gt; { window.location.href = '/logoff' }, }, }</span></span></code> </pre> <br><br>  Validation of fields is a function, returns empty if everything is OK, or a message about what is wrong.  The owl will set the focus to an invalid field. <br>  Form validation - promis.  In the example, there are no checks (yes is always called), just something is done before being sent to the server. <br>  In redux-form, validation is done through trow - some kind of wildness. <br><br>  <i>For those who are not familiar with promises, an example of the simplest:</i> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> confirmDlg = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">msg</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ok, cancel</span></span></span><span class="hljs-function">) =&gt;</span></span> confirm(msg) ? ok(<span class="hljs-string"><span class="hljs-string">'  '</span></span>) : cancel(<span class="hljs-string"><span class="hljs-string">'  cancel'</span></span>)); confirmDlg(<span class="hljs-string"><span class="hljs-string">'  '</span></span>) .then( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(s)) .catch( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(s));</code> </pre> <br><br>  The Document class has several predefined commands that can be used in buttons: <br><br>  edit: go to form edit mode <br>  save: save the form <br>  close: close form <br>  saveClose: save and close the form <br><br>  prn: print the form with the choice of template for printing <br>  docOpen: open the document <br>  dbOpen: open log <br>  xopen: open url <br>  newDoc: create a new document with the desired form <br><br>  In the Redux-form api is richer, - in the Owl, only necessary. <br><br>  <b>Multi-page.</b> <br><br>  The Document class creates an object (form) that is embedded in the element. <pre> <code class="plaintext hljs">&lt;div id="root"&gt;&lt;/div&gt;</code> </pre>  . <br>  Let's call it the ‚Äúroot document‚Äù.  If you add an element to the root document <br>  &lt;div style = {{position: 'absolute', zIndex: 999}} /&gt;, in the same way you can insert another Document object. <br>  How to deal with loadable command handlers?  Everything is simple: each form has its own handler (its js), and the root document should load those that may be required. <br>  Sample for the start page of sova.online (home.py) <br>  The home.py form opens documents with the forms ‚Äúrkckg‚Äù, ‚Äúoutlet‚Äù, ‚Äúoutlet.gru‚Äù, and ‚Äúo‚Äù to demonstrate its multiplicity. <br>  In order for all forms to work correctly, you need to write scripts for these forms in home.py: <br><pre> <code class="python hljs">javaScriptUrl = [<span class="hljs-string"><span class="hljs-string">'jsv?api/forms/rkckg/rkckg.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'jsv?api/forms/outlet_gru/outlet_gru.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'jsv?api/forms/outlet/outlet.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'jsv?api/forms/o/o.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'jsv?api/forms/home/home.js'</span></span>]</code> </pre> <br><br>  Since when calling any handler function, the first parameter is a link to the document, actions will be performed on the required document. <br><br>  OOP and no miracles. <br><br>  React - not React <br>  I have already described the form "report".  It opens from the report manager (‚ÄúReact‚Äù arrow) and describes the parameters for collecting the report. <br><img src="https://habrastorage.org/webt/rp/tb/vj/rptbvjkspfqes5nxti7wfmitbtu.jpeg"><br>  The reports themselves (arrow "not React") are stored in subordinate documents with the form "rreport" in the form of html attachments.  We were engaged in the development of reports, when React was not, the form ‚Äúrreport‚Äù turned out to be simple (20 html lines and 15 simple-js lines), why change the fact that it has been working for 8 years. <br><br>  <a href="http://sova.online/newdoc%3FRF_AKK_MOKRASG/STAT_KRD%26reportManager">Open report manager.</a> <br><br>  The ‚Äúrreport‚Äù form consists of 4 buttons and an iframe.  Owl before opening the document replaces src = "" in the address with the url line for downloading the html-attachment, the browser does the rest. <br>  The EXCEL / WORD buttons are similar: insert the url buttons for downloading with the file name ‚Äúreport.html.xls‚Äù or ‚Äúreport.html.doc‚Äù and the corresponding mime-type.  Excel / Word does the rest (‚Äúthese smart animals understand everything they want from them‚Äù). <br>  From do_get.py: <br><br><pre> <code class="python hljs">downloadUrl = <span class="hljs-string"><span class="hljs-string">'/download/'</span></span> + fn + <span class="hljs-string"><span class="hljs-string">'?'</span></span> + <span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>.join([d.db.alias, d.unid, idbl, fsName, fzip, ctype, flen]) excel = <span class="hljs-string"><span class="hljs-string">'/download/%s.xls?%s'</span></span> % (fn, <span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>.join([d.db.alias, d.unid, idbl, fsName, fzip, <span class="hljs-string"><span class="hljs-string">'application/x-excel'</span></span>, flen])) word = <span class="hljs-string"><span class="hljs-string">'/download/%s.doc?%s'</span></span> % (fn, <span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>.join([d.db.alias, d.unid, idbl, fsName, fzip, <span class="hljs-string"><span class="hljs-string">'application/msword'</span></span>, flen])) html = html.replace(<span class="hljs-string"><span class="hljs-string">'src=""'</span></span>, <span class="hljs-string"><span class="hljs-string">'src="%s"'</span></span> % downloadUrl).replace(<span class="hljs-string"><span class="hljs-string">'openExcel'</span></span>, excel).replace(<span class="hljs-string"><span class="hljs-string">'openWord'</span></span>, word)</code> </pre> <br><br>  When opening html in Excel / Word, there are differences from the browser, but small.  And the article is not about that. <br><br>  <b>Making a form from scratch.</b> <br><br>  Initial data: <br>  There are 3 functions <br>  def snd (* msg, cat = 'snd'): <br>  def err (* msg, cat = 'all'): <br>  def dbg (* msg, cat = 'snd'): <br>  which are more or less evenly distributed throughout the code and write error messages and other crap to the log file. <br>  The message format is passed to logging.Formatter in the form: <br>  '% (asctime) s% (levelname) s [% (name) s]% (message) s' <br>  The file is filled with messages <br>  ... <br>  09/02/2018 17:50:07 DEBUG [http-server] addr ('127.0.0.1', 49964), ‚ÄúGET / arm HTTP / 1.1‚Äù 200 - <br>  02.09.2018 17:54:07 INFO [Free space] Attachments are saved in ". \ DB \ files" Free 68557 Mb <br>  09/02/2018 17:58:07 ERROR [do_get.py] getScript: [Errno 2] No such file or directory: 'sova / api / forms / o / oo.js' <br>  ... <br>  Date-time, then level, then in square brackets the category within the level, then the message. <br><br>  Task: <br>  Make a page to view the log file.  What type <br><img src="https://habrastorage.org/webt/du/6e/ni/du6enivag9amyf4ss1lucuf1tm8.jpeg"><br><br>  Let's call the form ‚Äúlm‚Äù, it will be formed as a function of the page in the module api / forms / lm.py <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">page</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dbAlias, mode, userName, multiPage)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dict( style(background=<span class="hljs-string"><span class="hljs-string">'url(/image?bg51.jpg)'</span></span>, backgroundSize=<span class="hljs-string"><span class="hljs-string">'100% 100%'</span></span>), div=[ dict( style(width=<span class="hljs-string"><span class="hljs-string">'200px'</span></span>, float=<span class="hljs-string"><span class="hljs-string">'left'</span></span>, background=<span class="hljs-string"><span class="hljs-string">'rgba(210,218,203, 0.5)'</span></span>, padding=<span class="hljs-string"><span class="hljs-string">'0 5px'</span></span>), div=[ _field(<span class="hljs-string"><span class="hljs-string">'type'</span></span>, <span class="hljs-string"><span class="hljs-string">'list'</span></span>, [<span class="hljs-string"><span class="hljs-string">' |all'</span></span>, <span class="hljs-string"><span class="hljs-string">'|err'</span></span>, <span class="hljs-string"><span class="hljs-string">'|info'</span></span>, <span class="hljs-string"><span class="hljs-string">'|debug'</span></span>], saveAlias=<span class="hljs-number"><span class="hljs-number">1</span></span>, **style(margin=<span class="hljs-string"><span class="hljs-string">'10px auto'</span></span>, width=<span class="hljs-number"><span class="hljs-number">170</span></span>, height=<span class="hljs-number"><span class="hljs-number">110</span></span>) ), _field(<span class="hljs-string"><span class="hljs-string">'cat'</span></span>, <span class="hljs-string"><span class="hljs-string">'list'</span></span>, <span class="hljs-string"><span class="hljs-string">'TYPE_ALIAS|||api.get?loadDropList&amp;logger|keys_{FIELD}'</span></span>, listItemClassName=<span class="hljs-string"><span class="hljs-string">'repName'</span></span>, listItemSelClassName=<span class="hljs-string"><span class="hljs-string">'repNameSel'</span></span>, **style(height=<span class="hljs-string"><span class="hljs-string">'calc(100vh - 133px)'</span></span>, overflow=<span class="hljs-string"><span class="hljs-string">'auto'</span></span>) ) ], ), _field(<span class="hljs-string"><span class="hljs-string">'msg'</span></span>, <span class="hljs-string"><span class="hljs-string">'fd'</span></span>, br=<span class="hljs-number"><span class="hljs-number">1</span></span>, **style(overflow=<span class="hljs-string"><span class="hljs-string">'auto'</span></span>, height=<span class="hljs-string"><span class="hljs-string">'100vh'</span></span>, font=<span class="hljs-string"><span class="hljs-string">'bold 12px Courier'</span></span>, background=<span class="hljs-string"><span class="hljs-string">'rgba(255,255,255, 0.8)'</span></span>) ), ] )</code> </pre> <br><br>  In the left part there are 2 fields, both with the type ‚Äúlist‚Äù: type and cat (message type and category). <br>  In the right one field msg with type fd (forDisplayOnly). <br>  The message types are specified in the field description (['All log | all', 'Errors | err', ...), <br>  categories are drawn on xhr from the global dictionary with a tricky url call: <br>  api.get? loadDropList &amp; logger | keys_err returns in json-format an array (list) of categories from the global dictionary.  Something like well ('logger', 'keys_err'). <br>  Messages are generated when the document is opened by the queryOpen function in lm.py <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">queryOpen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d, mode, ground)</span></span></span><span class="hljs-function">:</span></span> logParser() ls = well(<span class="hljs-string"><span class="hljs-string">'logger_all'</span></span>, <span class="hljs-string"><span class="hljs-string">'AL L'</span></span>) s = <span class="hljs-string"><span class="hljs-string">'\n'</span></span>.join(reversed(ls)) d.msg = s d.type_alias = <span class="hljs-string"><span class="hljs-string">'all'</span></span></code> </pre> <br>  logParser reads and parses the log file.  The results are decomposed into several arrays and stored in the global dictionary.  Nothing interesting: 2 simplest re and loop iterator. <br>  Functions for working with the global dictionary: <br>  toWell (o, key1, [key2]) - save the object ‚Äúo‚Äù in the global dictionary <br>  well (key1, [key2]) - take an object from the global dictionary by key (by two keys). <br>  For the first drawing of this is enough.  To be able to display messages of the desired type and the desired category, you need to make loadable js. <br>  Add the line to lm.py <br>  javaScriptUrl = 'jsv? api / forms / lm / lm.js' <br>  and create lm.js: <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.sovaActions = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.sovaActions || {}; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.sovaActions.lm = { <span class="hljs-comment"><span class="hljs-comment">//   "lm" init: doc =&gt; doc.changeDropList('CAT'), recalc: { TYPE: (doc, label, alias) =&gt; { doc.changeDropList('CAT'); getLogData(doc, alias + '|AL L'); }, CAT: (doc, label) =&gt; getLogData(doc, doc.getField('type_alias') + '|' + label), }, }; // *** *** *** let getLogData = (doc, keys) =&gt; { fetch('api.get?getLogData&amp;' + keys, {method: 'get', credentials: 'include'}) .then( response =&gt; response.text() ) .then( txt =&gt; doc.setField('msg', txt) ) .catch( err =&gt; doc.setField('msg', err.message) ); };</span></span></code> </pre> <br><br>  getLogData pulls messages from the server of the desired type and category: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLogData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(par, un)</span></span></span><span class="hljs-function">:</span></span> lg, _, cat = par.partition(<span class="hljs-string"><span class="hljs-string">'|'</span></span>) msg = well(<span class="hljs-string"><span class="hljs-string">'logger_'</span></span> + lg, cat) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">'text/html; charset=UTF-8'</span></span>, <span class="hljs-string"><span class="hljs-string">'\n'</span></span>.join(reversed(msg))</code> </pre><br><br>  You can enjoy the form <a href="http://sova.online/newdoc%3F%26lm">HERE</a> . <br>  Initially, logging was done based on the standard logging module. <br>  using logging.FileHandler, .addHandler, and others getLogger and setFormatter. <br>  As taught.  But at the same time it was buggy.  You can throw stones, but when I threw out logging and just started writing to the file, the code became shorter, clearer and the glitches disappeared. <br><br>  Included is a self-hosted multi-threaded wsgi server with Digest authorization.  This is not for sites.  Why was he needed at all? <br>  The customer has 40 jur.  Persons, in most cases 1-2-3 people work with the system.  Store data on the Internet is prohibited.  All win 7. Requires easy installation and configuration. <br>  Solution: using cx-Freeze and Inno Setup, we install the installer, run it on the computer of the most responsible one and get a mini http server for the local network that starts as a Windows service.  Nothing extra.  It is impossible to use wsgiref.simple_server or wsgi_Werkzeug built into Python.  they are single-threaded: until one request is completed, the others will wait. <br>  I would hardly surprise anyone by saying that the built-in WSGIServer / 0.2 CPython / 3.5.3 in Django is many times faster than the self-written Python one.  Only it doesn‚Äôt matter - forms and directories are cached on the client, only the database data is transmitted very quickly over the local network. <br>  There is another reason: the desktop application has access to computer resources (EDS, files, scanner ...).  To get the same access from the browser, you need to either write a plugin, or hang up a small http server in the services, which can sniff out the main server and perform the necessary actions on the locale. <br><br>  Owl does not use framework tools to work with the database.  In the dbToolkit directory, something similar in structure to MongoDB (or Lotus Notes) to SQLite3: <br>  Book class - db (in MongoDB and Lotus Notes terminology) <br>  DocumentCollection class - a collection of documents from the Book <br>  Document class - a document (an object containing any number of fields). <br><br>  <b>Installation:</b> <br>  Download from <a href="http://sova.online/">sova.online owl.zip</a> archive <br><br>  In the archive directory owl, from which you can run the Owl from django, falcon or without frameworks. <br><br>  Download, unzip. <br>  Install Python3 (3.5+) <br><br>  1. owl - without frameworks.  Attention!  Login: 1, password: 1 <br><br>  Linux: <br>  cd ./owl <br>  python3 wsgi_sova.py <br><br>  or in a separate window <br>  screen -Udm python3 wsgi_server.py <br><br>  Windows: <br>  cd ./owl <br>  wsgi_sova.py <br><br>  2. Django <br><br>  Linux: <br>  Install django: <br>  pip3 install django <br>  cd ./owl <br>  python3 manage.py runserver <br><br>  or in a separate window <br>  screen -Udm python3 manage.py runserver 127.0.0.1:8000 <br><br>  Windows: <br>  Install django: <br>  pip install django <br>  cd ./owl <br>  manage.py runserver <br><br>  3. falcon <br><br>  Linux: <br>  pip3 install falcon <br>  cd ./owl <br>  python3 wsgi_sova.py falconApp: api 8001 log_falcon / falcon <br><br>  Windows: <br>  pip install falcon <br>  cd ./owl <br>  wsgi_sova.py falconApp: api 8001 log_falcon / falcon <br><br>  ********************* <br><br>  - the name of the article is strange, did you understand what a ‚ÄúMultipage SPA‚Äù is? <br>  - the usual marketing ploy <br>  - why not Redux?  Everyone uses Redux <br>  - the word "reducer" I do not like <br>  - and seriously?  CombineReducers at any level of the hierarchy ... It's so beautiful <br>  - it's multipage, baby.  Command handlers should be inside the form, not like a deer antler. <br>  - why did you even write an article? <br>  - PR </div><p>Source: <a href="https://habr.com/ru/post/424779/">https://habr.com/ru/post/424779/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../424765/index.html">Status Management in Flutter Applications</a></li>
<li><a href="../424767/index.html">We make from Habr cake. Again</a></li>
<li><a href="../424771/index.html">Personal experience: from the idea and a clean slate to a draft version of the site</a></li>
<li><a href="../424773/index.html">Biopharma and numerical modeling: Amgen's experience and practice</a></li>
<li><a href="../424777/index.html">Using Consul to scale stateful services</a></li>
<li><a href="../424781/index.html">Learning and testing neural networks on PyTorch using Ignite</a></li>
<li><a href="../424787/index.html">Interview with Aaron Patterson, speaker of the RubyRussia 2018 conference</a></li>
<li><a href="../424789/index.html">How to deploy a Ruby on Rails application with HAProxy Ingress, unicorn / puma, and web sockets</a></li>
<li><a href="../424791/index.html">Expansion of network capabilities of a programmable relay using WI-FI</a></li>
<li><a href="../424793/index.html">How to print an electric motor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>