<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to asynchronous operations in C # 5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last time, we talked about how to simplify working with asynchronous operations using the Jeffrey Richter AsyncEnumerator class , as well as using the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to asynchronous operations in C # 5</h1><div class="post__text post__text-html js-mediator-article">  Last time, we talked about how to simplify working with <a href="http://sergeyteplyakov.blogspot.com/2010/10/asyncenumerator.html">asynchronous operations using the</a> Jeffrey Richter <a href="http://sergeyteplyakov.blogspot.com/2010/10/asyncenumerator.html">AsyncEnumerator class</a> , as well as using the <a href="http://sergeyteplyakov.blogspot.com/2010/11/blog-post.html">Reactive Extensions</a> library.  However, as Hejlsberg told us recently with the company, happiness will come with the release of a new version of the C # language and we will not need to use third-party and not-so-bicycles when working with asynchronous operations. <br><br>  The idea that underlies the asynchronous operations in C # 5 is very similar to the one used by Jeffrey Richter in his <strong>AsyncEnumerator</strong> class, but this time the compiler also learned about it besides you and old Richter. this syntactic sugar).  To begin with, let's go back to the synchronous version of our brilliant example that we used earlier: <br><br><a name="habracut"></a><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); }</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">static</font> <font color="#0000ff">void</font> SyncVersion() { Stopwatch sw = Stopwatch.StartNew(); <font color="#0000ff">string</font> url1 = <font color="#A31515">"http://rsdn.ru"</font> ; <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; <font color="#0000ff">var</font> webRequest1 = WebRequest.Create(url1); <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url1, webResponse1.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest2 = WebRequest.Create(url2); <font color="#0000ff">var</font> webResponse2 = webRequest2.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url2, webResponse2.ContentLength, sw.ElapsedMilliseconds); <font color="#0000ff">var</font> webRequest3 = WebRequest.Create(url3); <font color="#0000ff">var</font> webResponse3 = webRequest3.GetResponse(); <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} : {1}, elapsed {2}ms"</font> , url3, webResponse3.ContentLength, sw.ElapsedMilliseconds); }</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Everything is very simple here (and the main thing is very original!): We pretend that we are writing something like our browser, well, or we just have nothing to do and need to get the contents of three web pages.  The synchronous version works fine as always, except for the fact that we wait three times longer than we could by running this operation asynchronously.  Since we already understood that this is bad and we watched Healesberg‚Äôs performance with pleasure, we‚Äôll try to make this asynchronous method of this remarkable synchronous method with the help of two mouse strokes and three clicks on the keyboard. <br><br>  The first thing to do is change the declaration of our function to the following: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">static</font> async <font color="#0000ff">void</font> AsyncVersion () </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  The <strong>async keyword</strong> (which is a keyword in the CTP version, and in the release will be a contextual keyword) in the method signature indicates that this method runs asynchronously and returns control to the calling code immediately after the start of some asynchronous operation.  Asynchronous methods can return one of three types of return values: <strong>void</strong> , <strong>Task,</strong> and <strong>Task &lt;T&gt;</strong> .  If the method returns <strong>void</strong> , it will be an asynchronous operation of the type: ‚Äústarted and forgotten‚Äù (‚Äúfire and forget‚Äù), since it will be impossible to handle the result of this operation (although if you do not handle exceptions inside this method, it will crash nicely, and it can pull along the whole process!).  In some scenarios, this is useful (for example, we want to notify all remote subscribers asynchronously and we don‚Äôt care if they receive these messages or not).  With the <strong>Task</strong> and <strong>Task &lt;T&gt;</strong> classes, the inquisitive reader (who is still not completely tired of the pace with which all of us favorite Redmond company releases new features) may be familiar, as they have been living and well for some time in the .Net Framework 4th version.  The main idea of ‚Äã‚Äãthese classes is that they encapsulate an ‚Äúincomplete task‚Äù in themselves and we can wait for its completion, establish a ‚Äúcontinuation‚Äù (something that should be caused when this task is completed), etc.  At the same time, the <strong>Task &lt;T&gt;</strong> class is a successor of the <strong>Task</strong> class and differs from the latter in that it allows you to get a return value of type <strong>T</strong> through the <strong>Result</strong> property, while the <strong>Task</strong> class says that some task returns <strong>void</strong> , and is valuable due to its side effects. <br><br>  Since we do not just want to start an asynchronous operation for execution, but also to get the results of its execution, but at the same time, it‚Äôs not the result itself that is important, but a side effect ... In general, we use the <strong>Task</strong> type as the return value (although we could safely use <strong>Task &lt; string&gt;</strong> , but, in general, it is not so important). <br><br>  By changing the method signature, you need to change a little and its body.  For this line of the form: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">var</font> webResponse1 = webRequest1.GetResponse (); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  It should be replaced by: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">var</font> webResponse1 = await webRequest1.GetResponseAsync (); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  The <strong>await keyword</strong> (in the release it will also be a context keyword) does not mean at all that we will stick at this point in the code until the requested asynchronous operation is performed.  This can be confusing (and <a href="http://blogs.msdn.com/b/ericlippert/archive/2010/10/29/asynchronous-programming-in-c-5-0-part-two-whence-await.aspx">Eric and the company</a> even suggest finding other keywords), but this means exactly the opposite idea.  The <strong>await keyword</strong> means that after the start of an asynchronous operation (in this case, after the start of an asynchronous operation to retrieve <strong>WebResponse</strong> ), the method should return control, and continue from the same place after the end of the asynchronous operation.  With wise words, this is called a continuation, and Eric has about a <a href="http://blogs.msdn.com/b/ericlippert/archive/tags/continuation%2Bpassing%2Bstyle/">dozen articles</a> that can coolly put brains on this issue. <br><br>  If you don‚Äôt go into matane, then in this case you can draw a parallel with the blocks of iterators in C # (if you are not familiar with this topic, then I highly recommend you <a href="http://sergeyteplyakov.blogspot.com/2010/06/c-1.html">fix it</a> ), because the compiler in both cases generates a finite state machine that tracks where it was method execution was interrupted, and is used to correctly restore execution on a subsequent call.  However, if, in the case of iterators, resuming the execution of an iterator block occurs upon a subsequent call of the <strong>MoveNext</strong> method with an external code, the asynchronous method will continue to be executed automatically after the completion of the asynchronous operation.  For this, the current method is set as the ‚Äúcontinuation‚Äù of the current task, which is called when the current task is completed. <br><br>  So, here is the entire modified method: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">static</font> async Task AsyncVersion () </li><li>  { </li><li>  Stopwatch sw = Stopwatch.StartNew (); </li><li>  <font color="#0000ff">string</font> url1 = <font color="#A31515">"http: //rsdn.ru1"</font> ; </li><li>  <font color="#0000ff">string</font> url2 = <font color="#A31515">"http://gotdotnet.ru"</font> ; </li><li>  <font color="#0000ff">string</font> url3 = <font color="#A31515">"http://blogs.msdn.com"</font> ; </li><li></li><li>  <font color="#0000ff">var</font> webRequest1 = WebRequest.Create (url1); </li><li>  <font color="#2B91AF">Console</font> .WriteLine ( <font color="#A31515">"Before webRequest1.GetResponseAsync (). Thread Id: {0}"</font> , </li><li>  Thread.CurrentThread.ManagedThreadId); </li><li></li><li>  <font color="#0000ff">var</font> webResponse1 = await webRequest1.GetResponseAsync (); </li><li>  <font color="#2B91AF">Console</font> .WriteLine ( <font color="#A31515">"{0}: {1}, elapsed {2} ms. Thread Id: {3}"</font> , url1, </li><li>  webResponse1.ContentLength, sw.ElapsedMilliseconds, </li><li>  Thread.CurrentThread.ManagedThreadId); </li><li></li><li>  <font color="#0000ff">var</font> webRequest2 = WebRequest.Create (url2); </li><li>  <font color="#2B91AF">Console</font> .WriteLine ( <font color="#A31515">"Before webRequest2.GetResponseAsync (). Thread Id: {0}"</font> , </li><li>  Thread.CurrentThread.ManagedThreadId); </li><li></li><li>  <font color="#0000ff">var</font> webResponse2 = await webRequest2.GetResponseAsync (); </li><li>  <font color="#2B91AF">Console</font> .WriteLine ( <font color="#A31515">"{0}: {1}, elapsed {2} ms. Thread Id: {3}"</font> , url2, </li><li>  webResponse2.ContentLength, sw.ElapsedMilliseconds, </li><li>  Thread.CurrentThread.ManagedThreadId); </li><li></li><li>  <font color="#0000ff">var</font> webRequest3 = WebRequest.Create (url3); </li><li>  <font color="#2B91AF">Console</font> .WriteLine ( <font color="#A31515">"Before webRequest3.GetResponseAsync (). Thread Id: {0}"</font> , </li><li>  Thread.CurrentThread.ManagedThreadId); </li><li>  <font color="#0000ff">var</font> webResponse3 = await webRequest3.GetResponseAsync (); </li><li>  <font color="#2B91AF">Console</font> .WriteLine ( <font color="#A31515">"{0}: {1}, elapsed {2} ms. Thread Id: {3}"</font> , url3, </li><li>  webResponse3.ContentLength, sw.ElapsedMilliseconds, </li><li>  Thread.CurrentThread.ManagedThreadId); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  (To be honest, I still changed the output to the console so that you can see in which thread the method is currently running, but this is just for clarity, so this change does not count. But in any case, old Hejlsberg did not lie, change , indeed, the minimum amount). <br><br>  And this is how this method is called: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main ( <font color="#0000ff">string</font> [] args) </li><li>  { </li><li></li><li>  <font color="#0000ff">try</font> </li><li>  { </li><li>  <font color="#2B91AF">Console</font> .WriteLine ( <font color="#A31515">"Main thread id: {0}"</font> , Thread.CurrentThread.ManagedThreadId); </li><li>  <font color="#0000ff">var</font> task = AsyncVersion (); </li><li>  <font color="#2B91AF">Console</font> .WriteLine ( <font color="#A31515">"Right after AsyncVersion () method call"</font> ); </li><li>  <font color="#008000">// Waiting for the completion of the asynchronous operation</font> </li><li>  task.Wait (); </li><li>  <font color="#2B91AF">Console</font> .WriteLine ( <font color="#A31515">"Asyncronous task finished!"</font> ); </li><li></li><li>  } </li><li>  <font color="#0000ff">catch</font> (System.AggregateException e) </li><li>  { </li><li>  <font color="#008000">// All exceptions in TPL are thrown wrapped in AggregateException</font> </li><li>  <font color="#2B91AF">Console</font> .WriteLine ( <font color="#A31515">"AggregateException: {0}"</font> , e.InnerException.Message); </li><li>  } </li><li>  <font color="#2B91AF">Console</font> .ReadLine (); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  But the result of its implementation: <br><br><blockquote>  <font>Main thread id: 10</font> <font><br><br></font>  <font>Before webRequest1.GetResponseAsync ().</font>  <font>Thread Id: 10</font> <font><br><br><br></font>  <font>Right after AsyncVersion () method call</font> <font><br><br><br></font>  <a href="http://rsdn.ru/"><font></font></a><font><a href="http://rsdn.ru/">rsdn.ru</a></font> <font>: 1672, elapsed 657ms.</font>  <font>Thread Id: 13</font> <font><br><br></font>  <font>Before webRequest2.GetResponseAsync ().</font>  <font>Thread Id: 13</font> <font><br><br><br></font>  <a href="http://gotdotnet.ru/"><font></font></a><font><a href="http://gotdotnet.ru/">gotdotnet.ru</a></font> <font>: 99470, elapsed 1915ms.</font>  <font>Thread Id: 14</font> <font><br><br></font>  <font>Before webRequest3.GetResponseAsync ().</font>  <font>Thread Id: 14</font> <font><br><br><br></font>  <a href="http://blogs.msdn.com/"><font></font></a><font><a href="http://blogs.msdn.com/">blogs.msdn.com</a></font> <font>: 47927, elapsed 2628ms.</font>  <font>Thread Id: 15</font> <font><br><br></font>  <font>Asynchronous task finished!</font> <br></blockquote><br><br>  And now let's look at in detail what is happening inside this beast.  So, the call to the <strong>AsyncVersion</strong> method occurs in the current thread, and control returns immediately after the first <strong>await</strong> statement.  But before returning control to the calling code, the <strong>AsyncVersion</strong> method <strong>is</strong> set as a ‚Äúcontinuation‚Äù of the current task and the place from which to continue execution is remembered.  This function returns an object of type <strong>Task</strong> , so that we can wait for completion and check the results.  Then, after the completion of the asynchronous operation, execution resumes from the previous place and, as we see, already in a different thread.  Further, this process continues until the third asynchronous operation is completed, after which the <strong>task.Wait</strong> method returns control, and we see the cherished on the console: ‚ÄúAsynchronous task finished!‚Äù. <br><br>  Error handling has also undergone some changes, but also very minor ones.  If you are already familiar with TPL, then you will recognize the familiar <strong>System.AggregateExcpetion</strong> class, which ‚Äúcollects‚Äù all the exceptions and accumulates them inside.  The reason for this is that a single task can have a dozen child tasks, each of which may contain several more ‚Äúsubtasks‚Äù, and each task from this ‚Äútree‚Äù of tasks can fall with its own exception.  It is for solving this task that <strong>AggregateException is used</strong> , which contains a ‚Äútree‚Äù of exceptions, which can be easily ‚Äústraightened out‚Äù using the <strong>Flatten</strong> method (details can be found, for example, <a href="http://sergeyteplyakov.blogspot.com/2010/09/52.html">here</a> , in the ‚ÄúWorking with AggregateException‚Äù section).  In general, if error handling has become complicated, it is not significant, and comparing it with the nightmare that we have to deal with when working with APM, then this ‚Äúcomplication‚Äù, even the problem of calling fingers will not turn. <br><br>  In fact, this example is not very different from the synchronous one;  because we are performing three asynchronous operations in a row, with each subsequent operation only starting after the previous one is completed.  Let's try to rewrite our second example in a new form, which simultaneously receives results from three web pages and asynchronously writes the result to a file: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">public</font> <font color="#0000ff">static</font> async <font color="#0000ff">void</font> AsyncVersion2 () </li><li>  { </li><li>  Stopwatch sw = Stopwatch.StartNew (); </li><li>  <font color="#0000ff">var</font> urls = <font color="#0000ff">new</font> <font color="#0000ff">string</font> [] { <font color="#A31515">"http://rsdn.ru"</font> , <font color="#A31515">"http://gotdotnet.ru"</font> , </li><li>  <font color="#A31515">"http://blogs.msdn.com"</font> }; </li><li>  <font color="#0000ff">var</font> tasks = ( <font color="#0000ff">from</font> url <font color="#0000ff">in</font> urls </li><li>  let webRequest = WebRequest.Create (url) </li><li>  <font color="#0000ff">select</font> <font color="#0000ff">new</font> {Url = url, Response = webRequest.GetResponseAsync ()}) </li><li>  .ToList (); </li><li>  <font color="#0000ff">var</font> data = await TaskEx.WhenAll (tasks.Select (t =&gt; t.Response)); </li><li>  <font color="#0000ff">var</font> sb = <font color="#0000ff">new</font> <font color="#2B91AF">StringBuilder</font> (); </li><li>  <font color="#0000ff">foreach</font> ( <font color="#0000ff">var</font> s <font color="#0000ff">in</font> tasks) </li><li>  { </li><li>  sb.AppendFormat ( <font color="#A31515">"{0}: {1}, elapsed {2} ms. Thread Id: {3}"</font> , s.Url, </li><li>  s.Response.Result.ContentLength, </li><li>  sw.ElapsedMilliseconds, Thread.CurrentThread.ManagedThreadId) </li><li>  .AppendLine (); </li><li>  } </li><li>  <font color="#0000ff">var</font> outputText = sb.ToString (); </li><li>  <font color="#2B91AF">Console</font> .WriteLine ( <font color="#A31515">"Web request results: {0}"</font> , outputText); </li><li></li><li>  <font color="#0000ff">using</font> ( <font color="#0000ff">var</font> fs = <font color="#0000ff">new</font> <font color="#2B91AF">FileStream</font> ( <font color="#A31515">"d: \\ results.txt"</font> , <font color="#2B91AF">FileMode</font> .Create, </li><li>  FileAccess.Write, <font color="#2B91AF">FileShare</font> .Write)) </li><li>  { </li><li>  await </li><li>  fs.WriteAsync (UnicodeEncoding.Default.GetBytes (outputText), 0, </li><li>  UnicodeEncoding.Default.GetByteCount (outputText)); </li><li>  } </li><li></li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  This is really interesting!  We received a completely asynchronous code, but at the same time it does not look as though a herd of Hindus worked on it for several nights (and the asynchronous code of similar complexity looks exactly like that).  It is understandable and read in the same way as synchronous!  (If someone does not believe, then let him try to rewrite this code in the classic APM style). <br><br>  So what do we have?  We have a piece that is really convenient to use without fear of shooting yourself a leg.  In addition, even without going into serious jungle, it is more or less clear how to use this business (mda, although you will have to get used to the names).  And the most interesting thing is that this is not all the functionality.  I didn‚Äôt talk about synchronization contexts and how this business can be great used with the UI thread, what the TAP (Task-based Asynchronous Pattern) is, I didn‚Äôt say that all the new asynchronous methods I used are extension methods and you can add them yourself as much as you like, and did not go into the jungle of implementation ... But about it all, some other time!  And today, I offer you, just download this thing and try it yourself! <br><br>  (I almost forgot, here is the url so that you don‚Äôt search for it for a long time: msdn.com/vstudio/async) </div><p>Source: <a href="https://habr.com/ru/post/109345/">https://habr.com/ru/post/109345/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../109337/index.html">The Kinect game controller is the first device on the market for direct three-dimensional measurement.</a></li>
<li><a href="../109339/index.html">Where do Intel processors</a></li>
<li><a href="../109340/index.html">IMHO about projects with Startup Weekend</a></li>
<li><a href="../109341/index.html">Sony sells HDTV with built-in Playstation 2HDTV</a></li>
<li><a href="../109342/index.html">Create GTK + applet for LXPanel</a></li>
<li><a href="../109346/index.html">New issue of UserAndLINUX - v10.12 (4) has been released</a></li>
<li><a href="../109350/index.html">Online RPG Ecilavia on WebGL</a></li>
<li><a href="../109359/index.html">All ways of making money on the Internet (infographics)</a></li>
<li><a href="../109360/index.html">Another post of disappointment with Beeline or how the tariff 2010 ceased to correspond to the name</a></li>
<li><a href="../109361/index.html">Plastic Card Fraud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>