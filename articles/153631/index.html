<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How is the short-term forecast for Yandex.Probka</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Information about traffic jams appeared on Yandex in 2006. We started with the necessary things - we learned how to build a scheme of congestion of ci...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How is the short-term forecast for Yandex.Probka</h1><div class="post__text post__text-html js-mediator-article">  Information about traffic jams appeared on Yandex in 2006.  We started with the necessary things - we learned how to <a href="http://company.yandex.ru/press_releases/2006/0530/">build a scheme of congestion of</a> city ‚Äã‚Äãstreets and to <a href="">take into account the current situation when plotting routes</a> .  Driving by looking at this information, motorists could already save time on the road: <br><img src="https://habrastorage.org/getpro/habr/post_images/b19/f20/dcb/b19f20dcb0f9148631bf9ac419e9cce9.png" alt="image"><br><br>  Then, to help drivers directly on the road, we added automatic rebuilding of the route to <a href="http://mobile.yandex.ru/maps/">mobile Yandex.Maps</a> (and, as a result, on <a href="http://mobile.yandex.ru/navigator/">Yandex.Navigator</a> ).  Applications have learned to adapt the route with each noticeable change in the situation in the city. <br><br>  Having gathered on the desktop and mobile information about the "now", we went to the solution of the question "how will it be then?‚Äù: <br><img src="https://habrastorage.org/getpro/habr/post_images/0c1/f41/53e/0c1f4153ef0192e890acba190ca9c86a.png" alt="image" title="In such a situation, you can be, if you rely only on the picture of traffic jams at the time of departure.">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first step was the <a href="">statistical map of traffic jams</a> - you can see on it how the city costs and travels on average at a specific hour of a particular day of the week.  We assumed that the map of ‚Äúordinary‚Äù traffic jams could have a useful side effect ‚Äî the ability to predict traffic jams for them in the near future.  But practice has shown that the averaged picture helps to plan approximately, for example, tomorrow's trip to the airport - but it does not help those who are leaving now to avoid new traffic jams.  According to our measurements, even at the end of the hourly route, the picture of traffic jams at the time of departure is usually closer to the actual than the average: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/22d/200/8ef/22d2008efce97f2d5cc14a2c35464139.png" alt="image"><br><br>  A week ago, Yandex.Maps had the <a href="http://maps.yandex.ru/-/CVqNnDOC">opportunity to see the changes in traffic jams in the next hour</a> - our next step in deciding about the future.  For those who couldn‚Äôt come to the <a href="http://events.yandex.ru/events/yac/2012/">Yet Another Conference</a> this year, we‚Äôll tell you today what our forecast is inside and how it turned out. <br><a name="habracut"></a><br><h4>  Actually, the task </h4><br>  We predict changes in the average speed of movement on different parts of the road.  Technically, the road map is a graph.  Each intersection - the top of this graph, and the sections of the road between the two intersections - edges.  The latter have the attribute "length" and the attribute "speed".  The length, of course, is known in advance, and the speed is calculated in real time - depending on it, the section of the road is colored in green, yellow and red.  Actually, the second attribute we undertook to predict. <br><br>  Of course, this task was not invented by us, it is being done by various specialists around the world.  In Russia, for example, the authors of a textbook on one of the main directions in this area - <a href="http://crec.mipt.ru/study/courses/optional/gasnikov/Book-arpglktefbb.pdf">‚ÄúIntroduction to Mathematical Modeling of Transport Flows‚Äù</a> are working on modeling and forecasting traffic.  And although the topic is known for a long time, the car navigation is not available to the Russian user, which uses forecasts based on recent data.  Only in rare cases when building a route is taken into account the average statistics of traffic jams. <br><br>  In the world, workload forecasts are used for <a href="http://en.wikipedia.org/wiki/Traffic_estimation_and_prediction_system">automatic traffic control</a> in some cities.  The first prototypes in which the forecasts were applied <a href="http://en.wikipedia.org/wiki/Traffic_estimation_and_prediction_system">appeared in 1998</a> in the USA.  And the first pilot use of the system, ‚Äúlooking into the future,‚Äù <a href="http://en.wikipedia.org/wiki/Traffic_estimation_and_prediction_system">began in 2006</a> in Singapore. <br><br>  We first touched on forecasting in the Internet Mathematics competition in 2010.  That experience helped us understand how the task should be set and what data is needed to achieve a good result. <br><br><h4>  Data source </h4><br>  In many countries, stationary flow sensors are used, which measure the speed and density of traffic on key highways.  This is a good source of clean traffic data, but covering even Moscow alone would require huge investments.  We completely managed impersonal GPS-tracks that come from users of mobile Maps and Navigator.  Each track is a chain of signals about the location (latitude and longitude) of the car at a particular time.  We <a href="http://company.yandex.ru/technologies/yaprobki/">link GPS tracks to a road graph</a> , that is, we determine which streets they passed.  Then we average the speed of all the tracks running along the same edges. <br><br>  This data has a number of features that make it difficult to obtain a qualitative forecast.  Consumer GPS-devices determine the coordinates with an error, so the tracks are very "noisy."  This complicates not only the calculation of average speeds, but also the binding of tracks to the graph, for example, when the roads pass close to each other: <br><img src="https://habrastorage.org/getpro/habr/post_images/5ab/c17/5a1/5abc175a1fac83bbe84e3dc065587980.png" alt="image" title="An example where ambiguity can be resolved far from immediately."><br><br>  In addition, sometimes on some streets there are few cars that transmit data.  And the situation on the roads itself is not always stable.  For example, the lanes of highways move at different speeds, so in the same area tracks can simultaneously show significantly different speeds. <br><br><h4>  Method selection </h4><br>  A wide variety of methods are used in this area.  Among them: <br><br>  <i>Parametric regression model</i> .  It assumes in advance a specific type of function depending on <i>V <sub>future</sub></i> = <i>F</i> ( <i>V <sub>past</sub></i> , <i>V <sub>current</sub></i> ), and parameters in <i>F are</i> selected.  The peculiarity of the model is that the choice of function imposes limitations on the result.  On the one hand, it protects against serious errors that are inevitable when using noisy data - the parametric function allows to reduce the spread of the predicted values.  On the other hand, with the wrong choice of function, the model can give systematically incorrect answers. <br><br>  <i>Non-parametric model ( <a href="http://en.wikipedia.org/wiki/K-nearest_neighbor_algorithm">"k nearest neighbors"</a> ).</i>  She is simply looking for a situation similar to the current one in the past and, as a forecast, shows how events developed further.  Such a model is more flexible - using it, you can say: ‚ÄúIf a storm arose 10 times after a lull, then after a new lull there will also be a storm‚Äù.  If, for example, we take a <a href="http://en.wikipedia.org/wiki/Linear_regression">linear function in a parametric model</a> , we cannot predict this, since it is limited by the hypothesis that the future can only be a linear combination of the past.  However, on ‚Äúnoisy‚Äù data, the linear model provides greater accuracy than the non-parametric one. <br><br>  Another classification of regression methods is <i>scalar</i> and <i>vector</i> .  In the first, it is assumed that the situation in the selected area does not depend on what is happening on the neighboring, secondly, on the contrary, the dependencies are taken into account.  Hence the difference in the amount of calculations.  If there are 10 thousand road sections in a city, then to build a scalar model, it suffices to choose 10 thousand parameters.  And for a vector model, up to 100 million parameters may be needed.  In our case, it is obvious that situations in different areas affect each other.  And the key is the question of how to limit the circle of neighbors, so that the calculation went within a reasonable time. <br><br>  <i><a href="http://en.wikipedia.org/wiki/Traffic_flow">Methods for modeling flows</a></i> take into account the nature of the process, and not just operate with abstract numbers.  The equation of the current fluid with variable viscosity is used: more density - less speed.  Methods are widely used for road planning and are promising for forecasts, but are too demanding on accuracy and completeness of data.  They give good quality on streaming sensors, but almost do not work on ‚Äúnoisy‚Äù GPS tracks. <br><br>  Experimenting with different methods and evaluating their accuracy and computational complexity, we stopped at linear vector autoregression.  It assumes that the future speed is a linear combination of the current and several past speeds in several areas: directly on the considered one, as well as neighboring ones. <br><br><h4>  What and how is calculated </h4><br>  Once a day, our model is trained.  Based on the development of events for some time period in the past, it builds a forecast.  This forecast is compared with subsequent developments.  In the model, coefficients are selected in order to minimize the discrepancy between the forecast and how everything actually turned out.  For each time of day, the system calculates its coefficients, since the nature of movement during the day varies slightly.  Every few minutes, the forecast for the next hour is calculated using the finished model and fresh tracks. <br><br>  When training the model uses a huge amount of data.  The graph of roads takes about 100 gigabytes: this is information about the topology - which edge is connected with which, and also the geometry - the GPS coordinates of the beginning, end, and bend points of each road segment.  The history of the tracks, which we store, takes dozens of terabytes.  On such volumes, the selection of coefficients for days would stretch out on one server for 2 weeks.  To keep within an acceptable few hours, we use a cluster of 30 servers.  But in our task it is impossible to simply divide the input data equally between the servers, provide each server with a complete calculation cycle for its part, and collect the final results.  <a href="http://events.yandex.ru/talks/44/">Our distributed computing platform</a> helps.  It takes on the collection and redistribution of intermediate results, it also automatically transfers tasks from failed servers to working servers and greatly simplifies scaling with an increase in the volume of calculations. <br><br>  But even with parallelization, such volumes, of course, do not fit in the RAM.  Therefore, we use our own Memory Mapped Storage library, which allows an application to work with data on disk as if it were stored in RAM. <br><br>  Usually we duplicate any data processing between several data centers (DC), so that a failure in any of them does not lead to the inaccessibility of the service for the user.  But in preparing the model, we deliberately did not do that.  The quality of the forecast will hardly suffer if you use the yesterday model for a few hours.  But the forecast itself must always be fresh - the situation on the road is constantly changing.  Therefore, it is prepared with triple duplication of calculations in different DCs, completely autonomously from each other.  Even if a failure occurs simultaneously in two DCs, the user will not notice.  The results of the calculation of different replicas are not synchronized with each other, for each request simply takes the most recent of the three forecasts. <br><br>  A new forecast is calculated every 10 minutes.  First, fresh tracks from users are processed: they are tied to the graph, the speed averaging of cars passing by one segment, the forecast is calculated from the model built for the current day.  It takes 1-2 minutes.  Then this data is prepared for drawing traffic jams on the map.  Sharp drops of speed are smoothed;  color is selected for each speed, taking into account the category of roads and the scale of viewing the map.  It takes another 2 minutes. <br><br><h4>  Quality control </h4><br>  Reliable measurement of forecast quality is in itself an interesting task.  After studying several techniques, we chose the following. <br><br>  The quality metric should reflect how much the forecast helps people.  In the absence of a forecast, trying to predict the speed of movement on a road in an hour, we are forced to use current information about traffic jams.  It is clear that within an hour the traffic jams will change and our assessment will be incorrect.  The estimate obtained using the forecast is also not ideal, but it should be closer to reality.  How much closer - we will try to measure it. <br><img src="https://habrastorage.org/getpro/habr/post_images/94a/997/249/94a99724925cba2fa7f311aca6a37860.png" alt="image"><br><br>  Note that you can take different approximations of the actual situation.  The simplest is to rely on custom tracks.  So we got a rating of 15%. <br><br>  However, the data itself may have systematic deviations.  Then our quality metric will prefer the forecast that diligently reproduces these deviations.  To avoid this, we took measurements of assessors - special people who help to measure the quality of service.  They traveled on cars with high-precision GPS-devices on the most significant highways, and brought tracks.  Comparing the forecast with the assessors tracks, we received a different quality rating - 12%. <br><img src="http://habr.habrastorage.org/post_images/afa/19d/045/afa19d045b2bce238895a5f2856f9174.gif"><br><br><h4><a name="FurtherReading"></a>  Recommended literature </h4><br>  Anyone who is seriously interested in the topic of data analysis can recommend the classic textbook <a href="http://www-stat.stanford.edu/~tibs/ElemStatLearn/">The Elements of Statistical Learning (Hastie, T., Tibshirani, R., Friedman, J. - Springer</a> . You can find more detailed information on all the methods of machine learning used in our research. <br><br>  A large number of materials in Russian is on the site <a href="http://www.machinelearning.ru/">MachineLearning.ru</a> . <br><br>  A good tutorial edited by A.V.  Gasnikova <a href="http://crec.mipt.ru/study/courses/optional/gasnikov/Book-arpglktefbb.pdf">, Introduction to Mathematical Modeling of Transport Flows</a> . <br><br>  Experts will be interested in the results of foreign research teams involved in the subject of traffic situation forecasting.  Of the many publications available, we would like to highlight a few: <br><ul><li>  <a href="http://domino.watson.ibm.com/library/cyberdig.nsf/papers/80B6905971EDA9E5852572F900560F2F/%24File/rc24275.pdf">Wanli Min, Laura Wynter, Yasuo Amemiya - Road Traffic Prediction with Spatio-Temporal Correlations</a> .  This IBM Research Department article describing successful experiences with autoregression helped us believe in the solvability of traffic jams prediction. </li><li>  <a href="http://www.cl.cam.ac.uk/techreports/UCAM-CL-TR-676.html">RJ Gibbens, Y. Saacti - Road traffic analysis using MIDAS data route prediction</a> .  The report of the research team of the University of Cambridge contains an experimental comparison of the linear regression method and the method of k nearest neighbors. </li><li>  <a href="http://cts.cs.uic.edu/short_term_freeway.pdf">Weizhong Zheng, Der-Horng Lee and Qixin Shi - Short-Term Freeway Traffic Flow Prediction: Bayesian Combined Neural Network Approach</a> .  In addition to the methods described by us, there are many other approaches to the task of predicting the traffic situation.  For example, this article describes the successful experience of using neural networks. </li><li>  <a href="http://www.waset.org/journals/waset/v51/v51-2.pdf">Yang Zhang, Yuncai Liu - Comparison of Parametric and Nonparametric Techniques for Non-peak Traffic Forecasting</a> .  Here a few more parametric and non-parametric forecasting methods are compared. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/153631/">https://habr.com/ru/post/153631/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../153613/index.html">Seven more HTML5 features you might not know about</a></li>
<li><a href="../153615/index.html">Nokia Plan B (take 2)?</a></li>
<li><a href="../153617/index.html">Optical character recognition in Linux</a></li>
<li><a href="../153619/index.html">MiniSCADA do it yourself</a></li>
<li><a href="../153625/index.html">Configuring Cisco ACS 5.3 in conjunction with Active Directory</a></li>
<li><a href="../153633/index.html">About how I got Java from PDF Flash</a></li>
<li><a href="../153635/index.html">How do you most often read technical literature?</a></li>
<li><a href="../153641/index.html">How I parsed Google Play</a></li>
<li><a href="../153643/index.html">Facebook scans the users' correspondence and automatically links the likes to the links</a></li>
<li><a href="../153647/index.html">A small photo report with CEATEC Japan 2012</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>