<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>C ++ idioms. Static visitor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Visitor pattern offers another way to separate the data processing algorithm from the data itself. In this article, I will briefly describe the id...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>C ++ idioms. Static visitor</h1><div class="post__text post__text-html js-mediator-article">  The Visitor pattern offers another way to separate the data processing algorithm from the data itself.  In this article, I will briefly describe the idea behind the original pattern, its C ++ specific variation and give some simple examples of use. <br><a name="habracut"></a><br><h4>  Visitor </h4><br>  First, let's remember how the classic <i>Visitor works</i> .  The motivation for this pattern is quite simple.  Imagine that in the program we need to process a container (tree, graph) of polymorphic pointers and perform some set of operations for each object, and this set should be different for each specific type.  It is also worth noting that the objects themselves should not know anything about the processing algorithms, except that the handler can ‚Äúvisit‚Äù them. <br>  For example, file system objects: files, folders: <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abstract_file_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">visitor_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; v)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~<span class="hljs-keyword"><span class="hljs-keyword">abstract_file_t</span></span>(){} }; <span class="hljs-comment"><span class="hljs-comment">//////////////////////////////////////////////////////////////////////////// class regular_file_t : public abstract_file_t { public: std::string name() const; void accept(visitor_t&amp; v); size_t size(); }; //////////////////////////////////////////////////////////////////////////// typedef std::vector&lt;abstract_file_t*&gt; file_vector_t; class directory_t : public abstract_file_t { public: void accept(visitor_t&amp; v); std::string name() const; file_vector_t&amp; files(); };</span></span></code> </pre> <br>  As you can see, the knowledge of file system objects about how they will work with them is only that they can be ‚Äú <i>visited</i> ‚Äù by an object with the base type <i>visitor_t</i> .  In the <i>accept</i> function, we simply ‚Äúadmit the visitor‚Äù: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">regular_file_t</span></span>::accept(<span class="hljs-keyword"><span class="hljs-keyword">visitor_t</span></span>&amp; v) {v.visit(*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);}</code> </pre><br>  In the case of a directory, the code can be added to <i>accept</i> to ‚Äúvisit‚Äù all the files in it. <br>  ‚ÄúVisitor‚Äù is arranged as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">visitor_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">regular_file_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; f)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">directory_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; dir)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~<span class="hljs-keyword"><span class="hljs-keyword">visitor_t</span></span>(){} }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">print_info_visitor_t</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">visitor_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">regular_file_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; f)</span></span></span></span>; { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"visiting concrete file. file name: "</span></span> &lt;&lt; f.name() &lt;&lt; <span class="hljs-string"><span class="hljs-string">" file size: "</span></span> &lt;&lt; f.size() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">directory_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; dir)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"visiting directory. directory name: "</span></span> &lt;&lt; dir.name() &lt;&lt; <span class="hljs-string"><span class="hljs-string">". contains "</span></span> &lt;&lt; dir.files().size() &lt;&lt; ‚Äúfiles‚Äù &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } };</code> </pre><br><br><h4>  Static visitor </h4><br>  The essence of <i>Static visitor</i> is also to separate the data from the algorithms for processing this data.  The main difference lies in the fact that the dynamic polymorphism of the classic <i>Visitor</i> 'a is replaced with a static one (hence, the name of the idiom itself).  With one implementation of this pattern, we meet almost every time we use <i>STL</i> algorithms.  Indeed, <i>STL</i> predicates are a great example of a <i>static visitor</i> .  To make this quite obvious, consider the following small example: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">person_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">person_t</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&amp; name, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> age) : name_(name), age_(age){} <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Visitor&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Visitor&amp; v)</span></span></span><span class="hljs-function"> </span></span>{v.visit(*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);} <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> age() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> age_;} <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> name_; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> age_; }; <span class="hljs-comment"><span class="hljs-comment">//////////////////////////////////////////////////////////////////////////////// struct person_visitor_t { person_visitor_t(size_t age_limit) : age_limit_(age_limit){} bool operator()(const person_t&amp; p) {return visit(p);} bool visit(const person_t&amp; p) {return p.age() &lt; age_limit_;} size_t age_limit_; }; //////////////////////////////////////////////////////////////////////////////// int main() { std::vector&lt;person_t&gt; person_vec; person_vec.push_back(person_t("Person 1", 43)); person_vec.push_back(person_t("Person 2", 20)); auto it = std::find_if( person_vec.begin(), person_vec.end(), person_visitor_t(30)); if(it != person_vec.end()) std::cout &lt;&lt; it-&gt;age() &lt;&lt; std::endl; return 0; }</span></span></code> </pre><br>  Very similar to what we saw in the first chapter, isn't it? <br><br><h4>  Examples of using </h4><br><h6>  Boost Graph Library </h6><br>  The idea of ‚Äã‚Äãa predicate can be developed.  Why don't we allow the user to change the behavior of our algorithms at some key points with the help of the ‚Äúvisitor‚Äù provided by the user?  Suppose we are writing a library for working with graphs, consisting of data structures for storing nodes and edges and algorithms for processing these structures ( <i>Boost Graph Library</i> ).  For maximum flexibility, we can provide two options for each algorithm.  One performs the default actions and the other allows the user to influence certain steps of the algorithm.  Simplified it can be represented as: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">node_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">node_t</span></span>(){} <span class="hljs-comment"><span class="hljs-comment">//   accept template&lt;typename V&gt; void on_init(V&amp; v) {v.on_init(t_);} //   accept template&lt;typename V&gt; void on_print(V&amp; v) {v.on_print(t_);} T t_; };</span></span></code> </pre><br>  Algorithms.  One default version and one using Visitor <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Graph&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate_graph</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Graph&amp; g, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Graph, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Visitor&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate_graph</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Graph&amp; g, Visitor&amp; v, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">node_t</span></span>&lt;T&gt; node; node.on_init(v); g.push_back(node); } } <span class="hljs-comment"><span class="hljs-comment">//////////////////////////////////////////////////////////////////////////////// template&lt;typename Graph&gt; void print_graph(Graph&amp; g); template&lt;typename Graph, typename Visitor&gt; void print_graph(Graph&amp; g, Visitor&amp; v) { for(size_t i = 0; i &lt; g.size(); ++i) { g[i].on_print(v); } }</span></span></code> </pre><br>  Now user code. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">person_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> name; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> age; }; <span class="hljs-comment"><span class="hljs-comment">//////////////////////////////////////////////////////////////////////////////// // visitor struct person_visitor_t { // visit() void on_init(person_t&amp; p) { p.name = "unknown"; p.age = 0; } // visit() void on_print(const person_t&amp; p) { std::cout &lt;&lt; p.name &lt;&lt; ", " &lt;&lt; p.age &lt;&lt; std::endl; } }; //////////////////////////////////////////////////////////////////////////////// int main() { person_visitor_t person_visitor; typedef std::vector&lt;node_t&lt;person_t&gt; &gt; person_vec_t; person_vec_t graph; generate_graph&lt;person_t&gt;(graph, person_visitor, 10); print_graph(graph, person_visitor); }</span></span></code> </pre><br><h6>  Variant </h6><br>  Another very interesting example of the use of the idioms <i>static visitor</i> can be found in <i>boost :: variant</i> .  <i>Variant</i> is a statically typed <i>union</i> .  Data of any valid type is stored in the same byte array.  And we ‚Äúvisit‚Äù as a matter of fact always this array stored inside the <i>variant</i> , but ‚Äúlook‚Äù at it every time from the point of view of different types.  This can be implemented somehow (the code is simplified to the maximum and conveys only the main idea): <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T1 = default_param1, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T2 = default_param2, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T3 = default_param3 &gt; class variant { ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-comment"><span class="hljs-comment">//     accept() template&lt;typename Visitor&gt; void apply_visitor(const Visitor&amp; v) { switch(type_tag_) //       { case 1: apply1(v, T1()); break; case 2: apply2(v, T2()); break; case 3: apply3(v, T3()); break; default: break; } } };</span></span></code> </pre><br>  The apply functions may look like this. <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Visitor, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> U&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Visitor&amp; v, U u, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">typename</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::enable_if&lt; !</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::is_same&lt;U, default_param1&gt;::value&gt;::type* = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// data_ -  . //   visit()  operator() v(*(T1*)(&amp;data_[0])); } //     . template&lt;typename Visitor, typename U&gt; void apply1( const Visitor&amp; v, U u, typename std::enable_if&lt; std::is_same&lt;U, default_param1&gt;::value&gt;::type* = 0) { }</span></span></code> </pre><br><br>  Here we use SFINAE to ‚Äúturn on‚Äù the correct function for the current type and ‚Äúturn it off‚Äù for the default class parameters.  The user code is quite simple: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">visitor_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> d)</span></span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; s)</span></span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; }; variant&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt; test_v(<span class="hljs-number"><span class="hljs-number">34</span></span>); test_v.apply_visitor(<span class="hljs-keyword"><span class="hljs-keyword">visitor_t</span></span>());</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/208718/">https://habr.com/ru/post/208718/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../208706/index.html">Transfer of Google Analytics tracks to third-party domains without javascript</a></li>
<li><a href="../208708/index.html">Juniper JNCIE-ENT Network Expert Certification History</a></li>
<li><a href="../208710/index.html">Autoconfiguration with Puppet and AWS Cloud Formation</a></li>
<li><a href="../208714/index.html">CoolRF: DIY-dimmer and LED-lamps, is there a friendship?</a></li>
<li><a href="../208716/index.html">Algorithms and search data structures. Lectures and courses from Yandex</a></li>
<li><a href="../208722/index.html">How to increase the conversion and the average check site search</a></li>
<li><a href="../208726/index.html">We program Raspberry Pi on bare iron</a></li>
<li><a href="../208728/index.html">Smart home based on the controller AMX NI-3100</a></li>
<li><a href="../208730/index.html">Guy arrested for inviting to join Google+</a></li>
<li><a href="../208732/index.html">Installing Atlassian STASH, rake when installing on CentOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>