<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"I will not give a stone" or how the resources of the game "Cursed Earth" are arranged</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Do you remember a lot of Russian games? Qualitative? Memorable? Yes, they were. If you are over 35 or you are a fan of Russian igroproma, then you pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"I will not give a stone" or how the resources of the game "Cursed Earth" are arranged</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/ry/nk/a_/rynka_dqz5ny9nqgs7gawsw4zxy.jpeg"></p><br><p>  Do you remember a lot of Russian games?  Qualitative?  Memorable?  Yes, they were.  If you are over 35 or you are a fan of Russian igroproma, then you probably know the "Cursed Lands". </p><br><p>  The story began very prosaically: summer, heat.  There is nothing special to do, and at a lazy viewing of the contents of the hard disk of the laptop, the gaze caught on the folder with the familiar dragon icon, lying idle for a couple of years. </p><br><p>  What fan of the game will not be interested to know what is inside? </p><a name="habracut"></a><br><h1 id="vvedenie">  Introduction </h1><br><h2 id="informaciya-ob-igre">  Game info </h2><br><p>  <strong>Cursed Lands</strong> - or, as they were called outside the CIS, <strong>Evil Islands: Curse of Lost Soul</strong> , a stealth-RPG game released in 2000.  The development of the game involved the studio Nival Interactive, at that time already proven to be a series of games Allods (Rage of Mages abroad).  Mainly graduates of Moscow State University worked in it - they were quite capable of implementing one of the first games with a fully three-dimensional world. <br>  In 2010, the title went to Mail.Ru ( <a href="http://www1.fips.ru/fips_servl/fips_servlet%3FDB%3DRUTM%26rn%3D1895%26DocNumber%3D208477">information</a> ), but the game is still being sold at the GOG store on behalf of Nival. </p><br><p>  Relatively recently, the game turned 18 years old - October 26 is considered a birthday, the release date in the CIS.  Despite his age, the official master server is still in service: from time to time someone decides to crawl through the forests of Gipat and knock a dozen or two skeletons with a squad of comrades. </p><br><h2 id="korotko-o-state">  Short article </h2><br><p>  Initially, my goal was only to write a one-way converter "for myself" in Python 3, and using only standard libraries.  However, the process began smoothly writing documentation on formats, attempts to somehow standardize the output.  For some of the formats, the structure was described using <a href="http://kaitai.io/">Kaitai Struct</a> .  As a result, everything resulted in the writing of this article and the wiki by formats. </p><br><p>  Immediately, I note: for the most part, the game files have already been investigated, fan editors have been written to them.  However, the information is extremely fragmented, but there is no more or less holistic description of the formats in the public domain, as well as an adequate set for creating modifications. </p><br><h2 id="i-o-tom-kak-eyo-chitat">  ... and how to read it </h2><br><p>  For all formats, diagrams are provided (.ksy files) that can be converted into code in several of the most popular languages ‚Äã‚Äãin two clicks. </p><br><p>  Unfortunately, already at the last stages of writing this article, I discovered that the highly respected Habr does not know how to highlight YAML (and JSON), and all the schemes use it.  This should not be a big problem, but if it is inconvenient to read the scheme, I can advise you to copy it into a third-party editor, for example, NPP. </p><br><h1 id="resursy-i-gde-oni-obitayut">  Resources and where they live </h1><br><p>  The game is a portable application containing the engine with libraries, launcher and, in fact, packaged resources. </p><br><blockquote>  <strong>This is interesting:</strong> the game settings are almost entirely stored in the registry.  The bug of the camera in the GOG version is due to the fact that the installer does not prescribe the correct default values. </blockquote><p>  When you first look at the contents of the game folder, we immediately notice a couple of new file extensions: ASI and REG. <br>  The first is a dynamic library, which we will not consider (this is done by reverse engineering specialists), but the second is the first native file format of the game. </p><br><h2 id="reg">  REG </h2><br><p>  Files of this type are binary serialization of well-known text INI files. <br>  The content is divided into sections that store the keys and their values.  The REG file retains this hierarchy, but speeds up reading and parsing data - in 2000, this was apparently critical. </p><br><p>  In general terms, you can describe the structure of this diagram: <br><img src="https://habrastorage.org/webt/yh/se/fo/yhsefo2h5nxp0ghwse2zla8cmv0.png"></p><br><div class="spoiler">  <b class="spoiler_title">Structure description</b> <div class="spoiler_text"><pre><code class="plaintext hljs">meta: id: reg title: Evil Islands, REG file (packed INI) application: Evil Islands file-extension: reg license: MIT endian: le doc: Packed INI file seq: - id: magic contents: [0xFB, 0x3E, 0xAB, 0x45] doc: Magic bytes - id: sections_count type: u2 doc: Number of sections - id: sections_offsets type: section_offset doc: Sections offset table repeat: expr repeat-expr: sections_count types: section_offset: doc: Section position in file seq: - id: order type: s2 doc: Section order number - id: offset type: u4 doc: Global offset of section in file instances: section: pos: offset type: section types: section: doc: Section representation seq: - id: keys_count type: u2 doc: Number of keys in section - id: name_len type: u2 doc: Section name lenght - id: name type: str encoding: cp1251 size: name_len doc: Section name - id: keys type: key doc: Section's keys repeat: expr repeat-expr: keys_count types: key: doc: Named key seq: - id: order type: s2 doc: Key order in section - id: offset type: u4 doc: Key offset in section instances: key_record: pos: _parent._parent.offset + offset type: key_data key_data: seq: - id: packed_type type: u1 doc: Key value info - id: name_len type: u2 doc: Key name lenght - id: name type: str encoding: cp1251 size: name_len doc: Key name - id: value type: value doc: Key value instances: is_array: value: packed_type &gt; 127 doc: Is this key contain array value_type: value: packed_type &amp; 0x7F doc: Key value type types: value: doc: Key value seq: - id: array_size type: u2 if: _parent.is_array doc: Value array size - id: data type: switch-on: _parent.value_type cases: 0: s4 1: f4 2: string repeat: expr repeat-expr: '_parent.is_array ? array_size : 1' doc: Key value data string: doc: Sized string seq: - id: len type: u2 doc: String lenght - id: value type: str encoding: cp1251 size: len doc: String</code> </pre> </div></div><br><blockquote>  <strong>This is interesting:</strong> in 2002, Nival shared some tools with the game community ( <a href="http://www.nival.ru:80/rus/evil_files.html">snapshot of the site</a> ) - one of them was the INI serializer in REG.  As you might guess, the deserializer appeared almost immediately, even if not official. </blockquote><p>  With the starting folder sorted out, move on to the subdirectories. <br>  The first glance falls on the Cameras folder containing the CAM files. </p><br><h2 id="cam">  Cam </h2><br><p>  A very simple format - just pack the camera positions in time.  The camera is described by position and rotation.  The other two fields are presumably time and step in the sequence of movements. </p><br><p><img src="https://habrastorage.org/webt/cu/8u/bj/cu8ubjrcz2pode-v3lydliwrvsq.png"></p><br><div class="spoiler">  <b class="spoiler_title">Structure description</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: cam title: Evil Islands, CAM file (cameras) application: Evil Islands file-extension: cam license: MIT endian: le doc: Camera representation seq: - id: cams type: camera repeat: eos types: vec3: doc: 3d vector seq: - id: x type: f4 doc: x axis - id: y type: f4 doc: y axis - id: z type: f4 doc: z axis quat: doc: quaternion seq: - id: w type: f4 doc: w component - id: x type: f4 doc: x component - id: y type: f4 doc: y component - id: z type: f4 doc: z component camera: doc: Camera parameters seq: - id: unkn0 type: u4 doc: unknown - id: unkn1 type: u4 doc: unknown - id: position type: vec3 doc: camera's position - id: rotation type: quat doc: camera's rotation</code> </pre> </div></div><br><p>  In the next folder - Res, res (unexpectedly!) Res files that are archives are stored. </p><br><h2 id="res">  Res </h2><br><p>  This format is sometimes hidden under other extensions, but the original is still RES. <br>  The data structure is quite typical for an archive with random access to files: there are tables for storing information about files inside, a table of names, the very contents of files. <br>  The directory structure is contained directly in the names. </p><br><p>  It is worth noting two extremely interesting facts: </p><br><ol><li>  The archive is optimized for downloading file information to a linked list with private hashing. </li><li>  You can store the contents of a file once, but refer to it under different names.  As far as I know, this fact was used in the fan repack, where due to this the size of the game was greatly reduced.  Archive optimization was not used in the original distribution. </li></ol><br><p><img src="https://habrastorage.org/webt/_9/ie/8_/_9ie8_m0lc_b1n0ddnagkue514g.png"></p><br><div class="spoiler">  <b class="spoiler_title">Structure description</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: res title: Evil Islands, RES file (resources archive) application: Evil Islands file-extension: res license: MIT endian: le doc: Resources archive seq: - id: magic contents: [0x3C, 0xE2, 0x9C, 0x01] doc: Magic bytes - id: files_count type: u4 doc: Number of files in archive - id: filetable_offset type: u4 doc: Filetable offset - id: nametable_size type: u4 doc: Size of filenames instances: nametable_offset: value: filetable_offset + 22 * files_count doc: Offset of filenames table filetable: pos: filetable_offset type: file_record repeat: expr repeat-expr: files_count doc: Files metadata table types: file_record: doc: File metadata seq: - id: next_index type: s4 doc: Next file index - id: file_size type: u4 doc: Size of file in bytes - id: file_offset type: u4 doc: File data offset - id: last_change type: u4 doc: Unix timestamp of last change time - id: name_len type: u2 doc: Lenght of filename - id: name_offset type: u4 doc: Filename offset in name array instances: name: io: _root._io pos: name_offset + _parent.nametable_offset type: str encoding: cp1251 size: name_len doc: File name data: io: _root._io pos: file_offset size: file_size doc: Content of file</code> </pre> </div></div><br><blockquote>  <strong>This is interesting:</strong> in the Russian version of the game, the Speech.res archive contains two subdirectories s and t with completely identical content, which is why the archive size is twice as large - that is why the game does not fit on one CD. </blockquote><p>  Now you can unpack all archives (can be nested): </p><br><ul><li>  RES is just an archive </li><li>  MPR - landscape of game levels, </li><li>  MQ - information about tasks multiplayer, </li><li>  ANM - a set of animations </li><li>  MOD - 3d model, </li><li>  BON - the location of the bones of the model. </li></ul><br><p>  If the files inside the archive do not have the extension, we will put the extension of the parent - concerns BON and ANM archives. </p><br><p>  You can also split all the resulting files into four groups: </p><br><ol><li>  Textures; </li><li>  Database; </li><li>  Models; </li><li>  Level files </li></ol><br><p>  Let's start with a simple - with textures. </p><br><h2 id="mmp">  Mmp </h2><br><p>  Actually, the texture.  It has a small header indicating the image parameters, the number of MIP levels and compression used.  After the header, MIP image levels are arranged in descending order of size. </p><br><p><img src="https://habrastorage.org/webt/a7/1s/-r/a71s-rtar5cg6ipi53n86bbsxps.png"></p><br><div class="spoiler">  <b class="spoiler_title">Structure description</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: mmp title: Evil Islands, MMP file (texture) application: Evil Islands file-extension: mmp license: MIT endian: le doc: MIP-mapping texture seq: - id: magic contents: [0x4D, 0x4D, 0x50, 0x00] doc: Magic bytes - id: width type: u4 doc: Texture width - id: height type: u4 doc: Texture height - id: mip_levels_count type: u4 doc: Number of MIP-mapping stored levels - id: fourcc type: u4 enum: pixel_formats doc: FourCC label of pixel format - id: bits_per_pixel type: u4 doc: Number of bits per pixel - id: alpha_format type: channel_format doc: Description of alpha bits - id: red_format type: channel_format doc: Description of red bits - id: green_format type: channel_format doc: Description of green bits - id: blue_format type: channel_format doc: Description of blue bits - id: unused size: 4 doc: Empty space - id: base_texture type: switch-on: fourcc cases: 'pixel_formats::argb4': block_custom 'pixel_formats::dxt1': block_dxt1 'pixel_formats::dxt3': block_dxt3 'pixel_formats::pnt3': block_pnt3 'pixel_formats::r5g6b5': block_custom 'pixel_formats::a1r5g5b5': block_custom 'pixel_formats::argb8': block_custom _: block_custom types: block_pnt3: seq: - id: raw size: _root.bits_per_pixel block_dxt1: seq: - id: raw size: _root.width * _root.height &gt;&gt; 1 block_dxt3: seq: - id: raw size: _root.width * _root.height block_custom: seq: - id: lines type: line_custom repeat: expr repeat-expr: _root.height types: line_custom: seq: - id: pixels type: pixel_custom repeat: expr repeat-expr: _root.width types: pixel_custom: seq: - id: raw type: switch-on: _root.bits_per_pixel cases: 8: u1 16: u2 32: u4 instances: alpha: value: '_root.alpha_format.count == 0 ? 255 : 255 * ((raw &amp; _root.alpha_format.mask) &gt;&gt; _root.alpha_format.shift) / (_root.alpha_format.mask &gt;&gt; _root.alpha_format.shift)' red: value: '255 * ((raw &amp; _root.red_format.mask) &gt;&gt; _root.red_format.shift) / (_root.red_format.mask &gt;&gt; _root.red_format.shift)' green: value: '255 * ((raw &amp; _root.green_format.mask) &gt;&gt; _root.green_format.shift) / (_root.green_format.mask &gt;&gt; _root.green_format.shift)' blue: value: '255 * ((raw &amp; _root.blue_format.mask) &gt;&gt; _root.blue_format.shift) / (_root.blue_format.mask &gt;&gt; _root.blue_format.shift)' channel_format: doc: Description of bits for color channel seq: - id: mask type: u4 doc: Binary mask for channel bits - id: shift type: u4 doc: Binary shift for channel bits - id: count type: u4 doc: Count of channel bits enums: pixel_formats: 0x00004444: argb4 0x31545844: dxt1 0x33545844: dxt3 0x33544E50: pnt3 0x00005650: r5g6b5 0x00005551: a1r5g5b5 0x00008888: argb8</code> </pre> </div></div><br><p>  Possible pixel packing formats: </p><br><table><thead><tr><th>  fourcc </th><th>  Description </th></tr></thead><tbody><tr><td>  44 44 00 00 </td><td>  ARGB4 </td></tr><tr><td>  44 58 54 31 </td><td>  DXT1 </td></tr><tr><td>  44 58 54 33 </td><td>  DXT3 </td></tr><tr><td>  50 4E 54 33 </td><td>  PNT3 - RLE compressed ARGB8 </td></tr><tr><td>  50 56 00 00 </td><td>  R5G5B5 </td></tr><tr><td>  51 55 00 00 </td><td>  A1R5G5B5 </td></tr><tr><td>  88 88 00 00 </td><td>  ARGB8 </td></tr></tbody></table><br><div class="spoiler">  <b class="spoiler_title">About PNT3</b> <div class="spoiler_text"><p>  If the image format is <strong>PNT3</strong> , then the pixel structure after decompression is ARGB8;  <code>bits_per_pixel</code> - the size of the compressed image in bytes. </p><br><h4 id="raspakovka-pnt3">  Unpacking PNT3 </h4><br><pre> <code class="python hljs">n = <span class="hljs-number"><span class="hljs-number">0</span></span> destination = <span class="hljs-string"><span class="hljs-string">b""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> src &lt; size: v = int.from_bytes(source[src:src + <span class="hljs-number"><span class="hljs-number">4</span></span>], byteorder=<span class="hljs-string"><span class="hljs-string">'little'</span></span>) src += <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> v &gt; <span class="hljs-number"><span class="hljs-number">1000000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> v == <span class="hljs-number"><span class="hljs-number">0</span></span>: n += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: destination += source[src - (<span class="hljs-number"><span class="hljs-number">1</span></span> + n) * <span class="hljs-number"><span class="hljs-number">4</span></span>:src - <span class="hljs-number"><span class="hljs-number">4</span></span>] destination += <span class="hljs-string"><span class="hljs-string">b"\x00"</span></span> * v n = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> </div></div><br><blockquote>  <strong>This is interesting:</strong> some of the textures are reflected vertically (or some are not reflected?). <br>  And the game is very jealous of transparency - if the image is with an alpha channel, the color of transparent pixels must be exactly black.  Or white - then how lucky. </blockquote><p>  Simple formats have ended, we are moving to tougher ones - in due time, the rows of mod-makers fiercely kept their own editing tools of the following formats, and for good reason.  I warned you. </p><br><h2 id="bazy-dannyh-db-i-izhe-s-nimi">  Databases (* DB and their ilk) </h2><br><p>  This format is extremely inconvenient to describe - in essence, this is a serialized node tree (or tables of records).  The file consists of several tables with specified field types.  General structure: the tables are nested in the common root node, the records are the nodes inside the table. </p><br><p>  Each node defines its type and size: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> type_index; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> raw_size; <span class="hljs-comment"><span class="hljs-comment">//      unsigned length; //     read(raw_size); if (raw_size &amp; 1) { length = raw_size &gt;&gt; 1; for (int i = 0; i &lt; 3; i++) length &lt;&lt;= 8; read(raw_size); length += raw_size; } else length = raw_size &gt;&gt; 1;</span></span></code> </pre> <br><p>  The type of the field of the table is taken by the index from the format string for the table, the resulting type is determined by the actual type. </p><br><div class="spoiler">  <b class="spoiler_title">Field types</b> <div class="spoiler_text"><table><thead><tr><th>  designation </th><th>  description </th></tr></thead><tbody><tr><td>  S </td><td>  string </td></tr><tr><td>  I </td><td>  4b int </td></tr><tr><td>  U </td><td>  4b unsigned </td></tr><tr><td>  F </td><td>  4b float </td></tr><tr><td>  X </td><td>  bits byte </td></tr><tr><td>  f </td><td>  float array </td></tr><tr><td>  i </td><td>  int array </td></tr><tr><td>  B </td><td>  bool </td></tr><tr><td>  b </td><td>  bool array </td></tr><tr><td>  H </td><td>  unknown hex bytes </td></tr><tr><td>  T </td><td>  time </td></tr><tr><td>  0 </td><td>  not stated </td></tr><tr><td>  one </td><td> <code>0FII</code> </td> </tr><tr><td>  2 </td><td> <code>SUFF</code> </td> </tr><tr><td>  3 </td><td> <code>FFFF</code> </td> </tr><tr><td>  four </td><td> <code>0SISS</code> </td> </tr><tr><td>  five </td><td> <code>0SISS00000U</code> </td> </tr></tbody></table></div></div><br><div class="spoiler">  <b class="spoiler_title">Database description</b> <div class="spoiler_text"><h4 id="predmety-idb">  Items (.idb) </h4><br><table><thead><tr><th>  table </th><th>  structure </th></tr></thead><tbody><tr><td>  Materials </td><td> <code>SSSIFFFIFIFfIX</code> </td> </tr><tr><td>  Weapons </td><td> <code>SSISIIIFFFFIFIXB00000IHFFFfHHFF</code> </td> </tr><tr><td>  Armor </td><td> <code>SSISIIIFFFFIFIXB00000ffBiHH</code> </td> </tr><tr><td>  Quick items </td><td> <code>SSISIIIFFFFIFIXB00000IIFFSbH</code> </td> </tr><tr><td>  Quest items </td><td> <code>SSISIIIFFFFIFIXB00000Is</code> </td> </tr><tr><td>  Sold items </td><td> <code>SSISIIIFFFFIFIXB00000IHI</code> </td> </tr></tbody></table><br><h4 id="pereklyuchateli-ldb">  Switches (.ldb) </h4><br><table><thead><tr><th>  table </th><th>  structure </th></tr></thead><tbody><tr><td>  Switch prototype </td><td> <code>SfIFTSSS</code> </td> </tr></tbody></table><br><h4 id="umeniya-i-navyki-pdb">  Skills (.pdb) </h4><br><table><thead><tr><th>  table </th><th>  structure </th></tr></thead><tbody><tr><td>  Skills </td><td> <code>SSI0000000s</code> </td> </tr><tr><td>  Skills </td><td> <code>SSI0000000SSIIIFFFIIIIBI</code> </td> </tr></tbody></table><br><h4 id="sledy-printsdb">  Footprints (prints.db) </h4><br><table><thead><tr><th>  table </th><th>  structure </th></tr></thead><tbody><tr><td>  Traces of blood </td><td> <code>0S11</code> </td> </tr><tr><td>  Traces of flame </td><td> <code>0S110000001</code> </td> </tr><tr><td>  Footprints </td><td> <code>0S11</code> </td> </tr></tbody></table><br><h4 id="zaklinaniya-sdb">  Spells (.sdb) </h4><br><table><thead><tr><th>  table </th><th>  structure </th></tr></thead><tbody><tr><td>  Prototypes </td><td> <code>SSSFIFIFFFFIIIIUSSIIbIXFFFFF</code> </td> </tr><tr><td>  Modifiers </td><td> <code>SSFIFFISX</code> </td> </tr><tr><td>  Templates </td><td> <code>0SssSX</code> </td> </tr><tr><td>  Armor Templates </td><td> <code>0SssSX</code> </td> </tr><tr><td>  Weapons templates </td><td> <code>0SssSX</code> </td> </tr></tbody></table><br><h4 id="suschestva-udb">  Creatures (.udb) </h4><br><table><thead><tr><th>  table </th><th>  structure </th></tr></thead><tbody><tr><td>  Damaged parts </td><td> <code>SffUU</code> </td> </tr><tr><td>  Races </td><td> <code>SUFFUUFfFUUf222222000000000000SssFSsfUUfUUIUSBFUUUU</code> </td> </tr><tr><td>  Monster Prototypes </td><td> <code>SSIUIFFFSFFFFFFFFFUFFFFFFff33sfssSFFFFFUFUSF</code> </td> </tr><tr><td>  NPC </td><td> <code>SUFFFFbbssssFUB</code> </td> </tr></tbody></table><br><h4 id="vykriki-acksdb">  Shouts (acks.db) </h4><br><table><thead><tr><th>  table </th><th>  structure </th></tr></thead><tbody><tr><td>  Answers </td><td> <code>0S0000000044444444444444444444445444444444444</code> </td> </tr><tr><td>  Screams </td><td> <code>0S0000000044444</code> </td> </tr><tr><td>  Other </td><td> <code>0S0000000044</code> </td> </tr></tbody></table><br><h4 id="zadaniya-qdb">  Tasks (.qdb) </h4><br><table><thead><tr><th>  table </th><th>  structure </th></tr></thead><tbody><tr><td>  Tasks </td><td> <code>SFIISIIs</code> </td> </tr><tr><td>  Briefings </td><td> <code>SFFsSsssssI</code> </td> </tr></tbody></table></div></div><br><blockquote>  <strong>This is interesting:</strong> 01/16/2002 Nival laid out the original bases for multiplayer in csv format, as well as a utility converter into the game format ( <a href="http://www.nival.ru:80/rus/evil_files.html">snapshot of the site</a> ).  Naturally, the reverse converter was not slow to appear.  There are also at least two documents describing the fields and their types from modmeykerov, but it is very difficult to read them. </blockquote><br><h2 id="adb">  Adb </h2><br><p>  Database animation for a specific type of units.  In contrast to the above mentioned * DB, it is rather "human" - this is a single-level table with static field sizes. </p><br><p><img src="https://habrastorage.org/webt/vm/f4/jr/vmf4jr_3jtmqytycobxvurk7v2c.png"></p><br><div class="spoiler">  <b class="spoiler_title">Structure description</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: adb title: Evil Islands, ADB file (animations database) application: Evil Islands file-extension: adb license: MIT endian: le doc: Animations database seq: - id: magic contents: [0x41, 0x44, 0x42, 0x00] doc: Magic bytes - id: animations_count type: u4 doc: Number of animations in base - id: unit_name type: str encoding: cp1251 size: 24 doc: Name of unit - id: min_height type: f4 doc: Minimal height of unit - id: mid_height type: f4 doc: Middle height of unit - id: max_height type: f4 doc: Maximal height of unit - id: animations type: animation doc: Array of animations repeat: expr repeat-expr: animations_count types: animation: doc: Animation's parameters seq: - id: name type: str encoding: cp1251 size: 16 doc: Animation's name - id: number type: u4 doc: Index in animations array - id: additionals type: additional doc: Packed structure with animation parameters - id: action_probability type: u4 doc: Percents of action probability - id: animation_length type: u4 doc: Lenght of animation in game ticks - id: movement_speed type: f4 doc: Movement speed - id: start_show_hide1 type: u4 - id: start_show_hide2 type: u4 - id: start_step_sound1 type: u4 - id: start_step_sound2 type: u4 - id: start_step_sound3 type: u4 - id: start_step_sound4 type: u4 - id: start_hit_frame type: u4 - id: start_special_sound type: u4 - id: spec_sound_id1 type: u4 - id: spec_sound_id2 type: u4 - id: spec_sound_id3 type: u4 - id: spec_sound_id4 type: u4 types: additional: seq: - id: packed type: u8 instances: weapons: value: 'packed &amp; 127' allowed_states: value: '(packed &gt;&gt; 15) &amp; 7' action_type: value: '(packed &gt;&gt; 18) &amp; 15' action_modifyer: value: '(packed &gt;&gt; 22) &amp; 255' animation_stage: value: '(packed &gt;&gt; 30) &amp; 3' action_forms: value: '(packed &gt;&gt; 36) &amp; 63'</code> </pre> </div></div><br><blockquote>  <strong>This is interesting:</strong> for several units, a partially trimmed base format is used, which is practically unexplored. </blockquote><p>  Having dealt with databases, we announce an advertising pause.  But we will not advertise anything - not our method.  It is better to denote what comes next - as creature files are named. </p><br><h2 id="format-imyon-modeley">  Model Name Format </h2><br><p>  The name is collected from groups of two characters - abbreviations of the logical "level". <br>  For example, the character-woman will be <code>unhufe</code> - <code>Unit &gt; Human &gt; Female</code> , and <code>initwesp</code> - <code>Inventory &gt; Item &gt; Weapon &gt; Spear</code> , that is, a spear in the inventory (not your back, and that is good). </p><br><div class="spoiler">  <b class="spoiler_title">Full name element tree:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">un: # unit an: # animal wi: # wild ti # tiger ba # bat bo # boar hy # hyen de # deer gi # rat ra # rat cr # crawler wo # wolf ho: # home co # cow pi # pig do # dog ho # horse ha # hare or: # orc fe # female ma # male mo: # monster co # column (menu) un # unicorn cu # Curse be # beholder tr # troll el # elemental su # succub (harpie) ba # banshee dr # driad sh # shadow li # lizard sk # skeleton sp # spider go # golem, goblin ri # Rick og # ogre zo # zombie bi # Rik's dragon cy # cyclope dg # dragon wi # willwisp mi # octopus to # toad hu: # human fe # female ma # male in: # inventory it: # item qu # quest qi # interactive ar: # armor pl # plate gl # gloves lg # leggins bt # boots sh # shirt hl # helm pt # pants li: # loot mt # material tr # trade we: # weapon hm # hammer dg # dagger sp # spear cb # crossbow sw # sword ax # axe bw # bow gm # game menu fa: # faces un: # unit an: # animal wi: # wild ti: # tiger face # face ba: # bat face # face bo: # boar face # face de: # deer face # face ra: # rat face # face cr: # crawler face # face wo: # wolf face # face ho: # home co: # cow face # face pi: # pig face # face do: # dog face # face ho: # horse face # face ha: # hare face # face hu: # human fe: # female fa # me # th # ma: # male fa # me # th # mo: # monster to: # toad face # face tr: # troll face # face or: # orc face # face sp: # spider face # face li: # lizard face # face na: # nature fl: # flora bu # bush te # termitary tr # tree li # waterplant wa # waterfall sk # sky st # stone ef: # effects cu # ar # co # components st: # static si # switch bu: # building to # tower ho # house tr # trap br # bridge ga # gate we # well (waterhole) wa: # wall me # medium li # light to # torch st # static</code> </pre> </div></div><br><blockquote>  <strong>This is interesting:</strong> according to this classification, mushrooms are trees, golems with goblins are brothers, and Tka-Rik is a monster.  Also here you can see the "working" names of monsters, suspiciously similar to those of D &amp; D - beholder (evil eye), succub (harpy), ogre (ogre), driad (foresters). </blockquote><p>  Morally having a rest, we will plunge headlong into the model.  They are presented in several formats that are linked together. </p><br><h2 id="lnk">  Lnk </h2><br><p>  Logically - the basis of the model.  Describes the hierarchy of parts of a model, in terms of modern 3d modeling, a hierarchy of bones. </p><br><p><img src="https://habrastorage.org/webt/we/va/a1/wevaa186p5bq4fvw8-4vtxbfiju.png"></p><br><div class="spoiler">  <b class="spoiler_title">Structure description</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: lnk title: Evil Islands, LNK file (bones hierarchy) application: Evil Islands file-extension: lnk license: MIT endian: le doc: Bones hierarchy seq: - id: bones_count type: u4 doc: Number of bones - id: bones_array type: bone repeat: expr repeat-expr: bones_count doc: Array of bones types: bone: doc: Bone node seq: - id: bone_name_len type: u4 doc: Length of bone's name - id: bone_name type: str encoding: cp1251 size: bone_name_len doc: Bone's name - id: parent_name_len type: u4 doc: Length of bone's parent name - id: parent_name type: str encoding: cp1251 size: parent_name_len doc: Bone's parent name</code> </pre> </div></div><br><p>  The parent name of the main bone is an empty string (length 0). </p><br><p>  There are bones, but it is not enough to name them and put them in a pile - you need to assemble them into a skeleton. </p><br><h2 id="bon">  Bon </h2><br><p>  The previously mentioned, this format (if it is not an archive) specifies the position of the parts (bones) of the model relative to the parent part.  Only offset is stored, without rotation - one of the differences from the modern formats. </p><br><p><img src="https://habrastorage.org/webt/rq/f0/nt/rqf0ntdd5sxadr0us5gfq5cfq2g.png"></p><br><div class="spoiler">  <b class="spoiler_title">Structure description</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: bon title: Evil Islands, BON file (bone position) application: Evil Islands file-extension: bon license: MIT endian: le doc: Bone position seq: - id: position type: vec3 doc: Bone translation repeat: eos types: vec3: doc: 3d vector seq: - id: x type: f4 doc: x axis - id: y type: f4 doc: y axis - id: z type: f4 doc: z axis</code> </pre> </div></div><br><p>  As you can see, there are too many numbers for one offset - the fact is that here we first stumbled upon one of the key pieces of the game engine - trilinear interpolation of models. </p><br><p>  How it works: the model has three interpolation parameters - conditionally, strength, agility, growth.  There are also 8 extreme states of the model.  Using parameters, we can get the final model by trilinear interpolation. </p><br><div class="spoiler">  <b class="spoiler_title">Directly, the algorithm</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trilinear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(val, coefs=[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Linear interpolation by str t1 = val[0] + (val[1] - val[0]) * coefs[1] t2 = val[2] + (val[3] - val[2]) * coefs[1] # Bilinear interpolation by dex v1 = t1 + (t2 - t1) * coefs[0] # Linear interpolation by str t1 = val[4] + (val[5] - val[4]) * coefs[1] t2 = val[6] + (val[7] - val[6]) * coefs[1] # Bilinear interpolation by dex v2 = t1 + (t2 - t1) * coefs[0] # Trilinear interpolation by height return v1 + (v2 - v1) * coefs[2]</span></span></code> </pre> </div></div><br><blockquote>  <strong>This is interesting: the</strong> trilinear interpolation of the model is used to animate some objects, for example, opening a stone door and chests. </blockquote><p>  Now is the time to look at the parts of the model. </p><br><h2 id="fig">  FIG </h2><br><p>  Perhaps this format is impossible to understand the meeting.  You can find its description and plug-in for the blender on the web, but even with them, awareness does not come immediately.  Take a look: </p><br><p><img src="https://habrastorage.org/webt/c_/yx/bu/c_yxbuglpgn1h0j2g48gc1lk1dw.png"></p><br><div class="spoiler">  <b class="spoiler_title">Structure description</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: fig title: Evil Islands, FIG file (figure) application: Evil Islands file-extension: fig license: MIT endian: le doc: 3d mesh seq: - id: magic contents: [0x46, 0x49, 0x47, 0x38] doc: Magic bytes - id: vertex_count type: u4 doc: Number of vertices blocks - id: normal_count type: u4 doc: Number of normals blocks - id: texcoord_count type: u4 doc: Number of UV pairs - id: index_count type: u4 doc: Number of indeces - id: vertex_components_count type: u4 doc: Number of vertex components - id: morph_components_count type: u4 doc: Number of morphing components - id: unknown contents: [0, 0, 0, 0] doc: Unknown (aligment) - id: group type: u4 doc: Render group - id: texture_index type: u4 doc: Texture offset - id: center type: vec3 doc: Center of mesh repeat: expr repeat-expr: 8 - id: aabb_min type: vec3 doc: AABB point of mesh repeat: expr repeat-expr: 8 - id: aabb_max type: vec3 doc: AABB point of mesh repeat: expr repeat-expr: 8 - id: radius type: f4 doc: Radius of boundings repeat: expr repeat-expr: 8 - id: vertex_array type: vertex_block doc: Blocks of raw vertex data repeat: expr repeat-expr: 8 - id: normal_array type: vec4x4 doc: Packed normal data repeat: expr repeat-expr: normal_count - id: texcoord_array type: vec2 doc: Texture coordinates data repeat: expr repeat-expr: texcoord_count - id: index_array type: u2 doc: Triangles indeces repeat: expr repeat-expr: index_count - id: vertex_components_array type: vertex_component doc: Vertex components array repeat: expr repeat-expr: vertex_components_count - id: morph_components_array type: morph_component doc: Morphing components array repeat: expr repeat-expr: morph_components_count types: morph_component: doc: Morphing components indeces seq: - id: morph_index type: u2 doc: Index of morphing data - id: vertex_index type: u2 doc: Index of vertex vertex_component: doc: Vertex components indeces seq: - id: position_index type: u2 doc: Index of position data - id: normal_index type: u2 doc: Index of normal data - id: texture_index type: u2 doc: Index of texcoord data vec2: doc: 2d vector seq: - id: u type: f4 doc: u axis - id: v type: f4 doc: v axis vec3: doc: 3d vector seq: - id: x type: f4 doc: x axis - id: y type: f4 doc: y axis - id: z type: f4 doc: z axis vec3x4: doc: 3d vector with 4 values per axis seq: - id: x type: f4 doc: x axis repeat: expr repeat-expr: 4 - id: y type: f4 doc: y axis repeat: expr repeat-expr: 4 - id: z type: f4 doc: z axis repeat: expr repeat-expr: 4 vertex_block: doc: Vertex raw block seq: - id: block type: vec3x4 doc: Vertex data repeat: expr repeat-expr: _root.vertex_count vec4x4: doc: 4d vector with 4 values per axis seq: - id: x type: f4 doc: x axis repeat: expr repeat-expr: 4 - id: y type: f4 doc: y axis repeat: expr repeat-expr: 4 - id: z type: f4 doc: z axis repeat: expr repeat-expr: 4 - id: w type: f4 doc: w axis repeat: expr repeat-expr: 4</code> </pre> </div></div><br><p>  What is the difficulty?  So, the data of normals and vertices are stored in blocks of 4, and the vertices are also arranged in 8 blocks for interpolation. </p><br><blockquote>  <strong>This is interesting:</strong> presumably, such a grouping was done to speed up processing using SSE instructions that have appeared in Intel processors since 1999. </blockquote><p>  Well, we read the model and compiled it, but something is missing.  Exactly - animation! </p><br><h2 id="anm">  ANM </h2><br><p>  Animation is stored as key states componentwise.  An interesting fact is that support is provided not only for skeletal animation, but also for all-round morphing. </p><br><p><img src="https://habrastorage.org/webt/i_/yb/lr/i_yblr5zy2irqqer1jqi6tm8v_c.png"></p><br><div class="spoiler">  <b class="spoiler_title">Structure description</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: anm title: Evil Islands, ANM file (bone animation) application: Evil Islands file-extension: anm license: MIT endian: le doc: Bone animation seq: - id: rotation_frames_count type: u4 doc: Number of rotation frames - id: rotation_frames type: quat repeat: expr repeat-expr: rotation_frames_count doc: Bone rotations - id: translation_frames_count type: u4 doc: Number of translation frames - id: translation_frames type: vec3 repeat: expr repeat-expr: translation_frames_count doc: Bone translation - id: morphing_frames_count type: u4 doc: Number of morphing frames - id: morphing_vertex_count type: u4 doc: Number of vertices with morphing - id: morphing_frames type: morphing_frame repeat: expr repeat-expr: morphing_frames_count doc: Array of morphing frames types: vec3: doc: 3d vector seq: - id: x type: f4 doc: x axis - id: y type: f4 doc: y axis - id: z type: f4 doc: z axis quat: doc: quaternion seq: - id: w type: f4 doc: w component - id: x type: f4 doc: x component - id: y type: f4 doc: y component - id: z type: f4 doc: z component morphing_frame: doc: Array of verteces morphing seq: - id: vertex_shift type: vec3 repeat: expr repeat-expr: _parent.morphing_vertex_count doc: Morphing shift per vertex</code> </pre> </div></div><br><p>  All - now we have a full-fledged model, you can admire a freshly rendered hermit reptile: </p><br><p><img src="https://habrastorage.org/webt/bu/tk/sm/butksmbjbom_kgib93drtz9xvj8.jpeg"></p><br><div class="spoiler">  <b class="spoiler_title">Moment of nostalgia</b> <div class="spoiler_text"><h4 id="uznat-chto-nuzhno-yascheru">  Find out what Lizard needs </h4><br><p>  <em>Conversation with a raptor in his home</em> </p><br><p>  <strong>Hermit Lizard:</strong> You came, man.  It's good. </p><br><p>  <strong>Zack:</strong> Is that all you wanted to tell me? </p><br><p>  <strong>Hermit Lizard:</strong> You're in a hurry again.  I remember your questions and I will answer them.  I came to the people in the gland to make a deal.  But I saw what they did to you.  They do not hold the words, I stopped believing them.  You kept your word.  A deal will be offered to you. </p><br><p>  <strong>Hermit Lizard:</strong> People love gold.  Gold lizards uninteresting.  You will complete my task, and I will give you the gold that I have.  This is a lot of gold. </p><br><p>  <strong>Zack <em>(thoughtfully and without much interest)</em> :</strong> Hmm ... Gold ... It certainly does not hurt ... </p><br><p>  <strong>Zack:</strong> It would be better if you could help me find out where the old magician, whom I have been looking for so long, lives.  After all, the lizards - the ancient people, and you can know it! </p><br><p>  <strong>Hermit Lizard:</strong> You're right.  Lizards - the ancient people.  I can collect everything we know about the old man.  Do you agree to complete my task? </p><br><p>  <strong>Zack:</strong> What are we talking about!  Consider that everything has already been done. </p><br><p>  <strong>Hermit Lizard <em>(seriously)</em> :</strong> Already done?  Do you want to fool me? </p><br><p>  <strong>Zack:</strong> Actually, I wanted to joke, otherwise you were too serious. </p><br><p>  <strong>Hermit Lizard:</strong> I understand.  This is a joke.  Probably, I can also joke.  Then.  And now I need you to return the water to the Canal.  The water was stolen from us by the orcs. </p><br><p>  <strong>Hermit Lizard:</strong> Walk south along the water.  See the dam and the canal.  The dam must be raised.  Lever.  I will give it.  Channel need to fill up.  A stone.  Stone I will not give.  He already lies on the edge of the Channel.  Upstream of the dam.  The stone is heavy.  When the orcs dug, they raised it for a long time.  If you push it, it will fall back quickly. </p><br><p>  <strong>Hermit Lizard:</strong> Come back after that.  I will tell you everything I find out about the old wizard. </p><br><p>  <strong>Zack:</strong> Hand!  But, by the way, if you add a little bit of coins to the story, I will not be offended at all. </p><br><p>  <strong>Hermit Lizard:</strong> For coins, go to my relatives, who live in the shallows further in the south.  Go to the farthest sandy island, the third in a row.  The treasure will be yours! </p><br><p>  <strong>Hermit Lizard <em>(to himself)</em> :</strong> Strange.  This man loves humor.  I was joking.  The man did not laugh.  Very strange. </p></div></div><br><p>  Now - the most interesting: how the map is stored. </p><br><h2 id="mp">  MP </h2><br><p>  This is the map header file.  By an unfortunate coincidence, the extension coincides with that of the multiplayer save files, which we will not consider. </p><br><p>  First you need to give a general description of the landscape: </p><br><ul><li>  the number of "chunks" - pieces of the card 32x32 meters; </li><li>  maximum height (since the height of the vertices is stored in an integer scale); </li><li>  number of tile atlases. </li></ul><br><p>  Additionally, there is a description of the map materials, as well as animated tiles - for example, water or lava. </p><br><p><img src="https://habrastorage.org/webt/rq/5a/zv/rq5azvlnywx7dynoartwivfelea.png"></p><br><div class="spoiler">  <b class="spoiler_title">Structure description</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: mp title: Evil Islands, MP file (map header) application: Evil Islands file-extension: mp license: MIT endian: le doc: Map header seq: - id: magic contents: [0x72, 0xF6, 0x4A, 0xCE] doc: Magic bytes - id: max_altitude type: f4 doc: Maximal height of terrain - id: x_chunks_count type: u4 doc: Number of sectors by x - id: y_chunks_count type: u4 doc: Number of sectors by y - id: textures_count type: u4 doc: Number of texture files - id: texture_size type: u4 doc: Size of texture in pixels by side - id: tiles_count type: u4 doc: Number of tiles - id: tile_size type: u4 doc: Size of tile in pixels by side - id: materials_count type: u2 doc: Number of materials - id: animated_tiles_count type: u4 doc: Number of animated tiles - id: materials type: material doc: Map materials repeat: expr repeat-expr: materials_count - id: id_array type: u4 doc: Tile type repeat: expr repeat-expr: tiles_count enum: tile_type - id: animated_tiles type: animated_tile doc: Animated tiles repeat: expr repeat-expr: animated_tiles_count types: material: doc: Material parameters seq: - id: type type: u4 doc: Material type by enum: terrain_type - id: color type: rgba doc: RGBA diffuse color - id: self_illumination type: f4 doc: Self illumination - id: wave_multiplier type: f4 doc: Wave speed multiplier - id: warp_speed type: f4 doc: Warp speed multiplier - id: unknown size: 12 types: rgba: doc: RGBA color seq: - id: r type: f4 doc: Red channel - id: g type: f4 doc: Green channel - id: b type: f4 doc: Blue channel - id: a type: f4 doc: Alpha channel enums: terrain_type: 0: base 1: water_notexture 2: grass 3: water animated_tile: doc: Animated tile parameters seq: - id: start_index type: u2 doc: First tile of animation - id: length type: u2 doc: Animation frames count enums: tile_type: 0: grass 1: ground 2: stone 3: sand 4: rock 5: field 6: water 7: road 8: empty 9: snow 10: ice 11: drygrass 12: snowballs 13: lava 14: swamp 15: highrock</code> </pre> </div></div><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><table><thead><tr><th> terrain type </th><th>  Type of </th></tr></thead><tbody><tr><td>  0 </td><td>   </td></tr><tr><td>  one </td><td>    </td></tr><tr><td>  2 </td><td>   </td></tr><tr><td>  3 </td><td>   </td></tr></tbody></table></div></div><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><table><thead><tr><th> material type </th><th>  Type of </th></tr></thead><tbody><tr><td>  0 </td><td> grass </td></tr><tr><td>  one </td><td> ground </td></tr><tr><td>  2 </td><td> stone </td></tr><tr><td>  3 </td><td> sand </td></tr><tr><td>  four </td><td> rock </td></tr><tr><td>  five </td><td> field </td></tr><tr><td>  6 </td><td> water </td></tr><tr><td>  7 </td><td> road </td></tr><tr><td>  eight </td><td>  (empty) </td></tr><tr><td>  9 </td><td> snow </td></tr><tr><td>  ten </td><td> ice </td></tr><tr><td>  eleven </td><td> drygrass </td></tr><tr><td>  12 </td><td> snowballs </td></tr><tr><td>  13 </td><td> lava </td></tr><tr><td>  14 </td><td> swamp </td></tr><tr><td>  15 </td><td> highrock </td></tr></tbody></table></div></div><br><p>      ,      <code>Res/aiinfo.res/tileDesc.reg</code> . </p><br><blockquote> <strong> :</strong>     ,   ‚Äî       . <br>   :       . </blockquote><p>       .  For the cause! </p><br><h2 id="sec"> SEC </h2><br><p>      ‚Äî  3232 .       ,    <code>ZonenameXXXYYY</code> . </p><br><p><img src="https://habrastorage.org/webt/9-/pd/_l/9-pd_ltybkk7hx_oywo4wsfwrpc.png"></p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: sec title: Evil Islands, SEC file (map sector) application: Evil Islands file-extension: sec license: MIT endian: le doc: Map sector seq: - id: magic contents: [0x74, 0xF7, 0x4B, 0xCF] doc: Magic bytes - id: liquids type: u1 doc: Liquids layer indicator - id: vertexes type: vertex doc: Vertex array 33x33 repeat: expr repeat-expr: 1089 - id: liquid_vertexes type: vertex doc: Vertex array 33x33 if: liquids != 0 repeat: expr repeat-expr: 'liquids != 0 ? 1089 : 0' - id: tiles type: tile doc: Tile array 16x16 repeat: expr repeat-expr: 256 - id: liquid_tiles type: tile doc: Tile array 16x16 if: liquids != 0 repeat: expr repeat-expr: 'liquids != 0 ? 256 : 0' - id: liquid_material type: u2 doc: Index of material if: liquids != 0 repeat: expr repeat-expr: 'liquids != 0 ? 256 : 0' types: vertex: doc: Vertex data seq: - id: x_shift type: s1 doc: Shift by x axis - id: y_shift type: s1 doc: Shift by y axis - id: altitude type: u2 doc: Height (z position) - id: packed_normal type: normal doc: Packed normal normal: doc: Normal (3d vector) seq: - id: packed type: u4 doc: Normal packed in 4b instances: x: doc: Unpacked x component value: packed &gt;&gt; 11 &amp; 0x7FF y: doc: Unpacked y component value: packed &amp; 0x7FF z: doc: Unpacked z component value: packed &gt;&gt; 22 tile: doc: Tile parameters seq: - id: packed type: u2 doc: Tile information packed in 2b instances: index: doc: Tile index in texture value: packed &amp; 63 texture: doc: Texture index value: packed &gt;&gt; 6 &amp; 255 rotation: doc: Tile rotation (*90 degrees) value: packed &gt;&gt; 14 &amp; 3</code> </pre> </div></div><br><p>      ‚Äî       . </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><h4 id="raspakovka-normali">   </h4><br><p> 10    z,  11  x  y </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> packed_normal; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = ((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)((packed_normal &gt;&gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x7FF</span></span>) - <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>) / <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = ((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(packed_normal &amp; <span class="hljs-number"><span class="hljs-number">0x7FF</span></span>) - <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>) / <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> z = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(packed_normal &gt;&gt; <span class="hljs-number"><span class="hljs-number">22</span></span>) / <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>;</code> </pre> <br><h4 id="informaciya-o-teksture">    </h4><br><p> 6     , 8   , 2   </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> texture; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> tile_index = f &amp; <span class="hljs-number"><span class="hljs-number">63</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> texture_index = (f &gt;&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> rotation = (f &gt;&gt; <span class="hljs-number"><span class="hljs-number">14</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> </div></div><br><div class="spoiler"> <b class="spoiler_title"> 3d </b> <div class="spoiler_text"><h4 id="poluchenie-landshafta">   </h4><br><p>    33   33 ,  ,  3232 .     ‚Äî 1  . </p><br><p>  : <br> x =   x + x_offset / 254 <br> y =   y + y_offset / 254 <br> z = altitude / 65535 * max_altitude ( .mp ) </p><br><p>     "",       : </p><br><pre> <code class="plaintext hljs"> 0 1 2 *-*-* |\|\| ~ 33 *-*-* |\|\| ~ 66 *-*-* ~ ~ ~</code> </pre> <br><p>       ,  , 1616 .   ‚Äî 2  .      ,  90 . </p></div></div><br><p>        .   ,     ,     ID  ,       MP . </p><br><blockquote> <strong> :</strong>    MP,     ,       :  ID     , -     . <br>  ID       ‚Äî         . </blockquote><p>  ‚Äî      : </p><br><p><img src="https://habrastorage.org/webt/so/88/c6/so88c6ufcpzn1cqhxc7orbzeif4.jpeg"></p><br><p>   - ‚Äî    ,         . </p><br><h2 id="mob"> MOB </h2><br><p>    ( )   ,     ,     :   .           ‚Äî    " ",     . <br>         ,    (    ). </p><br><p>   : </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> structure { <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> type_id; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> size; byte data[size - <span class="hljs-number"><span class="hljs-number">8</span></span>]; } node;</code> </pre> <br><div class="spoiler"> <b class="spoiler_title">  (,   !)</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/hf/jd/yi/hfjdyiujzmtzizewv5i86pmjil0.png"></p><br><p>   ( , ) </p><br><pre> <code class="plaintext hljs">meta: id: mob title: Evil Islands, MOB file (map entities) application: Evil Islands file-extension: mob license: MIT endian: le doc: Map entities tree seq: - id: root_node type: node doc: Root node types: node: doc: Entity node seq: - id: type_id type: u4 doc: Node children type ID - id: size type: u4 doc: Node full size - id: data type: node_data size: size - 8 doc: Node stored data node_data: doc: Node data seq: - id: value type: switch-on: _parent.type_id cases: 0xA000: node 0x00001E00: node 0x00001E01: node 0x00001E02: node 0x00001E03: node 0x00001E0B: node 0x00001E0E: node 0x0000A000: node 0x0000AA01: node 0x0000ABD0: node 0x0000B000: node 0x0000B001: node 0x0000CC01: node 0x0000DD01: node 0x0000E000: node 0x0000E001: node 0x0000F000: node 0x0000FF00: node 0x0000FF01: node 0x0000FF02: node 0xBBAB0000: node 0xBBAC0000: node 0xBBBB0000: node 0xBBBC0000: node 0xBBBD0000: node 0xBBBE0000: node 0xBBBF0000: node 0xDDDDDDD1: node _: u1 doc: Node elements repeat: eos</code> </pre> </div></div><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><table><thead><tr><th>   </th><th>  () </th><th>  description </th></tr></thead><tbody><tr><td> AiGraph </td><td></td><td>   </td></tr><tr><td> AreaArray </td><td></td><td></td></tr><tr><td> Byte </td><td>  one </td><td> 1   </td></tr><tr><td> Diplomacy </td><td> 4096 </td><td> 32x32   2  </td></tr><tr><td> Dword </td><td>  four </td><td> 4   </td></tr><tr><td> Float </td><td>  four </td><td> 4  </td></tr><tr><td> LeverStats </td><td>  12 </td><td>   </td></tr><tr><td> Null </td><td>  0 </td><td>   </td></tr><tr><td> Plot </td><td>  12 </td><td> 3 floats (vec3) </td></tr><tr><td> Plot2DArray </td><td></td><td></td></tr><tr><td> Quaternion </td><td>  sixteen </td><td> 4 floats (vec4) </td></tr><tr><td> Record </td><td> &gt;8 </td><td>   </td></tr><tr><td> Rectangle </td><td></td><td></td></tr><tr><td> String </td><td></td><td>  </td></tr><tr><td> StringArray </td><td> &gt;4 </td><td>   </td></tr><tr><td> StringEncrypted </td><td> &gt;4 </td><td>    </td></tr><tr><td> UnitStats </td><td>  180 </td><td>   </td></tr><tr><td>  Unknown </td><td></td><td></td></tr></tbody></table></div></div><br><div class="spoiler"> <b class="spoiler_title">  type_id</b> <div class="spoiler_text"><table><thead><tr><th> type_id </th><th>   </th><th>   </th></tr></thead><tbody><tr><td> 0x00000000 </td><td> Record </td><td>  ROOT </td></tr><tr><td> 0x00001E00 </td><td> Record </td><td> VSS_SECTION </td></tr><tr><td> 0x00001E01 </td><td> Record </td><td> VSS_TRIGER </td></tr><tr><td> 0x00001E02 </td><td> Record </td><td> VSS_CHECK </td></tr><tr><td> 0x00001E03 </td><td> Record </td><td> VSS_PATH </td></tr><tr><td> 0x00001E04 </td><td> Dword </td><td> VSS_ID </td></tr><tr><td> 0x00001E05 </td><td> Rectangle </td><td> VSS_RECT </td></tr><tr><td> 0x00001E06 </td><td> Dword </td><td> VSS_SRC_ID </td></tr><tr><td> 0x00001E07 </td><td> Dword </td><td> VSS_DST_ID </td></tr><tr><td> 0x00001E08 </td><td> String </td><td> VSS_TITLE </td></tr><tr><td> 0x00001E09 </td><td> String </td><td> VSS_COMMANDS </td></tr><tr><td> 0x00001E0A </td><td> Byte </td><td> VSS_ISSTART </td></tr><tr><td> 0x00001E0B </td><td> Record </td><td> VSS_LINK </td></tr><tr><td> 0x00001E0C </td><td> String </td><td> VSS_GROUP </td></tr><tr><td> 0x00001E0D </td><td> Byte </td><td> VSS_IS_USE_GROUP </td></tr><tr><td> 0x00001E0E </td><td> Record </td><td> VSS_VARIABLE </td></tr><tr><td> 0x00001E0F </td><td> StringArray </td><td> VSS_BS_CHECK </td></tr><tr><td> 0x00001E10 </td><td> StringArray </td><td> VSS_BS_COMMANDS </td></tr><tr><td> 0x00001E11 </td><td> String </td><td> VSS_CUSTOM_SRIPT </td></tr><tr><td> 0x0000A000 </td><td> Record </td><td> OBJECTDBFILE </td></tr><tr><td> 0x0000AA00 </td><td> Null </td><td> LIGHT_SECTION </td></tr><tr><td> 0x0000AA01 </td><td> Record </td><td> LIGHT </td></tr><tr><td> 0x0000AA02 </td><td> Float </td><td> LIGHT_RANGE </td></tr><tr><td> 0x0000AA03 </td><td> String </td><td> LIGHT_NAME </td></tr><tr><td> 0x0000AA04 </td><td> Plot </td><td> LIGHT_POSITION </td></tr><tr><td> 0x0000AA05 </td><td> Dword </td><td> LIGHT_ID </td></tr><tr><td> 0x0000AA06 </td><td> Byte </td><td> LIGHT_SHADOW </td></tr><tr><td> 0x0000AA07 </td><td> Plot </td><td> LIGHT_COLOR </td></tr><tr><td> 0x0000AA08 </td><td> String </td><td> LIGHT_COMMENTS </td></tr><tr><td> 0x0000ABD0 </td><td> Record </td><td> WORLD_SET </td></tr><tr><td> 0x0000ABD1 </td><td> Plot </td><td> WS_WIND_DIR </td></tr><tr><td> 0x0000ABD2 </td><td> Float </td><td> WS_WIND_STR </td></tr><tr><td> 0x0000ABD3 </td><td> Float </td><td> WS_TIME </td></tr><tr><td> 0x0000ABD4 </td><td> Float </td><td> WS_AMBIENT </td></tr><tr><td> 0x0000ABD5 </td><td> Float </td><td> WS_SUN_LIGHT </td></tr><tr><td> 0x0000B000 </td><td> Record </td><td> OBJECTSECTION </td></tr><tr><td> 0x0000B001 </td><td> Record </td><td> OBJECT </td></tr><tr><td> 0x0000B002 </td><td> Dword </td><td> NID </td></tr><tr><td> 0x0000B003 </td><td> Dword </td><td> OBJTYPE </td></tr><tr><td> 0x0000B004 </td><td> String </td><td> OBJNAME </td></tr><tr><td> 0x0000B005 </td><td> Null </td><td> OBJINDEX </td></tr><tr><td> 0x0000B006 </td><td> String </td><td> OBJTEMPLATE </td></tr><tr><td> 0x0000B007 </td><td> String </td><td> OBJPRIMTXTR </td></tr><tr><td> 0x0000B008 </td><td> String </td><td> OBJSECTXTR </td></tr><tr><td> 0x0000B009 </td><td> Plot </td><td> OBJPOSITION </td></tr><tr><td> 0x0000B00A </td><td> Quaternion </td><td> OBJROTATION </td></tr><tr><td> 0x0000B00B </td><td> Null </td><td> OBJTEXTURE </td></tr><tr><td> 0x0000B00C </td><td> Plot </td><td> OBJCOMPLECTION </td></tr><tr><td> 0x0000B00D </td><td> StringArray </td><td> OBJBODYPARTS </td></tr><tr><td> 0x0000B00E </td><td> String </td><td> PARENTTEMPLATE </td></tr><tr><td> 0x0000B00F </td><td> String </td><td> OBJCOMMENTS </td></tr><tr><td> 0x0000B010 </td><td> Null </td><td> OBJ_DEF_LOGIC </td></tr><tr><td> 0x0000B011 </td><td> Byte </td><td> OBJ_PLAYER </td></tr><tr><td> 0x0000B012 </td><td> Dword </td><td> OBJ_PARENT_ID </td></tr><tr><td> 0x0000B013 </td><td> Byte </td><td> OBJ_USE_IN_SCRIPT </td></tr><tr><td> 0x0000B014 </td><td> Byte </td><td> OBJ_IS_SHADOW </td></tr><tr><td> 0x0000B015 </td><td> Null </td><td> OBJ_R </td></tr><tr><td> 0x0000B016 </td><td> String </td><td> OBJ_QUEST_INFO </td></tr><tr><td> 0x0000C000 </td><td> Null </td><td> SC_OBJECTDBFILE </td></tr><tr><td> 0x0000CC00 </td><td> Null </td><td> SOUND_SECTION </td></tr><tr><td> 0x0000CC01 </td><td> Record </td><td> SOUND </td></tr><tr><td> 0x0000CC02 </td><td> Dword </td><td> SOUND_ID </td></tr><tr><td> 0x0000CC03 </td><td> Plot </td><td> SOUND_POSITION </td></tr><tr><td> 0x0000CC04 </td><td> Dword </td><td> SOUND_RANGE </td></tr><tr><td> 0x0000CC05 </td><td> String </td><td> SOUND_NAME </td></tr><tr><td> 0x0000CC06 </td><td> Dword </td><td> SOUND_MIN </td></tr><tr><td> 0x0000CC07 </td><td> Dword </td><td> SOUND_MAX </td></tr><tr><td> 0x0000CC08 </td><td> String </td><td> SOUND_COMMENTS </td></tr><tr><td> 0x0000CC09 </td><td> Null </td><td> SOUND_VOLUME </td></tr><tr><td> 0x0000CC0A </td><td> StringArray </td><td> SOUND_RESNAME </td></tr><tr><td> 0x0000CC0B </td><td> Dword </td><td> SOUND_RANGE2 </td></tr><tr><td> 0x0000CC0D </td><td> Byte </td><td> SOUND_AMBIENT </td></tr><tr><td> 0x0000CC0E </td><td> Byte </td><td> SOUND_IS_MUSIC </td></tr><tr><td> 0x0000D000 </td><td> Null </td><td> PR_OBJECTDBFILE </td></tr><tr><td> 0x0000DD00 </td><td> Null </td><td> PARTICL_SECTION </td></tr><tr><td> 0x0000DD01 </td><td> Record </td><td> PARTICL </td></tr><tr><td> 0x0000DD02 </td><td> Dword </td><td> PARTICL_ID </td></tr><tr><td> 0x0000DD03 </td><td> Plot </td><td> PARTICL_POSITION </td></tr><tr><td> 0x0000DD04 </td><td> String </td><td> PARTICL_COMMENTS </td></tr><tr><td> 0x0000DD05 </td><td> String </td><td> PARTICL_NAME </td></tr><tr><td> 0x0000DD06 </td><td> Dword </td><td> PARTICL_TYPE </td></tr><tr><td> 0x0000DD07 </td><td> Float </td><td> PARTICL_SCALE </td></tr><tr><td> 0x0000E000 </td><td> Record </td><td> DIRICTORY </td></tr><tr><td> 0x0000E001 </td><td> Record </td><td> FOLDER </td></tr><tr><td> 0x0000E002 </td><td> String </td><td> DIR_NAME </td></tr><tr><td> 0x0000E003 </td><td> Dword </td><td> DIR_NINST </td></tr><tr><td> 0x0000E004 </td><td> Dword </td><td> DIR_PARENT_FOLDER </td></tr><tr><td> 0x0000E005 </td><td> Byte </td><td> DIR_TYPE </td></tr><tr><td> 0x0000F000 </td><td> Record </td><td> DIRICTORY_ELEMENTS </td></tr><tr><td> 0x0000FF00 </td><td> Record </td><td> SEC_RANGE </td></tr><tr><td> 0x0000FF01 </td><td> Record </td><td> MAIN_RANGE </td></tr><tr><td> 0x0000FF02 </td><td> Record </td><td> RANGE </td></tr><tr><td> 0x0000FF05 </td><td> Dword </td><td> MIN_ID </td></tr><tr><td> 0x0000FF06 </td><td> Dword </td><td> MAX_ID </td></tr><tr><td> 0x31415926 </td><td> AiGraph </td><td> AIGRAPH </td></tr><tr><td> 0xACCEECCA </td><td> String </td><td> SS_TEXT_OLD </td></tr><tr><td> 0xACCEECCB </td><td> StringEncrypted </td><td> SS_TEXT </td></tr><tr><td> 0xBBAB0000 </td><td> Record </td><td> MAGIC_TRAP </td></tr><tr><td> 0xBBAB0001 </td><td> Dword </td><td> MT_DIPLOMACY </td></tr><tr><td> 0xBBAB0002 </td><td> String </td><td> MT_SPELL </td></tr><tr><td> 0xBBAB0003 </td><td> AreaArray </td><td> MT_AREAS </td></tr><tr><td> 0xBBAB0004 </td><td> Plot2DArray </td><td> MT_TARGETS </td></tr><tr><td> 0xBBAB0005 </td><td> Dword </td><td> MT_CAST_INTERVAL </td></tr><tr><td> 0xBBAC0000 </td><td> Record </td><td>  LEVER </td></tr><tr><td> 0xBBAC0001 </td><td> Null </td><td> LEVER_SCIENCE_STATS </td></tr><tr><td> 0xBBAC0002 </td><td> Byte </td><td> LEVER_CUR_STATE </td></tr><tr><td> 0xBBAC0003 </td><td> Byte </td><td> LEVER_TOTAL_STATE </td></tr><tr><td> 0xBBAC0004 </td><td> Byte </td><td> LEVER_IS_CYCLED </td></tr><tr><td> 0xBBAC0005 </td><td> Byte </td><td> LEVER_CAST_ONCE </td></tr><tr><td> 0xBBAC0006 </td><td> LeverStats </td><td> LEVER_SCIENCE_STATS_NEW </td></tr><tr><td> 0xBBAC0007 </td><td> Byte </td><td> LEVER_IS_DOOR </td></tr><tr><td> 0xBBAC0008 </td><td> Byte </td><td> LEVER_RECALC_GRAPH </td></tr><tr><td> 0xBBBB0000 </td><td> Record </td><td> UNIT </td></tr><tr><td> 0xBBBB0001 </td><td> Null </td><td> UNIT_R </td></tr><tr><td> 0xBBBB0002 </td><td> String </td><td> UNIT_PROTOTYPE </td></tr><tr><td> 0xBBBB0003 </td><td> Null </td><td> UNIT_ITEMS </td></tr><tr><td> 0xBBBB0004 </td><td> UnitStats </td><td> UNIT_STATS </td></tr><tr><td> 0xBBBB0005 </td><td> StringArray </td><td> UNIT_QUEST_ITEMS </td></tr><tr><td> 0xBBBB0006 </td><td> StringArray </td><td> UNIT_QUICK_ITEMS </td></tr><tr><td> 0xBBBB0007 </td><td> StringArray </td><td> UNIT_SPELLS </td></tr><tr><td> 0xBBBB0008 </td><td> StringArray </td><td> UNIT_WEAPONS </td></tr><tr><td> 0xBBBB0009 </td><td> StringArray </td><td> UNIT_ARMORS </td></tr><tr><td> 0xBBBB000A </td><td> Byte </td><td> UNIT_NEED_IMPORT </td></tr><tr><td> 0xBBBC0000 </td><td> Record </td><td> UNIT_LOGIC </td></tr><tr><td> 0xBBBC0001 </td><td> Null </td><td> UNIT_LOGIC_AGRESSIV </td></tr><tr><td> 0xBBBC0002 </td><td> Byte </td><td> UNIT_LOGIC_CYCLIC </td></tr><tr><td> 0xBBBC0003 </td><td> Dword </td><td> UNIT_LOGIC_MODEL </td></tr><tr><td> 0xBBBC0004 </td><td> Float </td><td> UNIT_LOGIC_GUARD_R </td></tr><tr><td> 0xBBBC0005 </td><td> Plot </td><td> UNIT_LOGIC_GUARD_PT </td></tr><tr><td> 0xBBBC0006 </td><td> Byte </td><td> UNIT_LOGIC_NALARM </td></tr><tr><td> 0xBBBC0007 </td><td> Byte </td><td> UNIT_LOGIC_USE </td></tr><tr><td> 0xBBBC0008 </td><td> Null </td><td> UNIT_LOGIC_REVENGE </td></tr><tr><td> 0xBBBC0009 </td><td> Null </td><td> UNIT_LOGIC_FEAR </td></tr><tr><td> 0xBBBC000A </td><td> Float </td><td> UNIT_LOGIC_WAIT </td></tr><tr><td> 0xBBBC000B </td><td> Byte </td><td> UNIT_LOGIC_ALARM_CONDITION </td></tr><tr><td> 0xBBBC000C </td><td> Float </td><td> UNIT_LOGIC_HELP </td></tr><tr><td> 0xBBBC000D </td><td> Byte </td><td> UNIT_LOGIC_ALWAYS_ACTIVE </td></tr><tr><td> 0xBBBC000E </td><td> Byte </td><td> UNIT_LOGIC_AGRESSION_MODE </td></tr><tr><td> 0xBBBD0000 </td><td> Record </td><td> GUARD_PT </td></tr><tr><td> 0xBBBD0001 </td><td> Plot </td><td> GUARD_PT_POSITION </td></tr><tr><td> 0xBBBD0002 </td><td> Null </td><td> GUARD_PT_ACTION </td></tr><tr><td> 0xBBBE0000 </td><td> Record </td><td> ACTION_PT </td></tr><tr><td> 0xBBBE0001 </td><td> Plot </td><td> ACTION_PT_LOOK_PT </td></tr><tr><td> 0xBBBE0002 </td><td> Dword </td><td> ACTION_PT_WAIT_SEG </td></tr><tr><td> 0xBBBE0003 </td><td> Dword </td><td> ACTION_PT_TURN_SPEED </td></tr><tr><td> 0xBBBE0004 </td><td> Byte </td><td> ACTION_PT_FLAGS </td></tr><tr><td> 0xBBBF0000 </td><td> Record </td><td> TORCH </td></tr><tr><td> 0xBBBF0001 </td><td> Float </td><td> TORCH_STRENGHT </td></tr><tr><td> 0xBBBF0002 </td><td> Plot </td><td> TORCH_PTLINK </td></tr><tr><td> 0xBBBF0003 </td><td> String </td><td> TORCH_SOUND </td></tr><tr><td> 0xDDDDDDD1 </td><td> Record </td><td> DIPLOMATION </td></tr><tr><td> 0xDDDDDDD2 </td><td> Diplomacy </td><td> DIPLOMATION_FOF </td></tr><tr><td> 0xDDDDDDD3 </td><td> StringArray </td><td> DIPLOMATION_PL_NAMES </td></tr><tr><td> 0xFFFFFFFF </td><td>  Unknown </td><td> UNKNOWN </td></tr></tbody></table></div></div><br><p>        ‚Äî ,    ,     Nival,    ‚Äî  ,     (  ,  ). </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> key; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size; i++) { key += (((((key * <span class="hljs-number"><span class="hljs-number">13</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) + key) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) - key) * <span class="hljs-number"><span class="hljs-number">4</span></span> + <span class="hljs-number"><span class="hljs-number">2531011</span></span>; data[i] ^= key &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>; }</code> </pre> </div></div><br><blockquote> <strong> :</strong>      ,       (   )    .   ,      ,       ,       . </blockquote><p>      (  ,   ,    ‚Äî Windows 98): </p><br><p><img src="https://habrastorage.org/webt/8w/qv/gz/8wqvgzyxxuqmqremuny92irjzue.jpeg"></p><br><blockquote> <strong> :</strong>       ,     . ,        ( , ,  " :   ",     ). </blockquote><p>  ,     ,  -     -   , , Collada      : </p><br><p><img src="https://habrastorage.org/webt/l8/2i/tc/l82itcjm6orpd7hb0tp6p9rqq5y.jpeg"></p><br><h1 id="epilog">  Epilogue </h1><br><p>          .      ,          <em> </em>   . </p><br><p>  ,            .     -   ,   ‚Äî -    ,      . , -... </p><br><p>     ‚Äî     ! </p><br><p> <strong>UPD (23.01.2019):</strong> <br>        ,             : <a href="https://github.com/aspadm/EIrepack">github</a> . <br>        ,          (,   ""      ). </p><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><h3 id="obschaya-informaciya-ob-igre">     </h3><br><ul><li> <a href="http://ru.nival.com/games/history/zemli">http://ru.nival.com/games/history/zemli</a> ‚Äî    </li><li> <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25BE%25D0%25BA%25D0%25BB%25D1%258F%25D1%2582%25D1%258B%25D0%25B5_%25D0%25B7%25D0%25B5%25D0%25BC%25D0%25BB%25D0%25B8">https://ru.wikipedia.org/wiki/_</a> ‚Äî    </li><li> <a href="https://allods.gipat.ru/index.php%3Fp%3Dei">https://allods.gipat.ru/index.php?p=ei</a> ‚Äî    " " </li><li> <a href="https://evil-islands.github.io/">https://evil-islands.github.io</a> ‚Äî  ,     </li></ul><br><h3 id="instrumenty-s-otkrytymi-ishodnikami">     </h3><br><ul><li> <a href="http://gipatgroup.org/utilities">http://gipatgroup.org/utilities</a> ‚Äî EiEdit (.res, .*db), MobSurgeon (.mob) </li><li> <a href="http://svn.gipat.org/trac/GGWiki">http://svn.gipat.org/trac/GGWiki</a> ‚Äî EiEdit (.res, .*db), MobSurgeon (.mob),    .mp, .sec, .*db </li><li> <a href="https://github.com/demothorg/eifixer">https://github.com/demothorg/eifixer</a> ‚Äî     </li><li> <a href="https://github.com/konstvest/ei_figer">https://github.com/konstvest/ei_figer</a> ‚Äî   Blender   .lnk, .fig, .bon, .anm </li><li> <a href="https://github.com/demothorg/ei-tools">https://github.com/demothorg/ei-tools</a> ‚Äî       (.mob, .lnk, .mpr, .res) +   </li><li> <a href="https://github.com/konstvest/ei_maper">https://github.com/konstvest/ei_maper</a> ‚Äî   (.mpr, .mp, .sec, .mob) </li><li> <a href="https://github.com/chemmalion/EIDBEditor">https://github.com/chemmalion/EIDBEditor</a> ‚Äî     (.*db) </li><li> <a href="https://gitlab.com/ykurganov/open-evil-islands">https://gitlab.com/ykurganov/open-evil-islands</a> ‚Äî       ,      </li></ul><br><h3 id="kommyuniti">  </h3><br><ul><li> <a href="https://vk.com/evil.islands">https://vk.com/evil.islands</a> ‚Äî   </li><li> <a href="http://allods.gipat.ru/">http://allods.gipat.ru</a> ‚Äî " " </li><li> <a href="http://gipat.ru/">http://gipat.ru</a> ‚Äî  " " </li><li> <a href="http://gipatgroup.org/forum">http://gipatgroup.org/forum</a> ‚Äî  GipatGroup (   ‚Äî  ) </li><li> <a href="http://honestgroup.net/forum">http://honestgroup.net/forum</a> ‚Äî  HonestGroup </li></ul></div></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/434802/">https://habr.com/ru/post/434802/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../434792/index.html">Freelance 2018: year results</a></li>
<li><a href="../434794/index.html">Soft-skills successful tester</a></li>
<li><a href="../434796/index.html">Coding the Art: how we generate graphics and animation in design projects</a></li>
<li><a href="../434798/index.html">Swagger - smart documentation for your RESTful web API - Junior back-end developer review for newbies</a></li>
<li><a href="../434800/index.html">(5-2) Ways to move a large SQL table</a></li>
<li><a href="../434804/index.html">Fintech startup Robinhood could not launch analog bank accounts</a></li>
<li><a href="../434806/index.html">Christmas disassembly with a canoe</a></li>
<li><a href="../434810/index.html">Starter to work with Spring Cloud</a></li>
<li><a href="../434812/index.html">Time management in projects</a></li>
<li><a href="../434816/index.html">Detox and Appium: an automated interface test in React Native</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>