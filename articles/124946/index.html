<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asterisk + UniMRCP + VoiceNavigator. Synthesis and speech recognition in Asterisk. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 2 
 Part 3 
 Part 4 

 Considering the increased community interest in Asterisk, I decided to make my own contribution and talk about building vo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asterisk + UniMRCP + VoiceNavigator. Synthesis and speech recognition in Asterisk. Part 1</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/blogs/voip/125147/">Part 2</a> <br>  <a href="http://habrahabr.ru/blogs/voip/125512/">Part 3</a> <br>  <a href="http://habrahabr.ru/blogs/voip/128898/">Part 4</a> <br><br>  Considering the increased community interest in Asterisk, I decided to make my own contribution and talk about building voice menus using speech synthesis and recognition. <br><br>  The article is designed for professionals who have experience with the construction of IVR in Asterisk and have an understanding of voice self-service systems. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The GHS (voice self-service systems) significantly expands the possibilities for creating voice applications and allows the user to receive information and order services independently, without the participation of the operator.  It can be call routing, inquiry and delivery of information on the flight schedule, bank account status, taxi order, appointment to the doctor, etc. <br>  Recognition allows you to opt out of linear menus created using DTMF, talk to the human language system and easily create multiple-choice menus. <br>  Synthesis greatly simplifies working with dynamically changing information and large amounts of textual data. <br><br><img src="https://habrastorage.org/storage1/7a617621/c3ff8633/f774661d/03e1b759.gif"><br><a name="habracut"></a><br><br>  Below I will describe the integration of Asterisk with <a href="http://speechpro.ru/product/recognition/platform/vn">VoiceNavigator</a> , since  I am an employee of the company developing it and I am engaged in, among other things, support and integration with small platforms (Asterisk, FreeSWITCH).  I must say that the decision is paid.  There are no really working OpenSource applications for the synthesis and recognition of Russian speech. <br><br><h4>  Synthesis and recognition of Russian speech in Asterisk </h4><br>  The industry accepted standard for implementing the synthesis and recognition functionality is the use of the <a href="http://www.ietf.org/rfc/rfc4463.txt">MRCP</a> protocol. <br><br>  Asterisk uses the <a href="http://code.google.com/p/unimrcp/">UniMRCP</a> library for this. <br>  UniMRCP is an open source, cross-platform software that includes the necessary tools to implement the functions of the MRCP client and the MRCP server. <br>  The project is slowly developing and, as far as I know, this is the only OpenSource solution for working with the MRCP protocol today.  Supports Asterisk (all versions starting from 1.4) and FreeSWITCH. <br><br><h4>  VoiceNavigator </h4><br>  VoiceNavigator is a software package that is installed on a separate Windows machine and provides access to the synthesis and recognition engines via the MRCP protocol. <br>  Includes STC MRCP Server, STC TTS speech synthesis complex and STC ASR speech recognition complex. <br><br><h5>  MRCP server </h5><br>  The MRCP server manages the interaction between the voice platform used and the ASR and TTS modules.  STC MRCP Server supports the following voice platforms: Asterisk, FreeSWITCH, Avaya Voice Portal, Genesys Voice Platform, Cisco Unified CCX, Siemens OpenScape. <br><br>  MRCP requests are transmitted by <a href="http://tools.ietf.org/html/rfc2326">RTSP</a> protocol commands. <br>  <a href="http://tools.ietf.org/html/rfc3550">RTP</a> is used to transfer audio data. <br>  The voice platform through the MRCP server requests access to speech recognition and synthesis modules, depending on which different interaction schemes are used. <br><br><h5>  ASR </h5><br>  The ASR module is engaged in speech recognition.  The key concept for ASR is <a href="http://www.w3.org/TR/speech-grammar/">SRGS grammar</a> . <br>  <a href="http://www.w3.org/TR/speech-grammar/">SRGS</a> (speech recognition grammar specification) is a standard that describes the structure of the grammar used in speech recognition.  SRGS allows you to specify words or phrases that can be recognized by the speech engine. <br>  Creating grammars is a separate science and, if there is interest, I am ready to write a separate article. <br><br><h5>  Tts </h5><br>  The TTS module uses Speech Synthesis Markup Language ( <a href="http://www.w3.org/TR/speech-synthesis/">SSML</a> ) based on XML for use in speech synthesis applications. <br>  Control of synthesis occurs with the help of tags.  With their help, you can determine the pronunciation, control intonation, speed, volume, pause length, reading rules, etc. <br>  An example of speech synthesis from the MDGs can be heard here at <a href="http://vitalvoice.ru/demo/">vitalvoice.ru/demo</a> <br><br><h5>  Scheme of work </h5><br>  The call arrives on the voice platform. <br>  The voice platform activates the voice menu script, by which further interaction with the subscriber takes place. <br>  The scenario of the voice menu determines when the system should read the instruction to the subscriber, ask a question and how to process his answer. <br>  VoiceNavigator accepts speech recognition and speech synthesis requests from the voice platform, performs them and returns the result of the execution using the <a href="http://www.ietf.org/rfc/rfc4463.txt">MRCP</a> protocol. <br>  In speech recognition, the voice platform transmits <a href="http://www.w3.org/TR/speech-grammar/">SRGS grammar</a> and digitized speech and receives the answer in the form of <a href="http://www.w3.org/TR/nl-spec/">NLSML</a> . <br>  During speech synthesis, the voice platform transmits plain-text or <a href="http://www.w3.org/TR/speech-synthesis/">SSML</a> and receives synthesized speech in response. <br><br><h4>  Installing and Configuring UniMRCP </h4><br>  Let's move on to the practical part. <br>  The following describes the installation of UniMRCP on the native Asterisk CentOS.  When installing on other operating systems may be minor differences. <br><br>  We download the latest version of <a href="">uni-ast-package-0.3.2</a> from the official site. <br>  Package contains: <br>  ‚Ä¢ <b>Asterisk version 1.6.2.9</b> - the operation with this version has been verified by the UniMRCP developer; <br>  ‚Ä¢ <b>Asterisk-UniMRCP-Bridge 0.1.0</b> - a bridge for interfacing an Asterisk and a UniMRCP module; <br>  ‚Ä¢ <b>UniMRCP</b> - Module UniMRCP 1.0.0; <br>  ‚Ä¢ <b>APR</b> - Apache Portable Runtime 1.4.2; <br>  ‚Ä¢ <b>APR-Util</b> - Apache Portable Runtime Utility Library 1.3.9; <br>  ‚Ä¢ <b>Sofia-SIP</b> - SIP User-Agent library 1.12.10. <br><br>  Requires autoconf, libtool, gcc, pkg-config for installation. <br>  After unpacking, we see three scripts in the root of the folder: <br>  ast-install.sh - installs the supplied Asterisk if it is not installed on the system. <br>  uni-install.sh - installs UniMRCP <br>  connector-install.sh - installs a bridge between Asterisk and UniMRCP. <br><br>  We run them in that order (if Asterisk is installed - ast-install.sh is not needed) and answer all questions in the affirmative. <br>  We are looking for everything to be established without errors. <br>  In my experience, errors only happen when dependencies are not satisfied.  If Asterisk was previously collected from source, then all dependencies should already be satisfied and the installation will be easy and fast. <br><br>  After installation, Asterisk has 2 new modules res_speech_unimrcp.so and app_unimrcp.so, and the dialplan has got the commands MRCPSynth and MRCPRecog.  You can verify the installation by typing Asterisk in the console: <br> <code>*CLI&gt; module show like mrcp <br> Module Description Use Count <br> res_speech_unimrcp.so UniMRCP Speech Engine 0 <br> app_unimrcp.so MRCP suite of applications 0 <br> 2 modules loaded</code> <br> <br>  Before you can work with the resources of synthesis and recognition, you must connect them.  To connect to the MRCP server, the file /etc/asterisk/mrcp.conf is used.  You can edit its content or replace it with the following (comments added to clarify the most important parameters): <br> <code>[general] <br> ;  ASR  TTS,   . <br> ;     MRCP- <br> default-asr-profile = vn-internal <br> default-tts-profile = vn-internal <br> ; UniMRCP logging level to appear in Asterisk logs. Options are: <br> ; EMERGENCY|ALERT|CRITICAL|ERROR|WARNING|NOTICE|INFO|DEBUG --&gt; <br> log-level = DEBUG <br> max-connection-count = 100 <br> offer-new-connection = 1 <br> ; rx-buffer-size = 1024 <br> ; tx-buffer-size = 1024 <br> ; request-timeout = 60 <br> <br> ;  <br> [vn-internal] <br> ; +++ MRCP settings +++ <br> ; MRCP- <br> version = 1 <br> ; <br> ; +++ RTSP +++ <br> ; === RSTP settings === <br> ;  MRCP- <br> server-ip = 192.168.2.106 <br> <br> ;,   VoiceNavigator       <br> server-port = 8000 <br> ; force-destination = 1 <br> <br> ;      MRCP- <br> ;( VoiceNavigator ‚Äì  ) <br> resource-location = <br> <br> ;      VoiceNavigator <br> speechsynth = tts <br> speechrecog = asr <br> ; <br> ; +++ RTP +++ <br> ; === RTP factory === <br> ;IP- ,    Asterisk      RTP-. <br> rtp-ip = 192.168.2.104 <br> ; rtp-ext-ip = auto <br> <br> ; RTP- <br> rtp-port-min = 32768 <br> rtp-port-max = 32888 <br> ; === RTP settings === <br> ; --- Jitter buffer settings --- <br> playout-delay = 50 <br> ; min-playout-delay = 20 <br> max-playout-delay = 200 <br> ; --- RTP settings --- <br> ptime = 20 <br> codecs = PCMU PCMA L16/96/8000 <br> ; --- RTCP settings --- <br> rtcp = 1 <br> rtcp-bye = 2 <br> rtcp-tx-interval = 5000 <br> rtcp-rx-resolution = 1000</code> <br> <br>  After restarting Asterisk, the profile will be activated and the system is ready to work and create the first voice application. <br><br>  As described earlier, Asterisk uses the functions MRCPSynth and MRCPRecog of the app_unimrcp.so library to work: <br><img src="http://speechpro.ru/sites/default/files/images/products/vn_3_large.jpg" alt="image"><br><br><h4>  MRCPSynth </h4><br>  The MRCPSynth function has the following format: <br>  MRCPSynth (text, options), where <br>  <b>text</b> - text for synthesis (text \ SSML), <br>  <b>options</b> - synthesis options. <br><br>  <b>Synthesis parameters:</b> <br>  <b>p</b> - The connection profile to the synthesis resource contained in the mrcp.conf file <br>  <b>i</b> - Numbers, by pressing which on the phone, the synthesis will be interrupted <br>  <b>f</b> - File name for recording synthesized speech (recording is made in raw, recording is not made if a parameter or file name is not specified) <br>  <b>v</b> - Voice that needs to be synthesized, for example, ‚ÄúMaria8000‚Äù. <br><br><h5>  An example of using the function in dialplan </h5><br>  <b>plain-text:</b> <br><pre> <code class="hljs php">exten =&gt; <span class="hljs-number"><span class="hljs-number">7577</span></span>,n,MRCPSynth(    )</code> </pre> <br>  <b>SSML:</b> <br><pre> <code class="hljs xml">exten =&gt; 7577,MRCPSynth(<span class="hljs-meta"><span class="hljs-meta">&lt;?xml version=\"1.0\"?&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">speak</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">1.0</span></span></span><span class="hljs-tag">\" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xml:lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ru-ru</span></span></span><span class="hljs-tag">\" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">www.w3.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">2001</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">10</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">synthesis</span></span></span><span class="hljs-tag">\"&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">voice</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">8000</span></span></span><span class="hljs-tag">\"&gt;</span></span>    .<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">voice</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">speak</span></span></span><span class="hljs-tag">&gt;</span></span>)</code> </pre> <br>  The advantage of using SSML compared to plain-text is the ability to use different tags (voice, speed and expressiveness of speech, pauses, text interpretation, etc.). <br><br><h4>  MRCPRecog </h4><br>  The MRCPRecog function has the following format: <br>  MRCPRecog (grammar, options), where <br>  <b>grammar</b> - grammar (URL \ SRGS), is specified by a link to a file located on the http-server or directly in the function body. <br>  <b>options</b> - recognition options. <br><br>  <b>Recognition parameters:</b> <br>  <b>p</b> - Recognition Resource Connection Profile contained in the mrcp.conf file <br>  <b>i</b> - Digits of the DTMF code, upon receipt of which the recognition will be interrupted. <br>  If the value is ‚Äúany‚Äù or other characters, recognition will be interrupted when they are received, and the character will be returned to the dial plan. <br>  <b>f</b> - The name of the file to play as an invitation. <br>  <b>b</b> - Ability to interrupt the playing file (barge-in mode) and start recognition (you cannot kill = 0, you can kill and speech detection is performed by ASR engine = 1, you can kill and speech detection is performed by Asterisk = 2) <br>  <b>t</b> - The time after which the recognition system can interrupt the recognition procedure with the recognition-timeout (003) code, in case the recognition has started, and there is not a single recognition option.  The value is specified in milliseconds in the range [0..MAXTIMEOUT]. <br>  <b>ct</b> - Confident Recognition Threshold (0.0 - 1.0). <br>  If the confidence-level returned during recognition is less than the confidence-threshold, then the recognition result is no match. <br>  <b>sl</b> - Sensitivity to non-vocabulary commands.  (0.0 - 1.0).  The larger the value, the higher the sensitivity to noise. <br>  <b>nb</b> - Specifies the number of recognition results returned.  Returns N recognition results, with a confidence level greater than confidence-threshold.  The default value is 1. <br>  <b>nit</b> - The time after which the recognition system may interrupt the recognition procedure, with the code no-input-timeout (002), in case recognition has started and no speech has been found.  The value is specified in milliseconds, in the range [0..MAXTIMEOUT]. <br><br><h5>  An example of using the function in dialplan </h5><br>  <b>The grammar assignment in the function body:</b> <br><pre> <code class="hljs xml">exten =&gt; 7577,n,MRCPRecog(<span class="hljs-meta"><span class="hljs-meta">&lt;?xml version=\"1.0\"?&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">grammar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">www.w3.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">2001</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">06</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">grammar</span></span></span><span class="hljs-tag">\" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xml:lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ru-ru</span></span></span><span class="hljs-tag">\" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">1.0</span></span></span><span class="hljs-tag">\" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">voice</span></span></span><span class="hljs-tag">\" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">root</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">test</span></span></span><span class="hljs-tag">\"&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rule</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">test</span></span></span><span class="hljs-tag">\"&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">one-of</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">one-of</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rule</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">grammar</span></span></span><span class="hljs-tag">&gt;</span></span>,f=hello&amp;b=1)</code> </pre> <br>  <b>Reference to grammar:</b> <br><pre> <code class="hljs php">exten =&gt; <span class="hljs-number"><span class="hljs-number">7577</span></span>,n,MRCPRecog(http:<span class="hljs-comment"><span class="hljs-comment">//192.168.1.1/digits.xml,f=hello&amp;b=1)</span></span></code> </pre> <br>  The parameters f = hello &amp; b = 1 provide sounding of the sound file, for example, ‚ÄúSpeak a number from 1 to 100‚Äù, which can be interrupted using the barge-in, i.e.  start talking, without having heard the message to the end and thereby start the recognition process. <br><br>  The recognition result is returned to Asterisk as NLSML in the $ {RECOG_RESULT} variable. <br>  Sample answer: <br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">result</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">grammar</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"C:\Documents and Settings\All Users\Application Data\Speech Technology Center\Voice Digger\temp\e856d208-7794-43b0-bb89-01947e37e655.slf"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interpretation</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">confidence</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"90"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">grammar</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"C:\Documents and Settings\All Users\Application Data\Speech Technology Center\Voice Digger\temp\e856d208-7794-43b0-bb89-01947e37e655.slf"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"speech"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">confidence</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"90"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">timestamp-start</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2011-07-04T0-00-00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">timestamp-stop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2011-07-04T0-00-00"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">instance</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">confidence</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"90"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SWI_literal</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SWI_literal</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SWI_grammarName</span></span></span><span class="hljs-tag">&gt;</span></span>C:\Documents and Settings\All Users\Application Data\Speech Technology Center\Voice Digger\temp\e856d208-7794-43b0-bb89-01947e37e655.slf<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SWI_grammarName</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SWI_meaning</span></span></span><span class="hljs-tag">&gt;</span></span>8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SWI_meaning</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">instance</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interpretation</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">result</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The most important parameters in this output are: <br>  Recognition result = "eight" <br>  Confidence Level = 90 <br>  Semantic tag: 8 <br><br>  At the initial stage, the application logic can be built using REGEX, for example <br><pre> <code class="hljs ruby">exten =&gt; <span class="hljs-number"><span class="hljs-number">8800</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,GotoIf(${REGEX(<span class="hljs-string"><span class="hljs-string">""</span></span> ${RECOG_RESULT})}?<span class="hljs-number"><span class="hljs-number">100</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre> <br>  More correct is the use of the NLSML parser. <br>  The parser that comes with VoiceNavigator is an Perl AGI script.  You can pass it the value of the variable exten =&gt; s, n, AGI (NLSML.agi, $ {QUOTE ($ {RECOG_RESULT})}) and as a result get the variables $ {RECOG_UTR0} = eight, $ {RECOG_INT0} = 8, $ { RECOG_CNF0} = 90. <br><br><h5>  An example of a simple voice number recognition application. </h5><br><pre> <code class="hljs xml">exten =&gt; 7577,1,Answer exten =&gt; 7577,n,MRCPSynth(     .   ) exten =&gt; 7577,n,MRCPRecog(<span class="hljs-meta"><span class="hljs-meta">&lt;?xml version=\"1.0\"?&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">grammar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">www.w3.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">2001</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">06</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">grammar</span></span></span><span class="hljs-tag">\" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xml:lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ru-ru</span></span></span><span class="hljs-tag">\" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">1.0</span></span></span><span class="hljs-tag">\" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">voice</span></span></span><span class="hljs-tag">\" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">root</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">test</span></span></span><span class="hljs-tag">\"&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rule</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">test</span></span></span><span class="hljs-tag">\"&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">one-of</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">one-of</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rule</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">grammar</span></span></span><span class="hljs-tag">&gt;</span></span>,f=beep&amp;b=1) exten =&gt; 7577,n,GotoIf(${REGEX("" ${RECOG_RESULT})}?one:if_2) exten =&gt; 7577,n(if_2),GotoIf(${REGEX("" ${RECOG_RESULT})}?two:if_3) exten =&gt; 7577,n(if_3),GotoIf(${REGEX("" ${RECOG_RESULT})}?three:error) exten =&gt; 7577,n(one),MRCPSynth(   ) exten =&gt; 7577,n,Hangup exten =&gt; 7577,n(two),MRCPSynth(   ) exten =&gt; 7577,n,Hangup exten =&gt; 7577,n(three),MRCPSynth(   ) exten =&gt; 7577,n,Hangup exten =&gt; 7577,n(error),MRCPSynth(    ) exten =&gt; 7577,n,Hangup</code> </pre> <br><br>  In the next series, we will discuss in more detail the synthesis tags used and the construction of recognition grammars. <br><br>  Waiting for your questions and comments. </div><p>Source: <a href="https://habr.com/ru/post/124946/">https://habr.com/ru/post/124946/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../124939/index.html">Droider Chart 62. Heroic hit parade of Android applications</a></li>
<li><a href="../124940/index.html">Payweb.com is a convenient and profitable tool for remunerating freelancers</a></li>
<li><a href="../124941/index.html">Microsoft proposes to heat servers at home</a></li>
<li><a href="../124942/index.html">Museum of video cards in Kharkov. History of creation</a></li>
<li><a href="../124943/index.html">How to become a member of the electronic bidding state order</a></li>
<li><a href="../124948/index.html">Good habits in PL / SQL</a></li>
<li><a href="../124952/index.html">Methods and tools for the protection of customers' personal data in solutions on the Bitrix platform</a></li>
<li><a href="../124953/index.html">The app RosYama for iPhone</a></li>
<li><a href="../124954/index.html">What letters open more often?</a></li>
<li><a href="../124955/index.html">Tablet Dropad A8X or the development of Chinese tablets over the past six months</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>