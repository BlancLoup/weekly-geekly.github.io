<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Functional tests: Django + Selenium WebDriver and 3 options of your choice</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúIn the life of every Django developer, there comes a moment when he vigorously vomits with his past, devoid of functional testing!‚Äù 
 About this and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Functional tests: Django + Selenium WebDriver and 3 options of your choice</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/bb6/3b6/16f/bb63b616fd4a4cfdaa11d6ffef967976.jpg" alt="image" width="50%"></div><br><blockquote>  ‚ÄúIn the life of every Django developer, there comes a moment when he vigorously vomits with his past, devoid of functional testing!‚Äù </blockquote><br>  About this and talk. <br><a name="habracut"></a><br>  This article is the result of finding the best testing tool for ready-made pages of a small project.  For the criterion for assessing the optimality of a tool, we conditionally take the minimum test execution time while striving for equal conditions of each of the sets of applications. <br><br>  The article discusses 3 options for functional testing of Django applications in Python 3.4 under Django 1.7 using Selenium WebDriver (there are articles on Habr√© with a detailed description of the features of Selenium <a href="http://habrahabr.ru/post/248559/">here</a> and <a href="http://habrahabr.ru/post/152653/">here</a> ).  And <a href="http://selenium-python.readthedocs.org/en/latest/api.html">then the</a> full information on the Selenium WebDriver API.  <a href="http://selenium.googlecode.com/svn/trunk/docs/api/py/index.html">More documentation</a> <a href="http://selenium2.ru/docs.html">in Russian</a> and <a href="http://forworktests.blogspot.ru/2013/03/selenium-web-driver.html">examples of use</a> . <br><br>  The tests used technologies and applications: VirtualBox 4.3.6, Debian 7.7, Virtualenv 12.0.7, Python 3.4, Django 1.7, Selenium Webdriver 2.47.3, Iceweasel, Xvfb, PyVirtualDisplay 0.1.5, PhantomJS 1.9.8, Nginx 1.2.1 , uWSGI. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Consider the following bundles for <b>Debian 7.7</b> + <b>Virtualenv 12.0.7</b> + <b>Django 1.7</b> +: <br><br><ul><li>  <b>1 option.</b>  <b>X.org</b> + <b>Selenium WebDriver</b> + <b>Firefox</b> ( <b>Iceweacel</b> for Debian) - with a graphical shell </li><li>  <b>Option 2.</b>  <b>Terminal</b> + <b>Selenium WebDriver</b> + <b>Xvfb</b> , <b>PyVirtualDisplay</b> - launch via terminal </li><li>  <b>3 option.</b>  <b>Terminal</b> + <b>Selenium</b> + <b>PhantomJS</b> - launch via terminal </li></ul><br>  Functional testing tools allow you to assess the performance of the target site and the behavior of pages in the browser, as well as help if the basic Django test client is not convenient for testing dynamically loaded data (using JavaScript, Ajax).  When different technologies are combined in a single product and a natural question arises how they will behave together in this or that case. <br><br>  With these tools, we can simulate real user behavior. <br><br>  Let's get started! <br><br>  In the virtual environment set Selenium: <br><br><pre><code class="bash hljs">pip install selenium</code> </pre> <br>  In our case, we will test the user authentication process, so we will create the tests.py file in the authentication application (Item B). <br><br><h4>  <b>Option 1.</b> Visual simulation of user behavior </h4><br>  <b>A. We</b> assume that the graphical user interface is installed, here - X.org. <br><br>  We put Debian Iceweasel (formerly Debian Firefox - modification of Mozilla Firefox browser in Debian GNU / Linux): <br><br><pre> <code class="bash hljs">sudo apt-get install iceweasel</code> </pre><br><blockquote>  <b><i>!</i></b>  <b><i>Note:</i></b> <br>  When we try to run the test from the terminal, without launching the graphical environment, we will get an exception: raise WebDriverException ("The browser appears to have exegee.common.exceptions.WebDriverException: If you Specified a log_file in the FirefoxBinary constructor, check it for details.) </blockquote><br>  <b>B.</b> Create a file tests.py. <br><br><div class="spoiler">  <b class="spoiler_title">Option 1</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    Django    Selenium from django.test import LiveServerTestCase #     ( FireFox) from selenium import webdriver import time class SeleniumTests(LiveServerTestCase): def test_auth(self): #  webdriver Firefox br = webdriver.Firefox() #    ,    'localhost:8081'   URL br.get('%s%s' % (self.live_server_url, '/')) #     br.find_element_by_xpath('//a[@href="/register/"]').click() #  3  time.sleep(3) #   #   username    'new' br.find_element_by_id('username').send_keys('new') #   email    'new@new.ru' br.find_element_by_id('email').send_keys('new@new.ru') #    2-  br.find_element_by_id('password1').send_keys('12345678') br.find_element_by_id('password2').send_keys('12345678') #     br.find_element_by_id('btn_register').click() #      pis = Myuser.objects.get(username='new') #    -  pis.is_active = True #    pis.save() #     br.find_element_by_xpath('//a[@href="/"]').click() #  3  time.sleep(3) #     br.find_element_by_id('username').send_keys('new') br.find_element_by_id('password').send_keys('12345678') br.find_element_by_name('').click() #         assert br.find_element_by_xpath('//a[@data-content=" "]').text == 'new' #  ,   br.quit()</span></span></code> </pre><br></div></div><br><blockquote>  <i><b>!</b></i>  <i><b>Note:</b></i> <br>  It is necessary to pause time.sleep (3) in the program text to avoid the error: ‚Äúselenium.common.exceptions.NoSuchElementException: Message: Unable to locate element: {" method ":" id "," selector ":" username "}" , ‚ÄúCan not find element‚Äù, caused by the fact that it did not have time to load the whole context of the page.  If an error occurs, you can increase the wait time. </blockquote><br>  <b>B.</b> Run our test from authentication / tests.py: <br><pre> <code class="bash hljs">python manage.py <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> authentication/</code> </pre><br>  More startup options. <br>  All project tests: <br><pre> <code class="bash hljs">python manage.py <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre><br>  Specific class SeleniumTests from tests.py: <br><pre> <code class="bash hljs">python manage.py <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> authentication.tests.SeleniumTests</code> </pre><br>  The test_auth method of the SeleniumTests class: <br><pre> <code class="bash hljs">python manage.py <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> authentication.tests.SeleniumTests.test_auth</code> </pre><br><br>  <u>TIME OF TEST WORK (Debian 7.7, VirtualBox, 12 Mb VideoRAM, 512 Mb RAM, 1 core): (29.89 + 25.65 + 26.73) / 3 = <b>27.42 sec</b></u> <br><br><h4>  <b>Option 2.</b> Running tests through the terminal without launching the GUI on xvfb + pyvirtualdisplay </h4><br>  <b>A.</b> To run from the console, you need to install the Virtualenv X server in a virtual environment: Xvfb and virtual display: Pyvirtualdisplay. <br><br><pre> <code class="bash hljs">sudo apt-get install xvfb pip install pyvirtualdisplay</code> </pre><br><blockquote>  <i><b>!</b></i>  <i><b>Note:</b></i> <br>  We set PyVirtualDisplay on behalf of a local user, otherwise when testing from under a user in the import line: from pyvirtualdisplay import Display, there will be an error. <br>  PyVirtualDisplay 0.1.5 officially supports python versions: 2.6, 2.7, 3.2, 3.3, tested at 3.4 - it works </blockquote><br>  <b>B.</b> Create a file tests.py.  To the previously described in Option 1 we add lines for working with a virtual display. <br><br><div class="spoiler">  <b class="spoiler_title">Option 2</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    from pyvirtualdisplay import Display #    Django    Selenium from django.test import LiveServerTestCase #     ( FireFox) from selenium import webdriver import time class SeleniumTests(LiveServerTestCase): def test_auth(self): #      display = Display(visible=0, size=(800, 600)) display.start() #  webdriver Firefox br = webdriver.Firefox() #    ,    'localhost:8081'   URL br.get('%s%s' % (self.live_server_url, '/')) #     br.find_element_by_xpath('//a[@href="/register/"]').click() #  3  time.sleep(3) #   #   username    'new' br.find_element_by_id('username').send_keys('new') #   email    'new@new.ru' br.find_element_by_id('email').send_keys('new@new.ru') #    2-  br.find_element_by_id('password1').send_keys('12345678') br.find_element_by_id('password2').send_keys('12345678') #     br.find_element_by_id('btn_register').click() #      pis = Myuser.objects.get(username='new') #    -  pis.is_active = True #    pis.save() #     br.find_element_by_xpath('//a[@href="/"]').click() #  3  time.sleep(3) #     br.find_element_by_id('username').send_keys('new') br.find_element_by_id('password').send_keys('12345678') br.find_element_by_name('').click() #         assert br.find_element_by_xpath('//a[@data-content=" "]').text == 'new' #    display.stop() #  ,   br.quit()</span></span></code> </pre><br></div></div><br>  <u>TEST WORKING TIME (Putty SSH, Screen, Virtualenv, Debian 7.7, VirtualBox, 12 Mb VideoRAM, 512 Mb RAM, 1 core): (28.5 + 25.82 + 24.98) / 3 = <b>26.43 sec</b></u> <br><br><h4>  <b>Option 3.</b> Running tests through the terminal without launching the GUI on PhantomJS </h4><br>  <b>A.</b> To run from the console, you need to install PhantomJS: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share sudo wget https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-1.9.8-linux-x86_64.tar.bz2 sudo tar xjf phantomjs-1.9.8-linux-x86_64.tar.bz2 sudo ln -s /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share/phantomjs-1.9.8-linux-x86_64/bin/phantomjs /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share/phantomjs sudo ln -s /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share/phantomjs-1.9.8-linux-x86_64/bin/phantomjs /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/phantomjs sudo ln -s /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share/phantomjs-1.9.8-linux-x86_64/bin/phantomjs /usr/bin/phantomjs</code> </pre><br>  And run: <br><br><pre> <code class="bash hljs">phantomjs -v</code> </pre><br><blockquote>  <i><b>!</b></i>  <i><b>Note:</b></i> <br>  If the received packet is not suitable for this system, we get an error: ‚ÄúI can not run a binary file‚Äù (Often due to an attempt to install a 64-bit application (x64) on a 32-bit system (x86)). </blockquote><br>  <b>B.</b> Create a file tests.py.  To the previously described in Option 1 we add lines for working with PhantomJS. <br><br><div class="spoiler">  <b class="spoiler_title">Option 3</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  PhantomJS from selenium.webdriver import PhantomJS #    Django    Selenium from django.test import LiveServerTestCase import time #   #     ( FireFox) #from selenium import webdriver class SeleniumTests(LiveServerTestCase): def test_auth(self): #   #  webdriver Firefox #br = webdriver.Firefox() #   PhantomJS br = PhantomJS() #    br.set_window_size(800, 600) #    ,    'localhost:8081'   URL br.get('%s%s' % (self.live_server_url, '/')) #     br.find_element_by_xpath('//a[@href="/register/"]').click() #  3  time.sleep(3) #   #   username    'new' br.find_element_by_id('username').send_keys('new') #   email    'new@new.ru' br.find_element_by_id('email').send_keys('new@new.ru') #    2-  br.find_element_by_id('password1').send_keys('12345678') br.find_element_by_id('password2').send_keys('12345678') #     br.find_element_by_id('btn_register').click() #      pis = Myuser.objects.get(username='new') #    -  pis.is_active = True #    pis.save() #     br.find_element_by_xpath('//a[@href="/"]').click() #  3  time.sleep(3) # : #     br.save_screenshot('screenshot_firstpage.png') #     br.find_element_by_id('username').send_keys('new') br.find_element_by_id('password').send_keys('12345678') br.find_element_by_name('').click() #         assert br.find_element_by_xpath('//a[@data-content=" "]').text == 'new' #  ,   br.quit()</span></span></code> </pre><br></div></div><br>  When creating a screenshot, PhantomJS has a problem with the background, while saving it is transparent (black background).  To correct this misunderstanding before br.save_screenshot ('screenshot_firstpage.png') you can use <br><div class="spoiler">  <b class="spoiler_title">such code:</b> <div class="spoiler_text">  br.execute_script ("" "(function () { <br>  var style = document.createElement ('style'), text = document.createTextNode ('body {background: #fff}'); <br>  style.setAttribute ('type', 'text / css'); <br>  style.appendChild (text); <br>  document.head.insertBefore (style, document.head.firstChild); <br>  }) (); "" ") <br></div></div><br><br>  <u>TIME TEST WORK <b>without creating a screenshot of the page</b> (Putty SSH, Screen, Virtualenv, Debian 7.7, VirtualBox, 12 Mb VideoRAM, 512 Mb RAM, 1 core): (14.64 + 14.89 + 13.05) / 3 = <b>14.19 sec</b> .</u> <br><br>  Added by: <br>  <u>TIME TEST WORK <b>with a screenshot of the page</b> (Putty SSH, Screen, Virtualenv, Debian 7.7, VirtualBox, 12 Mb VideoRAM, 512 Mb RAM, 1 core): (17.63 + 17.74 + 17.94) / 3 = <b>17.77 sec</b> .</u> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/68c/295/3fa/68c2953fa49f43018bd7aa740b8b0b00.jpg" alt="image"></div><br><hr><br><h4>  <b>Summary:</b> </h4><br>  Using Option 3 without page screenshot - [ <b>14.19 sec.</b>  ] provides <b>almost 2 times less time</b> for smoke breaks than Option 2 - [26.43 sec.] and Option 1 - [27.42 sec.] and is suitable for use on a combat server without a graphical shell.  But Option 1 is <b>visually informative</b> and convenient for preliminary tests during development, before rolling out the code to a combat server. <br><br>  PS  Here it is necessary to further note that in the test code a total of 6 seconds were used.  waiting <br><br>  Added by: <br>  Dear colleagues, what kind of bundles do you use in functional testing?  What are their advantages and disadvantages? <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/268385/">https://habr.com/ru/post/268385/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268375/index.html">Solving the problem of setting the screen resolution in Thinstation</a></li>
<li><a href="../268377/index.html">How to create a game on Unity3D without a mat</a></li>
<li><a href="../268379/index.html">Three holes in Scratch Mania</a></li>
<li><a href="../268381/index.html">Productive unit testing of web applications using the example of yii2 and codeception</a></li>
<li><a href="../268383/index.html">Transfer. I left my system fonts in San Francisco</a></li>
<li><a href="../268387/index.html">New scam: pay Bitcoins to save a hacked phone</a></li>
<li><a href="../268389/index.html">Codebattle: a game for programmers</a></li>
<li><a href="../268393/index.html">We diagnose the cause, survive in the JAR hell: do not breathe sulfur and do not cook in the boiler</a></li>
<li><a href="../268395/index.html">Tehnokniga, Part 4: literature on product management, web services development, web project management, business and systems analysis of architects</a></li>
<li><a href="../268397/index.html">How VMware DRS works</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>