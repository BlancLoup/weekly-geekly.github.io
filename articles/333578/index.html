<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>When the trees were big: how a small data center experienced a hurricane</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The summer of 2017 was rich in hurricanes. But we also had a case. Exactly 7 years ago, our first data center on Borovoy survived a hurricane that bur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>When the trees were big: how a small data center experienced a hurricane</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/b0a/f7d/5e5/b0af7d5e5354444d93632d17d0e47cf7.JPG"><br><p><br>  The summer of 2017 was rich in hurricanes.  But we also had a case.  Exactly 7 years ago, our first data center on Borovoy survived a hurricane that buried chillers under a layer of 10 tons of iron, flown in from a nearby roof.  Sensory photographs of worn chillers have been posted online a long time ago, and the story of restoring the data center without cold has never been published.  I decided to raise the archives and fill the gap. <a name="habracut"></a></p><br><p>  In 2010, DataLine was a novice data center operator.  At the OST site, only three halls with 360 posts were launched, in the north of Moscow (NORD) there was one building with one hall with 147 stands. </p><br><img src="https://habrastorage.org/web/595/766/cfe/595766cfea59477aa295134374eddce0.PNG"><br><p>  <em>This is how the scale of our infrastructure has changed since 2010.</em> </p><br><p>  Although we ourselves designed and built, then we did not have a dedicated maintenance service.  There was, as now, some specialists in diesel power plants, air conditioners, electricians - they gave everything to the maximum to the contractors.  Infrastructure volumes were small, as was our experience.  The production director, the chief power engineer and I, the technical director, were then responsible for the engineer.  There were also <a href="https://habrahabr.ru/company/dataline/blog/323136/">engineers on duty in the pickup</a> (three in a shift), but they were engaged in client requests and monitoring. </p><br><img src="https://habrastorage.org/web/f94/374/748/f94374748d0346dd838bfccd5ed20767.JPG"><br><p>  <em>One of the first halls of the OST-1 data center at the end of 2009.</em> </p><br><img src="https://habrastorage.org/web/cc1/006/482/cc100648239a46718ecf4b2d1ec9427d.jpg"><br><p>  <em>This is how new halls look in OST today.</em> </p><br><p>  Three rooms on Borovaya were filled only half.  There were few customers, one hand would be enough for recounting. </p><br><p>  The site operated an ethylene glycol chiller circuit with three Emicon chillers in a 2 + 1 redundancy scheme.  I must say, these chillers did not reach the capacity declared by the manufacturer, but since the load was small, one chiller was almost enough for all three rooms. </p><br><h2 id="den-pervyy">  The first day </h2><br><p>  July 20 was the heat for thirty.  In this weather, the chillers were bad, so when it began to rain towards the end of the working day, I was delighted, hoping that the chillers would feel better.  A strong wind rose with the rain, and now I see metal sheets flying by from the window of my office.  He went out into the street, and on the other side of the road there were pieces of roof.  Surprisingly, none of the cars of employees, parked near the data center, did not suffer much. </p><br><img src="https://habrastorage.org/web/9bb/09c/34b/9bb09c34bcc64bb18cdfc1464c756910.JPG"><br><p>  <em>Roof iron hung from wires like linen.</em> </p><br><p>  Then I thought that it would be necessary to check the chillers, because the metal flew from their side.  Together with colleagues we climbed onto the roof and saw a terrible picture: all three chillers were inundated with iron beams and sheets. </p><br><img src="https://habrastorage.org/web/a87/a34/03a/a87a3403ad264de6aefc4ddea0b2b740.JPG"><br><br><img src="https://habrastorage.org/web/9a9/4d0/b27/9a94d0b271ce49fe994e25e93a47307f.JPG"><br><br><p>  By recording the video surveillance system can be seen that all the iron flew in one powerful gust of wind.  Here is what we later saw from the recording of one of the cameras: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/-Gtz5rWBLFQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <em>In the video clock is lagging behind.</em>  <em>When everything happened, it was already 18.18.</em> </p><br><p>  The scale of the disaster turned out to be impressive.  At one chiller, the flown iron struck a free-cooling heat exchanger (external circuit of the chiller), the second one had damaged fans, and the third, besides all the above, rotating twisted fans had time to touch and chop the freon tubes inside the chiller.  By the time we were on the roof, two of the three chillers had already stopped. </p><br><img src="https://habrastorage.org/web/c5a/c85/ccf/c5ac85ccfc39456096d1ce2bc6482d8b.JPG"><br><p>  <em>Damaged frame and heat exchanger of the first chiller free cooling.</em>  <em>The heat exchanger is a ‚Äúsandwich‚Äù: on the outside is a free cooling jacket, inside, with a gap of five centimeters, the same kind of freon condenser heat exchanger.</em> </p><br><img src="https://habrastorage.org/web/62d/04b/4d8/62d04b4d833e4804b7f5b548b6a6b205.JPG"><br><p>  <em>Twisted fans of one of the chillers.</em> </p><br><p>  From the punched heat exchangers frikulinga lashed glycol.  The pressure in the cold supply system has plummeted.  The pumps stopped for protection against dry running, the last working chiller passed out, and the entire cold supply system rose (it was 18:32, two minutes after the working day ended).  For a few seconds we were in a stupor and did not know what to do.  Then they called the cold supply contractor and called an emergency brigade.  On the phone, the contractor advised to block the external circuit, explained where the necessary valves and faucets of the makeup system are located.  We shut off the valves supplying external heat exchangers, the glycol ceased to flow. </p><br><p>  It was getting hot in the cold halls of the engine rooms.  Realizing that we will not be able to quickly restore the cold supply, at 19:10 we started calling our customers not just with an alert about the accident, but with a request to turn off the computing equipment in order to avoid its failure.  We have not seen another option.  Some customers refused to shut down and took risks.  Some brought portable air conditioners for their racks to the site. </p><br><p>  At 18:51, they began to refuel the glycol circuits with tap water and gradually brought the pressure in the system to a worker. <br>  At 19.45 an emergency crew arrived. <br>  At 19.53 the pumps started up, but only one of three chillers started working.  The other had damaged fans, and the third one also had a freon circuit. </p><br><p>  While we were doing all these exercises, the temperature of the glycol managed to rise from working values ‚Äã‚Äã(7‚Äì12 ¬∞ C) to 20 degrees.  One live chiller was working with overload, and periodically one of its two circuits stopped by mistake.  After that, it was necessary to manually reset the error on the remote, and after five minutes (guard interval) the compressor started.  Or did not start.  Then a complete blackout of the chiller with a reboot helped. </p><br><p>  All those who were in the office at that moment participated in the release of the chillers from the ‚Äúflying‚Äù scrap metal and helped the emergency team to pick up another worker from the two killed chillers. </p><br><img src="https://habrastorage.org/web/0d6/4b7/207/0d64b72079304f7b8e3fc259c7d6a1b1.JPG"><br><p>  <em>The capital construction director then tore his back, throwing off the steel beams from the chillers.</em> </p><br><p>  Fans were removed from the chiller with punched freon tubes.  Not without powerlifting - each fan weighs under 30 kg.  By 23:00, at the very least, the second chiller was assembled and started up, and the temperature in the halls began to drop slowly. </p><br><p>  By that time it was dark, but the most interesting was just beginning.  Chillers began to bounce on protection due to overheating of compressors: the glycol temperature was still high despite the shutdown of most customers. </p><br><p>  The head of production went and bought Karcher, hoses and headlamps so that you can work at night.  We poured cold water on the chiller compressors, but this didn‚Äôt help much, as the compressor is a piece of iron weighing more than a ton and can not be cooled quickly.  Now, when the chiller stopped by mistake, instead of five minutes, it was necessary to wait several tens of minutes until the compressor cooled down and the Compressor Overload error disappeared. </p><br><img src="https://habrastorage.org/web/c09/10d/420/c0910d420d7144429d9f562e5b15a2b0.JPG"><br><p>  <em>The error message that we were shown in turn one or another chiller.</em> </p><br><p>  In the deep of the night, something happened that we were afraid of: the accident simultaneously stopped both chillers and could not bring them together anymore.  Of the four units of the first and second chillers, one or two worked, the rest in turn remained in a comatose state on the occasion of an overload.  The temperature in the halls stopped at about 30 degrees.  All the doors to the engine rooms were open.  This allowed to somehow get rid of the accumulated heat. </p><br><p>  Together with the contractors we went to study the chiller circuits.  After long and serious deliberation, they suggested under our responsibility to do what is impossible to do: bypass the protection by putting jumpers, i.e.  short circuit the thermal protection relay.  It was a direct way to finally kill the compressors, but there were no other options.  At three o'clock in the morning the chillers started and did not stop anymore.  The temperature in the cold corridors began to come in line with the SLA. </p><br><img src="https://habrastorage.org/web/f50/6a1/93a/f506a193a9064ebf8dd425e70aa4d333.PNG"><br><p>  <em>Temperature change in cold corridors from the beginning of the accident to its elimination.</em> <em><br></em>  <em>1 - time of the first stop of all chillers;</em>  <em>2 - start time of the first chiller;</em>  <em>3 - start time of the second chiller;</em>  <em>4 - restart chillers;</em>  <em>5 - start chillers with thermal protection disabled.</em> </p><br><p>  From the beginning of this disgrace, for the first time we had the opportunity to take a breath and, in a slightly calmer mode, think about what to do next.  According to forecasts, tomorrow they promised a hot day again, and we have two chillers working on parole. </p><br><h2 id="den-vtoroy">  Second day </h2><br><p>  The morning of the next day caught us assembling a home-made irrigation system: water pipes were put on the roof and holes were punctured in the garden hose. </p><br><p>  The hydrometeorological center did not deceive: the inferno again was below 30 ¬∞ C. From this system collected on the knee and Karcher, we watered the chillers practically without stopping, which continued to work with the thermal protection turned off. </p><br><img src="https://habrastorage.org/web/e27/688/d98/e27688d9877e443fb6ba3f2a6ee37b09.JPG"><br><p>  <em>But the historical frame: the chillers are rescued by the network engineer on duty, Grigory Atrepyev, now the head of the integrated projects department.</em> </p><br><p>  The temperature of the glycol was able to return to normal.  In total, they worked for three days in this mode, after which they restored the thermal protection of the compressors.  Within a couple of days the punched freon tubes of the third chiller were sealed, evacuated and filled with freon.  While waiting for the supply of fans to replace the broken, only half of the third chiller worked. </p><br><img src="https://habrastorage.org/web/80f/fa5/924/80ffa5924d444f33ab7b2f5b04a85cac.JPG"><br><p>  <em>Replacing the fans on the third chiller.</em>  <em>Chiller Emicon RAH1252F with the option of free cooling (free cooling) consists of two modules, each of which costs 8 axial fans and a Bitzer compressor.</em> </p><br><img src="https://habrastorage.org/web/3f1/e9e/efd/3f1e9eefd2c14c9b9a6bf5794333864f.JPG">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/web/4cf/28f/91e/4cf28f91e7ba4b20a7d19db727b03f88.JPG"><br><br><img src="https://habrastorage.org/web/902/4f1/56e/9024f156e7d4465db04b82df42a05dfa.JPG"><br><br><img src="https://habrastorage.org/web/9ad/d7b/706/9add7b70614b4c6d923ca803c179078a.JPG"><br><p>  <em>Freon refilling.</em> </p><br><img src="https://habrastorage.org/web/37b/42c/26a/37b42c26aa43409c8333a3d788556bb9.JPG"><br><p>  <em>View of the backyard the next day.</em>  <em>Scrap metal was taken out for a long time.</em> </p><br><h2 id="chto-bylo-dalshe">  What happened next </h2><br><p>  <strong>Chillers</strong>  The damage was serious, and we spent some more time on repairs.  After the bullying, the compressors served for about a year, after which they began to fail: for two chillers, work without protection affected, in the third chiller we seemed to be in a hurry to refill the freon circuit (we didn‚Äôt evacuate well enough, leaving traces of moisture).  Oil samples taken from the still-living freon circuits showed a high level of acidity, heralding the imminent end of the motor winding.  During the second year after the accident, we replaced almost all of the compressors of the affected machines.  We tried to repair one of the compressors, giving it to rewind, but after repairing it, it stretched for a few months and burned again, so we considered it good to buy new ones in the future. </p><br><p>  The water with which we refueled the glycol circuit did not affect the frost resistance of the system.  Measurements showed that the concentration of ethylene glycol remained at a sufficient level. </p><br><p>  Since the chillers did not deliver the declared cooling capacity (and the IT load grew as the data center was filled), it was necessary to continue to water them in the heat.  The heat exchangers did not survive the water procedures: over the years, they were overgrown with lime deposits, and any dirt that the design did not allow was crammed into the gap between the free-cooling heat exchanger and the freon condenser.  After a few years, we planned to replace two of the three chillers (this will also be a fascinating story, this time without sacrifices), and the remaining heat exchangers of free cooling were cut off.  Now on the OST site there are 4 chillers: two Stulz, Hiref (added when the data center grew) and one old Emicon. </p><br><img src="https://habrastorage.org/web/736/955/eb3/736955eb30b4407a94c082d4a4170151.jpg"><br><p>  <em>Chillers at the OST site in 2017.</em> </p><br><p>  <strong>Customers</strong>  Despite this nightmare of exploiter, clients reacted with our misfortune with understanding and even no one moved away from us. </p><br><p>  It was remembered that in order to obtain insurance for chillers and for a report to the affected clients, a local hurricane certificate was obtained from the Hydrometeorological Center for a long time. </p><br><h2 id="orgvyvody">  Organizational Conclusions </h2><br><p>  It is difficult to prepare for such force majeure in advance, but it is important to draw the right conclusions from any accident.  Our sweat and blood were: </p><br><ol><li><p>  In Moscow, too, there are hurricanes.  It is now that every day, the storm warning, but then it was a novelty.  After that accident, when choosing a site or a finished building for a data center, we especially carefully consider whether there are dangerous conditional sheds and other flimsy buildings in dangerous proximity.  Of course, the roof, which arrived on our chillers, was blocked by the neighbors under our strict control. </p><br></li><li><p>  We began to buy spare parts (fans, compressors, freon stock, etc.) and keep it in our possession.  The restoration would have been faster if we had at least spare fans on the site.  At that time, the delivery of the required quantity had to wait for several weeks. </p><br></li><li><p>  Willy-nilly figured out the device chillers, they are no longer for us "black boxes".  This was useful to us later, because the wonderful refrigerators did not stop breaking. </p><br></li><li><p>  Conducted on the roof of the water.  For new data centers we do this by default.  Water is useful for flushing chillers or external blocks from dirt accumulated during the autumn and winter, will help fight off poplar fluff in summer and make life easier for the cold supply system in conditions of abnormal heat. </p><br></li><li><p>  They blew monitoring and began to measure everything that is possible: pressure at several points, the condition of the pumps, the temperature of the forward and reverse glycol, the power consumption of chillers, etc.  In this situation, alerts would help us detect the problem earlier and begin to act faster. </p><br></li><li><p>  We set up remote control of chillers from the monitoring center. </p><br></li><li><p>  Synchronized clocks on all systems in order to have a clear picture of developments in the analysis of accidents. </p><br></li><li>  They have become very attentive, even skeptical to look at the figures that equipment manufacturers say.  The power of the chiller is not just a number, it depends in a complex way on the temperature of the outside air and the coolant and, as usual, it is lowest in the heat when it is most needed. </li></ol><br><p>  We also took great care to work through all the key processes, we documented and accompanied with charts everything we could reach, and introduced regular military exercises.  And if some Armageddon happens tomorrow, our data centers will not be saved by 3.5 people in the improvisation genre, but by a large and experienced operation service with clear, tested instructions.  This allows us not only to manage an ever-growing network of seven data centers, but also to successfully pass audits and certifications of the most respected and rigorous organizations like Uptime institute. </p><br><p>  And what kind of natural disasters did your server / data center have to go through and what useful conclusions did you draw for yourself? </p></div><p>Source: <a href="https://habr.com/ru/post/333578/">https://habr.com/ru/post/333578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333564/index.html">Disable any items from our DOM tree using MutationObserver</a></li>
<li><a href="../333566/index.html">Telephone technical support - as we began to greet the customer by name</a></li>
<li><a href="../333568/index.html">Selenium: simpler than steamed turnip ...</a></li>
<li><a href="../333572/index.html">MEGA is looking for ideas: a new season</a></li>
<li><a href="../333576/index.html">Blockchain: a revolution for which we are not ready</a></li>
<li><a href="../333580/index.html">npm link on steroids</a></li>
<li><a href="../333582/index.html">Search InterSystems documentation using iKnow and iFind technologies</a></li>
<li><a href="../333584/index.html">A collection of developer tools</a></li>
<li><a href="../333586/index.html">Bot for Telegram for 48 hours on Perl or how to buy cat food without leaving the chat</a></li>
<li><a href="../333588/index.html">Debugging the Android application using a browser</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>