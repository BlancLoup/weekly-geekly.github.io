<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Completion of the Chinese ST-Link v2: add the SWO debug information output interface and foot reset</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Geektimes! 

 Today I want to tell you about the finalization of the Chinese soldering iron ST-Link v2. You can add SWO output to it to get debug ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Completion of the Chinese ST-Link v2: add the SWO debug information output interface and foot reset</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/787/620/d54/787620d546cf4b1d8feec8b40b689ce4.jpg" alt="image" align="left" width="300">  Hi, Geektimes! <br><br>  Today I want to tell you about the finalization of the Chinese soldering iron ST-Link v2.  You can add SWO output to it to get debug information and a Reset control foot for STM32 microcontrollers (that foot Reset, which is already there, for STM8).  Perhaps for many this is not a discovery, but let there be information for beginners.  Who cares, I ask under the cat. <br><a name="habracut"></a><br>  <b>Why is it necessary?</b> <br><br>  The SWD interface used for debugging STM32 microcontrollers supports transferring debug information through SWO output in real time, which is very convenient.  Well, the Reset foot is needed so that you can comfortably flash the controller in case the SWD interface is disabled.  The reason of course is far-fetched, because for the firmware you can always press the Reset button with handles, but let it be.  For example, at the dawn of my acquaintance with STM32, I received a debug board from China with an LED blinking demo program and SWD turned off, I did not immediately understand how to connect to it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Refinement itself</b> <br><br><img src="https://habrastorage.org/files/899/51c/4ed/89951c4eda6b4cb587b53f23659d4cee.jpg" align="right" width="300">  We will need a scalpel, a soldering iron and a few centimeters of very thin wire; I have this MGTF * some kind of it *.  On these programmers, the connector is divided into two parts: the left - for STM8 and the right - for STM32, so the Reset existing there is not suitable for STM32, we will make our own. <br><br>  First of all, cut the paths leading to unnecessary pins.  At my first modified programmer, I cut off the Reset and SWIM legs, because I did not plan to work with STM8, but now I will use extra pins 3.3 and 5 V (they are duplicated on the connector), so as not to spoil the functionality of the programmer, it will suddenly come in handy. <br><br>  The wires must be soldered to the 18 (Reset) and 31 (SWO) legs of the microcontroller.  This is still an occupation, but with a certain skill it can be done.  I had wires well entered into the holes on the board, which gave additional fixation.  In general, in a good way, you must immediately fix them with glue on the microcontroller.  Solder free ends through small resistors (let it be 22 Ohms) to the newly cut pins. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2ad/30d/69c/2ad30d69cc6a4d2095fcb92875a77e5c.JPG" width="650"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c7a/e5e/003/c7ae5e003f0d41d9be9b32b3b872b867.JPG" width="650"></div><br>  You can close the case and sign new conclusions, so as not to forget where it is. <br><br>  <b>SWO check</b> <br><br><img src="https://habrastorage.org/files/01b/a52/4e5/01ba524e54204665b9d94dc88cba5133.JPG" height="300"><img src="https://habrastorage.org/files/0c7/dac/f7e/0c7dacf7ee2342169416f2fbc9e09a5a.jpg" height="300"><br><br>  To use <b>SWO</b> you need: <br><br>  - activate <b>SWD</b> ; <br>  - enable the appropriate output (for STM32F103C microcontrollers this is PB3) on <b>TRACESWO</b> ; <br>  - make sure that <b>SWO is</b> enabled in the programming environment, and not <b>semihosting</b> ; <br>  - connect the library <b>#include ‚Äústdio.h‚Äù</b> in the program header; <br>  - in the program code use <b>printf (‚ÄúHello STM32 world! \ R \ n‚Äù)</b> ; <br><br>  You can view these messages through the terminal in the STM32 ST-LINK Utility program, or directly during debugging in your environment (I use IAR). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c6e/3ef/eb1/c6e3efeb106649cba150fab72019fe28.jpg"></div><br>  <b>Reset check</b> <br><br>  Suppose for some reason SWD is disabled on the microcontroller: either you forgot to enable it during initialization, or a new board came with a wired demo program.  Of course, you can sew up by pulling the Reset leg to the ground (usually there is a button on the debug boards), but this is not always convenient.  After all, you can simply connect a contact from the programmer and sew in automatic mode. <br><br>  In the same program STM32 ST-LINK Utility, select "Connect under reset" and connect to the firmware or memory of the microcontroller. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d29/db8/bbd/d29db8bbde2e4ed39c2467d539f670d7.jpg"></div><br>  Or, in your IDE, select the appropriate item: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c7b/b32/019/c7bb32019c2242cb85e20d53da2f5eba.jpg"></div><br>  This will allow you to flash and enter the debug mode, but as soon as you reach the initialization of the peripherals, the SWD will be turned off and the connection with the controller will be lost. <br><br>  Thank you for your attention, I hope someone will come in handy. </div><p>Source: <a href="https://habr.com/ru/post/402927/">https://habr.com/ru/post/402927/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../402915/index.html">We test the modular printer "3D START" - part 3. Program settings for the display</a></li>
<li><a href="../402919/index.html">Frequency response graphs for headphones Bluedio and other brands: understand, expose, choose</a></li>
<li><a href="../402921/index.html">Catch us if you can</a></li>
<li><a href="../402923/index.html">Citizenship by DNA, or whether Jews buy genetic tests</a></li>
<li><a href="../402925/index.html">Israeli experts found 40 zero-day vulnerabilities in Samsung's Tizen OS</a></li>
<li><a href="../402929/index.html">MPTU-2-48</a></li>
<li><a href="../402931/index.html">What happened before the Big Bang? [Fraser Cain]</a></li>
<li><a href="../402937/index.html">The practice of choosing speakers: an interview with an expert Pult.ru</a></li>
<li><a href="../402939/index.html">Hollywood Writers Guild may go on strike because of streaming services</a></li>
<li><a href="../402941/index.html">Pebble smart watches untie from cloud sync</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>