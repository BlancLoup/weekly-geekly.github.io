<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>3D printer without a computer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear habravchane! 
 That ended my move, the candidate minimum was handed over, the first plastic coil was over and it was time to write the pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>3D printer without a computer</h1><div class="post__text post__text-html js-mediator-article">  Hello, dear habravchane! <br>  That ended my move, the candidate minimum was handed over, the first plastic coil was over and it was time to write the promised article about the e-stuff of my printer. <br>  This article will discuss the automation of my PRUSA I3 3D printer, namely the connection of the screen, buttons (instead of the encoder) and the card reader and the power supply system for all additional electronics. <br>  For details, I ask under the cat. <br><a name="habracut"></a><br>  I would like to make a reservation right away that I took the items for these fees from my inventory.  What was at hand. <br><br><h5>  Let's start with food. </h5><img width="380" height="214" align="right" src="https://habrastorage.org/files/eba/c0e/c5d/ebac0ec5d563422191f3d5b0cdd811d0.jpg"><br>  It's simple.  A 5 volt stabilizer (I took a L7805CV with an output current of up to 1.5A) to power the arduin and the display.  Strapping - two capacitors.  The stabilizer is connected to 12 volts.  From it through the resistor we connect the LED to indicate the operation.  The 3.3 volt voltage stabilizer (LD1117A33 with an output current up to 1A) connects the power supply to the SD card to 5 volts.  Piping is the same - two capacitors (well, by analogy, a LED through a resistor). <br>  Specific values ‚Äã‚Äãfor capacitors are selected according to the specification of stabilizers, the values ‚Äã‚Äãof the resistors for the current consumption of the diodes and the supply voltage (well, or empirically). <br><br>  On the RAMPS there is a place for soldering the diode D1.  When it is connected to the pin Vin, the Arduin is fed 12 volts and goes to the stabilizer on the Arduin.  At first I soldered it, and it all even worked together, but after a few minutes the printer just turned off and it was impossible to turn it on without connecting the USB cable (probably, the stabilizer overheated or burned out).  Therefore, it was decided to pull out the diode and connect an external stabilizer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Card reader </h5><img width="350" height="360" align="right" src="https://habrastorage.org/files/942/484/a12/942484a12bd74f0e9f111358784a112a.JPG"><br>  To power the memory card, you need 3.3 volts, the logic levels of the card are also 3.3 volts.  In the finished modules called SDRamps, a stabilizer is used (we have already assembled it) and a level converter chip (5-&gt; 3.3).  Since I did not have such a chip, it was therefore decided to use a conventional resistive divider. <br>  The card is connected in SPI mode.  Used: 3 lines SCK, CS, MOSI from arduin to the map through dividers;  line MISO directly from the map to arduine;  3.3 volts power supply is also connected;  land;  and I also connected the card availability detector.  The cardholder was dropped from the old smartphone, but you can use the SD-microSD adapter (but it does not have a card presence detector). <br><br><h5>  Screen </h5><br>  Any character display, ranging from 2 lines by 16 characters, will do.  The more rows, the more data on it can be displayed.  You can also connect the graphic display SPI LCD 128x64 (Controller ST7565R graphic Display Family).  We connect according to the scheme described <a href="http://reprap.org/wiki/RAMPS_LCD">here</a> .  4 data lines, RS, Enable, 5 volts, ground and a 10kŒ© trimmer for contrast adjustment. <br><br><h5>  Buttons </h5><br>  Since I did not find the encoder, I decided to do with the button interface.  Any 3 buttons will do.  True, you will have to edit the firmware, but more on that later. <br><br><h5>  Mosfet on a heated table </h5><img width="300" height="169" align="right" src="https://habrastorage.org/files/4d6/413/2f3/4d64132f303246ad8c8d8c08014c9528.jpg"><br>  As I mentioned in the last article, this very mosfets are very hot due to improper operation.  I replaced it with the APM2509N, taken from a video card.  Were also increased the power paths of the table.  Scalpel neatly cut the lacquer coating and soldered with a thick layer of solder.  The previous mosfet was heated in such a way that after 30-50 minutes it was possible to burn a finger on it.  A new maximum heated to 38 degrees for 6 hours printing.  And yes, the mosfet stands without a radiator. <br>  The table now heats up to 100 ¬∞ C in 15-17 minutes (earlier than 30 minutes).  And the LED on the table began to shine somehow brighter (or maybe it only seems). <br><br><h5>  We connect </h5><br>  The output from the 5 volt stabilizer is connected to any pin 5V on the RAMPS. <br>  The cardriader is connected to the AUX-3 connector (RAMPS pins on the left, SD on the right): <img width="150" height="140" align="right" src="https://habrastorage.org/files/aa4/e25/504/aa4e2550499f40ea8b2c22a1124e2135.JPG"><br>  pin D50 (MISO) - DO (MISO); <br>  pin D51 (MOSI) - divider - DI (MOSI); <br>  pin D52 (SCK) - divider - SCK; <br>  pin D53 - divider - CS; <br>  3.3 volts (with stabilizer) - VCC; <br>  GND - GND (VSS); <br>  and in the presence of SD Detect we connect the pin D43 of the AUX-4 connector to it. <img width="130" height="450" align="right" src="https://habrastorage.org/files/741/4ba/c1b/7414bac1bca94d289693ca62d2f58cc6.JPG"><br><br>  The buttons and the display are connected to the AUX-4 connector. <br>  Display (on the left is the RAMPS pins, on the right is the display (the data bus starts with D0)): <br>  pin D16 - RS; <br>  pin D17 - Enable (E); <br>  pin D23 - Data 4 (D4); <br>  pin D25 - Data 5 (D5); <br>  pin D27 - Data 6 (D6); <br>  pin D29 - Data 7 (D7); <br>  5 volts - VDD; <br>  GND - VSS; <br>  The trimmer resistor is connected to 5 volts and ground, and the output to pin VO (contrast); <br>  Pin RS display connect to the ground; <br>  In the presence of illumination, we connect 5 volts through a 1.8k ohm resistor and ground. <br><br>  The buttons are connected to the ground and: <br>  pin D31 - Up; <br>  pin D33 - Down; <br>  pin D35 - Click; <br>  By default, these pins are configured in the firmware.  To connect to others, you need to correct the file pins.h in the firmware. <br><br>  To start support for SD cards, character display and buttons in the firmware, uncomment the line in the configuration.h file: <br><pre><code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> REPRAP_DISCOUNT_SMART_CONTROLLER</span></span></code> </pre> <br>  At the same time, ULTIPANEL, NEWPANEL, SDSUPPORT and ULTRA_LCD are automatically detected, which are responsible for the operation of the display, buttons and the card reader. <br>  The name of the printer displayed on the screen is given by the line: <br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CUSTOM_MENDEL_NAME </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"This Mendel"</span></span></span></span></code> </pre> <br>  The number of characters and lines of the display is set by the parameters LCD_WIDTH and LCD_HEIGHT, respectively: <br><div class="spoiler">  <b class="spoiler_title">set the display size</b> <div class="spoiler_text"><pre> <code class="hljs smalltalk"><span class="hljs-symbol"><span class="hljs-symbol">#ifdef</span></span> <span class="hljs-type"><span class="hljs-type">ULTIPANEL</span></span> // <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">NEWPANEL</span></span> //enable this if you have a click-encoder panel <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">SDSUPPORT</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">ULTRA_LCD</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#ifdef</span></span> <span class="hljs-type"><span class="hljs-type">DOGLCD</span></span> // <span class="hljs-type"><span class="hljs-type">Change</span></span> number of lines to match the <span class="hljs-type"><span class="hljs-type">DOG</span></span> graphic display <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">LCD_WIDTH</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">LCD_HEIGHT</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#else</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">LCD_WIDTH</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> //   <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">LCD_HEIGHT</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> //   <span class="hljs-symbol"><span class="hljs-symbol">#endif</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#else</span></span> //no panel but just <span class="hljs-type"><span class="hljs-type">LCD</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#ifdef</span></span> <span class="hljs-type"><span class="hljs-type">ULTRA_LCD</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#ifdef</span></span> <span class="hljs-type"><span class="hljs-type">DOGLCD</span></span> // <span class="hljs-type"><span class="hljs-type">Change</span></span> number of lines to match the <span class="hljs-number"><span class="hljs-number">128</span></span>x64 graphics display <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">LCD_WIDTH</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">LCD_HEIGHT</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#else</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">LCD_WIDTH</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">LCD_HEIGHT</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#endif</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#endif</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#endif</span></span></code> </pre></div></div><br>  To support buttons instead of an encoder in the ultralcd.cpp file <div class="spoiler">  <b class="spoiler_title">find strings</b> <div class="spoiler_text"><pre> <code class="hljs bash"> //manage encoder rotation uint8_t enc=0; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(buttons&amp;EN_A) enc|=(1&lt;&lt;0); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(buttons&amp;EN_B) enc|=(1&lt;&lt;1); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(enc != lastEncoderBits) { switch(enc) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> encrot0: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(lastEncoderBits==encrot3) encoderDiff++; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(lastEncoderBits==encrot1) encoderDiff--; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> encrot1: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(lastEncoderBits==encrot0) encoderDiff++; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(lastEncoderBits==encrot2) encoderDiff--; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> encrot2: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(lastEncoderBits==encrot1) encoderDiff++; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(lastEncoderBits==encrot3) encoderDiff--; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> encrot3: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(lastEncoderBits==encrot2) encoderDiff++; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(lastEncoderBits==encrot0) encoderDiff--; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } } lastEncoderBits = enc;</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">change to</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">//manage encoder rotation uint8_t enc=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(buttons&amp;EN_A) { encoderDiff = <span class="hljs-number"><span class="hljs-number">1</span></span>; delay(<span class="hljs-number"><span class="hljs-number">10</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(buttons&amp;EN_B){ encoderDiff = <span class="hljs-number"><span class="hljs-number">-1</span></span>; delay(<span class="hljs-number"><span class="hljs-number">10</span></span>); }</code> </pre></div></div><br>  With proper assembly, after pouring the firmware, you can remove the USB cable in the drawer and print from the SD card. <br><br>  That's all for now.  As usual, I look forward to questions and comments. <br><br>  PS In the near future I plan to put the auto-calibration of the table with the servomotor.  And assemble the frame of the second printer. </div><p>Source: <a href="https://habr.com/ru/post/231743/">https://habr.com/ru/post/231743/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../231731/index.html">Library for automating acceptance testing in mobile applications</a></li>
<li><a href="../231733/index.html">History of Audiomania. Part 1</a></li>
<li><a href="../231735/index.html">Connecting the display of the DVD player to the microcontroller</a></li>
<li><a href="../231739/index.html">Classes in Swift [Part 1]</a></li>
<li><a href="../231741/index.html">Microsoft case: how to avoid contradictions by working with personal data in Europe and the USA?</a></li>
<li><a href="../231745/index.html">Highly loaded sites and applications in PHP / Symfony</a></li>
<li><a href="../231747/index.html">ONLYOFFICE. Naked Truth About Cloud Office Source Code</a></li>
<li><a href="../231749/index.html">Huawei Ascend P7: tested in humans</a></li>
<li><a href="../231751/index.html">The life of the data center after commissioning</a></li>
<li><a href="../231755/index.html">The program and course materials "Multicore programming in Java"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>