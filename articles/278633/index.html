<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to write a simple blog using Asp .Net MVC, Nhibernate and Ninject. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Transfer 


1. Introduction There are various ways to study technology: reading books, participating in conferences, creating examples and others. I t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to write a simple blog using Asp .Net MVC, Nhibernate and Ninject. Part 1</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://prideparrot.com/blog/archive/2012/12/how_to_create_a_simple_blog_part1">Transfer</a> <br><ol><li><h3>  Introduction </h3><br>  There are various ways to study technology: reading books, participating in conferences, creating examples and others.  I think one of the best ways is to create something useful for myself using the technology being studied.  A blog is one of the useful things you can easily do.  In a series of articles, we will explore ASP.NET MVC, step by step, by creating a blog from scratch. <br><a name="habracut"></a><br>  For simplicity, we will not build a commenting system; instead, we will use <a href="https://disqus.com/">Disqus</a> .  Try creating a commenting system yourself; this will be a good exercise for you. <br><br>  We will use ASP.NET MVC 4 to develop the application. I am not strong in the Entity Framework and we will use Fluent NHibernate / NHibernate to create a data access system (DAL).  But if you like, you can use the Entity Framework.  Finally, we‚Äôll use Ninject for dependency injection due to its simplicity. <br><br><ul><li>  In the first part, we will create the basic blog infrastructure.  Create the necessary classes of models, data access components. </li><li>  In the second part, we implement controllers, action methods, and views.  At the end of the second part we will have a working blog in which we can look at the latest posts, read the full text of the post, choose posts by category or tags and even search for interesting posts (posts). </li><li>  In the third part, we will create an administrator console for managing posts, categories and tags. </li><li>  In the fourth part, we will introduce the <a href="https://disqus.com/">Disqus</a> comment system into our blog.  Also, we will introduce two new services: the <a href="http://www.addthis.com/">AddThis</a> exchange service and the <a href="http://www.feedburner.com/">Feedburner</a> subscription <a href="http://www.feedburner.com/">service</a> . </li></ul><br></li><li><h3>  Technology </h3><br><ul><li>  ASP.NET MVC 4.0 </li><li>  Fluent NHibernate and NHibernate </li><li>  SQL Server 2012 </li><li>  Ninject </li><li>  jQuery </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </li><li><h3>  Creation of basic infrastructure. <br></h3><br>  We describe the tasks that we need to implement in this part: <br><br>  Problem 1.Delete the latest blog post. <br><br>  Task 2. To remove posts of a certain category, <br><br>  Task 3.Display posts based on the tag. <br><br>  Task 4. Search for posts <br><br>  Task 5. Complete the post <br><br>  Task 6.Vyvodit posts a certain category in the widget <br><br>  Task 7.Vyvodit posts based on the tag in the widget <br><br>  Task 8.Vyvodit last post in the widget <br><br><h4>  Task 1. Display the latest blog post. </h4><br>  To perform this task, we need to select the blog posts from the database and display them in the view. <br><img src="https://habrastorage.org/getpro/habr/post_images/834/8e7/3f2/8348e73f29abdd56d5c38b272311b077.png"><br><br>  This task is quite large, so let's break it down into several smaller subtasks that will be easier to perform separately. <br><br><ol><li>  Create a basic solution (solution) </li><li>  Create domain classes </li><li>  Configure Fluent NHibernate and NHibernate </li><li>  Create mapping classes, data access classes and methods </li><li>  Configure Ninject for the JustBlog.Core Project </li><li>  Configure Ninject for an MVC project </li><li>  Create controller and actions </li><li>  Create a presentation </li></ol><br><br><h5>  4.1 Creating a baseline solution </h5><br>  Create an MVC 4 web application project and name it <strong>JustBlog</strong> . <br><img src="https://habrastorage.org/getpro/habr/post_images/360/16a/35e/36016a35e491ff2285e6787ddd57364d.png"><br><br>  In the ‚ÄúSelect a template‚Äù window, select <strong>‚ÄúEmpty template‚Äù</strong> . <br><img src="https://habrastorage.org/getpro/habr/post_images/a4e/a71/14f/a4ea7114f427ef4c129cd4960850fe42.png"><br><br>  Create a class library and name it <strong>JustBlog.Core</strong> .  It is recommended to store domain classes and data access components in separate projects, so it will be easier for us to manage the application in terms of development, testing and deployment.  Do not forget to add the link to <strong>JustBlog.Core</strong> in <strong>JustBlog</strong> . <br><br>  The solution should look like the one below. <br><img src="https://habrastorage.org/getpro/habr/post_images/9e7/092/ff6/9e7092ff6f0a65a6d96f837bdd1b1476.png"><br><br><h5>  4.2 Creating Domain Classes </h5><br>  In the <strong>JustBlog.Core</strong> project <strong>,</strong> create a new folder called <strong>Objects</strong> to place the domain classes in it.  For our blog, we need to create three classes: <strong>Post</strong> , <strong>Category</strong> and <strong>Tag</strong> .  Each <strong>Post</strong> belongs to one <strong>Category</strong> , but it can be tagged with multiple <strong>Tags</strong> .  There are <em>many one-to-one</em> relationships between <strong>Post</strong> and <strong>Category</strong> , and <em>many-to-many</em> relationships between <strong>Post</strong> and <strong>Tag</strong> . <br><br>  The relationships between the classes are shown in the screenshot below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a9/3c9/538/6a93c9538bf5b6908f38976157d2d009.jpg"><br><br>  Below is our Post class. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">JustBlog.Core.Objects</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Post</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Title { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ShortDescription { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Description { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Meta { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> UrlSlug { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Published { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> DateTime PostedOn { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> DateTime? Modified { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Category Category { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> IList&lt;Tag&gt; Tags { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre> <br><br>  Most properties require no explanation.  The <strong>UrlSlug</strong> property is an alternative to the <strong>Title</strong> property and is used for addressing. <br><br><blockquote>  Slug is a newspaper term.  ‚ÄúSlug‚Äù is a short label name that contains only letters, numbers, underscores, or hyphens.  Mostly used in URLs. <br></blockquote><br><br>  For example, we have a post titled "Advanced Linq in C #", published in August 2010, we create for it the URL <em>http // localhost / archive / 2010/8 / Advanced Linq in C #</em> .  The post header may contain special characters (in this example, "#") and not all servers can handle requests containing special characters.  Instead of using the <strong>Title</strong> property directly in the URL, we will use some alternative text that is similar to the post title and we will take it from the <strong>URL</strong> property <strong>Slug</strong> . <br><br>  In the above case, instead of using ‚ÄúAdvanced Linq in C #‚Äù in the URL, we are going to use the friendly text (slug) <em>‚Äúadvanced_linq_in_csharp‚Äù</em> , so the address will be http // localhost / archive / 2010/8 / advanced_linq_in_csharp.  In part 3, we learn how to automatically create a slug from a post title. <br><br><blockquote>  <strong>URL Slug</strong> <br>  URL Slug is SEO - and the user-friendly part of the string in the URL for identification, description and access to the resource.  Often an article page title is a suitable candidate for this. <br></blockquote><br><br>  The <strong>Meta</strong> property is used to store post description metadata and is used for SEO.  All properties are marked as virtual, because <strong>NHibernate</strong> at runtime creates a proxy server and it needs to have all the properties of this class to be virtual. <br><br>  The <strong>Category</strong> and <strong>Tag</strong> classes are very simple and are shown below.  We use the <strong>UrlSlug</strong> property for the same reason that we discussed above. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">JustBlog.Core.Objects</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Category</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> UrlSlug { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Description { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> IList&lt;Post&gt; Posts { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">JustBlog.Core.Objects</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Tag</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> UrlSlug { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Description { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> IList&lt;Post&gt; Posts { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre><br><br><h5>  4.3 Configuring Fluent NHibernate and NHibernate </h5><br>  To access the database, we will use <strong>NHibernate</strong> along with <strong>Fluent NHibernate</strong> .  NHibernate is an ORM tool like the Entity Framework, where relationships between classes and database tables are mapped via XML files.  Fluent NHibernate is an extension for NHibernate which replaces the mapping with XML files with a mapping using special classes.  Mapping through classes is much easier than through XML files. <br><br>  We can easily add links to NHibernate and Fluent NHibernate assemblies using the <strong>Nuget Package Manager Console</strong> .  Open Package Manager from the menu <strong>Tools -&gt; Library Package Manager -&gt; Package Manager Console</strong> . <br><br>  In the console, run the following command. <br><br> <code>PM&gt; Install-Package FluentNHibernate</code> <br> <br>  If the installation was successful, you will see the following assemblies in the References folder of the <strong>JustBlog.Core</strong> project. <br><br>  FluentNHibernate <br>  NHibernate <br>  Esi.collections <br><br><h5>  4.4 Creating mapping classes, data access classes and methods </h5><br>  The next thing we need to do is create the necessary mapping classes.  A mapping class is used to map a class and its properties to a table and its columns.  Create a new folder called <strong>Mappings</strong> in the <strong>JustBlog.Core</strong> project to store all the mapping classes. <br><br>  To create a mapping class, we must inherit it from the generalized <strong>ClassMap</strong> class of the Fluent NHibernate framework.  All mappings must be performed in the constructor. <br>  The mapping class for the <strong>Post</strong> class. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> FluentNHibernate.Mapping; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JustBlog.Core.Objects; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">JustBlog.Core.Mappings</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PostMap</span></span>: <span class="hljs-title"><span class="hljs-title">ClassMap</span></span>&lt;<span class="hljs-title"><span class="hljs-title">Post</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PostMap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Id(x =&gt; x.Id); Map(x =&gt; x.Title).Length(<span class="hljs-number"><span class="hljs-number">500</span></span>).Not.Nullable(); Map(x =&gt; x.ShortDescription).Length(<span class="hljs-number"><span class="hljs-number">5000</span></span>).Not.Nullable(); Map(x =&gt; x.Description).Length(<span class="hljs-number"><span class="hljs-number">5000</span></span>).Not.Nullable(); Map(x =&gt; x.Meta).Length(<span class="hljs-number"><span class="hljs-number">1000</span></span>).Not.Nullable(); Map(x =&gt; x.UrlSlug).Length(<span class="hljs-number"><span class="hljs-number">200</span></span>).Not.Nullable(); Map(x =&gt; x.Published).Not.Nullable(); Map(x =&gt; x.PostedOn).Not.Nullable(); Map(x =&gt; x.Modified); References(x =&gt; x.Category).Column(<span class="hljs-string"><span class="hljs-string">"Category"</span></span>).Not.Nullable(); HasManyToMany(x =&gt; x.Tags).Table(<span class="hljs-string"><span class="hljs-string">"PostTagMap"</span></span>); } } }</code> </pre><br><br>  The <strong>Id</strong> extension method represents the name of the property that you want to set as the primary key for the table column. <br><br>  The <strong>Map</strong> extension method is used to map a property to a table column.  During property mapping, we can set the size of a column, indicate whether it allows storing NULL values, or set other specifications. <br><br>  For example: <br><br><pre> <code class="cs hljs">Map(x =&gt; x.ShortDescription).Length(<span class="hljs-number"><span class="hljs-number">5000</span></span>).Not.Nullable();</code> </pre><br><br>  If the generated column name is different from the property name, then we must pass the column name using the <strong>Column</strong> extension method. <br><br><pre> <code class="cs hljs">Map(x =&gt; x.Title).Column(<span class="hljs-string"><span class="hljs-string">"post_title"</span></span>)</code> </pre><br><br>  The <strong>References</strong> method is used to represent the <em>many-to-one</em> relationship between <strong>Post</strong> and <strong>Category</strong> using the external key <strong>Category</strong> column of the <strong>Post</strong> table.  The <strong>HasManyToMany</strong> method <strong>is</strong> used to represent the many-to-many relationship between <strong>Post</strong> and <strong>Tag</strong> via the <strong>PostTagMap</strong> staging table.  You can learn more about <strong>Fluent NHibernate</strong> and its method extensions <a href="https://github.com/jagregory/fluent-nhibernate/wiki/Fluent-mapping">from here</a> . <br><br>  By default, <strong>Fluent NHibernate</strong> assumes that the table name is exactly the same as the class name, and the column names are the same as the property names.  If the table name is different, then we must map the table to the class using the <strong>Table</strong> extension method. <br><br>  For example: <br><br><pre> <code class="cs hljs">Table(<span class="hljs-string"><span class="hljs-string">"tbl_posts"</span></span>);</code> </pre><br><br>  The mapping classes for <strong>Category</strong> and <strong>Tag are</strong> exactly the same, except for their relationship with <strong>Post</strong> .  <strong>A category</strong> has a <em>one-to-many</em> relationship with <strong>Post</strong> , while a <strong>Tag</strong> has a <em>many-to-many</em> relationship with <strong>Post</strong> . <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">JustBlog.Core.Mappings</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CategoryMap</span></span>: <span class="hljs-title"><span class="hljs-title">ClassMap</span></span>&lt;<span class="hljs-title"><span class="hljs-title">Category</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CategoryMap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Id(x =&gt; x.Id); Map(x =&gt; x.Name).Length(<span class="hljs-number"><span class="hljs-number">50</span></span>).Not.Nullable(); Map(x =&gt; x.UrlSlug).Length(<span class="hljs-number"><span class="hljs-number">50</span></span>).Not.Nullable(); Map(x =&gt; x.Description).Length(<span class="hljs-number"><span class="hljs-number">200</span></span>); HasMany(x =&gt; x.Posts).Inverse().Cascade.All().KeyColumn(<span class="hljs-string"><span class="hljs-string">"Category"</span></span>); } } }</code> </pre><br><br>  The <strong>Inverse ()</strong> extension method makes the other side of the relationship responsible for persistence. <br><br>  The <strong>Cascade.All ()</strong> extension method runs a cascade event call (down the hierarchy) in the collection entities (therefore, when the category is saved, posts will also be saved). <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">JustBlog.Core.Mappings</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TagMap</span></span>: <span class="hljs-title"><span class="hljs-title">ClassMap</span></span>&lt;<span class="hljs-title"><span class="hljs-title">Tag</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TagMap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Id(x =&gt; x.Id); Map(x =&gt; x.Name).Length(<span class="hljs-number"><span class="hljs-number">50</span></span>).Not.Nullable(); Map(x =&gt; x.UrlSlug).Length(<span class="hljs-number"><span class="hljs-number">50</span></span>).Not.Nullable(); Map(x =&gt; x.Description).Length(<span class="hljs-number"><span class="hljs-number">200</span></span>); HasManyToMany(x =&gt; x.Posts).Cascade.All().Inverse().Table(<span class="hljs-string"><span class="hljs-string">"PostTagMap"</span></span>); } } }</code> </pre><br><br>  We will use the <strong>Repository</strong> template to access the database.  We use this template to separate the data access code from the controllers, and this will help us simplify the unit testing of our controllers.  The core of the repository template is an interface that contains descriptions of all data access methods. <br><br>  In the <strong>JustBlog.Core</strong> project, <strong>we</strong> will create an <strong>IBlogRepository</strong> interface with two methods. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JustBlog.Core.Objects; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">JustBlog.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IBlogRepository</span></span> { <span class="hljs-function"><span class="hljs-function">IList&lt;Post&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Posts</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pageNo, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pageSize</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TotalPosts</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } }</code> </pre><br><br>  The <strong>Posts</strong> method is used to return the latest published posts paginated according to the values ‚Äã‚Äãpassed to it.  The <strong>TotalPosts</strong> method returns the total number of published posts.  Next, we fill the interface with other methods. <br><br>  In the <strong>JustBlog.Core</strong> project <strong>, a</strong> class named <strong>BlogRepository</strong> and implement the interface. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JustBlog.Core.Objects; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> NHibernate; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> NHibernate.Criterion; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> NHibernate.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> NHibernate.Transform; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">JustBlog.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BlogRepository</span></span>: <span class="hljs-title"><span class="hljs-title">IBlogRepository</span></span> { <span class="hljs-comment"><span class="hljs-comment">// NHibernate object private readonly ISession _session; public BlogRepository(ISession session) { _session = session; } public IList&lt;Post&gt; Posts(int pageNo, int pageSize) { var posts = _session.Query&lt;Post&gt;() .Where(p =&gt; p.Published) .OrderByDescending(p =&gt; p.PostedOn) .Skip(pageNo * pageSize) .Take(pageSize) .Fetch(p =&gt; p.Category) .ToList(); } var postIds = posts.Select(p =&gt; p.Id).ToList(); return _session.Query&lt;Post&gt;() .Where(p =&gt; postIds.Contains(p.Id)) .OrderByDescending(p =&gt; p.PostedOn) .FetchMany(p =&gt; p.Tags) .ToList(); } public int TotalPosts() { return _session.Query&lt;Post&gt;().Where(p =&gt; p.Published).Count(); } } }</span></span></code> </pre><br><br>  All database access must be done through the NHibernate <strong>ISession</strong> object.  When we read a collection of posts through <strong>ISessions</strong> , the <strong>Category</strong> and <strong>Tags</strong> dependencies are not populated by default.  The methods <strong>Fetch</strong> and <strong>FetchMany</strong> are used to tell NHibernate to fill them immediately. <br><br>  In the <strong>Posts</strong> method, in order to get posts, we request the database twice, because we cannot use <strong>FetchMany</strong> together with the <strong>Skip</strong> and <strong>Take</strong> methods in the Linq query.  So, first we select all the posts, then using their ID, we again select the posts to get their tags.  Please see <a href="http://stackoverflow.com/questions/9729262/nhibernate-linq-provider-and-take-skip-with-eager-fetching">this thread</a> for more information about this issue. <br><br><blockquote>  <strong>NHibernate ISession</strong> <br><br>  ISession is a persistence manager interface that is used to store and retrieve objects from a database. <br><br>  <em>Persistent means that this instance should be implemented in such a way that it persists after the process that generated it is completed.</em>  <em>Unlike transient, meaning that this instance of the object is temporary - it ceases to exist after the process that generated it is completed.</em>  <em>(comment of the translator).</em> <br></blockquote><br><br><h5>  4.5 Customizing Ninject for the JustBlog.Core project </h5><br>  Dependency injection (DI) avoids instantiating specific implementations of dependencies within a class.  These dependencies are usually introduced into the class through the constructor, but sometimes through the properties.  One of the main advantages of dependency injection is unit testing and we will see this when we write unit tests for controllers in part 3. <br><br>  There are many frameworks to simplify dependency injection, like Castle Windsor, Unity, Autofac, StructureMap, Ninject, etc. We chose <strong>Ninject</strong> because it is easy to use. <br><br>  Install <strong>Ninject</strong> in the <strong>JustBlog.Core</strong> project by running the following commands in the <strong>Package Manager Console</strong> . <br><br> <code>PM&gt; Install-Package Ninject <br> PM&gt; Install-Package Ninject.Web.Common <br></code> <br><br>  After successful execution of commands, we will see that the Ninject and NinjectWeb.Common assemblies are added to the project.  Along with the builds, the <strong>NinjectWebCommon.cs</strong> file was also added to the <strong>App_Start</strong> folder.  In the near future I will explain why we need to install the extension Ninject.Web.Common. <br><br>  We can configure <strong>Ninject in</strong> two ways, either using <strong>Global.asax.cs</strong> or via the <strong>App_Start</strong> file.  We will use the first approach, so please delete the <strong>NinjectWebCommon.cs</strong> file from the <strong>App_Start</strong> folder, and also remove unnecessary references to the <strong>WebActivator</strong> and <strong>Microsoft.Web.Infrastructure</strong> assemblies from the project. <br><br>  The main functionality of any DI framework is the binding of interfaces with specific implementations of these interfaces.  Mapping an interface to a specific implementation is called binding.  We can group a set of bindings associated with a specific Ninject module using Ninject Modules.  All bindings and modules are loaded into the main component of the Kernel Ninject core.  Whenever an application needs an instance of a particular class that implements the interface, Kernel exposes it to the application. <br><br><blockquote>  <strong>Ninject Module</strong> <br><br>  The Ninject module is used to group the mappings / bindings related to a specific module in one class. <br></blockquote><br><br>  The <strong>BlogRepository</strong> class has a dependency with <strong>Nibernate ISession</strong> .  To create an instance of <strong>ISession,</strong> we need another Nibernate interface called <strong>ISessionFactory</strong> .  Let's create a <strong>class</strong> ninject module in the <strong>JustBlog.Core</strong> project called <strong>RepositoryModule</strong> , which will connect both of these interfaces. <br><br>  The created Ninject-module must inherit from the abstract class <strong>NinjectModule</strong> and implement the <strong>Load</strong> method.  In the Load method, we will associate both interfaces with the methods using the <strong>Bind</strong> method. <br><br>  The <strong>Bind</strong> method is used to associate an interface with a class that implements it. <br><br>  For example: <br><br><pre> <code class="cs hljs">Bind&lt;IFoo&gt;().To&lt;Foo&gt;();</code> </pre><br><br>  We can also match the interface with the method that creates and return the interface implementation. <br><br><pre> <code class="cs hljs">Bind&lt;IFoo&gt;().ToMethod(c =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> foo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Foo(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> foo; });</code> </pre><br><br><blockquote>  <strong>NHibernate ISessionFactory</strong> <br><br>  Unlike ISession, we need one instance of ISessionFactory in the entire application. <br></blockquote><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> FluentNHibernate.Cfg; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> FluentNHibernate.Cfg.Db; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JustBlog.Core.Objects; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> NHibernate; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> NHibernate.Cache; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> NHibernate.Tool.hbm2ddl; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Ninject; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Ninject.Modules; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Ninject.Web.Common; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">JustBlog.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RepositoryModule</span></span>: <span class="hljs-title"><span class="hljs-title">NinjectModule</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Bind&lt;ISessionFactory&gt;() .ToMethod ( e =&gt; Fluently.Configure() .Database(MsSqlConfiguration.MsSql2008.ConnectionString(c =&gt; c.FromConnectionStringWithKey(<span class="hljs-string"><span class="hljs-string">"JustBlogDbConnString"</span></span>))) .Cache(c =&gt; c.UseQueryCache().ProviderClass&lt;HashtableCacheProvider&gt;()) .Mappings(m =&gt; m.FluentMappings.AddFromAssemblyOf&lt;Post&gt;()) .ExposeConfiguration(cfg =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaExport(cfg).Execute(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) .BuildConfiguration() .BuildSessionFactory() ) .InSingletonScope(); Bind&lt;ISession&gt;() .ToMethod((ctx) =&gt; ctx.Kernel.Get&lt;ISessionFactory&gt;().OpenSession()) .InRequestScope(); } } }</code> </pre><br><blockquote>  As the <a href="http://fluentnhibernate.wikia.com/wiki/Fluent_configuration">Fluent NHibernate Wiki</a> tells us, in general, setting up NHibernate using the Fluent NHibernate API is done using 5 main methods, 3 of which are mandatory: <br><br><pre> <code class="cs hljs">Fluently.Configure() .Database(<span class="hljs-comment"><span class="hljs-comment">/* your database settings */</span></span>) .Mappings(<span class="hljs-comment"><span class="hljs-comment">/* your mappings */</span></span>) .ExposeConfiguration(<span class="hljs-comment"><span class="hljs-comment">/* alter Configuration */</span></span>) <span class="hljs-comment"><span class="hljs-comment">// optional .BuildSessionFactory();</span></span></code> </pre><br><br>  <strong>Fluently.Configure</strong> begins the setup process. <br>  <strong>Database</strong> , sets up a database connection string <br>  <strong>Mappings</strong> customizes mappings based on your entity classes. <br>  <strong>ExposeConfiguration</strong> is optional, but allows you to create a database schema from your mappings (create tables from our classes) <br>  <strong>BuildSessionFactory</strong> is the last method, and it creates an instance of NHibernate SessionFactory based on the settings of the previous methods. <br><br></blockquote><br><br>  The Cache method is optional; it configures the provider to cache requests. <br><br>  There are many extensions available in Ninject and one of them is Ninject.Web.Common, which contains some of the common functionality needed by WebForms and MVC applications.  We need to make sure that while the Ninject request is being executed return the same ISession instance.  The <strong>InRequestScope ()</strong> extension method, defined in the Ninject.Web.Common namespace, tells Ninject that only one instance of the class should be created for each HTTP request received by ASP.NET.  The <strong>InSingletonScope ()</strong> extension method creates a single instance (singleton) that is available throughout the application. <br><br><h5>  4.6 Ninject Setup for MVC Project </h5><br>  All database calls from the controllers are made via the <strong>IBlogRepository</strong> interface.  To embed an instance of a class that implements the <strong>IBlogRepository</strong> into the controller, you need to configure Ninject in the MVC application.  There is an extension (Ninject.Mvc3) specially created to support MVC applications. <br><br>  Install Ninject.Mvc3 in our <strong>JustBlog</strong> project by executing the following command. <br><br> <code>PM&gt; Install-Package Ninject.Mvc3 <br></code> <br><br>  After successful execution of commands in the MVC project the following assemblies will be added: <br><br>  Ninject <br>  Ninject.Web.Common <br>  Ninject.Web.Mvc <br><br>  <u>Delete the NinjectWebCommon.cs file</u> from the App_Start folder.  Inherit our global application class from the <strong>NinjectHttpApplication</strong> class and override the <strong>CreateKernel</strong> method. <br>  Modify the Global.asax.cs file as shown below. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Ninject; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Ninject.Web.Common; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Web.Mvc; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Web.Routing; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">JustBlog</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MvcApplication</span></span> : <span class="hljs-title"><span class="hljs-title">NinjectHttpApplication</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IKernel </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateKernel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> kernel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StandardKernel(); kernel.Load(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RepositoryModule()); kernel.Bind&lt;IBlogRepository&gt;().To&lt;BlogRepository&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> kernel; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnApplicationStarted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { RouteConfig.RegisterRoutes(RouteTable.Routes); <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnApplicationStarted(); } } }</code> </pre><br><br>  In the <strong>CreateKernel</strong> method, we create and return an instance of <strong>StandardKernel of</strong> type <strong>IKernel</strong> .  IKernel is the core of the application, where we specify our bindings and when we need an instance associated with the interface it provides us with it. <br><br>  With an instance of the <strong>StandardKernel</strong> class, we do a couple of important things.  First, we load an instance of our <strong>Repository</strong> module, which contains all the bindings associated with <strong>NHibernate</strong> interfaces and then we associate the <strong>IBlogRepository</strong> interface directly with its <strong>BlogRepository</strong> implementation.  Finally, at the end of the example, the application startup code moved to the OnApplicationStarted method. <br><br>  That's all about the Ninject configuration in the app.  In the next part, we will start working on controllers and views. <br><br></li></ol></div><p>Source: <a href="https://habr.com/ru/post/278633/">https://habr.com/ru/post/278633/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278619/index.html">EDA approach in Angular</a></li>
<li><a href="../278621/index.html">Selection of materials for the novice developer of JavaScript games</a></li>
<li><a href="../278623/index.html">Humane VimScript: minimalistic object orientation</a></li>
<li><a href="../278629/index.html">‚ÄúStrict mode‚Äù and other MySQL settings in Laravel 5.2</a></li>
<li><a href="../278631/index.html">System 6 (Systemicus) GUI, some aspects</a></li>
<li><a href="../278635/index.html">Rust in detail, part 2</a></li>
<li><a href="../278637/index.html">Chapter 21. Part 2 - Creating objects and data output objects. PowerShell in depth - Don Jones, Richard Siddaway</a></li>
<li><a href="../278647/index.html">Video from JUG.ru meeting with Kotlin Andrei Breslav and Dmitry Zhemerov</a></li>
<li><a href="../278649/index.html">Announcement Rust 1.7</a></li>
<li><a href="../278651/index.html">How to independently analyze the labor market</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>