<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Application in the menu bar for macOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Applications placed in the menu bar have long been known to macOS users. Some of these applications have a ‚Äúregular‚Äù part, others are placed only in t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Application in the menu bar for macOS</h1><div class="post__text post__text-html js-mediator-article">  Applications placed in the menu bar have long been known to macOS users.  Some of these applications have a ‚Äúregular‚Äù part, others are placed only in the menu bar. <br>  In this guide, you will write an application that shows several quotes from famous people in a pop-up window.  In the process of creating this application, you will learn: <br><br><ul><li>  assign an application icon in the menu bar </li><li>  make the application placed only in the menu bar </li><li>  add custom menu </li><li>  show a pop-up window at the user's request and hide it when necessary using <b>Event Monitoring</b> </li></ul><br><blockquote>  <b>Note:</b> this guide assumes that you are familiar with Swift and macOS. </blockquote><a name="habracut"></a><br><h2>  Getting started </h2><br>  Launch Xcode.  Next in the <b>File / New / Project ...</b> menu, select the <b>macOS / Application / Cocoa App</b> template and click <b>Next</b> . <br><br>  On the next screen, enter Quotes as the <b>Product Name</b> , select your <b>Organization Name</b> and <b>Organization Identifier</b> .  Then make sure that Swift is selected as the application language and the <b>Use Storyboards</b> checkbox is checked.  Uncheck the checkboxes <b>Create Document-Based Application</b> , <b>Use Core Data</b> , <b>Include Unit tests</b> and <b>Include UI Tests</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/4c/_f/g6/4c_fg6hmxqq0k_vqkm8-zqrt_ok.png"><br><br>  Finally, click <b>Next</b> again, specify a place to save the project and click <b>Create</b> . <br>  Once the new project is created, open <b>AppDelegate.swift</b> and add the following property to the class: <br><br><pre><code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> statusItem = <span class="hljs-type"><span class="hljs-type">NSStatusBar</span></span>.system.statusItem(withLength:<span class="hljs-type"><span class="hljs-type">NSStatusItem</span></span>.squareLength)</code> </pre> <br>  Here we create in the menu bar the Status Item (application icon) of a fixed length that will be visible to users. <br><br>  Then we need to assign our image to this new item in the menu bar so that we can distinguish our new application. <br><br>  In the project navigator, go to Assets.xcassets, <a href="">upload a picture</a> and drag it to the asset catalog. <br><br>  Select a picture and open the attribute inspector.  Change the <b>Render As</b> option to <b>Template Image</b> . <br><br> <a href=""><img src="https://habrastorage.org/webt/wv/es/-o/wves-ouas8duyvk97fki1swuedk.png"></a> <br><br>  If you are using your own image, make sure that the image is black and white and configure it as a <b>Template image</b> so that the icon looks great on both the dark and light menu bar. <br><br>  Go back to <b>AppDelegate.swift</b> , and add the following code to <b>applicationDidFinishLaunching (_ :)</b> <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { button.image = <span class="hljs-type"><span class="hljs-type">NSImage</span></span>(named:<span class="hljs-type"><span class="hljs-type">NSImage</span></span>.<span class="hljs-type"><span class="hljs-type">Name</span></span>(<span class="hljs-string"><span class="hljs-string">"StatusBarButtonImage"</span></span>)) button.action = #selector(printQuote(<span class="hljs-number"><span class="hljs-number">_</span></span>:)) }</code> </pre> <br>  Here we assign the image we just added to the application icon and assign the <b>action</b> when we click on it. <br><br>  Add the following method to the class: <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printQuote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quoteText = <span class="hljs-string"><span class="hljs-string">"Never put off until tomorrow what you can do the day after tomorrow."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quoteAuthor = <span class="hljs-string"><span class="hljs-string">"Mark Twain"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\(quoteText) ‚Äî \(quoteAuthor)"</span></span>) }</code> </pre> <br>  This method simply prints a quote to the console. <br><br>  Pay attention to the <b>objc</b> method <b>directive</b> .  This allows you to use this method as a response to a button click. <br><br>  Build and run the application, and you will see the new application in the menu bar.  Hooray! <br>  Every time you click on the icon in the menu bar, the famous Mark Twain sentence is displayed in the Xcode console. <br><br><h2>  Hiding the main window and dock icon </h2><br>  There are a couple of little things that we need to do before tackling the functionality directly: <br><br><ul><li>  remove dock icon </li><li>  delete unnecessary main application window </li></ul><br>  To remove the dock icon, open <b>Info.plist</b> .  Add a new key <b>Application is agent (UIElement)</b> and set its value to <b>YES</b> . <br><br><img src="https://habrastorage.org/webt/-c/g_/pn/-cg_pnrysiiynfs2xfab8fyblhk.png"><br><br>  Now it's time to figure out the main application window. <br><br><ul><li>  open the <b>Main.storyboard</b> </li><li>  select <b>Window Controller scene</b> and delete it </li><li>  Leave <b>View Controller scene</b> , we will use it soon </li></ul><br><br> <a href=""><img src="https://habrastorage.org/webt/td/1q/vr/td1qvrwqe8qpgp2xvadbifvu_4o.png"></a> <br><br>  Build and run the application.  Now the application does not have both the main window and the unnecessary icon in the dock.  Fine! <br><br><h2>  Add to the Status Item menu </h2><br>  A single response to a click is clearly not enough for a serious application.  The easiest way to add functionality is to add a menu.  Add this function at the end of <b>AppDelegate</b> . <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constructMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> menu = <span class="hljs-type"><span class="hljs-type">NSMenu</span></span>() menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>(title: <span class="hljs-string"><span class="hljs-string">"Print Quote"</span></span>, action: #selector(<span class="hljs-type"><span class="hljs-type">AppDelegate</span></span>.printQuote(<span class="hljs-number"><span class="hljs-number">_</span></span>:)), keyEquivalent: <span class="hljs-string"><span class="hljs-string">"P"</span></span>)) menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>.separator()) menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>(title: <span class="hljs-string"><span class="hljs-string">"Quit Quotes"</span></span>, action: #selector(<span class="hljs-type"><span class="hljs-type">NSApplication</span></span>.terminate(<span class="hljs-number"><span class="hljs-number">_</span></span>:)), keyEquivalent: <span class="hljs-string"><span class="hljs-string">"q"</span></span>)) statusItem.menu = menu }</code> </pre> <br>  And then add this call at the end of the <b>applicationDidFinishLaunching (_ :)</b> <br><br><pre> <code class="swift hljs">constructMenu()</code> </pre> <br>  We create <b>NSMenu</b> , add 3 instances of <b>NSMenuItem</b> to it and set this menu as an application icon menu. <br><br>  A few important notes: <br><br><ul><li>  <b>The title</b> of the menu item is the text that appears in the menu.  A good place to localize the application (if necessary). </li><li>  <b>action</b> , like <b>action of a</b> button or another control, is a method that is called when the user clicks on a menu item. </li><li>  <b>keyEquivalent</b> is a keyboard shortcut that you can use to select a menu item.  Lower case characters use <b>Cmd</b> as a modifier, and upper case use <b>Cmd + Shift</b> .  This only works if the application is at the top and active.  In our case, it is necessary that the menu or some other window be visible, since our application does not have an icon in the dock. </li><li>  <b>separatorItem</b> is an inactive menu item as a gray line between other items.  Use it to group </li><li>  <b>printQuote</b> is the method you have already defined in <b>AppDelegate</b> , and <b>terminate</b> is the method defined by <b>NSApplication</b> . </li></ul><br>  Launch the application, and you will see the menu by clicking on the application icon. <br><br><img src="https://habrastorage.org/webt/-w/2v/lv/-w2vlv2nfi_vxgosiihbqd19m5g.png"><br><br>  Try clicking on the menu ‚Äî the <b>Print Quote</b> option will print the quote to the Xcode console, and <b>Quit Quotes</b> will complete the application. <br><br><h2>  Add a popup window </h2><br>  You've seen how easy it is to add a menu from code, but showing a quote in the Xcode console is clearly not what users expect from the application.  Now we will add a simple view controller to show the quotes in the right way. <br><br>  Go to the <b>File / New / File ...</b> menu, select the <b>macOS / Source / Cocoa Class</b> template and click <b>Next</b> . <br><br> <a href=""><img src="https://habrastorage.org/webt/m5/vd/7w/m5vd7wewsgjt16zajhbas3ca9mi.png"></a> <br><br><ul><li>  name the class <b>QuotesViewController</b> </li><li>  make <b>NSViewController a</b> successor </li><li>  make sure the <b>Also create</b> checkbox <b>XIB file for user interface is</b> not checked </li><li>  set the language in Swift </li></ul><br>  Finally, click <b>Next</b> again, select a place to save the file and click <b>Create</b> . <br>  Now open the <b>Main.storyboard</b> .  Expand <b>View Controller Scene</b> and select <b>View Controller instance</b> . <br><br> <a href=""><img src="https://habrastorage.org/webt/c4/dd/em/c4ddemmj9moxiu_whrzl7ilme_4.png"></a> <br><br>  First select the <b>Identity Inspector</b> and change the class to <b>QuotesViewController</b> , then set the <b>Storyboard ID</b> to <b>QuotesViewController</b> <br><br>  Now add the following code to the end of the <b>QuotesViewController.swift</b> file: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QuotesViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// MARK: Storyboard instantiation static func freshController() -&gt; QuotesViewController { //1. let storyboard = NSStoryboard(name: NSStoryboard.Name("Main"), bundle: nil) //2. let identifier = NSStoryboard.SceneIdentifier("QuotesViewController") //3. guard let viewcontroller = storyboard.instantiateController(withIdentifier: identifier) as? QuotesViewController else { fatalError("Why cant i find QuotesViewController? - Check Main.storyboard") } return viewcontroller } }</span></span></code> </pre> <br>  What's going on here: <br><br><ol><li>  get the link to <b>Main.storyboard</b> . </li><li>  create a <b>Scene identifier</b> that matches the one we just installed a little higher. </li><li>  Create an instance of <b>QuotesViewController</b> and return it. </li></ol><br>  You create this method, so now everyone who uses the <b>QuotesViewController</b> does not need to know how it is created.  It just works. <br><br>  Notice the <b>fatalError</b> inside the <b>guard</b> statement.  It can be a good idea to use it or <b>assertionFailure</b> , so that if something in the development goes wrong, to yourself, and to other members of the development team, to be aware of. <br><br>  Now back to <b>AppDelegate.swift</b> .  Add a new property. <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> popover = <span class="hljs-type"><span class="hljs-type">NSPopover</span></span>()</code> </pre> <br>  Then replace a <b>pplicationDidFinishLaunching (_ :) with the</b> following code: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicationDidFinishLaunching</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aNotification: Notification)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { button.image = <span class="hljs-type"><span class="hljs-type">NSImage</span></span>(named:<span class="hljs-type"><span class="hljs-type">NSImage</span></span>.<span class="hljs-type"><span class="hljs-type">Name</span></span>(<span class="hljs-string"><span class="hljs-string">"StatusBarButtonImage"</span></span>)) button.action = #selector(togglePopover(<span class="hljs-number"><span class="hljs-number">_</span></span>:)) } popover.contentViewController = <span class="hljs-type"><span class="hljs-type">QuotesViewController</span></span>.freshController() }</code> </pre><br>  You changed the click action to the <b>togglePopover (_ :)</b> method, which we will write later.  Also, instead of setting up and adding a menu, we set up a popup window that will display something from the <b>QuotesViewController</b> . <br><br>  Add the following three methods to <b>AppDelegate</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">togglePopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> popover.isShown { closePopover(sender: sender) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { showPopover(sender: sender) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showPopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { popover.show(relativeTo: button.bounds, of: button, preferredEdge: <span class="hljs-type"><span class="hljs-type">NSRectEdge</span></span>.minY) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closePopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { popover.performClose(sender) }</code> </pre> <br>  <b>showPopover ()</b> shows a popup window.  You just indicate where it comes from, macOS positions it and draws an arrow as if it appears from the menu bar. <br><br>  <b>closePopover ()</b> simply closes the pop-up window, and <b>togglePopover ()</b> is a method that either shows or hides the pop-up window, depending on its state. <br><br>  Launch the application and click on its icon. <br><br><img src="https://habrastorage.org/webt/j6/gu/oq/j6guoqowcbou3xwtqr2cdunm4ns.png"><br><br>  Everything is great, but where is the content? <br><br><h2>  Implement Quote View Controller </h2><br>  First you need a model for storing quotes and attributes.  Go to the <b>File / New / File ...</b> menu and select the <b>macOS / Source / Swift File template</b> , then <b>Next</b> .  Name the file <b>Quote</b> and click <b>Create</b> . <br><br>  Open the <b>Quote.swift</b> file and add the following code to it: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Quote</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> text: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> author: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> all: [<span class="hljs-type"><span class="hljs-type">Quote</span></span>] = [ <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Never put off until tomorrow what you can do the day after tomorrow."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Mark Twain"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Efficiency is doing better what is already being done."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Peter Drucker"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"To infinity and beyond!"</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Buzz Lightyear"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"May the Force be with you."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Han Solo"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Simplicity is the ultimate sophistication"</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Leonardo da Vinci"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"It's not just what it looks like and feels like. Design is how it works."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Steve Jobs"</span></span>) ] } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Quote</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomStringConvertible</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"\"\(text)\" ‚Äî \(author)"</span></span> } }</code> </pre> <br>  Here we define a simple quotation structure and a static property that returns all quotes.  Since we made <b>Quote</b> conforming to the <b>CustomStringConvertible</b> protocol, we can easily get conveniently formatted text. <br><br>  There is progress, but we still need controls to display all this. <br><br><h2>  Adding interface elements </h2><br>  Open the Main.storyboard and pull out 3 buttons ( <b>Push Button</b> ) and a label ( <b>Multiline Label)</b> on the view controller. <br><br>  Arrange the buttons and label so that they look like this: <br><br><img src="https://habrastorage.org/webt/1v/ry/2_/1vry2_ydfrxoqiqdsklo2uouwne.png"><br><br>  Attach the left button to the left edge with a gap of 20 and center vertically. <br>  Attach the right button to the right edge with a gap of 20 and center vertically. <br>  Attach the bottom button to the bottom edge with a gap of 20 and center horizontally. <br>  Attach the left and right edges of the label to the buttons with a gap of 20 center vertically. <br><br> <a href=""><img src="https://habrastorage.org/webt/jl/zi/tl/jlzitledfqmcexzv636ya6ir6sq.png"></a> <br><br>  You will see several layout errors, as there is not enough information for <b>auto layout</b> to sort out. <br><br>  Set the <b>Horizontal Content Hugging Priority</b> label to 249 to allow the label to be resized. <br><br> <a href=""><img src="https://habrastorage.org/webt/a6/qp/s0/a6qps0r2_vobhsjkbcfiqohklgc.png"></a> <br><br>  Now do the following: <br><br><ul><li>  set the <b>image of the</b> left button to the <b>NSGoLeftTemplate</b> and clear the <b>title</b> </li><li>  set the <b>image of the</b> right button to the <b>NSGoRightTemplate</b> and clear the <b>title</b> </li><li>  set the <b>title</b> buttons at the bottom in <b>Quit Quotes</b> . </li><li>  set the <b>text alignment of</b> the label in center. </li><li>  check that the <b>line break of</b> the label is set to <b>Word Wrap</b> . </li></ul><br><br>  Now open <b>QuotesViewController.swift</b> and add the following code to the implementation of the <b>QuotesViewController</b> class: <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@IBOutlet</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> textLabel: <span class="hljs-type"><span class="hljs-type">NSTextField!</span></span></code> </pre> <br><br>  Add this extension to the class implementation.  Now in <b>QuotesViewController.swift</b> two class extensions. <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">// MARK: Actions extension QuotesViewController { @IBAction func previous(_ sender: NSButton) { } @IBAction func next(_ sender: NSButton) { } @IBAction func quit(_ sender: NSButton) { } }</span></span></code> </pre> <br>  We have just added an <b>outlet</b> for the label that we will use to display quotes, and 3 stub methods that we connect to the buttons. <br><br><h2>  We connect code with Interface Builder </h2><br>  Pay attention: Xcode placed circles to the left of your code - near the keywords <b>IBAction</b> and <b>IBOutlet</b> . <br><br><img src="https://habrastorage.org/webt/kv/48/k_/kv48k_pvgucw0v1jexqsna44dda.png"><br><br>  We will use them to connect the code with the UI. <br><br>  Hold down the <b>alt</b> key and click on the <b>Main.storyboard</b> in the <b>project navigator</b> .  This will open the <b>storyboard</b> in the <b>Assistant Editor</b> on the right, and the code on the left. <br><br>  Drag the circle to the left of the <b>textLabel</b> to the label in the <b>interface builder</b> .  In the same way, connect the <b>previous</b> , <b>next,</b> and <b>quit</b> methods with the left, right, and bottom buttons, respectively. <br><br> <a href=""><img src="https://habrastorage.org/webt/7-/qu/yb/7-quybzu1bexw545popvn_mbeea.png"></a> <br><br>  Run your application. <br><br><img src="https://habrastorage.org/webt/tr/b2/6w/trb26wseu6kdpeyqyjdbeojwoxu.png"><br><br>  We used the default popup size.  If you want a larger or smaller pop-up window, simply change its size in the <b>storyboard</b> . <br><br><h2>  Write the code for the buttons </h2><br>  If you have not already hidden the <b>Assistant Editor</b> , click <b>Cmd-Return</b> or V <b>iew&gt; Standard Editor&gt; Show Standard Editor</b> <br><br>  Open <b>QuotesViewController.swift</b> and add the following properties to the class implementation: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quotes = <span class="hljs-type"><span class="hljs-type">Quote</span></span>.all <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentQuoteIndex: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">didSet</span></span> { updateQuote() } }</code> </pre> <br>  The <b>quotes</b> property contains all quotes, and <b>currentQuoteIndex</b> is the index of the quotation that is currently being output.  <b>CurrentQuoteIndex</b> also has a <b>property observer</b> to update the contents of the label with a new quote when the index changes. <br><br>  Now add the following methods: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() currentQuoteIndex = <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateQuote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { textLabel.stringValue = <span class="hljs-type"><span class="hljs-type">String</span></span>(describing: quotes[currentQuoteIndex]) }</code> </pre> <br>  When the view loads, we set the citation index to 0, which, in turn, causes the interface to be updated.  <b>updateQuote ()</b> simply updates the text label to display a quote.  corresponding <b>currentQuoteIndex</b> . <br><br>  Finally, update these methods with the following code: <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">previous</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { currentQuoteIndex = (currentQuoteIndex - <span class="hljs-number"><span class="hljs-number">1</span></span> + quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) % quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> } <span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { currentQuoteIndex = (currentQuoteIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>) % quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> } <span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { <span class="hljs-type"><span class="hljs-type">NSApplication</span></span>.shared.terminate(sender) }</code> </pre> <br>  The methods <b>next ()</b> and <b>previous ()</b> cycle through all the quotes.  <b>quit</b> closes the application. <br><br>  Run the application: <br><br><img src="https://habrastorage.org/webt/wi/qh/ju/wiqhjuzkw5c8f7bmtofythu147k.png"><br><br><h2>  Event monitoring </h2><br>  There is one more thing that users expect from our application - hide the pop-up window when the user clicks somewhere outside of it.  For this we need a mechanism called <b>macOS global event monitor</b> . <br><br>  Create a new Swift file, call it <b>EventMonitor</b> , and replace its contents with the following code: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Cocoa public class EventMonitor { private var monitor: Any? private let mask: NSEvent.EventTypeMask private let handler: (NSEvent?) -&gt; Void public init(mask: NSEvent.EventTypeMask, handler: @escaping (NSEvent?) -&gt; Void) { self.mask = mask self.handler = handler } deinit { stop() } public func start() { monitor = NSEvent.addGlobalMonitorForEvents(matching: mask, handler: handler) } public func stop() { if monitor != nil { NSEvent.removeMonitor(monitor!) monitor = nil } } }</code> </pre> <br>  When initializing an instance of this class, we give it an event mask that we will listen to (such as keystrokes, mouse wheel scrolling, etc.) and an event handler. <br>  When we are ready to start listening, <b>start ()</b> calls <b>addGlobalMonitorForEventsMatchingMask (_: handler :)</b> , which returns an object that we save.  As soon as the event contained in the mask happens, the system calls your handler. <br><br>  To stop monitoring events, <b>removeMonitor</b> <b>()</b> is called in <b>stop ()</b> and we remove an object by assigning it a nil value. <br><br>  All we have to do is call <b>start ()</b> and <b>stop ()</b> at the right time.  The class also calls <b>stop ()</b> in the de-initializer to tidy up after itself. <br><br><h2>  We connect Event Monitor </h2><br>  Open <b>AppDelegate.swift</b> for the last time and add a new property: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventMonitor: <span class="hljs-type"><span class="hljs-type">EventMonitor?</span></span></code> </pre> <br>  Then add this code to configure the <b>event monitor</b> at the end of the <b>applicationDidFinishLaunching (_ :)</b> <br><br><pre> <code class="swift hljs">eventMonitor = <span class="hljs-type"><span class="hljs-type">EventMonitor</span></span>(mask: [.leftMouseDown, .rightMouseDown]) { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] event <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> strongSelf = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, strongSelf.popover.isShown { strongSelf.closePopover(sender: event) } }</code> </pre> <br>  This will inform your application when you click the left or right button.  Note: the handler will not be called in response to mouse clicks inside your application.  That is why the popup window will not close until you click inside it. <br><br>  We use the <b>weak</b> link to <b>self</b> to avoid the danger of a cycle of strong links between <b>AppDelegate</b> and <b>EventMonitor</b> . <br><br>  Add the following code to the end of the <b>showPopover (_ :)</b> method: <br><br><pre> <code class="swift hljs">eventMonitor?.start()</code> </pre><br>  Here we start monitoring events when a popup window appears. <br><br>  Now add the code at the end of the <b>closePopover (_ :)</b> method: <br><br><pre> <code class="swift hljs">eventMonitor?.stop()</code> </pre><br>  Here we finish monitoring when the pop-up closes. <br><br>  The app is ready! <br><br><h2>  Conclusion </h2><br>  <a href="">Here</a> you will find the complete code for this project. <br><br>  You have learned how to set the menu and pop-up window in the application located in the menu bar.  Why not experiment with a few tags or formatted text to get a better view of the quotes?  Or connect backend to get quotes from the Internet?  Or do you want to use the keyboard to navigate between quotes? <br><br>  A good place for research is official documentation: <a href="https://developer.apple.com/documentation/appkit/nsmenu">NSMenu</a> , <a href="https://developer.apple.com/documentation/appkit/nspopover">NSPopover</a> and <a href="https://developer.apple.com/documentation/appkit/nsstatusitem">NSStatusItem</a> . </div><p>Source: <a href="https://habr.com/ru/post/447754/">https://habr.com/ru/post/447754/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447742/index.html">What is DevOps methodology and who needs it</a></li>
<li><a href="../447744/index.html">Climbing Elbrus - Reconnaissance. Technical Part 2. Interrupts, exceptions, system timer</a></li>
<li><a href="../447746/index.html">Business logic in a database using SchemaKeeper</a></li>
<li><a href="../447748/index.html">Linux Virtual File Systems: Why Do They Need It and How Do They Work? Part 2</a></li>
<li><a href="../447750/index.html">New processors for data centers - parse announcements of recent months</a></li>
<li><a href="../447756/index.html">New Gartner Application Monitoring Solution (APM) quadrant</a></li>
<li><a href="../447758/index.html">The story of the hacking of the classic game Dendy or Contra for 100 lives</a></li>
<li><a href="../447760/index.html">Broadcasting the moon landing [22: 00MSK 11 Apr 2019]</a></li>
<li><a href="../447762/index.html">Radiation: the war with the invisible killer or a little more about radon</a></li>
<li><a href="../447764/index.html">Simply space! How is the planetarium Lakhta Center</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>