<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>High-load project support</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Evgeny Potapov ( eapotapov ) 
 The report will be about what to do with the project after we launched it. You have planned the architecture of the pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>High-load project support</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/a27/ddf/b4da27ddf93f5a0856bb8f22ed6a86cc.jpg"><br><br><h2>  Evgeny Potapov ( <a href="https://habrahabr.ru/users/eapotapov/" class="user_link">eapotapov</a> ) </h2><br>  The report will be about what to do with the project after we launched it.  You have planned the architecture of the project, you have thought about how the infrastructure will work for it, thought out how you will balance the load, and finally launch it.  What to do next?  How to support, how to make the project continue to work, and how to make sure that nothing finally falls? <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/8d0/b47/eca/8d0b47ecaa7a8cea39b9cfe410345fad.png"><br><br>  First, a little about yourself.  I am from ITSumma, our company is engaged in round-the-clock support and administration of websites.  We currently employ 50 people, we were founded in 2008, we support more than 1000 servers, which are visited every day by more than 100 million people. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/f6a/066/185/f6a06618526410261709963cd88201ed.png"><br><br>  There are large projects on support, there are small, mostly Russian projects, and based on the experience of supporting these projects, I would like to talk about what should be done. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://player.vimeo.com/video/151817297" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  If we talk about support, what does it consist of?  In my opinion, it consists of three components: <br><br><ol><li>  project monitoring and response to alerts that come, </li><li>  backup and backup organization (we share these things), </li><li>  the organization of service and support, in fact, the response to what is happening with the project. </li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/6d8/c22/d51/6d8c22d5120ed1224df14b41d908ff67.png"><br><br>  If we talk about monitoring, we all understand that monitoring is necessary.  You need to understand how and why to use it.  We can divide the use of monitoring into three stages, how they come to mind, how people come to them, companies come. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0af/6ef/f21/0af6eff21e8a60e7673c25ed2a6b34d3.png"><br><br>  At the first stage, monitoring is viewed simply as a project status alert system.  Alerting about problems on the server is like the easiest step;  notifications about problems related to the application logic - as a more complicated thing, when we observe that something has become wrong with the site, with the project and we understand this already from some indicators of what is happening on the site;  and alert on issues related to business performance. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/896/baf/cde/896bafcded94365963cc7723dba78171.png"><br><br>  If we talk about the requirements for the warning system itself on any high-loaded project, then we must understand that, first of all, the monitoring system must be independent of the project itself.  It should not be located where the project is located; it should not be associated with it.  If the project falls, the monitoring system should not fall. <br><br>  The monitoring system should inform you as quickly as possible about what is happening on the project.  If you had an accident, or if it seems to you that an accident will happen soon, notifying you that something is happening should not come after a long time, you should know about it as soon as possible.  And you must be sure that you reliably receive information about what is happening with the project.  Those.  You must understand that when the critical indicators that you set for the project are reached, or when some kind of accident occurs on the project, you will receive a corresponding notification. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ac/d54/580/3acd545802f10ef47f00d550caafaf5b.png"><br><br>  If we talk about alert levels.  The first level is a problem on the server, when we simply, in a very basic way, look at some physical indicators, indicators related to the software on the operating system, and basic software.  The second is problems at the application level, when we look at how the application subsystem interacts with other subsystems, how they interact with external services, and what happens there.  And the third level of alert is about problems at the level of business logic. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/763/4e1/5cb/7634e15cbd9ba3b2438b15a14daa89d1.png"><br><br>  Problems on the server.  The simplest things you can monitor there are: <br><br><ul><li>  statistics on the load on the central processor, where we look at the load on the processor itself and on indirect indicators for this load - load average - moving average; </li><li>  statistics on the load on the disk subsystem; </li><li>  statistics of memory usage and swap. </li></ul><br>  If we talk about all the indicators on the server that we can monitor, these three things can first of all tell us that something is wrong with the server.  CPU grows with the growth of traffic or non-optimal code.  The load on the disk subsystem most often occurs when there is a suboptimal interaction with the database.  The use of RAM increases dramatically, and the memory goes to the swap, if your traffic grows, if you again have some kind of non-optimal code. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/647/e57/29c/647e5729c1f73e1f232bf880f6a88b6b.png"><br><br>  Statistics for server software.  We set alerts for drops and surges in the number of requests to the server.  We look externally at checks on the availability of the site, and if we set external checks for accessibility, we should check not only the response time of pages and the response code, but often errors occur on the development side, when instead of http 502, the server gives http 200, and the page , it seems, gives an error, but for the monitoring system, for search engines, it continues to be considered a valid, normal page, in which the text of the error is simply written.  Therefore, we recommend: <br><br><ol><li>  in addition to checking the time and response code, look at the size of the page‚Äôs response when it usually doesn‚Äôt change over time and if something happens due to a big-big crash, the size often drops sharply downwards; </li><li>  With the help of CasperJS tools that have already appeared, look at the time of directly rendering the page.  Very often we see how on some external services (in the last year several times with this the service of comments Cackle sinned), the rendering slowed down dramatically, i.e.  the pages are generated, which you check on the server, but in the browser people only have a piece of some pictures, until the end they are not immersed. </li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/7a0/74e/3e3/7a074e3e38e0a47ce94396499d7a7c9c.png"><br><br>  Alert problems at the application level.  First of all, you should monitor the number of application level errors.  Yes, there are logs that can be viewed, but more often on any projects, sooner or later, there is not enough time to deal with the number of notification messages about which the information comes from the application, in order to make some new features.  Instead of dealing with this thread, one of the simplest methods is to monitor the number of such messages per minute.  Those.  we see that we have about 100-200 such messages per minute, then as a result of some regular calculation, this number rises sharply to 2000-3000, i.e.  we are not interested in a separate line, we are interested in the total large number of these alerts. <br><br>  The number of calls to subsystems / "nodes".  Suppose you have a project that effectively uses the caching system and rarely accesses the database.  It is possible and worth monitoring the number of calls to the database, selects, inserts, updates, delites and continue to look at the changes.  In the process, if you do not have sharp jumps in traffic, this number will keep you approximately equal.  If something happens to you with the caching system, you will see a spike in such requests and realize that something is wrong and should be investigated.  This should be done to any subsystems, and further, based on the information that you collect, put some additional alerts. <br><br>  If you have any external services, I understand the databases, services located on other servers on your site, external API, then you should monitor the interaction with these services.  Especially with external APIs.  We all think that this is a problem for us, and in large companies they do everything cool and good, but our experience of interacting with the APIs of clients tells us that bugs happen there very often, the response time increases dramatically, and you can assume that The site is starting to slow down at you, but in reality this has dramatically deteriorated the interaction with some external API, which we didn‚Äôt even suspect that it could deteriorate.  Accordingly, we put on monitoring the time of interaction of those important requests that we need, and with the jumps in response time in these requests, we begin to investigate what happened to our application, whether it has become worse. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f31/65e/e31/f3165ee312bae573061ff88c76d4dd35.png"><br><br>  There is such a cool thing, which for some reason is very rarely done (which is surprising) - this is monitoring of business logic. <br><br>  When we monitor the server, we have a million indicators that we can monitor, and we can think about one of the indicators that it is not important now: ‚ÄúI will not close it with an alert, I cannot understand what it can to be critical, I cannot understand what to respond to. ‚Äù  And sooner or later, when this indicator comes up, it may happen that you do not have an alert for such an accident, and the accident happened.  All these millions of indicators, in the end, turn into problems with what this application is for.  The application exists, relatively speaking, starting with the amount of money earned per day, the number of users who did some actions, to simple pieces - the number of purchases on the site, the number of orders placed on the site, the number of posts on the site.  All these things are pretty easy to monitor, especially if you are a developer, and put on alerts from this point of view.  Then, even if we missed monitoring and notifications from the server software, even if we began to slow down the hardware, and because of this, users began to fall off on some of their actions, we understand that this drop in traffic or actions occurred for some something for a reason, and we can already investigate the graphs ourselves, investigate the causes of what is happening and figure it out. <br><br>  The second thing you should do often is emulation of user-defined application logic.  We often monitor server things, we monitor hotel scripts for what they answer.  But, for example, it is very cool to monitor, if we have a login to the site, if our user comes and registers, then fills out a form, receives an email with a registration link, clicks on this link and visits the site.  We have at least five places where something can break.  If we monitor each of these five places separately, we are not sure that this whole sequence works as a whole.  Create a script that will go to the site, fill out a form, post the data, then create a script that checks the mail and clicks on the link that was there, just check that the cookie has recovered - this work is technically for two days, and the control that is from this will turn out to significantly exceed the cost of creating this script.  Therefore, I propose that this thing is mandatory for most of the critical functions on the site. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/057/c92/c6c/057c92c6ce2abbd8f0a76b4500202d55.png"><br><br>  Another thing that we do not quite correctly see in monitoring is when alerts are set to critical indicators that are already close to a terrible, terrible disaster.  People put alerts on CPU utilization at 99% for 5-10 minutes.  The moment when such data come to you, you technically can practically do nothing, i.e.  you already have a loaded server, you already have a fallen application, and you need to decide in a rush, in a fire, what to do with it.  At the start of the project, after some launch time, and after you can analyze the nature of your traffic, you can understand the nature of the load.  For example, if your processor is 30% loaded, you do not need to set the alert to 90%, you do not need to set the alert to 99%, you need to choose some key points for which you need to make new decisions.  Those.  50% alert, and you realize that you usually had a 30% load that you are used to, and now 50%.  This is not scary from the point of view of the server‚Äôs work, but it‚Äôs time for you to think about what further growth will be and when you will reach 70%, etc.  In such cases, you will have enough time, when you can decide what to do, if you can still live with it, or it's time to think about how to change the architecture, maybe buy some new hardware, maybe you need to do something with the code, if lately something happened, because of what he began to answer longer, etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b92/2f0/a8c/b922f0a8c2467dfdc8f20d337ddb77bc.png"><br><br>  Monitoring as an analysis system.  If we said before that monitoring is an alert system, then when choosing a monitoring system, we must understand that it is not only an alert system, but also an analysis system that: <br><br><ul><li>  a) must store as much data as possible; </li><li>  b) should provide the ability to quickly select this data for the desired period; </li><li>  c) be able to quickly display them in the form we need. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/51b/4a6/780/51b4a6780137eccc7b23e40f53afcb20.png"><br><br>  Among other things, this gizmo should have the ability to compare data of the same type across different servers, if we say that we have a multi-platform, multi-server system.  Because if we have five servers of the same type, and we look at each one in monitoring separately, we may not notice that one server began to deviate from the others by 30%, but if we group statistics on all five servers, then we will see it. <br><br>  The monitoring system should have a comparison of current data with historical data, because if we have a slight recession or a slight increase over time, just looking with your eye on the graph, you can not pay attention to it.  If we choose two lines - one current, and the second, for example, as it was a month ago, we will see a real difference, and we can already understand what is happening. <br><br>  Fast sampling of a large range of historical data.  The implication is that we actually have a huge amount of data being recorded, and monitoring itself is a highly loaded application.  If the monitoring stores this data, it should be able to unload this data. <br><br>  In a report on RootConf, my colleague and I looked at examples of monitoring systems that are currently available, and if we talk about what can be used, then more or less ready is the classic Zabbix and Graphite.  But what is interesting, what am I talking about the third part with a quick sampling of a large range of historical data - we have, if you look at our clients, somewhere around 70% sits on Zabbix and about 20% sits on Graphite, and any The node with Graphite is concerned with the fact that it is almost 100% clogged on the processor.  Those.  The system is good for recording data, it is good for displaying data, but there are regular problems with the fact that monitoring simply cannot draw what they want from it.  Those.  the system should do it quickly, but you cannot get it quickly. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae1/726/04b/ae172604b7490b233b974ff64dd2d49d.png"><br><br>  An additional thing, if you choose a monitoring system, would be very useful - this is a complex aggregation of metrics.  Most often, some of the metrics on the project can be relatively noise-free, this noise must somehow be minimized, a moving average should be obtained, the percentile should be looked at by requests, in what amount of time 99% of requests were fulfilled, group requests by the minimum time and etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/85c/cb3/ea9/85ccb3ea9bd27455b4c7b3dbeabf9e51.png"><br><br>  In addition, monitoring should be thought of as a decision-making system. <br><br>  Those.  we have monitoring as an alert system, we have monitoring as a system for analyzing why we had a problem, and to understand how to avoid this problem, and most importantly we succeed, we must use the monitoring system as a piece, which will allow us: <br><br><ul><li>  a) understand how the accident happened and what to do so that it does not happen again; </li><li>  b) look at how the system will evolve in the future; </li><li>  c) look at how to do so in order to avoid the mistakes that were already. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/1a7/d48/a41/1a7d48a419ad109ab9bcefc735ab927b.png"><br><br>  If we talk about affordable solutions, from really good ones that work on a small project and do not cost too much in terms of implementation, I believe that you need to use SaaS services.  Three services are listed above, they do not have to be used, they are all about the same.  For a small number of servers, they are inexpensive.  And most importantly, they will not spend your time on their integration. <br><br>  Complicated data collection.  I would now pay attention to Graphite, but you have to suffer a lot when deciding how to store data there.  If you have a very complex system, if you have very complex data, you can think about how to make your system or customize open source heavily, but you need to understand that this is a very, very big contribution to the investment in the development of this system. <br><br>  We use our own system, because we have historically established that the infrastructure is very heterogeneous, we have high demands on how it should be maintained, and how problems should be distributed within the company.  We are developing this thing since 2008.  We have two developers who are constantly engaged in this, and we have very, very many requests from admins how to change this thing further.  The only reason we use this thing, not Graphite or Zabbix, is that we understand what we can get from the monitoring system.  We understand how to modify it, and whether we can or cannot do it.  But besides everything, you need to understand that you get used to the monitoring system, and the moment you choose it, the longer you use the same system, the longer after that you don‚Äôt want to get off of it, even if she is not happy. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c33/6c9/c43/c336c9c431a4759e7a3c3b1947d9af90.png"><br><br>  We turn to the second part.  Let's talk about backup and backup. <br><br>  First of all, I would like to talk about backup.  In fact, this thing is very often among our clients and among those whom we see, it seems to be a simple thing that works by itself and is not even worth thinking about.  However, when backing up, you need to understand that: <br><br><ul><li>  Backup creates load on the server. </li><li>  For your project, the regularity of backups can play a big role.  For example, you constantly have a huge number of users perform some kind of action, let it be a service where people process photos for money.  If your backups are done once a day, the data disappeared, and you recovered from 20 hours ago, you still get a huge amount of problems with the fact that users will say: ‚ÄúOK, but where is my data for the last 20 hours? ". </li><li>  You need to understand that the recovery time from the backup also plays a role.  Those.  you can do a dump, which is done quickly, but in some cases this dump can take a very long time. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/3f2/2da/d41/3f22dad41847ddec937c3f48f2f5dda6.png"><br><br>  Backup process: <br><br><ol><li>  By itself, a hard procedure. </li><li>  Backups because of this, it is best to create c backup machines, without creating a burden on prodakshinovyh machines. </li><li>  You need to understand what you need to reserve.  A classic thing - back up often the base.  "But we have a lot of static generated by users, we will better generate it once a day."  But what is the point every few hours to back up the database, if when you recover from it, you will not have static, and users will be just as dissatisfied as before?  Those.  they will leave, relatively speaking.  You have a second Vkontakte service, you dropped the base, you dropped the server, and you picked up a backup copy of the base, you have links to the photos, but there are no photos themselves ... </li><li>  The classic thing.  A backup without a regular recovery procedure is not a backup.  Very often we see, when people have organized a backup, they load it, and they think that this is enough.  In four out of ten cases from the backup copy, which is, it cannot be restored without checks.  The organization should have a regular recovery procedure, a regular exercise plan, according to which you start to restore from a backup copy at a given date, check for how much you can do, how relevant your data will be, and how well the site will work after restoring from a backup copy . </li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/5ee/a62/f5c/5eea62f5c3c9cb23d1d89f9f8ad1a3a0.png"><br><br>  Backup copies of databases. <br><br>  We use the slave server only as a backup in case of a failure of the master server.  There is a classic story of the fall of Sberbank a few years ago, when they used the slave server as a backup and did nothing else with it.  Those.  there were no backups, there was only a slave, but you need to understand that the slave accepts all requests, and if a person came to the master server and said: ‚ÄúRemove everything from the master server‚Äù, the slave will receive exactly the same command. <br><br>  On some bases, I can not say for Postgres, I saw such things on MySQL, it is possible to make a slave with a delayed update.  This is a small hack that sometimes helps.  Those.  you make a delayed update slave somewhere for 30 minutes, and you already have time when you understand that you accidentally made a drop on the master database, you can abruptly interrupt the replica and switch to the slave instead of doing a long recovery procedure from base. <br><br>  Hot backup services for regular external backup.  Those.  we have a slave to protect against accidents, and a hot-backup to protect against human factors. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7fb/4e1/6d3/7fb4e16d38a52b3b693c47c5c88665b0.png"><br><br>  We store at least one copy within the same area where we are located in order to download it quickly, and we store at least one copy on an external site for recovery in case of a global accident. <br><br>  You cannot keep a copy in the same place where you expect an accident to happen, because when the data cent in Hetzner drops completely, you cannot recover if it falls for several days.  All these few days, you, even with the right backup, even doing the right procedures, will just wait until hosting is up.  At the same time, you need to understand that accidents in hosting services are not always a question of 10, 15, 20 minutes.  Amazon has had four accidents over the past five years, the longest of which lasted 48 hours, the next lasted 24 hours, the next lasted 16 hours, the next lasted about 10 hours.  Every time they said that ‚Äúwe are terribly sorry, we will refund you the money that the hosting cost at this time‚Äù, but it is clear that this is not comparable with the losses that were in fact.  Therefore, to keep backups ideally in another place, where you know that if this platform falls, you can recover. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/16f/108/9a5/16f1089a54341fa5a492693a279ce16a.png"><br><br>  Content  Difficult-complex topic, especially if you have a lot of it.  If you don‚Äôt have much of it, do regular rsync, snapshot.  If you have a lot of it, then it is best to implement this thing immediately at the application level.  Let you upload a photo, some file that is uploaded or processed by the user.  After issuing the content data to the user, make sure that this file is currently duplicated to the backup copy.  Then you will not need to regularly copy the entire pack of changes once a day, once an hour, etc.  One action, but simple, it becomes invisible to the user, because the content is already given to him.  Just the background file is poured to another place, to another site, which is not dependent on the main one. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57f/19a/e16/57f19ae164e7362d244f87da291a472e.png"><br><br>  And the very frequent thing that we see is that the base is backed up, the content is backed up, and the configs are not backed up.  As a result, the data center crashes, the server crashes, you need to recover, we are recovering from backups, we have backup codes, static backup, we have everything cool, but we have a very, very complex web server configuration, and the next few hours the command of this the project is engaged in recovering the config from memory or trying to restore the config two years ago. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/974/0ea/d38/9740ead38be843b5d51147c0a444de84.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is a backup, there is a backup, these are different things. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site selection for reservations.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/71d/9b9/c00/71d9b9c0068d2f4938c4c83d904ac923.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The backup site should not be connected to the current data center. We very often see when the backup server is taken to the main server in the same place, i.e., relatively speaking, the same Hetzner, where you have one machine in the rack and the second machine in the rack acts as a reserve. Yes, it will protect against server crashes, but it will not protect against crashes in the entire data center as a whole. If we choose a backup site to the main one, most often people want to make it cheaper because it does not receive traffic. You need to understand that after switching to the backup, you can be in a situation where you stay with her for a long time. And if you think that it is possible to live on it for an hour, but it will not be possible to live on it for a day or more, it is better to think about whether to do so.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/136/da0/86a/136da086a289a4f727f454dc6bfa5c2e.png"><br><br>    .           ,    .  Those. ,      ,  ,   ,          ,       .         ,      ,    .       : <br><br><ul><li>  ‚Äî     -     . </li><li>  ‚Äî       , ,     ,      ,       .       ,            . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The thing that people often use is so-called. hybrid cloud You have a platform that is under production, and you have a minimal configuration in the clouds that can only accept replication from the production site. If an accident happens on the production site, the clouds scale up to become the same as the site, and traffic switches to them. In the process of a long time, it will be somewhat more expensive than iron production, but in the process of using it in regular mode, when you do not have accidents, you save time and money on this reserve and at the same time do not risk that you can get into switching problems.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6f5/1d3/4a4/6f51d34a4c99bbd30ee2ba6e2c85af24.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Important things when booking. First of all, you need to understand how long it will take you to switch. You need to understand how consistent the data you have synchronized to the reserve. And you need to understand the risk of downtime when switching.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A very, very complicated procedure that people do not like ... Checking recovery from backups is, in principle, simple, but you also need to regularly check the possibility of switching to a backup site. You cannot make a backup site and wait only for the moment when you can switch to it. There are a million options, because of what the reserve may not work. The simplest thing is that they simply did not plan something when designing a backup architecture. Yes, if we switch without a crash, and there is something wrong, the project will fall, then it will be at least a conscious risk. At night or at some quiet time when it can be done. This is better than if, after switching at the time of the accident, you find out that you are missing something, some files are not synchronized, some kind of base is lagging behind, etc. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/157/0ac/1e9/1570ac1e963c20d9e833e49ae854270e.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summing up.</font></font><br><br><ul><li> Slave ‚Äî   . </li><li>     - ‚Äî   . </li><li>     - ‚Äî   . </li><li> ,    ‚Äî   . </li><li>    ‚Äî   ,       ,     . </li><li>     ‚Äî   .    : ¬´,     ,      ,     ¬ª.   , ,      ,   .    ,   ,  .    ,   ,    ,      ,        Hetzner'  60   2  ,         ,    . </li><li> ¬´     ¬ª ‚Äî  ,     .     . </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/4b6/d6d/765/4b6d6d765c02aa41734a2baea0425d29.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And it is important to understand that all these things do not work, if there is no team that will react to these things and do these things. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What should have this team. The team must be inside you. It may be a little outside, but still there must be some people who even inside understand how it all works, and what it should be. They must understand the inside of the product and must be able to localize the problem. They should be involved in the team of your company, simply because most often, according to the law of meanness, accidents occur at night, and in whatever time zone you might be when a person wakes up from a call from a manager or partner, or from an SMS about an accident, he should not score, just hang up, and understand that trouble is happening, and need his help.</font></font><br><br>     ,   ,    ,       .         ,   ,   ,   ,  ,   ,   .    ,             ,      30   ,   ,        .  Those.  : ¬´,  ?¬ª.    . ,   -     ,  : ¬´,   -  ,    ,    ¬ª. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/436/b39/aef/436b39aefe6b3b3cb1e0705c474b3ddb.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All this does not work without organization. Yes, this team is there, but you need to understand that the whole team in the support process very often works in chaotic conditions. An accident arrived, which had never happened before, this accident was corrected. It is necessary to understand how this accident happened, how it was fixed, and how to make it so that it no longer exists. If we fixed the accident and did not understand how to fix it, we actually did not fix it and get another one the same. If we had an incident that was not monitored, we must fundamentally understand that an accident happened, it was not monitored, then the first steps to be taken are monitoring the server, monitoring the application so that such an accident no longer exists.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Such teams do not like the bureaucracy at the time of dealing with the problem, at the time of solving problems, but then you need to seek to formalize what has been done, to formalize all these procedures.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/418/dfa/f57/418dfaf57faf462351d9cfc9e965dd97.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to work on supporting such a thing at the launch of your project. At the start, it will be just SMS to key people and phone calls to people who are awake and constantly watching how it works. Then, it may be the duties of people within the team, additional people. To start is suitable for two after two for 12 hours. But people will not last long, simply because those who will work on the night shift, they may well have wives, children, families. And when they work from 8 in the evening to 8 in the morning (I say this from life experience), at 10-11 in the morning their same wives, children, families, friends, start to call and say: ‚ÄúVasya, let's go further ". And it is very hard at this moment to sleep and understand that you just have no life left.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From experience: each of the people who receive alerts must have at least three phones of critical people to alert them to call and report that there is a problem. One phone may not be taken, two phones may not be taken, but I do not remember cases when they did not pick up the phone with three phone calls.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/526/6a6/10a/5266a610a2624549ced54f40cf4bafea.png"><br><br>  ,         .  Alerts per hour,    ,  ,         ‚Äî    ,  -   .    ,    -  ‚Äî  ,  ,  ,     ‚Äî   ,    .            ,           ,  ,  -   ,     . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Time spent on servers. You may have 20 servers and spend much more time on one of them than the others. Perhaps the team itself does not see this, perhaps you do not see it, but on these servers there is something to deal with. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The thing we have done recently for ourselves is that we began to record SSH sessions. This is not for control, but in order to understand, as a result of accidents, what is the reason. Do not remember how I was doing in a panic the last half hour, trying to quickly perform a surgical operation, but just to look again, find what was done, write down, formulate and understand.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/923/68c/97d/92368c97d1d1618d4e1ff76e639db6f1.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">More about the work. </font><font style="vertical-align: inherit;">This is more from the category of jokes. </font><font style="vertical-align: inherit;">If several key people fly on the same flight in an airplane, the servers will definitely fall. </font><font style="vertical-align: inherit;">You need to make sure that someone from key people always remains in access for servers. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">People who receive SMS. </font><font style="vertical-align: inherit;">Ideally, they have at least two ways to communicate.</font></font> Those.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">receive phone calls, be with a laptop, etc. </font><font style="vertical-align: inherit;">- at least two ways to communicate with you. </font><font style="vertical-align: inherit;">Because cellular communication doesn‚Äôt work everywhere, phones are lost, the phone can fall, two SIM cards - already more reliable protection ... Ideally, a redirect will be set up on the same SIM cards to be unavailable to another person who will respond to this. </font><font style="vertical-align: inherit;">And the last - the life of such people is hard, love them and appreciate. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/8d0/aa8/f03/8d0aa8f03ec034c6370c81ff5503c931.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instead of conclusions.</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Just make a project and run - does not work. </font></font> Those.     ,    ,   ,  , ,     ‚Äî .  ,   . ,  ,     ,    ,    - . </li><li>       ‚Äî   .  ‚Äî  ,      ,  . </li><li>     ‚Äî  . </li><li> , ,      ‚Äî  .       ,     ,    ,   ,   . </li></ul><br><h3>  Contacts </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬ª </font></font><a href="https://habrahabr.ru/users/eapotapov/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eapotapov</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eapotapov@itsumma.ru</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª </font></font><a href="https://www.facebook.com/eapotapov"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facebook</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª </font></font><a href="http://itsumma.ru/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itsumma.ru</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª </font><a href="http://itsumma.ru/"><font style="vertical-align: inherit;">Itsumma </font></a></font><a href="https://habrahabr.ru/company/itsumma/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog</font></font></a> <br><br><blockquote> <font color="gray">  ‚Äî            <a href="http://junior.highload.ru/%3Futm_source%3Dhabr%26utm_medium%3Dmedia%26utm_campaign%3Dpast.articles%26utm_content%3Dcommon">HighLoad++ Junior</a> . <br><br>          -     <a href="http://highload.guide/%3Futm_source%3Dhabr%26utm_medium%3Dmedia%26utm_campaign%3Dpast.articles%26utm_content%3Dcommon">HighLoad.Guide</a> ‚Äî     , , , .       30  . ! <br><br>     ‚Äî      " <a href="http://ritfest.ru/"> -</a> ",     ,  <strong>HighLoad++ Junior</strong> . , ,  ,       ‚Äî     </font> </blockquote></div><p>Source: <a href="https://habr.com/ru/post/321382/">https://habr.com/ru/post/321382/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321372/index.html">Why Zuckerberg chasing a ghost</a></li>
<li><a href="../321374/index.html">Configuring the launch of the GRUB bootloader menu when installing Linux from Windows on one computer with a GPT partition table</a></li>
<li><a href="../321376/index.html">Facebook shareholders want to remove Zuckerberg from the chair of the board of directors</a></li>
<li><a href="../321378/index.html">How to work with JIT</a></li>
<li><a href="../321380/index.html">RethinkDB: very much alive. Now under the wing of the Linux Foundation</a></li>
<li><a href="../321384/index.html">VulnHub: Throwing out the disagreeable from the IRC at Wallaby's Nightmare</a></li>
<li><a href="../321386/index.html">How to evaluate the quality of the A / B testing system</a></li>
<li><a href="../321388/index.html">Questions about relational subd which are never enough time</a></li>
<li><a href="../321390/index.html">6 non-standard tricks to improve the performance and security of the site</a></li>
<li><a href="../321392/index.html">Feature Folders structure in ASP.NET Core MVC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>