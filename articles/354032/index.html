<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fuzzy search in relational databases</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To search for the necessary information on websites and in mobile applications it is often used to search by words or phrases that the user freely ent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fuzzy search in relational databases</h1><div class="post__text post__text-html js-mediator-article">  To search for the necessary information on websites and in mobile applications it is often used to search by words or phrases that the user freely enters from the keyboard (rather than choosing from a list for example).  Naturally, the user can make mistakes and typos.  In this case, full-text search, full-text indexes that are implemented in most databases do not give the expected result and are practically useless.  Such functionality is increasingly implemented on the basis of elasticsearch. <br><br>  Solutions using elasticsearch have one major drawback - a very high probability of misalignment of the main database, for example PostgreSQL, MySQL, mongodb and elasticsearch, in which indexes are stored for the search. <br><a name="habracut"></a><br>  The ideal option would be to have a ‚Äúbridge‚Äù that would assume the function of data matching, in the event that the base for the search engine is unavailable during the update of the main database.  But I have not yet found the realization of such a bridge.  For example, in <a href="https://github.com/lumongo/lumongo/wiki/Overview">one of</a> the mongodb and lucene bundles <a href="https://github.com/lumongo/lumongo/wiki/Overview">projects,</a> this problem is mentioned. <br><blockquote>  Distributed to existing nodes.  This allows for rolling shutdowns.  Existing nodes without committing.  These indexes could require rollback or repair.  It is not always possible to use it.  Since the documents were stored in MongoDB and not in the index, it was possible.  MongoDB also provides seamless failover through replication.  MongoDB's replication is data center aware backups across datacenters are possible. </blockquote>  How is this problem solved in practice?  Yes, nothing.  If the data is not very large, then the database is simply re-indexed by timer.  If the base is large and it is often impossible to reindex it, then everything remains as it is, inconsistent, it is a little more difficult to identify this discrepancy. <br><br>  I hope that sustainable "bridges" that will sustainably update indices in elasticsearch or lucene will appear sooner or later.  Now there is a need to find a working solution. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      One option is to use a single database for data storage and search.  Regarding the use as such a single base elasticsearch, in almost all discussions on the forums there was a consensus that such a solution is not suitable.  Therefore, I began to search for a database in which to create full-text indexes that support fuzzy search.  Since the main engine for such indices, lucene, was developed in java, the range of databases in which I was looking for such a possibility was clearly outlined. <br><br>  As it turned out, there are at least two solutions that use the lucene library and are at the poduction ready application level: these are orientdb and h2. <br><br>  In orientdb, working with fuzzy full-text search is very simple: <br><br><pre><code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> russian <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> property russian.message <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> russian.message <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> russian(message) fulltext <span class="hljs-keyword"><span class="hljs-keyword">engine</span></span> lucene metadata { <span class="hljs-string"><span class="hljs-string">"analyzer"</span></span>: <span class="hljs-string"><span class="hljs-string">"org.apache.lucene.analysis.ru.RussianAnalyzer"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> russian <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> message lucene <span class="hljs-string"><span class="hljs-string">'~0.5'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  The h2 is a bit more complicated.  The index is a separate table with which you need to link the main table.  But a little harder it does not mean difficult. <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALIAS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> FTL_INIT <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-string"><span class="hljs-string">"org.h2.fulltext.FullTextLucene.init"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> FTL_INIT(); <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TEST</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TEST</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, FIRST_NAME <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>, LAST_NAME <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> FTL_CREATE_INDEX(<span class="hljs-string"><span class="hljs-string">'PUBLIC'</span></span>, <span class="hljs-string"><span class="hljs-string">'TEST'</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TEST</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'John'</span></span>, <span class="hljs-string"><span class="hljs-string">'Wayne'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TEST</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'Elton'</span></span>, <span class="hljs-string"><span class="hljs-string">'John'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> FTL_SEARCH_DATA(<span class="hljs-string"><span class="hljs-string">'John'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> FTL_SEARCH_DATA(<span class="hljs-string"><span class="hljs-string">'LAST_NAME:John'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br>  apapacy@gmail.com <br>  April 22, 2018 </div><p>Source: <a href="https://habr.com/ru/post/354032/">https://habr.com/ru/post/354032/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354020/index.html">Solving the riddle of round numbers on the 2018 election chart</a></li>
<li><a href="../354024/index.html">The digest of interesting materials for the mobile developer # 250 (April 16 - April 22)</a></li>
<li><a href="../354026/index.html">Review of OpenDay JetBrains mitap</a></li>
<li><a href="../354028/index.html">Understand Implicits in Scala</a></li>
<li><a href="../354030/index.html">Mobile application in Python with kivy / buildozer. Lecture in Yandex</a></li>
<li><a href="../354034/index.html">Reindexer site search is easy. Or how to make an "instant search" throughout the Habrahabr</a></li>
<li><a href="../354036/index.html">20 Eloquent ORM tricks</a></li>
<li><a href="../354038/index.html">Top VSCode Extensions That Speed ‚Äã‚ÄãUp Your JavaScript Development</a></li>
<li><a href="../354040/index.html">We apply the Deep Watershed Transform in the Kaggle Data Science Bowl 2018 competition.</a></li>
<li><a href="../354044/index.html">Next generation video: introducing AV1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>