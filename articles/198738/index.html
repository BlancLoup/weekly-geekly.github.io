<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Outdoor facilities for MySQL drivers in Node.js</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Who writes on Node.js and uses MySQL, he certainly knows that our dear comrade Felix Geisend√∂rfer accomplished a heroic and selfless deed three years ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Outdoor facilities for MySQL drivers in Node.js</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/468/fdb/eb8/468fdbeb8f1e4a0b98e11fbdf74a7cb6.jpg">  Who writes on Node.js and uses MySQL, he certainly knows that our dear comrade <a href="https://github.com/felixge"><b>Felix Geisend√∂rfer</b></a> accomplished a heroic and selfless deed three years ago: he alone developed a very <a href="https://github.com/felixge/node-mysql">high-quality <b>driver</b></a> for connecting to MySQL, <b>natively implementing the binary protocol of</b> this database in JavaScript.  Then other respected comrades joined the project, support for connection pools, clusters, transactions, recovery with temporary connection loss, etc. was implemented.  Now the <a href="https://npmjs.org/package/mysql">driver</a> is the most developed, well-developed and actively supported from what we have in the open repositories npm and github.  <b>It is</b> even <b>surprising</b> that with a well-designed low-level implementation, <b>all the amenities</b> that this driver provides for the application developer are reduced to a single query method.  For me personally, this is very little, well, Grandpa got used to the convenience of returning scalar values, rows and columns to arrays, introspection of database structures.  So, I am pleased to share these developments with you, my dear Habravchane, but I warn you that all amenities <b>will be on the street</b> .  <a href="https://github.com/felixge/node-mysql/pull/546">Of</a> course, there is the option of tight integration with the driver, but <a href="https://github.com/felixge/node-mysql/pull/546">FelixGe wants</a> to leave the driver extremely low-level, so I stopped at the version of the <a href="https://github.com/tshemsedinov/node-mysql-utilities">external library</a> with the addition to the driver through admixture.  In the form of impurities, convenience got into the <a href="http://habrahabr.ru/post/194250/">Impress</a> platform, as well as published as a patch to the driver.  On the functional and use options below. <br><a name="habracut"></a><br><h4>  Data retrieval facilities </h4><br>  Further, under the word "returns" I will understand the second parameter callback, and not the result of a function call. <br><br>  Selection of <b>one record</b> : connection.  <b>queryRow</b> (sql, values, callback) returns a hash (associative array) in which field names become keys (instead of getting an array in an array via query). <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre><code class="javascript hljs">connection.queryRow(<span class="hljs-string"><span class="hljs-string">'SELECT * FROM Language where LanguageId=?'</span></span>, [<span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, row</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">queryRow</span></span>:row}); <span class="hljs-comment"><span class="hljs-comment">/* Example: queryRow: { LanguageId: 3, LanguageName: 'Russian', LanguageSign: 'ru', LanguageISO: 'ru', Caption: '' } */</span></span> });</code> </pre> </div></div><br>  A sample of a <b>scalar</b> (that is, a single value): connection.  <b>queryValue</b> (sql, values, callback) returns one value (instead of getting an array in an array with one value).  Conveniently when selecting one field from one record, for example, Id by name with indication LIMIT 1 or functions count (*), max (field), etc. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.queryValue(<span class="hljs-string"><span class="hljs-string">'SELECT LanguageName FROM Language where LanguageId=?'</span></span>, [<span class="hljs-number"><span class="hljs-number">8</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, name</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">queryValue</span></span>:name}); <span class="hljs-comment"><span class="hljs-comment">/* Example: queryValue: 'Italiano' */</span></span> });</code> </pre></div></div><br>  Selection of <b>one column</b> : connection.  <b>queryCol</b> (sql, values, callback) returns an array filled with the values ‚Äã‚Äãof one field for each record from the result of the query.  That is, it is a sample of a vertical column, in contrast to a sample of a horizontal queryRow record. <br>  <b>UPD:</b> <a href="https://habrahabr.ru/users/gelas/" class="user_link">gelas</a> convinced me to rename queryArray to queryCol by analogy with queryRow. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.queryCol(<span class="hljs-string"><span class="hljs-string">'SELECT LanguageSign FROM Language'</span></span>, [], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, result</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">queryCal</span></span>:result}); <span class="hljs-comment"><span class="hljs-comment">/* Example: queryArray: [ 'de', 'en', 'es', 'fr', 'it', 'pl', 'ru', 'ua' ] */</span></span> });</code> </pre></div></div><br>  <b>Hash</b> selection: connection.  <b>queryHash</b> (sql, values, callback) returns a hash (associative array) of two-level nesting, where the first level keys are the values ‚Äã‚Äãof the first field from the result of the query, and the second level keys are all fields of the query result (including the first). <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.queryHash( <span class="hljs-string"><span class="hljs-string">'SELECT LanguageSign, LanguageId, LanguageName, Caption, LanguageISO FROM Language'</span></span>, [], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, result</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">queryHash</span></span>:result}); <span class="hljs-comment"><span class="hljs-comment">/* Example: queryHash: { en: { LanguageSign: 'en', LanguageId: 2, LanguageName: 'English', Caption: '', LanguageISO: 'en' }, ru: { LanguageSign: 'ru', LanguageId: 3, LanguageName: 'Russian', Caption: '', LanguageISO: 'ru' }, de: { LanguageSign: 'de', LanguageId: 7, LanguageName: 'Deutsch', Caption: '', LanguageISO: 'de' }, it: { LanguageSign: 'it', LanguageId: 8, LanguageName: 'Italiano', Caption: '', LanguageISO: 'it' } } */</span></span> });</code> </pre></div></div><br>  Selection <b>of key / value pairs</b> : connection.  <b>queryKeyValue</b> (sql, values, callback) returns a hash (associative array), where the key is the first field from the query result of the query. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.queryKeyValue( <span class="hljs-string"><span class="hljs-string">'SELECT LanguageISO, LanguageName FROM Language'</span></span>, [], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, keyValue</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">queryKeyValue</span></span>:keyValue}); <span class="hljs-comment"><span class="hljs-comment">/* Example: keyValue: { en: 'English', ru: 'Russian', uk: 'Ukrainian', es: 'Espanol', fr: 'Francais', de: 'Deutsch', it: 'Italiano', pl: 'Poliski' } */</span></span> });</code> </pre></div></div><br><br><h4>  Introspection facilities </h4><br>  That is, the convenience of obtaining metadata, structures and parameters of the database for their analysis and the automatic construction of logic or interfaces for working with this database. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Getting the <b>primary key</b> : connection.  <b>primary</b> (table, callback) returns a hash (associative array), with metadata about the primary key, see the metadata set in the example. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.primary(<span class="hljs-string"><span class="hljs-string">'Language'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, primary</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">primary</span></span>:primary}); <span class="hljs-comment"><span class="hljs-comment">/* Example: primary: { Table: 'language', Non_unique: 0, Key_name: 'PRIMARY', Seq_in_index: 1, Column_name: 'LanguageId', Collation: 'A', Cardinality: 9, Sub_part: null, Packed: null, Null: '', Index_type: 'BTREE', Comment: '', Index_comment: '' } */</span></span> });</code> </pre></div></div><br>  Getting <b>foreign keys</b> : connection.  <b>foreign</b> (table, callback) returns a hash (associative array), with double nesting, on the first level are the names of foreign keys, and on the second - the metadata describing this key.  A set of fields, see example. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.foreign(<span class="hljs-string"><span class="hljs-string">'TemplateCaption'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, foreign</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">foreign</span></span>:foreign}); <span class="hljs-comment"><span class="hljs-comment">/* Example: foreign: { fkTemplateCaptionLanguage: { CONSTRAINT_NAME: 'fkTemplateCaptionLanguage', COLUMN_NAME: 'LanguageId', ORDINAL_POSITION: 1, POSITION_IN_UNIQUE_CONSTRAINT: 1, REFERENCED_TABLE_NAME: 'language', REFERENCED_COLUMN_NAME: 'LanguageId' }, fkTemplateCaptionTemplate: { CONSTRAINT_NAME: 'fkTemplateCaptionTemplate', COLUMN_NAME: 'TemplateId', ORDINAL_POSITION: 1, POSITION_IN_UNIQUE_CONSTRAINT: 1, REFERENCED_TABLE_NAME: 'template', REFERENCED_COLUMN_NAME: 'TemplateId' } */</span></span> });</code> </pre></div></div><br>  Getting <b>integrity constraints</b> : connection.  <b>constraints</b> (table, callback) returns a hash (associative array), with double nesting, at the first level the names of integrity constraints, and at the second level - metadata describing each constraint.  A set of fields, see example. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.constraints(<span class="hljs-string"><span class="hljs-string">'TemplateCaption'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, constraints</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">constraints</span></span>:constraints}); <span class="hljs-comment"><span class="hljs-comment">/* Example: constraints: { fkTemplateCaptionLanguage: { CONSTRAINT_NAME: 'fkTemplateCaptionLanguage', UNIQUE_CONSTRAINT_NAME: 'PRIMARY', REFERENCED_TABLE_NAME: 'Language', MATCH_OPTION: 'NONE', UPDATE_RULE: 'RESTRICT', DELETE_RULE: 'CASCADE' }, fkTemplateCaptionTemplate: { CONSTRAINT_NAME: 'fkTemplateCaptionTemplate', UNIQUE_CONSTRAINT_NAME: 'PRIMARY', REFERENCED_TABLE_NAME: 'Template', MATCH_OPTION: 'NONE', UPDATE_RULE: 'RESTRICT', DELETE_RULE: 'CASCADE' } } */</span></span> });</code> </pre></div></div><br>  Getting metadata <b>about table fields</b> : connection.  <b>fields</b> (table, callback) returns an array with metadata for each field, including the name, type, all modifiers and flags, comments (see the example for more details). <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.fields(<span class="hljs-string"><span class="hljs-string">'Language'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, fields</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">fields</span></span>:fields}); <span class="hljs-comment"><span class="hljs-comment">/* Example: fields: { LanguageId: { Field: 'LanguageId', Type: 'int(10) unsigned', Collation: null, Null: 'NO', Key: 'PRI', Default: null, Extra: 'auto_increment', Privileges: 'select,insert,update,references', Comment: 'Id(EN),(RU)' }, LanguageName: { Field: 'LanguageName', Type: 'varchar(32)', Collation: 'utf8_general_ci', Null: 'NO', Key: 'UNI', Default: null, Extra: '', Privileges: 'select,insert,update,references', Comment: 'Name(EN),(RU)' }, ... } */</span></span> });</code> </pre></div></div><br>  Getting a list <b>of databases</b> available on this connection: connection.  <b>databases</b> (callback) returns an array of database names (or "schemes", as they are sometimes called). <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.databases(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, databases</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">databases</span></span>:databases}); <span class="hljs-comment"><span class="hljs-comment">/* Example: databases: [ 'information_schema', 'mezha', 'mysql', 'performance_schema', 'test' ] */</span></span> });</code> </pre></div></div><br>  Getting the list of <b>tables</b> for the database selected as current for this connection: connection.  <b>tables</b> (callback) returns a hash (associative array) of double nesting, where at the first level the keys are the names of the tables, and at the second level the metadata for each table. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.tables(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, tables</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">tables</span></span>:tables}); <span class="hljs-comment"><span class="hljs-comment">/* Example: tables: { Language: { TABLE_NAME: 'Language', TABLE_TYPE: 'BASE TABLE', ENGINE: 'InnoDB', VERSION: 10, ROW_FORMAT: 'Compact', TABLE_ROWS: 9, AVG_ROW_LENGTH: 1820, DATA_LENGTH: 16384, MAX_DATA_LENGTH: 0, INDEX_LENGTH: 49152, DATA_FREE: 8388608, AUTO_INCREMENT: 10, CREATE_TIME: Mon Jul 15 2013 03:06:08 GMT+0300 ( ()), UPDATE_TIME: null, CHECK_TIME: null, TABLE_COLLATION: 'utf8_general_ci', CHECKSUM: null, CREATE_OPTIONS: '', TABLE_COMMENT: '_Language:Languages(EN),(RU)' }, ... } */</span></span> });</code> </pre></div></div><br>  <b>UPD:</b> Get a list of <b>tables</b> for the specified database: connection.  <b>databaseTables</b> (database, callback) returns a hash (associative array) of double nesting, where at the first level the keys are the names of the tables and at the second level the metadata for each table. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.databaseTables(<span class="hljs-string"><span class="hljs-string">"databaseName"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, tables</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">databaseTables</span></span>:tables}); <span class="hljs-comment"><span class="hljs-comment">/* Example: tables: { Language: { TABLE_NAME: 'Language', TABLE_TYPE: 'BASE TABLE', ENGINE: 'InnoDB', VERSION: 10, ROW_FORMAT: 'Compact', TABLE_ROWS: 9, AVG_ROW_LENGTH: 1820, DATA_LENGTH: 16384, MAX_DATA_LENGTH: 0, INDEX_LENGTH: 49152, DATA_FREE: 8388608, AUTO_INCREMENT: 10, CREATE_TIME: Mon Jul 15 2013 03:06:08 GMT+0300 ( ()), UPDATE_TIME: null, CHECK_TIME: null, TABLE_COLLATION: 'utf8_general_ci', CHECKSUM: null, CREATE_OPTIONS: '', TABLE_COMMENT: '_Language:Languages(EN),(RU)' }, ... } */</span></span> });</code> </pre></div></div><br>  Getting the <b>metadata of the specified table</b> : connection.  <b>tableInfo</b> (table, callback) returns a hash (associative array) with metadata (for more details, see the example). <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.tableInfo(<span class="hljs-string"><span class="hljs-string">'Language'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, info</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">tableInfo</span></span>:info}); <span class="hljs-comment"><span class="hljs-comment">/* Example: tableInfo: { Name: 'language', Engine: 'InnoDB', Version: 10, Row_format: 'Compact', Rows: 9, Avg_row_length: 1820, Data_length: 16384, Max_data_length: 0, Index_length: 49152, Data_free: 9437184, Auto_increment: 10, Create_time: Mon Jul 15 2013 03:06:08 GMT+0300 ( ()), Update_time: null, Check_time: null, Collation: 'utf8_general_ci', Checksum: null, Create_options: '', Comment: '' } */</span></span> });</code> </pre></div></div><br>  Getting metadata about <b>all keys of this table</b> : connection.  <b>indexes</b> (table, callback) returns a hash (associative array)?  the keys of the first level in it are the names of the keys of the database (), and the keys of the second level are the metadata about each key (see the example for a detailed list of metadata). <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.indexes(<span class="hljs-string"><span class="hljs-string">'Language'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, info</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">tableInfo</span></span>:info}); <span class="hljs-comment"><span class="hljs-comment">/* Example: indexes: { PRIMARY: { Table: 'language', Non_unique: 0, Key_name: 'PRIMARY', Seq_in_index: 1, Column_name: 'LanguageId', Collation: 'A', Cardinality: 9, Sub_part: null, Packed: null, Null: '', Index_type: 'BTREE', Comment: '', Index_comment: '' }, akLanguage: { Table: 'language', Non_unique: 0, Key_name: 'akLanguage', Seq_in_index: 1, Column_name: 'LanguageName', Collation: 'A', Cardinality: 9, Sub_part: null, Packed: null, Null: '', Index_type: 'BTREE', Comment: '', Index_comment: '' } } */</span></span> });</code> </pre></div></div><br>  Getting <b>processes on the</b> MySQL <b>server</b> : connection.  <b>processes</b> (callback) returns an array of hashes, where for each process its parameters are given. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.processes(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, processes</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">processes</span></span>:processes}); <span class="hljs-comment"><span class="hljs-comment">/* Example: processes: [ { ID: 62, USER: 'mezha', HOST: 'localhost:14188', DB: 'mezha', COMMAND: 'Query', TIME: 0, STATE: 'executing', INFO: 'SELECT * FROM information_schema.PROCESSLIST' }, { ID: 33, USER: 'root', HOST: 'localhost:39589', DB: null, COMMAND: 'Sleep', TIME: 1, STATE: '', INFO: null } ] */</span></span> });</code> </pre></div></div><br>  Getting MySQL <b>global variables</b> : connection.  <b>globalVariables</b> (callback) <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.globalVariables(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, globalVariables</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">globalVariables</span></span>:globalVariables}); <span class="hljs-comment"><span class="hljs-comment">/* Example: globalVariables: { MAX_PREPARED_STMT_COUNT: '16382', MAX_JOIN_SIZE: '18446744073709551615', HAVE_CRYPT: 'NO', PERFORMANCE_SCHEMA_EVENTS_WAITS_HISTORY_LONG_SIZE: '10000', INNODB_VERSION: '5.5.32', FLUSH_TIME: '1800', MAX_ERROR_COUNT: '64', ... } */</span></span> });</code> </pre></div></div><br>  Getting the <b>global status of</b> MySQL: connection.  <b>globalStatus</b> (callback) <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.globalStatus(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, globalStatus</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">globalStatus</span></span>:globalStatus}); <span class="hljs-comment"><span class="hljs-comment">/* Example: globalStatus: { ABORTED_CLIENTS: '54', ABORTED_CONNECTS: '2', BINLOG_CACHE_DISK_USE: '0', BINLOG_CACHE_USE: '0', BINLOG_STMT_CACHE_DISK_USE: '0', BINLOG_STMT_CACHE_USE: '0', BYTES_RECEIVED: '654871', BYTES_SENT: '212454927', COM_ADMIN_COMMANDS: '594', ... } */</span></span> });</code> </pre></div></div><br>  Getting a <b>list of</b> MySQL <b>users</b> : connection.  <b>users</b> (callback) <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.users(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, users</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">users</span></span>:users}); <span class="hljs-comment"><span class="hljs-comment">/* Example: users: [ { Host: 'localhost', User: 'root', Password: '*90E462C37378CED12064BB3388827D2BA3A9B689', Select_priv: 'Y', Insert_priv: 'Y', Update_priv: 'Y', Delete_priv: 'Y', Create_priv: 'Y', Drop_priv: 'Y', Reload_priv: 'Y', Shutdown_priv: 'Y', Process_priv: 'Y', File_priv: 'Y', Grant_priv: 'Y', References_priv: 'Y', Index_priv: 'Y', Alter_priv: 'Y', Show_db_priv: 'Y', Super_priv: 'Y', Create_tmp_table_priv: 'Y', Lock_tables_priv: 'Y', Execute_priv: 'Y', Repl_slave_priv: 'Y', Repl_client_priv: 'Y', Create_view_priv: 'Y', Show_view_priv: 'Y', Create_routine_priv: 'Y', Alter_routine_priv: 'Y', Create_user_priv: 'Y', Event_priv: 'Y', Trigger_priv: 'Y', Create_tablespace_priv: 'Y', ssl_type: '', ssl_cipher: &lt;Buffer &gt;, x509_issuer: &lt;Buffer &gt;, x509_subject: &lt;Buffer &gt;, max_questions: 0, max_updates: 0, max_connections: 0, max_user_connections: 0, plugin: '', authentication_string: '' }, ... ] */</span></span> });</code> </pre></div></div><br><br><h4>  Query generation facilities </h4><br>  Well, quite lordly convenience, allowing to generate SQL or fully or separate WHERE expressions.  I myself do not advocate such sugar, but sometimes it is necessary to automate the generation of requests that are not known in advance and I allow myself the luxury. <br><br>  <b>Condition generation</b> : connection.  <b>where</b> (conditions) works synchronously, not asynchronously, like other functions, i.e.  does not use callback.  Returns a built-in WHERE SQL expression for conditions described in JSON style.  It is necessary to look at an example to understand: <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> where = connection.where({ <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">year</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;2010"</span></span>, <span class="hljs-attr"><span class="hljs-attr">price</span></span>: <span class="hljs-string"><span class="hljs-string">"100..200"</span></span>, <span class="hljs-attr"><span class="hljs-attr">level</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;=3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">sn</span></span>: <span class="hljs-string"><span class="hljs-string">"*str?"</span></span>, <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">"str"</span></span>, <span class="hljs-attr"><span class="hljs-attr">code</span></span>: <span class="hljs-string"><span class="hljs-string">"(1,2,4,10,11)"</span></span> }); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir(where); <span class="hljs-comment"><span class="hljs-comment">// Output: "id = 5 AND year &gt; '2010' AND (price BETWEEN '100' AND '200') AND // level &lt;= '3' AND sn LIKE '%str_' AND label = 'str' AND code IN (1,2,4,10,11)"</span></span></code> </pre></div></div><br>  <b>Sample</b> with the condition: connection.  <b>select</b> (table, whereFilter, callback) <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.select(<span class="hljs-string"><span class="hljs-string">'Language'</span></span>, <span class="hljs-string"><span class="hljs-string">'*'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">LanguageId</span></span>: <span class="hljs-string"><span class="hljs-string">"1..3"</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, results</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">select</span></span>:results}); });</code> </pre></div></div><br>  <b>Insert</b> record: connection.  <b>insert</b> (table, row, callback) <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.insert(<span class="hljs-string"><span class="hljs-string">'Language'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">LanguageName</span></span>: <span class="hljs-string"><span class="hljs-string">'Tatar'</span></span>, <span class="hljs-attr"><span class="hljs-attr">LanguageSign</span></span>:<span class="hljs-string"><span class="hljs-string">'TT'</span></span>, <span class="hljs-attr"><span class="hljs-attr">LanguageISO</span></span>:<span class="hljs-string"><span class="hljs-string">'TT'</span></span>, <span class="hljs-attr"><span class="hljs-attr">Caption</span></span>:<span class="hljs-string"><span class="hljs-string">'Tatar'</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, recordId</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">insert</span></span>:recordId}); });</code> </pre></div></div><br>  <b>Change</b> record: connection.  <b>update</b> (table, row, callback) <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.update(<span class="hljs-string"><span class="hljs-string">'Language'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">LanguageId</span></span>: <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-attr"><span class="hljs-attr">LanguageName</span></span>:<span class="hljs-string"><span class="hljs-string">'Tatarca'</span></span>, <span class="hljs-attr"><span class="hljs-attr">LanguageSign</span></span>:<span class="hljs-string"><span class="hljs-string">'TT'</span></span>, <span class="hljs-attr"><span class="hljs-attr">LanguageISO</span></span>:<span class="hljs-string"><span class="hljs-string">'TT'</span></span>, <span class="hljs-attr"><span class="hljs-attr">Caption</span></span>:<span class="hljs-string"><span class="hljs-string">'Tatarca'</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, affectedRows</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">update</span></span>:affectedRows}); });</code> </pre></div></div><br>  <b>Insert</b> , if there is no such record or <b>change</b> , if it already exists: connection.  <b>upsert</b> (table, row, callback) <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.upsert(<span class="hljs-string"><span class="hljs-string">'Language'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">LanguageId</span></span>: <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-attr"><span class="hljs-attr">LanguageName</span></span>:<span class="hljs-string"><span class="hljs-string">'Tatarca'</span></span>, <span class="hljs-attr"><span class="hljs-attr">LanguageSign</span></span>:<span class="hljs-string"><span class="hljs-string">'TT'</span></span>, <span class="hljs-attr"><span class="hljs-attr">LanguageISO</span></span>:<span class="hljs-string"><span class="hljs-string">'TT'</span></span>, <span class="hljs-attr"><span class="hljs-attr">Caption</span></span>:<span class="hljs-string"><span class="hljs-string">'Tatarca'</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, affectedRows</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">upsert</span></span>:affectedRows}); });</code> </pre></div></div><br>  Getting the <b>number of records</b> in the table for a given filter or without filter: connection.count (table, whereFilter, callback) <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.count(<span class="hljs-string"><span class="hljs-string">'Language'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">LanguageId</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;3"</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, count</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">count</span></span>:count}); <span class="hljs-comment"><span class="hljs-comment">/* Example: count: 9 */</span></span> });</code> </pre></div></div><br>  <b>Deleting a</b> record or several records: connection.  <b>delete</b> (table, whereFilter, callback) <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">connection.delete(<span class="hljs-string"><span class="hljs-string">'Language'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">LanguageSign</span></span>:<span class="hljs-string"><span class="hljs-string">'TT'</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, affectedRows</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir({<span class="hljs-attr"><span class="hljs-attr">delete</span></span>:affectedRows}); });</code> </pre></div></div><br><br><h4>  Use cases </h4><br>  <b>UPD:</b> It is preferable to use an <a href="https://github.com/tshemsedinov/node-mysql-utilities">independent module</a> , with a higher level of abstraction than just a driver, but not as high as the ORM library.  I do not want to do a cumbersome thing out of this, and I want to leave the opportunity to add functionality to the compound through impurities (only necessary) groups of functions. <br>  This is done like this: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Library dependencies var mysql = require('mysql'), mysqlUtilities = require('utilities'); var connection = mysql.createConnection({ host: 'localhost', user: 'userName', password: 'secret', database: 'databaseName' }); connection.connect(); // Mix-in for Data Access Methods and SQL Autogenerating Methods mysqlUtilities.upgrade(connection); // Mix-in for Introspection Methods mysqlUtilities.introspection(connection); // Do something using utilities connection.queryRow( 'SELECT * FROM _Language where LanguageId=?', [3], function(err, row) { console.dir({queryRow:row}); } ); // Release connection connection.end();</span></span></code> </pre><br><br>  There is also a patch to the node-mysql driver with all the above functions: <a href="https://github.com/felixge/node-mysql">https://github.com/felixge/node-mysql</a> <br><br>  And the third use case is the <a href="https://github.com/tshemsedinov/impress">Impress</a> application server for Node.js, which has this library built into it.  Two groups of functions in the sample in Impress immediately have all connections to MySQL, they are automatically added when opening the connection, and only introspection can be added via the config where you need to uncomment the corresponding plug-in so that the set of plug-ins for MySQL is: <br><pre> <code class="javascript hljs"> plugins: { <span class="hljs-attr"><span class="hljs-attr">require</span></span>: [ <span class="hljs-string"><span class="hljs-string">"db"</span></span>, <span class="hljs-string"><span class="hljs-string">"db.mysql"</span></span>, <span class="hljs-string"><span class="hljs-string">"db.mysql.introspection"</span></span>, ... ] },...</code> </pre><br>  Then the plugin will automatically be added to each connection: if (db.mysql.introspection) db.mysql.introspection (connection); <br>  Here is the source of the plugins for <a href="http://habrahabr.ru/post/194250/">Impress</a> : <br><ul><li>  <a href="">https://github.com/tshemsedinov/impress/blob/master/lib/db.mysql.js</a> </li><li>  <a href="">https://github.com/tshemsedinov/impress/blob/master/lib/db.mysql.introspection.js</a> </li></ul><br><h4>  Links </h4><br>  <b>UPD:</b> At the time of writing, there were two options for implementation (as a patch to the driver and as modules for Impress), but the survey convincingly showed that it makes sense to spend time and arrange this library as a separate module.  This was done by the evening of the same day.  But I do not close the survey to determine the degree of usefulness of these amenities. <br><br>  The main use case is here: <br>  In Github: <a href="https://github.com/tshemsedinov/node-mysql-utilities">https://github.com/tshemsedinov/node-mysql-utilities</a> <br>  In the nmp repository: <a href="https://npmjs.org/package/mysql-utilities">https://npmjs.org/package/mysql-utilities</a> </div><p>Source: <a href="https://habr.com/ru/post/198738/">https://habr.com/ru/post/198738/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../198726/index.html">How to choose features for your application: use the Kano model</a></li>
<li><a href="../198728/index.html">DevExtreme: Quickly create a cross-platform HTML5 business application in Visual Studio</a></li>
<li><a href="../198730/index.html">The most useful Google Analytics updates in 2013</a></li>
<li><a href="../198732/index.html">Add QI Wireless Charging to Your Smartphone</a></li>
<li><a href="../198734/index.html">Concrete5 Development: The Simplest Module</a></li>
<li><a href="../198740/index.html">Restoring PlexConnect for Apple TV</a></li>
<li><a href="../198750/index.html">Why do startups need a good "felling"?</a></li>
<li><a href="../198762/index.html">Chicken or egg: what before, prototypes or TK?</a></li>
<li><a href="../198764/index.html">A record for the speed of data transmission through lasers to the moon and back</a></li>
<li><a href="../198766/index.html">How 45 minutes to lose $ 172 222 per second</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>