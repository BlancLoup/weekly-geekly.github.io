<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Overcoming blocking in TTC (Transtelecom) with pf</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After reading the article by the respected ValdikSS, I decided to study the DPI of my provider and, with favorable developments, find ways to circumve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Overcoming blocking in TTC (Transtelecom) with pf</h1><div class="post__text post__text-html js-mediator-article">  After reading the <a href="https://habrahabr.ru/post/335436/">article by the</a> respected <a href="https://habrahabr.ru/users/valdikss/" class="user_link">ValdikSS,</a> I decided to study the DPI of my provider and, with favorable developments, find ways to circumvent it.  Below are the results of my research. <br><br>  So, the provider is TTK Ulyanovsk (formerly DARS Telecom), PPPoE connection with external IP allocation for the duration of the session.  Blocking is accomplished by wrapping blocked subnets / hosts on your DPI.  DNS is not replaced. <br><a name="habracut"></a><br><pre><code class="hljs css">% <span class="hljs-selector-tag"><span class="hljs-selector-tag">traceroute</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ya</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ru</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">traceroute</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ya</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ru</span></span> (87<span class="hljs-selector-class"><span class="hljs-selector-class">.250</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.250</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.242</span></span>), 64 <span class="hljs-selector-tag"><span class="hljs-selector-tag">hops</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span>, 40 <span class="hljs-selector-tag"><span class="hljs-selector-tag">byte</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">packets</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">bras</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ulttk</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ru</span></span> (79<span class="hljs-selector-class"><span class="hljs-selector-class">.132</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.125</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>) 0<span class="hljs-selector-class"><span class="hljs-selector-class">.899</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.787</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.817</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">ulk06</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ulk26</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.transtelecom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.net</span></span> (217<span class="hljs-selector-class"><span class="hljs-selector-class">.150</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.41</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.98</span></span>) 1<span class="hljs-selector-class"><span class="hljs-selector-class">.552</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.536</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.536</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 3 * * * 4 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Yandex-gw</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.transtelecom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.net</span></span> (188<span class="hljs-selector-class"><span class="hljs-selector-class">.43</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.213</span></span>) 21<span class="hljs-selector-class"><span class="hljs-selector-class">.828</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 15<span class="hljs-selector-class"><span class="hljs-selector-class">.955</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 17<span class="hljs-selector-class"><span class="hljs-selector-class">.003</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> % <span class="hljs-selector-tag"><span class="hljs-selector-tag">traceroute</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">rutracker</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.org</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">traceroute</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">rutracker</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.org</span></span> (195<span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.146</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.214</span></span>), 64 <span class="hljs-selector-tag"><span class="hljs-selector-tag">hops</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span>, 40 <span class="hljs-selector-tag"><span class="hljs-selector-tag">byte</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">packets</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">bras</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ulttk</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ru</span></span> (79<span class="hljs-selector-class"><span class="hljs-selector-class">.132</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.125</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>) 1<span class="hljs-selector-class"><span class="hljs-selector-class">.778</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.843</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.751</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">ulk06</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ulk26</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.transtelecom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.net</span></span> (217<span class="hljs-selector-class"><span class="hljs-selector-class">.150</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.41</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.98</span></span>) 1<span class="hljs-selector-class"><span class="hljs-selector-class">.656</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.698</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.439</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 3 * * * 4 188<span class="hljs-selector-class"><span class="hljs-selector-class">.43</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.18</span></span> (188<span class="hljs-selector-class"><span class="hljs-selector-class">.43</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.18</span></span>) 16<span class="hljs-selector-class"><span class="hljs-selector-class">.589</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BlackList-gw</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.transtelecom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.net</span></span> (188<span class="hljs-selector-class"><span class="hljs-selector-class">.43</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.130</span></span>) 16<span class="hljs-selector-class"><span class="hljs-selector-class">.435</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BL-gw</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.transtelecom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.net</span></span> (188<span class="hljs-selector-class"><span class="hljs-selector-class">.43</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.31</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.170</span></span>) 16<span class="hljs-selector-class"><span class="hljs-selector-class">.377</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 5 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Filter-gw</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.transtelecom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.net</span></span> (188<span class="hljs-selector-class"><span class="hljs-selector-class">.43</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.33</span></span>) 17<span class="hljs-selector-class"><span class="hljs-selector-class">.006</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 16<span class="hljs-selector-class"><span class="hljs-selector-class">.859</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 17<span class="hljs-selector-class"><span class="hljs-selector-class">.080</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> % <span class="hljs-selector-tag"><span class="hljs-selector-tag">traceroute</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">kinozal</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.tv</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">traceroute</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Warning</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">kinozal</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.tv</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">has</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">multiple</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addresses</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> 104<span class="hljs-selector-class"><span class="hljs-selector-class">.24</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.107</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.53</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">traceroute</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">kinozal</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.tv</span></span> (104<span class="hljs-selector-class"><span class="hljs-selector-class">.24</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.107</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.53</span></span>), 64 <span class="hljs-selector-tag"><span class="hljs-selector-tag">hops</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span>, 40 <span class="hljs-selector-tag"><span class="hljs-selector-tag">byte</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">packets</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">bras</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ulttk</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ru</span></span> (79<span class="hljs-selector-class"><span class="hljs-selector-class">.132</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.125</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>) 0<span class="hljs-selector-class"><span class="hljs-selector-class">.810</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.809</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.739</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">ulk06</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ulk26</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.transtelecom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.net</span></span> (217<span class="hljs-selector-class"><span class="hljs-selector-class">.150</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.41</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.98</span></span>) 1<span class="hljs-selector-class"><span class="hljs-selector-class">.653</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.802</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.736</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 3 * * * 4 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Filter-gw</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.transtelecom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.net</span></span> (188<span class="hljs-selector-class"><span class="hljs-selector-class">.43</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.34</span></span>) 16<span class="hljs-selector-class"><span class="hljs-selector-class">.451</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BL-gw</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.transtelecom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.net</span></span> (188<span class="hljs-selector-class"><span class="hljs-selector-class">.43</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.31</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.170</span></span>) 16<span class="hljs-selector-class"><span class="hljs-selector-class">.405</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 16<span class="hljs-selector-class"><span class="hljs-selector-class">.418</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 5 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Filter-gw</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.transtelecom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.net</span></span> (188<span class="hljs-selector-class"><span class="hljs-selector-class">.43</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.33</span></span>) 99<span class="hljs-selector-class"><span class="hljs-selector-class">.751</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 78<span class="hljs-selector-class"><span class="hljs-selector-class">.541</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 17<span class="hljs-selector-class"><span class="hljs-selector-class">.021</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 6 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cloudflare-msk-gw</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.transtelecom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.net</span></span> (188<span class="hljs-selector-class"><span class="hljs-selector-class">.43</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.65</span></span>) 212<span class="hljs-selector-class"><span class="hljs-selector-class">.754</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 107<span class="hljs-selector-class"><span class="hljs-selector-class">.803</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 117<span class="hljs-selector-class"><span class="hljs-selector-class">.062</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 7 104<span class="hljs-selector-class"><span class="hljs-selector-class">.24</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.107</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.53</span></span> (104<span class="hljs-selector-class"><span class="hljs-selector-class">.24</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.107</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.53</span></span>) 28<span class="hljs-selector-class"><span class="hljs-selector-class">.015</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 17<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span> 17<span class="hljs-selector-class"><span class="hljs-selector-class">.357</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ms</span></span></code> </pre> <br>  And some sites are simply and simply blocked by IP (thanks at least send RST).  For example, Rutreker's bt-announcers: <br><br><pre> <code class="hljs css">02<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:48</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:58.530078</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">tos</span></span> 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x0</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">ttl</span></span> 64, <span class="hljs-selector-tag"><span class="hljs-selector-tag">id</span></span> 0, <span class="hljs-selector-tag"><span class="hljs-selector-tag">offset</span></span> 0, <span class="hljs-selector-tag"><span class="hljs-selector-tag">flags</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[DF]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">proto</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">TCP</span></span> (6), <span class="hljs-selector-tag"><span class="hljs-selector-tag">length</span></span> 60) <span class="hljs-selector-tag"><span class="hljs-selector-tag">ip109</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.176</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ulttk</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ru</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.22099</span></span> &gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bt</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.rutracker</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.http</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Flags</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[S]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cksum</span></span> 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">xd538</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">correct</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">seq</span></span> 3425095266, <span class="hljs-selector-tag"><span class="hljs-selector-tag">win</span></span> 65535, <span class="hljs-selector-tag"><span class="hljs-selector-tag">options</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[mss 1452,nop,wscale 6,sackOK,TS val 1991139339 ecr 0]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">length</span></span> 0 02<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:48</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:58.546482</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">tos</span></span> 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x0</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">ttl</span></span> 61, <span class="hljs-selector-tag"><span class="hljs-selector-tag">id</span></span> 0, <span class="hljs-selector-tag"><span class="hljs-selector-tag">offset</span></span> 0, <span class="hljs-selector-tag"><span class="hljs-selector-tag">flags</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[DF]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">proto</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">TCP</span></span> (6), <span class="hljs-selector-tag"><span class="hljs-selector-tag">length</span></span> 40) <span class="hljs-selector-tag"><span class="hljs-selector-tag">bt</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.rutracker</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.http</span></span> &gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">ip109</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.176</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ulttk</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ru</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.22099</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Flags</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[R.]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cksum</span></span> 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x13b9</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">correct</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">seq</span></span> 0, <span class="hljs-selector-tag"><span class="hljs-selector-tag">ack</span></span> 3425095267, <span class="hljs-selector-tag"><span class="hljs-selector-tag">win</span></span> 0, <span class="hljs-selector-tag"><span class="hljs-selector-tag">length</span></span> 0</code> </pre> <br>  For the same sites where you need to show the blocking page, passive DPI works.  Consider the example of Rutreker: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs perl"><span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">28.605860</span></span> IP (tos <span class="hljs-number"><span class="hljs-number">0x0</span></span>, ttl <span class="hljs-number"><span class="hljs-number">64</span></span>, id <span class="hljs-number"><span class="hljs-number">0</span></span>, offset <span class="hljs-number"><span class="hljs-number">0</span></span>, flags [DF], proto TCP (<span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span>) ip109.<span class="hljs-number"><span class="hljs-number">176</span></span>.ulttk.ru.<span class="hljs-number"><span class="hljs-number">27338</span></span> &gt; rutracker.org.http: Flags [S], cksum <span class="hljs-number"><span class="hljs-number">0xeafc</span></span> (correct), seq <span class="hljs-number"><span class="hljs-number">3703194126</span></span>, win <span class="hljs-number"><span class="hljs-number">65535</span></span>, options [mss <span class="hljs-number"><span class="hljs-number">1452</span></span>,nop,wscale <span class="hljs-number"><span class="hljs-number">6</span></span>,sackOK,TS val <span class="hljs-number"><span class="hljs-number">1989849414</span></span> ecr <span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">28.646812</span></span> IP (tos <span class="hljs-number"><span class="hljs-number">0x0</span></span>, ttl <span class="hljs-number"><span class="hljs-number">58</span></span>, id <span class="hljs-number"><span class="hljs-number">0</span></span>, offset <span class="hljs-number"><span class="hljs-number">0</span></span>, flags [DF], proto TCP (<span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span>) rutracker.org.http &gt; ip109.<span class="hljs-number"><span class="hljs-number">176</span></span>.ulttk.ru.<span class="hljs-number"><span class="hljs-number">27338</span></span>: Flags [S.], cksum <span class="hljs-number"><span class="hljs-number">0x81d2</span></span> (correct), seq <span class="hljs-number"><span class="hljs-number">2683499593</span></span>, ack <span class="hljs-number"><span class="hljs-number">3703194127</span></span>, win <span class="hljs-number"><span class="hljs-number">14600</span></span>, options [mss <span class="hljs-number"><span class="hljs-number">1400</span></span>,nop,wscale <span class="hljs-number"><span class="hljs-number">8</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">28.646913</span></span> IP (tos <span class="hljs-number"><span class="hljs-number">0x0</span></span>, ttl <span class="hljs-number"><span class="hljs-number">64</span></span>, id <span class="hljs-number"><span class="hljs-number">0</span></span>, offset <span class="hljs-number"><span class="hljs-number">0</span></span>, flags [DF], proto TCP (<span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span>) ip109.<span class="hljs-number"><span class="hljs-number">176</span></span>.ulttk.ru.<span class="hljs-number"><span class="hljs-number">27338</span></span> &gt; rutracker.org.http: Flags [.], cksum <span class="hljs-number"><span class="hljs-number">0xe266</span></span> (correct), seq <span class="hljs-number"><span class="hljs-number">1</span></span>, ack <span class="hljs-number"><span class="hljs-number">1</span></span>, win <span class="hljs-number"><span class="hljs-number">1028</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">28.647281</span></span> IP (tos <span class="hljs-number"><span class="hljs-number">0x0</span></span>, ttl <span class="hljs-number"><span class="hljs-number">64</span></span>, id <span class="hljs-number"><span class="hljs-number">0</span></span>, offset <span class="hljs-number"><span class="hljs-number">0</span></span>, flags [DF], proto TCP (<span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> <span class="hljs-number"><span class="hljs-number">117</span></span>) ip109.<span class="hljs-number"><span class="hljs-number">176</span></span>.ulttk.ru.<span class="hljs-number"><span class="hljs-number">27338</span></span> &gt; rutracker.org.http: Flags [P.], cksum <span class="hljs-number"><span class="hljs-number">0xb1d5</span></span> (correct), seq <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">78</span></span>, ack <span class="hljs-number"><span class="hljs-number">1</span></span>, win <span class="hljs-number"><span class="hljs-number">1028</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> <span class="hljs-number"><span class="hljs-number">77</span></span>: HTTP, <span class="hljs-keyword"><span class="hljs-keyword">length</span></span>: <span class="hljs-number"><span class="hljs-number">77</span></span> GET / HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> Host: rutracker.org User-Agent: curl/<span class="hljs-number"><span class="hljs-number">7.56</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> Accept: *<span class="hljs-regexp"><span class="hljs-regexp">/* 02:27:28.663665 IP (tos 0x0, ttl 61, id 0, offset 0, flags [DF], proto TCP (6), length 286) rutracker.org.http &gt; ip109.176.ulttk.ru.27338: Flags [FP.], cksum 0xf88c (correct), seq 1:247, ack 78, win 0, length 246: HTTP, length: 246 HTTP/</span></span><span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-number"><span class="hljs-number">301</span></span> Moved Permanently <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">28.663724</span></span> IP (tos <span class="hljs-number"><span class="hljs-number">0x0</span></span>, ttl <span class="hljs-number"><span class="hljs-number">64</span></span>, id <span class="hljs-number"><span class="hljs-number">0</span></span>, offset <span class="hljs-number"><span class="hljs-number">0</span></span>, flags [DF], proto TCP (<span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span>) ip109.<span class="hljs-number"><span class="hljs-number">176</span></span>.ulttk.ru.<span class="hljs-number"><span class="hljs-number">27338</span></span> &gt; rutracker.org.http: Flags [.], cksum <span class="hljs-number"><span class="hljs-number">0xe126</span></span> (correct), seq <span class="hljs-number"><span class="hljs-number">78</span></span>, ack <span class="hljs-number"><span class="hljs-number">248</span></span>, win <span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">28.664047</span></span> IP (tos <span class="hljs-number"><span class="hljs-number">0x0</span></span>, ttl <span class="hljs-number"><span class="hljs-number">64</span></span>, id <span class="hljs-number"><span class="hljs-number">0</span></span>, offset <span class="hljs-number"><span class="hljs-number">0</span></span>, flags [DF], proto TCP (<span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span>) ip109.<span class="hljs-number"><span class="hljs-number">176</span></span>.ulttk.ru.<span class="hljs-number"><span class="hljs-number">27338</span></span> &gt; rutracker.org.http: Flags [F.], cksum <span class="hljs-number"><span class="hljs-number">0xe121</span></span> (correct), seq <span class="hljs-number"><span class="hljs-number">78</span></span>, ack <span class="hljs-number"><span class="hljs-number">248</span></span>, win <span class="hljs-number"><span class="hljs-number">1028</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">28.695429</span></span> IP (tos <span class="hljs-number"><span class="hljs-number">0x0</span></span>, ttl <span class="hljs-number"><span class="hljs-number">64</span></span>, id <span class="hljs-number"><span class="hljs-number">0</span></span>, offset <span class="hljs-number"><span class="hljs-number">0</span></span>, flags [DF], proto TCP (<span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span>) ip109.<span class="hljs-number"><span class="hljs-number">176</span></span>.ulttk.ru.<span class="hljs-number"><span class="hljs-number">42348</span></span> &gt; dib-filtr-gw.transtelecom.net.http: Flags [S], cksum <span class="hljs-number"><span class="hljs-number">0x0556</span></span> (correct), seq <span class="hljs-number"><span class="hljs-number">2835326510</span></span>, win <span class="hljs-number"><span class="hljs-number">65535</span></span>, options [mss <span class="hljs-number"><span class="hljs-number">1452</span></span>,nop,wscale <span class="hljs-number"><span class="hljs-number">6</span></span>,sackOK,TS val <span class="hljs-number"><span class="hljs-number">1989849504</span></span> ecr <span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>  Let's look at this conclusion in more detail.  From 605860 to 646913, the client performs a triple handshake with the "real" Rutreker.  In 647281, the client sends an HTTP request to Rutreker, 77 bytes long, but instead of the usual ACK, FPA with a 246 bytes HTTP redirection receives from the fake Rutreker.  And note that with the correct ACK 78, but the left, within this TCP connection, the sequence number is SEQ.  Next, the client closes the connection and goes to where they said.  ACK and HTTP response from Rutreker never come. <br><br>  In principle, it is clear why the provider needed this strange TCP with FPA flags: FIN to start terminating the connection from the client, PUSH to push this segment into the client's TCP queue, and the correct ACK to make everything look beautiful and this ‚Äúfake‚Äù TCP segment did not TCP / IP client stack was dropped.  But this FPA killed him. <br><br>  So, the main strategy is to discard TCP segments with FPA flags set, as if coming from addresses of blocked resources. <br><br>  FreeBSD works on the old Atom as a router in my home network, pf works with a packet filter.  The main problem was that pf is a statefull firewall, i.e.  after our first allowed outgoing SYN, a record (state) and all subsequent requests are added to the Rutreker state table, and all subsequent requests and, most importantly, the answers within this TCP connection do not go through any firewall rules anymore. <br><br>  This behavior greatly increases the performance of the firewall and reduces the number of rules, but in our case prevents effective filtering.  Therefore, all requests / responses to the blocked resources will be made in stateless mode, i.e.  without saving the state.  In pf, the rules are as follows: <br><br><pre> <code class="hljs mel">WAN=<span class="hljs-string"><span class="hljs-string">"ng0"</span></span> LAN=<span class="hljs-string"><span class="hljs-string">"re0"</span></span> Blocked=<span class="hljs-string"><span class="hljs-string">"{ .IP1, .IP2, .IP3,  .. }"</span></span> ... # -UNBLOCK- # <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> LAN hosts pass <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> quick on $LAN proto tcp from $LAN:network to $Blocked no state block drop out quick on $LAN proto tcp from $Blocked to $LAN:network flags FPA/FPA pass out quick on $LAN proto tcp from $Blocked to $LAN:network no state # -UNBLOCK- # <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> me (router itself, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> testing) pass out quick on $WAN proto tcp from ($WAN) to $Blocked no state block drop <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> quick on $WAN proto tcp from $Blocked to ($WAN) flags FPA/FPA pass <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> quick on $WAN proto tcp from $Blocked to ($WAN) no state ...</code> </pre> <br>  The <b>no state</b> directive in the permitting rules prohibits state saving, the first rule in the UNBLOCK block allows outgoing to a blocked resource, the second rule blocks ‚Äúfake‚Äù incoming with FPA flags set, the third one allows all other incoming ones.  The <b>quick</b> directive in all rules stops the firewall from viewing all subsequent filter rules if it matches this rule.  Result (triple handshake omitted): <br><br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">10.221343</span></span> IP (tos <span class="hljs-number"><span class="hljs-number">0x0</span></span>, ttl <span class="hljs-number"><span class="hljs-number">64</span></span>, id <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, flags [DF], proto TCP (<span class="hljs-number"><span class="hljs-number">6</span></span>), length <span class="hljs-number"><span class="hljs-number">117</span></span>) ip109<span class="hljs-number"><span class="hljs-number">.176</span></span>.ulttk.ru<span class="hljs-number"><span class="hljs-number">.42714</span></span> &gt; rutracker.org.http: Flags [P.], cksum <span class="hljs-number"><span class="hljs-number">0xccb6</span></span> (correct), seq <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">78</span></span>, ack <span class="hljs-number"><span class="hljs-number">1</span></span>, win <span class="hljs-number"><span class="hljs-number">1028</span></span>, length <span class="hljs-number"><span class="hljs-number">77</span></span>: HTTP, length: <span class="hljs-number"><span class="hljs-number">77</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> / HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> Host: rutracker.org <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>-Agent: curl/<span class="hljs-number"><span class="hljs-number">7.56</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> Accept: *<span class="hljs-comment"><span class="hljs-comment">/* 01:48:10.237686 IP (tos 0x0, ttl 61, id 0, offset 0, flags [DF], proto TCP (6), length 286) rutracker.org.http &gt; ip109.176.ulttk.ru.42714: Flags [FP.], cksum 0x136e (correct), seq 1:247, ack 78, win 0, length 246: HTTP, length: 246 HTTP/1.1 301 Moved Permanently 01:48:10.563977 IP (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto TCP (6), length 117) ip109.176.ulttk.ru.42714 &gt; rutracker.org.http: Flags [P.], cksum 0xccb6 (correct), seq 1:78, ack 1, win 1028, length 77: HTTP, length: 77 GET / HTTP/1.1 Host: rutracker.org User-Agent: curl/7.56.0 Accept: */</span></span>* <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">10.604853</span></span> IP (tos <span class="hljs-number"><span class="hljs-number">0x0</span></span>, ttl <span class="hljs-number"><span class="hljs-number">58</span></span>, id <span class="hljs-number"><span class="hljs-number">42669</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, flags [DF], proto TCP (<span class="hljs-number"><span class="hljs-number">6</span></span>), length <span class="hljs-number"><span class="hljs-number">40</span></span>) rutracker.org.http &gt; ip109<span class="hljs-number"><span class="hljs-number">.176</span></span>.ulttk.ru<span class="hljs-number"><span class="hljs-number">.42714</span></span>: Flags [.], cksum <span class="hljs-number"><span class="hljs-number">0x00c5</span></span> (correct), seq <span class="hljs-number"><span class="hljs-number">1</span></span>, ack <span class="hljs-number"><span class="hljs-number">78</span></span>, win <span class="hljs-number"><span class="hljs-number">58</span></span>, length <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">10.605043</span></span> IP (tos <span class="hljs-number"><span class="hljs-number">0x0</span></span>, ttl <span class="hljs-number"><span class="hljs-number">58</span></span>, id <span class="hljs-number"><span class="hljs-number">42670</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, flags [DF], proto TCP (<span class="hljs-number"><span class="hljs-number">6</span></span>), length <span class="hljs-number"><span class="hljs-number">422</span></span>) rutracker.org.http &gt; ip109<span class="hljs-number"><span class="hljs-number">.176</span></span>.ulttk.ru<span class="hljs-number"><span class="hljs-number">.42714</span></span>: Flags [P.], cksum <span class="hljs-number"><span class="hljs-number">0x9bc5</span></span> (correct), seq <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">383</span></span>, ack <span class="hljs-number"><span class="hljs-number">78</span></span>, win <span class="hljs-number"><span class="hljs-number">58</span></span>, length <span class="hljs-number"><span class="hljs-number">382</span></span>: HTTP, length: <span class="hljs-number"><span class="hljs-number">382</span></span> HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-number"><span class="hljs-number">301</span></span> Moved Permanently <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>: nginx <span class="hljs-type"><span class="hljs-type">Date</span></span>: Thu, <span class="hljs-number"><span class="hljs-number">26</span></span> Oct <span class="hljs-number"><span class="hljs-number">2017</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span> GMT Content-<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>: <span class="hljs-type"><span class="hljs-type">text</span></span>/html Content-Length: <span class="hljs-number"><span class="hljs-number">178</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Location</span></span>: http://rutracker.org/forum/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.php <span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>: keep-alive</code> </pre> <br>  221343 - HTTP request to Rutreker <br>  237686 - response from provider DPI with FPA flags (dump from the external interface of the router, so it is visible here; the client does not receive it) <br>  563977 - the client did not wait for an answer, repeats the request <br>  604853 - Real Rutreker sends ACK <br>  605043 - the real Rutreker sends an HTTP response <br><br>  PS The same can be done with the help of any modern firewall, pf here just because I use it.  Also, an attentive reader might have noticed that the IP-spoofing carried out by the DPI provider is elementarily detected by IP TTL (58 vs. 61).  But pf does not know how to filter all fields of IP packets, only the main ones.  When using other firewalls, IP TTL mismatch can be used as an additional sign of a ‚Äúfake‚Äù packet, along with TCP FPA. <br><br>  That's All Folks! </div><p>Source: <a href="https://habr.com/ru/post/341266/">https://habr.com/ru/post/341266/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341254/index.html">What does software development have in common with board game development?</a></li>
<li><a href="../341256/index.html">Splunk Discovery Day 2017 in Moscow. How did everything go‚Ä¶</a></li>
<li><a href="../341260/index.html">For each webinar: learn about new HPE products and solutions</a></li>
<li><a href="../341262/index.html">The task of the page in three columns, one of them in a hundred pixels</a></li>
<li><a href="../341264/index.html">Keyword "mutable" in C ++</a></li>
<li><a href="../341268/index.html">Mathematical model of financial market dynamics</a></li>
<li><a href="../341272/index.html">Created the first molecular computer based on synthetic polymers</a></li>
<li><a href="../341274/index.html">Graylog2 incremental setup</a></li>
<li><a href="../341276/index.html">Safety Issues of Smart Energy</a></li>
<li><a href="../341278/index.html">What is good (and bad) Typescript: experience of UI-developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>