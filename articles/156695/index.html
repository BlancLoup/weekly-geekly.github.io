<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Networks for the smallest. Part six. Dynamic routing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All issues  8. Networks for the smallest. Part Eight BGP and IP SLA 
 7. Networks for the smallest. Part Seven. VPN 
 6. Networks for the smallest. Pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Networks for the smallest. Part six. Dynamic routing</h1><div class="post__text post__text-html js-mediator-article"><div class="spoiler">  <b class="spoiler_title">All issues</b> <div class="spoiler_text">  <a href="http://linkmeup.ru/blog/65.html">8. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/65.html">Part Eight</a>  <a href="http://linkmeup.ru/blog/65.html">BGP and IP SLA</a> <br>  <a href="http://linkmeup.ru/blog/50.html">7. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/50.html">Part Seven.</a>  <a href="http://linkmeup.ru/blog/50.html">VPN</a> <br>  <a href="http://linkmeup.ru/blog/33.html">6. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/33.html">Part six.</a>  <a href="http://linkmeup.ru/blog/33.html">Dynamic routing</a> <br>  <a href="http://linkmeup.ru/blog/16.html">5. Networks for the smallest: Part Five.</a>  <a href="http://linkmeup.ru/blog/16.html">NAT and ACL</a> <br>  <a href="http://linkmeup.ru/blog/15.html">4. Networks for the smallest: Part Four.</a>  <a href="http://linkmeup.ru/blog/15.html">STP</a> <br>  <a href="http://linkmeup.ru/blog/14.html">3. Networks for the smallest: Part Three.</a>  <a href="http://linkmeup.ru/blog/14.html">Static routing</a> <br>  <a href="http://linkmeup.ru/blog/13.html">2. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/13.html">Part two.</a>  <a href="http://linkmeup.ru/blog/13.html">Switching</a> <br>  <a href="http://linkmeup.ru/blog/12.html">1. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/12.html">Part one.</a>  <a href="http://linkmeup.ru/blog/12.html">Connection to the equipment cisco</a> <br>  <a href="http://linkmeup.ru/blog/11.html">0. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/11.html">Part zero.</a>  <a href="http://linkmeup.ru/blog/11.html">Planning</a> <br></div></div><br><br>  The network ‚ÄúElevator Mi Up‚Äù together with its staff is growing along and across.  Maintenance of the IT infrastructure was carried out in a separate specially created organization ‚ÄúLink me Up‚Äù. <br>  Just recently, four more branches were bought in various cities and investors discovered new dimensions of the movement of elevators.  And the network grew from four routers to ten at once.  At the same time, the number of subnets has now increased from 9 to 20, not counting point-to-point links between routers.  And then the entire economy rises up to its full height.  Agree, adding routes to all networks manually on each node is a little fun. <br>  The situation is complicated by the fact that the network in Kaliningrad already has its addressing and the dynamic routing protocol EIGRP is running on it. <br>  So today: <br>  - We understand the theory of dynamic routing protocols. <br>  - We implement the OSPF protocol into the network ‚ÄúElevator mi Up‚Äù <br>  - Configure the transfer (redistribution) of routes between OSPF and EIGRP <br>  - In this release, we add the ‚ÄúTasks‚Äù section.  Identify the course of their article will be such icons: <br><img src="https://habrastorage.org/getpro/habr/post_images/298/063/27d/29806327db155363023118ca212fbb1d.png" align="right"><br><br>  The difficulty level will be different.  All tasks will have answers that can be viewed on the cycle website.  In some of them you will need to think, in others read the documentation, in the third to understand the topology, and maybe even look at the debug information.  If the task is not realizable in RT, we will make a special mark about it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/8zxdW6ag8Us" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><h4>  Theory of Dynamic Routing Protocols </h4><br><br>  For a start, let's deal with the concept of ‚Äúdynamic routing‚Äù.  Until now, we used the so-called static routing, that is, we wrote down the routing table on each router.  The use of routing protocols allows us to avoid this tedious monotonous process and human error.  As the name implies, these protocols are designed to build the routing tables themselves, <b>automatically</b> , based on the current network configuration.  In general, the thing is necessary, especially when your network is not 3 routers, but 30, for example. <br>  In addition to convenience, there are other aspects.  For example, <b>fault tolerance</b> .  Having a network with static routing, it will be extremely difficult for you to organize backup channels - there is no one to track the availability of one or another segment. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e54/f2a/4e3/e54f2a4e34291f4dce792dfab1a2f39a.png"><br><br>  For example, if in such a network a link is broken between R2 and R3, then packets from R1 will still go to R2, where they will be destroyed, because they have nowhere to send. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/110/d1b/f69/110d1bf698672d6abcc2d7c539d314fb.png"><br><br>  Dynamic routing protocols within a few seconds (or even milliseconds) will learn about the problems on the network and rebuild their routing tables and in the above case, the packets will be sent along the actual route. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e5a/6dd/6d2/e5a6dd6d2c1c9e71601e63c0bbb59e94.png"><br><br>  Another important point is <b>traffic balancing</b> .  Dynamic routing protocols almost out of the box support this feature and you do not need to add redundant routes manually, calculating them. <br><br>  Well, the introduction of dynamic routing greatly facilitates the <b>scaling of the network</b> .  When you add a new element to a network or subnet on an existing router, you need to perform just a few actions to make it work and the probability of error is minimal, while information about changes instantly diverges across all devices.  Exactly the same can be said about global topology changes. <br><br>  All routing protocols can be divided into two large groups: external ( <b>EGP</b> - Exterior Gateway Protocol) and internal ( <b>IGP</b> - Interior Gateway Protocol).  To explain the differences between them, we need the term ‚Äúautonomous system‚Äù.  In a general sense, an autonomous system (routing domain) is a group of routers that are under common control. <br>  In the case of our updated network, AS will be: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/54c/0b5/116/54c0b5116b15eb053d12bec8b76b1630.png"><br><br>  So, internal routing protocols are used inside the autonomous system, and external - to connect autonomous systems with each other.  In turn, the internal routing protocols are divided into <b>Distance-Vector</b> (RIP, EIGRP) and <b>Link State</b> (OSPF, IS-IS).  In this article, we will not <s>kick the corpses to</s> affect the RIP and IGRP protocols due to their venerable age, as well as IS-IS due to its absence in the PT. <br><br>  The fundamental differences between the two species are as follows: <br>  1) the type of information that routers exchange: the routing tables of Distance-Vector and the topology tables of Link State, <br>  2) the process of choosing the best route, <br>  3) the amount of network information that each router ‚Äúkeeps in mind‚Äù: Distance-Vector knows only its neighbors, Link State has an idea of ‚Äã‚Äãthe entire network. <br><br>  As we can see, the number of routing protocols is small, but still not one or two.  And what will happen if you run several protocols on the router at the same time?  It may turn out that each protocol will have its own opinion on how best to get to a certain network.  And if we also have static routes configured?  Who will give preference to the router and whose route will add to the routing table?  The answer to this question is related to the new term: administrative distance (for our taste, rather mediocre tracing from the English administrative distance, but weren't better able to invent).  The administrative distance is an integer from 0 to 255, expressing the router‚Äôs ‚Äúmeasure of confidence‚Äù to this route.  The smaller the AD, the more trust.  Here is a sign of such trust from a Cisco perspective: <br><br><table border="1"><tbody><tr><th>  Protocol </th><th>  Administrative distance </th></tr><tr><td>  Connected interface </td><td>  0 </td></tr><tr><td>  Static route </td><td>  one </td></tr><tr><td>  Enhanced Interior Gateway Routing Protocol (EIGRP) summary route </td><td>  five </td></tr><tr><td>  External Border Gateway Protocol (BGP) </td><td>  20 </td></tr><tr><td>  Internal EIGRP </td><td>  90 </td></tr><tr><td>  IGRP </td><td>  100 </td></tr><tr><td>  Ospf </td><td>  110 </td></tr><tr><td>  Intermediate System-to-Intermediate System (IS-IS) </td><td>  115 </td></tr><tr><td>  Routing Information Protocol (RIP) </td><td>  120 </td></tr><tr><td>  Exterior Gateway Protocol (EGP) </td><td>  140 </td></tr><tr><td>  On Demand Routing (ODR) </td><td>  160 </td></tr><tr><td>  External EIGRP </td><td>  170 </td></tr><tr><td>  Internal BGP </td><td>  200 </td></tr><tr><td>  Unknown </td><td>  255 </td></tr></tbody></table><br><br>  In today's article, we will analyze OSPF and EIGRP.  The first you will meet everywhere and constantly, and the second is very good in networks where only Cisco equipment is present. <br>  Each of them has its advantages and disadvantages.  It can be said that EIGRP wins before OSPF, but all advantages are leveled by its proprietaryity.  EIGRP is a proprietary Cisco protocol and no one else supports it. <br>  In fact, EIGRP has many shortcomings, but this is not particularly spread in popular articles.  Here is just one of the problems: <a href="http://telecomtest.com.au/datasheets/packet-design/siawp.pdf">SIA</a> <br><br><br>  So let's get started. <br><br><h4>  Ospf </h4><br><br>  Articles and videos on how to configure OSPF mountains.  Much less descriptions of the principles of work.  In general, there is such a thing that OSPF can be simply configured according to the manuals, without even knowing about the SPF algorithms and incomprehensible LSAs.  And everything will work and even, most likely, work fine - that's what it is designed for.  That is, it‚Äôs not like vlans, where you had to know the theory down to the format of the title. <br>  But the engineer from the enikeyschik is distinguished by the fact that he understands why his network functions this way and not otherwise, and OSPF knows what route will be chosen by the protocol just as well as it does. <br>  Within the article, which already at this moment is 8,000 characters, we will not be able to plunge into the depths of the theory, but we will consider the fundamental points. <br>  It is very simple and understandable, by the way, it is written about OSPF on <a href="http://xgu.ru/wiki/OSPF">xgu.ru</a> or in the English <a href="http://en.wikipedia.org/wiki/Open_Shortest_Path_First">Wikipedia</a> . <br>  So, OSPFv2 works over IP, and specifically, it is sharpened only for IPv4 (OSPFv3 does not depend on Layer 3 protocols and therefore can work with IPv6). <br><br>  Consider his work on the example of such a simplified network: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/992/464/9ce/9924649ce522d775ed13c43796f40087.jpg"><br><br>  To begin with, it must be said that in order to establish friendship (adjacency) between routers, the following conditions must be met: <br><br>  1) in OSPF, the same <b>Hello Interval</b> must be configured on those routers that are connected to each other.  The default is 10 seconds on Broadcast networks, such as Ethernet.  This is a kind of keepalive message.  That is, every 10 seconds each router sends a Hello packet to its neighbor to say: ‚ÄúHey, I'm alive‚Äù, <br>  2) The same should be the <b>Dead Interval</b> on them.  This is usually 4 Hello intervals - 40 seconds.  If during this time Hello is not received from the neighbor, then it is considered inaccessible and <s>PANIKA</s> begins the process of rebuilding the local database and sending updates to all neighbors, <br>  3) Interfaces connected to each other must be on the <b>same subnet</b> <br>  4) OSPF reduces the CPU load on routers by dividing the Autonomous System into zones.  So the <b>zone numbers</b> must also match, <br>  5) Each router participating in the OSPF process has its own <b>unique</b> identifier - <b>Router ID</b> .  If you do not take care of it, the router will automatically select it based on the information about the connected interfaces (the highest address is selected from the interfaces that were active at the time the OSPF process started).  But again, a good engineer has everything under control, so a Loopback interface is usually created, which is assigned an address with a / 32 mask and it is he who is assigned a Router ID.  It is convenient for maintenance and troubleshooting. <br>  6) Must match MTU size <br><br>  Next, the play in eight parts. <br><br>  1) Calm.  OSPF Status - <b>DOWN</b> <br>  In this short moment, nothing happens on the network - everyone is silent. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/063/5fc/9f1/0635fc9f16fa412cd0d2be88f2247067.jpg"><br><br>  2) The wind rises: the router sends Hello packets to the multicast address <a href="http://en.wikipedia.org/wiki/Multicast_address">224.0.0.5</a> from all interfaces where OSPF is running.  <a href="http://ru.wikipedia.org/wiki/Time_to_live">The TTL of</a> such messages is equal to one, so only routers in the same network segment will receive them.  R1 goes to the <b>INIT</b> state. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/72c/440/f60/72c440f604179dd6f38469e4df0e4306.jpg"><br><br>  The package contains the following information: <br><ul><li>  Router ID </li><li>  Hello Interval </li><li>  Dead interval </li><li>  Neighbors </li><li>  Subnet mask </li><li>  Area ID </li><li>  Router Priority </li><li>  DR and BDR Router Addresses </li><li>  Authentication password </li></ul><br>  We are interested in the first four, or more precisely in general, only Router ID and Neighbors. <br>  Hello message from R1 carries its Router ID and does not contain Neighbors, because it does not have them yet. <br>  After receiving this multicast message, R2 adds R1 to its neighbor table (if all the necessary parameters match). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6eb/4bf/fdf/6eb4bffdf2c727aa67d85b34c89fcac4.jpg"><br><br>  And it sends a new Hello message to R1 already unicast, which contains the Router ID of this router, and all its neighbors are listed in the Neigbors list.  Among the other neighbors in this list is Router ID R1, that is, R2 already considers it a neighbor. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/071/a1b/333/071a1b3338e46b3d6cf3100422f3c2a0.jpg"><br><br>  3) Friendship.  When R1 receives this Hello message from R2, it scrolls through the list of neighbors and finds its own Router ID in it, it adds R2 to its list of neighbors. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/47c/4f7/650/47c4f7650c309ceea3b558cc19a33670.jpg"><br><br>  Now R1 and R2 are each other‚Äôs mutual neighbors - this means that they have an adjacency relationship and R1 enters the <b>TWO WAY</b> state. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9a1/4a6/e12/9a14a6e12893e13f2d92b26765c9306b.jpg"><br><br>  Next comes the choice of <a href="http://ru.wikipedia.org/wiki/OSPF">DR and BDR</a> , but we will not stop there, even though these are quite important things. <br><br>  4) Calm before the storm.  Then everything goes into the <b>EXSTART</b> state.  Here, all the neighbors decide among themselves who the boss is.  It becomes the router with the highest Router ID - R2. <br><br>  5) When <i>Dad is</i> selected, neighbors go to the <b>Exchange</b> state and exchange DBD messages (or DD) - Data Base Description, which contain the description of LSDB (Link State Data Base), they say, I know about such subnets. <br>  Here it is necessary to clarify what LSDB is.  If you translate into Russian literally: a database on the state of links.  In the initial state, the router knows only those links (interfaces) on which the OSPF process is running.  As the play progresses, each router collects all the information about the network and compiles a topology.  That it will be LSDB, which should be the same on all members of the zone. <br>  The first one sends its DBD router selected as the main one on this interface - 2.2.2.2.  1.1.1.1 does the same after it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fc3/1bd/5d9/fc31bd5d92a77ca5189d4675577ed427.jpg"><br><br>  6) After receiving the message, the routers R1 and R2 send a confirmation of the reception of DBD (LSAck), and then compare the new information with that contained in the LSDB and, if there are differences, send the LSR (Link State Request) to each other, thereby moving to the new state of <b>LOADING</b> .  In the LSR they say - ‚ÄúI don‚Äôt know anything about this network.  Tell me more. ‚Äù <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1a7/84f/4e6/1a784f4e6c107fc7e966c5ee8cb69892.jpg"><br><br>  7) R2, receiving LSR from R1, sends LSU (Link State Update), which contain LSA (Link State Advertisement) with detailed information about the required subnets. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d3/b03/23e/4d3b0323ea48af8f7b8ffd1c439e56c5.jpg"><br><br>  And so, as soon as R1 receives the last piece of data on all subnets and forms its LSDB, it enters its final state <b>FULL STATE</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9a6/ba8/1b4/9a6ba81b49bbe27ce2d4282671e631cd.jpg"><br><br>  By that moment, as all the routers in the zone will come to the Full State state, all of them should have completely the same LSDB - they have studied the same network.  That is, in fact, this means that the router knows your entire network, what, how and where it is connected. <br><br><blockquote>  The authors realize that it is quite difficult to understand and remember all these abbreviations and rules, but after reading this 5-7 times in different places with a certain frequency, it will be possible to get an idea of ‚Äã‚Äãhow OSPF works. <br></blockquote><br><br>  8) So, now we have all the routers know everything about the network, but this knowledge does not help in routing. <br>  The next step OSPF, using Dijkstra's algorithm (or also called SPF - Shortest Path First), calculates the shortest route to each router in the zone - he knows the whole topology.  This helps him metrics.  The lower it is, the better the route.  Metric - is the cost of movement on the route. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/72d/fbf/f77/72dfbff774fcf092b2c0e00b3de6c7a8.jpg"><br><br>  For example, in such a network from R1 to R3 can be reached directly or through R2. <br><br>  Naturally the first option will cost less.  But this is assuming that you have the same type of interface everywhere.  And if, for example, between R1 and R3 do you have a 56k modem connection or an extremely unstable GPRS link?  Then they will have a very high cost and OSPF will prefer a longer, but faster way. <br>  The path found is then added to the routing table. <br><br>  Now every 10 seconds each router will send Hello-packets, and LSA is sent every 30 minutes - this type of data is already considered obsolete, it would be necessary to update it, even if there were no changes. <br><br>  In an ideal world, this would be a balance.  But we live in a cruel and indifferent world, where an engineer is an engineer, and even a computer programmer in general, and elevators have learned to ride down just <a href="http://habrahabr.ru/post/140552/">three issues</a> ago. And in this everyday world passions are boiling: they tear optics, cut down food, mice gnaw through the legs of processors (or is it not in this world?) - in other words, the topology is constantly changing.  And the larger the network, the more frequent and global changes. <br><br>  Of course, it would be somewhat strange to wait 40 seconds (Dead Interval) and only then begin to rebuild the table.  This would be excusable for RIP, but not for the protocol used in a huge number of modern networks.  So, as soon as any of the links falls (or several), the router changes its LSDB and generates the LSU, assigning it a number greater than it was before (each LSDB has a number that is taken from the last LSA received). <br><br>  This LSU message is sent to the multicast address 224.0.0.5.  The routers that receive it check the LSA number contained in the LSU. <br>  1) If the number is greater than the current LSA number of the router, the LSDB changes.  (The LSDB version is old, the information is new), <br>  2) If the number is the same, nothing happens.  This router has already received this LSA in some other way, <br>  3) If the number of received LSA is less than local LSDB, this means that the router has more up-to-date information, and it sends a new LSA (based on its LSDB) to the sender of the previous one. <br><br>  After the produced (or non-generated) actions to the neighbor from which the LSU came, LSAck is sent (they say, ‚Äúthe package was received - everything is in order‚Äù), and the original LSU is sent to other neighbors unchanged.  The SPF algorithm is run again on this router and, if necessary, the routing table is updated. <br><br>  In general, all this happens in order to maintain the relevance of information on all devices - LSDB should be the same for all. <br><br><blockquote>  Here we must make a reservation that the router notices changes only when directly connected to its neighbor.  If there is, for example, a switch between them, the device will not detect a drop in the physical interface and will not do anything.  For such situations there are two solutions. <br>  1) Set up timers.  For OSPF, they can be reduced to the ms level. <br>  2) Use the very cool BFD ( <a href="http://en.wikipedia.org/wiki/Bidirectional_Forwarding_Detection">Bidirectional Forwarding Detection</a> ) protocol.  It allows you to track the status of the links also at the millisecond level.  In the configuration, the BFD communicates with other protocols and allows you to very quickly inform anyone that there are problems on the network.  Specifically with the BFD we will understand the other part. <br></blockquote><br><br>  As you have noticed, there are confirmations to all messages: either this is LSAck or the Hello response to Hello.  This is a fee for rejecting TCP - somehow you have to make sure of successful delivery. <br><blockquote>  In total there are 7 types of LSA, which are very tied to zones, of which there are also 5 pieces.  Routers also come in four types.  And there are also concepts of Designated Router (DR) and Backup DR (BDR), ABR and ASBR.  There are formulas for calculating metrics and so on and so forth.  We leave it for independent study. <br></blockquote><br><br><h5>  OSPF practice </h5><br>  Remember how we suffered when setting up the routing last time: on each device, up to each network and God forbid something to forget.  Now it's in the past - long live the IGP! <br>  Let's not waste time explaining the commands separately, but immediately plunge into the wonderful world of configuration. <br>  Tax, there is now the following logical scheme: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/da7/1ad/c77/da71adc77ad52248e93ea7af3946a086.png"><br><br>  While we are interested in this big Siberian ring through Krasnoyarsk, Khabarovsk and Vladivostok.  Here and on our already built network, we will run OSPF.  Where there was static before, we will have to abandon it and smoothly switch to dynamic protocols. <br>  Suppose that Krasnoyarsk is also connected via Balagan Telecom, as well as the previous points, and then through different providers we have links to other cities.  The ring is closed in Moscow through the provider ‚ÄúFilkin certificate‚Äù.  Suppose that everywhere between cities we bought L2-VPN and IP traffic flows transparently. <br><br>  What does the implementation of IGP give specifically to our network? <br>  1) Easy configuration, of course.  At each node, you need to know only local networks, OSPF will be puzzled by the question of their distribution. <br>  2) Redundant links that will provide us with redundant communication channels.  If, for example, the homeless people cut off the optics between Moscow and Krasnoyarsk, not a single branch will remain without communication: all traffic will go through Vladivostok <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d08/0b3/059/d080b30597ce7bc37f218e6f656560ad.png"><br><br>  3) Automatic detection of problems, rebuilding the topology and changing the routing table.  That is what makes it possible to comply with paragraph 2. <br>  4) There is no danger of creating a routing loop when we have a packet to rush between two nodes until the TTL expires.  With static tuning, this situation is more than possible. <br>  5) Convenience expansion.  Imagine that you need to add a new branch, for example in Tomsk and you will connect it through Kemerovo.  Then you will have to register static routes in Moscow, Kemerovo and in Tomsk itself.  When using speakers, you only set up a new router ... and that's it. <br><br>  We already <a href="https://docs.google.com/spreadsheet/pub%3Fkey%3D0AooexOHebRpTdGc1eFhvZHdBa0ZrTUljRG5lYVVQM0E%26amp%3Boutput%3Dhtml">prepared the</a> IP-plan of the subnets for the branches and the Point-to-Point links. Suppose that all the initial settings were also performed on all the nodes: <br>  - hostname <br>  - security settings (telnet passwords, ssh) <br>  - IP addresses of link interfaces <br>  - IP addresses of LAN subnets <br>  - IP addresses of Loopback interfaces. <br><br><blockquote>  We are here introducing a new concept of a Loopback interface.  It will be configured on each router.  For this, a special subnet 172.16.255.0/24 is allocated.  We need it now for OSPF, and in the future it may be needed for BGP, MPLS. <br>  Hand on heart, he himself did not understand the meaning of these interfaces for a long time.  Generally speaking, it is a virtual interface, the state of which is always UP, regardless of the state of the physical interfaces (unless shutdown is done on it).  We will try to explain one of his roles: <br>  Here, for example, you have a monitoring server Nagios.        R1         FE0/0 ‚Äî 10.1.0.1. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f37/b08/c40/f37b08c408010e8ae22c1f89ddef643a.png"><br><br>      ‚Äî  .   ,    . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/623/8aa/4fd/6238aa4fd86998b844d8dff5e2137bec.png"><br><br>   ,      ,      FE0/1.   Nagios'    ,   ,    .   , IP-    . <br>       Nagios'  Loopback-,         ,     . <br><br>    IP- Loopback-    /32,   11111111.11111111.11111111.1111111 ‚Äî    ‚Äî     . <br></blockquote><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since all preparations have already been completed, we are faced with a very simple task: walk through all the routers and activate the OSPF process. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) The first thing we need to do is start the OSPF process of the router:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> msk-arbat-gw1 (config) # router OSPF 1 </font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first word is to indicate that we are launching a dynamic routing protocol, then we specify which one and last of all the process number (theoretically there can be several of them on the same router). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Immediately after this, the router ID is automatically assigned. </font><font style="vertical-align: inherit;">By default this is the highest address of the Loopback-interfaces. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) Do not leave this thing to chance. </font><font style="vertical-align: inherit;">Main rule: Router ID must be unique. </font><font style="vertical-align: inherit;">No, you, of course, can make them the same, but in this case you will begin to have oddities.</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One of my applications was this: the equipment ends with LDP tags. </font><font style="vertical-align: inherit;">Of the eight thousand with the hook, there was only one free. </font><font style="vertical-align: inherit;">No new VPNs were created or worked. </font><font style="vertical-align: inherit;">Understood, understood and as a result saw that process OSPF creates and deletes thousands records in a minute in the routing table. </font><font style="vertical-align: inherit;">The topology is constantly being rebuilt, and for each such rebuilding new LDP tags are allocated, and then not released. </font><font style="vertical-align: inherit;">And the thing is randomly configured identical Router ID.</font></font><br></blockquote><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can configure it, in principle, as you like, you can not even configure it, the router will assign it itself, but for order we will do it - in the future it will be easier to maintain. </font><font style="vertical-align: inherit;">We assign it according to the address of the Loopback interface.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> msk-arbat-gw1 (config-router) # router-id 172.16.255.1 </font></font><br></blockquote><br><br> 3)   ,      (  OSPF).  ,      wildcard- ,   ACL <br><blockquote> msk-arbat-gw1(config-router)#network 172.16.0.0 0.0.255.255 area 0 <br></blockquote><br>   .  <b>network</b>     ,     ,   ,   . <br>   , IP       172.16.0.0 0.0.255.255 (172.16.0.0-172.16.255.255),   . <br>   : <br> )      Hello-,            . <br> ) OSPF              .    172.16.0.0 0.0.255.255,   ,  ,     <br><img src="https://habrastorage.org/getpro/habr/post_images/90f/f40/952/90ff40952b6656c1c317e914e59f0458.png"><br><br>         : <br><blockquote> msk-arbat-gw1(config-router)#network 172.16.0.0 0.0.255.255 area 0 <br></blockquote><br>  or <br><blockquote> msk-arbat-gw1(config-router)#network 172.16.0.0 0.0.15.255 area 0 <br></blockquote><br>  or <br><blockquote> msk-arbat-gw1(config-router)#network 172.16.0.0 0.0.255.255 area 0 <br> msk-arbat-gw1(config-router)#network 172.16.1.0 0.0.255.255 area 0 <br> msk-arbat-gw1(config-router)#network 172.16.2.0 0.0.255.255 area 0 <br>  ‚Ä¶‚Ä¶ <br> msk-arbat-gw1(config-router)#network 172.16.15.0 0.0.255.255 area 0 <br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All these commands will work the same way in our case. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since all local networks have addresses from the 172.16.0.0/16 network, we will use the most general entry. At the same time, of course, the external interface will not get into FastEthernet0 / 1.6 Internet, because its address - 198.51.100.2 - is not from this range. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With this setting, any new interface where you specify an address from the range 172.16.0.0 - 172.16.255.255 automatically becomes a participant in the OSPF process. Good or bad, depends on your desires. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">area 0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> means that these subnets belong to the zone with the number zero (in our examples only this will be).</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Area 0 is not a simple area - this is the so-called Backbone-area. </font><font style="vertical-align: inherit;">This means that it unites all other zones, i.e. </font><font style="vertical-align: inherit;">A packet going from any non-zero zone to any non-zero zone must pass through area 0</font></font><br></blockquote><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As soon as you specify the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">network</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command, the </font><font style="vertical-align: inherit;">words of greeting are sent from the correct interfaces, but there is no one to answer them - there are no neighbors:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> msk-arbat-gw1 # sh ip OSPF neighbor </font></font><br>  msk-arbat-gw1 # <br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now let's write the OSPF settings in Kemerovo (router ID = IP address of the Loopback interface, taken from the IP plan): </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kmr-gorka-gw1 (config) #router OSPF 1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kmr-gorka-gw1 (config-router) # router-id 172.16.255.48 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kmr-gorka-gw1 (config-router) #network 172.16.0.0 0.0.255.255 area 0</font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And right after that you see a message in the console. </font></font><br><blockquote> 02:27:33: %OSPF-5-ADJCHG: Process 1, Nbr 172.16.255.1 on FastEthernet0/0.5 from LOADING to FULL, Loading Done <br></blockquote><br>       : <br><blockquote> 02:27:33: %OSPF-5-ADJCHG: Process 1, Nbr 172.16.255.48 on FastEthernet0/1.5 from LOADING to FULL, Loading Done. <br></blockquote><br>    ,          LSA.     LSDB. <br><br>    : <br><blockquote> msk-arbat-gw1#sh ip OSPF neighbor detail <br> Neighbor <b>172.16.255.48</b> , interface address <b>172.16.2.18</b> <br> In the area 0 via interface <b>FastEthernet0/1.5</b> <br> Neighbor priority is 1, State is <b>FULL</b> , 4 state changes <br> DR is 172.16.2.17 BDR is 172.16.2.18 <br> Options is 0x00 <br> <b>Dead timer due in 00:00:38</b> <br> Neighbor is up for 00:02:51 <br> Index 1/1, retransmission queue length 0, number of retransmission 0 <br> First 0x0(0)/0x0(0) Next 0x0(0)/0x0(0) <br> Last retransmission scan length is 0, maximum is 0 <br> Last retransmission scan time is 0 msec, maximum is 0 msec <br></blockquote><br>       : <br>  router-id (172.16.255.48),   loopback,    ,     (172.16.2.18),      (FastEthernet0/1.5),   (FULL)  Dead timer.     ,     .   , ,   !   40.     10     Hello  <s></s>  Dead-. <br><br>  <b>show ip route</b>   ,    : <br><blockquote> msk-arbat-gw1#show ip route <br> Codes: C ‚Äî connected, S ‚Äî static, I ‚Äî IGRP, R ‚Äî RIP, M ‚Äî mobile, B ‚Äî BGP <br>  D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area <br> N1 ‚Äî OSPF NSSA external type 1, N2 ‚Äî OSPF NSSA external type 2 <br> E1 ‚Äî OSPF external type 1, E2 ‚Äî OSPF external type 2, E ‚Äî EGP <br> i ‚Äî IS-IS, L1 ‚Äî IS-IS level-1, L2 ‚Äî IS-IS level-2, ia ‚Äî IS-IS inter area <br> * ‚Äî candidate default, U ‚Äî per-user static route, o ‚Äî ODR <br> P ‚Äî periodic downloaded static route <br><br> Gateway of last resort is 198.51.100.1 to network 0.0.0.0 <br><br> 172.16.0.0/16 is variably subnetted, 17 subnets, 5 masks <br>  C 172.16.0.0/24 is directly connected, FastEthernet0 / 0.3 <br>  C 172.16.1.0/24 is directly connected, FastEthernet0 / 0.2 <br> C 172.16.2.0/30 is directly connected, FastEthernet0/1.4 <br> S 172.16.2.4/30 [1/0] via 172.16.2.2 <br> C 172.16.2.16/30 is directly connected, FastEthernet0/1.5 <br>  C 172.16.2.32/30 is directly connected, FastEthernet0 / 1.7 <br>  C 172.16.2.128/30 is directly connected, FastEthernet0 / 1.8 <br>  C 172.16.2.196/30 is directly connected, FastEthernet1 / 0.911 <br>  C 172.16.3.0/24 is directly connected, FastEthernet0 / 0.101 <br>  C 172.16.4.0/24 is directly connected, FastEthernet0 / 0.102 <br>  C 172.16.5.0/24 is directly connected, FastEthernet0 / 0.103 <br> C 172.16.6.0/24 is directly connected, FastEthernet0/0.104 <br> S 172.16.16.0/21 [1/0] via 172.16.2.2 <br> S 172.16.24.0/22 [1/0] via 172.16.2.18 <br> <b>O 172.16.24.0/24 [110/2] via 172.16.2.18, 00:13:03, FastEthernet0/1.5</b> <br>  C 172.16.255.1/32 is directly connected, Loopback0 <br> <b>O 172.16.255.48/32 [110/2] via 172.16.2.18, 00:13:03, FastEthernet0/1.5</b> <br>  198.51.100.0/28 is subnetted, 1 subnets <br> C 198.51.100.0 is directly connected, FastEthernet0/1.6 <br>  S * 0.0.0.0/0 [1/0] via 198.51.100.1 <br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition to the previously known networks (C - directly connected and S - Static), we have two new routes labeled O (OSPF). </font><font style="vertical-align: inherit;">Everything should be clear here, but an observant reader will ask: ‚ÄúWhy are there two routes to the network 172.16.24.0 in the routing table? </font><font style="vertical-align: inherit;">Why won't the more preferred static one remain? ‚ÄùAnd it will be right. </font><font style="vertical-align: inherit;">Generally speaking, only the best route to the network gets to the routing table - the default is one. </font><font style="vertical-align: inherit;">But note that the static route goes to subnet 172.16.24.0/22, and received from OSPF to 172.16.24.0/24. </font><font style="vertical-align: inherit;">These are different subnets, so both of them found a place before the sun. </font><font style="vertical-align: inherit;">The fact is that OSPF has no idea what you planned there and what range you selected - it operates with real data, that is, an IP address and mask:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interface FastEthernet0 / 0.2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip address 172.16.24.1 255.255.255.0</font></font><br></blockquote><br>      : <br><blockquote> kmr-gorka-gw1#sh ip route <br><br> Gateway of last resort is 172.16.2.17 to network 0.0.0.0 <br><br> 172.16.0.0/16 is variably subnetted, 14 subnets, 3 masks <br> <b>O 172.16.0.0/24 [110/2] via 172.16.2.17, 00:32:42, FastEthernet0/0.5 <br> O 172.16.1.0/24 [110/2] via 172.16.2.17, 00:32:42, FastEthernet0/0.5 <br> O 172.16.2.0/30 [110/2] via 172.16.2.17, 00:32:42, FastEthernet0/0.5</b> <br> C 172.16.2.16/30 is directly connected, FastEthernet0/0.5 <br> <b>O 172.16.2.32/30 [110/2] via 172.16.2.17, 00:32:42, FastEthernet0/0.5 <br> O 172.16.2.128/30 [110/2] via 172.16.2.17, 00:32:42, FastEthernet0/0.5 <br> O 172.16.2.196/30 [110/2] via 172.16.2.17, 00:32:42, FastEthernet0/0.5 <br> O 172.16.3.0/24 [110/2] via 172.16.2.17, 00:32:42, FastEthernet0/0.5 <br> O 172.16.4.0/24 [110/2] via 172.16.2.17, 00:32:42, FastEthernet0/0.5 <br> O 172.16.5.0/24 [110/2] via 172.16.2.17, 00:32:42, FastEthernet0/0.5 <br> O 172.16.6.0/24 [110/2] via 172.16.2.17, 00:32:42, FastEthernet0/0.5</b> <br> C 172.16.24.0/24 is directly connected, FastEthernet0/0.2 <br> <b>O 172.16.255.1/32 [110/2] via 172.16.2.17, 00:32:42, FastEthernet0/0.5</b> <br> C 172.16.255.48/32 is directly connected, Loopback0 <br> S* 0.0.0.0/0 [1/0] via 172.16.2.17 <br></blockquote><br>  ,      ,      . <br>       : <br><blockquote> S* 0.0.0.0/0 [ <b>1/0</b> ] <br> O 172.16.6.0/24 [ <b>110/2</b> ] <br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first digit is the administrative distance, which is much longer for OSPF than for static and, accordingly, the priority is lower. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In fact, to the subnet 172.16.24.0/24, the traffic has already taken the route provided by OSPF, because it has a narrower mask (24 vs. 22). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But let's try to remove static routes and see what happens. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quite predictably everything works:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> msk-arbat-gw1 # ping 172.16.24.1 </font></font><br><br>  Type escape sequence to abort. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sending 5, 100-byte ICMP Echos to 172.16.24.1, timeout is 2 seconds: </font></font><br>  !!! <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Success rate is 100 percent (5/5), round-trip min / avg / max = 8/10/15 ms </font></font><br></blockquote><br>  And it is beautiful. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Configure OSPF in St. Petersburg: </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spb-vsl-gw1 (config) #router OSPF 1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spb-vsl-gw1 (config-router) # router-id 172.16.255.32 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spb-vsl-gw1 (config-router) #network 172.16.0.0 0.0.255.255 area 0</font></font><br></blockquote><br> ,  ,   .   ,    OSFP        ,  ,    . <br><br>  msk-arbat-gw1      <br><blockquote> msk-arbat-gw1#sh ip OSPF neighbor <br><br>  Neighbor ID Pri State Dead Time Address Interface <br> 172.16.255.32 1 FULL/DROTHER 00:00:39 172.16.2.2 FastEthernet0/1.4 <br> 172.16.255.48 1 FULL/DROTHER 00:00:31 172.16.2.18 FastEthernet0/1.5 <br></blockquote><br>     (  ) : <br><blockquote> spb-vsl-gw1#sh ip OSPF neighbor <br><br>  Neighbor ID Pri State Dead Time Address Interface <br> 172.16.255.1 1 FULL/DR 00:00:34 172.16.2.1 FastEthernet1/0.4 <br></blockquote><br>   ,         ,  spb-vsl-gw1   kmr-gorka-gw1  msk-arbat-gw1,        . <br><br>    ‚Äî spb-ozerki-gw1     ,      .     ‚Äî     Router ID.      . <br><br> <a href="http://linkmeup.ru/blog/17.html"><img src="https://habrastorage.org/getpro/habr/post_images/298/063/27d/29806327db155363023118ca212fbb1d.png" align="left" hspace="20"> <b> ‚Ññ1</b></a> <br>          .     Hello  3 ,     ,  12     Hello  . <br>  <a href="http://linkmeup.ru/blog/17.html">Answer</a> <br><br> <b>    :</b> <br><blockquote>         ,       : <br> ‚Äî   ,  ? <br> ‚Äî        ? <br>       ,  ,  ,     ,   ,      ,       ,    . <br>             -    . <br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On a real network, when choosing a range of advertised subnets, one should be guided by regulations and immediate needs. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Before we proceed to testing the backup links and speeds, let's do one more useful thing. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we had the opportunity to catch traffic on the interface FE0 / 0.2 msk-arbat-gw1, which looks towards the servers, then we would see that Hello messages fly into the unknown every 10 seconds. </font><font style="vertical-align: inherit;">There is no one to answer Hello, there is no one to establish an adjacency relationship, therefore there is no sense in trying to send messages from here. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Turning it off is very simple:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config) #router OSPF 1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config-router) # passive-interface fastEthernet 0 / 0.2</font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This command should be given for all interfaces on which there are definitely no OSPF neighbors (including towards the Internet). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a result, you will have the following picture: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/8bb/921/7d8/8bb9217d86e4959a453847876b9a88b6.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* I don‚Äôt imagine how you are still not confused * </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition, this command improves security - none of this network pretends to be a router and will not try to break us completely. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now let's do the most interesting - testing. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is nothing difficult in setting up OSPF on all routers in the Siberian ring - you will do it yourself. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And after that the picture should be as follows:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> msk-arbat-gw1 # sh ip OSPF neighbor </font></font><br><br>  Neighbor ID Pri State Dead Time Address Interface <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.16.255.32 1 FULL / DR 00:00:31 172.16.2.2 FastEthernet0 / 1.4 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.16.255.48 1 FULL / DR 00:00:31 172.16.2.18 FastEthernet0 / 1.5 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.16.255.80 1 FULL / BDR 00:00:36 172.16. 2.130 FastEthernet0 / 1.8 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.16.255.112 1 FULL / BDR 00:00:37 172.16.2.197 FastEthernet1 / 0.911</font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Peter, Kemerovo, Krasnoyarsk and Vladivostok are directly connected. </font></font><br><blockquote>  msk-arbat-gw1 # sh ip route <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gateway of last resort is 198.51.100.1 to network 0.0.0.0 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.16.0.0/16 is variably subnetted, 25 subnets, 6 masks</font></font><br>  C 172.16.0.0/24 is directly connected, FastEthernet0 / 0.3 <br>  C 172.16.1.0/24 is directly connected, FastEthernet0 / 0.2 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C 172.16.2.0/30 is directly connected, FastEthernet0 / 1.4 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S 172.16.2.4/30 [1/0] via 172.16.2.2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C 172.16.2.16/30 is directly connected, FastEthernet0 / 1.5</font></font><br>  C 172.16.2.32/30 is directly connected, FastEthernet0 / 1.7 <br>  C 172.16.2.128/30 is directly connected, FastEthernet0 / 1.8 <br> O 172.16.2.160/30 [110/2] via 172.16.2.130, 00:05:53, FastEthernet0/1.8 <br> O 172.16.2.192/30 [110/2] via 172.16.2.197, 00:04:18, FastEthernet1/0.911 <br>  C 172.16.2.196/30 is directly connected, FastEthernet1 / 0.911 <br>  C 172.16.3.0/24 is directly connected, FastEthernet0 / 0.101 <br>  C 172.16.4.0/24 is directly connected, FastEthernet0 / 0.102 <br>  C 172.16.5.0/24 is directly connected, FastEthernet0 / 0.103 <br> C 172.16.6.0/24 is directly connected, FastEthernet0/0.104 <br> S 172.16.16.0/21 [1/0] via 172.16.2.2 <br> S 172.16.24.0/22 [1/0] via 172.16.2.18 <br> O 172.16.24.0/24 [110/2] via 172.16.2.18, 00:24:03, FastEthernet0/1.5 <br> O 172.16.128.0/24 [110/2] via 172.16.2.130, 00:07:18, FastEthernet0/1.8 <br> O 172.16.129.0/26 [110/2] via 172.16.2.130, 00:07:18, FastEthernet0/1.8 <br>  C 172.16.255.1/32 is directly connected, Loopback0 <br> O 172.16.255.32/32 [110/2] via 172.16.2.2, 00:24:03, FastEthernet0/1.4 <br> O 172.16.255.48/32 [110/2] via 172.16.2.18, 00:24:03, FastEthernet0/1.5 <br> O 172.16.255.80/32 [110/2] via 172.16.2.130, 00:07:18, FastEthernet0/1.8 <br> O 172.16.255.96/32 [110/3] via 172.16.2.130, 00:04:18, FastEthernet0/1.8 <br> [110/3] via 172.16.2.197, 00:04:18, FastEthernet1/0.911 <br> O 172.16.255.112/32 [110/2] via 172.16.2.197, 00:04:28, FastEthernet1/0.911 <br>  198.51.100.0/28 is subnetted, 1 subnets <br> C 198.51.100.0 is directly connected, FastEthernet0/1.6 <br>  S * 0.0.0.0/0 [1/0] via 198.51.100.1 <br></blockquote><br>     . <br>        ?   ,  krs-stolbi-gw1        : <br><blockquote><img src="https://habrastorage.org/getpro/habr/post_images/f94/b2b/68f/f94b2b68fa50c394160de82b5dd4bc05.png"><br><br> msk-arbat-gw1#traceroute 172.16.128.1 <br>  Type escape sequence to abort. <br> Tracing the route to 172.16.128.1 <br><br> 1 172.16.2.130 35 msec 8 msec 5 msec <br></blockquote><br>         ,    . <br>    5 ,           : <br><blockquote> msk-arbat-gw1(config-subif)#do sh ip ro 172.16.128.0 <br> Routing entry for 172.16.128.0/24 <br> Known via ¬´OSPF 1¬ª, distance 110, metric 4, type intra area <br> Last update from 172.16.2.197 on FastEthernet1/0.911, 00:00:53 ago <br>  Routing Descriptor Blocks: <br> * 172.16.2.197, from 172.16.255.80, 00:00:53 ago, via FastEthernet1/0.911 <br> Route metric is 4, traffic share count is 1 <br><br> vld-gw1#sh ip route 172.16.128.0 <br> Routing entry for 172.16.128.0/24 <br> Known via ¬´OSPF 1¬ª, distance 110, metric 3, type intra area <br> Last update from 172.16.2.193 on FastEthernet1/0, 00:01:57 ago <br>  Routing Descriptor Blocks: <br> * 172.16.2.193, from 172.16.255.80, 00:01:57 ago, via FastEthernet1/0 <br> Route metric is 3, traffic share count is 1 <br><br> msk-arbat-gw1#traceroute 172.16.128.1 <br>  Type escape sequence to abort. <br> Tracing the route to 172.16.128.1 <br><br> 1 172.16.2.197 4 msec 10 msec 10 msec <br> 2 172.16.2.193 8 msec 11 msec 15 msec <br> 3 172.16.2.161 15 msec 13 msec 6 msec <br></blockquote><br><br>  That is, now Krasnoyarsk traffic reaches this way: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eec/614/fef/eec614fef297d9d41c70c10ded71551b.png"><br><br>  As soon as you lift the link, the routers re-connect, exchange their bases, recalculate the shortest paths and enter into the routing table. <br>  In the video all this is more obvious.  I recommend to <a href="http://www.youtube.com/watch%3Fv%3D8zxdW6ag8Us">get acquainted</a> . <br><br> <a href="http://linkmeup.ru/blog/20.html"><img src="https://habrastorage.org/getpro/habr/post_images/298/063/27d/29806327db155363023118ca212fbb1d.png" align="left" hspace="20" vspace="15"></a>  <a href="http://linkmeup.ru/blog/20.html"><b>Problem number 2</b></a> <br>  After setting up OSPF on routers in the Siberian ring, all networks that are located behind the router at the central office in Moscow (msk-arbat-gw1) are available to Khabarovsk along two routes (through Krasnoyarsk and through Vladivostok).  But, since the channel through Krasnoyarsk is better, it is necessary to change the default settings so that Khabarovsk uses the channel through Krasnoyarsk when it is available.  And he switched to Vladivostok only if something happened to the channel to Krasnoyarsk. <br>  <a href="http://linkmeup.ru/blog/20.html">Answer</a> <br><br>  Like any good protocol, OSPF supports authentication ‚Äî two neighbors can verify the authenticity of received OSPF messages before establishing neighborhood ratios.  Leaving for self-study is quite simple. <br><br> <a href="http://linkmeup.ru/blog/24.html"><img src="https://habrastorage.org/getpro/habr/post_images/298/063/27d/29806327db155363023118ca212fbb1d.png" align="left" hspace="20" vspace="15"></a>  <a href="http://linkmeup.ru/blog/24.html"><b>Task number 3</b></a> <br>  An unpleasant story happened with the provider "Filkin Certificate".  Due to their error in the VPN settings, some strange routes began to arrive at the router in Vladivostok, probably from another client or the internal network of the provider.  Some networks intersected with local networks and communication with some parts of the network was lost.  After this incident, it was decided to protect against such situations for the future. <br>  The situation, generally speaking, is far-fetched and unlikely, but it will work as a problem. <br>  In the area between Moscow and Vladivostok, it is necessary to configure routers so that they, when establishing neighborhood relations, also check the set password.  The password should be: MskVladPass and it should be transmitted in the form of hash md5 (key number 1). <br>  <a href="http://linkmeup.ru/blog/24.html">Answer</a> <br><br><h4>  EIGRP </h4><br>  Now let's do another very important protocol. <br><br>  So how good is EIGRP? <br>  - easy to configure <br>  - quick switch to <b>pre-calculated</b> backup route <br>  - requires less router resources (compared to OSPF) <br>  - summation of routes on any router (in OSPF only on ABR \ ASBR) <br>  - balancing traffic on unequal routes (OSPF only on equivalent) <br><br><blockquote>  We decided to translate one of the blog <a href="http://blog.ioshints.info/2010/08/EIGRP-myths-debunked.html">entries</a> of Ivan Pepelnyak, which deals with a number of popular myths about EIGRP: <br>  ‚ÄúEIGRP is a hybrid routing protocol.‚Äù  If I remember correctly, it started with the first EIGRP presentation many years ago and is usually understood as ‚ÄúEIGRP took the best from the link-state and distance-vector protocols‚Äù.  This is absolutely not true.  EIGRP has no distinctive features of the link-state.  It will correctly say ‚ÄúEIGRP is an advanced distance-vector- routing protocol‚Äù. <br><br>  ‚ÄúEIGRP is the distance-vector protocol.‚Äù  Not bad, but not completely true either.  EIGRP differs from other DVs in the way it handles lost routes (or routes with an increasing metric).  All other protocols passively wait for updates from a neighbor (some, for example, RIP, even block the route to prevent routing loops), while EIGRP behaves more actively and requests information itself. <br><br>  ‚ÄúEIGRP is difficult to implement and maintain.‚Äù  Not true.  At one time, EIGRP in large networks with low-speed links was difficult to implement correctly, but just before stub routers were introduced.  With them (as well as several fixes of the DUAL algorithm), it is not nearly as good as OSPF. <br><br>  ‚ÄúLike the LS protocols, EIGRP stores the table of the topology of the routes it exchanges.‚Äù  It's amazing how wrong it is.  EIGRP has no idea what is next of the nearest neighbors, while the LS protocols know the topology of the entire area to which they are connected. <br><br>  ‚ÄúEIGRP is a DV protocol that acts like LS.‚Äù  Not a bad attempt, but still, absolutely wrong.  LS protocols build a routing table by going through the following steps: <br>  - each router describes a network based on information available locally to it (its links, the subnets in which it is located, the neighbors it sees) through a packet (or several) called LSA (in OSPF) or LSP (IS-IS) <br>  - LSA distributed over the network.  Each router should receive each LSA created on its network.  The information obtained from the LSA is recorded in the topology table. <br>  - each router independently analyzes its topology table and runs an SPF algorithm to calculate the best routes to each of the other routers <br>  The behavior of EIGRP doesn‚Äôt even closely resemble these steps, so it‚Äôs unclear why it ‚Äúacts like LS‚Äù <br><br>  The only thing that EIGRP does is that it stores information received from a neighbor (the RIP immediately forgets that it cannot be used at the moment).  In this sense, it is similar to BGP, which also stores everything in the BGP table and selects the best route from there.  The topology table (containing all the information received from the neighbors) gives EIGRP an advantage over RIP ‚Äî it can contain information about the backup (not currently used) route. <br><br></blockquote><br><br>  Now a little closer to the theory of work: <br><br>  Each EIGRP process serves 3 tables: <br>  - The table of neighbors (neighbor table), which contains information about the ‚Äúneighbors‚Äù, i.e.  other routers directly connected to the current and participating in the exchange of routes.  You can view it using the <b>show ip eigrp neighbors command</b> <br>  - The network topology table (topology table), which contains information about routes received from neighbors.  We are watching with the <b>show ip eigrp topology command</b> <br>  - Routing table (routing table), on the basis of which the router makes decisions about packet forwarding.  View through <b>show ip route</b> <br><br>  Metrics. <br>  To assess the quality of a particular route, a certain number is used in the routing protocols, reflecting its various characteristics or a set of characteristics ‚Äî a metric.  The characteristics taken into account may vary - starting with the number of routers on a given route and ending with the arithmetic average of all interfaces along the route.  Regarding the EIGRP metric, we quote Jeremy Cioara: ‚ÄúI had the impression that the creators of EIGRP, with a critical eye on their creation, decided that everything was too simple and worked well.  And then they came up with the formula of the metric, that everyone would say ‚ÄúWOW, it really is difficult and professional looking.‚Äù  Behold the complete formula for calculating the EIGRP metric: (K1 * bw + (K2 * bw) / (256 - load) + K3 * delay) * (K5 / (reliability + K4)), in which: <br>  - bw is not just bandwidth, but (10,000,000 / smallest bandwidth along the route route in kilobits) * 256 <br>  - delay is not just a delay, but the sum of all delays on the way in <b>tens of microseconds</b> * 256 (delay in the show interface, show ip eigrp topology and other commands is shown in microseconds!) <br>  - K1-K5 are the coefficients that serve to ensure that this or that parameter is ‚Äúincluded‚Äù in the formula. <br><br>  Fearfully?  it would be if it all worked as written.  In fact, of all 4 possible terms of the formula, only two are used by default: bw and delay (the coefficients K1 and K3 = 1, the rest are zero), which greatly simplifies it - we simply add these two numbers (not forgetting that still considered by their formulas).  It is important to remember the following: the metric is considered to be the <b>worst throughput indicator along the entire length of the route</b> . <br><br><blockquote>  An interesting thing to do with MTU: quite often you can find information that MTU is related to the EIGRP metric.  Indeed, the MTU values ‚Äã‚Äãare transmitted when exchanging routes.  But, as we can see from the complete formula, there is no mention of MTU.  The fact is that this indicator is taken into account in quite specific cases: for example, if the router has to discard one of the routes that are equivalent in other characteristics, it will choose the one with the lowest MTU.  Although <a href="http://blog.ioshints.info/2010/06/eigrp-mtu-metric.html">not everything is so simple</a> (see comments). <br></blockquote><br><br>  We define the terms used within EIGRP.  Each route in EIGRP is characterized by two numbers: Feasible Distance and Advertised Distance (instead of Advertised Distance, you can sometimes find Reported Distance, which is one and the same).  Each of these numbers represents a metric, or the cost (the more, the worse) of the route from different measurement points: FD is ‚Äúfrom me to the destination‚Äù, and AD- ‚Äúfrom the neighbor who told me about this route to the place destination.  The answer to the legitimate question ‚ÄúWhy do we need to know the cost from a neighbor, if it is already included in FD?‚Äù - just below (as long as you can stop and break your head if you want). <br><br>  Each subnet that EIGRP knows about, on each router, there exists a Successor router from among its neighbors, through which the best (with a smaller metric), according to the protocol, route to this subnet.  In addition, a subnet may also have one or several alternate routes (the router-neighbor through which such a route goes is called Feasible Successor).  EIGRP is the only routing protocol that stores backup routes (they are in OSPF, but are contained, so to speak, in a ‚Äúraw form‚Äù in the topology table ‚Äî they still need to be processed using the SPF algorithm), which gives it a plus in speed: as soon as the protocol determines that the main route (via successor) is not available, it immediately switches to the backup.  In order for a router to become a feasible successor for a route, its AD must be less than the FD successor of this route (this is why we need to know AD).  This rule applies to avoid routing rings. <br><br>  The previous paragraph blew the brain?  The material is difficult, so once again by example.  We have this network: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ce0/325/7dd/ce03257dd716fe89962a779d129d635d.png"><br><br>  From the point of view of R1, R2 is Successor for the 192.168.2.0/24 subnet.  To become a FS for this subnet, R4 requires its AD to be less than FD for this route.  FD is here ((10000000/1544) * 256) + (2100 * 256) = 2195456, AD in R4 (from his point of view, this is FD, that is, how much he should get to this network) = ((10000000/100000 ) * 256) + (100 * 256) = 51200.  Everything converges, AD at R4 is less than the FD route, it becomes FS.  * here is the brain and says: ‚ÄúBIDISH‚Äù *.  Now we look at R3 - it announces its network 192.168.1.0/24 to its neighbor R1, which, in turn, tells about it to its neighbors R2 and R4.  R4 does not know that R2 knows about this subnet, and decides to tell it.  R2 transmits information that it has access through R4 to the subnet 192.168.1.0/24 further on to R1.  R1 strictly looks at the FD route and AD, which R2 boasts (which, as it is easy to understand by the scheme, will obviously be more FD, as it includes it too) and drives it away so that it does not climb with all sorts of nonsense.  This situation is rather improbable, but it can occur under certain circumstances, for example, when the split-horizon mechanism is turned off.  And now to a more likely situation: Imagine that R4 is connected to the 192.168.2.0/24 network not via FastEthernet, but via a 56k modem (the dialup delay is 20,000 usec), respectively, it‚Äôs worth it ((10000000/56) * 256 ) + (2000 * 256) = 46226176. This is more than the FD for this route, so R4 will not become a Feasible Successor.  But this does not mean that EIGRP will not use this route at all.  Just switching to it will take more time (more on this later). <br><br><h6>  neighborhood </h6><br>  Routers do not talk about routes with just anyone - before they begin to exchange information, they must establish a neighborhood relationship.  After the process has been enabled by the router eigrp command, indicating the autonomous system number, we tell the network command which interfaces will be involved at the same time and which networks we want to distribute.  Immediately, hello-packets to the multicast address 224.0.0.10 start to be sent through these interfaces (by default, every 5 seconds for ethernet).  All routers with EIGRP enabled receive these packets, then each receiving router does the following: <br>  - verifies the address of the sender of the hello packet with the address of the interface from which the packet was received, and verifies that they are from the same subnet <br>  - compares the values ‚Äã‚Äãof the K-coefficients obtained from the packet (in other words, which variables are used in the calculation of the metric) with its own.  It is clear that if they are different, then metrics for routes will be considered according to different rules, which is unacceptable. <br>  - checks the autonomous system number <br>  - optional: if authentication is configured, it checks the compliance of its type and keys. <br><br>  If the recipient is satisfied with everything, he adds the sender to the list of his neighbors, and sends him (already a unicast) an update-package, which contains a list of all the routes known to him (aka full-update).  The sender, having received such a packet, in turn, does the same.  For exchanging routes, EIGRP uses the Reliable Transport Protocol (RTP, not to be confused with the Real-time Transport Protocol, which is used in IP-telephony), which implies a delivery confirmation, therefore each of the routers, having received an update package, responds with an ack-packet ( from acknowledgement- confirmation).  So, the neighborhood relationship is established, the routers learned from each other comprehensive information about the routes, what next?  Then they will continue to send multicast hello-packages to confirm that they are in touch, and in case of a change in the topology, update-packages containing information only about changes (partial update). <br><br>  Now back to the previous scheme with a modem. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c38/fe3/b48/c38fe3b4813c3f156925c6978aff1875.png"><br><br>  R2 for some reason has lost touch with 192.168.2.0/24.  Before this subnet, it has no spare routes (i.e., no FS).  Like every responsible router with EIGRP, he wants to reconnect.  To do this, he begins to send special messages (query packets) to all his neighbors, who, in turn, not finding the right route for themselves, ask all their neighbors, and so on.  When the wave of requests reaches R4, it says ‚Äúwait a minute, I have a route to this subnet!  Bad, but at least something.  Everyone forgot about him, but I remember something. ‚Äù  He packs all this into a reply-packet and sends it to his neighbor, from whom he received the request (query), and further along the chain.  Understandably, it all takes more time than just switching to the Feasible Successor, but in the end, we get a connection to the subnet. <br><br>  But now is a dangerous moment: maybe you have already noticed and are on the alert, having read the moment about this fan mailing list.  The fall of one interface causes something similar to a broadcasting storm on the network (not on such a scale, of course, but still), and the more routers it has, the more resources will be spent on all these requests and responses.  But this is still half the trouble.  The situation is even worse: imagine that the routers shown in the picture are only part of a large and distributed network, i.e.  some may be located many thousands of kilometers from our R2, on bad canals, and so on.  So, the trouble is that by sending a query to a neighbor, the router must wait for a reply from it.  It doesn't matter what the answer is, he must come.  Even if the router <b>has already</b> received a positive response, as in our case, it cannot put this route into operation until it receives an answer to all its requests.  And requests, maybe somewhere else in Alaska, wander.  This state of the route is called stuck-in-active.  Here we need to get acquainted with the terms that reflect the state of the route in the EIGRP: active \ passive route.  Usually they are misleading.  Common sense dictates that active means the route is ‚Äúactive‚Äù, enabled, working.  However, the opposite is true: passive is ‚Äúall is well‚Äù, and the active state means that this subnet is not available, and the router is actively searching for another route, sending a query and waiting for a reply.  So, the stuck-in-active state (stuck in the active state) can last up to 3 minutes!  After this period, the router terminates the neighborhood relationship with the neighbor, from which it cannot wait for an answer, and can use the new route through R4.  <a href="http://www.cisco.com/en/US/tech/tk365/technologies_tech_note09186a008010f016.shtml">Details about the problem</a> <br><br>  History, chilling network engineer.  3 minutes downtime is not a joke.  How can we avoid a <s>heart attack of</s> this situation?  There are two ways out: summation of routes and the so-called stub configuration. <br><br><blockquote>  Generally speaking, there is another way out, and it is called route filtering.  But this is such a voluminous topic that a separate article is written under it, and we already have a half-book this time.  Therefore, at your discretion. <br></blockquote><br><br>  As we already mentioned, in EIGRP, summation of routes can be performed on any router.  To illustrate, imagine that our long-suffering R2 is connected to the subnet from 192.168.0.0/24 to 192.168.7.0/24, which is very handy summed up in 192.168.0.0/21 (remember binary math).  The router announces this summary route, and everyone else knows: if the destination address starts at 192.168.0-7, then this is it.  What will happen if one of the subnets disappears?  The router will send query-packets with the address of this network (specific, for example, 192.168.5.0/24), but the neighbors, instead of continuing the vicious distribution on their own behalf, will immediately send a sobering replay, they say, this is your subnet you and understand. <br><br>  The second option is the stub configuration.  Figuratively speaking, stub means ‚Äúend of the path‚Äù, ‚Äúdead end‚Äù in EIGRP, that is, to get into some subnet that is not connected <b>directly</b> to such a router, you will have to go back.  A router configured as a stub will not forward traffic between subnets known to it from EIGRP (in other words, which are marked with the letter D in show ip route).  In addition, his neighbors will not send him query packets.  The most common use case is hub-and-spoke topologies, especially with redundant links.  Let's take such a network: on the left - branches, on the right - the main site, main office, etc.  For fault tolerance redundant links.  EIGRP launched with default settings. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b45/460/6dd/b454606dd0fb8d106b5915c4bd954d25.png"><br><br>  And now ‚Äúattention, question‚Äù: what happens if R1 loses connection with R4 and R5 loses LAN?    R1         R1-&gt;R5-&gt;R2( R3)-&gt;R4.   ?  Not.       R1,     R2 ( R3), -      .   -    stub.       ,      ,  ‚Äú ‚Äù,   .          stub', , -,      ‚Äú ‚Äù,   ,  -,   query-    . <br><br>     stub-,    eigrp stub: <br><blockquote> R1(config)#router eigrp 1 <br> R1(config-router)#eigrp stub? <br> connected Do advertise connected routes <br> leak-map Allow dynamic prefixes based on the leak-map <br> receive-only Set IP-EIGRP as receive only neighbor <br> redistributed Do advertise redistributed routes <br> static Do advertise static routes <br> summary Do advertise summary routes <br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By default, if you just give the eigrp stub command, the connected and summary modes are enabled. </font><font style="vertical-align: inherit;">Of interest is the receive-only mode, in which the router does not announce any networks, only listens to what the neighbors are saying (in the RIP there is a passive interface command that does the same, but in EIGRP it completely disables the protocol on the selected interface, which does not allow set the neighborhood). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Important points in the theory of EIGRP, not included in the article:</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EIGRP can be configured to </font></font><a href="http://www.cisco.com/en/US/tech/tk365/technologies_configuration_example09186a00807f5a63.shtml"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authenticate</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> neighbors</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Concept </font></font><a href="http://blog.ioshints.info/2007/03/eigrp-goodbye-message.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">graceful shutdown</font></font></a> <br></li><li> <a href="http://www.cisco.com/en/US/tech/tk365/technologies_tech_note09186a008009437d.shtml"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Load balancing</font></font></a> </li></ul><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EIGRP Practice </font></font></h5><br><br> ‚Äú  ‚Äù    .    : , .    ‚Äî     ‚Äî     . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e7/252/192/1e7252192916bb20b183d5969715167d.png"><br><br>    ‚Äî     EIGRP     .         ‚Äî 10.0.0.0/8.    ( ,   )  ,        , ,   ‚Äî      ‚Äî   ,   IP-       172.16.32.0/20. <br><br>      : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b7d/e79/578/b7de795780fc44220773ff088b0b8a3f.png"><img src="https://habrastorage.org/getpro/habr/post_images/7de/fa9/919/7defa9919b80e5b3cf67db8627d3d80d.png"><br><br>    ? ,   : <br><blockquote>  router eigrp 1 <br> network 172.16.0.0 0.0.255.255 <br>  network 10.0.0.0 <br></blockquote><br>  EIGRP    ,      ,   ,         (16   B ‚Äî 172.16.0.0  8   8 ‚Äî 10.0.0.0) <br><br>        .      router eigrp,        ‚Ññ1.         (   OSPF). <br><br>    EIGRP  :          (  IOS  15). <br>       : <br><br>  10.0.0.1/24     klgr-center-gw1     : <br><blockquote> klgr-center-gw1: <br> 10.0.0.0/8 is variably subnetted, 2 subnets, 2 masks <br> D 10.0.0.0/8 is a summary, 00:35:23, Null0 <br> <b>C 10.0.0.0/24 is directly connected, FastEthernet1/0</b> <br></blockquote><br>     10.0.1.0/24  10.0.2.0/24/ <br><br> klgr-balt-gw1      10.0.1.0/24  10.0.2.0/24,    10.0.0.0/24  - . <br><blockquote> 10.0.0.0/8 is variably subnetted, 3 subnets, 2 masks <br> D 10.0.0.0/8 is a summary, 00:42:05, Null0 <br> C 10.0.1.0/24 is directly connected, FastEthernet1/1.2 <br> C 10.0.2.0/24 is directly connected, FastEthernet1/1.3 <br></blockquote><br>     10.0.0.0/8   next hop Null0. <br><br>   klgr-center-gw2 ,   10.0.0.0/8     WAN . <br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D 10.0.0.0/8 [90/30720] via 172.16.2.41, 00:42:49, FastEthernet0 / 1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[90/30720] via 172.16.2.45, 00:38:05, FastEthernet0 / 0</font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Something very strange is going on. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But, if you check the configuration of this router, you will probably notice:</font></font><br><blockquote>  router eigrp 1 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> network 172.16.0.0 </font></font><br>  network 10.0.0.0 <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auto-summary</font></font></b> <br></blockquote><br>     .     EIGRP.   ,  . klgr-center-gw1  klgr-balt-gw1    10.0.0.0/8,     ,   . <br>  , , msk-balt-gw1     10.0.1.0/24  10.0.2.0/24,   : 10.0.0.0/8.      ,   msk-balt-gw1    . <br> ,  ,    balt-gw1     10.0.50.243,      ?        Blackhole-: <br> 10.0.0.0/8 is a summary, 00:42:05, Null0 <br>        .      . <br>        blackhole-    .              , ‚Ä¶     auto-summary. <br><br> ,       EIGRP: <br><blockquote>  router eigrp 1 <br> no auto-summary <br></blockquote><br>   .    : <br><br> klgr-center-gw1: <br><blockquote> 10.0.0.0/24 is subnetted, 3 subnets <br> C 10.0.0.0 is directly connected, FastEthernet1/0 <br> D 10.0.1.0 [90/30720] via 172.16.2.37, 00:03:11, FastEthernet0/0 <br> D 10.0.2.0 [90/30720] via 172.16.2.37, 00:03:11, FastEthernet0/0 <br></blockquote><br> klgr-balt-gw1 <br><blockquote> 10.0.0.0/24 is subnetted, 3 subnets <br> D 10.0.0.0 [90/30720] via 172.16.2.38, 00:08:16, FastEthernet0/1 <br> C 10.0.1.0 is directly connected, FastEthernet1/1.2 <br> C 10.0.2.0 is directly connected, FastEthernet1/1.3 <br></blockquote><br> klgr-center-gw2: <br><blockquote> 10.0.0.0/24 is subnetted, 3 subnets <br> D 10.0.0.0 [90/30720] via 172.16.2.45, 00:11:50, FastEthernet0/0 <br> D 10.0.1.0 [90/30720] via 172.16.2.41, 00:11:48, FastEthernet0/1 <br> D 10.0.2.0 [90/30720] via 172.16.2.41, 00:11:48, FastEthernet0/1 <br></blockquote><br><br> <a href="http://linkmeup.ru/blog/25.html"><img src="https://habrastorage.org/getpro/habr/post_images/298/063/27d/29806327db155363023118ca212fbb1d.png" align="left" hspace="20" vspace="15"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Task ‚Ññ4</font></font></b></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Due to the settings of various QoS mechanisms on Kaliningrad routers, the bandwidth value on the interfaces was changed, these values ‚Äã‚Äãdo not correspond to reality now. </font><font style="vertical-align: inherit;">Therefore, it was decided that it is necessary to change the calculation of the EIGRP metrics on Kaliningrad routers so that only delay is taken into account and does not take into account the interface bandwidth.</font></font><br>  <a href="http://linkmeup.ru/blog/25.html">Answer</a> <br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Configuring the transfer of routes between different protocols </font></font></h4><br>        :  OSPF  EIGRP  ,       . <br>    () . <br><br>          ,      .    msk-arbat-gw1  klgr-balt-gw1.  . <br><br>  EIGRP  OSPF: <br><blockquote> klgr-gw1(config)#router ospf 1 <br> klgr-gw1(config-router)#redistribute eigrp 1 subnets <br></blockquote><br>    msk-arbat-gw1: <br><blockquote>  msk-arbat-gw1 # sh ip route <br> Codes: C ‚Äî connected, S ‚Äî static, I ‚Äî IGRP, R ‚Äî RIP, M ‚Äî mobile, B ‚Äî BGP <br>  D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area <br> N1 ‚Äî OSPF NSSA external type 1, N2 ‚Äî OSPF NSSA external type 2 <br> E1 ‚Äî OSPF external type 1, E2 ‚Äî OSPF external type 2, E ‚Äî EGP <br> i ‚Äî IS-IS, L1 ‚Äî IS-IS level-1, L2 ‚Äî IS-IS level-2, ia ‚Äî IS-IS inter area <br> * ‚Äî candidate default, U ‚Äî per-user static route, o ‚Äî ODR <br> P ‚Äî periodic downloaded static route <br><br> Gateway of last resort is 198.51.100.1 to network 0.0.0.0 <br><br> 10.0.0.0/8 is variably subnetted, 3 subnets, 2 masks <br> O E2 10.0.0.0/8 [110/20] via 172.16.2.34, 00:25:11, FastEthernet0/1.7 <br> O E2 10.0.1.0/24 [110/20] via 172.16.2.34, 00:25:11, FastEthernet0/1.7 <br> O E2 10.0.2.0/24 [110/20] via 172.16.2.34, 00:24:50, FastEthernet0/1.7 <br> 172.16.0.0/16 is variably subnetted, 30 subnets, 5 masks <br> O E2 172.16.0.0/16 [110/20] via 172.16.2.34, 00:25:11, FastEthernet0/1.7 <br>  C 172.16.0.0/24 is directly connected, FastEthernet0 / 0.3 <br>  C 172.16.1.0/24 is directly connected, FastEthernet0 / 0.2 <br> C 172.16.2.0/30 is directly connected, FastEthernet0/1.4 <br> C 172.16.2.16/30 is directly connected, FastEthernet0/1.5 <br>  C 172.16.2.32/30 is directly connected, FastEthernet0 / 1.7 <br> O E2 172.16.2.36/30 [110/20] via 172.16.2.34, 01:00:55, FastEthernet0/1.7 <br> O E2 172.16.2.40/30 [110/20] via 172.16.2.34, 01:00:55, FastEthernet0/1.7 <br> O E2 172.16.2.44/30 [110/20] via 172.16.2.34, 01:00:55, FastEthernet0/1.7 <br>  C 172.16.2.128/30 is directly connected, FastEthernet0 / 1.8 <br> O 172.16.2.160/30 [110/2] via 172.16.2.130, 01:00:55, FastEthernet0/1.8 <br> O 172.16.2.192/30 [110/2] via 172.16.2.197, 00:13:21, FastEthernet1/0.911 <br>  C 172.16.2.196/30 is directly connected, FastEthernet1 / 0.911 <br>  C 172.16.3.0/24 is directly connected, FastEthernet0 / 0.101 <br>  C 172.16.4.0/24 is directly connected, FastEthernet0 / 0.102 <br>  C 172.16.5.0/24 is directly connected, FastEthernet0 / 0.103 <br> C 172.16.6.0/24 is directly connected, FastEthernet0/0.104 <br> O 172.16.24.0/24 [110/2] via 172.16.2.18, 01:00:55, FastEthernet0/1.5 <br> O 172.16.128.0/24 [110/2] via 172.16.2.130, 01:00:55, FastEthernet0/1.8 <br> O 172.16.129.0/26 [110/2] via 172.16.2.130, 01:00:55, FastEthernet0/1.8 <br> O 172.16.144.0/24 [110/3] via 172.16.2.130, 00:13:21, FastEthernet0/1.8 <br> [110/3] via 172.16.2.197, 00:13:21, FastEthernet1/0.911 <br> O 172.16.160.0/24 [110/2] via 172.16.2.197, 00:13:31, FastEthernet1/0.911 <br>  C 172.16.255.1/32 is directly connected, Loopback0 <br> O 172.16.255.48/32 [110/2] via 172.16.2.18, 01:00:55, FastEthernet0/1.5 <br> O E2 172.16.255.64/32 [110/20] via 172.16.2.34, 01:00:55, FastEthernet0/1.7 <br> O E2 172.16.255.65/32 [110/20] via 172.16.2.34, 01:00:55, FastEthernet0/1.7 <br> O E2 172.16.255.66/32 [110/20] via 172.16.2.34, 01:00:55, FastEthernet0/1.7 <br> O 172.16.255.80/32 [110/2] via 172.16.2.130, 01:00:55, FastEthernet0/1.8 <br> O 172.16.255.96/32 [110/3] via 172.16.2.130, 00:13:21, FastEthernet0/1.8 <br> [110/3] via 172.16.2.197, 00:13:21, FastEthernet1/0.911 <br> O 172.16.255.112/32 [110/2] via 172.16.2.197, 00:13:31, FastEthernet1/0.911 <br>  198.51.100.0/28 is subnetted, 1 subnets <br> C 198.51.100.0 is directly connected, FastEthernet0/1.6 <br>  S * 0.0.0.0/0 [1/0] via 198.51.100.1 <br></blockquote><br><br>  ,    2 ‚Äî   . 2 ‚Äî ,     2-  ( <a href="http://habrahabr.ru/post/117099/">External</a> ),        OSPF  <br><br>   OSPF  EIGRP.   : <br><blockquote> klgr-gw1(config)#router eigrp 1 <br> klgr-gw1(config-router)#redistribute ospf 1 metric 100000 20 255 1 1500 <br></blockquote><br>    (    )  ,    . <br><br>     EX       170,  90  : <br><blockquote> klgr-gw2#sh ip route <br><br> Gateway of last resort is not set <br><br> 172.16.0.0/16 is variably subnetted, 30 subnets, 4 masks <br> D <b>EX</b> 172.16.0.0/24 [ <b>170</b> /33280] via 172.16.2.37, 00:00:07, FastEthernet0/0 <br> D EX 172.16.1.0/24 [170/33280] via 172.16.2.37, 00:00:07, FastEthernet0/0 <br> D EX 172.16.2.0/30 [170/33280] via 172.16.2.37, 00:00:07, FastEthernet0/0 <br> D EX 172.16.2.4/30 [170/33280] via 172.16.2.37, 00:00:07, FastEthernet0/0 <br> D EX 172.16.2.16/30 [170/33280] via 172.16.2.37, 00:00:07, FastEthernet0/0 <br> D 172.16.2.32/30 [ <b>90</b> /30720] via 172.16.2.37, 00:38:59, FastEthernet0/0 <br> C 172.16.2.36/30 is directly connected, FastEthernet0/0 <br> D 172.16.2.40/30 [90/30720] via 172.16.2.37, 00:38:59, FastEthernet0/0 <br> [90/30720] via 172.16.2.46, 00:38:59, FastEthernet0/1 <br>  ... <br></blockquote><br><br>  ,     ,    ‚Äî         <a href="http://habrahabr.ru/post/117062/"></a> ,           . <br>   ‚Äî   ,   .      ‚Äî  ,  . <br><br> <a href="http://linkmeup.ru/blog/27.html"><img src="https://habrastorage.org/getpro/habr/post_images/298/063/27d/29806327db155363023118ca212fbb1d.png" align="left" hspace="20" vspace="15"> <b> ‚Ññ5 ( <i>  </i> )</b></a> <br>            .            1        . <br>          ,        30   ,       ,      .  ,        ,           .        ,    ,        . <br>  <a href="http://linkmeup.ru/blog/27.html">Answer</a> <br><br><h4>    </h4><br>       .      ,    ,    (,      ): <br><blockquote> PC&gt;ping <a href="http://linkmeup.ru/">linkmeup.ru</a> <br><br> Pinging 192.0.2.2 with 32 bytes of data: <br><br> Reply from 172.16.2.5: Destination host unreachable. <br> Reply from 172.16.2.5: Destination host unreachable. <br> Reply from 172.16.2.5: Destination host unreachable. <br> Reply from 172.16.2.5: Destination host unreachable. <br><br> Ping statistics for 192.0.2.2: <br> Packets: Sent = 4, Received = 0, Lost = 4 (100% loss), <br></blockquote><br>    ,   spb-ozerki-gw1,  spb-vsl-gw1,  -          ,  msk-arbat-gw1,     . <br>    ,       : <br><blockquote> msk-arbat-gw1(config)#router ospf 1 <br> msk-arbat-gw1(config-router)#default-information originate <br></blockquote><br>         ,     . <br><br>   : <br><blockquote> PC&gt;tracert <a href="http://linkmeup.ru/">linkmeup.ru</a> <br><br> Tracing route to 192.0.2.2 over a maximum of 30 hops: <br><br> 1 3 ms 3 ms 3 ms 172.16.17.1 <br> 2 4 ms 5 ms 12 ms 172.16.2.5 <br> 3 14 ms 20 ms 9 ms 172.16.2.1 <br> 4 17 ms 17 ms 19 ms 198.51.100.1 <br> 5 22 ms 23 ms 19 ms 192.0.2.2 <br><br> Trace complete. <br></blockquote><br> <a href="http://linkmeup.ru/blog/30.html"><img src="https://habrastorage.org/getpro/habr/post_images/298/063/27d/29806327db155363023118ca212fbb1d.png" align="left" hspace="20" vspace="15"> <b> ‚Ññ6 ( <i>  </i> )</b></a> <br>   klgr-balt-gw1    EIGRP  OSPF.          20,       .    ,   ,      ,       . <br>  <a href="http://linkmeup.ru/blog/30.html">Answer</a> <br><br><h4>     </h4><br><br> 1)          <b>show ip ospf neighbor</b> <br><blockquote> msk-arbat-gw1: <br><br>  Neighbor ID Pri State Dead Time Address Interface <br> 172.16.255.32 1 FULL/DROTHER 00:00:33 172.16.2.2 FastEthernet0/1.4 <br> 172.16.255.48 1 FULL/DR 00:00:34 172.16.2.18 FastEthernet0/1.5 <br> 172.16.255.64 1 FULL/DR 00:00:33 172.16.2.34 FastEthernet0/1.7 <br> 172.16.255.80 1 FULL/DR 00:00:33 172.16.2.130 FastEthernet0/1.8 <br> 172.16.255.112 1 FULL/DR 00:00:33 172.16.2.197 FastEthernet1/0.911 <br></blockquote><br> 2)   EIGRP: <b>show ip eigrp neighbors</b> <br><blockquote> IP-EIGRP neighbors for process 1 <br> H Address Interface Hold Uptime SRTT RTO Q Seq <br> (sec) (ms) Cnt Num <br> 0 172.16.2.38 Fa0/1 12 00:04:51 40 1000 0 54 <br> 1 172.16.2.42 Fa0/0 13 00:04:51 40 1000 0 58 <br></blockquote><br> 3)    <b>show ip protocols</b>           . <br><br> klgr-balt-gw1: <br><blockquote> Routing Protocol is ¬´EIGRP 1 ¬ª <br> Outgoing update filter list for all interfaces is not set <br> Incoming update filter list for all interfaces is not set <br> Default networks flagged in outgoing updates <br> Default networks accepted from incoming updates <br> EIGRP metric weight K1=1, K2=0, K3=1, K4=0, K5=0 <br> EIGRP maximum hopcount 100 <br> EIGRP maximum metric variance 1 <br> Redistributing: EIGRP 1, OSPF 1 <br> Automatic network summarization is in effect <br> Automatic address summarization: <br> Maximum path: 4 <br> Routing for Networks: <br> 172.16.0.0 <br> Routing Information Sources: <br> Gateway Distance Last Update <br> 172.16.2.42 90 4 <br> 172.16.2.38 90 4 <br> Distance: internal 90 external 170 <br><br> Routing Protocol is ¬´OSPF 1¬ª <br> Outgoing update filter list for all interfaces is not set <br> Incoming update filter list for all interfaces is not set <br> Router ID 172.16.255.64 <br> It is an autonomous system boundary router <br> Redistributing External Routes from, <br> EIGRP 1 <br> Number of areas in this router is 1. 1 normal 0 stub 0 nssa <br> Maximum path: 4 <br> Routing for Networks: <br> 172.16.2.32 0.0.0.3 area 0 <br> Routing Information Sources: <br> Gateway Distance Last Update <br> 172.16.255.64 110 00:00:23 <br> Distance: (default is 110) <br></blockquote><br> 4)           : <br> <b>debug ip OSPF events <br> debug ip OSPF adj <br> debug EIGRP packets</b> <br><br>      ,    ,   . <br><br> <a href="http://linkmeup.ru/blog/32.html"><img src="https://habrastorage.org/getpro/habr/post_images/298/063/27d/29806327db155363023118ca212fbb1d.png" align="left" hspace="20" vspace="15"> <b> ‚Ññ7</b></a> <br>    . <br>        ,        OSPF. <br>       .  ,       EIGRP  OSPF       ,   ,            ,  EIGRP. <br> ,      ,    ,  ,        ,           SPF    . <br>  <a href="http://linkmeup.ru/blog/32.html">The answer is</a> . <br><br><h4>   </h4><br> <a href="https://docs.google.com/spreadsheet/ccc%3Fkey%3D0AooexOHebRpTdGc1eFhvZHdBa0ZrTUljRG5lYVVQM0E%26amp%3Busp%3Dsharing"> IP-,       </a> <br> <a href="">   </a> <br> <a href="https://docs.google.com/document/pub%3Fid%3D1kmcVYkJAymnj87VK0wreVU0jfv9o_ZC0KZJapmXff2k"> </a> <br><br><h4>  useful links </h4><br><h5>    XGU.ru </h5><br> <a href="http://xgu.ru/wiki/OSPF_%25D0%25B2_Cisco">OSPF  cisco</a> <br>  <a href="http://xgu.ru/wiki/OSPF">Ospf</a> <br><br><h5>    </h5><br> <a href="http://habrahabr.ru/post/117062/">Inter-domain Routing Loops</a> <br>  <a href="http://habrahabr.ru/post/117099/">Features of the External Type 1 and External Type 2 routes in OSPF.</a>  <a href="http://habrahabr.ru/post/117099/">Part 1</a> <br>  <a href="http://habrahabr.ru/post/117110/">Features of the External Type 1 and External Type 2 routes in OSPF.</a>  <a href="http://habrahabr.ru/post/117110/">Part 2</a> <br><br><h5>  Other </h5><br>  <a href="http://docwiki.cisco.com/wiki/Open_Shortest_Path_First">Cisco</a> <br> <a href="http://en.wikipedia.org/wiki/Open_Shortest_Path_First"> </a> <br> <a href="http://citforum.ru/nets/ito/25.shtml">    </a> <br><br> <i><b> </b></i> <br>         ‚Äî <a href="http://linkmeup.ru/">linkmeup.ru</a> .           <a href="http://eucariot.livejournal.com/73761.html"></a> ,     <a href="http://linkmeup.ru/"></a>  . <br><br>       ‚Äî  <a href="https://habrahabr.ru/users/thegluck/" class="user_link">theGluck</a>     .  <a href="https://habrahabr.ru/users/jdima/" class="user_link">JDima</a>     ,  <a href="http://xgu.ru/wiki/%25D0%25A3%25D1%2587%25D0%25B0%25D1%2581%25D1%2582%25D0%25BD%25D0%25B8%25D0%25BA:Nata"> </a>   .  <a href="https://habrahabr.ru/users/antuan/" class="user_link">Antuan</a>     .      <a href="http://nikosummerinspiration.blogspot.com/"></a>   . <br><br>  PS <br>          .   ,       . <br><br>  Pps <br>  Packet Tracer    .   ‚Äî   -  .  ?        IOU vs GNS. </div><p>Source: <a href="https://habr.com/ru/post/156695/">https://habr.com/ru/post/156695/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../156673/index.html">Tt eSPORTS Meka G-Unit White - White Knight with a Mechanical Heart</a></li>
<li><a href="../156677/index.html">Chrome Remote Desktop out of beta</a></li>
<li><a href="../156687/index.html">World Community Grid: Distributed Computing Network</a></li>
<li><a href="../156689/index.html">Everything you wanted to know about the Imagine Cup, but were afraid to ask</a></li>
<li><a href="../156693/index.html">Data center Colocrossing in New York dropped from the Internet</a></li>
<li><a href="../156697/index.html">Problems of remote work at home and their solutions</a></li>
<li><a href="../156699/index.html">About how we came up with a live online translator Nitro and did</a></li>
<li><a href="../156705/index.html">Review of the Bluetooth speakerphone Parrot MINIKIT Neo: talk "without hands" in the car</a></li>
<li><a href="../156707/index.html">How to gather developers together: Mobile Developer Day. Interview with Misha Denisov and Yulya Basyrova</a></li>
<li><a href="../156709/index.html">How to create a working landing pages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>