<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Safe use of the RESET leg on the Arduino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear habravchane! 

 In this article I will describe how to safely use the RESET leg on the Arduino board for your own needs. 

 Actually, sear...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Safe use of the RESET leg on the Arduino</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/3e2/be0/b1a/3e2be0b1a911488bab843c207407234b.jpg" alt="Picture to attract attention"></div><br>  Hello, dear habravchane! <br><br>  In this article I will describe how to safely use the <i>RESET</i> leg on the Arduino board for your own needs. <br><br>  Actually, searching for a solution to this issue led me to a certain lack of legs in the system developed by me (which I hope to describe on Habr√©, as I finish the implementation) based on the <i>Arduino Pro Mini</i> . <br>  So, the task is clear, and the requirements are: <br><ul><li>  Ability to load sketches in the usual ways for Arduin </li><li>  Ability to use a <i>RESET</i> leg in your program as a <i>digital I / O pin</i> </li></ul><br><a name="habracut"></a><br>  <i>Attention: the article contains commands, the careless use of which may lead Arduin to an inoperable state.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Googling on this issue will put novices in a dead end - it seems they write everywhere that this is impossible, but occasionally it is mentioned that there are ways to get around this restriction, as, for example, here <a href="http://habrahabr.ru/post/110894/">[1]</a> . <br><br>  So, in order to get the desired result, we need to change the bootloader code, flash it into Arduin and change the fuses!  It is in this sequence!  It is very important!  You are ready? <br><br><h4>  Step one </h4><br>  Then let's start with the bootloader.  In the network you can find many bootloaders for Arduina with various capabilities.  I took the smallest - <i>optiboot</i> <a href="http://code.google.com/p/optiboot/">[2]</a> .  It not only frees up an additional 1.5 kilobytes for the main program code, but also allows you to use <i>Watchdog</i> <a href="http://habrahabr.ru/post/189744/">[3]</a> .  We download the latest version of the source code ( <a href="">archive</a> ) from the site, unpack and copy the folder <i>"\ optiboot-9e0c0b9db6fe \ optiboot \ bootloaders \ optiboot" in the folder "pathToArduino \ hardware \ arduino \ avr \ bootloaders \"</i> .  I am using <i>Arduino IDE</i> version <i>1.5.8</i> .  If you have an <i>Arduino IDE</i> version <i>1.0.5</i> , then find the <i>bootloaders</i> folder yourself. <br><br>  Open the file <i>‚ÄúpathToArduino \ hardware \ arduino \ avr \ bootloaders \ optiboot \ optiboot.c‚Äù</i> in a text editor or in an existing programming environment (I use <i>Atmel Studio 6.2</i> ).  The following lines should be commented out: <br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">ch</span></span> = MCUSR; <span class="hljs-attribute"><span class="hljs-attribute">MCUSR</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">if</span></span> (ch &amp; (_BV(WDRF) | _BV(BORF) | _BV(PORF))) appStart(ch);</code> </pre> <br>  And after them insert such code: <br><pre> <code class="hljs ruby"> /<span class="hljs-regexp"><span class="hljs-regexp">/ch = MCUSR; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/MCUSR = 0; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/if (ch &amp; (_BV(WDRF) | _BV(BORF) | _BV(PORF))) /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/appStart(ch); #define PIN_BOOT PCINT14 DDRC &amp;= ~_BV(PIN_BOOT); PORTC |= _BV(PIN_BOOT); _delay_us(4); if(_BV(PIN_BOOT)&amp;PINC) { PORTC &amp;= ~_BV(PIN_BOOT); appStart(MCUSR); }</span></span></code> </pre> <br>  Also in the program header, find #include and insert after all the inclusions: <br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;util/delay.h&gt;</span></span></span></span></code> </pre> <br>  To verify the correctness of all actions with the bootloader, it is best to create a test firmware, replacing the pointer in the firmware code.  Suppose so ( <i>PCINT10</i> is leg <i>A2</i> ): <br><pre> <code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PIN_BOOT PCINT10</span></span></code> </pre>  Then on the test firmware, without affecting the fyuzov, you can make sure that we are doing everything correctly. <br><br>  Let me explain what is happening here.  We have removed the transition to the main program, which occurs after a software reset and a low power reset.  <i>PCINT14</i> is the address of our <i>RESET pin</i> in the <i>PORTC</i> register.  Using a direct address to the <i>DDRC</i> register <i>,</i> we set <i>pinMode INPUT</i> for this leg and gave it 5 volts through internal resistance (the <i>PORTC</i> register, the so-called <i>pinMode INPUT_PULLUP</i> ).  We waited a little while until a sufficient number of electronic engineers flowed through a resistor, and watched the signal on the leg through the <i>PINC</i> register.  If there is no signal on the leg, then it is grounded, then proceed to the flashing of the main program.  Otherwise, we transfer the leg to the default mode <i>INPUT</i> and run the main program. <br><br>  Now you have to compile it all.  In the <i>omake.bat</i> file, <i>you</i> must replace the path to <i>make.exe</i> .  In my case (the <i>Arduino IDE</i> version <i>1.5.8</i> ) is <i>‚Äú.. \ .. \ .. \ sam \ system \ CMSIS \ Examples \ cmsis_example \ gcc_atmel \ make.exe‚Äù</i> .  I added a couple more options, so the line to start the compilation looks like this: <br><pre> <code class="hljs tex">..<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">.</span></span></span></span>.<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">.</span></span></span></span>.<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sam</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CMSIS</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Examples</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cmsis</span></span></span></span>_example<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gcc</span></span></span></span>_atmel<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">make</span></span></span></span>.exe OS=windows ENV=arduino LED_DATA_FLASH=1 BAUD_RATE=57600 <span class="hljs-comment"><span class="hljs-comment">%*</span></span></code> </pre> <br>  First, run <i>omake.exe</i> with the <i>clean</i> parameter, then with the <i>atmega328</i> parameter and carefully read the answer.  If <i>‚Äúerror:‚Äù</i> errors are not mentioned there, then our firmware <i>optiboot_atmega328.hex</i> should appear in the folder.  Wonderful! <br><br><h4>  Step two </h4><br>  Let's start flashing the bootloader.  Using the flashing function in the <i>Arduino IDE</i> is not the best option in this case - this will most likely lead to the inoperability of Arduine.  For flashing the bootloader, we will use <i>avrdude.exe</i> .  This console program is located in the folder <i>"pathToArduino \ hardware \ tools \ avr \ bin \"</i> .  Read about the used parameters here <a href="http://kvorb.ru/2009/06/24/russkaya-dokumentaciya-k-avrdude-chast-1/">[4]</a> .  To use it in the folder with the firmware, create one command script <i>flash.bat with the</i> following content: <br><pre> <code class="hljs tex">..<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">.</span></span></span></span>.<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">.</span></span></span></span>.<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">.</span></span></span></span>.<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tools</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">avr</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bin</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">avrdude</span></span></span></span>.exe -C "..<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">.</span></span></span></span>.<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">.</span></span></span></span>.<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">.</span></span></span></span>.<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tools</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">avr</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">etc</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">avrdude</span></span></span></span>.conf" -c stk500v1 -p m328p -b 19200 -P COM5 <span class="hljs-comment"><span class="hljs-comment">%*</span></span></code> </pre> <br>  And the second is <i>flash_boot.bat</i> : <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">flash</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bat</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-e</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-U</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">flash</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:w</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:optiboot_atmega328.hex</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:i</span></span></code> </pre> <br>  File paths substitute your own.  <i>COM</i> port, specify the one used by your <i>SPI</i> programmer or Arduina replacing the programmer.  I used another <i>Pro Mini</i> via the <i>PL2303HXA</i> <i>COM</i> <i>programmer</i> .  In it, I uploaded a standard ArduinoISP sketch, which emulates the work of the <i>SPI</i> programmer using the <i>STK500 v1</i> protocol.  An approximate wiring diagram is shown in this article <a href="http://habrahabr.ru/post/222201/">[5]</a> . <br><br>  After everything is connected, you can check the connection with the programmable Arduina by running <i>flash.bat</i> : it will show the microcontroller signature and other information.  Now you can run the second script <i>flash_boot.bat</i> .  If he says <i>"so many bytes of flash verified"</i> , then everything is OK, the bootloader is in place. <br><br>  At this step, you can test the test firmware: for example, load standard <i>Blink</i> and, during the launch of the Arduina, ground the test leg ( <i>A2</i> in this case).  There should be an indiscriminate blinking of the built-in LED - this <i>Watchdog</i> restarts the microcontroller at the stage of unsuccessful attempts by the bootloader to read the command from the <i>Serial</i> port to rewrite the main program. <br><br><h4>  Step Three </h4><br>  Finally, the most crucial stage is the installation of fyuzov.  Before you work with them, you should read about them, for example, here <a href="http://embedderslife.wordpress.com/2012/03/07/fuse-bits-aren-t-scary/">[6]</a> . <br>  I want to note that the wrong fusions can be cured with the help of <i>‚ÄúAtmega fusebit doctor‚Äù</i> <a href="http://www.getchip.net/posts/059-ispravlyaem-avr-fyuzy-pri-pomoshhi-atmega-fusebit-doctor/">[7]</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1ae/ccf/fcb/1aeccffcb62b4b4f9db281127437218b.jpg" alt="&quot;Atmega fusebit doctor&quot; on bezpechnoy breadboard"></div>  <i>"Atmega fusebit doctor" on bezpechnoy breadboard</i> <br><br>  Using the calculator fyuzov <a href="http://payalo.at.ua/c_fuse/calc.html%3Fpart%3DATmega328P">[8]</a> and datashit <a href="http://www.atmel.com/images/Atmel-8271-8-bit-AVR-Microcontroller-ATmega48A-48PA-88A-88PA-168A-168PA-328-328P_datasheet_Complete.pdf">[9]</a> , create a command script <i>flash_fuse.bat</i> to install the correct fyuzov in our long-suffering chip: <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">flash</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bat</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-u</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-U</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lfuse</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:w</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0xFF</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:m</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-U</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">hfuse</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:w</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0x56</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:m</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-U</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">efuse</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:w</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0x05</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:m</span></span></code> </pre> <br>  The number 5 in <i>hfuse</i> is responsible for disabling the <i>RESET</i> function on the corresponding leg.  The rest fyuzy at your discretion (check with datashit!).  This moment has come, you can still return <s>to the bright side</s> to the standard Arduine, but we will not.  <b>After installing fyuzov this team standard ways to change fyyuzy or bootloader will not be!</b>  But, if we did everything correctly, then we can sew the main program <s>as usual</s> by grounding the foot <i>RESET</i> (or simply clamping the <i>RESET</i> button on the Arduina board).  When you turn on Arduina, the built-in LED will blink erratically - this is a signal to start loading the sketch. <br><br><h4>  Step Four </h4><br>  Having overcome many difficulties, we compiled the correct bootloader, stitched it into the microcontroller and installed the correct fuses.  Now we need to fix something in the file <i>‚ÄúpathToArduino \ hardware \ arduino \ avr \ boards.txt‚Äù</i> so that the <i>Arduino IDE</i> can communicate with our board. <br><br>  Add your settings to the end of the file (for the <i>Arduino IDE</i> version <i>1.0.5,</i> they are slightly different): <br><pre> <code class="hljs coffeescript"><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">## pro328o16.name=[Optiboot] Arduino Pro Mini (5V, 16MHz) w/ ATmega328p pro328o16.upload.tool=avrdude pro328o16.upload.protocol=arduino pro328o16.upload.maximum_size=32256 pro328o16.upload.speed=57600 pro328o16.bootloader.tool=avrdude pro328o16.bootloader.low_fuses=0xff pro328o16.bootloader.high_fuses=0x56 pro328o16.bootloader.extended_fuses=0x04 pro328o16.bootloader.file=optiboot/optiboot_atmega328.hex pro328o16.bootloader.unlock_bits=0x3F pro328o16.bootloader.lock_bits=0x0F pro328o16.build.mcu=atmega328p pro328o16.build.f_cpu=16000000L pro328o16.build.board=AVR_PRO pro328o16.build.core=arduino:arduino pro328o16.build.variant=arduino:eightanaloginputs</span></span></code> </pre> <br>  The board name <i>‚Äú[Optiboot] Arduino Pro Mini (5V, 16MHz) w / ATmega328p‚Äù</i> will appear in <i>the Tools / Board</i> menu at the very bottom of the list. <br><br><h4>  Restrictions </h4><br>  As you remember, the <i>RESET</i> button on the Arduino board closes the <i>RESET</i> leg to the ground <a href="http://arduino.cc/en/uploads/Main/Arduino-Pro-Mini-schematic.pdf">[10]</a> .  With it, we introduce the microcontroller into the flashing mode of the main program.  That is why I do not recommend using this leg in the five volt output mode.  If you need to control the "power" load, it is better to bring the ground to the leg, and to start the five volt on the second power supply line.  The power is turned off by putting the foot in input mode.  So we avoid a possible short circuit.  The remaining modes can be used without problems. <br><br>  The second remark concerns third-party libraries: if we pass a leg as a parameter, then we do not know in which mode it will work.  There's nothing to be done.  Is that use the leg only on a very simple logic, which we write.  And I also recommend pausing at the beginning of the program initialization so that it is clear from the LED that it is better to release the <i>RESET</i> button immediately if the button did not suddenly work as expected. <br><br>  The third point concerns the standard numbering of the legs.  Yes, the <i>RESET</i> leg has no number!  There are only microcontroller registers that control it.  This problem is easily solved by several <i>revisions of the</i> file <i>‚ÄúpathToArduino \ hardware \ arduino \ avr \ variants \ standard \ pins_arduino.h‚Äù</i> : <br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> RST = <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> PROGMEM digital_pin_to_port_PGM[] = { ‚Ä¶ PC, <span class="hljs-comment"><span class="hljs-comment">/* 20 */</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> PROGMEM digital_pin_to_bit_mask_PGM[] = { ‚Ä¶ _BV(<span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-comment"><span class="hljs-comment">/* 20, port C */</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> PROGMEM digital_pin_to_timer_PGM[] = { ‚Ä¶ NOT_ON_TIMER, <span class="hljs-comment"><span class="hljs-comment">/* 20 - port C */</span></span> };</code> </pre> <br>  After that, all standard functions, except <i>analogRead ()</i> , will work with the <i>RESET</i> leg number <i>20</i> ( <i>RST</i> ), as with any other.  And even if you have additional analog legs <i>A6</i> and <i>A7</i> , then they work separately according to their principle.  You can see this for yourself by writing this sketch: <br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> setup() { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); pinMode(RST, INPUT_PULLUP); //    RST  HIGH   <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span> } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(digitalRead(RST)); //    RST  <span class="hljs-number"><span class="hljs-number">1</span></span>,     <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(analogRead(A6)); //    A6 "" ,    delay(<span class="hljs-number"><span class="hljs-number">500</span></span>); }</code> </pre> <br><br><h4>  Conclusion </h4><br>  I hope that my article will not be for you the only possible way out of the difficult situation in your projects at Arduino.  But I will be very happy if she pushes anyone to dig deeper and find interesting solutions. <br><br>  The archive with all the affected files for Arduino IDE 1.5.8 you can download the link <a href="https://docs.google.com/file/d/0B00f7uyynFwHLWp1dWJodjNhak0">[11]</a> .  Directory structure saved. <br><br>  Comments are accepted in PM or comments. <br><br><h4>  Useful links: </h4><br><ol><li>  <a href="http://habrahabr.ru/post/110894/">Few conclusions?</a>  <a href="http://habrahabr.ru/post/110894/">Use RESET</a> </li><li>  <a href="http://code.google.com/p/optiboot/">optiboot - An optimized bootloader for Arduino platforms</a> </li><li>  <a href="http://habrahabr.ru/post/189744/">Arduino watchdog or automatic RESET in case of a hang</a> </li><li>  <a href="http://kvorb.ru/2009/06/24/russkaya-dokumentaciya-k-avrdude-chast-1/">Russian documentation for AVRDUDE</a> </li><li>  <a href="http://habrahabr.ru/post/222201/">Arduino Pro Mini Firmware via Nano</a> </li><li>  <a href="http://embedderslife.wordpress.com/2012/03/07/fuse-bits-aren-t-scary/">Fuse bits are not scary</a> </li><li>  <a href="http://www.getchip.net/posts/059-ispravlyaem-avr-fyuzy-pri-pomoshhi-atmega-fusebit-doctor/">Fix AVR fuses with Atmega fusebit doctor</a> </li><li>  <a href="http://payalo.at.ua/c_fuse/calc.html%3Fpart%3DATmega328P">AVR fusion calculator</a> </li><li>  <a href="http://www.atmel.com/images/Atmel-8271-8-bit-AVR-Microcontroller-ATmega48A-48PA-88A-88PA-168A-168PA-328-328P_datasheet_Complete.pdf">ATmega328P datasheet</a> </li><li>  <a href="http://arduino.cc/en/uploads/Main/Arduino-Pro-Mini-schematic.pdf">Arduino Pro Mini schematic</a> </li><li>  <a href="https://docs.google.com/file/d/0B00f7uyynFwHLWp1dWJodjNhak0">Archive with all affected files for Arduino IDE 1.5.8</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/242929/">https://habr.com/ru/post/242929/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242911/index.html">We turn html into native components</a></li>
<li><a href="../242915/index.html">About symfony 3.0</a></li>
<li><a href="../242917/index.html">Myself SelfHost server</a></li>
<li><a href="../242919/index.html">How we backed up the client's IT infrastructure in Donetsk</a></li>
<li><a href="../242925/index.html">Course pixel art 4</a></li>
<li><a href="../242931/index.html">Alternative bug classification</a></li>
<li><a href="../242933/index.html">CERN plans to increase its computing capacity to 150,000 cores</a></li>
<li><a href="../242937/index.html">Windows Forms & Invoke from parallel threads</a></li>
<li><a href="../242939/index.html">Liskov Substitution Principle & Contracts</a></li>
<li><a href="../242943/index.html">Meteor. Developing a TODO List</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>