<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>First look at the new Cisco Firepower Threat Defense software (UPD 02.09.16)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr! Last fall, we shared with you the experience of implementing FirePOWER services on the Cisco ASA firewall. And in the New Year flashbacks...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>First look at the new Cisco Firepower Threat Defense software (UPD 02.09.16)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/849/8fb/8fd/8498fb8fdc5d463582bfd80f4d8c290b.jpg"><br><br>  Hello, Habr!  Last fall, we shared with you the <a href="https://habrahabr.ru/company/cbs/blog/270795/">experience of implementing FirePOWER services</a> on the Cisco ASA firewall.  And in the <a href="https://habrahabr.ru/company/cbs/blog/273737/">New Year flashbacks they</a> mentioned FirePOWER version 6.0, in which one of the main innovations was the management of all services using ASDM.  Progress in Cisco does not stand still, and this spring there was an announcement of the new <a href="http://www.cisco.com/c/en/us/products/collateral/security/firepower-4100-series/datasheet-c78-736661.html">Cisco Firepower 4100 and 9300</a> lineup.  These are, in fact, all the same modular ASAs, like the 5585-X, but with a new name (hello marketing department), more sophisticated, more productive and with the new centralized management software Firepower Threat Defense (FTD).  FTD can be launched not only on devices of the new model range, but also on all ASA 5500-X models, except for 5585-X (at least for the time being).  Just about this new software from Cisco and will be discussed in this article. <a name="habracut"></a><br><br>  A little background.  In FirePOWER version 5.4 everything was ‚Äúsimple‚Äù: there was a sensor located on the ASA SSD (either a separate piece of hardware or a virtual machine) and there was software for managing the FireSIGHT Management Center (also known as the Defense Center).  ASA had its standard IOS image with control through CLI / ASDM.  The sensor needed its own image, which was accessed through the same CLI ASA (or SSH to the mgmt port).  Well, access to FireSIGHT was carried out through a browser.  To this you need to add separate licenses + smart for ASA, separate subscriptions for the sensor and smart for FireSIGHT.  It goes without saying that such a distributed approach to managing all services did not suit many.  With the release of FirePOWER version 6.0, it is possible to manage all services using ASDM.  A number of restrictions imposed by the ASDM itself, the lack of a centralized distribution of policies across different sensors and several other features did not please everyone, so many still have to wait for a complete solution for centralized management of everything at once. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Gossip.</b>  <b class="spoiler_title">Gossip</b> <div class="spoiler_text">  Tsisk says that the development of a new ASDM for the Cisco ASA is in full swing and it will be written in HTML 5. It's time to go.  Thank. <br></div></div><br>  With the release of FTD, the centralized management received - one image on which the sensor software and Cisco ASA software is running.  Both are managed through the Firepower Management Center (FMC is the same FireSIGHT, the third name of the same one, please stop).  And everything would be fine, but if in the case of ASDM we received restrictions on FP services, then now we get restrictions on the functionality and configuration of the ASA.  The main limitation is the "not working" VPN.  And not that it does not work, it simply can not be set up by regular means.  Currently, neither Site-to-Site VPN, nor Remote access VPN can be configured. <br><br><div class="spoiler">  <b class="spoiler_title">About Site-to-Site VPN</b> <div class="spoiler_text">  In the case of Site-to-Site VPN, everything is rather ambiguous: in the <a href="http://www.cisco.com/c/en/us/td/docs/security/firepower/601/relnotes/firepower-system-release-notes-version-601.html">Release Notes to version 6.0.1,</a> it says in black and white: ‚ÄúDevices running Firepower does <b>n‚Äôt support VPN</b> functionality through Version 6.0.1 but it doesn‚Äôt support switching routing functions. ", But at the same time, in the <a href="http://www.cisco.com/c/en/us/td/docs/security/firepower/601/configuration/guide/fpmc-config-guide-v601.html">Configuration Guide for FMC 6.0.1</a> (in pdf format), it also says" <b>The Firepower Threat Defense appliance</b> provides a unified next-generation firewall and next-generation IPS device.  In addition to the IPS, there are <b>Site-to-Site VPNs</b> , firewall and network routing, firewalls, network routing, firewalls, firewalls, firewalls and firewalls.  I'm inclined to the release notes option, as attempts to set up a Site-to-Site VPN from FMC have failed. <br></div></div><br>  <b>FTD installation</b> <br><br>  An FTD image is available for installation on all ASA 5500-X and FP 4100/9300 platforms.  Not without virtual performance - vFTD, on the basis of which, further narration will be built. <br><br>  The first FTD image got version 6.0.1.  In order to be able to connect FTD to FMC, you need to upgrade FireSIGHT to version 6.0.1 (requirements for FMC do not differ from requirements for previous versions of the product).  The very process of preparing a virtual environment or Cisco ASA followed by the installation of an FTD image and its connection to FMC are described in detail in the Quick Start Guide ( <a href="http://www.cisco.com/c/en/us/td/docs/security/firepower/quick_start/vmware/ftdv/ftdv-vmware-qsg.html">VMware</a> , <a href="http://www.cisco.com/c/en/us/td/docs/security/firepower/quick_start/5500X/ftd-55xx-X-qsg.html">Cisco ASA</a> and just in case <a href="http://www.cisco.com/c/en/us/td/docs/security/firepower/quick_start/fp4100/ftd-4100-qsg.html">Firepower 4100</a> , <a href="http://www.cisco.com/c/en/us/td/docs/security/firepower/quick_start/fp9300/ftd-9300-qsg.html">Firepower 9300</a> ), so we will not dwell on it.  Moreover, this process for ASA and VMware is not much different from installing a separate FP sensor on these platforms.  In the end, the picture of the connected FTD (in our case vFTD) will look like this: <br><br><img src="https://habrastorage.org/files/ac8/1d4/0fc/ac81d40fcd7f431dab1ec1132b1118a3.png"><br>  <i>Figure 1 - Displaying vFTD in the FMC console</i> <br><br>  What you should pay attention to here: <br><br>  <b>1. Licensing</b> <br><br>  Licenses are now under the Smart License program - <s>another</s> new licensing scheme from Cisco. <br><br><div class="spoiler">  <b class="spoiler_title">Gossip.</b>  <b class="spoiler_title">Gossip</b> <div class="spoiler_text">  Tsisk says that in the <s>distant</s> future, this scheme will replace all traditional licensing schemes, including the recently appeared Cisco ONE scheme. <br></div></div><br>  The main message of this scheme is the automatic tracking of the subscription / license up to date by the device (the device itself periodically asks Cisco whether the installed license is relevant and whether the customized functionality meets the subscription conditions) and the ability to centrally manage all subscriptions / licenses via the Smart Software Manager portal created for it. <br><br><img src="https://habrastorage.org/files/d68/61e/5af/d6861e5af5a042acb8c38678044bdf2f.png"><br>  <i>Figure 2 - Smart Licenses for vFTD</i> <br><br>  <b>2. Routed Mode for Virtual FTD</b> <br><br>  Unlike the FP virtual sensor, vFTD can operate in routing mode.  This is understandable, because now inside FTD we have an ASA software image.  And in the case of virtualization, you need to run it on something, and this is something, of course, ASAv, and more specifically ASAv30.  During the vFTD boot process, the console continually replete with messages about the launch of ASAv, or even asks which image to load: <br><br><img src="https://habrastorage.org/files/7fa/f68/e70/7faf68e70a8d49a9868a7c0cf3ad909e.png"><br>  <i>Figure 3 - Loading vFTD.</i>  <i>Image selection for ASAv</i> <br><br>  By the way, the console at the time of loading vFTD is the only place where you can peek at the current licenses for the ASAv itself: <br><br><img src="https://habrastorage.org/files/da9/819/5b6/da98195b68974961ad67354fadbe1bda.png"><br>  <i>Figure 4 - ‚ÄúVPN Premium‚Äù license with activated 3des-aes and without Anyconnect</i> <br><br>  Since this is ASAv30, then with the installation of vFTD we get performance comparable to the iron ASA 5525-X, judging by the numbers in the vendor datasheets ( <a href="http://www.cisco.com/c/en/us/products/collateral/security/asa-5500-x-series-next-generation-firewalls/data-sheet-c78-729807.html">ASA 5500-X</a> , <a href="https://www.go2mhz.com/specimages/Cisco/ASAv-datasheet-c78-733399_MHz_5-15.pdf">ASAv</a> pdf).  Of course, it is not yet clear what the performance is there taking into account the functionality of the FP, but still nice. <br><br><div class="spoiler">  <b class="spoiler_title">Pro routed and transparent mode</b> <div class="spoiler_text">  According to the documentation, transparent mode is also available for FTD, but in the case of vFTD only the routing mode is available. <br></div></div><br>  <b>FTD Setup</b> <br><br>  The FTD setting can be divided into three points: <br><ol><li>  System settings. </li><li>  Routing settings. </li><li>  Setting subscription functionality (NGFW, NGIPS, AMP). </li></ol><br>  <b>System settings</b> <br><br>  These settings are configured / edited in the Devices tab -&gt; Platform Settings.  They look like this: <br><br><img src="https://habrastorage.org/files/a35/d18/d25/a35d18d25bb643ae8ef5cfdb1fc58bd9.png"><br>  <i>Figure 5 - Platform Settings for vFTD</i> <br><br>  In principle, it is clear from the names that he is responsible for what, so I‚Äôll dwell only on one thing: on a bunch of External Authentication + Secure Shell / HTTP. <br><br>  This bundle is needed so that we can get directly to the ASAv console.  You cannot create local accounts, so you must use either LDAP or RADIUS (External Authentication) for authentication.  Everything seems to be as usual: first, configure the authentication method, and then from which addresses, which interface and which protocol you can access.  And if everything is fine with SSH, then HTTP is apparently made "for the future."  HTTP on Cisco ASA is usually configured for access via ASDM, but in this case there is no ASDM image on ASAv and there are no options to load and configure it in the FMC, so we get that when accessing via the browser we have error 404, and when connecting via ASDM "Unable to launch device manager": <br><br><img src="https://habrastorage.org/files/8c5/578/561/8c557856197b4600a8fd96a2ba0eac2e.png"><br>  <i>Figure 6 - Connecting to FTD via HTTP</i> <br><br>  Having got to the console on SSH, first of all we watch show version: <br><br><img src="https://habrastorage.org/files/34e/15a/196/34e15a196ba04192a5647bb368a8675e.png"><br>  <i>Figure 7 - Show version via SSH</i> <br><br>  Here and information on the version of vFTD and software / hardware ASAv.  <s>Many</s> Having picked CLI a little, we come to the conclusion that it was created with the sole purpose - monitoring and troubleshooting.  Most of the standard commands from the <i>show</i> category are no different from the same commands for ‚Äúfull-fledged‚Äù ASAv / ASA.  There are commands <i>capture, packet-tracer, debug, test</i> , etc.  Configuration mode ( <i>conf t</i> ) is missing.  The only thing that can be configured from the <i>enable</i> mode is an <i>aaa-server</i> to authenticate users to the same CLI.  And then there are two options: either these are access restrictions for accounts, or such an ASAv image, although the name for it is quite standard ( <i>asa961-smp-k8.bin</i> ).  But still, carefully reviewing the output configuration, there is a tendency to the second option, but not without the participation of the first. <br><br>  <b>Routing Settings</b> <br><br>  As a matter of fact, this is the very same setting of the ASA functionality through FMC.  All settings are performed in two tabs: Devices -&gt; Device Management and in the Objects tab.  In the Objects tab, you can see the default settings for the ASA SLA, route-map, ACL and [AS path, community list, policy list] for BGP: <br><br><img src="https://habrastorage.org/files/4c6/fd8/301/4c6fd8301d50423f8561e8064bf21605.png"><br>  <i>Figure 8 - Components of classic ASA settings</i> <br><br>  All customizable ‚Äúobjects‚Äù in the Objects tab are created for the purpose of their further use by various policies, in particular, the policy applied to the device in the Device Management tab. <br><br><div class="spoiler">  <b class="spoiler_title">CLI Objects</b> <div class="spoiler_text">  It is worth considering the fact that even if the setting of one or another ‚Äúobject‚Äù is present in the FMC, but it is not used in any of the policies, then such an ‚Äúobject‚Äù will not be displayed in the CLI. <br></div></div><br>  Setting a policy in the Device Management tab includes: <br><br>  <b>1. Devices section.</b> <br><br>  Similar when setting up a separate FP sensor. <br><br><img src="https://habrastorage.org/files/589/547/cc2/589547cc26ff4515a521b0a335421c12.png"><br>  <i>Figure 9 - Devices Section</i> <br><br>  <b>2. Routing.</b> <br><br>  Static and dynamic ( <s>EIGRP</s> , OSPF, RIP, BGP, <s>Multicast</s> ).  Apparently, for the ability to configure BGP, it is worthwhile to thank version 9.6 (1) of the virtual ASA. <br><br><img src="https://habrastorage.org/files/4b7/fd8/524/4b7fd8524346446fb71f84b278eea986.png"><br>  <i>Figure 10 - Configure Routing</i> <br><br>  Here is an example of using the ‚Äúobject‚Äù SLA for a static route and its display in the CLI: <br><br><img src="https://habrastorage.org/files/32d/0b8/10f/32d0b810fee6479fb3e703736c049d01.png"><br>  <i>Figure 11 - SLA configuration example</i> <br><br>  <b>3. NAT.</b> <br><br>  Here, without nuances and restrictions, all variants of NAT rules are available. <br><br><img src="https://habrastorage.org/files/16c/e83/7e5/16ce837e580e487188b59f0b6ac87947.png"><br>  <i>Figure 12 - Setting translation rules</i> <br><br>  <b>4. Configuring interfaces.</b> <br><br><img src="https://habrastorage.org/files/941/ce4/573/941ce4573e434b249d0ebbf039b7ba9c.png"><br>  <i>Figure 13 - Interface settings</i> <br><br>  With interfaces, everything is quite standard, with the exception of one thing - the usual security-level cannot be defined, all interfaces come with a zero level of security.  But despite the fact that in the configuration there is no permission to pass traffic between the interface with the same security level ( <i>same-security-traffic permit inter-interface</i> ), everything works fine. <br><br><div class="spoiler">  <b class="spoiler_title">Resolution same-security-traffic inter-interface</b> <div class="spoiler_text"><pre><code class="python hljs">firepower<span class="hljs-comment"><span class="hljs-comment"># sh run inter g0/0 ! interface GigabitEthernet0/0 description inside interface nameif inside security-level 0 ip address 192.168.20.254 255.255.255.0 firepower# sh run inter g0/1 ! interface GigabitEthernet0/1 description outside interface nameif outside security-level 0 ip address 192.168.200.251 255.255.255.128 firepower# sh run same-security-traffic ^ ERROR: % Invalid input detected at '^' marker. firepower# sh run | i same firepower#</span></span></code> </pre> <br></div></div><br>  <b>5. Setting up inline sets.</b> <br><br>  <i>Tap mode</i> - instead of passing all traffic through the sensor, only a copy of the traffic will be sent to the sensor, respectively, active actions will not be applied to traffic.  But at the same time events (for example, IPS events) will be generated.  A kind of monitoring mode for traffic on a selected pair of interfaces (‚Äúspan mode‚Äù, when compared with a separate FP sensor).  <i>Propagate Link State</i> - bypass mode, we skip all traffic without checking, while if one of the interfaces in the pair is sent in the down state, then the same happens with the second one (as soon as the problematic interface returns to its up state, the second one rises automatically).  <i>Strict TCP Enforcement</i> - enable triple handshake control for TCP sessions.  Tap mode and Strict TCP Enforcement cannot be enabled at the same time. <br><br><img src="https://habrastorage.org/files/651/66b/375/65166b3754c04577b7637be4b554145d.png"><br>  <i>Figure 14 - Setting Inline Sets</i> <br><br>  <b>6. Configure the DHCP service.</b> <br><br>  In three options: DHCP server, DHCP relay and DDNS. <br><br><img src="https://habrastorage.org/files/828/1e8/522/8281e8522d88453e8df9bb6b4a18be0a.png"><br>  <i>Figure 15 - DHCP Setting</i> <br><br>  On this, perhaps, everything.  As for the parameters of the classic traffic inspection: they cannot be changed, although in the CLI they look quite standard with small additions in the form of ip options and additional options for tcp. <br><br><div class="spoiler">  <b class="spoiler_title">Classic Inspection Settings</b> <div class="spoiler_text"><pre> <code class="python hljs">firepower<span class="hljs-comment"><span class="hljs-comment"># sh run class-map ! class-map inspection_default match default-inspection-traffic ! firepower# sh run policy-map ! policy-map type inspect dns preset_dns_map parameters message-length maximum client auto message-length maximum 512 policy-map type inspect ip-options UM_STATIC_IP_OPTIONS_MAP parameters eool action allow nop action allow router-alert action allow policy-map global_policy class inspection_default inspect dns preset_dns_map inspect ftp inspect h323 h225 inspect h323 ras inspect rsh inspect rtsp inspect sqlnet inspect skinny inspect sunrpc inspect xdmcp inspect sip inspect netbios inspect tftp inspect icmp inspect icmp error inspect dcerpc inspect ip-options UM_STATIC_IP_OPTIONS_MAP class class-default set connection advanced-options UM_STATIC_TCP_MAP ! firepower# sh run tcp-map ! tcp-map UM_STATIC_TCP_MAP tcp-options range 6 7 allow tcp-options range 9 255 allow urgent-flag allow !</span></span></code> </pre><br></div></div><br>  <b>Setting subscription policies (NGFW, NGIPS, AMP)</b> <br><br>  All policies are configured in the same way as before.  The main thing to remember is to choose the necessary device when deploying them.  An interesting point is the NGFW (Access Control Policy) policies - all configured and applied rules can be viewed through the CLI.  In CLI, they are displayed as an ACL that has a specific name and at least a specific syntax: <br><br><img src="https://habrastorage.org/files/810/99e/c0c/81099ec0cede4c00924552571544e27d.png"><br>  <i>Figure 16 - Access Control Policy Rules.</i> <br><br>  And the main thing here is that such an ACL is applied globally ( <i>access-group CSM_FW_ACL_ global</i> ) and moreover the absence of the classical <i>deny any any</i> rule at the end of the ACL actually means its absence.  All traffic that does not fall under the rules created (including in the direction outside-inside) is processed by the ‚Äúdefault action‚Äù (Default Action, Figure 16).  Therefore, it is necessary to carefully consider the drafting of the rules in order to avoid a situation where all incoming traffic is allowed.  There were no nuances in the configuration of file policies or IPS policies. <br><br>  <b>Conclusion</b> <br><br>  At first glance, version 6.0.1 of FTD seemed <s>extremely</s> ‚Äúdamp‚Äù, but then it is also the first version, updates are not far off (at the time of writing this article there was an upgrade to version 6.0.1.1, which includes a number of bug fixes).  At the moment, it is impossible to transfer all the functionality of a classic ASA to a new platform and, of course, the absence of a VPN is especially confusing.  In any case, the ASA FTD solution is well suited for situations in which only FirePOWER functionality is needed.  In any other situations, you should still use the ‚Äúsplit‚Äù version of Cisco ASA with FirePOWER Services.  And for those who read to the end (or started from the end) and seriously thought about using such a solution (or maybe already using it), a small ‚Äúlife hack‚Äù is below the cut. <br><br><div class="spoiler">  <b class="spoiler_title">Site-to-Site VPN Cheats</b> <div class="spoiler_text">  You can configure the Site-to-Site VPN <s>crutch</s> .  We have SSH access and, yes, we cannot edit the configuration.  But we can download it - the <i>copy</i> command is available in full.  All we need is to unload the running-config, for example, on the tftp server and edit it, download it back.  All necessary lines for VPN can be added to the gap between the penultimate and last lines of the configuration file (Cryptochecksum and end): <br><br><pre> <code class="python hljs">Cryptochecksum:<span class="hljs-number"><span class="hljs-number">073</span></span>c34a024b2cff7f7303a5c888c2c61 crypto ikev1 policy <span class="hljs-number"><span class="hljs-number">10</span></span> authentication pre-share encryption <span class="hljs-number"><span class="hljs-number">3</span></span>des hash sha group <span class="hljs-number"><span class="hljs-number">2</span></span> lifetime <span class="hljs-number"><span class="hljs-number">86400</span></span> crypto ikev1 enable outside crypto ipsec ikev1 transform-set ESP-AES-SHA esp-aes<span class="hljs-number"><span class="hljs-number">-256</span></span> esp-sha-hmac access-list crypto-acl extended permit ip host <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.20</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span> host <span class="hljs-number"><span class="hljs-number">172.25</span></span><span class="hljs-number"><span class="hljs-number">.25</span></span><span class="hljs-number"><span class="hljs-number">.20</span></span> crypto map CMAP <span class="hljs-number"><span class="hljs-number">10</span></span> match address crypto-acl crypto map CMAP <span class="hljs-number"><span class="hljs-number">10</span></span> set peer <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.200</span></span><span class="hljs-number"><span class="hljs-number">.252</span></span> crypto map CMAP <span class="hljs-number"><span class="hljs-number">10</span></span> set ikev1 transform-set ESP-AES-SHA crypto map CMAP interface outside tunnel-group <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.200</span></span><span class="hljs-number"><span class="hljs-number">.252</span></span> type ipsec-l2l tunnel-group <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.200</span></span><span class="hljs-number"><span class="hljs-number">.252</span></span> ipsec-attributes ikev1 pre-shared-key <span class="hljs-number"><span class="hljs-number">123456</span></span> : end</code> </pre><br>  You need to load the prepared configuration with the command, with a clear indication of the location of the configuration file on FTD: <br><pre> <code class="python hljs">copy tftp system:running-config</code> </pre><br>  After the file is copied, the SSH connection is broken, you will need to reconnect and save the configuration ( <i>write memory</i> ).  By completing the appropriate configuration on the other side, we get a full-fledged, working Site-to-Site VPN. <br><br><img src="https://habrastorage.org/files/b5b/2b2/5b9/b5b2b25b94f843d39872dfd77a977797.png"><br><br>  And everything would be fine, but it would not be a ‚Äúcrutch‚Äù if it were not for one nuance: the <i>access-list created</i> for crypto cards created this way will be removed from the FTD configuration every time we apply <u>any</u> changes in the FMC console (we execute Deploy) .  In this situation, to our aid, comes the Embedded Event Manager (EEM), added to the ASA from version 9.2 (1).  In the same way as with the VPN configuration, we add to the EEM configuration: <br><pre> <code class="python hljs">event manager applet cryptoACL event timer watchdog time <span class="hljs-number"><span class="hljs-number">5</span></span> action <span class="hljs-number"><span class="hljs-number">0</span></span> cli command <span class="hljs-string"><span class="hljs-string">"access-list crypto-acl extended permit ip host 192.168.20.5 host 172.25.25.20"</span></span> action <span class="hljs-number"><span class="hljs-number">1</span></span> cli command <span class="hljs-string"><span class="hljs-string">"crypto map CMAP 10 match address crypto-acl"</span></span> output none</code> </pre><br>  This EEM will add every 5 seconds to the configuration the ACL we need.  It is also necessary to add the ACL binding command to the crypto map, since removing the ACL from the configuration also removes the binding.  Thus we get a fully functional VPN. <br><br>  In such an implementation, we can expect packet loss at the time of deploying policies from FMC to FTD: <br><br><img src="https://habrastorage.org/files/be2/e55/ca0/be2e55ca02c2421d88e5a86d775cfb73.png"><br><br>  A possible alternative to the <i>event timer</i> in EEM is to perform actions when a message appears in the logs with a specific id ( <i>event syslog id</i> ).  This option has not been tested, so I can‚Äôt say anything about its success (even in the case of a correctly selected id). <br></div></div><br>  <u><b>UPD (09/02/2016):</b></u> <br><br>  On August 29th, Tsisk released updates to version 6.1.  A complete list of updates, as usual, in the <a href="http://www.cisco.com/c/en/us/td/docs/security/firepower/610/relnotes/Firepower_System_Release_Notes_Version_610.html">Release Notes</a> on the official site. <br>  There are a lot of updates and all of them are <s>tasty and</s> pleasant.  Here are a few of them: <br><ol><li>  TS Agent for terminal servers (VDI Identity Support). <br>  It is now possible to recognize users behind the terminals.  The principle of operation is similar to how it works in Check Point ‚Äî allocating to each user its own range of ports.  I do not hint at anything, but <s>why not do this before?</s>  Well done anyway. </li><li>  Kerberos Authentication. <br>  Can help with Single Sign-On.  This was also expected, thank you. </li><li>  Rate Limiting. <br>  Now we can cut the bandwidth across networks, zones, users / groups, applications, ports and parameters received from ISE. </li><li>  Site-to-Site VPN. <br>  Now it should work without any cheats. </li><li>  Enhanced Virtualization Support. <br>  They waited for KVM, now it remains to wait for Hyper-V. </li></ol><br>  Everything looks cool, but we haven‚Äôt checked it in practice, so we cannot say anything about how things really are.  At least for now. </div><p>Source: <a href="https://habr.com/ru/post/304794/">https://habr.com/ru/post/304794/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304782/index.html">Work with Bluetooth LE from Java applications</a></li>
<li><a href="../304784/index.html">Typing the names of organizations</a></li>
<li><a href="../304786/index.html">Malicious software is used for cyber espionage over users in Central and Eastern Europe.</a></li>
<li><a href="../304788/index.html">A call from the browser: a tool for business?</a></li>
<li><a href="../304790/index.html">Error in PM error message is ineffective</a></li>
<li><a href="../304798/index.html">Everything you wanted to know about RAID controllers, but it was too lazy to look</a></li>
<li><a href="../304800/index.html">Bloom filter for web developers</a></li>
<li><a href="../304804/index.html">Comparison of online name resolution services</a></li>
<li><a href="../304806/index.html">Beginning the translation of the ‚Äúlegacy‚Äù of the Angular JS project to the Angular 1.5 Components / ES6 and TypeScript</a></li>
<li><a href="../304810/index.html">Mobile VR-game on the Unreal Engine: pitfalls</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>