<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Waiver of NFS in the cloud</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sorry for the long silence - a lot of work, big updates are coming. In the meantime, a little about the not very large, but very noticeable change for...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Waiver of NFS in the cloud</h1><div class="post__text post__text-html js-mediator-article">  Sorry for the long silence - a lot of work, big updates are coming.  In the meantime, a little about the not very large, but very noticeable change for our customers. <br><br>  We refuse to host kernel modules on NFS.  (And not only modules, but customers will notice exactly the change of storage location of modules). <br><br><h1>  How it was supposed to work </h1>  Client virtual machines are loaded using our kernels (that is, the kernel code is stored outside the virtual machine).  The kernels need modules in the process.  / lib / modules is mounted on NFS, the kernel itself determines from which directory to load which modules, it is easy for us to update them, the client is easy to access. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  As it turned out </h1>  First, the NFS balls are mounted later on the initialization of the network (this is obvious) after mounting all the other lines in fstab.  Even cooler - in the debian / ubuntu family, they are mounted asynchronously by default, so that a race condition is obtained with the launch of rc.local. <br><br>  Bottom line: pre-up scripts on interfaces do not work as expected, non-standard file systems from fstab are not mounted as expected.  Additionally, NFS is not the most reliable service (especially considering bug # 538000), in other words, inconvenient. <br><br><h1>  How this problem was solved </h1>  The modules are now on ISO's, connected to all virtual machines as a separate disk / dev / xvdp.  The modules are mounted immediately after the root has been mounted ('/') and make it easy to perform all subsequent operations (pre-up scripts, non-standard file systems, etc.). <br><br>  The mount line (fstab) looks the same for everyone: <br><pre> / dev / xvdp / lib / modules iso9660 ro 0 0
</pre><br>  By the way, this drive is not paid by customers. <br><a name="habracut"></a><br><h1>  Why in read only? </h1>  First, as already mentioned, it is one for all.  I don‚Äôt want your neighbor to put a special version of iptables on you, for example.  Secondly, the modules (like the core) are controlled by our control system.  Soon ... well, in the near future we will add the ability to choose which core to use, but the core will be from our list.  The reason is simple - there are a lot of not very stable kernels under xen.  This, for example, debian suffers.  Alas.  Moreover, some of the bugs will not be immediately visible - and we really wanted to avoid the need to answer questions about the stability of the cores that we did not choose.  Xen'an paravirtualization involves kernel cooperation when performing many operations (such as migration) - and abandoning this cooperation in the middle of the process can make the machine inoperative.  So the kernels get into the cloud only after a long and very boring test for all possible uses. <br><br><h1>  Can I load my own modules? </h1>  Yes you can.  Despite the fact that / lib / modules is mounted as readonly, you can load modules using insmod from anywhere.  The only "but" kernel, we sometimes update, in this case the modules supplied by us are updated.  And you have to rebuild the modules themselves.  Fortunately, updates are always obvious and ‚Äúaccidentally broke‚Äù will not happen. <br><br><h1>  Why iso9660? </h1>  This is the file system used on the CD (and ISO images) - for it the most natural is read only mode.  If we used ext3, then there would be a temptation to remount to rw (this could not be done and there would be a lot of errors).  The second reason is that iso9660 is ignored by OS installers during installation (no one will try to create a partition table there). <br><br><h1>  How to move from NFS to ISO </h1>  Simple script: <br><br><pre>  sed -i /109.234.152.2/d / etc / fstab
  echo "/ dev / xvdp / lib / modules iso9660 ro 0 0" &gt;&gt; / etc / fstab
  umount / lib / modules
  mount / lib / modules
</pre><br><br>  No reboot required. <br><br>  On new machines, the modules are mounted exactly as needed. <br><br>  Of course, you can not go, we will maintain the current configuration on the NFS as long as necessary (until the last machine with the old system of modules).  Those who switched to the new system can safely cut out any traces of NFS - it is no longer needed. </div><p>Source: <a href="https://habr.com/ru/post/117853/">https://habr.com/ru/post/117853/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117844/index.html">Hit print</a></li>
<li><a href="../117845/index.html">We invite you to participate in DEVCONF 2011 on June 4 (PHP, PERL, PYTHON, RUBY, .NET, JS)</a></li>
<li><a href="../117846/index.html">Opera Startup Awards begins!</a></li>
<li><a href="../117847/index.html">Do most Android users hate Apple?</a></li>
<li><a href="../117852/index.html">Version Control Systems as a Student Collaboration Tool</a></li>
<li><a href="../117854/index.html">Contactless charging for mobile devices</a></li>
<li><a href="../117855/index.html">Feelings like feedback</a></li>
<li><a href="../117857/index.html">Universal e-book reader from a computer monitor and from mobile devices</a></li>
<li><a href="../117858/index.html">A couple of ideas: Habrafold and the upgrade of the <source> tag</a></li>
<li><a href="../117859/index.html">UserEcho - from a catalyst of ideas to a full-fledged customer support service</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>