<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Plotter based on the Makeblock constructor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I learned about the Makeblock constructor after his kickstarter campaign ended. And it‚Äôs a pity, because there was a chance to purchase designer kits ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Plotter based on the Makeblock constructor</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ed1/11e/f76/ed111ef76da94ef19666a272e3e98c09.jpg" alt="Photo plotter"><br><br>  I learned about the <a href="http://habrahabr.ru/post/237079/">Makeblock</a> constructor after his <a href="https://www.kickstarter.com/projects/1397854503/makeblock-next-generation-of-construct-platform">kickstarter</a> campaign ended.  And it‚Äôs a pity, because there was a chance to purchase designer kits at a fairly low price.  After a successful campaign, the authors continued to develop their ideas and created a plotter for the plotter - <a href="http://www.makeblock.cc/xy-plotter-robot-kit-v2-0-with-electronic/"><nobr>XY-Plotter Robot Kit v2.0</nobr></a> .  It cost me $ 300 with free shipping via EMS as part of the "buy $ 500" promotion. <br><br>  I was interested in the plotter for two reasons: the ability to draw with a pen <a href="http://habrahabr.ru/post/205406/"><nobr>Circuit Scribe</nobr></a> with conductive ink and the ability to upgrade the plotter <a href="http://www.makeblock.cc/laser-engraver-upgrade-pack-500mw-for-xy-plotter-robot-kit-v2-0/">with a laser cutter</a> .  In this article I will tell about my impressions of the plotter in its original configuration. <br><a name="habracut"></a><br><h1>  Delivery </h1><br><div class="spoiler">  <b class="spoiler_title">Delivery Details</b> <div class="spoiler_text">  The plotter is sold in the form of a set "collect it yourself."  The weight of the package is a few kilograms, so delivery can be expensive.  But I found the Chinese service <a href="http://www.seeedstudio.com/depot/">Seeed</a> , which, when ordered for $ 500, is sent free of charge via DHL / EMS.  In addition to the plotter, I took from them a laser cutter, a <b>Raspberry Pi,</b> and a few shields for the <b>Arduino</b> , fitting into the indicated amount and convincing myself that in the future all this will definitely come in handy for me. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The package arrived about two weeks after placing the order in the form of a weighty and densely stuffed box of rough cardboard.  Inside, everything is in good condition, every detail is in some kind of wrapper, but on one of the frame supporting structures I found an unpleasant dent, which, however, did not affect the functionality of the part. </div></div><br><img src="https://habrastorage.org/files/ec4/ddf/bf7/ec4ddfbf7f1d4a7a819af116b9c27fcc.jpg" alt="Disassembled Makeblock Plotter"><br><br><h1>  Assembly </h1><br>  It took me at least 10 hours to assemble a plotter.  The build plan is contained in a <a href="https://github.com/Makeblock-official/XY-Plotter-2.0/blob/master/XY%2520Plotter%2520V2.0%2520Assembly%2520Instruction.pdf">PDF document</a> where the plotter takes on its appearance step by step.  With all the details of the instructions, sometimes it was necessary to disassemble and reassemble individual blocks when the understanding of their function came.  I recommend when building run a few pages ahead. <br><br><div class="spoiler">  <b class="spoiler_title">Build issues</b> <div class="spoiler_text">  The holes in the aluminum parts of the designer are shifted within a millimeter from their intended position, which led to problems in those places in which parts were assembled end-to-end.  I found two such places: right in the first step, when the screws fastening the frame, rested against each other;  and when attaching the stepper motor controller board, which could not get along with the plotter leg.  All this was solved, but in the place of the authors of the designer, I would not count on such accuracy in the shape of my parts. <br><br>  Once screwed in the sleeve.  The fact is that the sleeves are attached to the axis with small capless installation screws.  At the initial stage of assembly, it was not indicated that then these bushings should be displaced and aligned somewhere, so I tightened them well.  Later it turned out that the screw was stuck - the screwdriver slips and does not want to unscrew.  By the way, the material of the attached tools is the cheapest, the metal is soft.  I considered several solutions, from buying new items to pulling out a screw by twisting an even smaller left-handed screw.  The position was saved by a screwdriver made of harder steel. </div></div><br><div class="spoiler">  <b class="spoiler_title">Short video about plotter assembly (from the Internet)</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/peKdXvOAleI%3Ffeature%3Doembed&amp;xid=25657,15700023,15700186,15700190,15700253,15700255&amp;usg=ALkJrhhxavRbx8_ThbZa3h23oMv3ctZqaw" frameborder="0" allowfullscreen=""></iframe></div></div><br><br><img src="https://habrastorage.org/files/a4b/6ee/cb0/a4b6eecb0c154e1885a2ec321cdce6a3.jpg" alt="Assembled Makeblock Plotter"><br><br><h1>  Mechanics </h1><br><div class="spoiler">  <b class="spoiler_title">XY displacement principle</b> <div class="spoiler_text">  The working part of the plotter is a platform with a pencil, sliding along the guide axes.  To understand how this platform moves, take another look at the photo above. <br><br>  There are two stepper motors, one for each axis of movement.  With the help of transmission belts, fixed ends on the platform, the rotation of the engine axis is converted into a linear movement of the platform along the "rail". </div></div><br><div class="spoiler">  <b class="spoiler_title">The principle of lowering and raising the pencil</b> <div class="spoiler_text">  I understood the principle of lowering and raising the pencil only at the end of the assembly: <br><br><img src="https://habrastorage.org/files/1a5/e8f/2eb/1a5e8f2ebe534621b034f21b7033ec69.jpg" alt="Makeblock Plotter Pencil Platform"><br><br>  The pencil is rigidly attached to the bar, and the bar is attached to the axle.  The plank is divided by an axis into two shoulders - on one pencil, and on the other an elastic band is attached so that the plank presses the pencil to the paper.  The ‚Äúblade‚Äù of a servo has two working positions: a vertical one, in which the ‚Äúblade‚Äù raises the bar, preventing it from pressing the pencil against the paper, and a horizontal one, in which the ‚Äúblade‚Äù does not prevent the bar from pressing the pencil against the paper. <br><br>  There is a backlash along the axis of fastening of the strap, which leads to "shaking" of the lines.  I managed to remove it by adding the gum that presses the bar to the platform. </div></div><br><br><h1>  Electronics </h1><br><div class="spoiler">  <b class="spoiler_title">Electronic components and their connection</b> <div class="spoiler_text">  The control component of the plotter is a board based on the <b>Arduino Leonardo</b> .  Its feature is built-in support for a USB connection to a computer.  If <b>Arduino is</b> normally reset when a new serial connection with a computer is established, then the <b>Arduino Leonardo</b> saves its current state, which means you can connect to the plotter as many times as you like, keeping all the settings (first of all, zero in XY). <br><br>  The board has 8 RJ25 ports, through which the controllers of two stepper motors, a servo drive and four switches are connected in case the platform rests against the frame.  Power for stepper motors is supplied separately through the supplied power supply with an American plug. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91b/862/273/91b862273d34b72e8fcf4d04c86721af.jpg" alt="Electronic components of the Makeblock plotter"></div></div><br><div class="spoiler">  <b class="spoiler_title">Search for optimal microstep engines</b> <div class="spoiler_text"> While writing this article, I unexpectedly discovered that the plotter requires adjusting two parameters of the controllers of the stepper motors: the number of microsteps per step and the amperage determining the torque.  More about setting these parameters <a href="http://wiki.makeblock.cc/index.php%3Ftitle%3DMe_Stepper_Driver">here</a> , but not a word about this in the manual! <br><br>  <a href="http://www.micromo.com/microstepping-myths-and-realities">In theory,</a> an increase in the number of microsteps improves the smoothness of the lines and reduces noise, but also significantly reduces the torque of the engines.  I tried to compare the quality of the resulting image depending on the number of microsteps: <br><br><img src="https://habrastorage.org/files/b52/e02/3ae/b52e023aed0e42d0a2a6e848db717985.png" alt="Comparison of micro steps in a step"><br><br>  As you can see from this picture, the best quality is 1/8 and 1/4 steps.  Then it turned out that with a resolution of 1/8 step, one of the engines begins to slip and "lose" microsteps due to lack of torque.  Increasing the current to the maximum only improved the situation slightly, so the 1/4 step mode was the winner.  By the way, in the microstep mode the engine makes a lot less noise! <br><br><img src="https://habrastorage.org/files/bb6/30d/4d7/bb630d4d75894646937815b88cccd005.png" alt="Comparison of micro steps in a step"></div></div><br><br><h1>  Control </h1><br>  At the end of the assembly, the plotter control board must be programmed.  The program implements the translation of the so-called <a href="https://ru.wikipedia.org/wiki/G-code">G-code</a> , in which the commands for moving the pencil are written in text form. <br><br>  There are many editors to convert a vector image into a G-code, but the authors recommend using the <a href="https://inkscape.org/en/">Inkscape</a> cross-platform and free editor with the plugin installed to generate the G-code <a href="http://www.shapeoko.com/wiki/index.php/User:BHSPitMonkey/Inkscape_and_Gcodetools_Tutorial">Gcodetools</a> . <br><br>  To send the G-code to the plotter for execution, you need to connect to its control board via a USB cable and open a serial connection.  For Windows, this will be some <b>COM3</b> or <b>COM4</b> port, for MacOS this is something like <b>/dev/tty.usbmodem1421</b> <br><br><div class="spoiler">  <b class="spoiler_title">User interface</b> <div class="spoiler_text"><img align="left" src="https://habrastorage.org/files/782/a60/96f/782a6096f5fc403d932e07eb4210a31a.png" alt="Makeblock plotter control user interface">  The authors of the constructor wrote a Java program that opens the connection with the device and allows you to control the pencil with the arrow keys, set the zero position, set the axial resolution and send the G code written in the file. <br><br>  The program was originally designed for Windows, but after downloading the necessary library, it runs under MacOS. <br><br>  I found that sometimes the connection to the plotter hangs, so I wrote a Python script for this case, sending the G-code directly through the serial connection.  In this case, I use the Java program to set the starting point, then run the script. <br><br><br clear="left"><br><div class="spoiler">  <b class="spoiler_title">Python Script</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">############################################################################### import serial, re, time import sys, argparse SERIAL = "/dev/tty.usbmodem1421" parser = argparse.ArgumentParser(description = "G-code file sender") parser.add_argument("--input", help = "file to send", required = True) args = vars(parser.parse_args()) ############################################################################### def send(stream, command): if command[-1] != "\n": command += "\n" sys.stdout.write("&lt;= " + command) stream.write(command) while True: s = stream.readline() sys.stdout.write("=&gt; " + s) if s[0] != "#": break fin = open(args["input"]) stream = serial.Serial(SERIAL, 115200) send(stream, "$1 X8 Y12 Z21") send(stream, "$2 X11 Y13 Z9") send(stream, "$3 X22 Y19 Z22") send(stream, "$4 X23 Y18 Z23") send(stream, "$6 X88.0 Y88.0 Z40.0") # set axis resolution send(stream, "G90") send(stream, "G21") for s in fin: s = re.sub(r"\([^)]*\)", r"", s) if s.strip(): send(stream, s.strip()) fin.close() ###############################################################################</span></span></code> </pre> </div></div></div></div><br><div class="spoiler">  <b class="spoiler_title">Modification of the program</b> <div class="spoiler_text">  The program for the control board of the plotter perceives X, Y and Z as three axes, the movement along which is given in millimeters.  But the fact is that the Z axis is actually set by the angle of rotation of the servo!  In my case, 90 degrees means a lowered pencil, 60 degrees - raised.  As a result, from the point of view of the program, raising and lowering a pencil takes as much time as drawing a line at (90 - 60) =&gt; 30 mm!  The pencil goes down and waits, then draws a line, then rises and waits.  Not only is the image drawn longer (as if 30 mm are added to each continuous path), but idle marker or liner on paper adds thick points at the beginning of the path.  The program had to be modified by compressing the distances along the Z axis: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate_feedrate_delay</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> feedrate</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//how long is our line length? float distance = sqrt(delta_units.x*delta_units.x + delta_units.y*delta_units.y + delta_units.z*delta_units.z / 100.f); ... }</span></span></code> </pre> </div></div><br><br><h1>  Result </h1><br>  When I was about to launch the plotter to draw some visual pictures for this article, a serious fault was discovered: the lines of the drawing ceased to converge with each other.  It turned out that <a href="http://www.makeblock.cc/linear-motion-slide-unit-8mm-pair/">linear bearings</a> scratched the grooves on the <a href="http://www.makeblock.cc/linear-motion-shaft-d8x496mm/">guide axles</a> and began to slip from time to time.  I suspected that the axles should be lubricated, but I doubted, because there was not a word in the instructions about it.  So, the plotter now requires repair and lubrication. <br><br><div class="spoiler">  <b class="spoiler_title">Grease selection and repair</b> <div class="spoiler_text">  Judging by <a href="http://reprap.org/wiki/Lubrication">this</a> article, the best lubricant is Teflon-weighted oil.  It is produced in the United States under the brand name <a href="http://www.super-lube.com/synthetic-oil-with-ptfe-high-viscosity-ezp-56.html">Super Lube</a> .  In second place - synthetic gear oils (automotive?).  Until the Teflon lubricant arrived, I tried domestic machine oil, but it didn‚Äôt help much. <br><br>  I <a href="http://www.ebay.com/sch/i.html%3F_from%3DR40%26_trksid%3Dp2050601.m570.l1313.TR0.TRC0.H0.Xsc8uu%26_nkw%3Dsc8uu%26_sacat%3D0">ordered</a> replacement bearings on <a href="http://www.ebay.com/sch/i.html%3F_from%3DR40%26_trksid%3Dp2050601.m570.l1313.TR0.TRC0.H0.Xsc8uu%26_nkw%3Dsc8uu%26_sacat%3D0">eBay</a> for $ 2.55 apiece, six in total.  The guide axles turned out to be much more expensive, since they were made by special order, but I decided not to change them, but to turn them in order to move the grooves from the bearing tracks. </div></div><br>  The problem with the slip caused me to think about controlling the missed steps of the engine with a laser mouse.  Judging by the <a href="http://reprap.org/wiki/Bamboo_Printer">articles</a> found, this would be a very effective and beautiful way of solving the precise positioning of stepper motors. <br><br>  Finishing the article, I still take the risk and draw several pictures in a less accurate 1/2 step mode, without waiting for the components and lubrication.  Images are made with a liner with a line width of 0.3 mm <br><br><img src="https://habrastorage.org/files/254/b0a/91a/254b0a91af0540b682db02c29931e638.jpg" alt="Comparison of a plotter drawing with a ruler"><br><br><img src="https://habrastorage.org/files/efa/69c/378/efa69c3787e941ca8b05e3cd8cdc3eb8.png" alt="Sample plotter drawing: greeting"><br><br><img src="https://habrastorage.org/files/99e/0dd/7ae/99e0dd7ae16e494b9561607234362070.png" alt="Sample plotter drawing: labyrinth"></div><p>Source: <a href="https://habr.com/ru/post/247045/">https://habr.com/ru/post/247045/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247029/index.html">jQuery for mobile devices, all the pros and cons</a></li>
<li><a href="../247031/index.html">TorrentLocker - a new modification of the FileCoder cryptographer, part 2</a></li>
<li><a href="../247033/index.html">Hacker's guide to neural networks. Chapter 2: Machine Learning. More traditional approach: Loss functions</a></li>
<li><a href="../247039/index.html">How Iceland becomes a data center paradise</a></li>
<li><a href="../247041/index.html">VNC Roulette. Srsly?</a></li>
<li><a href="../247047/index.html">C #: Internal structure of array initializers</a></li>
<li><a href="../247049/index.html">em-dosbox and 50 gifts for the new year</a></li>
<li><a href="../247053/index.html">Sorting on a single-linked list in O (nlogn) time, at worst, with O (1) additional memory</a></li>
<li><a href="../247055/index.html">Adventures Tyzh-programmer. New Year's Eve Mood Post</a></li>
<li><a href="../247057/index.html">Samsung Introduces SE790C - Ultra WQHD 34-inch Curved Monitor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>