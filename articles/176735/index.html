<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating and storing database backup</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Regular backups are a sure way to save your important data. Anything can happen: from a fire in the data center to just a carelessly written and runni...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating and storing database backup</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/dbc/8d6/2a1/dbc8d62a1f76db57092f66b3fc81da21.png"><br><br>  Regular backups are a sure way to save your important data.  Anything can happen: from a fire in the data center to just a carelessly written and running script in your database.  To this must be prepared.  Although the probability of this is quite small, but the losses that can be incurred are enormous.  Therefore, the weight of this node in the decision tree will be significant, and therefore, you need to take care of backups as soon as possible. <br>  In this article we will describe how the collection and storage of backups in our system is organized. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  General approach </h4><br><br>  Our backup storage scheme is as follows: <br>  - Every day at midnight we make a full backup of the base; <br>  - every day at noon we make differential backups; <br>  - every 30 minutes we make backup transaction log. <br><br>  Thus, theoretically, in the worst case, Workzilla could lose data in 30 minutes, and on average in 15 minutes.  Which is very unpleasant, but still better than losing more or everything.  Of course, there are more reliable schemes, but what we use, I think, will suit many. <br>  We make backups on one of the specially designed disks and upload data to Amazon S3, which guarantees that the data will not be lost. <br><br><img src="https://habrastorage.org/storage2/763/bcd/2e9/763bcd2e927614357c678ee7f5671d88.jpg"><br><br><h4>  Automatic backups in MS SQL Server </h4><br><br>  MS SQL Server makes it easy to organize a backup scheme that fits your system.  We use the ‚ÄúMaintanance Plans‚Äù for this.  A new plan can be created using the built-in assistant or an intuitive plan designer.  More information about the creation of "Service Plans" can be found <a href="http://msdn.microsoft.com/ru-ru/library/ms187658.aspx">here</a> . <br>  In addition to creating the backup itself, you can run additional scripts to clean up the database, check it for data integrity, delete old backups so that the disk does not overflow, etc. <br>  An example of a ready plan for creating full backups is shown in the picture. <br><br><img src="https://habrastorage.org/storage2/3f7/8dd/d77/3f78ddd77878fa00ec1474bfa4b001ed.jpg">  " <br><br>  After the plan is created, you need to configure the appropriate work in the SQL Server Agent. <br>  To do this, make sure that the service is installed and running.  In the object inspector window, select SQL Server Agent -&gt; Jobs -&gt; right-click on your work and select Modify from the context menu. <br><br><img src="https://habrastorage.org/storage2/580/918/7ec/5809187ec44dd9cf8ffc1c1e04903e41.jpg"><br><br>  In the window that opens, you can view all the information about your work and change it if necessary.  Below is an example of a form for changing the schedule by which the selected work will be launched. <br><br><img src="https://habrastorage.org/storage2/a8e/d81/9d5/a8ed819d5487e9ea0ad0324dffbc3f11.jpg"><br><br><h4>  Download to Amazon S3 </h4><br><br>  Now backup copies of your database will be created according to the scenario that you described.  In the next step, it is important to take care that the backups are not lost, if something happens to your server, for example, the hard disk gets corrupted.  It‚Äôs safest to copy backup to another location.  This could be a server in another data center, some cloud storage or something else. <br>  We use Amazon S3 for this.  It guarantees that the data will not be lost, besides, this service is quite cheap. <br>  To synchronize the disk with our backups and S3, we use a simple samopisny utility in python.  It is launched using Task Scheduler, a built-in Windows utility.  The script runs every 30 minutes and, due to the small amount of backups of the transaction log, this procedure does not consume a lot of resources. <br>  If you decide to use Amazon S3, then you should remember about the 5 GB limit when downloading a file.  If you need to upload larger files, you will have to upload files in parts. <br><br><h4>  Do I need compression? </h4><br><br>  File sizes of backup copies of databases can have substantial volumes, and several problems can occur when uploading to another server: <br>  - outgoing traffic increases dramatically; <br>  - the network channel is clogged; <br>  - the number of I / O operations on the current disk increases. <br><br>  Backups can be compressed using various archivers (we recommend 7z). <br>  Thus, the problems described above are solved, but another one arises: a significant amount of CPU time is required to compress the file. <br><br>  You have to decide which option is preferable for you.  In the case of Workszilla, we do not compress backups. <br><br><h4>  What you need to remember </h4><br><br>  We recommend setting up a system that will periodically check whether all your backup processes are working correctly.  We at Workzill use Nagios.  It is better to configure it on a separate server inside the local network.  From what needs to be checked, I highlight the following: <br>  - whether SQL Agent is running; <br>  - whether new files appear on S3; <br>  - time to create the latest backups; <br>  - Is there enough disk space with backups? <br><br>  For those who are very concerned about the security of their data, you can archive backups with a password.  Now, if backup somehow falls into the hands of intruders, it will be problematic for them to get data. <br><br>  If backup will be used in the future only by developers, then it is recommended to delete / replace critical data.  We do this with password hashes, emails and other personal information of users. <br><br>  Again, having backups is very important.  But we hope that they will not be useful to you. </div><p>Source: <a href="https://habr.com/ru/post/176735/">https://habr.com/ru/post/176735/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../176719/index.html">Setting the environment for building and testing the application in a closed perimeter</a></li>
<li><a href="../176721/index.html">EasyMapping, or JSON Journey</a></li>
<li><a href="../176723/index.html">Google will change the appearance of search results for Europe, "give odds" to competitive services</a></li>
<li><a href="../176725/index.html">Work in PHP with Tokenizer</a></li>
<li><a href="../176727/index.html">Railway physics engine</a></li>
<li><a href="../176739/index.html">Development of MiniFilter driver</a></li>
<li><a href="../176741/index.html">Finding the fundamental matrix "for dummies"</a></li>
<li><a href="../176749/index.html">Programmatic placement of coefficients in chemical equations</a></li>
<li><a href="../176751/index.html">Nontrivial task with callback + DID in Asterisk</a></li>
<li><a href="../176759/index.html">Small storage for small files</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>