<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Epidemic of the Petya blackmailer virus: what you need to know</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Following the massive WannaCry attacks last month, a major incident with a blackmailer program, called NotPetya, is currently developing. In the morni...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Epidemic of the Petya blackmailer virus: what you need to know</h1><div class="post__text post__text-html js-mediator-article">  Following the massive WannaCry attacks last month, a major incident with a blackmailer program, called NotPetya, is currently developing.  In the morning, researchers assumed that this program was a variant of the Petya blackmailer virus, but Kaspersky Labs and other companies reported that despite their similarity, in fact it was #NotPetya.  Regardless of his name, that's what you should know. <br><br>  This malicious program not only encrypts data for the ransom demand, but also seizes computers and completely blocks access to them by encrypting the master boot record. <br><a name="habracut"></a><br>  Petya uses another fast-moving attack that, similarly to WannaCry, exploits the vulnerability of the ENTERNALBLUE NSA classification.  Unlike WannaCry, the Petya virus can also spread through Windows Management Instrumentation (WMI) and PsExec (more on this below).  Some frightening facts about this new malware: <br><br><ul><li>  it does not have a remote emergency switch, as in WannaCry; </li><li>  it is much more complicated and has a variety of automatic distribution methods; </li><li>  it makes computers completely unusable. </li></ul><br>  Several well-known organizations and companies have already been seriously affected, including the Ukrainian government, which has shown a healthy sense of humor. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Infections were reported around the world: metro systems, national utilities, banks and international corporations were attacked: the scope is still unknown, but reports of infected computers and blocked IT systems in various industries around the world continue to be reported. <br><br><h2>  How does the Petya virus spread? </h2><br>  At first, it was considered that the Petya virus should use a clue in corporate networks received via e-mail messages with an infected attachment in the form of a Word document, which uses the CVE-2017-0199 vulnerability.  (If you installed patches for Microsoft Office, you must be protected from this attack.) <br><br>  Although phishing is often used for attacks, in this case MeDoc, a financial software firm based in Ukraine, has become one of the main sources.  The MeDoc software update feature was hacked, and the attackers used it to distribute the Petya blackmailer (source).  This explains why Ukraine suffered the most. <br><br>  After infecting one computer, the Petya virus spreads through a peer-to-peer network to other computers and servers running Windows with an unclosed MS17-010 vulnerability (this is an SMB vulnerability that was recommended for everyone to be eliminated during the WannaCry attack).  It can also be distributed through the PsExec mechanism to admin $ resources even on computers with patches installed.  We recently wrote a detailed tutorial about PsExec and about disabling PowerShell.  Here it will be useful. <br><br>  The positive point, at least in this state of affairs, is that the peer-to-peer network infection does not seem to go beyond the local network.  The Petya virus can effectively move across the entire local network, it can hardly move to other networks.  According to @MalwareTechBlog, a pizza-loving Internet user who became famous for finding the WannaCry safety switch: <br><br>  <i>Petya's current attack is different in that its exploitation tools are used only for distribution on the local network and not on the Internet (that is, it is very unlikely to become infected if your computer is not on the same network as the infected computer).</i>  <i>Assuming that the size of the networks is limited and they can be checked quickly enough, the spread of malicious software will stop after checking the local network.</i>  <i>Therefore, there is no danger here, as in the case of the WannaCry virus, which still continues to spread (although I have already prevented its activation with the help of an ‚Äúemergency switch‚Äù).</i> <br><br>  PsExec Detection Order with <a href="https://www.varonis.com/ru">DatAlert</a> <br><br>  If you have DatAlert version 6.3.150 or later, you can detect the PsExec.exe file on Windows file servers as follows: <br><br>  1. Select Tools -&gt; DatAlert -&gt; DatAlert <br><br><img src="https://habrastorage.org/web/a42/c67/a6e/a42c67a6edb8453c87728cd1485d9e3f.jpg"><br><br>  2. Search for the system admin string. <br><br><img src="https://habrastorage.org/web/393/af2/ade/393af2ade5f04be887b75fd6156b39e5.jpg"><br><br>  3. For each of the selected rules (expand the groups to view), click Edit Rule and check the box Enabled <br><br><img src="https://habrastorage.org/web/ec2/c46/e50/ec2c46e50adc431587b3df6b76b7fb7b.jpg"><br><br>  If PsExec is detected, DatAlert will create alerts for system administrator tools in the Reconnaissance alert category, for example, the System administration tool created or modified or the operation failed in the tool that failed. usually used by system administrators). <br><br>  This should help detect if the Petya virus uses the PsExec mechanism for distribution to file servers.  Continue to read this article, because there are not all actions that will help prevent initial infection and stop the spread of Petya virus to your endpoints. <br><br><h2>  What does the Petya virus do? </h2><br>  After the appearance of the NotPetya virus on the computer, it waits for an hour and a half before the start of the attack, most likely, this time is allocated for infecting other machines and making it difficult to find the entry point. <br><br>  At the end of the waiting time, the following occurs. <br><br>  1. It encrypts the main table of files on local NTFS media. <br>  2. It copies itself to the master boot record of the infected workstation or server. <br>  3. Forces the computer to reboot to block users. <br>  4. Displays a lock screen with a ransom demand at boot (shown below). <br>  <i>All computers in the office are not working.</i>  <i>Global attack #Ransomware.</i>  <i>I heard that several other companies were also attacked.</i>  <i>Make backups and take care of yourself.</i>  <i>pic.twitter.com/YNctmvdW2I</i> <i><br><br></i>  <i>- Migir (Mihir, @mihirmodi) June 27, 2017</i> <br><br>  By encrypting the main file table, the computer is disconnected from the network until the required amount is paid.  This could potentially harm the organization much more than encrypting some files on the server.  In most cases, IT staff must work individually with each computer;  The standard response to the blackmailers ‚ÄúWe will just restore these files from a backup copy‚Äù was ineffective. <br><br>  If there are no processes for remote boot or image creation, and it is impossible to recover infected computers, then you may need to manually restore the workstations to correct the situation.  Although in most cases this is possible, for companies with many remote installations it will be very difficult and time consuming.  For transport companies that have 600 or more cargo ships on board at any one time, this is almost impossible. <br><br>  As noted by Microsoft: ‚ÄúOnly if there are maximum rights (for example, when the SeDebugPrivilege parameter is enabled) the virus tries to overwrite the master boot record code‚Äù - if the infected user does not have administrator rights on the computer, the virus will try to encrypt user data with the following permissions. <br><br><img src="https://habrastorage.org/web/775/f42/5ee/775f425eec874f13a19aec31e57c7322.jpg"><br><br>  It does not add a unique extension to encrypted files (for example, .locky) - it encrypts the contents and preserves the original file name and extension. <br><br><h2>  What to do? </h2><br>  Prevention of Petya virus infection is very similar to the actions that could have been taken earlier in relation to the WannaCry attack: <br><br><ul><li>  disabling SMBv1 during patch installation; </li><li>  blocking TCP port 445 from external connections (or connections between segments, if possible); </li><li>  installing patches! </li></ul><br><h2>  Local safety switch </h2><br>  There is also some semblance of a local safety switch.  If the% WINDIR% \ perfc file (without the extension) exists on this computer, the blackmailer will not be executed.  You can be resourceful in deploying this file to all workstations in your environment. <br><br>  In addition, you can see which antivirus products for endpoints can detect the Petya virus in the VirusTotal scan results. <br><br>  A sample of the Petya virus, obtained by the researchers, was compiled on June 18th. <br><br><img src="https://habrastorage.org/web/44c/50d/ffb/44c50dffb27c4de5a5039c0f30d0834e.png"><br><br><h2>  Should I pay? </h2><br>  The blackmailer program message indicated a Posteo account (email service provider).  The Complaints and Security department of Posteo posted the <a href="https://posteo.de/blog/info-zur-ransomware-petrwrappetya-betroffenes-postfach-bereits-seit-mittag-gesperrt">following update</a> . <br><br>  They did the following. <br><br>  1. Blocked this account. <br>  2. Confirmed that no decryption keys were sent from the account. <br>  3. Appealed to the authorities with the offer of assistance by all available means. <br><br>  All this leads us to the conclusion that you should not pay the required amount, since you will not receive the necessary decryption keys. <br><br>  The story continues to evolve, and we will update this note as new information becomes available. </div><p>Source: <a href="https://habr.com/ru/post/337186/">https://habr.com/ru/post/337186/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337176/index.html">According to Rambler.iOS # 9</a></li>
<li><a href="../337178/index.html">How to stop worrying and start talking</a></li>
<li><a href="../337180/index.html">Differences Postgres Pro Enterprise and PostgreSQL</a></li>
<li><a href="../337182/index.html">Greetings to Yandex developers</a></li>
<li><a href="../337184/index.html">Current data on the telephone codes of Russian cities</a></li>
<li><a href="../337188/index.html">7 rules of good tone when writing Unit tests</a></li>
<li><a href="../337190/index.html">CaptureManager SDK</a></li>
<li><a href="../337192/index.html">Experience of raising IP telephony in the hotel</a></li>
<li><a href="../337194/index.html">Climbing an Unbowed Mountain: The Difficulties of Creating a Game Alone</a></li>
<li><a href="../337196/index.html">Another git tutorial</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>