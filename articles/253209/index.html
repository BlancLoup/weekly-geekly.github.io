<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bash Booster - SCM tool on a clean bash</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For management of servers, professional administrators have long used such SCM systems as Chef, Ansible, SaltStack, etc. These tools help centrally ad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bash Booster - SCM tool on a clean bash</h1><div class="post__text post__text-html js-mediator-article">  For management of servers, professional administrators have long used such <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BD%25D1%2584%25D0%25B8%25D0%25B3%25D1%2583%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D1%2583%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5">SCM</a> systems as Chef, Ansible, SaltStack, etc.  These tools help centrally administer a large fleet of servers.  To manage a single server, the effort to install and configure such a tool often exceeds the gain from its use.  In this case, the ‚Äúyes to him‚Äù approach is often used; I will write a script on a bash faster ‚Äù.  The approach is quite popular, so I would like to introduce you to the lightweight SCM tool, which does not require anything other than the good old bash, and can quite successfully be used to configure one server. <br><a name="habracut"></a><br>  So, Bash Booster is a library that helps you write <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25B4%25D0%25B5%25D0%25BC%25D0%25BF%25D0%25BE%25D1%2582%25D0%25B5%25D0%25BD%25D1%2582%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C">idempotent</a> bash scripts for setting up servers and scanning applications.  It was written under the impression of Chef and for use with Vagrant, although the scope is not limited to this.  It requires nothing but a bash, standard utilities and, in some cases, python (which is also installed on any Linux system out of the box).  Those.  quite suitable for running on a completely naked car without additional training. <br><br>  Let's look at a live example.  I will use <a href="https://www.vagrantup.com/downloads.html">Vagrant</a> for the demonstration.  The example sources are on <a href="https://bitbucket.org/kr41/bash-booster-demo/src">Bitbucket</a> , where all steps are designed as separate commits. <br><br>  So, suppose we have a server with Linux Ubuntu 14.04, on which you need to install nginx and configure it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Create an empty directory, and in it Vagantfile: <br><br><pre><code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- mode: ruby -*- # vi: set ft=ruby : VAGRANTFILE_API_VERSION = "2" Vagrant.configure(VAGRANTFILE_API_VERSION) do |config| config.vm.box = "ubuntu/trusty32" config.vm.network :forwarded_port, host: 8080, guest: 80 end</span></span></code> </pre> <br><br>  And execute the command: <br><br><pre> <code class="bash hljs">$ vagrant up</code> </pre><br><br>  Vagrant will create and start a virtual machine with a clean system (you may have to wait while it downloads the image).  In addition, it will mount the current directory of the host system to the / vagrant point, i.e.  we can access the files from our example inside the virtual machine.  You can check it out: <br><br><pre> <code class="bash hljs">$ vagrant ssh $ ls /vagrant Vagrantfile $ <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><br>  Next, download the <a href="https://bitbucket.org/kr41/bash-booster/downloads">Bash Booster</a> archive and unpack it into bashbooster-0.3beta (0.3beta is the current version at the time of this writing).  We will also correct the Vagrantfile by specifying the configuration script: <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- mode: ruby -*- # vi: set ft=ruby : VAGRANTFILE_API_VERSION = "2" Vagrant.configure(VAGRANTFILE_API_VERSION) do |config| config.vm.box = "ubuntu/trusty32" config.vm.provision :shell, inline: "/vagrant/provision.sh" config.vm.network :forwarded_port, host: 8080, guest: 80 end</span></span></code> </pre><br><br>  This preparation is completed and you can proceed to the most interesting.  Create a provision.sh script: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env bash #   CDPATH,     #    cd unset CDPATH #      ,    cd "$( dirname "${BASH_SOURCE[0]}" )" ## #  Bash Booster ## BB_LOG_USE_COLOR=true #     source bashbooster-0.3beta/bashbooster.sh #  nginx bb-apt-install nginx</span></span></code> </pre><br><br>  Now mark the script as executable: <br><br><pre> <code class="bash hljs">$ chmod a+x provision.sh</code> </pre><br><br>  And run the configuration of our server: <br><br><pre> <code class="bash hljs">$ vagrant provision</code> </pre><br><br>  The following lines will appear in the logs: <br><br><pre> <code class="bash hljs">bb-apt [INFO] Updating apt cache bb-apt [INFO] Installing package <span class="hljs-string"><span class="hljs-string">'nginx'</span></span></code> </pre><br><br>  What does it mean?  In fact, our script executed: <br><br><pre> <code class="bash hljs">$ apt-get update $ apt-get install nginx</code> </pre><br><br>  You can go to <a href="http://localhost:8080/">http: // localhost: 8080</a> in the browser to see the standard welcome message ‚ÄúWelcome to nginx!‚Äù Now, if you run vagrant provision again, the script will work almost instantly, because the bb-apt-install function does nothing, The requested package is already installed. <br><br>  Let's now create the www directory with the index.html file: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Bash Booster Rocks!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  And configure nginx, that he would give the files from this directory.  To do this, create a nginx-default-site configuration in the conf directory: <br><br><pre> <code class="bash hljs">server { root /vagrant/www; index index.html; }</code> </pre><br><br>  And we will add configuration synchronization to script provision.sh: <br><br><pre> <code class="bash hljs">bb-event-on <span class="hljs-string"><span class="hljs-string">"nginx-updated"</span></span> <span class="hljs-string"><span class="hljs-string">"on-nginx-updated"</span></span> on-nginx-<span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updated</span></span></span></span>() { service nginx restart } bb-sync-file \ /etc/nginx/sites-available/default \ conf/nginx-default-site \ nginx-updated</code> </pre><br><br>  And now we execute the configuration command: <br><br><pre> <code class="bash hljs">$ vagrant provision</code> </pre><br><br>  The logs will appear: <br><br><pre> <code class="bash hljs"> * Restarting nginx nginx ...<span class="hljs-keyword"><span class="hljs-keyword">done</span></span>.</code> </pre><br><br>  Turning to <a href="http://localhost:8080/">http: // localhost: 8080</a> , instead of the standard nginx greeting, you can see the indecently large ‚ÄúBash Booster Rocks!‚Äù Inscription from the previously created file. <br><br>  How it works?  The bb-event-on function signs the on-nginx-updated function on the nginx-updated event.  The bb-file-sync function synchronizes the local copy of the nginx configuration with its current version.  If there were changes, then this function raises the nginx-updated event, according to which its handler will restart nginx.  Try to perform vagrant provision again, and it will work without rebooting nginx.  If you make changes to nginx-default-site, then nginx will be rebooted.  Thus, we have a compact idempotent script that does exactly what you need and no more. <br><br>  Of course, not all features of Bash Booster are described here, but for the first acquaintance it is quite enough.  Full documentation is available at <a href="http://www.bashbooster.net/">www.bashbooster.net</a> . </div><p>Source: <a href="https://habr.com/ru/post/253209/">https://habr.com/ru/post/253209/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../253191/index.html">How to facilitate hosting clients to create private networks and virtual servers: 1cloud project experience</a></li>
<li><a href="../253193/index.html">Expand linux working image with minimal interactivity</a></li>
<li><a href="../253199/index.html">QIWI terminals. Alternative way</a></li>
<li><a href="../253201/index.html">Unloading the conditions of public procurement contests with the EP. Zakupki.gov.ru</a></li>
<li><a href="../253207/index.html">Simple PHP complex HTML table generator</a></li>
<li><a href="../253211/index.html">Why I don‚Äôt dislike Git: hidden integrity</a></li>
<li><a href="../253213/index.html">Device and operation of input / output ports of AVR microcontrollers. Part 1</a></li>
<li><a href="../253217/index.html">Meet Envoyer.io (Part 1)</a></li>
<li><a href="../253223/index.html">Charting and graphing with Doxygen</a></li>
<li><a href="../253225/index.html">MailChimp UX Team: Design [Part 4 of the Book]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>