<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Control over cloud infrastructure in one-two-three</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few months ago, Positive Research conducted a Citrix XenServer security review. Among other things , we studied the security of administration inter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Control over cloud infrastructure in one-two-three</h1><div class="post__text post__text-html js-mediator-article">  A few months ago, Positive Research conducted a <a href="http://www.citrix.com/English/ps2/products/product.asp%3FcontentID%3D683148">Citrix XenServer</a> security review.  Among <a href="http://habrahabr.ru/company/pt/blog/140886/">other things</a> , we studied the security of administration interfaces, and in particular the web interfaces of various system components.  As a result, we were able to detect several critical vulnerabilities that allow us to gain control not only over these components, but also over the master server, and therefore over the entire cloud infrastructure.  We immediately reported the found vulnerabilities to Citrix.  After the gaps were closed ( <a href="http://support.citrix.com/article/CTX128167">[1]</a> , <a href="http://support.citrix.com/article/CTX132219">[2]</a> , <a href="http://support.citrix.com/article/CTX132476">[3]</a> ), the results were presented on the <a href="http://phdays.ru/">Positive Hack Days</a> forum within the FastTrack section. <br><a name="habracut"></a><br>  So let's get down to business. <br>  In the analysis, three components of Citrix XenServer came to our attention: <br><br>  1. Web Self Service - web-based virtual machine management console; <br>  2. vSwitch Controller - web-based virtual network management console <br>  infrastructure; <br>  3. License Administration Console - XenServer license management service. <br><br>  The latest XenServer version (6.0.0) was tested at the time of the study. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Web Self Service </h4><br>  This component is a web-based virtual machine management console. <br>  As in all other modules, we found a ‚Äústandard set‚Äù of web vulnerabilities: <br><ul><li>  cross-site request substitution (CSRF); </li><li>  cross-site scripting (stored XSS); </li><li>  URL redirection abuse (URL redirector abuse); </li><li>  HTTP response splitting. </li></ul><br>  All forms of the application were susceptible to CSRF, filtering many fields was insufficient and made possible stored XSS.  In addition, on the login page, we found a very ‚Äúuseful‚Äù parameter that allows abuse of URL redirection and splitting of the HTTP response.  The video shows an automated exploit action that receives a cookie. <br>  administrator using the first three vulnerabilities, and then "covers the tracks." <br><br><ol><li>  First, by abusing URL redirection, we direct the administrator to the page we control. </li><li>  The script on this page, using CSRF, creates a new account in the system.  In the username field there is a stored XSS vulnerability.  With it, we embed a useful JavaScript-load on the page with a list of users and redirect the administrator there. </li><li>  The embedded JavaScript code sends the administrator's cookie to our server, and then deletes the newly created account. </li></ol><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/rAuXJQ7p-Z0%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253,15700255,15700259&amp;usg=ALkJrhh7gP2gZA3esZhY-9u1gLR9d_OJ3A" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  vSwitch Controller </h4><br>  This component was the most interesting.  The following vulnerabilities have been discovered here: <br><ul><li>  cross-site request substitution (CSRF); </li><li>  URL redirection abuse (URL redirector abuse); </li><li>  HTTP response splitting; </li><li>  insufficient authorization (Insufficient Authorization). </li></ul><br>  The vSwitch Controller web interface uses the REST API to communicate with the server.  This means that in response to each user action an HTTP request is formed.  Depending on the privileges, the user is allowed or not allowed to execute the corresponding requests. <br><br>  Among other things, the vSwitch controller web interface allows the administrator to create complete system configuration snapshots.  These images should be available for download only to privileged users.  However, as it turned out, a user with ‚Äúread only‚Äù rights can also download a snapshot by manually creating a request to the REST API of the service: <br><br> <code>GET /ws.v1/nox/snapshot/&lt;snapshot-uuid&gt;/export</code> <br> <br>  Replace &lt;snapshot-uuid&gt; with the ID of the snapshot to download. <br>  A list of all images and their identifiers can be obtained by sending a request: <br><br> <code>GET /ws.v1/nox/snapshot/</code> <br> <br>  The snapshot contains all the vSwitch controller settings, vSwitch Controller user credentials (names and password hashes), server SSL certificate along with the private key, and the credentials of the privileged user of the master server in clear text.  Using these credentials, you can connect over SSH to the main XenServer server and gain control over the entire XenServer infrastructure.  After such access is obtained, the attacker's capabilities are limited only by his own imagination. <br><br>  The described vulnerability is in itself difficult to exploit, because it requires the privileges of a user with read-only rights.  However, here comes the CSRF vulnerability, which allows you to create the necessary account with a known password (we need to force the administrator to follow the phishing link) imperceptibly to the victim administrator. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/n0LGyi7Wcy8%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253,15700255,15700259&amp;usg=ALkJrhiNg7k57AzHezvCrjfSj3WX-1HFOw" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  License Administration Console </h4><br>  This component is designed to manage licenses and relies on the free license manager <a href="http://www.globes.com/support/fnp_utilities_download.htm">lmadmin</a> from Flexera Software.  We managed to detect the following vulnerabilities: <br><ul><li>  substitution of content (Content Spoofing); </li><li>  cross-site scripting (stored XSS); </li><li>  cross-site request substitution (CSRF); </li><li>  Denial of Service. </li></ul><br>  After wandering through the links, you can find that the home page of the site has an interesting GET-parameter admin, which defines the address of the link leading to the administrative section.  The value is filtered in such a way that a full-fledged XSS attack is impossible, but there is nothing to "slip" the link to an arbitrary resource.  Denial of service can be done by sending a single HTTP request, in <br>  where one of the parameters is transmitted as an array, for example: <br><br> <code>?admin[]=blah</code> <br> <br>  In this case, the attacker is not required to be authorized in the system.  The reason is an unhandled exception in the case of passing an array as a script parameter.  Therefore, it was not possible to achieve the execution of arbitrary code by exploiting this vulnerability. <br><br>  It is worth noting that in the last at the time of the study version of lmadmin <br>  these vulnerabilities were gone. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/_yRePZ0beAM%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253,15700255,15700259&amp;usg=ALkJrhiLcUlHyHSxPWJeWuaCsUojTJKQuA" frameborder="0" allowfullscreen=""></iframe><br><br>  Summing up, we can conclude: one should not ignore non-critical vulnerabilities according to the degree of risk.  In practice, when using several simple vulnerabilities in the aggregate, it is possible to conduct an attack, as a result of which an attacker will gain complete control over the system.  Such scenarios were successfully implemented far more than once (including during penetration tests). <br><br>  No product is immune from errors;  vulnerabilities have always been and will not disappear anywhere.  And it‚Äôs good if manufacturers quickly respond to reports of vulnerabilities and promptly release corrections, as happened in this case - but, unfortunately, this is not always the case. <br><br>  However, risks can always be minimized.  Almost all of these gaps can be eliminated by taking additional measures to restrict access to the XenServer administration interfaces.  In addition, the trigger for many of these vulnerabilities may be the simplest CSRF attack.  As it is sung in one famous song: ‚ÄúWatch for yourself, be careful,‚Äù especially when it comes to suspicious links. </div><p>Source: <a href="https://habr.com/ru/post/147478/">https://habr.com/ru/post/147478/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147473/index.html">20 best iOS and Android applications 2012</a></li>
<li><a href="../147474/index.html">Data Center for Increased Responsibility: Photo Excursion</a></li>
<li><a href="../147475/index.html">New approach to contactless interface design</a></li>
<li><a href="../147476/index.html">Chrome 21 beta: interaction with webcams, microphones and game controllers</a></li>
<li><a href="../147477/index.html">A prototype of a smartphone on Firefox OS is shown.</a></li>
<li><a href="../147481/index.html">Dropbox and offer for HTC Android owners</a></li>
<li><a href="../147482/index.html">CCV: Modern Computer Vision Library</a></li>
<li><a href="../147483/index.html">Video review laptop Lenovo IdeaPad Yoga</a></li>
<li><a href="../147484/index.html">Send an application to the State Duma on the bill ‚Ññ89417-6</a></li>
<li><a href="../147485/index.html">Nokia has transferred MeeGo patents to Jolla (UPD)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>