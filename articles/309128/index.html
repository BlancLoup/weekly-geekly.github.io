<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automating the maintenance of correspondence between the names of layers in the editor and code using CodeDom</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When working with Unity, it is often necessary to refer to Unity entities (collision layers, sorting layers, tags, input axes, scenes) by their names....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automating the maintenance of correspondence between the names of layers in the editor and code using CodeDom</h1><div class="post__text post__text-html js-mediator-article">  When working with <a href="https://unity3d.com/ru/">Unity, it</a> is often necessary to refer to Unity entities (collision layers, sorting layers, tags, input axes, scenes) by their names.  If some of them, for example, rename in the editor, then you need not forget, respectively, correct the name in the code, otherwise we will get an error.  And this error will occur not at compilation, but at run time, immediately at the time of the appeal by name.  A little automation will save from such unpleasant surprises. <br><a name="habracut"></a><br>  At first glance, it is logical to use <a href="http://www.google.ru/search%3Fq%3Dt4%2Btemplate">T4 templates</a> to solve this problem <a href="http://www.google.ru/search%3Fq%3Dt4%2Btemplate">,</a> but they seemed inconvenient to me (at least when used in the Unity project), so I chose a different approach.  Using <a href="http://www.google.ru/search%3Fq%3Dcodedom">CodeDom</a> to solve such a small problem may seem to overingineering, but personal experience proved the viability of this approach: I wrote my simple code generator more than a year ago, and since then, without making changes to it, I successfully used it, which saved me a lot of nerves and decent seconds of time. <br><br>  In this article, we will look at writing an ascetic code generator with <a href="https://msdn.microsoft.com/ru-ru/library/ms173119.aspx">constants</a> containing the names <a href="https://docs.unity3d.com/Manual/Layers.html">of the</a> <a href="https://docs.unity3d.com/Manual/LayerBasedCollision.html">collision</a> <a href="https://docs.unity3d.com/Manual/Layers.html">layers</a> .  Working with the names of other entities is done similarly. <br><br>  The general plan of action is as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Get a list of the names of the conflict layers available in the project. </li><li>  Generate the code itself, containing the class with the necessary constants. </li><li>  Write this code to a file. </li><li>  Encourage Unity to immediately compile the added / modified file. </li></ul><br><h3>  Get the list of collision layer names </h3><br>  Everything is simple, if not afraid to climb into places called internal.  More specifically, the list of names of the collision layers is stored as a field of the ‚Äúinner‚Äù class. <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IEnumerable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAllLayers</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> InternalEditorUtility.layers; }</code> </pre> <br><h3>  We generate the code itself </h3><br>  CodeGen has its own terminology (compare, for example, with <a href="https://github.com/dotnet/roslyn/wiki/Roslyn%2520Overview">Roslyn</a> terminology), but, in general, everything corresponds to the syntax tree inherent in C # code.  In order from root to leaf, we will use the following: <br><br><ol><li>  CodeCompilationUnit is the code generator itself, which we are configuring here, so to speak. </li><li>  CodeNamespace is the namespace in which our class will sit.  We will not wrap the class in an explicit namespace, but we still have to create an instance of the CodeNamespace. </li><li>  CodeTypeDeclaration is the class itself. </li><li>  CodeMemberField is a member of a class (in this case, a constant declaration). </li><li>  CodePrimitiveExpression is an expression with a literal (in this case, a string that will be assigned to a constant). </li></ol><br>  We generate a public string constant whose name and value match the name of the collision layer. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> CodeMemberField </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateConstant</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { name = name.Replace(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CodeMemberField( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>), name); @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>.Attributes &amp;= ~MemberAttributes.AccessMask; @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>.Attributes &amp;= ~MemberAttributes.ScopeMask; @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>.Attributes |= MemberAttributes.Public; @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>.Attributes |= MemberAttributes.Const; @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>.InitExpression = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CodePrimitiveExpression(name); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>; }</code> </pre> <br>  CodeGen has one minor inconvenience: it does not know how to create static classes.  This is due to the fact that it was created at the dawn of the C # language, when static classes were not ‚Äúbrought‚Äù to it yet.  We will get out: we will simulate a static class with a sealed class with a private constructor.  So did some of the early C # users, and those using the Java language are forced to resort to it now. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ImitateStaticClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CodeTypeDeclaration type</span></span></span><span class="hljs-function">)</span></span> { @type.TypeAttributes |= TypeAttributes.Sealed; @type.Members.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CodeConstructor { Attributes = MemberAttributes.Private | MemberAttributes.Final }); }</code> </pre><br>  Finally, let's assemble the class itself, with a private constructor and constants: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> CodeCompileUnit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateClassWithConstants</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, IEnumerable&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; constants</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> compileUnit = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CodeCompileUnit(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CodeNamespace(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CodeTypeDeclaration(name); ImitateStaticClass(@<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> constantName <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> constants) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> = GenerateConstant(constantName); @<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>.<span class="hljs-title"><span class="hljs-title">Members</span></span>.<span class="hljs-title"><span class="hljs-title">Add</span></span>(@<span class="hljs-title"><span class="hljs-title">const</span></span>); } @<span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span>.<span class="hljs-title"><span class="hljs-title">Types.Add</span></span>(@<span class="hljs-title"><span class="hljs-title">class</span></span>); compileUnit.Namespaces.Add(@<span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> compileUnit; }</code> </pre> <br><h3>  Write the code to the file </h3><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteIntoFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fullPath, CodeCompileUnit code</span></span></span><span class="hljs-function">)</span></span> { Directory.CreateDirectory(Path.GetDirectoryName(fullPath)); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamWriter(fullPath, append: <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> writer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IndentedTextWriter(stream); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> codeProvider = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CSharpCodeProvider()) { codeProvider.GenerateCodeFromCompileUnit(code, writer, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CodeGeneratorOptions()); } } }</code> </pre><br><h3>  Making Unity immediately ‚Äúaware‚Äù of changes </h3><br>  This is the last step, and it does not require a significant amount of code, so let it be the function that will respond to user input. <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">MenuItem(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Habr/Generate layers constants"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateAndForceImport</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> path = <span class="hljs-string"><span class="hljs-string">@"Auto/Layers.cs"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fullPath = Path.Combine(Application.dataPath, path); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> className = Path.GetFileNameWithoutExtension(fullPath); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> code = GenerateClassWithConstants(className, GetAllLayers()); WriteIntoFile(fullPath, code); AssetDatabase.ImportAsset(<span class="hljs-string"><span class="hljs-string">"Assets/"</span></span> + path, ImportAssetOptions.ForceUpdate); AssetDatabase.Refresh(); }</code> </pre> <br><h3>  Result </h3><br>  Putting it all together: <br><br><div class="spoiler">  <b class="spoiler_title">Total generator code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Habr</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.CSharp; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.CodeDom; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.CodeDom.Compiler; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Reflection; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEditor; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEditorInternal; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HabrCodeGen</span></span> { [MenuItem(<span class="hljs-string"><span class="hljs-string">"Habr/Generate layers constants"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateAndForceImport</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> path = <span class="hljs-string"><span class="hljs-string">@"Auto/Layers.cs"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fullPath = Path.Combine(Application.dataPath, path); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> className = Path.GetFileNameWithoutExtension(fullPath); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> code = GenerateClassWithConstants(className, GetAllLayers()); WriteIntoFile(fullPath, code); AssetDatabase.ImportAsset(<span class="hljs-string"><span class="hljs-string">"Assets/"</span></span> + path, ImportAssetOptions.ForceUpdate); AssetDatabase.Refresh(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> CodeCompileUnit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateClassWithConstants</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, IEnumerable&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; constants</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> compileUnit = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CodeCompileUnit(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CodeNamespace(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CodeTypeDeclaration(name); ImitateStaticClass(@<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> constantName <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> constants) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> = GenerateConstant(constantName); @<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>.<span class="hljs-title"><span class="hljs-title">Members</span></span>.<span class="hljs-title"><span class="hljs-title">Add</span></span>(@<span class="hljs-title"><span class="hljs-title">const</span></span>); } @<span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span>.<span class="hljs-title"><span class="hljs-title">Types.Add</span></span>(@<span class="hljs-title"><span class="hljs-title">class</span></span>); compileUnit.Namespaces.Add(@<span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> compileUnit; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> CodeMemberField </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateConstant</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { name = name.Replace(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CodeMemberField( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>), name); @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>.Attributes &amp;= ~MemberAttributes.AccessMask; @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>.Attributes &amp;= ~MemberAttributes.ScopeMask; @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>.Attributes |= MemberAttributes.Public; @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>.Attributes |= MemberAttributes.Const; @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>.InitExpression = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CodePrimitiveExpression(name); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IEnumerable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAllLayers</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> InternalEditorUtility.layers; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ImitateStaticClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CodeTypeDeclaration type</span></span></span><span class="hljs-function">)</span></span> { @type.TypeAttributes |= TypeAttributes.Sealed; @type.Members.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CodeConstructor { Attributes = MemberAttributes.Private | MemberAttributes.Final }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteIntoFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fullPath, CodeCompileUnit code</span></span></span><span class="hljs-function">)</span></span> { Directory.CreateDirectory(Path.GetDirectoryName(fullPath)); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamWriter(fullPath, append: <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tw = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IndentedTextWriter(stream); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> codeProvider = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CSharpCodeProvider()) { codeProvider.GenerateCodeFromCompileUnit(code, tw, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CodeGeneratorOptions()); } } } } }</code> </pre></div></div><br>  Put our utility in the Editor folder, click Habr ‚Üí Generate layers constants, we get a file in the project with the following content: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// ------------------------------------------------------------------------------ // &lt;autogenerated&gt; // This code was generated by a tool. // Mono Runtime Version: 2.0.50727.1433 // // Changes to this file may cause incorrect behavior and will be lost if // the code is regenerated. // &lt;/autogenerated&gt; // ------------------------------------------------------------------------------ public sealed class Layers { public const string Default = "Default"; public const string TransparentFX = "TransparentFX"; public const string IgnoreRaycast = "IgnoreRaycast"; public const string Water = "Water"; public const string UI = "UI"; public const string Habr = "Habr"; private Layers() { } }</span></span></code> </pre><br><h3>  Next steps </h3><br>  The resulting utility lacks the following things: <br><br><ul><li>  Slightly more convenient interface with slightly more flexible settings. </li><li>  Resistance to non-valid in C # names. </li><li>  Similarly, generating constants for the names of sorting layers, scenes, tags and input axes. </li></ul><br>  In order not to waste time writing your ‚Äúbicycle‚Äù, you can also use <a href="https://gist.github.com/dogfuntom/00faf9f3598d845b1a5c">my ‚Äúbicycle‚Äù</a> . </div><p>Source: <a href="https://habr.com/ru/post/309128/">https://habr.com/ru/post/309128/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309112/index.html">Huawei Connect 2016 Shanghai</a></li>
<li><a href="../309114/index.html">Visualization of the photo portfolio. Part 2: Word embedding</a></li>
<li><a href="../309118/index.html">Alexey Ragozin on JVM diagnostic interfaces on jug.msk.ru</a></li>
<li><a href="../309124/index.html">LXC in QoS service (replace ifb with veth)</a></li>
<li><a href="../309126/index.html">How to work with MS Access in Linux</a></li>
<li><a href="../309130/index.html">Communication Arrangements</a></li>
<li><a href="../309132/index.html">Once again about the benefits of backups or the story of my failure</a></li>
<li><a href="../309136/index.html">ADM interface - what is ‚ÄúTetrad‚Äù</a></li>
<li><a href="../309138/index.html">Learning OpenGL ES2 for Android Lesson ‚Ññ4. Textures</a></li>
<li><a href="../309142/index.html">Private unstructured types and type reuse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>