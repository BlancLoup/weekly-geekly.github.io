<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development using the Model-View-ViewModel design pattern on the example of the Twitter client step by step</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 The article is devoted to working with MVVM and WPF. It describes the development process of the twitter client. The development proces...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development using the Model-View-ViewModel design pattern on the example of the Twitter client step by step</h1><div class="post__text post__text-html js-mediator-article"><h5>  Introduction </h5><br>  The article is devoted to working with MVVM and WPF.  It describes the development process of the twitter client.  The development process is divided into steps.  At the end of each step, the reader in parallel writing the application must have a working application.  Each subsequent step adds some functionality to what was written in the previous step.  Used by the thirdparty library <a href="http://tweetsharp.codeplex.com/">TweetSharp</a> .  A link to the source code, as well as the original article, written by me in English, can be found <a href="http://www.codeproject.com/KB/tabs/WPFTwitterClientMVVM.aspx">here</a> . <br>  This article is intended for beginners in WPF development.  But it is assumed that the reader has some initial experience with WPF, in particular, has mastered data binding. <br>  I will not write why I need to use MVVM - I think that this is well written in the article <a href="http://msdn.microsoft.com/ru-ru/magazine/dd419663.aspx%26rct%3Dj%26q%3D%2520Josh%2520Smith%2520%2520MSDN%26ei%3Dro0hTZadPMidOsaOiKUJ%26usg%3DAFQjCNEC2tz1--NmeiwgI1TV-H0whQpnag%26sig2%3Dhbu1-iyXfsy4ebPQejgNug%26cad%3Drjt">‚ÄúWPF Applications with a Model-View-Model-View Model‚Äù</a> from Josh Smith.  If you do not want to read this article - just trust me - the wrong designed GUI in the case of WPF turns into a big headache. <br><br><a name="habracut"></a><br><h4>  Preview client twitter analysis </h4><br>  Before we proceed to the design of our client's design, let's take a look at the GUI of some existing client in order to understand what functionality we need to provide to the user: <br><img src="https://habrastorage.org/getpro/habr/post_images/357/4ab/1c6/3574ab1c6916b03c6965fd3412d8bb77.jpg" alt="image"><br>  The user uses several bookmarks at the top of the page - recent, replies, user, and so on.  Depending on the selected bookmark, different information is displayed in the main window space.  For example, when you click on Recent, the latest tweets from your subscription are displayed, and when you click on Messages, your direct messages will appear in the main window. <br>  After thinking a little more, we understand that it is wise to use TabControl. <br><br><h5>  MVVM in brief </h5><br>  I'll start with an example.  Suppose you need to write a UserControl that will display tweets.  You click to add a UserControl, and you will add the necessary controls to xaml.  Next, you will create a property in code behind where you will store tweets.  Then add the event handler to the same code behind - for example, clicking on the UserPicture on Twitter.  In general, everything is the same as if you did this control using previous technologies like WinForms.  Take a closer look at this control - it has a description of the part visible to the user - those xaml.  And there is also code behind. <br>  Now let's say you receive the first feature request - the user wanted to display other tweets, but in the same exact control.  You can make the appropriate flag in code behind or, if you are more experienced in software design, you will use GoF's strategy.  After some time, the second feature request comes - every tweet contains too much unnecessary information from the user‚Äôs view and you need to make a new look to your control, but at the same time you don‚Äôt want to offend old users and leave the possibility of working with the old visual presentation.  And so on - the requirements are coming all new, you use various tricks and ingenious solutions to implement them. <br>  Stop!  Let's go back in time - to the situation when there was only one control.  What if you break the code behind and the control class itself?  Those split the entity into two.  One to call View is what the user sees, those class inherited from UserControl.  And the second to call the ViewModel is the data directly related to what is shown to the user through the View, as well as event handler functions, like clicking on an avatar.  Then it will be easy to solve the first feature request - you just write the ViewModel and assign the old View to it.  It will also be easy to solve the first feature request - you can associate different View with one ViewModel.  Good idea - you think. <br>  But how to make the connection between View and ViewModel?  Data binding is used for this - a key tool in WPF.  You specify View one way or another which DataContext to use, tell them where to get the data, and continue to reach the data in almost the same way as in the case of the code behind.  I deliberately omit the technical details here - they will be told further. <br>  This is a typical class diagram for an application written using MVVM: <br><img src="https://habrastorage.org/getpro/habr/post_images/f22/d70/891/f22d7089142e3aa501e8bb3353390c03.png" alt="image"><br>  There are View classes, they use data from ViewModel, but they know nothing about the model (in our case, the model is implemented in the TweetSharp library).  The ViewModel, in turn, does not know which View uses them, but can take information from the Model. <br>  Usually there are also some major View and ViewModel that aggregate the rest of the View and ViewModel. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Step 1. Application framework </h5><br>  First, create an application with TabControl, which contains only one TabItem - Recent.  We will act in accordance with MVVM. <br>  Create a new WPF application.  In the MainWindow window add TabControl: <br> <code><br> &lt;TabControl Height="400" <br> HorizontalAlignment="Left" <br> Name="Tabs" <br> VerticalAlignment="Top" Width="300"&gt; <br> /&gt; <br></code> <br><br>  This window will be the main element of the View.  It will display all other elements (tabItems).  It must correspond to the corresponding class ViewModel, which will be central in its field.  It is in it, and not in MainWindow's code behind, that we will store data and describe event handler functions.  Create a new public class, SimpleTwitterClientViewModel.  Let it be empty for now.  Now we need to specify the window class so that it searches for data not in the code behind, but in SimpleTwitterClientViewModel.  Those we need to set the DataContext.  To do this, add the ViewModel field to code behind, add a property to the name of the window, and define the DataContext: <br> <code>&lt;Window x:Class="SimpleTwitterClient.MainWindow" <br> x:Name="MainWindowInstance" <br> xmlns:view="clr-namespace:SimpleTwitterClient.View" <br> xmlns:viewModel="clr-namespace:SimpleTwitterClient.ViewModel" <br> DataContext="{BindingViewModel,ElementName=MainWindowInstance}"&gt;</code> <br> <code><br> public partial class MainWindow : Window <br> { <br> private SimpleTwitterClientViewModel _viewModel; <br> <br> public SimpleTwitterClientViewModel ViewModel <br> { <br> get { return _viewModel; } <br> set { _viewModel = value; } <br> } <br> <br> public MainWindow() <br> { <br> _viewModel = new SimpleTwitterClientViewModel(); <br> InitializeComponent(); <br> } <br> }</code> <br>  Now we will create Recent's View and ViewModel.  RecentView - it will be just UserControl with empty code behind.  Add some control to it to distinguish it from the empty TabItem that is now.  Let RecentViewModel be empty. <br>  SimpleTwitterClientViewModel will be the class that will hold the ViewModel for our TabItems.  So far we have only Recent.  So write this code: <br> <code>public class SimpleTwitterClientViewModel <br> { <br> RecentViewModel _recentPage = new RecentViewModel(); <br> <br> public RecentViewModel RecentPage <br> { <br> get { return _recentPage; } <br> set { _recentPage = value; } <br> } <br> }</code> <br>  If we launch our application now, we will see that so far nothing has changed.  We still need to specify our TabItem, so that it displays RecentView.  How to do it?  Here is a subtle but important point - first, we need to set Content to RecentPage: <br> <code>/&gt;</code> <br>  Second, you need to create a mapping from ViewModel to View.  Those code that would check that if TabItem's Content is RecentViewModel, then you need to display RecentView.  Here is the code: <br> <code>&lt;Window.Resources&gt; <br> &lt;DataTemplateDataType="{x:TypeviewModel:RecentViewModel}"&gt; <br> &lt;view:RecentView /&gt; <br></code> <br>  &lt;/Window.Resources&gt; <br>  As a result of all these actions, we have the following application: <br><img src="https://habrastorage.org/getpro/habr/post_images/d3e/c6a/a15/d3ec6aa1594e001541d367c904398367.jpg" alt="image"><br>  Why so difficult?  This is just the beginning, then when the application becomes more complex, you will appreciate the advantages of MVVM. <br><br><h5>  Step 2. First tweets </h5><br>  Fill in our RecentPage data with the latest tweets.  For this we will use the TweetSharp library.  Add it to the list of assemblies. <br>  In order to use our application with the Twitter API, it is necessary to do a number of frauds. <br>  1. ConsumerKey and ConsumerSecret.  Go to <a href="http://dev.twitter.com/">http://dev.twitter.com/</a> and click register.  After that, a page with information about your application will appear, take the ConsumerKey and ConsumerSecret from there and save them in settings. <br>  2. PIN (oauth_verifier).  When your application is launched for the first time, it should send a request containing the ConsumerSecret and ConsumerKey to the server: <br> <code>FluentTwitter.SetClientInfo( <br> new TwitterClientInfo <br> { <br> ConsumerKey = Settings.Default.ConsumerKey, <br> ConsumerSecret = Settings.Default.ConsumerSecret <br> }); <br> <br> var twit = FluentTwitter.CreateRequest().Authentication.GetRequestToken(); <br> <br> var response = twit.Request(); <br> <br> var RequestToken = response.AsToken(); <br> twit = twit.Authentication.AuthorizeDesktop(RequestToken.Token);</code> <br>  The last line will open your default browser.  There will be a question about whether to allow the application to use the service, click Allow and enter the PIN in the application dialog.  I invoke this dialog in the getPinFromUser method: <br> <code>string verifier = getPinFromUser();</code> <br>  3. AccesToken.  Now send a request containing consumerKey, consumerSecret and Pin.  The service will return AccessToken which will be used later: <br> <code>twit.Authentication.GetAccessToken(RequestToken.Token, verifier); <br> var response2 = twit.Request();</code> <br>  4. Refresh your AccessToken.  After some time, the service may ask to update AccessToken. <br><br>  Add the OAuthHandler class to the Model folder.  There add UserControl AskPinFromUserDialog.  And in the resources of your application, add ConsumerKey, ConsumerSecret, received from Twitter, when you registered your application.  There add OauthInfoFileName in which write the path to the configuration file for our application.  There will be stored keys received from twitter.  Not very safe, but simple.  Finally, add the creation of an object of this class to the main ViewModel: <br> <code>Model.OAuthHandler _oauthHandler = newModel.OAuthHandler();</code> <br>  Now you can start working with RecentPage.  First, add a container for storing tweets to the RecentPage class: <br> <code><code><br> public ObservableCollection Tweets <br> { <br> get; set; <br> } <br> <br>   ObservableCollection,   - List            View,    . <br>   .  -          _oauthHandler  ViewModel.    RecentViewModel,   _oauthHandler       . <br> ,       _oauthHandler ,        . <br>      .     LoadTweets  RecentViewModel: <br> public void LoadTweets() <br> { <br> TwitterResult response = FluentTwitter <br> .CreateRequest() <br> .AuthenticateWith( <br> Settings.Default.ConsumerKey, <br> Settings.Default.ConsumerSecret, <br> Model.OAuthHandler.Token, <br> Model.OAuthHandler.TokenSecret) <br> .Statuses() <br> .OnHomeTimeline().AsJson().Request()); <br> <br> var statuses = response.AsStatuses(); <br> foreach (TwitterStatus status in statuses) <br> { <br> Tweets.Add(status); <br> } <br> } <br></code> <br>         RecentViewModel: <br> <code><code>public RecentViewModel(Model.OAuthHandleroauthHandler) <br> { <br> _oauthHandler = oauthHandler; <br> Tweets = newObservableCollection(); <br> LoadTweets(); <br> } <br> <br>   ListBox      : <br> &lt;ListBoxx:Name="RecentTweetList" <br> ItemsSource="{Binding Path=Tweets}" <br> IsSynchronizedWithCurrentItem="True"/&gt; <br></code> <br>    ,           TweetStatus.ToString().   ,   ListBox    ,     TweetStatus.  ,     ,   DataTemplate     UserControl.Resources.  DataTemplate    ,     TweetStatus. ,  TweetStatus   Text,            Binding Path=Text. <br>   DataTemplate: <br> <code><br> &lt;DataTemplate x:Key="TweetItemTemplate"&gt; <br> &lt;Grid x:Name="TTGrid"&gt; <br> &lt;Grid.RowDefinitions&gt; <br> /&gt; <br> /&gt; <br> &lt;/Grid.RowDefinitions&gt; <br> &lt;Grid.ColumnDefinitions&gt; <br> /&gt; <br> /&gt; <br> /&gt; <br> &lt;/Grid.ColumnDefinitions&gt; <br> &lt;Image Source="{Binding Path=User.ProfileImageUrl}" <br> Name="UserAvatarImage" /&gt; <br> &lt;TextBlock <br> Name="ScreenNameTextBlock" <br> Text="{Binding Path=User.ScreenName}" <br> Grid.Row="1"Grid.ColumnSpan="2"/&gt; <br> &lt;TextBlock <br> Text="{Binding Path=Text}" <br> TextWrapping="Wrap"Grid.Column="1"Grid.ColumnSpan="2" /&gt; <br></code> <br></code> <br></code> <br>  Now we will tell our ListBox to use the declared DataTemplate: <br> <code>ItemTemplate="{StaticResourceTweetItemTemplate}"</code> <br>  Now our application should look like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/9f0/666/f21/9f0666f21a033e3de4c7522edb717471.jpg" alt="image"><br><br><h5>  Step 3. New pages </h5><br>  The Recent tab displays the latest tweets that you follow, as well as your own tweets.  In terms of TweetSharp, this is HomeTimeline.  But this is not all tweets that may interest you.  If you go to the TwitterStatusesExtensions class, in which the OnHomeTimeline method is declared, you will see other methods that return a list of tweets grouped by various criteria: OnFriendsTimeline, OnListTimeline, RetweetedByMe ... <br>  Create a page that will contain retweets of users you follow.  Similar to the creation of Recent, create a RetweetsViewModel.  I will not describe their code in detail, leaving the reader as an exercise exercise.  Are you thinking of writing View as well?  Hmm, but the information displayed in Recent and Retweets is structurally the same.  MVVM and WPF allow you to minimize copy-past - in this case, do not think about RetweetsView.  At the end of Step 3 you will see that this is unnecessary. <br>  Now we need to add the object of the RetweetsViewModel class to the main ViewModel.  If we have only two pages, then this is a normal solution.  But we want to make many pages.  So this solution is not the best.  It is better to store in the main ViewModel container with different ViewModel.  We notice that RetweetsViewModel is very similar to RecentViewModel and you can easily apply Extract Interface from class.  We will also move OauthHandler into properties and will not initialize it in the constructor, but do it in the base class.  Let's call the IPageBase interface: <br> <code><code><code><br> public interface IPageBase <br> { <br> void LoadTweets(); <br> ObservableCollection Tweets { get; set; } <br> } <br> <br> <br>      ViewModel: <br> ObservableCollection _pages; <br> <br> public ObservableCollection Pages <br> { <br> get { return _pages; } <br> set { _pages = value; } <br> } <br> <br> public SimpleTwitterClientViewModel() <br> { <br> _pages = new ObservableCollection(); <br> _pages.Add(new RecentViewModel()); <br> _pages.Add(new RetweetsViewModel()); <br> foreach (var page in _pages) <br> { <br> page.LoadTweets(); <br> } <br> } <br> <br>     View DataTemplate  RetweetsPage.    TabItem ‚Äì     tabItem      ViewModel RecentPage: <br> /&gt;</code> <br>        TabItems    Pages.      TabControl   ItemsSource.    Pages      TabItems ‚Äì       Pages.      ‚Äì TabItems     Header.        header   TabItems?     Name   IPageBase.       -. ,     TabItem     Header: <br> <code><br> &lt;TabControlName="Tabs" <br> ItemsSource="{Binding Pages}"&gt; <br> &lt;TabControl.ItemContainerStyle&gt; <br> <br> &lt;/TabControl.ItemContainerStyle&gt; <br></code> <br> <br>    ‚Äì  RetweetsViewModel  View.      RetweetsView.      RecentView!    MVVM! <br> <code>&lt;DataTemplateDataType="{x:TypeviewModel:RetweetsViewModel}"&gt; <br> &lt;view:RecentView /&gt; <br></code> <br> <br>  .   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/9ba/b4c/790/9bab4c790fcf0dfc14d08411cfa81362.jpg" alt="image"> <br>         DataTemplate ‚Äì      ViewModel   . <br>  ‚Äì     follower &amp; following. <br> <br>  4.      ICommand <br> ,      .        MVVM      ‚Äì       OnMouseClick.       .  ,     .  TextBox   ,      : <br> <img src="https://habrastorage.org/getpro/habr/post_images/147/166/5e2/1471665e26eb2f308b61915e93e544e9.jpg" alt="image"> <br>           code behind                   ‚Äì  EnterTweetTextBox.Text.    MVVM    .        ViewModel   ,       Send.      ,          . <br> ,      EnterTweetTextBox      .      SimpleTwitterClientViewModel ‚Äì    Message.      Text: <br> <code>&lt;TextBoxName="EnterTweetTextBox" <br> Text="{BindingMessage}"/&gt; <br></code> <br>    SendTweet   SimpleTwitterClientViewModel: <br> <code>private void SendTweet() <br> { <br> var twitter = FluentTwitter.CreateRequest(); <br> twitter.AuthenticateWith( <br> Settings.Default.ConsumerKey, <br> Settings.Default.ConsumerSecret, <br> OAuthHandler.Token, <br> OAuthHandler.TokenSecret); <br> twitter.Statuses().Update(Message); <br> <br> var response = twitter.Request(); <br> //you can verify the response here <br> } <br></code> <br>    ‚Äì          ?   ‚Äì  Button   Command,        .      ICommand.    SendMessage,  ,     .         ?  ‚Äì  -adapter       ICommand.            Josh Smith: <br> <code><code>internal class RelayCommand : ICommand <br> { <br> #region Fields <br> <br> readonly Action _execute; <br> readonly Func _canExecute; <br> <br> #endregion <br> <br> #region Constructors <br> <br> public RelayCommand(Action execute) <br> : this(execute, null) <br> { <br> } <br> <br> public RelayCommand(Action execute, Func canExecute) <br> { <br> if (execute == null) <br> throw new ArgumentNullException("execute"); <br> <br> _execute = execute; <br> _canExecute = canExecute; <br> } <br> <br> #endregion // Constructors <br> <br> #region ICommand Members <br> <br> [DebuggerStepThrough] <br> public bool CanExecute(object parameter) <br> { <br> return _canExecute == null ? true : _canExecute(); <br> } <br> <br> public event EventHandler CanExecuteChanged <br> { <br> add <br> { <br> if (_canExecute != null) <br> CommandManager.RequerySuggested += value; <br> } <br> remove <br> { <br> if (_canExecute != null) <br> CommandManager.RequerySuggested -= value; <br> } <br> } <br> <br> public void Execute(object parameter) <br> { <br> _execute(); <br> } <br> <br> #endregion // ICommand Members <br> } <br> <br>     RelayCoommand      ICommand.      ,     SendTweet ICommand: <br> RelayCommand _sendCommand; <br> public ICommand SendCommand <br> { <br> get <br> { <br> if (_sendCommand == null) <br> { <br> _sendCommand = new RelayCommand(() =&gt; this.SendTweet()); <br> } <br> return _sendCommand; <br> } <br> } <br></code> <br> ,  SendButton  ,     SendCommand: <br> <code>&lt;Button Name="SendTweetButton" <br> Command="{Binding SendCommand}"/&gt;</code> <br>       ,   ?      : <br> <img src="https://habrastorage.org/getpro/habr/post_images/21a/f7a/ca0/21af7aca02fef405a2d06212baf1e087.png" alt="image"> <br>       ,     ‚Äì         . <br>   ,    feature:     userpicture,  TabItem .  TabItem   ,    . <br></code></code></code> <h5> <code><code><code><br> public interface IPageBase <br> { <br> void LoadTweets(); <br> ObservableCollection Tweets { get; set; } <br> } <br> <br> <br>      ViewModel: <br> ObservableCollection _pages; <br> <br> public ObservableCollection Pages <br> { <br> get { return _pages; } <br> set { _pages = value; } <br> } <br> <br> public SimpleTwitterClientViewModel() <br> { <br> _pages = new ObservableCollection(); <br> _pages.Add(new RecentViewModel()); <br> _pages.Add(new RetweetsViewModel()); <br> foreach (var page in _pages) <br> { <br> page.LoadTweets(); <br> } <br> } <br> <br>     View DataTemplate  RetweetsPage.    TabItem ‚Äì     tabItem      ViewModel RecentPage: <br> /&gt;</code> <br>        TabItems    Pages.      TabControl   ItemsSource.    Pages      TabItems ‚Äì       Pages.      ‚Äì TabItems     Header.        header   TabItems?     Name   IPageBase.       -. ,     TabItem     Header: <br> <code><br> &lt;TabControlName="Tabs" <br> ItemsSource="{Binding Pages}"&gt; <br> &lt;TabControl.ItemContainerStyle&gt; <br> <br> &lt;/TabControl.ItemContainerStyle&gt; <br></code> <br> <br>    ‚Äì  RetweetsViewModel  View.      RetweetsView.      RecentView!    MVVM! <br> <code>&lt;DataTemplateDataType="{x:TypeviewModel:RetweetsViewModel}"&gt; <br> &lt;view:RecentView /&gt; <br></code> <br> <br>  .   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/9ba/b4c/790/9bab4c790fcf0dfc14d08411cfa81362.jpg" alt="image"> <br>         DataTemplate ‚Äì      ViewModel   . <br>  ‚Äì     follower &amp; following. <br> <br>  4.      ICommand <br> ,      .        MVVM      ‚Äì       OnMouseClick.       .  ,     .  TextBox   ,      : <br> <img src="https://habrastorage.org/getpro/habr/post_images/147/166/5e2/1471665e26eb2f308b61915e93e544e9.jpg" alt="image"> <br>           code behind                   ‚Äì  EnterTweetTextBox.Text.    MVVM    .        ViewModel   ,       Send.      ,          . <br> ,      EnterTweetTextBox      .      SimpleTwitterClientViewModel ‚Äì    Message.      Text: <br> <code>&lt;TextBoxName="EnterTweetTextBox" <br> Text="{BindingMessage}"/&gt; <br></code> <br>    SendTweet   SimpleTwitterClientViewModel: <br> <code>private void SendTweet() <br> { <br> var twitter = FluentTwitter.CreateRequest(); <br> twitter.AuthenticateWith( <br> Settings.Default.ConsumerKey, <br> Settings.Default.ConsumerSecret, <br> OAuthHandler.Token, <br> OAuthHandler.TokenSecret); <br> twitter.Statuses().Update(Message); <br> <br> var response = twitter.Request(); <br> //you can verify the response here <br> } <br></code> <br>    ‚Äì          ?   ‚Äì  Button   Command,        .      ICommand.    SendMessage,  ,     .         ?  ‚Äì  -adapter       ICommand.            Josh Smith: <br> <code><code>internal class RelayCommand : ICommand <br> { <br> #region Fields <br> <br> readonly Action _execute; <br> readonly Func _canExecute; <br> <br> #endregion <br> <br> #region Constructors <br> <br> public RelayCommand(Action execute) <br> : this(execute, null) <br> { <br> } <br> <br> public RelayCommand(Action execute, Func canExecute) <br> { <br> if (execute == null) <br> throw new ArgumentNullException("execute"); <br> <br> _execute = execute; <br> _canExecute = canExecute; <br> } <br> <br> #endregion // Constructors <br> <br> #region ICommand Members <br> <br> [DebuggerStepThrough] <br> public bool CanExecute(object parameter) <br> { <br> return _canExecute == null ? true : _canExecute(); <br> } <br> <br> public event EventHandler CanExecuteChanged <br> { <br> add <br> { <br> if (_canExecute != null) <br> CommandManager.RequerySuggested += value; <br> } <br> remove <br> { <br> if (_canExecute != null) <br> CommandManager.RequerySuggested -= value; <br> } <br> } <br> <br> public void Execute(object parameter) <br> { <br> _execute(); <br> } <br> <br> #endregion // ICommand Members <br> } <br> <br>     RelayCoommand      ICommand.      ,     SendTweet ICommand: <br> RelayCommand _sendCommand; <br> public ICommand SendCommand <br> { <br> get <br> { <br> if (_sendCommand == null) <br> { <br> _sendCommand = new RelayCommand(() =&gt; this.SendTweet()); <br> } <br> return _sendCommand; <br> } <br> } <br></code> <br> ,  SendButton  ,     SendCommand: <br> <code>&lt;Button Name="SendTweetButton" <br> Command="{Binding SendCommand}"/&gt;</code> <br>       ,   ?      : <br> <img src="https://habrastorage.org/getpro/habr/post_images/21a/f7a/ca0/21af7aca02fef405a2d06212baf1e087.png" alt="image"> <br>       ,     ‚Äì         . <br>   ,    feature:     userpicture,  TabItem .  TabItem   ,    . <br></code></code></code> </h5> <code><code><code><br> public interface IPageBase <br> { <br> void LoadTweets(); <br> ObservableCollection Tweets { get; set; } <br> } <br> <br> <br>      ViewModel: <br> ObservableCollection _pages; <br> <br> public ObservableCollection Pages <br> { <br> get { return _pages; } <br> set { _pages = value; } <br> } <br> <br> public SimpleTwitterClientViewModel() <br> { <br> _pages = new ObservableCollection(); <br> _pages.Add(new RecentViewModel()); <br> _pages.Add(new RetweetsViewModel()); <br> foreach (var page in _pages) <br> { <br> page.LoadTweets(); <br> } <br> } <br> <br>     View DataTemplate  RetweetsPage.    TabItem ‚Äì     tabItem      ViewModel RecentPage: <br> /&gt;</code> <br>        TabItems    Pages.      TabControl   ItemsSource.    Pages      TabItems ‚Äì       Pages.      ‚Äì TabItems     Header.        header   TabItems?     Name   IPageBase.       -. ,     TabItem     Header: <br> <code><br> &lt;TabControlName="Tabs" <br> ItemsSource="{Binding Pages}"&gt; <br> &lt;TabControl.ItemContainerStyle&gt; <br> <br> &lt;/TabControl.ItemContainerStyle&gt; <br></code> <br> <br>    ‚Äì  RetweetsViewModel  View.      RetweetsView.      RecentView!    MVVM! <br> <code>&lt;DataTemplateDataType="{x:TypeviewModel:RetweetsViewModel}"&gt; <br> &lt;view:RecentView /&gt; <br></code> <br> <br>  .   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/9ba/b4c/790/9bab4c790fcf0dfc14d08411cfa81362.jpg" alt="image"> <br>         DataTemplate ‚Äì      ViewModel   . <br>  ‚Äì     follower &amp; following. <br> <br>  4.      ICommand <br> ,      .        MVVM      ‚Äì       OnMouseClick.       .  ,     .  TextBox   ,      : <br> <img src="https://habrastorage.org/getpro/habr/post_images/147/166/5e2/1471665e26eb2f308b61915e93e544e9.jpg" alt="image"> <br>           code behind                   ‚Äì  EnterTweetTextBox.Text.    MVVM    .        ViewModel   ,       Send.      ,          . <br> ,      EnterTweetTextBox      .      SimpleTwitterClientViewModel ‚Äì    Message.      Text: <br> <code>&lt;TextBoxName="EnterTweetTextBox" <br> Text="{BindingMessage}"/&gt; <br></code> <br>    SendTweet   SimpleTwitterClientViewModel: <br> <code>private void SendTweet() <br> { <br> var twitter = FluentTwitter.CreateRequest(); <br> twitter.AuthenticateWith( <br> Settings.Default.ConsumerKey, <br> Settings.Default.ConsumerSecret, <br> OAuthHandler.Token, <br> OAuthHandler.TokenSecret); <br> twitter.Statuses().Update(Message); <br> <br> var response = twitter.Request(); <br> //you can verify the response here <br> } <br></code> <br>    ‚Äì          ?   ‚Äì  Button   Command,        .      ICommand.    SendMessage,  ,     .         ?  ‚Äì  -adapter       ICommand.            Josh Smith: <br> <code><code>internal class RelayCommand : ICommand <br> { <br> #region Fields <br> <br> readonly Action _execute; <br> readonly Func _canExecute; <br> <br> #endregion <br> <br> #region Constructors <br> <br> public RelayCommand(Action execute) <br> : this(execute, null) <br> { <br> } <br> <br> public RelayCommand(Action execute, Func canExecute) <br> { <br> if (execute == null) <br> throw new ArgumentNullException("execute"); <br> <br> _execute = execute; <br> _canExecute = canExecute; <br> } <br> <br> #endregion // Constructors <br> <br> #region ICommand Members <br> <br> [DebuggerStepThrough] <br> public bool CanExecute(object parameter) <br> { <br> return _canExecute == null ? true : _canExecute(); <br> } <br> <br> public event EventHandler CanExecuteChanged <br> { <br> add <br> { <br> if (_canExecute != null) <br> CommandManager.RequerySuggested += value; <br> } <br> remove <br> { <br> if (_canExecute != null) <br> CommandManager.RequerySuggested -= value; <br> } <br> } <br> <br> public void Execute(object parameter) <br> { <br> _execute(); <br> } <br> <br> #endregion // ICommand Members <br> } <br> <br>     RelayCoommand      ICommand.      ,     SendTweet ICommand: <br> RelayCommand _sendCommand; <br> public ICommand SendCommand <br> { <br> get <br> { <br> if (_sendCommand == null) <br> { <br> _sendCommand = new RelayCommand(() =&gt; this.SendTweet()); <br> } <br> return _sendCommand; <br> } <br> } <br></code> <br> ,  SendButton  ,     SendCommand: <br> <code>&lt;Button Name="SendTweetButton" <br> Command="{Binding SendCommand}"/&gt;</code> <br>       ,   ?      : <br> <img src="https://habrastorage.org/getpro/habr/post_images/21a/f7a/ca0/21af7aca02fef405a2d06212baf1e087.png" alt="image"> <br>       ,     ‚Äì         . <br>   ,    feature:     userpicture,  TabItem .  TabItem   ,    . <br></code></code></code> </div><p>Source: <a href="https://habr.com/ru/post/111105/">https://habr.com/ru/post/111105/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111092/index.html">We update the message counter Vkontakte without reloading the page</a></li>
<li><a href="../111095/index.html">A little more about TDD and unit tests.</a></li>
<li><a href="../111100/index.html">Azure. Debugging applications on the 80th port</a></li>
<li><a href="../111102/index.html">Learning to cook: Spring 3 MVC + Spring Security + Hibernate</a></li>
<li><a href="../111103/index.html">Monoblock for the "difficult" user</a></li>
<li><a href="../111106/index.html">OV-Chipkaart: contactless smart cards in the service of the community</a></li>
<li><a href="../111108/index.html">Browser usage statistics for December 2010 according to StatCounter</a></li>
<li><a href="../111109/index.html">How does Opera make money (aka most frequently asked question)</a></li>
<li><a href="../111111/index.html">Google Docs v3 Family Budget</a></li>
<li><a href="../111114/index.html">The story of one computer war</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>