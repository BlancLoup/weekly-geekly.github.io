<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Django in non-blocking style, or in pursuit of the Holy Grail</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A tip 
 When reading about Twisted, Tornado, Node.js, many python programmers have a question - ‚Äúbut if you take and rewrite Django in a non-blocking ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Django in non-blocking style, or in pursuit of the Holy Grail</h1><div class="post__text post__text-html js-mediator-article"><img src="http://img7.imageshack.us/img7/588/holygrail051.jpg" alt="image"><br><h4>  A tip </h4><br>  When reading about Twisted, Tornado, Node.js, many python programmers have a question - ‚Äúbut if you take and rewrite Django in a non-blocking style?‚Äù.  The usual answer to this question is no, you will not wait.  And the truth is, to rewrite a whole macaroni-kolbechny framework, you need a lot of strength and a lot of enthusiasm.  Writing with callbacks, a very dubious pleasure. <br><br>  It would have been, but as I wrote in my last note, there are greenlet-s in the python-world, which with a flick of the wrist helps to hide all these asynchronous moments from the programmer, to a certain extent.  At the time of writing this note, I was skeptical about the idea of ‚Äã‚Äãmaking Django work in non-blocking mode - well, really, who will take this? <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  The essence </h4><br>  But in fact, everything is not so scary, watch your hands - we create a WSGI resource in Twisted, start listening to HTTP requests;  we give each request to the Django WSGI handler, wrapping it in a greenlet;  any requests that can be converted to non-blocking are passed to Twisted, which will kick our greenlet at the moment data is ready;  is ready! <br><br><img src="http://img198.imageshack.us/img198/8702/notegif.png" alt="image"><br><br>  And what do we have such that you can turn into a non-blocking mode in the first place?  In Django, the main such site is the database.  Is it possible to communicate with it asynchronously?  Absolutely right, but you need a special driver. <br><br>  For a long time in Twisted there is such - PGAsync.  He has serious problems, he has long been abandoned, but who prevents us from picking up the fallen banner?  I made such an attempt, at the moment the driver is more stable than the original, but the work is not yet finished.  However, we can get an asynchronous database for Django, and it will be Postgresql (oh, sorry, Mysql users, but who's stopping you from writing your own?).  The driver is used in the current project being developed by Imarto Networks <a href="http://imarto.net/">imarto.net</a> , and it was decided to post it for free use.  I laid it out before readiness, only to demonstrate the asynchronous Django, be lenient. <br><br>  To use it in Django, we need to write our database backend.  I fiddled with something from the back end for psycopg2, wrapping calls to the database driver in the function of transferring control to the main greenlet, that is, the main program flow.  The standard wsgi-resource from twisted.web also had to be slightly redone, because now it should throw processing requests not into the pool of threads, but into greenlet. <br><br><h4>  How to feel </h4><br>  Sources can be obtained here, there is a test django-project - <a href="http://bitbucket.org/deepwalker/tx_green/">bitbucket.org/deepwalker/tx_green</a> <br>  Sources of database drivers - <a href="http://bitbucket.org/deepwalker/tx-postgresql/">bitbucket.org/deepwalker/tx-postgresql</a> <br><br>  To use it, you must place pgasync, green_wsgi.py, tx_green.py, tx_postgresql in a place where the interpreter can find them.  Then in the test_green_dj directory, configure the settings for connecting to the database, ./manage.py syncdb, twistd -n - y server.py.  Everything, at <a href="http://127.0.0.1/">127.0.0.1</a> : 8001, we meet our test project. <br><br><h4>  About tests </h4><br>  The tests that I conducted related mainly to the verification of work, I did not measure the performance gain.  If someone spends his time on this good deed, I will be grateful if you share the results. </div><p>Source: <a href="https://habr.com/ru/post/84237/">https://habr.com/ru/post/84237/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../84227/index.html">Service "how much does it cost ...?" Or "Price order"</a></li>
<li><a href="../84228/index.html">Qt Lighthouse + Android = android-lighthouse</a></li>
<li><a href="../84229/index.html">Image annotation</a></li>
<li><a href="../84235/index.html">Advanced Python Materials</a></li>
<li><a href="../84236/index.html">Red Cardboard Day</a></li>
<li><a href="../84238/index.html">Employee Motivation</a></li>
<li><a href="../84240/index.html">Mobile World Congress 2010: really watching!</a></li>
<li><a href="../84241/index.html">The computer of your dreams. Part 4: Platform</a></li>
<li><a href="../84242/index.html">X86 and ARM: the war for portable devices. Who will win?</a></li>
<li><a href="../84243/index.html">Geek & Poke mini comics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>