<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating remakes of games using emulation: proof of concept</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 ‚ÄúIn my time the games were better. They were more interesting because the gameplay was considered more important than the graphics. ‚Äù 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating remakes of games using emulation: proof of concept</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/0b6/757/5a5/0b67575a51304d40e4c96d1d36f21718.jpg" alt="image"><br><br><h2>  Introduction </h2><br><blockquote>  <em>‚ÄúIn my time the games were better.</em>  <em>They were more interesting because the gameplay was considered more important than the graphics. ‚Äù</em> <br><br>  - Gamers born in any decade </blockquote><br>  Whatever ‚Äúyour time‚Äù may be, I think you agree with this opinion to a certain extent.  For me, it was from the mid-80s to the mid-90s, when I spent countless hours with <a href="http://gamesdbase.com/game/sinclair-zx-spectrum/sir-fred.aspx">Sir Fred</a> , <a href="http://gamesdbase.com/game/sinclair-zx-spectrum/atic-atac.aspx">Atic Atac</a> , <a href="http://www.mobygames.com/game/dos/airborne-ranger/screenshots">Airborne Ranger</a> , <a href="http://www.mobygames.com/game/dos/secret-of-monkey-island/screenshots">Monkey Island</a> , <a href="http://www.mobygames.com/game/dos/twilight-2000/screenshots">Twilight: 2000</a> , <a href="http://www.mobygames.com/game/dos/stunts/screenshots">Stunts</a> , <a href="http://www.mobygames.com/game/dos/gunship-2000/screenshots">Gunship 2000</a> , <a href="http://www.mobygames.com/game/dos/relentless-twinsens-adventure/screenshots">Twinsen's Adventure</a> , <a href="http://www.mobygames.com/game/dos/dark-sun-shattered-lands/screenshots">Dark Sun</a> , <a href="http://www.mobygames.com/game/dos/super-solvers-challenge-of-the-ancient-empires/screenshots">Challenge for Ancient Empires</a> , the <a href="http://www.mobygames.com/game/dos/star-wars-x-wing/screenshots">X-Wing</a> series and so many other games. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Sometimes we experience nostalgia and we want to play one of those games again.  In this case, we have several options to choose from. <br><br>  <strong>Play the remastered version</strong> .  Some games are so awesome and have built a fan base so loyal that the official ‚Äúnew edition‚Äù is released.  This is exactly the same game, but with modern graphics.  A great example of such games can be the wonderful <em>Monkey Island Special Edition</em> . <br><br>  This is the perfect option.  Unfortunately, only <em>very</em> few games are being reworked, the reason for this is the cost, the lost source code of the original or even insufficient interest in the case of relatively little-known games. <br><br>  Games in which the source code is open are a similar category, for example, first-person shooters from id.  There are projects that create new graphic resources for these games, but they are rare, and few developers open the source code of their games. <br><a name="habracut"></a><br>  <strong>Play a remake</strong> .  Some games are so awesome and put together a so loyal fan base that someone decides to rewrite the game from scratch, usually without the least support from the original authors.  If you manage to find a good remake, then you get an almost original game, but with modern graphics. <br><br>  This is a good alternative, but again, not many games have remakes.  This happened because remakes are usually created by fans, and the task is incredibly difficult - as complex as creating the game again, and this adds the difficulty of how to accurately reproduce the original gameplay.  The only way to achieve a high degree of accuracy is to disassemble the original code and recreate its logic. <br><br>  <strong>Run the emulator</strong> .  You can always use DOSBox and special solutions for some games, such as ScummVM.  It works well, but let's be honest, the graphics of most games are not like wine, which gets better over time.  Nevertheless, you still play the original game. <br><br><h3>  Total </h3><br>  If the game you want to play has a remastered version, then that's great!  But for the vast majority of games that do not have remasters, there are only two options: use an emulator (it is widely available, provides the perfect gameplay and outdated graphics) or hope that someone will create a remake (relatively rare, imperfect gameplay, modern graphics ). <br><br><h2>  New approach </h2><br>  But what if we can run unchanged binary code, only with improved graphics? <br><br>  Suppose you run the game in an emulator.  You do not have the source code, but you can be sure that somewhere in the binary code the <em>‚Äúdraw sprite‚Äù</em> method is hidden.  Or the <em>"deduce character"</em> method.  Or the <em>‚Äúplay sound effect‚Äù</em> method.  Or the <em>"render polygon"</em> method. <br><br>  What if you can use the debugger / disassembler integrated with the emulator to find the input points of these methods?  What if we figure out which registers which parameters contain, or their order in the stack? <br><br>  What if we can program the emulator to call an arbitrary C ++ method, when these input points need to be executed, retrieve the state of the registers at this moment, and execute our own sprite rendering code?  Or the rendering code for the TrueType font?  Or MP3 play code?  Or a few OpenGL calls? <br><br>  If we manage to replace all these methods with C ++ implementations, then as a result we will get a game, exactly the following logic of the original, but looking modern.  We will get an emulated remake with accurately reproduced gameplay, which can be gradually completed, and for this, a very superficial understanding of the disassembled code is enough. <br><br>  I researched the question a bit and it turned out that this is a fairly fresh idea.  Why hasn't anyone tried this before? <br><br>  Will this work? <br><br><h2>  Concept check </h2><br>  I decided to check out this crazy idea.  I wrote an 8086 + CGA emulator with only 44 implemented opcodes, which are barely enough to launch the Goody screen saver screen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0b6/757/5a5/0b67575a51304d40e4c96d1d36f21718.jpg"></div><br><br>  I wrote two tools - a disassembler and a launcher with a gdb-like interface that allow you to step through the code, set breakpoints, and so on. <br><br>  How do we find interesting features without complete disassembling?  I used a variety of methods - setting checkpoints and studying registers, executing code on small fragments, randomly filling in the contents of a simulated video memory to see what would be displayed, patching the code to skip some calls, to see what stopped working, and studying the disassembled code, to add helpful comments for me. <br><br>  Thanks to these techniques, I managed to find some interesting "functions": <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d4/ee7/ca2/3d4ee7ca250cc8452f546ca501488836.png"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a9c/574/f18/a9c574f18138afa938ddcd0f1e3e6d0c.png"></div><br><br>  I added a C ++ interceptor to do my own drawing in a separate window: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/521/ba1/06a/521ba106a6f1d3d3c0e1af88275c6b9b.png"></div><br><br>  I added some rough graphics, crossed my fingers, and ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cdb/98e/d45/cdb98ed452f451037a82a5b4321210c2.jpg"></div><br><br>  ... and see, I have a "remake"!  Look, the ‚Äúold‚Äù window runs next to the ‚Äúnew‚Äù window;  This is not a static image, but a new graphic, driven by the original X86 code! <br><br><h2>  See for yourself </h2><br>  The full demo (x86 emulator / disassembler / debugger, Goody interceptors and draft graphics) is available on <a href="https://github.com/ggambetta/emulator-backed-remakes">GitHub</a> .  It works on Linux and Mac;  SDL2 and C ++ 0x compiler are required. <br><br>  <strong>The source code is</strong> released under the <em>Whatever / Credit</em> license: <em>you can do whatever you like with the code;</em>  <em>If you create something cool, I will be grateful for the indication of my authorship</em> .  If anything, the code is not even alpha-quality - this is the quality of the ‚Äúconcept check / works on my machine‚Äù. <br><br>  The repository contains the <strong>original game</strong> ( <code>goody.com</code> ) - I received the unofficial blessing of one of the authors of the original Gonzo Suarez on its distribution, besides, it is easy to find on any site with outdated software;  if someone is against, I will remove the game from the repository. <br><br>  I sketched the <strong>graphics</strong> using my horrible Gimp skills and resources in the public domain or with a Creative Commons license from <a href="http://opengameart.org/">OpenGameArt</a> : <a href="http://opengameart.org/content/dawn-of-the-gods">1</a> , <a href="http://opengameart.org/content/classical-ruin-tiles">2</a> , <a href="http://opengameart.org/content/pixel-art-castle-tileset">3</a> , <a href="http://opengameart.org/content/2d-platformer-side-scroller-stone-fence-street-lamp">4</a> , <a href="http://opengameart.org/content/platformer-art-replacement-gui-text">5</a> .  If the artist reading this article wants to share the original graphics for this demo, I will be very grateful. <br><br><h2>  Answers to Expected Questions </h2><br>  <strong>Q: You are aware that there is an excellent Goody remake?</strong> <br><br>  Oh yeah.  But I chose Goody to test the concept, because I liked this game most of all from the CGA era, because it is contained in the COM file, that is, it does not need the EXE loader, and because it is obviously based on tiles, that is, I thought that it will be enough to simply work with it <br><br>  <strong>Q: Why didn't you use any available x86 emulators or even DOSBox?</strong> <br><br>  A: Because writing an x86 emulator is an interesting task.  After the concept verification phase, I intend to fully accommodate DOSBox for this. <br><br><h2>  Thoughts in conclusion </h2><br><h3>  Is the system scalable? </h3><br>  Can I use these techniques for more complex games?  I see no obstacles.  You can always start with DOSBox and replace, say, the sound.  This will be the beginning of a partial remake. <br><br>  Another question is where to draw the line - at what level of abstraction to add interceptors.  To some extent, you can create interceptors at the lowest level in DOSBox ‚Äî by drawing individual pixels.  My concept check performs interception at the level of <em>‚Äútile drawing‚Äù</em> and <em>‚Äúglyph drawing‚Äù</em> .  But take, for example, fonts.  Drawing a glyph behind a glyph is quite suitable for aspects such as money and life counters, but for text instructions on the main screen, you can think of something better, for example, an interceptor at the <em>‚Äúline draw‚Äù</em> level, and use FreeType to get a proportional font with beautiful kerning . <br><br>  Similar reasoning applies to 3D games with software rendering such as X-Wing or Stunts.  Maybe it will be possible to intercept the <em>‚Äúrender triangle‚Äù</em> function, in which case very low poly models will be rendered in the video processor, or intercept the <em>‚Äúrender model‚Äù</em> function and use new 3D models.  Or you can take the original Wing Commander, which does not even use 3D-models - instead of them there are bit images of ships of higher resolution, and actually render 3D-ships. <br><br>  Another example is sound.  You can intercept the programmable timer and speaker I / O ports to generate corresponding waves on the fly (assuming that DOSBox does this), or intercept the <em>‚Äúplay sound effect‚Äù</em> function and play MP3 files instead of sounds. <br><br>  What about frame rates?  Animation death Goody takes two frames and lasts about a second.  Even with beautiful resources, the animation will still look ragged.  I think that solving this type of problem would be a smarter state rendering processing - ideally, you could write a completely new renderer based on the game state read from memory without having to directly intercept any rendering methods. <br><br><h3>  Applicability beyond games </h3><br>  This idea can be applied not only in games.  Some systems use very old software, because over the years so many details of business logic have been added that it is impossible or impractical to rewrite such systems from scratch.  But thanks to these techniques, it will be possible to perform the logic without changes and replace the I / O / database code with something more modern. <br><br><h3>  Legality </h3><br>  Although <strong>this is not legal advice, because I am not a lawyer</strong> , I cannot think of any reasons why the technique itself may be illegal, because the original binary data of the game is not supplied as a ‚Äúremake‚Äù (only if the game itself is not distributed free of charge). <br><br>  With graphics, everything is more complicated.  In the remake there can be no original resources;  artists and musicians will have to redo them from scratch.  But even then, I'm not sure whether the creation of, say, a 3D model of X-Wing or the image of Darth Vader is legitimate.  Perhaps they can be considered fan art? <br><br><h3>  Additional reading </h3><br>  If you like reverse engineering, old games, or both, then you should explore <a href="http://fabiensanglard.net/">Fabien Sanglar's website</a> . <br><br><h2>  Summarize </h2><br>  The concept check confirms the viability of the idea;  in the end, it turned out that she was not so insane.  Remakes can be done by connecting the modern rendering code / sound / network data transfer to the emulator / virtual machine, in which the original game is running. <br><br>  Will this revolutionary change the way you create remakes?  I really hope so!  I would love to play games of the past with modern graphics and original gameplay. </div><p>Source: <a href="https://habr.com/ru/post/343290/">https://habr.com/ru/post/343290/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343278/index.html">How we control the quality of the code in the Android Browser. Yandex lecture</a></li>
<li><a href="../343282/index.html">How data centers work: today and tomorrow</a></li>
<li><a href="../343284/index.html">Interview with the main digital strategist Adblock Plus: ‚ÄúWell, I sleep well, Burumych, great!‚Äù</a></li>
<li><a href="../343286/index.html">How high-frequency trading changed the situation on world markets: 4 conclusions of analysts at Credit Suisse</a></li>
<li><a href="../343288/index.html">How do you implement authentication, buddy?</a></li>
<li><a href="../343294/index.html">Parser on PHP knee or how I replenished my music collection</a></li>
<li><a href="../343296/index.html">The story of several hard forks: how did the bitcoin network evolve</a></li>
<li><a href="../343298/index.html">Integration tests for Java using TestContainers. Less madness, more order, all automatically</a></li>
<li><a href="../343300/index.html">We compare what is impossible: cheap hosting and cloud on the VMware stack</a></li>
<li><a href="../343302/index.html">ScadaPy JSON server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>