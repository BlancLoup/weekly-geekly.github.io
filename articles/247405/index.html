<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Approaches to the creation of a scripting language for the description of board games</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It just so happened that I wrote the games only for myself, and never did it professionally. 
 But the experience to write DSL (Domain Specific Langua...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Approaches to the creation of a scripting language for the description of board games</h1><div class="post__text post__text-html js-mediator-article">  It just so happened that I wrote the games only for myself, and never did it professionally. <br>  But the experience to write DSL (Domain Specific Language) to reduce the routine of writing completely different code, at least some have. <br>  This is what I want to share: how to organize the immensity. <br><br><img src="https://habrastorage.org/files/0df/330/867/0df33086707e4d49a5aaf3d512385bec.jpg"><br><br>  Our good Hubr-user <a href="http://habrahabr.ru/users/glukkazan/" class="user_link">GlukKazan</a> writes many articles about what wonderful products there are for creating various board games.  Such as <b>Zillions of Games</b> and <b>Axiom Development Kit</b> . <br>  However, these programs are not universal.  And you always want to improve them.  But these products are not free, so you have to write the software again. <br>  <a href="http://habrahabr.ru/users/glukkazan/" class="user_link">GlukKazan is</a> working on the open source project <b>Dagaz</b> , which is divided into excellent articles (for example, <a href="http://habrahabr.ru/post/242547/">Dagaz: A new beginning</a> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, suppose we want to create a universal game engine for board games, and we want to see a scripting language as its basis, which helps to explain to the engine the rules of the game. <br>  How do we want to see him? <br>  1) The language should be as universal as possible in order to describe almost any rules of the game. <br>  2) However, the language should be as simple as possible, with a minimum of constructs. <br>  3) A description of the rules should be easy to read igrodelu and to write their games <br>  4) For most cases, the game can be written, complementing / changing already written <br>  5) Communication (API) with the script should be as simple as possible.  So that you can easily write bots and AI. <br>  At first glance, it seems that no one will need the wasted efforts at all, since the routine cannot be reduced, it is easier to write the games immediately ready. <br>  But it is not. <br>  Everything is much easier! <br><a name="habracut"></a><br><h4>  Demiurgi and black box </h4><br>  Well, imagine that we are demiurgists, and are capable, no, have already written this scripting language.  Yes, yes, already.  Let's see what this language can and can do. <br><br><h4>  Do not put restrictions where they are not. </h4><br>  For example, the <b>Dagaz</b> project (and even its predecessors <b>Axiom</b> and <b>ZoG</b> ) focuses on board games.  However, it is quite difficult even to explain to a person how a board game is different from a short game.  What can we say, to describe it in precise definitions in some programming language is even more difficult. <br>  Therefore, the first and foremost rule - do not put restrictions where there are none! <br>  We will consider not board games, but board games. <br>  Let's look at the following list, which we want to describe and play with our engine. <br><ul><li>  Chess </li><li>  Splyut </li><li>  Carcassonne </li><li>  Points </li><li>  Fifteen </li><li>  Dominoes </li><li>  Crystal repainting </li><li>  Fool </li></ul><br>  They are very different at first glance.  What unites them all?  Is there anything? <br>  Yes.  What unites them is that <br><ol><li>  1 player always walks at one time. </li><li>  Almost always, the player can think indefinitely (consider separately when there will be a time limit per turn) </li><li>  Each time there is a limited number of possible actions.  The game of the Point is an exception (for the point can be put anywhere on an infinite board).  For convenience, we will somewhat trim the points, and not change the engine </li></ol><br>  Everything, only these restrictions on the engine! <br>  So, in essence, we want to have an engine that should be able to ask 2 basic questions: who is walking now, what possible actions he can do. <br><pre><code class="bash hljs">IN: who OUT: Player1 IN: actions OUT: [SomeAction1, SomeAction2 Param21, ...]</code> </pre> <br>  And the engine should be able to perform one action - to perform the selected action. <br><pre> <code class="bash hljs">action SomeAction3</code> </pre><br>  Well, maybe another action is to choose a preliminary action (for example, if the time allotted for the course ends, and the move has not yet been made, in order not to finish the game or choose a random action, you can choose a preliminary action in this case). <br><pre> <code class="bash hljs">preaction SomeAction5</code> </pre><br>  No need to put any more restrictions, because they still want someone to get around. <br><br><h4>  Think wider </h4><br>  But what if we write Poker?  Yes, and in the Fool, you can throw a card, but you can not throw.  Say Paz, or choose your own suit - this is also an action.  Putting a field in Carcassonne is also an action. <br>  Where is Tetris?  Tetris will probably be very difficult to do, because this is a real-time game, and it is hardly necessary.  You can easily modify the engine, but not relevant. <br><br><h4>  Do not castrate scripting language </h4><br>  I do not recommend to follow the principle - I will get all the data from the script and will simulate it in the engine.  For in this way, it is easier to use the <b>.ini</b> file as a configuration, and not to fence a scripting language, since there will be as much sense. <br>  And how to get a card for the Fool, when he fought off?  Just following we will walk again and there will be only 1 course option - take a card.  If anything, you can add values ‚Äã‚Äãfor the auto action - that is to say, not asking the player which option to choose. <br><pre> <code class="bash hljs">IN: who OUT: Player3 <span class="hljs-comment"><span class="hljs-comment">#  8  (     10 -   ) IN: actions OUT: [Attack 8Diamonds, Attack 10Diamonds 10Hearts, ...] IN: action Attack 8Diamonds OUT: action Attack 8Diamonds IN: who OUT: Player4 #   ,   ?  IN: actions OUT: [TakeTable, PassShowOnly QueenDiamonds, Defend QueenDiamonds, Pass 6Diamonds, PassShowOnly 6Diamonds,...] IN: action Pass 6Diamonds OUT: action Pass 6Diamonds IN: who OUT: Player1 #     ,     IN: actions OUT: [TakeTable, Defend KingDiamonds 6Diamonds, Defend KingDiamonds 8Diamonds, Defend AceDiamonds 6Diamonds, Defend AceDiamonds 8Diamonds, PassShowOnly KingDiamonds, Pass KingDiamonds, PassShowOnly AceDiamonds, Pass AceDiamonds] IN: action Defend AceDiamonds 6Diamonds OUT: action Defend AceDiamonds 6Diamonds IN: who OUT: Player3 #   3  IN: actions OUT: [Pass, Attack AceHearts] IN: action Pass OUT: action Pass IN: who OUT: Player2 #  ,  ,   IN: actions OUT: [auto Pass] IN: action Pass OUT: action Pass IN: who OUT: Player4 #  IN: actions OUT: [auto Pass] IN: action Pass OUT: action Pass IN: who OUT: Player1 #       IN: actions OUT: [Defend KingDiamonds, TakeTable] IN: action Defend KingDiamonds OUT: action Defend KingDiamonds IN: who OUT: Player3 #   1 ,      IN: actions OUT: [auto Take AceHearts] IN: action Take AceHearts OUT: action Take AceHearts IN: who OUT: Player1 #   2    IN: actions OUT: [auto Take 6Hearts 10Clubs] IN: action Take 6Hearts 10Clubs OUT: action Take 6Hearts 10Clubs</span></span></code> </pre><br>  Let the engine know nothing about the game.  It is just a pipeline for queries and beautiful display.  No more, but no less. <br><br><h4>  Where without settings </h4><br>  No matter how simple the communication with the script is, you will not be able to manage without the settings. <br>  In Fool, you can play together, three, four together, five of us and even six of us.  You can play every man for himself, 2x2, 3x3. <br>  We need to send settings.  Add another command.  Ok, two, you have to check the status. <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> players = 4 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> groups = 2x2 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> startFrom = Player3 IN: get name OUT: name = 15-puzzle</code> </pre><br><br><h4>  Game first </h4><br>  It must be remembered that we create games.  And any games are united by the fact that <br><ul><li>  The game may not be started. </li><li>  Game can go </li><li>  The game can be completed and have a final result. </li></ul><br>  Let's create some more teams that reflect new abilities - load the game, start the game, find out the result of the game. <br><pre> <code class="bash hljs">IN: load /path/chess.game OUT: load /path/chess.game IN: start OUT: start IN: result OUT: Finished ; Win Player1; Details Player1 78, Player2 38 OUT: Loaded /path/chess.game OUT: Started</code> </pre><br><br><h4>  Separate the flies from the chops.  Visualization language </h4><br>  Do not chase for excessive versatility. <br>  Let us remember that bots have visualization on the drum, but the person is very picky and wants to see a very beautiful picture. <br>  The main conclusion from this is that visualization languages ‚Äã‚Äãand messaging languages ‚Äã‚Äãare generally different.  Chasing the universality of the scripting language is not worth it, because the tasks are different. <br>  The language of the visualization messages does not need to be customized to the language of the exchange. <br>  Suppose you have created that for every object necessary for visualization there is a format of visualization (hereinafter FW), which describes which picture (or which pictures) should be displayed, in which part of the screen, what will be superimposed. <br>  We first need to display everything.  So, the team needs a visualization of the situation, which gives a list of objects in the format of PV. <br>  After all, we must see a chessboard with figures, or that we were given out for the Fool. <br><pre> <code class="bash hljs">IN: view OUT: [ (Piece1, ), (King, ), ..... ]</code> </pre><br>  By the way, it is often necessary to visualize what does not appear as figures in the game itself - for example, for the Fool, it is necessary to display the number of closed cards from opponents, as well as the deck. <br>  In addition, you need to know how to visualize possible moves. <br>  That is, there should be a command to visualize actions, which contains a list of all possible actions, and to each of them in one of two options a new description: full or partial (with the addition of the necessary display figures, and the removal of figures from the existing ones). <br>  For example, in the Fool it is necessary to remove the selected card from the deck, but this card should appear on the table. <br><pre> <code class="bash hljs">IN: view actions OUT: [(Attack 8Diamonds, Diff [remove Card5, add (Card5, ), ... ]), ... ]</code> </pre><br>  And in chess, the chosen piece should become the ‚Äúchosen‚Äù color, and the same piece will appear on the spot of the selected cell.  In the event of an attack, moreover, the broken figure should disappear. <br>  In addition, you need to know when you need to display a possible action. <br>  Actually, either in the previous team shove, or add a new command. <br><pre> <code class="bash hljs">IN: view actions OUT: [(Attack 8Diamonds, Diff [remove Card5, add (Card5, ), ... ], OnChoose Card5), (Pass, Diff [add PassWord], OnChoose PassLabel), ... ]</code> </pre><br><h5>  Artificial intelligence language </h5><br>  It is desirable to write AI modules separately, but integrate them into a common script. <br>  The conversation of the AI ‚Äã‚Äãin principle will not be very difficult. <br><pre> <code class="bash hljs">IN: analize OUT: [75 Pass, 44 Attack 6Diamonds, 59 Attack 8Diamonds] IN: analize quick OUT: [10 Pass, 5 Attack 6Diamonds, 20 Attack 8Diamonds]</code> </pre><br>  Implementing this is much harder than describing.  It may be necessary forks. <br><br><h4>  Mutual understanding </h4><br>  It is necessary for the engine to understand whether it makes mistakes in a conversation with the script or not.  Communication should be mutual, especially when the interaction is a client-server application. <br>  Essentially, one team is needed: the last command received. <br><pre> <code class="bash hljs">IN: it OUT: result</code> </pre><br>  The same command should be answered when the answer is not important.  That is, the settings taken by action. <br>  And then someone put a time limit on thinking, the player will sleep this time, it‚Äôs like, and the engine already happened to be like a player. <br>  Do not forget that the engine can respond with an error. <br><pre> <code class="bash hljs">IN: action TakeTable OUT: ERROR action is out list IN: who OUT: ERROR game result is Finished</code> </pre><br><br><h4>  No gods burn pots </h4><br>  Well, we have done quite a lot about what our script should be able to do, and what we don't care about. <br>  All, not ALL logic rests on the script.  So and the only way we will achieve the full universality of any board games. <br>  Any compromise here leads to restrictions, because of which more than once and not two will have to dance with tambourines. <br>  But we wanted an easy, simple language!  And we offer everything, everything put on igrodelov. <br>  If you can not, but really want, then you can!  It should be hard for a programmer, not an igrodel.  And so it will be. <br><br><h4>  Be igrodelami </h4><br>  Be a little igrodelom yourself! <br>  One of the most amazing properties of C, which still amazes me, is that the type string is a library function. <br>  No need to wait for igrodely come up with what a board, field or deck of cards.  Write these concepts in a scripting language. <br>  Ordinary people just write, take the board, and create such fields here. <br>  That is why it is necessary that all written scripts can be changed on top. <br>  I wanted to play not a static board, but a dynamic one, please change the board so that its state will be checked every time. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># DynamicBoard import StaticBord let board { constuctor {let board = prevous board} on_player_change {let board = recalculate} }</span></span></code> </pre><br><br><h4>  Caesar's Caesar's, and God of Gods </h4><br>  Even despite the heap of written libraries by the programmer himself, the script code will become lighter, but not easy. <br>  How to remove unnecessary pieces of code? <br>  It is necessary to understand that we need a sublanguage, DSL of this scripting language written in the language itself. <br>  It sounds scary, but not everything is hell that they paint. <br>  For me, one of the most beautiful libraries is the Parsec parser for Haskell.  This is much more beautiful than implementing C strings. <br>  At least the lines were planned to be included in the language, but the parser was not planned to be written when Haskel was composed. <br>  In fact, they created there only with the help of language means 2 levels of sublanguage for creating a parser (in fact, there are at least 4 additional levels there). <br>  1) The level of tokens / characters.  At this incomprehensible to the majority level, almost no one climbs to write their own functions, library functions are lacking. <br>  For example, <br>  end of line - <b>eof</b> <br>  take 1 token / character - <b>anyToken</b> <br>  Try a parser if it falls, to pretend that it did not consume tokens - <b>try p</b> <br>  Or: try a parser, if it falls without consuming tokens, use the second parser - <b>p1 &lt;|&gt; p2</b> <br>  Look forward: try the parser, pretend that it did not use tokens, if the parser is successful - <b>lookAhead p</b> <br>  (in reality there are a lot more functions). <br>  The combination of these tokenistic functions makes it possible to generate very complex parsers. <br>  2) The level of parsers.  So intuitive, complemented by a zoo of functions: such as <br>  many parsers - <b>many p</b> <br>  many, at least 1 parser - <b>many1 p</b> <br>  parser split - <b>p `sepBy` sepp</b> <br>  line - <b>string</b> <br>  between parsers - <b>between p1 p2</b> <br>  ... <br><br>  Actually, when the library user comes, he sees that ‚Äúeverything is built before us‚Äù, there is a ready-made designer, just take and collect what you need <b>and at the level that interests you</b> . <br>  The same goes for our language.  Should not igrodel think how to write a filter function, it should be already written there. <br>  Just take it and use it, the script language must speak to its users! <br>  If I want checkers, but in order to place 1 or 2 checkers in the cell, I only need to re-create the description of the cell. <br>  I want a square board - I load myself a square board, I want a hexagonal one - I upload a 6-angle one. <br>  I need to, depending on the removal of pawns from the board, the fields of the board itself are destroyed - we make the board dynamic and follow the destruction of the pawns. <br><br><h4>  Instant soup or no limit to perfection </h4><br>  We all love to eat tasty food, but not everyone can cook tasty food.  This requires skill and time. <br>  Igrodely such soup lovers. <br>  They also need to facilitate the share. <br>  It is necessary in our skipt language more ... meta-language.  Exhale, just game templates. <br>  Chess-like-games, Checkers-like-games, fool-like-games, card-games, ... <br>  Give the opportunity to simply configure ready-made solutions, rather than engage in programming. <br><pre> <code class="bash hljs">import ChessLikeGame; <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> params = { previous params; players = 4; board_length = 75 symmetric start positions = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; start_white_positions = [A1, C1,D1, ....] }</code> </pre><br><br><h4>  Conclusion </h4><br>  Well, if you look at our articles at the beginning of the article, you may be horrified, we wanted to have a super-universal scripting language, and at the same time be essentially configuring ready-made solutions, it is easy to change the logic of written games. <br>  In fact, we understood what we wanted, what we didn‚Äôt want, understood that the main part of the written code should be written in a script language, and the engine should be left with visualization and reaction. <br><br>  There is no difference between chess, Balda and a fool. <br>  Who walks?  Player 1 <br><pre> <code class="bash hljs">IN: who OUT: Player1</code> </pre><br>  There is no difference between dots and tag crystal-repainting.  There is a limited choice of actions each time. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># chess action Castle King Rook2 # checkers action Attack Men7 D2 F4 # splut action Pull Troll E5 D5 # points action Add 10-14 # carcassonn action Put Title1Tree Place8-17 #15-puzzle action Push 8 # dominos action Put Title1-6 Place4-1 Left # crystall painting action Color Yellow # durak action New QuenHearts</span></span></code> </pre><br>  It just needs to be understood, and then it becomes clear how to explain it to a computer. </div><p>Source: <a href="https://habr.com/ru/post/247405/">https://habr.com/ru/post/247405/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247393/index.html">https comes on geektimes / habrahabr?</a></li>
<li><a href="../247395/index.html">Internet in a closed country: the experience of North Korea</a></li>
<li><a href="../247397/index.html">WS_EX_LAYERED style for child windows in Windows 8</a></li>
<li><a href="../247399/index.html">History of the creation of Norton Commander. Part 1: introduction</a></li>
<li><a href="../247401/index.html">Five popular myths about C ++, part 1</a></li>
<li><a href="../247409/index.html">Potential Android Telegram Vulnerability</a></li>
<li><a href="../247413/index.html">Pulp Fiction Weekend - Microsoft Press Free Books</a></li>
<li><a href="../247415/index.html">Marxico - markdown editor for Evernote</a></li>
<li><a href="../247419/index.html">Beautiful Fall: Gravity CSS3 Animation</a></li>
<li><a href="../247421/index.html">Recovering deleted data using Scalpel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>