<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Arduino and segment LCD indicator</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Arduino, as you know, has an excellent built-in library for displaying information on LCD indicators, which, however, only supports matrix sign-synthe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Arduino and segment LCD indicator</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f27/36d/abd/f2736dabd76398e0095af515187d944a.jpg" alt="image"><br><br>  Arduino, as you know, has an excellent built-in library for displaying information on LCD indicators, which, however, only supports matrix sign-synthesizing indicators.  It so happened that I had in my hands the usual segment indicator, the simplest 10-bit MT-10T8.  The task was fully consistent with the ability of this indicator - to display the current temperature for a single device, which for simplicity we call a laboratory temperature meter.  The device is controlled by the Arduino, specifically its kind of Seeduino Mega (analogue of the Arduino Mega).  After a brief acquaintance with a rather concise <a href="http://www.melt.com.ru/docs/MT-10T7_8_9.pdf">datasheet</a> on the MT-10T8, it was decided to spend a little time and make friends with this indicator Arduino. <br><a name="habracut"></a><br>  The indicator uses a simple control protocol, the address and data are transmitted via a parallel 4-bit bus.  The protocol does not represent any difficulties, the address of the symbol fits into 4 bits of the bus, data is transmitted by two tetrads of 4 bits (and that 8 bits per symbol).  The only thing you should pay attention to and not confuse is the recommended timings of the indicator control signals.  It is desirable that at least the CPU time is spent on accessing the indicator, but it is necessary to ensure stability, because, as practice has shown, the indicator very easily goes crazy. <br><br>  The minimum delays of tens of nanoseconds required by the datasheet are not provided with Arduino, but after a brief search on the arduino website, there was an advice to use the <i>‚Äúnop‚Äù</i> assembler command for short delays 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>__asm__("nop\n\t");</code> <br> <br>  This design at 16 MHz crystal gives a delay of 62.5 ns.  Datashit operates with minimum timings of 50, 100 and 200 nanoseconds, we will also have 62.5, 125 and 250 nanoseconds.  It suits. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b9/3e8/ace/9b93e8acef854e454dc90e3ea5564de2.jpg" alt="image"><br><br>  The indicator connection was made by improvised means, the resulting ‚ÄúFrankenstein‚Äù is shown in the photo.  The control program uses the hardware function of the indicator to display the characters "in a row", i.e.  if, after displaying a character at a specific address, call the next data transfer command without setting an address on the bus, the character will be displayed at the address following the current one. <br><br>  Now you should probably answer the question - why?  In fact, if a 10-bit matrix indicator costs 250 rubles, why use a minimalistic segment indicator, which is only 70 rubles.  cheaper?  Well, firstly, the ruble protects the penny, and secondly, to put it mildly, the LiquidCrystal library is not small in volume.  And then minimalism taxis. <br><br>  Actually the code, I think, it does not require special explanations.  First, the functions themselves display information on the indicator: <br><br> <code>// writeSymbol -      <br> // address -   (0..9) <br> // symbol -   <br> // dot -    <br> void writeSymbol(byte address, byte symbol, boolean dot) <br> { <br> //   <br> //    <br> digitalWrite(A0_PIN, LOW); <br> //    <br> digitalWrite(DB0_PIN, bitRead(address,0)); <br> digitalWrite(DB1_PIN, bitRead(address,1)); <br> digitalWrite(DB2_PIN, bitRead(address,2)); <br> digitalWrite(DB3_PIN, bitRead(address,3)); <br> __asm__("nop\n\t"); //62.5ns <br> //    <br> digitalWrite(WR1_PIN, HIGH); <br> __asm__("nop\n\t""nop\n\t"); //125.5ns <br> digitalWrite(WR1_PIN, LOW); <br> __asm__("nop\n\t"); //62.5ns <br> //  <br> writeNextSymbol(symbol, dot); <br> } <br> <br> // writeNextSymbol -    ,    <br> // symbol -   <br> // dot -    <br> void writeNextSymbol(byte symbol, boolean dot) <br> { <br> if (dot) <br> symbol+=16; <br> //    <br> digitalWrite(DB0_PIN, bitRead(symbol,0)); <br> digitalWrite(DB1_PIN, bitRead(symbol,1)); <br> digitalWrite(DB2_PIN, bitRead(symbol,2)); <br> digitalWrite(DB3_PIN, bitRead(symbol,3)); <br> //    <br> digitalWrite(A0_PIN, HIGH); <br> //    WR <br> __asm__("nop\n\t""nop\n\t""nop\n\t""nop\n\t"); //250ns <br> //      <br> digitalWrite(WR1_PIN, HIGH); <br> __asm__("nop\n\t""nop\n\t"); //125.5ns <br> digitalWrite(WR1_PIN, LOW); <br> //     <br> //    <br> digitalWrite(DB0_PIN, bitRead(symbol,4)); <br> digitalWrite(DB1_PIN, bitRead(symbol,5)); <br> digitalWrite(DB2_PIN, bitRead(symbol,6)); <br> digitalWrite(DB3_PIN, bitRead(symbol,7)); <br> //    WR <br> __asm__("nop\n\t""nop\n\t""nop\n\t""nop\n\t"); //250ns <br> //   <br> digitalWrite(WR1_PIN, HIGH); <br> __asm__("nop\n\t""nop\n\t"); //125.5ns <br> digitalWrite(WR1_PIN, LOW); <br> } <br> <br> // clearAll -   <br> void clearAll() <br> { <br> for (int i=0;i&lt;10;i++) <br> { <br> writeSymbol(i, 0, false); <br> } <br> } <br> <br> // unblockBus-   /. <br> //     ,   <br> //        <br> void unblockBus() <br> { <br> //    <br> digitalWrite(A0_PIN, LOW); <br> //  0F -     <br> digitalWrite(DB0_PIN, HIGH); <br> digitalWrite(DB1_PIN, HIGH); <br> digitalWrite(DB2_PIN, HIGH); <br> digitalWrite(DB3_PIN, HIGH); <br> __asm__("nop\n\t"); //62.5ns <br> //   <br> digitalWrite(WR1_PIN, HIGH); <br> __asm__("nop\n\t""nop\n\t"); //125.5ns <br> digitalWrite(WR1_PIN, LOW); <br> __asm__("nop\n\t"); //62.5ns <br> //  : DB0=1 <br> digitalWrite(DB0_PIN, HIGH); <br> digitalWrite(DB1_PIN, LOW); <br> digitalWrite(DB2_PIN, LOW); <br> digitalWrite(DB3_PIN, LOW); <br> //    <br> digitalWrite(A0_PIN, HIGH); <br> //    WR <br> __asm__("nop\n\t""nop\n\t""nop\n\t""nop\n\t"); //250ns <br> //   <br> digitalWrite(WR1_PIN, HIGH); <br> __asm__("nop\n\t""nop\n\t"); //125.5ns <br> digitalWrite(WR1_PIN, LOW); <br> } <br></code> <br><br>  And an example of combat use: <br><br> <code>// ,    Arduino   <br> const byte A0_PIN=10; <br> const byte WR1_PIN=8; <br> const byte WR2_PIN=9; <br> const byte DB0_PIN=2; <br> const byte DB1_PIN=3; <br> const byte DB2_PIN=4; <br> const byte DB3_PIN=5; <br> <br> //    <br> //     <br> const byte SEG_A=8; <br> const byte SEG_B=32; <br> const byte SEG_C=64; <br> const byte SEG_D=4; <br> const byte SEG_E=2; <br> const byte SEG_F=128; <br> const byte SEG_G=1; <br> const byte SEG_H=16; <br> <br> // " ".        <br> const byte WHITESPACE = 0; //    <br> //  <br> const byte DIGIT_ZERO = SEG_A + SEG_B + SEG_C + SEG_D + SEG_E + SEG_F; <br> const byte DIGIT_ONE = SEG_B + SEG_C; <br> const byte DIGIT_TWO = SEG_A + SEG_B + SEG_G + SEG_E + SEG_D; <br> const byte DIGIT_THREE = SEG_A + SEG_B + SEG_G + SEG_C+ SEG_D; <br> const byte DIGIT_FOUR = SEG_F + SEG_G + SEG_B + SEG_C; <br> const byte DIGIT_FIVE = SEG_A + SEG_F + SEG_G + SEG_C + SEG_D; <br> const byte DIGIT_SIX = SEG_A + SEG_F + SEG_G + SEG_C + SEG_D + SEG_E; <br> const byte DIGIT_SEVEN = SEG_A + SEG_B + SEG_C; <br> const byte DIGIT_EIGHT = SEG_A + SEG_B + SEG_C + SEG_D + SEG_E + SEG_F + SEG_G; <br> const byte DIGIT_NINE = SEG_A + SEG_B + SEG_C + SEG_D + SEG_F + SEG_G; <br> <br> // .  <br> const byte SYMBOL_MINUS = SEG_G; <br> const byte SYMBOL_C = SEG_A + SEG_F + SEG_E + SEG_D; <br> const byte SYMBOL_DEGREE= SEG_A + SEG_B + SEG_G + SEG_F; <br> const byte SYMBOL_UPDASH = SEG_A; <br> const byte SYMBOL_LOWDASH = SEG_D; <br> <br> void setup() { <br> // ,    -   <br> pinMode(A0_PIN, OUTPUT); <br> pinMode(WR1_PIN, OUTPUT); <br> pinMode(WR2_PIN, OUTPUT); <br> pinMode(DB0_PIN, OUTPUT); <br> pinMode(DB1_PIN, OUTPUT); <br> pinMode(DB2_PIN, OUTPUT); <br> pinMode(DB3_PIN, OUTPUT); <br> unblockBus(); <br> } <br> <br> void loop() { <br> //    <br> clearAll(); <br> delay(1000); <br> // <br> writeSymbol(0, DIGIT_ZERO, false); <br> delay(100); <br> writeNextSymbol( DIGIT_ONE, false); <br> delay(100); <br> writeNextSymbol( DIGIT_TWO, false); <br> delay(100); <br> writeNextSymbol( DIGIT_THREE, false); <br> delay(100); <br> writeNextSymbol( DIGIT_FOUR, false); <br> delay(100); <br> writeNextSymbol( DIGIT_FIVE, false); <br> delay(100); <br> writeNextSymbol( DIGIT_SIX, false); <br> delay(100); <br> writeNextSymbol( DIGIT_SEVEN, false); <br> delay(100); <br> writeNextSymbol( DIGIT_EIGHT, false); <br> delay(100); <br> writeNextSymbol( DIGIT_NINE, true); <br> delay(500); <br> clearAll(); <br> writeSymbol(0, SYMBOL_MINUS, false); <br> delay(100); <br> writeNextSymbol( SYMBOL_C, false); <br> delay(100); <br> writeNextSymbol( SYMBOL_DEGREE, false); <br> delay(100); <br> writeNextSymbol( SYMBOL_UPDASH, false); <br> delay(100); <br> writeNextSymbol( SYMBOL_LOWDASH, false); <br> delay(1000); <br> clearAll(); <br> //    156.4   <br> writeSymbol(3, SYMBOL_MINUS, false); <br> writeNextSymbol( DIGIT_ONE, false); <br> writeNextSymbol( DIGIT_FIVE, false); <br> writeNextSymbol( DIGIT_SIX, true); <br> writeNextSymbol( DIGIT_FOUR, false); <br> writeNextSymbol( SYMBOL_DEGREE, false); <br> writeNextSymbol( SYMBOL_C, false); <br> delay(1000); <br> clearAll(); <br> //    <br> for (int i=0;i&lt;10;i++) <br> { <br> writeSymbol(i, SYMBOL_UPDASH, false); <br> if (i&gt;0) writeSymbol(i-1, WHITESPACE, false); <br> delay(200); <br> } <br> for (int i=0;i&lt;10;i++) <br> { <br> writeSymbol(9-i, SYMBOL_LOWDASH, false); <br> delay(200); <br> } <br> delay(1000); <br> } <br> <br></code> </div><p>Source: <a href="https://habr.com/ru/post/343694/">https://habr.com/ru/post/343694/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343682/index.html">Administering Juniper Switches with Ansible</a></li>
<li><a href="../343684/index.html">Regression tests for memory leaks, or how to write a memory profiler for .NET applications</a></li>
<li><a href="../343688/index.html">Implementation of the simplest investment strategy based on API MOEX (Moscow Exchange)</a></li>
<li><a href="../343690/index.html">How to get on the road to OS development</a></li>
<li><a href="../343692/index.html">Open the CrackMe winter contest: break-rover</a></li>
<li><a href="../343696/index.html">Latent parasites</a></li>
<li><a href="../343700/index.html">Flying snowflakes</a></li>
<li><a href="../343702/index.html">tldr - alternative man with self-titled name</a></li>
<li><a href="../343704/index.html">Learning a computer to write like Tolstoy, Volume I</a></li>
<li><a href="../343706/index.html">I created an application that makes learning algorithms and data structures much more interesting.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>