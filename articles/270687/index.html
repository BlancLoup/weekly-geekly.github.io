<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Who was on the server?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There comes a time when the system administrator needs to determine the date of the last login to each of the users, as well as prepare a list of thos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Who was on the server?</h1><div class="post__text post__text-html js-mediator-article">  There comes a time when the system administrator needs to determine the date of the last login to each of the users, as well as prepare a list of those accounts that have not done so.  If you had not previously known the <b>lastlog</b> command, you would be surprised how quickly and easily it can provide you with this data. <br><br><img src="https://habrastorage.org/files/f23/026/8fc/f230268fc02240e4b288e05108e62b65.jpg"><br><a name="habracut"></a><br>  If you still think about it, do not forget that this command is also one of the good methods of security checking that can be performed on servers running Linux systems.  It will help you identify potential problems.  Those accounts that have been inactive for a long time, for example, can mean that they are no longer needed and can be disabled.  But the accounts that were active at the time when their users were supposed to be on vacation somewhere in the Bahamas - may hint at problems with security on the server. <br><br>  The <b>lastlog</b> command stores information about the user's last login to the system, but it will provide information only on those logs that are in the <b>wtmp</b> file.  Entries in this file are made in binary format, so that they can only be viewed using special commands.  I think many of you paid attention to the fact that when you log in to the console, the following message appears on the screen: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">Last login: Wed Nov 11 13:19:44 on ttys002</code> </pre> <br>  This line is generated by the <b>login</b> utility, which, after authorizing the user, accesses the file / var / log / lastlog, retrieves information about the previous successful login, displays it on the screen, and then updates the record in the <b>lastlog</b> file.  In contrast to the file / var / log / lastlog, which contains records of the time of the last login to each user, the file / var / log / wtmp remembers all inputs and outputs of users to the system since the creation of this file. <br><br>  To view the data for a specific user, you must use the following command <b>last xxx</b> , where <b>xxx</b> is the user login.  And using the sort command <b>head</b> with parameter 5 in turn will help you to display only the last 5 results on the screen: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># last | head -5 root pts/0 193.178.187.30 Wed Nov 11 14:21 still logged in tuto ftpd3292 ::ffff:176.104.0 Wed Nov 11 11:11 - 11:15 (00:04) tuto ftpd29523 ::ffff:176.104.0 Tue Nov 10 18:58 - 19:03 (00:04) naturcok ftpd23502 ::ffff:176.104.0 Tue Nov 10 13:55 - 13:55 (00:00) naturcok ftpd20128 ::ffff:176.104.0 Tue Nov 10 13:50 - 13:55 (00:05)</span></span></code> </pre><br>  How deep you can view the history of the latest commands depends on how long the <b>wtmp</b> file <b>is for</b> .  For example, you can use the <b>logrotate</b> utility, which monitors the log files and provides the so-called rotation of these files in case they exceed the specified size (or after a specified time interval).  It also allows you to support more than one <b>wtmp</b> file and has an entry in <b>logrotate.conf</b> like this: <br><br><pre> <code class="bash hljs">/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/wtmp { monthly create 0664 root utmp minsize 1M rotate 1 }</code> </pre><br>  Even with several <b>wtmp</b> files, the data of some of your users may simply not be displayed.  If, as a result of an individual user verification, you have not received any data on it, then this means that there are no records for a specific user in the <b>wtmp</b> file.  To find out the date for creating the <b>wtmp</b> file, enter <b>last mia</b> in the console: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># last mia wtmp begins Thu Sep 17 16:10:00 2015</span></span></code> </pre><br>  The best way to find the last login information for each user is to use the <b>lastlog command</b> .  If any of the users has never logged in to the system, then instead of the terminal name and the last login time, the line will be displayed ** Never logged in **.  If the output will consist of a large number of lines, you can also use the more command, which, unlike the <b>less</b> command, will display the contents of the file on the screen in separate pages.  The result will look something like this: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># lastlog | more Username Port From Latest root pts/0 xxx.xxx.xxx.xxx Wed Nov 11 14:21:59 +0200 2015 bin **Never logged in** daemon **Never logged in** adm **Never logged in** ispmaster pts/0 xxx.xxx.xxx.xxx Thu Nov 5 17:00:44 +0200 2015</span></span></code> </pre><br>  Many of us may be surprised to see that bin, daemon, adm, and other service accounts have never logged in to the system.  This is indeed the case, and means only that the / sbin / nologin parameter is set for the shells assigned at the time of user registration (login shells), which makes authorization impossible.  The remaining data on the inputs show the date and time of the system from which the authorization was carried out. <br><br>  To create a list of all accounts that have never logged in, you should use the following set of commands.  We are already familiar with the <b>lastlog</b> command and I will not dwell on it in detail, then it is worth adding the <b>grep</b> utility to search for a keyword, in our case the word <b>Never</b> , and in order to display only the first data column, you can use the <b>awk</b> utility with the following syntax is <b>'{print $ 1}'</b> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># lastlog | grep Never | awk '{print $1}' bin daemon adm . . . ntp user1819 user1939</span></span></code> </pre><br>  The entries in <b>lastlog</b> are listed according to user identifiers (User identifier - UID) - from root (root) to the user with the highest UID value in your / etc / passwd file.  This is due to the format of the <b>lastlog</b> file <b>itself</b> .  Unlike most Unix log files, a separate place is reserved in the <b>lastlog</b> file for recording the logs of each user, and in turn the place of each record is indexed by UID.  After that, the files will be of a fixed size, especially if your system has accounts with the highest limit of its possible UID range - such as a 16-bit UID 65536. Also, this creates a large amount of unused space, though only if your identifiers are not strictly sequential .  If your system supports 32-bit UIDs, the file can be very large and have 4,294,967,296 (232) different identifier values. <br><br>  Each entry in the <b>lastlog</b> file contains the user name, the terminal name from which the user logged in, and the last login time.  The entry for the superuser (UID 0) at the top of the file may look like this: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># od -xc /var/log/lastlog | more 0000000 fba3 563d 7470 2f73 0030 0000 0000 0000 243 373 = V pts / 0 \0 \0 \0 \0 \0 \0 \0 0000020 0000 0000 0000 0000 0000 0000 0000 0000 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 0000040 0000 0000 3138 392e 2e35 3831 2e34 3532 \0 \0 \0 \0 8 1 . 9 5 . 1 8 4 . 2 5 0000060 0034 0000 0000 0000 0000 0000 0000 0000 4 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 0000100 0000 0000 0000 0000 0000 0000 0000 0000 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0</span></span></code> </pre><br>  When executing the <b>lastlog command</b> on some computers, in certain cases it may appear that the command is ‚Äúfrozen‚Äù.  This is due to the fact that even if there are only two users registered in the system (root and user), in the / var / log / lastlog file there is still room for the maximum possible number of users who can work in the system.  Therefore, in the file / var / log / lastlog there may be large gaps between the identifiers of users who have been working in the system.  Since when viewing such intervals, the program does not display information on the screen, and the impression of a ‚Äúfreeze‚Äù appears.  Therefore, do not rush to press buttons and close the console, but wait for the response of the command. <br><br>  As we have established with you, the <b>lastlog</b> command can be very useful for checking the logs of those users whose support you still support, to make sure that the accounts in the system are used properly and they are still relevant.  Also, do not forget to check the size of the logs, but it may turn out that their volume already significantly exceeds the total size of your system. <br><br>  Do not neglect to use fairly simple commands in your work, and, naturally, use the space wisely.  Good luck! </div><p>Source: <a href="https://habr.com/ru/post/270687/">https://habr.com/ru/post/270687/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270677/index.html">Why it is impossible to let programmers to the servers, or Why devops did not die out yet, although they talked a lot about it</a></li>
<li><a href="../270679/index.html">Critical vulnerability in a number of Java Application Server</a></li>
<li><a href="../270681/index.html">WoSign Free SSL - The End Of A Big Chinese Freebie</a></li>
<li><a href="../270683/index.html">Christmas gifts from 3CX</a></li>
<li><a href="../270685/index.html">Using large pages in memory in PHP 7</a></li>
<li><a href="../270689/index.html">Simple inline visitor for boost :: variant</a></li>
<li><a href="../270691/index.html">Cloud for development companies: Babystep.tv uses Azure to launch ‚Äúrockets‚Äù from its new SPACEPORT</a></li>
<li><a href="../270693/index.html">Report from the #PostgreSQLRussia mitap on November 3</a></li>
<li><a href="../270695/index.html">The three best technology companies of the Forum and the Open Innovations Technology Show received IBM cloud grants in the amount of $ 120,000</a></li>
<li><a href="../270697/index.html">Overview of ES6 at 350 points. Part two</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>