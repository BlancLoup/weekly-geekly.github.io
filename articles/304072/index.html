<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>dlang-requests - type python-requests, only for D</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! 

 I want to introduce you to the library of dlang-requests. What is she for? For D, she wants to be the same as python-requests is for pyth...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>dlang-requests - type python-requests, only for D</h1><div class="post__text post__text-html js-mediator-article">  Good day! <br><br>  I want to introduce you to the library of dlang-requests.  What is she for?  For D, she wants to be the same as python-requests is for python, that is, a convenient http (and ftp) client.  The author swore that when writing a library his goals were: <br><br><ol><li>  convenient, simple interface </li><li>  libcurl comparable performance </li><li>  compatibility with standard library D </li></ol><br>  The first part of the article will consist of examples of using dlang-requests for the most common tasks. <br><a name="habracut"></a><br><h3>  Let's start with GET requests </h3><br>  Let's create the simplest application using dlang-requests (make a copy-paste directly to the shell if you are under a unix-like axis): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Create a minimal application using dub</b> <div class="spoiler_text"><pre> mkdir test-requests &amp;&amp; cd test-requests &amp;&amp; dub init.  requests
 cat&gt; source / app.d &lt;&lt; EOF
 import std.stdio;
 import requests;

 void main ()
 {
     writeln (getContent ("http://httpbin.org"));
 }
 EOF
 dub run
</pre><br></div></div>  As a result of executing the dub run command, the html drawn from the root of the <a href="httpbin.org/">httpbin.org</a> site should be drawn in the console. <br><br>  So far everything is simple: in case you only need the content of the document, you can use getContent (url).  This call simply returns the buffer to the document. <br><br>  Why is the buffer and not just an array of bytes?  Because in most cases, the buffer will contain data obtained directly from the network, without unnecessary copying and assembling rows of pieces.  If you need to - the buffer easily turns into an array of bytes using the data () method: <br><div class="spoiler">  <b class="spoiler_title">convert the answer to byte array</b> <div class="spoiler_text"><pre> import std.stdio;
 import requests;

 void main ()
 {
     auto content = getContent ("http://httpbin.org");
     writeln (typeid (content.data ()));
 }
</pre><br></div></div><br>  But do you need it?  After all, the buffer supports many Range primitives, and you can use it directly to transfer to the corresponding algorithms.  For example, we do not need to convert the content to string in order to count the number of lines in the answer, because <div class="spoiler">  <b class="spoiler_title">the answer can be processed by standard library algorithms that work with range, (at the same time we look at what properties the answer has)</b> <div class="spoiler_text"><pre> import std.stdio;
 import std.range.primitives;
 import std.algorithm;
 import requests;

 void main ()
 {
     auto content = getContent ("http://httpbin.org");
     writeln (content.splitter ('\ n'). count);

     alias type = typeof (content);
     static assert (isInputRange! type);
     static assert (isForwardRange! type);
     static assert (hasLength! type);
     static assert (hasSlicing! type);
     static assert (isBidirectionalRange! type);
     static assert (isRandomAccessRange! type);
 } </pre></div></div><br>  Another example: we can parse the resulting json without additional effort: <br><div class="spoiler">  <b class="spoiler_title">parse json from answer</b> <div class="spoiler_text"><pre>  import std.stdio;
 import std.json;
 import requests;

 void main ()
 {
     auto content = getContent ("http://httpbin.org/get");
     auto json = parseJSON (content);
     writeln (json);
 } </pre></div></div><br>  Before dealing with post, we will look what to do if we need get with parameters. <br><div class="spoiler">  <b class="spoiler_title">request get with parameters</b> <div class="spoiler_text"><pre> import std.stdio;
 import std.json;
 import requests;

 void main ()
 {
     auto content = getContent ("http://httpbin.org/get",
                              queryParams ("name", "bob", "age", 101));
     auto json = parseJSON (content);
     writeln (json);
 }
</pre><br></div></div><br><br><h3>  Go to the POST requests. </h3><br>  The first and easiest post is a post in a web form using form-urlencoded.  Such a post is usually used to transfer small amounts of data and, by the form of a call, resembles a get call with parameters: <br><div class="spoiler">  <b class="spoiler_title">POST form-urlencoded</b> <div class="spoiler_text"><pre> import std.stdio;
 import std.json;
 import requests;

 void main ()
 {
     auto content = postContent ("http://httpbin.org/post", queryParams ("name", "bob", "age", 101));
     auto json = parseJSON (content);
     writeln (json);
 } </pre></div></div><br>  Please note: the getContent call turned into postContent, nothing else has changed. <br><br>  Multipart form POST is used to transfer large amounts of data to the server, including for uploading files via a web form. <div class="spoiler">  <b class="spoiler_title">Example of sending a file and parameters via MultipartForm</b> <div class="spoiler_text"><pre> import std.stdio;
 import requests;

 void main ()
 {
     MultipartForm form;
     form.add (formData ("content", "example for MultipartForm"));
     form.add (formData ("file", File ("source / app.d", "rb"), ["filename": "app.d", "Content-Type": "text / plain"])) ;
     auto content = postContent ("http://httpbin.org/post", form);
     writeln (content);
 } </pre><br></div></div><br>  We collect the fields to be sent to the form by calling form.add (formData (field description)) where the first parameter for formData is the name of the field, and the second is either the array with the data to be sent or the file opened for reading.  The third parameter can be an associative array with additional data (including the Content-type for the part being sent). <br><br>  Finally, the last option for calling postContent is sending data without any form.  There are two possible options.  The first is sending a peer-to-peer array of data (for example, ubyte []).  In this case, we should know the length of the array at the time of the call, because the transfer uses the Content-Length header.  I will give here only the call string: <br><br><pre> auto content = postContent ("http://httpbin.org/post", 
                         "ABCDEFGH", 
                         "application / binary");
</pre><br><br>  If for some reason we do not know the length of the array at the time of the call (but we know that it is finite), we can use the transmission of an array of dimension 2, in this case each successive piece of the array will be transmitted as another chunk in Transfer-Encoding: chunked: <br><div class="spoiler">  <b class="spoiler_title">sending a file using Transfer-Encoding: chunked</b> <div class="spoiler_text"><pre> import std.stdio;
 import requests;

 void main ()
 {
      auto f = File ("source / app.d", "rb");
      auto content = postContent ("http://httpbin.org/post", f.byChunk (5), "application / binary");
      writeln (content);
 } </pre></div></div><br><br>  This ends an overview of the simplest use of dlang-requests ‚Äî when you don‚Äôt need debugging, you don‚Äôt need to stream the received response, you don‚Äôt need any methods other than GET and POST.  Everything that is not considered in Part 1, we consider in Part 2. <br><br>  Link to the project repository on <a href="https://github.com/ikod/dlang-requests">github</a> . <br><br>  Good luck! </div><p>Source: <a href="https://habr.com/ru/post/304072/">https://habr.com/ru/post/304072/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304058/index.html">Lenovo fixed vulnerabilities in its software</a></li>
<li><a href="../304060/index.html">Record of the webinar "What's new in Kerio Control 9.1"</a></li>
<li><a href="../304062/index.html">Comparison of eCPM ad networks on personal experience</a></li>
<li><a href="../304068/index.html">"Cloud Technologies in Russia" - the first joint forum of Huawei and RUVDS was held in Moscow</a></li>
<li><a href="../304070/index.html">Secrets of the most effective people (part 2)</a></li>
<li><a href="../304074/index.html">Implementing reference counting or life without GC (almost)</a></li>
<li><a href="../304078/index.html">Making a cool Single Page Application on basis.js - part 1, introductory theoretical</a></li>
<li><a href="../304080/index.html">Knocking out to government agencies or what to do if in the open data someone is wrong?</a></li>
<li><a href="../304082/index.html">Developing a script to compare people's tastes</a></li>
<li><a href="../304090/index.html">Russian Post delivers - you are now laughing, but it‚Äôs the most reliable</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>