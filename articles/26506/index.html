<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A few thoughts on secure code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I would like to describe some seemingly obvious security problems, which, however, are not always fully resolved by programmers. Basic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A few thoughts on secure code</h1><div class="post__text post__text-html js-mediator-article">  In this article I would like to describe some seemingly obvious security problems, which, however, are not always fully resolved by programmers.  Basically, my thoughts are about web development, but some topics are relevant to other applications.  In the article, I operate with examples of asp.net and C #, but I am sure that all the problems are also relevant for other platforms and languages. <br><a name="habracut"></a><br><h1>  Forget about user </h1><br>  Not the user calls your method, but other methods.  The user is a living person who presses buttons, he does not know anything about your methods.  The real misconception is to associate a method call with a user. <br><br>  Very often, programmers are imbued with thoughts about the user when they work in visual environments.  Environments such as Delphi or Visual Studio make it easy to determine the event handling of controls with which the user works.  It is easy to be tempted to double-click in the form editor on the button to set an action that would determine the processing of the user's actions.  Formally, this is correct.  But consider an example: <br><blockquote>  <font color="black"><font color="#0000ff">protected</font> <font color="#0000ff">void</font> Button1_Click ( <font color="#0000ff">object</font> sender, <font color="#2B91AF">EventArgs</font> e)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">(sender <font color="#0000ff">as</font> Button) .Text = <font color="#A31515">"Hello"</font> ;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">private</font> <font color="#0000ff">void</font> MyMethod ()</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">Button1_Click ( <font color="#0000ff">null</font> , <font color="#0000ff">new</font> <font color="#2B91AF">EventArgs</font> ());</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="gray">* This source code was highlighted with <a href="http://poison.qsh.ru/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br><br>  This example only works as long as we are confident that the events are controlled by a mythical user.  But we remain helpless in the face of the real state of affairs, when code is not controlled by the user, but by other code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  No context, only security requirements </h1><br>  When dealing with web applications, forget that some functions can be called or controls are pressed only when something happens somewhere.  That the user made the login, that today is Monday, that the button was pressed by Boris, and not Peter.  All this is an illusion, which leads to the idea that you are dealing with a user, and not with code. <br><br>  For example, we have a page on which, after the login, a control panel appears with some functionality.  The biggest mistake may be your belief that this control panel cannot be used by an unauthorized user.  This is such a simple delusion that many do not even think about it. <br><br>  On my project there are such pages with a panel, caching is forbidden on the pages, and in the case of an exceptional situation it is registered in the database.  And even taking into account the fact that the page cannot seem to be placed in the cache, I record attempts to use a panel that is supposedly inaccessible by unauthorized users. <br><br>  And here there is a very simple explanation for this: the user Boris can simply not close the page for a couple of days, and then turn to it again when his session on the server has long been completed.  And, maybe, instead of him, Peter will do it, and the consequences can already be different: from a simple window with an error and an unpleasant aftertaste to the abduction or compromise of Bori's data by the villain Petya. <br><br>  What does it mean?  It's simple: forget the context, follow the rules of security. <br><br><h1>  The code is always called "evil" code. </h1><br>  It looks like paranoia, but it is.  No one can ever be sure what code and how your method will call.  You can be sure of only one thing - your code works in a volatile environment and requires mandatory validation of all required parameters: method arguments, global variables, configuration file data, query string, etc. <br><br>  So we will remake the previous example as it deserves it: <br><blockquote>  <font color="black"><font color="#0000ff">protected</font> <font color="#0000ff">void</font> Button1_Click ( <font color="#0000ff">object</font> sender, <font color="#2B91AF">EventArgs</font> e)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">Button senderButton = (sender <font color="#0000ff">as</font> Button);</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (senderButton! = <font color="#0000ff">null</font> )</font> <font color="black"><br></font>  <font color="black">senderButton.Text = <font color="#A31515">"Hello"</font> ;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">private</font> <font color="#0000ff">void</font> MyMethod ()</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">Button1_Click ( <font color="#0000ff">null</font> , <font color="#0000ff">new</font> <font color="#2B91AF">EventArgs</font> ());</font> <font color="black"><br></font>  <font color="black">}</font> <font color="gray">* This source code was highlighted with <a href="http://poison.qsh.ru/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br><br><h1>  Exceptional situations deserve exceptional action. </h1><br>  It is worth remembering once and for all: <br>  1. the return method of error codes, instead of calling an exception - is evil; <br>  2. The exception is not a synonym for error. <br>  Here you should immediately decide what is actually considered an error code.  If the code returns a description of the situation, it is a description of the situation, but if the code returns a value in the event of a situation when it could not continue, then this is the error code, the call of which should be replaced with an exception call. <br><br>  For example: <br>  ‚Ä¢ the code checks the existence of the required file and returns a boolean value, where false is a sign that the file does not exist; <br>  ‚Ä¢ the code reads the contents of the file, but at some point it cannot read the block and terminates, returning a boolean value or the value of some enumeration; <br>  ‚Ä¢ the code checks the presence of the image file and if it does not find it, it terminates execution without returning any value or by calling an exception. <br>  In the first case, returning a boolean value is the task of the method, in the second, returning the description of an exceptional situation.  The first method does not need to be changed, the second one needs to be redone to the exception call, having refused to return any value.  The third case is a common case when the error situation is insignificant in the general context of the work being done.  Generating an exception in this place would stop the execution of important code because of a trifling moment, which is unacceptable. <br><br>  Determining the degree of exclusivity of an error is not always an easy task.  I recommend the following rules: <br>  ‚Ä¢ the return of the error code is valid only in methods that test the situation for an error; <br>  ‚Ä¢ if the code cannot be executed to the end due to an error, an exception must be generated; <br>  ‚Ä¢ if the code within the context of the problem being solved ran into a previously known possible problem, then it makes sense either to complete the code and return the description of the situation, or to ignore the problem. <br><br><h1>  All answers are negative. </h1><br>  Look at the following code: <br><blockquote>  <font color="black"><font color="#0000ff">enum</font> access</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">Granted</font> <font color="black"><br></font>  <font color="black">Restricted</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">private</font> Access CheckLogin ( <font color="#0000ff">string</font> password)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">Access result = Access.Granted;</font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">try</font></font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (password! = GetValidPassword ())</font> <font color="black"><br></font>  <font color="black">result = Access.Restricted;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">catch</font></font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">return</font> result;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="gray">* This source code was highlighted with <a href="http://poison.qsh.ru/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br><br>  The code is obviously stupid, but this is a simplification, and in life you can see more complex structures, the essence of which boils down to this code.  What's wrong with that?  It's just the fact that if an exception occurs in the GetValidPassword method, any user with any password will get access. <br><br>  To return the result, I defined several rules: <br>  ‚Ä¢ in minor methods that will not cause exceptions in case of problems, avoid returning non-nullable types, except boolean values; <br>  ‚Ä¢ all methods that return values ‚Äã‚Äãmust first of all initialize this value with the most negative or safe option (for nullable types, this can be null, for booleans, false, for enums, the most negative value like Access.Restricted); <br>  ‚Ä¢ All methods must have one point for returning values. <br>  As a result, we can distinguish such a pattern: <br><blockquote>  <font color="black"><font color="#0000ff">private</font> Access MyMethod ()</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">Access result = Access.Restricted;</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">// put your code here, there should be no return calls in the code, just change the value of result</font></font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">return</font> result;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="gray">* This source code was highlighted with <a href="http://poison.qsh.ru/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br><br><h1>  Conclusion </h1><br>  The article touched upon the issues of writing safe code, as a result, the following rules can be identified: <br>  ‚Ä¢ your code works in a hostile environment, ensure all security requirements in each method; <br>  ‚Ä¢ check whether the environment in which your code will work, with what parameters it has been called is valid, remember that it is not the user who is doing this, but another code; <br>  ‚Ä¢ always by default return safe values ‚Äã‚Äãin the context; <br>  ‚Ä¢ all methods must have one exit point; <br>  ‚Ä¢ use exceptions in exceptional situations to guarantee interruption of code execution; <br>  ‚Ä¢ ignore or handle minor issues to accomplish an important task. </div><p>Source: <a href="https://habr.com/ru/post/26506/">https://habr.com/ru/post/26506/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265051/index.html">Attack on archivers. Hiding in one archive from three programs</a></li>
<li><a href="../265053/index.html">Old market or restored servers conquered the USA and Europe</a></li>
<li><a href="../265055/index.html">Microsoft has released an emergency update for Internet Explorer</a></li>
<li><a href="../265057/index.html">Creating a tester for match-3 games</a></li>
<li><a href="../265059/index.html">Is there a domestic processor Multiklet?</a></li>
<li><a href="../265061/index.html">Java Programmer Crib 1: JPA and Hibernate in Questions and Answers</a></li>
<li><a href="../265065/index.html">Forwarding USB to a virtual network via UsbRedir and QEMU</a></li>
<li><a href="../265067/index.html">About really BIG numbers (part 1)</a></li>
<li><a href="../265069/index.html">Tabrier - collective video greetings</a></li>
<li><a href="../26507/index.html">What am I listening now?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>