<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An exploit for vulnerabilities in Cisco UCS Manager: is the devil so scary?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An exploit for Cisco UCS Manager has been published online. Version 2.1 (1b) and possibly others are said to be vulnerable. 
 On the Cisco website, th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An exploit for vulnerabilities in Cisco UCS Manager: is the devil so scary?</h1><div class="post__text post__text-html js-mediator-article">  An <a href="https://www.exploit-db.com/exploits/39568/">exploit</a> for <a href="https://habrahabr.ru/company/it-grad/blog/177283/">Cisco UCS Manager has been</a> <a href="https://www.exploit-db.com/exploits/39568/">published</a> online.  Version 2.1 (1b) and possibly others are said to be vulnerable. <br>  On the Cisco website, the <a href="http://www.cisco.com/c/en/us/support/docs/csa/cisco-sa-20140926-bash.html">GNU Bash Environment Variable Command Injection Vulnerability</a> section states that updated versions of the products that fix the vulnerability are available: <br><ul><li>  3.0 (1d) (Available) </li><li>  2.2 (3b) (Available) </li><li>  2.2 (2e) (Available) </li><li>  2.2 (1f) (Available) </li><li>  2.1 (3f) (Available) </li><li>  2.0 (5g) (Available) </li></ul><br>  Own testing has shown that versions are vulnerable: <br><ul><li>  2.2 (1d) </li><li>  2.2 (1c) </li><li>  2.1 (2a) </li></ul><br>  Not vulnerable: <br><ul><li>  2.2 (6c) </li><li>  2.2 (3e) </li></ul><br>  We analyzed the work of the exploit, as well as the number of vulnerable devices.  Using the search engine Shodan and our own search analogue (long live import substitution).  And that's what happened. <a name="habracut"></a><br><br>  Judging by the exploit code, the commands are injected into the User-Agent field when working on a specially formed URL using the HTTPS protocol.  You can divide the work of the exploit into 2 stages.  At the first stage, the exploit tries to determine if the system is vulnerable.  For this, the user file "/ etc / passwd" is read and the user "root" is searched.  At the second stage, a reverse connection is made to the attacking node under control, <a href="https://mtaalamu.ru/blog/admining/1130.html">using the features of the / dev / tcp pseudo device</a> . <br><br>  We found vulnerable hardware and I was able to play around with the exploit a bit. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We execute commands. <br><pre><code class="bash hljs">$ who daemon</code> </pre> <br><br>  Read the contents of the file "/ etc / passwd" <br><br><pre> <code class="bash hljs">$ cat /etc/passwd root:*:0:0:root:/root:/isanboot/bin/nobash bin:*:1:1:bin:/bin: daemon:*:2:2:daemon:/usr/sbin: sys:*:3:3:sys:/dev: ftp:*:15:14:ftp:/var/ftp:/isanboot/bin/nobash ftpuser:*:99:14:ftpuser:/var/ftp:/isanboot/bin/nobash nobody:*:65534:65534:nobody:/home:/bin/sh admin:x:2002:503::/var/home/admin:/isan/bin/vsh_perm svc-isan:*:499:501::/var/home/svc-isan:/isan/bin/vsh_perm samdme:x:2003:504::/var/home/samdme:/bin/bash</code> </pre><br><br>  Those.  the root user really exists, and the vulnerable software is launched from the daemon user. <br>  Also open many ports. <div class="spoiler">  <b class="spoiler_title">Here is a short list.</b> <div class="spoiler_text"> <code>$ netstat -ln <br> Active Internet connections (only servers) <br> Proto Recv-Q Send-Q Local Address Foreign Address State <br> tcp 0 0 0.0.0.0:161 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:2049 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:36738 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:6021 0.0.0.0:* LISTEN <br> tcp 0 0 127.12.0.1:4101 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:5991 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:7911 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:5961 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:906 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:907 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:6351 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:5871 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:906 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:907 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:6351 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:5871 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:111 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:6321 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:5841 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:5781 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:6261 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:51189 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:4023 0.0.0.0:* LISTEN <br> tcp 0 0 0.0.0.0:27000 0.0.0.0:* LISTEN <br></code> <br></div></div><br><br> <code>uname -a <br> Linux UCS078A-AA 2.6.27.10 #1 SMP Fri Nov 15 03:08:09 PST 2013 i686 i686 i386 GNU/Linux <br> <br> cat /etc/*release <br> <br> Wind River Linux <br></code> <br><br>  Injecting code into the User-Agent string is a common practice.  For example, <a href="http-shellshock.html">a vulnerability search script of the Shellshock type for the nmap network scanner</a> also uses this approach in the default settings.  Although I personally was not able to configure this script so that it actually identified a vulnerability in the tested equipment of Cisco UCS Manager. <br><br>  Search Engine Shodan for the query "Cisco UCS Manager" does not produce anything.  And at the request of "Cisco UCS" - a lot of things, from which you can find 7 addresses related to the desired device.  It seems that the problem is the impossibility of searching for a substring of several words: as a result, any expression is searched for.  Although, maybe I'm just an inexperienced user of Shodan. <br>  At the PHDays 2015 conference, I and my colleague <a href="http://2015.phdays.ru/program/40864/">talked about my search engine, similar to Shodan</a> . <br><br>  Search by banal query in 2 networks with mask 16: <br><img src="https://habrastorage.org/files/2c7/f43/f61/2c7f43f611794c84a9cc1b38a412a17b.png"><br><br>  We basically told how the search engine works.  But they also raised the problem of searching for specific equipment: you need to find the maximum number of devices on request.  At the same time, the query results should contain a minimum of garbage.  In particular, they expressed a thought about a certain digital footprint.  In short: the equipment is configured differently (default settings, or custom settings, equipment operation behind a firewall or behind NAT).  Studying each case by trial and error, and also taking into account the accumulated experience, a completely non-trivial query is created.  Its results can be very different from the banal initial search.  It happened in this situation.  For example, as can be seen from the screenshot above, when searching for a device, the string ‚ÄúOpenSSL / FIPS‚Äù is encountered.  The search for this line in Shodan again disappoints: the results again do not have a clear search line.  Search in our search engine increased the number of detected addresses compared to the previous search.  Although, frankly, such a search still gives out junk entries.  Those.  records that, when checked, have nothing in common with Cisco UCS Manager. <br>  In general, the issue of creating digital fingerprints (including for specific devices) is a topic for a separate article.  I will confine myself to the fact: we found about 50 <s>devices with</s> unique IP addresses (it‚Äôs not entirely correct to talk about the number of devices found, since each device can have several network interfaces with different addresses).  Mostly in the USA. <br><br>  At the moment, the issue of providing access to our search engine to a wide audience is being considered.  If there is interest from the community. </div><p>Source: <a href="https://habr.com/ru/post/280364/">https://habr.com/ru/post/280364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280354/index.html">The book "Computer Networks. Principles, technologies, protocols "</a></li>
<li><a href="../280356/index.html">aBeing One: at the center of the Internet of Things</a></li>
<li><a href="../280358/index.html">Monolithic repositories in Git</a></li>
<li><a href="../280360/index.html">Report from Moscow Python Meetup March 18</a></li>
<li><a href="../280362/index.html">Video reports from Zabbix Moscow Meetup 2016</a></li>
<li><a href="../280370/index.html">Tips, libraries and additional materials on CSS-animation</a></li>
<li><a href="../280372/index.html">Interactive video and what it eats</a></li>
<li><a href="../280374/index.html">Measuring code coverage tests on Android using JaCoCo</a></li>
<li><a href="../280376/index.html">In simple words: We deal with "cloud" services.</a></li>
<li><a href="../280378/index.html">man! (Go => D) .concurrency</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>