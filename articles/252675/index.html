<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Administering through the eyes of a C ++ programmer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue the cycle of Friday's articles " X through the eyes of a C ++ programmer" ( 1 , $ ). This time under the cut you are waiting for the impr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Administering through the eyes of a C ++ programmer</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/f2c/cbd/603/f2ccbd603d5f47468351a0e569f7c963.jpg" align="right">  We continue the cycle of Friday's articles " <i>X</i> through the eyes of a C ++ programmer" ( <a href="http://habrahabr.ru/post/250825/">1</a> , <a href="http://habrahabr.ru/post/252675/">$$</a> ).  This time under the cut you are waiting for the impressions of an inveterate C ++ programmer from the world of administration.  Pain, suffering, joy and other emotions, as always, are rendered by spoilers. <br><br>  I hope it will be interesting for professional administrators to look at the attempts of C ++ nickname, and C ++ developers will learn something new for themselves. <br><a name="habracut"></a><br><h1>  Hosting </h1><br>  Having raised my mind and calculator, it turned out that it is much cheaper and easier to buy hosting from one of the hosting providers.  So if you deploy the server in "home conditions", then you have to spend money on UPS, static external IP, the machine itself and other trifles, like electricity. <br><div class="spoiler">  <b class="spoiler_title">... So what?</b>  <b class="spoiler_title">Is there no old car?</b> <div class="spoiler_text">  Acquaintances for whom the project was being made completely refused to keep the noisy Pentium4 on in their house around the clock.  And the argument ‚Äúall serious guys did this‚Äù did not roll. <br></div></div><br><br>  Buy hosting turned out to be easy, it turned out that overseas is two times cheaper than ours.  After weighing all the pros and cons, Ubuntu OS 14.04 was chosen. <br><div class="spoiler">  <b class="spoiler_title">... and what is this for 'for' and 'against'?</b> <div class="spoiler_text">  The solution was chosen based on the following numerous factors: <br><ul><li>  i like ubuntu </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This approach to the choice of operating system (and development language) is popular;  I always wanted to try this technique. <br></div></div><br><br>  After purchasing the hosting and selecting the OS from the drop-down list, server setup over SSH began. <br><div class="spoiler">  <b class="spoiler_title">... and how do you feel?</b> <div class="spoiler_text">  How many times in your life did the batteries in the TV remote sit down or was the remote lost? <br><br>  Now imagine that in this case you can‚Äôt fuck with your hand, transfer the pods of the Soviet TV set to the network, on which your least favorite show begins. <br><br>  So, in the case of a remote server, the stress from the "loss of the console" is much stronger. <br></div></div><br><br><h1>  Bash Vulnerability and SSH </h1><br><img src="https://habrastorage.org/files/251/f19/9a4/251f199a435a4529adaad0c883875be7.jpg" align="left">  So I was lucky that the beginning of my admin's practice did not fall during the period of finding a heap of critical vulnerabilities in bash.  Being under the general impression, I decided to minimize the use of the shell in all services starting from SSH.  Under the distribution got a welcome message at login (message of the day).  Also in SHH I turned off X forwarding and PAM, banned root, changed the default port, allowed authorization only on asymmetric keys + any small things. <br><div class="spoiler">  <b class="spoiler_title">... we know you freeloaders, without beautiful windows is not a buzz?</b> <div class="spoiler_text">  Yes, good.  More upset about the lack of message of the day.  It is <s>so</s> informative.  Even made a script so that you can call it from the console. <br></div></div><br><br>  In the process, I discovered <br><pre><code class="bash hljs">ssh -L _:localhost:5432 me@top-me.org -N</code> </pre> <br>  Great thing for database administration and other trifles: nothing has changed on the remote machine, but you can already reach the localhost ports of the remote machine as the ports on your machine. <br><div class="spoiler">  <b class="spoiler_title">... like a trick?</b> <div class="spoiler_text">  So fit into my needs that on Friday with friends drank health "ssh-L"! <br></div></div><br><br>  Another nice chip turned out that `tail` can take multiple input files and display them simultaneously in the console. <br><div class="spoiler">  <b class="spoiler_title">... what is cool about?</b> <div class="spoiler_text">  We do: <br><pre> <code class="bash hljs">tail -f /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/kern.log /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/auth.log /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/nginx/error.log /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/nginx/access.log</code> </pre><br><br>  Now all logs are displayed in one console in real time: <br><pre> <code class="bash hljs">==&gt; /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/kern.log &lt;== Mar 16 10:49:39 rating kernel: [2226306.618927] --- top-me.org: possible port scan--- IN=eth0 OUT= MAC=04:01:2a:64:3c:01:28:8a:1c:64:cb:f0:08:00 SRC=184.105.247.244 DST=80.240.141.163 LEN=30 TOS=0x00 PREC=0x00 TTL=56 ID=39877 DF PROTO=UDP SPT=48784 DPT=5351 LEN=10 Mar 16 10:53:57 rating kernel: [2226564.521544] --- top-me.org: possible port scan--- IN=eth0 OUT= MAC=04:01:2a:64:3c:01:28:8a:1c:64:cf:f0:08:00 SRC=207.30.132.123 DST=80.240.141.163 LEN=72 TOS=0x08 PREC=0x00 TTL=42 ID=3852 DF PROTO=UDP SPT=53 DPT=11653 LEN=52 ==&gt; /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/auth.log &lt;== Mar 16 11:01:17 rating sshd[31323]: Accepted publickey <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ANONYMOUS from 66.66.66.66 port 66 ssh2: RSA ==&gt; /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/nginx/error.log &lt;== PHP message: redirecting to http://top-me.org/<span class="hljs-string"><span class="hljs-string">" while reading response header from upstream... ==&gt; /var/log/nginx/access.log &lt;== 66.66.21.66 - - [04/Mar/2015:12:29:25 +0300] "</span></span>GET /land_job HTTP/1.1<span class="hljs-string"><span class="hljs-string">" 200 2601 "</span></span>-<span class="hljs-string"><span class="hljs-string">" "</span></span>Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:36.0) Gecko/20100101 Firefox/36.0<span class="hljs-string"><span class="hljs-string">" "</span></span>-<span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre><br><br>  Shine :) <br></div></div><br><br><h1>  Iptables </h1><br><img src="https://habrastorage.org/files/03e/a09/b58/03ea09b5861642bdb0ecd45952430443.jpg" align="right">  All my few familiar admins set up firewalls.  In the beginning, I did not expect a big PROFIT, but I went on about the tradition.  According to the first manuals, it seemed that Iptables is a monster and cannot understand it.  However, after a short time, the tool opened its secrets: <br><ul><li>  You can log requests on closed ports <br><div class="spoiler">  <b class="spoiler_title">... what's the point?</b> <div class="spoiler_text">  There is not much sense, but you can find out interesting things.  It turned out that the favorite port of fraudsters is 5060. IP telephony (SIP protocol) works by default on this port. <br></div></div><br></li><li>  You can ban users <br><div class="spoiler">  <b class="spoiler_title">... felt the power and glad?</b> <div class="spoiler_text">  Yes.  I made a special rule where all hacking attempts fell (calls on a closed port, TCP packets, spoofing).  Five attempts - and in the ban for 10 minutes.  And the unfortunate scrappy at this moment, getting to the open port, will receive the answer that the port is closed. <br></div></div><br></li><li>  You can disable Forwarding </li><li>  You can prohibit the protocols partially, etc. </li></ul><br><br>  Iptables is a smart thing! <br><div class="spoiler">  <b class="spoiler_title">... and what are these emotions not under the spoiler?</b> <div class="spoiler_text">  Under the spoiler all the emotions do not fit.  Iptables is so gorgeous, brilliantly gorgeous, that some poems are worth devoting not to women but to this tool! <br></div></div><br><br>  Well, for those who want to check the ban on iptables: <br><ul><li>  We knock on the closed port a couple of times: top-me.org:8080 </li><li>  We check that we are banned: <a href="http://top-me.org/">http://top-me.org</a> </li></ul><br><br><h1>  Nginx </h1><br>  By nginx a huge number of configuration manuals, with many of them in Russian.  Unfortunately, this is a problem - some of the articles are written by people who have met with nginx only in theory. <br><br>  Examples of bad advice: <br><ul><li>  It was recommended to write "expires modified 30d;".  The author assured that this means that the resource will be re-crafted by the client, if it <b>has changed</b> or if 30 days have passed.  And this is <a href="http_headers_module.html">not how it works</a> ! <br><div class="spoiler">  <b class="spoiler_title">... guilty himself, it cannot work like this!</b> <div class="spoiler_text">  Yes, somehow I was stupid </div></div></li><li>  It was recommended to block all people / bots that came from porno resources! <br><div class="spoiler">  <b class="spoiler_title">... in theory, useful advice!</b> <div class="spoiler_text">  Yeah, but only when moving from Yandex Search, a lot of slag is sent in the headers, and the word "sex" is found there surprisingly often! </div></div></li></ul><br><br>  In Nginx, everything is logical and reasonable.  However, all the advice from the articles should be checked by official documentation.  Yes, and it does not guarantee 100% performance. <br><div class="spoiler">  <b class="spoiler_title">... what did you like about Nginx?</b> <div class="spoiler_text">  I especially liked the solution with `include fastcgi_params`: I registered it, and all the Fastcgi settings were set by default for the location;  that does not suit - it is possible to correct lower in a config. <br></div></div><br><br><h1>  We tighten the nuts </h1><br>  I think many have seen the web server, giving by mistake file with PHP code.  I wanted to protect myself from such configuration errors, so I configured nginx and php interpreter to run under different users.  A script was written that exposes the rights to files and directories so that nginx does not have access to php directories, and php does not have access to static resources. <br><div class="spoiler">  <b class="spoiler_title">... and who do you want to surprise with this trivial thing?</b> <div class="spoiler_text">  Those who have servers sometimes give php files. <br></div></div><br><br><img src="https://habrastorage.org/files/29e/ffa/a1c/29effaa1c22c4364a054309736b59f58.jpeg" align="left"><h1>  Elusive joe </h1>  There is a question that has been tormenting me for a long time. <br><br>  Suppose I somehow protected myself from network access and made life difficult for a hacker.  However, <b>what prevents the hoster from viewing my files and data</b> ?  Yes, it sounds like a joke about the Elusive Joe, which the hoster is not needed for nothing, but still ... <br><div class="spoiler">  <b class="spoiler_title">... and you have something to hide?</b> <div class="spoiler_text"><blockquote>  No, and this is not your business. <br>  TOR project </blockquote><br><br>  The question remains, maybe someone knows the answer to it? <br></div></div><br><br><h1>  Results </h1><br>  I recommend trying each server administration.  A great opportunity to get new friends-tools, to discover something new in old ones, to think about issues that have never occurred to us before. <br><br>  A bonus for developers will be a large number of examples of how configs should look in programs and useful ideas for configs in projects. </div><p>Source: <a href="https://habr.com/ru/post/252675/">https://habr.com/ru/post/252675/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252663/index.html">3D printing - to schools (techno-marathon for assembling 3D printers in Yekaterinburg)</a></li>
<li><a href="../252665/index.html">Free Cloud IP-PBX - implementation from ppbbxx.com</a></li>
<li><a href="../252669/index.html">Sync Opera bookmarks between iOS, Android and computer</a></li>
<li><a href="../252671/index.html">Pseudo-identification of the cello</a></li>
<li><a href="../252673/index.html">Open-source instant messenger for autistic children</a></li>
<li><a href="../252677/index.html">Oberon Interpreter on Go</a></li>
<li><a href="../252683/index.html">"- Hello, tech support. Have you tried to turn it off and on?"</a></li>
<li><a href="../252697/index.html">Risk Protection Machine Learning System Architecture</a></li>
<li><a href="../252699/index.html">Protection against cheating in online games</a></li>
<li><a href="../252703/index.html">Recognition of the RF Passport on a mobile phone. (UPD: 03/28/2015 + posted the program on the App Store)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>