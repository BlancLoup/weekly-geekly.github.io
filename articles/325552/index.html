<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How automatic testing is arranged in Mail.Ru Mail for iOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago we told you about automatic testing of our Mail on Android and received a huge number of questions from readers. Today, let us open to y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How automatic testing is arranged in Mail.Ru Mail for iOS</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/dfa/ad4/159/dfaad4159c3c4b54b27db921205fb413.jpg" alt="image"></p><br><p>  Some time ago we told you about <a href="https://habrahabr.ru/company/mailru/blog/306236/">automatic testing of our Mail on Android</a> and received a huge number of questions from readers.  Today, let us open to you a part of our ‚Äúinner kitchen‚Äù, which concerns auto-testing on iOS.  To test each assembly, we conduct more than 500 autotests, which are performed in less than one hour.  How did we implement them and why?  What problems did you encounter and how could you solve them?  Read all about it under the cut. </p><a name="habracut"></a><br><h2 id="soderzhanie">  Content </h2><br><p>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Gerrit Code Review</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Command system and CI communication</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">CI platform</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Assembly</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Test build - stage 1</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Alpha version - stage 2</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Beta - Stage 3</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Release - Stage 4</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Build applications</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Application signature and provisioning profile</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Problems</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Checks and tests</a> </p><br><p>  <a href="https://habr.com/ru/company/mailru/blog/325552/">UI tests</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">What should be the framework</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">MonkeyTalk modifications</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Manage UI tests through scripts</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Scaling - parallel launch</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">First version</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Current version</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Runs Isolation</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Each on the simulator!</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Common simulators</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Workarounds for xcode, simulator, etc.</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Stability of interaction with iOS-simulators leaves much to be desired</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Simulator Pool and Load</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Asynchronous simctl with no signs of completion of action</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">System dialogs in the application</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Access to photos and contacts</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Server response spoofing</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Reporting</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Documentation generation</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">System summary</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">disadvantages</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Benefits</a> </p><br><p>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Project Checks</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Same Targets</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Localization</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Categories</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Test headers</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Reporting</a> </p><br><p>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Static code analysis</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">scan-build</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">fbinfer</a> </p><br><p>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Profiling and startup timings</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Unit tests</a> </p><br><p>  <a href="https://habr.com/ru/company/mailru/blog/325552/">HipChat and Reporting</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">New Tasks Report</a> <br>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Report on the results of the assembly, tests, checks</a> </p><br><p>  <a href="https://habr.com/ru/company/mailru/blog/325552/">Conclusion / Conclusions</a> </p><br><p>  Schematically, the workflow is as follows: </p><br><p><img src="https://habrastorage.org/files/359/96e/f79/35996ef79ec949abbac52db6221a24c0.png" alt="image"></p><br><p>  The diagram shows the initial, most rigid and critical steps of the task on the way to release.  Let's start with one of the first components - Code Review. </p><br><h2 id="gerrit-code-review">  Gerrit Code Review </h2><br><p>  For code review, we use the Gerrit Code Review.  It works on a separate node, as with some actions it requires a lot of resources.  The code is stored in a git repository.  In addition, the repository is mirrored to an additional node, and a full disk backup via Time Machine is constantly maintained. </p><br><p>  Workflow is closely related to Gerrit.  Not only automated checks are conducted, but also QA testing.  Approve / Fail at any of the stages is noted in Gerrit as a point: + 1 / ‚Äì1.  If the automated test fails or the test assembly fails to build, -1 is set. </p><br><p>  If the first stage is successful, then the QA team takes over.  They only interact with Jira, transferring the task to the Open or QA Approved state, so when switching, the corresponding Label is set to Gerrit.  For this, a small plugin for Jira is implemented, it performs exactly this task - and nothing more. </p><br><h3 id="sistema-komand-i-svyaz-s-ci">  Command system and CI communication </h3><br><p>  Gerrit allows you to use <em>server-side hooks</em> with an additional <a href="https://gerrit-review.googlesource.com/Documentation/config-hooks.html">plug-in</a> .  We implement the following hooks on ruby: </p><br><ul><li>  change-merged; </li><li>  comment-added; </li><li>  merge-failed; </li><li>  patchset-created; </li><li>  ref-update; </li><li>  reviewer-added. </li></ul><br><p>  Most of the hooks are used to notify the team of changes, as well as to synchronize the status of the task in Jira.  For example, when creating a new patchset in Gerrit, the corresponding hook is called in which we translate the Jira task to the Code Review state, and the custom field Merge Approved is set to No, since automated checks on this patchset have not yet been performed.  But there are more saturated implementations, for example <em>comment-added</em> .  Through it, we run checks and build changes on the CI platform.  For this, we have implemented our own system of commands that allows you to run certain jobs on CI on a given patchset.  To facilitate the task of expanding the command set, we implemented a small DSL to describe the display of comments in Job'y.  For example, this is the description of the command to run automated checks: </p><br><pre><code class="ruby hljs">JobMapping.register <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> command <span class="hljs-string"><span class="hljs-string">'flow'</span></span> job BUILD_FLOW_JOB arguments_required processor <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|args|</span></span> { <span class="hljs-string"><span class="hljs-string">'CHECKS_ENABLED'</span></span> =&gt; args.key?(<span class="hljs-string"><span class="hljs-string">'checks'</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> processor <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|args|</span></span> { <span class="hljs-string"><span class="hljs-string">'ANALYSIS_ENABLED'</span></span> =&gt; args.key?(<span class="hljs-string"><span class="hljs-string">'analysis'</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> processor <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|args|</span></span> { <span class="hljs-string"><span class="hljs-string">'UNITTESTS_ENABLED'</span></span> =&gt; args.key?(<span class="hljs-string"><span class="hljs-string">'unit'</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> processor <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|args|</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> args.key?(<span class="hljs-string"><span class="hljs-string">'ui'</span></span>) tags = args[<span class="hljs-string"><span class="hljs-string">'ui'</span></span>] { <span class="hljs-string"><span class="hljs-string">'UITESTS_ENABLED'</span></span> =&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">'UI_TESTS_TAGS'</span></span> =&gt; tags.<span class="hljs-literal"><span class="hljs-literal">nil</span></span>? ? <span class="hljs-string"><span class="hljs-string">''</span></span> : tags.tr(<span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-string"><span class="hljs-string">'UITESTS_ENABLED'</span></span> =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Automated checks consist of several parts, and I want to be able to run what is needed now.  Each JobMapping is tied to a specific team; it is specified by the <strong>command</strong> method.  Also this command should be displayed in Job on Jenkins, it is set to guess which method ( <strong>job</strong> ).  If the team has arguments, in JobMapping, their necessity is indicated by the <strong>arguments_required</strong> method. </p><br><p>  Jenkins jobs are configured via environment variables. To do this, you can add a block <strong>processor</strong> to the mapping registration process using the <strong>processor</strong> method and convert the command invocation string into an env variable set. </p><br><p>  Most often, these methods are enough to create the necessary mappings.  Then laziness arises, and instead of <strong>‚Äú! Flow ui unit‚Äù I</strong> just want to write <strong>‚Äú! Tests‚Äù</strong> .  Therefore, the broadcast appeared: </p><br><pre> <code class="ruby hljs">JobMapping.register <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> command <span class="hljs-string"><span class="hljs-string">'tests'</span></span> translates_to <span class="hljs-string"><span class="hljs-string">'!flow ui unit'</span></span> rebase <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Everything speaks for itself <del>  laziness </del>  comfort in its purest form. </p><br><h2 id="ci-platforma">  CI platform </h2><br><p>  Most of the platform is written from scratch in Ruby.  Each test or task is implemented by a separate module, which can be run both locally and on CI. </p><br><p>  To run tasks, we use Rake.  Thus, for each module there is a separate Rake-task in Rakefile. </p><br><p>  If the developer can rely on console logs when running locally, he expects to see the final report and alert on CI.  This is one of the <strong>basic principles</strong> - <em>Jenkins Job logs are needed for the CI developer, not his client</em> .  Therefore, all test modules implement the same interface so that when running on CI, to get the final task state and error description (if any).  So, for CI, we need a system that allows you to simply run the Rake task and take on some basic operations like cloning the code of a given revision, keeping the certificates, saving artifacts.  Jenkins was mastered as a base.  From it we use: </p><br><ul><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/SSH%2BSlaves%2Bplugin">Slave plugin</a> and tags / labels on nodes - we have 10 Mac Mini at our disposal; </li><li>  Git plugin; </li><li>  storage of artifacts; </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Build%2BFlow%2BPlugin">BuildFlow-plugin</a> for creating chains and parallel tasks (outdated and not supported - we know, but so far they are tightly tied to it); </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Build%2BName%2BSetter%2BPlugin">Changing the name of the</a> launched Job'ov to more attached to the task. </li></ul><br><p>  All jobs are a sequence of sh scripts that are executed after cloning our repository.  And in most cases, the sh script in Job just calls Rake-task.  All other operations ‚Äî running xcodebuild, scan-build, modules for checking the project and source codes, UI-test systems, processing results ‚Äî we implement ourselves within the framework of ruby-scripts. </p><br><p>  There are two types of tasks on the CI platform: </p><br><ul><li>  assembly; </li><li>  checks and tests. </li></ul><br><h3 id="sborki">  Assembly </h3><br><p>  Build and validation / tests are independent of each other; after a successful build, the application and the task immediately go to the QA team to manually check specific new cases.  At each stage on the way to release builds come out: </p><br><ul><li>  test assembly of a specific task;  in other words - feature branch'a; </li><li>  the current alpha from the main branch of the project in Gerrit; </li><li>  beta; </li><li>  release. </li></ul><br><p>  Only the first two stages work completely automatically, since they are released in HockeyApp, where you can do this as many times as you like.  Beta and release are rarer and more demanding events, so they are manually launched if necessary. </p><br><h4 id="testovaya-sborka--etap-1">  Test build - stage 1 </h4><br><p>  When the change passes the Code Review successfully, a test build is being prepared: a version with changes that are not yet merged into the main branch.  A successfully assembled application is immediately loaded into HockeyApp under a separate ID of test builds. </p><br><p>  Links to the version in HockeyApp are attached to the task in Jira.  If the build is successful, the task is transferred to the Ready For Test state;  if unsuccessful, go to the Open state for further refinement and correction of errors. </p><br><p>  The QA team checks the assembly for compliance with the task on different devices and versions of iOS.  If the changes are satisfactory, and by this time the automated checks, the Code Review and the design review, have passed, then pressing the Pass button in the Jira will immediately add the change to the main branch, thereby launching the second stage. </p><br><h4 id="alfa-versiya--etap-2">  Alpha version - stage 2 </h4><br><p>  When the change is merged into the main branch of the project, we need to release an alpha version of the application.  The trigger for this assembly is a hook in Gerrit <em>change-merged</em> .  Immediately after the merging change, Job builds the current alpha version of the application. </p><br><p>  This Job has a delay of 10 minutes, which is needed in case of several dependent (or independent) tasks.  Since the entire Job takes an average of 11-12 minutes, it is easier to wait for several tasks than to spend time on each one separately.  The compiled alpha version will include all changes since the last successfully compiled version. </p><br><p>  After successful completion, the latest version of the application is loaded into HockeyApp.  The task in Jira is considered closed precisely then - as soon as it becomes available in the alpha version of the application.  Therefore, after publication in HockeyApp, all tasks included in the version are closed.  To do this, we refer to the API Jira.  They also contain a comment with links to Job in Jenkins and the app itself in HockeyApp. </p><br><p>  Failure to build in stage 2 is unlikely.  If this happens, then most often because of the long failure of the API HockeyApp or Jira.  This is rare, but ... </p><br><p><img src="https://habrastorage.org/files/334/6c9/95a/3346c995a554430285fecb51915edf16.png" alt="image"></p><br><p>  There are no problems with this, since the next pledged change will trigger the same Job, which will capture the previous changes. </p><br><h4 id="beta-versiya--etap-3">  Beta - Stage 3 </h4><br><p>  The third stage is beta.  Separate Job on Jenkins, he needs only the name of the branch from which the beta version will be collected.  Manual build starts: although the beta is scheduled to within a day, it does not have a specific start time / period or trigger. </p><br><p>  The result of the assembly automatically falls into HockeyApp and becomes available to the QA team.  Immediately, a Job is launched for the release version from the same branch, the build is loaded into TestFlight and issued to internal and external testing. </p><br><h4 id="reliz--etap-4">  Release - Stage 4 </h4><br><p>  The fourth stage is release.  A beta-hardened build, already loaded into iTunesConnect and TestFlight in the third stage, is released. </p><br><h4 id="sborka-prilozheniy">  Build applications </h4><br><p>  Builds are done directly by xcodebuild.  Each stage is lined with a separate configuration and arguments.  For example, right at the beginning we completely disconnect Link-Time Optimizations to save time before an exit of a task to testing.  Also at the first stage in the application there is a functional available that is activated in compile-time, which helps to track and debug problems, and also makes it easier for the QA-team to do some tasks: </p><br><ul><li>  database re-creation; </li><li>  delete cookie; </li><li>  sending debug-level logs and bases to a separate box; </li><li>  additional visual elements showing the state of some parameters that we use (for example, displaying the quality of the connection); </li><li>  the ability to specifically finish the application; </li><li>  checking the call of the specified methods of the specified classes on the main thread. </li></ul><br><h4 id="podpis-prilozheniya-i-provisioning-profile">  Application signature and provisioning profile </h4><br><p>  At the moment with the automated assembly, we rigidly set the certificate used and the provisioning profile.  Before the assembly, we go through the profiles available on the node, select the one we need exactly for the current assembly and set it in the project settings via environment variables.  This step, of course, is done automatically by the scripts. </p><br><p>  There were reasons for this.  We are trying to upgrade to the new major versions of XCode as soon as they appear, and on one of the beta versions of XCode 7.0, we stumbled upon a bug in xcodebuild: it did not allow the automatic definition of the provisioning profile to be used consistently.  Therefore, we implemented on the same Ruby module, which finds among all the available profiles the necessary Bundle Id, and then added to the project in place of the profiles env-variables.  When assembling, we put profile identifiers in them. </p><br><p>  On Xcode 7.0, this did not cause any inconvenience.  The profile was still automatically substituted by the development environment if the env variable was empty.  But with XCode 8.0 and Automatic Signing, our method could not work.  With Automatic Signing, the environment automatically substitutes both in the debug and release versions of the development certificates and, accordingly, the profiles.  If you set it hard on a release-version distribution-certificate, then xcodebuild refuses to work. </p><br><p>  That is, it is assumed that when creating xcarchive, there is always a version subscribed to development.  And then the second stage follows - exporting IPA, for it you can now set the configuration via -exportOptionsPlist and re-sign the application according to the desired distribution.  We were initially not satisfied with such rules, so we turned off Automatic Signing and still substitute profiles manually.  The configuration is as follows: </p><br><p><img src="https://habrastorage.org/files/976/d9c/2b5/976d9c2b59734b51abb40427d8352849.png" alt="image"></p><br><h4 id="problemy">  Problems </h4><br><p>  Xcodebuild has a limitation that we did not manage to get around: without prejudice to the duration of the execution, more than one process cannot be started.  We played different env-variables and paths to the cache and data, but to no avail.  Somewhere he still rests on shared resources. </p><br><p>  With simultaneous assemblies, the successive work of each process is strongly noticeable.  The total duration with two parallel xcodebuild is almost doubled.  Therefore, we install one executor for each Jenkins slave.  This eliminates the interference of two tasks without additional plug-ins, which do not always adequately work in Jenkins.  At the same time, all our Job's use the dedicated executor to the maximum, there is no particular reason to run several tasks in parallel, they will only interfere with each other. </p><br><h3 id="proverki-i-testy">  Checks and tests </h3><br><p>  For checks and tests there are corresponding Rake-tasks - for each check is separate.  More specifically about the purpose and implementation of checks further, but for now - a high-level job description. </p><br><p>  Jenkins uses the <a href="https://wiki.jenkins-ci.org/display/JENKINS/Build%2BFlow%2BPlugin">BuildFlow</a> plugin, which allows you to run parallel tasks, merge them, create chains, etc. Any automated checks and tests run as part of the BuildFlow task.  In the full version, in parallel, run: </p><br><ul><li>  project and source checks - localization of strings, use of categories, titles of UI-tests, inclusion of sources in targets; </li><li>  static code analysis; </li><li>  Unit tests; </li><li>  UI tests. </li></ul><br><p>  The first three tasks are performed in one Jenkins Job, but the UI test system is slightly more complicated than running tests through xcodebuild.  This is a separate chain, its first step - prebuild - is as follows: </p><br><ul><li>  build test application; </li><li>  the distribution of UI tests on groups for parallel execution; </li><li>  packaging assembly to the archive. </li></ul><br><p><img src="https://habrastorage.org/files/c99/124/2c0/c991242c03a54ea5b30a13b0e9fbceb6.png" alt="image"></p><br><p>  Then, based on the distribution results, BuildFlow runs the required number of tasks in Jenkins, each with its own group of tests.  Each Job receives UI tests, configuration, build, and scripts from Prebuild Job‚Äôs artifacts in one archive.  After BuildFlow proceeds to the next task, the essence of which is to create a final general report and execute notifications in Jira, HipChat, Gerrit.  For the results of the work of each of the ways, this task turns into artifacts.  BuildFlow is configured, you can turn off any of the paths if necessary. </p><br><h2 id="ui-testy">  UI tests </h2><br><h3 id="kakim-dolzhen-byt-freymvork">  What should be the framework </h3><br><p>  We believe that the framework for UI testing is needed: </p><br><ol><li>  Elementary syntax with which not only iOS-developer and programmer is able to cope. </li><li>  The ability to reuse their work.  When writing a UI test, commands are targeted using accessibility identifiers (most often).  Ideally, we want to build our own library on top of the standardly available commands.  This will allow us to abandon duplication of the elementary code, as well as ease the task with minor corrections in the application code.  Has the ID changed?  No Find and Replace: go to the interlayer and change one identifier there. </li></ol><br><p>  MonkeyTalk (currently <a href="https://www.oracle.com/corporate/acquisitions/cloudmonkey/index.html">purchased</a> by Oracle, its further path is not yet known) came up according to our criteria and significantly outpaced the remaining bidders.  It has its own elementary syntax, simple, which allows you to take common fragments of tests into separate scripts and reuse them.  To write a test in this language, you can not understand programming at all, you just need to find out Accessibility Identifier - extract it with a utility like <a href="https://revealapp.com/">Reveal</a> , Accessibility Inspector or <a href="https://github.com/Flipboard/FLEX">Flex</a> , and in extreme cases, check with the developer. </p><br><p>  The final script almost completely repeats the test case described by the QA team.  At the same time, MonkeyTalk supports JavaScript.  Here, the scope of actions allows you to implement the very layer on top of the standard commands and element identifiers.  Gradually, something very similar to <a href="https://martinfowler.com/bliki/PageObject.html">Page Object was created</a> .  Each screen, dialogue and application element eventually got its own module in JavaScript, which greatly accelerated the development of UI tests. </p><br><p>  At the same time, all the advantages of programming (cycles, conditions, functions) are available, although we are against it.  The test should be simple, straightforward, and let it be slightly verbose.  If the test fails, sometimes you have to contact the script, and you need the opportunity to clearly and precisely say that the letter‚Äôs name verification did not pass after deletion through the Edit mode.  And to do this in the presence of a <u>cycle in modes with three conditional divisions by commands and a pair of lambdas in the arguments</u> can be very difficult and extremely unpleasant.  However, in some tests we still use (but in moderation) cycles, which is really great shortening the length of the test script. </p><br><p>  MonkeyTalk has another major advantage, which was very useful later in optimizing and speeding up the performance of a greatly increased base of UI tests. </p><br><h3 id="modifikacii-monkeytalk">  MonkeyTalk modifications </h3><br><p>  MonkeyTalk does not depend on XCTest.  Thanks to this key feature, we were able to implement a distributed system for performing UI tests.  Other frameworks ( <a href="https://github.com/kif-framework/KIF">KIF</a> , <a href="https://github.com/google/EarlGrey">EarlGrey</a> , and the official XCUITest) are launched via xcodebuild.  With XCUITest everything is quite hard.  If you look at the processes that are running during the tests, you will notice <strong>testmanagerd</strong> .  He is fully engaged in current testing alone.  If you run another session in parallel, it is because of testmanagerd that nothing will come out: the tests do not even start. </p><br><p>  KIF and EarlGrey are based on XCTest.  When we only began to think about parallel launching within a single node, there were not so many developments.  <a href="https://github.com/facebook/FBSimulatorControl">FBSimulatorControl</a> began to develop, only then <a href="https://github.com/plu/pxctest">pxctest</a> appeared.  Own attempts to anything more or less usable did not lead.  The version with MonkeyTalk was easier and more accessible. </p><br><p>  MonkeyTalk does not depend on either XCTest or XCUITest.  It has a separate system for running and running a test.  An agent with an http server is built into the application.  On the side of the scripts, the runner is used, which parses the UI test script, sends the commands to the specified address and waits for a response with the result of the command execution. </p><br><p>  As a result, we only need to run the application on the simulator, wait for the launch, then run the runner and process the results. </p><br><p>  Over time, and the next iOS updates, we encountered some difficulties; to solve them, we modified MonkeyTalk for ourselves and implemented: </p><br><ul><li>  "Fair" work with the keyboard; </li><li>  "Honest" tapas and gestures at the level of events UIApplication; </li><li>  additional commands for the controlled call of helpers; </li><li>  full visibility checks for items. </li></ul><br><p>  We also rewrote the interaction with some elements of UIKit and part of the network interaction, significantly speeding up the entire framework. </p><br><p>  UI tests should work as close as possible to actual conditions and preserve the principles of the black box.  Tapes and gestures in real conditions are performed by the user's hand.  The closest thing we can achieve with automation is an imitation of clicks at the event level in the application.  Initially, MonkeyTalk directly sent messages to UIControls and UIGestureRecognizers, which did not suit us at all, and sometimes simply did not allow us to cover the case. </p><br><p>  We can also control all network interaction through the test script, enabling / disabling stubs, including when the application is started;  more on that later.  An additional advantage is an absolutely similar process for a real device, if we suddenly decide to switch to them. </p><br><h3 id="upravlenie-ui-testami-cherez-skripty">  Manage UI tests through scripts </h3><br><p>  Since MonkeyTalk has a special way to run, I had to implement additional control scripts.  Their tasks are: </p><br><ul><li>  define a test suite to run; </li><li>  control the simulator; </li><li>  run UI tests; </li><li>  process the results. </li></ul><br><p>  For the UI test script itself, we entered a title, which we will discuss in detail below.  Now it‚Äôs worth pointing out that the device type and the iOS version on which the test is to be performed is specified in the header.  If several arguments are given, then the Cartesian product will be taken.  It is also possible to pass various arguments to the application to configure the application before testing. </p><br><p>  All this is quite simple to implement, but UI testing is a long process, and our goal is to check every change in the project. </p><br><h3 id="masshtabirovanie--parallelnyy-zapusk">  Scaling - parallel launch </h3><br><h4 id="pervaya-versiya">  First version </h4><br><p>  Initially, our self-written UI test execution system was characterized by low utilization of resources.  We smashed 70 tests into folders.  Each folder corresponds to a UI test category (for example, authorization).  When launched, the folders were distributed to the Mac Mini available to us.  At each of them, only one simulator worked at the same time, which was restarted and completely erased under the new UI test.  Obvious disadvantages: </p><br><ul><li>  Mac Mini with i5 and 16 GB of RAM utilizes an average of 0% of resources; </li><li>  the distribution into folders-categories is uneven, the search tests turned out to be significantly less than the tests for writing a letter; </li><li>  the number of tests grew, and they were still running slowly, serious queues formed on the CI, and without successfully passing the tests, the task could not be delayed. </li></ul><br><p>  Then, slightly expanding the base of tests, covering the most necessary and basic, we began to look for ways to maximize the utilization of resources.  And found. </p><br><h4 id="tekuschaya-versiya">  Current version </h4><br><p><img src="https://habrastorage.org/files/d7e/ca4/591/d7eca45910d045bb96200495e09ed121.png" alt="image"></p><br><p>  ,                   .           : </p><br><ol><li>     ,       . </li><li>    /       ,    ,    . </li></ol><br><p> <strong>    </strong> </p><br><p> -         HTTP-  MonkeyTalk     .     MonkeyTalk  ,    .       environment variable  launch argument. </p><br><p>       ,       .     i7, 16    SSD   - .     ,        .          .  ,  env-,  .           UI-. </p><br><p>       Jenkins  API.     env-  .    ,  , ,      .       API. </p><br><p>   ‚Äî     .       ,    .     ,         ,       .      ,       Jenkins.          : </p><br><ol><li>     . </li><li>  json  . </li><li>  . </li><li>         . </li></ol><br><p>     json     UI-.       UI-  ,      .          UI-.        : </p><br><ol><li>        . </li><li>    json   ,   . </li><li>    ( )      . </li><li>   ‚Äî ¬´ ¬ª =&gt; ¬´¬ª,       . </li><li>    UI-  Jenkins    ,  . </li><li>   ,    . </li><li>       . </li></ol><br><p>  UI-    : </p><br><ol><li>    . </li><li>       . </li></ol><br><p>    . ,   UI-   .    ,   .         ,    .        ,    . </p><br><p>     UI-      .    ,      .       ,      : </p><br><ul><li> ,   , . .     ; </li><li>      ,     ; </li><li>     . </li></ul><br><p>   json    ,          : </p><br><pre> <code class="bash hljs"> INFO IOSMail::UITestsGrouper : Getting all available tests... INFO IOSMail::UITestsGrouper : Found 506 available tests. Took 0.8894939422607422 secs. INFO IOSMail::UITestsGrouper : Reading stats json from ./ui-tests/uitests_stats.json... INFO IOSMail::UITestsGrouper : Gluing available tests and stats... WARN IOSMail::UITestsGrouper : No statistics <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ScrollToFirstLetterInListFromMiddle.mt_iPhone5s. Using mean tests time. INFO IOSMail::UITestsGrouper : Statistical total duration = 33603.8670472377 INFO IOSMail::UITestsGrouper : Computing capacities counters... INFO IOSMail::UITestsGrouper : Capacities counters received and computed. Took 3.4377992153167725 secs. INFO IOSMail::UITestsGrouper : Partitioning <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> 7 parts... INFO IOSMail::UITestsGrouper : Allocated partitions = [{:capacity=&gt;4, :label=&gt;<span class="hljs-string"><span class="hljs-string">"4sim"</span></span>, :tests=&gt;[]}, {:capacity=&gt;4, :label=&gt;<span class="hljs-string"><span class="hljs-string">"4sim"</span></span>, :tests=&gt;[]}, {:capacity=&gt;5, :label=&gt;<span class="hljs-string"><span class="hljs-string">"5sim"</span></span>, :tests=&gt;[]}, {:capacity=&gt;4, :label=&gt;<span class="hljs-string"><span class="hljs-string">"4sim"</span></span>, :tests=&gt;[]}, {:capacity=&gt;5, :label=&gt;<span class="hljs-string"><span class="hljs-string">"5sim"</span></span>, :tests=&gt;[]}, {:capacity=&gt;3, :label=&gt;<span class="hljs-string"><span class="hljs-string">"3sim"</span></span>, :tests=&gt;[]}, {:capacity=&gt;4, :label=&gt;<span class="hljs-string"><span class="hljs-string">"4sim"</span></span>, :tests=&gt;[]}] INFO IOSMail::UITestsGrouper : Partitions constructed, took 0.039823055267333984 secs. INFO IOSMail::UITestsGrouper : Partitions sizes = [72, 70, 87, 73, 83, 46, 75] INFO IOSMail::UITestsGrouper : Partitions durations = [1157.0547642111776, 1160.5415018200872, 1157.1358834599146, 1159.2893925905228, 1158.044078969956, 1161.813697735469, 1158.7458768486974]</code> </pre> <br><p>         .       4‚Äî5 ,     API Jenkins.         UI-,    .         ,      . </p><br><p>            UI-.    .           ,     ‚Äî   40 .          .     ,       5 , ,   ,   .   ,     ,    10‚Äî15 UI-.      .    :         10 ,         . </p><br><h3 id="izolyaciya-zapuskov">   </h3><br><p>    UI-   .                .      UI-        . </p><br><h3 id="kazhdomu-po-simulyatoru">   ! </h3><br><p>   ,       .  ruby   wrapper  simctl ‚Äî    xcode    iOS-.       <em></em>   : </p><br><pre> <code class="ruby hljs">simulator = Simulators::MRSimulator.new(test_name, type, runtime) simulator.launch simulator.prepare(app) simulator.install_app(app) If access_allowed simulator.enable_access(app) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> simulator.disable_access(app) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> simulator.run_app(app, arguments, env) <span class="hljs-comment"><span class="hljs-comment">#  MonkeyTalk runner simulator.shutdown #   (, -, , , ) simulator.destroy</span></span></code> </pre> <br><p> - ,    simctl,        ,   ,    .   ÃÅ     syslog'     .          .            ‚Äî        . </p><br><h3 id="obschak-simulyatorov">   </h3><br><p>      ,   .      : </p><br><ol><li>  Run </li><li>   . </li><li>    . </li><li>  . </li><li>     ‚Äî , keychain,  ,       (TCC). </li><li>   ,        , ‚Äî    2. </li></ol><br><p>         ,       .   ,     20 . ,            . </p><br><p>        keychain.  data-  appgroup-     .         .   keychain  .    keychain-2-debug.db.       ,       -   ,    .     keychain: </p><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear_keychain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">`</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqlite3</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">~</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">/</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Library</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">/</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Developer</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">/</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CoreSimulator</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">/</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Devices</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">/</span></span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">#{</span></span><span class="hljs-doctag"><span class="hljs-function"><span class="hljs-comment"><span class="hljs-doctag">@id</span></span></span></span><span class="hljs-function"><span class="hljs-comment">}/data/Library/Keychains/keychain-2-debug.db "delete from genp;"` end</span></span></span></span></code> </pre> <br><p>     ,      ( ,  ),        keychain ‚Äî     . </p><br><h3 id="obhody-problem-xcode-simulator-i-t-d">   xcode, simulator  . . </h3><br><h4 id="ctabilnost-vzaimodeystviya-s-ios-simulyatorami-ostavlyaet-zhelat-luchshego"> C   iOS-    </h4><br><p> iOS-      ,      .   , ,     ,      ,       . ,        ,      -   .         .   iOS-      ,     dlopen,    .      ‚Äî     ,    Jenkins      ,     .           . ,      -        . </p><br><h4 id="pul-simulyatorov-i-nagruzka">     </h4><br><p>           ,      .     -, ,        watchdog  springboard.     ‚Äî  20 .       ,    <a href="https://github.com/facebook/FBSimulatorControl">FBSimulatorControl</a>  Facebook. ,   preferences  springboard       ,    -   Bundle Id.          ,     springboard, preferences  , ?    ‚Äî    . </p><br><p>    ‚Äî     .      File IO.        CI,      ,     launchd, kernel_task   CoreSimulator.         .        .   XCode 8.0      - ,    -,       160 .           ,  . </p><br><h3 id="asinhronnyy-simctl-bez-priznakov-zaversheniya-deystviya">  simctl     </h3><br><p>      simctl,     XCode, ‚Äî   .   ,     ,       launch screen.      (.  ‚Äî   watchdog).    simctl ,        syslog' .     ,  , : </p><br><ul><li>  ; </li><li>   ; </li><li>  ; </li><li>  . </li></ul><br><h4 id="sistemnye-dialogi-v-prilozhenii">     </h4><br><p>       . MonkeyTalk    ,        .          .        sqlite  TCC.db,    . </p><br><h3 id="dostup-k-foto-i-kontaktam">      </h3><br><p>   ,        ,            .      .      ,          . </p><br><p>       ,      /.     sqlite  TCC.db,      : </p><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup_access</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(simulator_id, app, disabled, </span></span><span class="hljs-symbol"><span class="hljs-function"><span class="hljs-params"><span class="hljs-symbol">simulator_set_path:</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"</span></span></span><span class="hljs-subst"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string"><span class="hljs-subst">#{ENV[</span></span></span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'HOME'</span></span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-string"><span class="hljs-subst">]}</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">/Library/Developer/CoreSimulator/Devices"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> tcc_path = File.join(simulator_set_path, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{simulator_id}</span></span></span><span class="hljs-string">/data/Library/TCC/TCC.db"</span></span>) Utilities::FileMonitoring.wait_for_file_creation(tcc_path, <span class="hljs-symbol"><span class="hljs-symbol">:max_wait</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">30</span></span>) { raise Simulators::Errors::SimulatorTimeoutError.new(<span class="hljs-string"><span class="hljs-string">"Timed out while waiting for TCC!"</span></span>) } rights = disabled ? <span class="hljs-string"><span class="hljs-string">'0'</span></span> : <span class="hljs-string"><span class="hljs-string">'1'</span></span> [<span class="hljs-string"><span class="hljs-string">'kTCCServiceAddressBook'</span></span>, <span class="hljs-string"><span class="hljs-string">'kTCCServicePhotos'</span></span>, <span class="hljs-string"><span class="hljs-string">'kTCCServiceCalendar'</span></span>].each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|access_target|</span></span> <span class="hljs-string"><span class="hljs-string">`sqlite3 </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{tcc_path}</span></span></span><span class="hljs-string"> "replace into access(service, client, client_type, allowed, prompt_count) values ('</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{access_target}</span></span></span><span class="hljs-string">','</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{app.bundle_id}</span></span></span><span class="hljs-string">',0,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{rights}</span></span></span><span class="hljs-string">,1)" 2&gt;&amp;1`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><h3 id="podmena-otvetov-servera">    </h3><br><p>  UI-    .          CI   ,  , ,   ,  .                 .      URLProtocol,      .   URLProtocol'     FakeResponse.   UI-  FakeResponse  ,     .               .           : </p><br><ul><li>  ; </li><li>     ; </li><li>   . </li></ul><br><h3 id="reporting">  </h3><br><p>   Jira  Hipchat   UI-    . ,  ,      Jenkins Job'.     HTML-   UI-, UI-,   ,  UI-   .              (  UI- ‚Äî //)   : </p><br><ul><li>   ; </li><li>   UI-; </li><li> HTML-  XML- UI-; </li><li> data- ; </li><li> appgroup- ; </li><li> ; </li><li> -,  ; </li><li>       . </li></ul><br><p>    UI-       debug-.  HTML-   json-,      ,       N .      Job'   json- -     , ,   . </p><br><p>   HTML-     Jenkins,    Jira      : </p><br><p><img src="https://habrastorage.org/files/6d6/4d1/d62/6d64d1d625c0428b8bd071c7da33dfbc.png" alt="image"></p><br><p>  Jira,      ,     HipChat: </p><br><p><img src="https://habrastorage.org/files/b62/da5/f5d/b62da5f5d98443ecbfb7ba469307209b.png" alt="image"></p><br><p>  HTML-     : </p><br><p><img src="https://habrastorage.org/files/6c3/925/8cf/6c39258cfff94aa9aa2d4af6d716b342.png" alt="image"></p><br><h3 id="generaciya-dokumentacii">   </h3><br><p>      ‚Äî -,   : </p><br><ul><li>    UI-; </li><li> ; </li><li> ; </li><li> ; </li><li>  ; </li><li> runtime; </li><li>     . </li></ul><br><p>       HTML-  .             UI-.           CI-. </p><br><h3 id="itogovye-harakteristiki-sistemy">    </h3><br><p>     BuildFlow ‚Äî UI-.         : </p><br><ul><li>  UI- ‚Äî 506; </li><li>    UI-   ‚Äî 9  20 ; </li><li>   UI-           ‚Äî 45‚Äî50 ; </li><li>   UI- ‚Äî 66 ; </li><li>   UI- ‚Äî 397 . </li></ul><br><p>       Prebuild,   5‚Äî6 ,       Gerrit.           CI   506 UI-   55 . </p><br><h3 id="nedostatki">  disadvantages </h3><br><p>     ,         XCode.         ,     .    ‚Äî    : </p><br><ul><li>  MonkeyTalk  ,       iOS 8.0; </li><li>    simctl    springboard    ,        XCode ( ); </li><li>     XCode        ,    ,     XCode 8.0,    . </li></ul><br><p>    - ,             .    . </p><br><h3 id="preimuschestva">  Benefits </h3><br><ul><li> 9,33  UI-   60 ; </li><li>        ( ,   ,   ); </li><li>  ‚Äî  .   CI   50  ‚Äî , , 50   50      iOS. </li></ul><br><p>   ,      ,   : </p><br><ul><li>     ,   :       ; </li><li>          UI-,        XCUITest; </li><li>  ,     UI-    ,     . </li></ul><br><h2 id="proverki-proekta">   </h2><br><h3 id="same-targets"> Same Targets </h3><br><p>   alpha-        . ,                ,     iTunes. </p><br><p>         : Alpha, Beta  AppStore.    Alpha       Alpha-.     ,  -           .      .       (,   )       ,    .  CI           .  -  ,    .        .        ,   ,       .          Alpha-,   .     json.     : </p><br><pre> <code class="ruby hljs">{ <span class="hljs-string"><span class="hljs-string">"compare-sets"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"targets"</span></span>: [<span class="hljs-string"><span class="hljs-string">"MRMail-Alpha-Enterprise"</span></span>, <span class="hljs-string"><span class="hljs-string">"MRMail-Pub-Beta-Enterprise"</span></span>, <span class="hljs-string"><span class="hljs-string">"MRMail-AppStore"</span></span>, <span class="hljs-string"><span class="hljs-string">"MRMail-MonkeyTalk"</span></span>], <span class="hljs-string"><span class="hljs-string">"exclusive"</span></span>: { <span class="hljs-string"><span class="hljs-string">"MRMail-Alpha-Enterprise"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"^pod-packages/Reveal-iOS-SDK/"</span></span>, <span class="hljs-string"><span class="hljs-string">"^src/infrastructure/MainThreadGuard/UIKitThreadGuard\\.m$"</span></span>,</code> </pre> <br><p>        ,      <a href="https://github.com/CocoaPods/Xcodeproj">xcodeproj</a> ,    . </p><br><h3 id="lokalizaciya">  Localization </h3><br><p>      ,   .  ,         .            ,  ,         : </p><br><ul><li> NL (Not Localized):    ; </li><li> L (Localized):  ‚Äî  ,      . </li></ul><br><p>     Build Phase, . .       .   -      ,     CI,     ,      Open. </p><br><h3 id="kategorii">  Categories </h3><br><p>      Xcode    ‚Äî ,    ,         ,       .             /.     : </p><br><ul><li>  ; </li><li> action extension; </li><li> share extension; </li><li> today extension; </li><li> shared framework. </li></ul><br><p>      ,      ,        .          ,     ,         .     ,    ,        , <em>    </em> .        ‚Äî   Ruby, : </p><br><ul><li>      ; </li><li>   import         ,    import . </li></ul><br><p>    ‚Äî ,  .     : </p><br><ul><li> Protected/Private- ‚Äî       ; </li><li>    ‚Äî    . </li></ul><br><p>        ,     .     .     ‚Äî   ‚Äî  ,    ,   ,      .        : </p><br><pre> <code class="ruby hljs">{ <span class="hljs-string"><span class="hljs-string">"rules"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"GeneralExternalImplementation"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ExternalImplCheck"</span></span>, <span class="hljs-string"><span class="hljs-string">"imports"</span></span>: { <span class="hljs-string"><span class="hljs-string">"AccountEnvironmentImpl+Protected.h"</span></span>: <span class="hljs-string"><span class="hljs-string">"AccountEnvironmentImpl.m"</span></span>, ‚Ä¶‚Ä¶.</code> </pre> <br><p>       ‚Äî      AccountEnvironmentImpl+Protected.h       AccountEnvironmentImpl.m. </p><br><p>                CI-       . <br>         <a href="https://github.com/CocoaPods/Xcodeproj">xcodeproj</a> . </p><br><h3 id="zagolovki-testov">   </h3><br><p>    ,  UI-       ‚Äî   .                .   UI-  : </p><br><ul><li> Jira-; </li><li> ; </li><li>  (   ,       ,    ); </li><li> / (  ). </li></ul><br><p>    UI-: </p><br><pre> <code class="html hljs xml"># tasks: IOSMAIL-6020 # name:   # category: Compose # description:  ,   ¬´¬ª  ,  , ,    # .</code> </pre> <br><h3 id="reporting-1">  </h3><br><p>        ,      Jenkins Job,     ,     Rake-.        ,       ,   . </p><br><p>    ,  HTML-    ,        BuildFlow.  It looks like this: </p><br><p><img src="https://habrastorage.org/files/d07/951/4ea/d079514ea8214a05a1e7040487b30d57.png" alt="image"><br><img src="https://habrastorage.org/files/dd9/5c9/5e4/dd95c95e4cf24782a68991dbd22e0acd.png" alt="image"></p><br><h2 id="staticheskiy-analiz-koda">  Static code analysis </h2><br><h3 id="scan-build"> scan-build </h3><br><p>      <a href="http://clang-analyzer.llvm.org/scan-build.html">scan-build</a> + xcodebuild.    :      .    scan-build         .     , ,    ,           .           ‚Äî     . </p><br><p>  scan-build,    ,    HTML-. </p><br><h3 id="fbinfer"> fbinfer </h3><br><p>     CI      <a href="https://github.com/facebook/infer">infer</a> .   ‚Äî  .            1  10 .     .       ,      .   ÃÅ  .       CI-,       ,       ,       . </p><br><p>    ,       CI,     <u> </u> ,             .      ‚Äî ,   infer  scan-build,    . </p><br><h2 id="profayling-i-taymingi-zapuska">     </h2><br><p>     .  <a href="https://habrahabr.ru/company/mailru/blog/307778/">    </a> ,    ,   . </p><br><p>      alpha-    Downstream Job,      . </p><br><p>  Job    ,     . <br>    250     .     InfluxDB,     Grafana.  ,  ,     ,  , -     :      ,      ( ,   ). </p><br><p><img src="https://habrastorage.org/files/e3d/ca4/15c/e3dca415cab94b1eaf367dcfd14f283a.png" alt="image"></p><br><h3 id="unit-testy"> Unit- </h3><br><p>  Unit-    ‚Äî xcodebuild + <a href="https://github.com/supermarin/xcpretty">xcpretty</a> . HTML- xcpretty,    ,         . Unit- ‚Äî      BuildFlow.         1451 Unit-,      10‚Äî11 . </p><br><h3 id="hipchat-i-reporting"> HipChat   </h3><br><h4 id="report-o-novyh-zadachah">     </h4><br><p>   Jira + HipChat.      ,      ,           . </p><br><h4 id="report-o-rezultatah-sborki-testov-proverok">    , ,  </h4><br><p>  ‚Äî       CI-.       .       . : </p><br><ul><li>      ; </li><li>     ; </li><li>    ; </li><li>  HTML-; </li><li>   Jira, Gerrit  HipChat. </li></ul><br><p>       ,  .      CI ‚Äî Unit-, UI-,  ,   ‚Äî   55‚Äî60    . </p><br><p>        ,      ,     /.      ,       .  , ,   (  ): <em>  ,     CI,         </em> .      <u>Continuous Reporting</u> ,        . ,        ,     ,        . </p><br><h2 id="zaklyuchenievyvody"> / </h2><br><p>       .              : </p><br><ul><li>    iOS-,       ; </li><li>       ,  same targets. </li></ul><br><p>         ,    ,      ,  ,  . ,   ,    ,    ,    .              . </p><br><p>    ÃÅ     ,     ,     .             . </p><br><p><img src="https://habrastorage.org/files/6a9/f9b/d68/6a9f9bd68f83412f96b6711a482e4973.jpg" alt="image"></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/325552/">https://habr.com/ru/post/325552/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325526/index.html">Do we need neural networks?</a></li>
<li><a href="../325528/index.html">Kademlia (DHT) - A Practical Guide</a></li>
<li><a href="../325532/index.html">Top 8 new fintech applications of the beginning of 2017</a></li>
<li><a href="../325546/index.html">Setting up replication in FreeIPA 4.4 with domain level 1</a></li>
<li><a href="../325550/index.html">7 cases of using Big Data technologies in production</a></li>
<li><a href="../325554/index.html">What will block your site? Roskomnadzor and resource bank in a nutshell</a></li>
<li><a href="../325558/index.html">Oblakoteka has selected Lenovo servers as a platform for the latest IaaS services</a></li>
<li><a href="../325560/index.html">About configuring Open vSwitch a difficult language</a></li>
<li><a href="../325564/index.html">R, GIS and fuzzyjoin: restore statistics for the NUTS regions</a></li>
<li><a href="../325566/index.html">Why the cloud does not take off: how loyalty systems work in stores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>