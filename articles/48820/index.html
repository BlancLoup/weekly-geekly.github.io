<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interaction with the database at a basic level without the involvement of specialized frameworks.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This topic is a response to this application in the wizard about a habruiser that projects for working with a database on .Net take up a lot of disk s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interaction with the database at a basic level without the involvement of specialized frameworks.</h1><div class="post__text post__text-html js-mediator-article">  This topic is a response to <a href="http://wizard.habrahabr.ru/blog/48808/">this</a> application in the <a href="https://habrahabr.ru/users/wizard/" class="user_link">wizard</a> about a habruiser that projects for working with a database on .Net take up a lot of disk space and in general, twenty years ago the grass was greener and the trees higher. <br>  As one of the commentators of the aforementioned topic ( <a href="https://habrahabr.ru/users/neuotq/" class="user_link">neuotq</a> ) said: <br><blockquote>  to dig a hole in the sandboxes you should not use an excavator and the whole construction team </blockquote><br>  It is important to understand that modern frameworks provide the programmer with many tools for solving problems.  And if you need, I quote, ‚Äúget a couple of lines of data‚Äù from the database, you do not need to use ‚Äúcombines with a laser sight‚Äù for this purpose a la ADO.Net Entity Framework or NHibernate.  It is important to understand that such tools are designed for <u>large</u> projects.  By a large project, I mean not a term paper or a thesis, but large-scale commercial systems that cost a lot of money and an extra ‚Äú1 day (week, month)‚Äù (again, <a href="http://wizard.habrahabr.ru/blog/48808/">quote</a> ) spent writing my own bikes costs the customer hundreds (thousands, millions) is not Russian money.  A good developer is different from a bad one in that he knows when to write a bike, and when it‚Äôs enough to take a ready one.  A bad one, respectively, either shoves frameworks around, or else it writes bicycles everywhere.  And the blame for this is not the developer‚Äôs tools, but himself. <br>  Everything, I will not tire with my philosophy.  Under habrakat you can read about how you can interact with the database in .Net without the involvement of excavators. <br><a name="habracut"></a><br>  So, if your application has a simple database from several tables, and you want to achieve high performance of the pair of queries that you will need to perform, then it is not necessary to use the ADO.Net Entity Framework or something comparable.  It will be enough to use the SqlConnection, SqlCommand and SqlDataReader classes.  To demonstrate, we will write a simple window on WPF: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Window</font> <font color="#ff0000">x:Class</font> <font color="#0000ff">="sqlTest.Window1"</font> &lt;br&gt; <font color="#ff0000">xmlns</font> <font color="#0000ff">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</font> &lt;br&gt; <font color="#ff0000">xmlns:x</font> <font color="#0000ff">="http://schemas.microsoft.com/winfx/2006/xaml"</font> &lt;br&gt; <font color="#ff0000">Title</font> <font color="#0000ff">="Window1"</font> <font color="#ff0000">Height</font> <font color="#0000ff">="339"</font> <font color="#ff0000">Width</font> <font color="#0000ff">="783"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">Grid</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">Label</font> <font color="#ff0000">Height</font> <font color="#0000ff">="28"</font> <font color="#ff0000">HorizontalAlignment</font> <font color="#0000ff">="Left"</font> <font color="#ff0000">Name</font> <font color="#0000ff">="label1"</font> <font color="#ff0000">VerticalAlignment</font> <font color="#0000ff">="Top"</font> <font color="#ff0000">Width</font> <font color="#0000ff">="120"</font> <font color="#0000ff">&gt;</font> Connection String: <font color="#0000ff">&lt;/</font> <font color="#800000">Label</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">TextBox</font> <font color="#ff0000">Height</font> <font color="#0000ff">="23"</font> <font color="#ff0000">Margin</font> <font color="#0000ff">="126,2,0,0"</font> <font color="#ff0000">Name</font> <font color="#0000ff">="connStr"</font> <font color="#ff0000">VerticalAlignment</font> <font color="#0000ff">="Top"</font> <font color="#0000ff">&gt;</font> Data Source=localhost;Initial Catalog=BlogNetTest;Integrated Security=True;MultipleActiveResultSets=True <font color="#0000ff">&lt;/</font> <font color="#800000">TextBox</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">TextBox</font> <font color="#ff0000">Margin</font> <font color="#0000ff">="126,31,0,0"</font> <font color="#ff0000">Name</font> <font color="#0000ff">="queryTB"</font> <font color="#ff0000">AcceptsReturn</font> <font color="#0000ff">="True"</font> <font color="#ff0000">TextWrapping</font> <font color="#0000ff">="Wrap"</font> <font color="#ff0000">Height</font> <font color="#0000ff">="132"</font> <font color="#ff0000">VerticalAlignment</font> <font color="#0000ff">="Top"</font> <font color="#0000ff">&gt;</font> SELECT * FROM Users <font color="#0000ff">&lt;/</font> <font color="#800000">TextBox</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">Label</font> <font color="#ff0000">Height</font> <font color="#0000ff">="28"</font> <font color="#ff0000">HorizontalAlignment</font> <font color="#0000ff">="Left"</font> <font color="#ff0000">Margin</font> <font color="#0000ff">="0,29,0,0"</font> <font color="#ff0000">Name</font> <font color="#0000ff">="label2"</font> <font color="#ff0000">VerticalAlignment</font> <font color="#0000ff">="Top"</font> <font color="#ff0000">Width</font> <font color="#0000ff">="120"</font> <font color="#0000ff">&gt;</font> Query: <font color="#0000ff">&lt;/</font> <font color="#800000">Label</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">TextBox</font> <font color="#ff0000">Height</font> <font color="#0000ff">="125"</font> <font color="#ff0000">Margin</font> <font color="#0000ff">="126,0,0,12"</font> <font color="#ff0000">Name</font> <font color="#0000ff">="resultTB"</font> <font color="#ff0000">VerticalAlignment</font> <font color="#0000ff">="Bottom"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">Button</font> <font color="#ff0000">Height</font> <font color="#0000ff">="23"</font> <font color="#ff0000">HorizontalAlignment</font> <font color="#0000ff">="Left"</font> <font color="#ff0000">Margin</font> <font color="#0000ff">="12,0,0,114"</font> <font color="#ff0000">Name</font> <font color="#0000ff">="button1"</font> <font color="#ff0000">VerticalAlignment</font> <font color="#0000ff">="Bottom"</font> <font color="#ff0000">Width</font> <font color="#0000ff">="108"</font> <font color="#ff0000">Click</font> <font color="#0000ff">="button1_Click"</font> <font color="#0000ff">&gt;</font> Execute <font color="#0000ff">&lt;/</font> <font color="#800000">Button</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">Grid</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">Window</font> <font color="#0000ff">&gt;</font></font> &lt;br&gt;&lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  It looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/bac/1a9/726/bac1a9726240e77d1a6d353eaaa3a8e6.png"><br>  Ok, now let's write the code that will execute the query and insert the result in the field at the bottom of the window: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">using</font> System;&lt;br&gt; <font color="#0000ff">using</font> System.Data.SqlClient;&lt;br&gt; <font color="#0000ff">using</font> System.Text;&lt;br&gt; <font color="#0000ff">using</font> System.Windows;&lt;br&gt;&lt;br&gt; <font color="#0000ff">namespace</font> sqlTest&lt;br&gt;{&lt;br&gt; <font color="#0000ff">public</font> <font color="#0000ff">partial</font> <font color="#0000ff">class</font> Window1&lt;br&gt;  {&lt;br&gt; <font color="#0000ff">public</font> Window1()&lt;br&gt;    {&lt;br&gt;      InitializeComponent();&lt;br&gt;    }&lt;br&gt;&lt;br&gt; <font color="#0000ff">private</font> <font color="#0000ff">void</font> button1_Click( <font color="#0000ff">object</font> sender, RoutedEventArgs e)&lt;br&gt;    {&lt;br&gt; <font color="#0000ff">try</font> &lt;br&gt;      {&lt;br&gt;        resultTB.Text = ReadData(connStr.Text, queryTB.Text);&lt;br&gt;      }&lt;br&gt; <font color="#0000ff">catch</font> (Exception ex)&lt;br&gt;      {&lt;br&gt;        resultTB.Text = <font color="#0000ff">string</font> .Format( <font color="#A31515">"Error: {0}"</font> , ex.Message);&lt;br&gt;      }&lt;br&gt;    }&lt;br&gt;&lt;br&gt; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">string</font> ReadData( <font color="#0000ff">string</font> connectionString, <font color="#0000ff">string</font> queryString)&lt;br&gt;    {&lt;br&gt; <font color="#0000ff">var</font> strBuilder = <font color="#0000ff">new</font> <font color="#2B91AF">StringBuilder</font> ();&lt;br&gt; <font color="#0000ff">using</font> ( <font color="#0000ff">var</font> connection =&lt;br&gt; <font color="#0000ff">new</font> SqlConnection(connectionString))&lt;br&gt;      {&lt;br&gt; <font color="#0000ff">var</font> command =&lt;br&gt; <font color="#0000ff">new</font> <font color="#2B91AF">SqlCommand</font> (queryString, connection);&lt;br&gt;        connection.Open();&lt;br&gt;&lt;br&gt; <font color="#0000ff">var</font> reader = command.ExecuteReader();&lt;br&gt;&lt;br&gt; <font color="#0000ff">while</font> (reader.Read())&lt;br&gt;        {&lt;br&gt; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; reader.FieldCount; i++)&lt;br&gt;          {&lt;br&gt;            strBuilder.AppendFormat( <font color="#A31515">"{0} - {1};"</font> , reader.GetName(i), reader[i]);&lt;br&gt;          }&lt;br&gt;          strBuilder.AppendLine();&lt;br&gt;        }&lt;br&gt;        reader.Close();&lt;br&gt;      }&lt;br&gt; <font color="#0000ff">return</font> strBuilder.ToString();&lt;br&gt;    }&lt;br&gt;&lt;br&gt;  }&lt;br&gt;}&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  A small explanation about the Connection String: this line is a description of how to connect to your database and how to form it for your database can be read <a href="http://www.connectionstrings.com/">here</a> .  My line will not work for you, as it refers to a local SQL Server 2005 Express Edition with a test base of one of my projects. <br>  But in general, that's all.  Solyushen occupies hundreds of kilobytes on the disk and 20 megabytes of memory at work.  This large amount of memory is due to the use of WPF, which has a minimum memory usage threshold of around 15 megabytes.  To verify this statement, I rewrote the program to work in console mode and made sure that it eats about 4 megabytes.  Of course, this is not small, but not too much today, when the memory amounts in gigabytes.  Yes, in 1989 such a program would occupy 500 kilobytes of memory on a machine with 1 MB of RAM (50%).  Now it takes 20 megabytes on a machine with 2 GB of RAM (1%).  But in 1989, I would have spent a month trying to implement even such a primitive functionality, as in the example, but now it happened in just 30 minutes. <br>  <a href="http://depositfiles.com/files/hnta2htcs">Archive with WPF and console project</a> <br>  PS I apologize for some confusion of the text, I spent only an hour and a half on it. <br>  <b>UPD:</b> The fact that SQLClient is used with might and main as a basis for frameworks that work with the database I know firsthand - three of the three commercial projects in the development of which I took part use it.  An article for students who do not know about them and stubbornly use ‚Äúexcavators for digging holes‚Äù in their coursework / diplomas and even scolding them for what you see ‚Äúdoes not allow them to make a direct request to the database‚Äù.  If you go superficially on-and-no in search of how you can work with a database from a datnet, you will see that 90% of the material is devoted to ADO.Net Datasets, LINQ2SQL and EF.  Actually, the newcomers peck at it, and then swear because they have chosen the wrong instrument from the very beginning. <br></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/48820/">https://habr.com/ru/post/48820/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../48808/index.html">Progress, damn it</a></li>
<li><a href="../48813/index.html">Donald Knuth 71</a></li>
<li><a href="../48815/index.html">Trying to remember - what flash video player recently ochchen praised on Habr√©?</a></li>
<li><a href="../48816/index.html">IPod shuffle without iTunes</a></li>
<li><a href="../48818/index.html">Critical situations what to do.</a></li>
<li><a href="../48821/index.html">Python 3 performance: diversion</a></li>
<li><a href="../48823/index.html">enter through F</a></li>
<li><a href="../48824/index.html">Small pleasures</a></li>
<li><a href="../48825/index.html">Search functions in the programs - concept</a></li>
<li><a href="../48826/index.html">Excellent technical support excuses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>