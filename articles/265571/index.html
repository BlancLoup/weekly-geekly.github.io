<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A statistical method for detecting anomalies in eBay</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Complex systems are prone to failures of many components, so it is reasonable to divide the failures into two classes. The first one can include repea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A statistical method for detecting anomalies in eBay</h1><div class="post__text post__text-html js-mediator-article">  Complex systems are prone to failures of many components, so it is reasonable to divide the failures into two classes.  The first one can include repeated failures that can be prevented (for example, a hard disk failure) and identified by direct checks.  The second class includes unforeseen failures. <br><br> <a href="http://habrahabr.ru/company/io/blog/265571/"><img src="https://habrastorage.org/getpro/habr/post_images/26a/535/3cf/26a5353cfd96c9d1c8badacbc689c91c.jpg" alt="image"></a> <br><a name="habracut"></a><br>  A tool for detecting unexpected failures is statistics - hence the name of the article.  The statistical <a href="https://onthe.io/learn/en/category/qna/What-is-a-statistical-anomaly">anomaly</a> detector tracks characteristic changes that go beyond what is acceptable and sends notifications.  The main advantage of the statistical method for determining anomalies is that it can be used to detect problems that have not been encountered before.  The disadvantages include the need to independently determine the root cause.  All this may seem too abstract, so I will give a concrete example. <br><br><h4>  Basic terms </h4><br>  To avoid confusion, here are some basic terms: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <b>Monitored Alarms:</b> Continuous tracking results for violations. </li><li>  <b>Violation: the</b> nature of the change, indicating that the website is not working properly.  Human intervention is needed to determine the cause. </li><li>  <b>Anomaly:</b> an unusual pattern of changes in monitored signals, indicating possible irregularities. </li><li>  <b>Notification:</b> automatic signal indicating an abnormality.  Usually sent when an anomaly is detected. </li></ul><br>  A certain obstacle in creating effective statistical detectors is the possibility of false positives: notifications of non-existent violations.  If the anomaly detector has too many false positives, the user will turn off notifications or mark them as spam, or just ignore them.  And such a detector is clearly not very effective. <br><br>  In this article, I will describe the statistical anomaly detector used by <a href="http://www.ebay.com/">eBay</a> .  A similar scheme is also used in the <a href="https://t.onthe.io/">t.onthe.io</a> analytics <a href="https://t.onthe.io/">tool</a> .  In the search engine in question, the monitored signals will be based on the most repetitive search results generated by a set of reference queries.  For the statistical anomaly detector to work, a method of translating the results into numerical form is necessary.  In our case, we apply metrics to the results. <br><br>  Each reference query will be processed by approximately 50 metrics, which will combine the elements returned by the query.  Two metrics for example are the number of items returned and the average price of items returned.  A total of 3000 reference queries and 50 metrics are used ‚Äî that is, 150,000 values.  Currently, benchmark requests are issued every 4 hours or 6 times a day, so we have 900,000 values ‚Äã‚Äãper day.  Nowadays with terabyte databases is a ridiculous amount.  But the analysis of these values ‚Äã‚Äãfor the detection of anomalies, and with a low false positive rate, is quite a challenge. <br><br>  I will try to visually explain the approach used with charts and graphs.  The first image shows the monitored signals, that is, the combined values ‚Äã‚Äãof the metrics: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/257/8c0/19c/2578c019cbc54c03a47ca5c2d16dc7f4.png" alt="image"><br><br>  Each pair (query, metric) is a value that can be tracked over time, which is essentially a time series.  In total, this is 150,000 time series, and therefore it is reasonable to expect that during each 4-hour tracking period, at least one of the series will be defined as anomalous.  From which we can conclude that notifying about each anomalous time series does not make much sense, since this will lead to a large number of false positives. <br><br>  In our approach, we accumulate data, and the process begins with a very simple action: considering each time series and calculating the deviation between the last and expected value, which is calculated by extrapolating the previous values.  I call this ‚Äúsurprise‚Äù - the greater the deviation, the greater the surprise.  The image below shows a surprise for each triplet (query, metric, time). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bd4/d4f/065/bd4d4f0657ca1d7e0df93fca5c024d6a.png" alt="image"><br><br>  The essence of our anomaly detector is as follows: at each moment of receiving T data, we assume that there will be a great surprise value for several triplets (query, metric, T).  If an unusually high number of triplets with a high surprise value is detected, an anomaly notification will be sent.  To be able to quantify, we calculate the 90th percentile of surprise in time T for all 3000 queries of individual metrics: <img src="https://habrastorage.org/getpro/habr/post_images/178/5ba/73f/1785ba73f58beb0fed90c7647de43bd7.gif" alt="image">  . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fa8/9be/534/fa89be534011c2f8c27d09187718a811.png" alt="image"><br><br>  What gives a new time series of T for each metric.  The approximate time series for the first two metrics are shown below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/31f/1c2/977/31f1c2977147f68d7cd89eead8f33a01.png" alt="image"><br><br>  Thus, 150,000 time series were reduced to just 50. Such a combination of values ‚Äã‚Äãis a very convenient technique for detecting anomalies. <br><br>  At the end, the anomaly detector uses a simple check of the combined time series.  The presence of an anomaly is considered when the current value of any of the 50 rows is more than three times the variance of the mean value of this series.  Here is an example using eBay data with the average sales price metric.  Clearly noticeable anomaly at time T = 88. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2c1/641/6c7/2c16416c722479f6b8f9914a02981c03.png" alt="image"><br><br><h4>  Abstract </h4><br><ol><li>  Statistics is a tool for detecting anomalies. </li><li>  The statistical anomaly detector tracks characteristic changes that go beyond what is acceptable and sends notifications. </li><li>  At each moment of receiving data T, it is assumed that there will be a large value of surprise for several triplets. </li><li>  Combining the values ‚Äã‚Äãof time series is a convenient technique for detecting anomalies. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/265571/">https://habr.com/ru/post/265571/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265559/index.html">Long-Term Software Development: Requirements Management Problems</a></li>
<li><a href="../265561/index.html">Overview of alternatives Proof of Work. Part 1. Proof of Stake</a></li>
<li><a href="../265563/index.html">Sending messages through the VK API using PHP for the lazy</a></li>
<li><a href="../265565/index.html">Intel Parallel Studio XE 2016: New C / C ++ Compiler Features</a></li>
<li><a href="../265569/index.html">15 trivial facts about working correctly with the HTTP protocol</a></li>
<li><a href="../265573/index.html">Visual switching tabs in the assembly Vivaldi 1.0.257.3</a></li>
<li><a href="../265575/index.html">NW.js (Node-Webkit) + Rutoken = RutokenJS (Start)</a></li>
<li><a href="../265579/index.html">Work with color in vim</a></li>
<li><a href="../265583/index.html">Grokayem RxJava, part two: Operators</a></li>
<li><a href="../265587/index.html">Security Week 35: nothing personal, just business</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>