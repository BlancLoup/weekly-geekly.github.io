<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automate subtitle uploading from * .mkv files</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A couple of months ago, I had a TV with Samsung SmartTV. The device quickly became friends with the media center (the role of which is played by the P...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automate subtitle uploading from * .mkv files</h1><div class="post__text post__text-html js-mediator-article">  A couple of months ago, I had a TV with Samsung SmartTV.  The device quickly became friends with the media center (the role of which is played by the <a href="http://www.plexapp.com/">Plex Media Server</a> ) using a <a href="http://www.samsung.com/us/appstore/app/G00002687241">native application</a> , but almost immediately a very unpleasant flaw was discovered - the <a href="http://plexforsamsung.pbworks.com/w/page/47406366/FAQ">lack of support for embedded subtitles in * .mkv</a> .  The prospect of removing the subtitles from each file by the handles did not please me at all, and since the torrent client is running on the same machine as the media server, it was decided to automate the processing of downloaded movies. <br><br>  Under the cut there is a story about how using <s>30 lines of code on js of a</s> pair of shell scripts and a plug-in for Deluge to bring * mkv-files into a viewable for TV. <br><a name="habracut"></a><br><h4>  Initial data </h4><br>  So, we have: a headless machine with Ubuntu Server 12.04LTS, Deluge 1.3.5 and Plex Media Server 0.9.7.28 with a web interface.  For a start we will make a mini-TZ. <br><br>  Sequencing: <br><ol><li>  processing data on freshly downloaded torrent and extracting the list of * .mkv files; </li><li>  extract subtitles; </li><li>  Plex library update. </li></ol><br>  I would like to: <br><ul><li>  be able to extract subtitles for specific languages ‚Äã‚Äãonly; </li><li>  be able to manually feed an arbitrary file to the script. </li></ul><br><h4>  Deluge hook </h4><br>  In the basic Deluge installation there is an Execute plugin that allows you to execute an arbitrary script when adding a torrent and / or completing its download (documentation and examples can be viewed <a href="http://dev.deluge-torrent.org/wiki/Plugins/Execute">here</a> ).  We are only interested in the exact format of the arguments passed, which is not described in mans, but an example of which can be easily obtained using a test script: <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash echo -e "$1\n$2\n$3" &gt;&gt; /specshare/sample.txt</span></span></code> </pre> <br>  Save the script in some public directory (I used the custom directory <i>/ specshare</i> for this) under the name <i>testhook.sh</i> and give the necessary execution rights using <br><pre> <code class="bash hljs">sudo chmod +x testhook.sh</code> </pre><br>  Next, you need to connect the script.  For remote access to Deluge, I use a GTK client, in which the sequence of actions is as follows: <br><ol><li>  open Edit-Preferences-Plugins in it and put a tick in front of Execute, after which the corresponding item will appear in the Categories panel; </li><li>  in the Execute section, in the Event combo box, put Torrent Complete, in the Command field, specify the path to the script: <br><img src="https://habrastorage.org/getpro/habr/post_images/763/80b/1cd/76380b1cd8b3a995e23831f96d9f4d86.png"></li><li>  click Add, OK, then restart the daemon: <br><pre> <code class="bash hljs">sudo service deluged restart</code> </pre></li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The last step is necessary, otherwise the script simply will not be called, while correctly displayed in the settings.  Now we put a small torrent on the download and in the <i>sample.txt</i> file we get something like: <br><blockquote>  1759d534dbe371565632ec0cccbb1579d344c5ca <br>  Totally.Legal.Open.Source.Software.iso <br>  / store / distribs <br></blockquote><br>  The first parameter is the universal torrent identifier, which allows you to request additional information from the daemon.  The second is the name of the torrent;  as a rule, this is either the file name or the directory name (if there are several files in the distribution).  The third is the name of the parent folder for the torrent. <br><br>  Now that we know what the input parameters look like, create two files in the same directory where <i>testhook.sh</i> was <i>located</i> : <i>extractor.sh</i> and <i>deluge-movie-callback.sh</i> .  The first script will be responsible for directly extracting subtitles, and we will return to it a little later, and in the second file we will enter the following: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash torrentname=$2; torrentpath=$(readlink -f "$3"); fullpath="$torrentpath/$torrentname"; echo "============================" &gt;&gt; /specshare/log.txt; echo "$(date +"%D %T"): $1 $2 $3" &gt;&gt; /specshare/log.txt; echo "$(date +"%D %T"): $fullpath" &gt;&gt; /specshare/log.txt; if [[ "$fullpath" != /store/films/* ]]; then echo "$(date +"%D %T"): Invalid path" &gt;&gt; /specshare/log.txt; exit 0; fi; echo "$(date +"%D %T"): path ok" &gt;&gt; /specshare/log.txt; mkvlist=$(find "$fullpath" -type f | grep .mkv); while read -r fname; do /specshare/extractor.sh "$fname" "eng,rus,unk"; done &lt;&lt;&lt; "$mkvlist";</span></span></code> </pre><br>  Nothing too complicated happens here - we glue the full file name from the $ 3 and $ 2 arguments, resolve the symlinks (if there are any), validate the path (movies and only they are downloaded to the <i>/ store / films</i> directory, I do not need subtitles for the other video files) and for the obtained path, we request all nested mkv files.  After that, for each .mkv, run <b>extractor.sh</b> , passing as a parameter the path and the list of <a href="http://en.wikipedia.org/wiki/List_of_ISO_639-1_codes">ISO 639-1</a> codes for the required languages.  ‚ÄúUnk‚Äù is our own designation for a missing language, in case it is not specified for any streams with subtitles.  Script execution is logged. <br><br><div class="spoiler">  <b class="spoiler_title">A quick note about logs</b> <div class="spoiler_text">  Writing logs anywhere, in general, is not good, but we will sacrifice correctness for the sake of ease of access and simplicity (in my case / specshare shared via samba and with a minimum of gestures is available on the Windows desktop). </div></div><br><br><h4>  Extract subtitles </h4><br>  To extract the tracks with subtitles, use the <b>mkvtoolnix</b> package.  Installation is simple: <br><pre> <code class="bash hljs">sudo apt-get install mkvtoolnix</code> </pre><br>  We are interested in two utilities: <b>mkvmerge</b> and <b>mkvextract</b> .  The first allows you to get a list of threads in a container: <br><pre> <code class="bash hljs">mkvmerge -I &lt;filename&gt;</code> </pre><br>  Formal, the <b>mkvinfo</b> utility from the same package is intended for this purpose, but the output of <b>mkvmerge is</b> laconic and much better parseable.  At the output we will get something like this: <br><blockquote>  Track ID 1: video (V_MPEG4 / ISO / AVC) [language: eng track_name: The \ sMatrix \ s1999 \ s1080p \ sBluRay \ sDD5.1 ‚Äã‚Äã\ sx264-CtrlHD display_dimensions: 1280x532 default_track: 0 forced_track: 0 packetizer: mpeg4_p10_video default_duration: 41708332 ] <br>  Track ID 2: audio (A_AC3) [language: rus track_name: DUB-Blu-ray default_track: 1 forced_track: 0 default_duration: 32000000 audio_sampling_frequency: 48000 audio_channels: 6] <br>  &lt;many uninteresting audio tracks ...&gt; <br>  Track ID 9: audio (A_DTS) [language: eng track_name: Original default_track: 0 forced_track: 0 default_duration: 10666666 audio_sampling_frequency: 48000 audio_channels: 6] <br>  Track ID 10: subtitles (S_TEXT / UTF8) [language: rus track_name: Sub default_track: 0 forced_track: 0] <br>  Track ID 11: subtitles (S_TEXT / UTF8) [language: rus track_name: Sub- (by \ s \ 2 correct \ 2 \ stranslation \ sGoblin) default_track: 0 forced_track: 0] <br>  Track ID 12: subtitles (S_TEXT / UTF8) [language: eng track_name: Sub default_track: 0 forced_track: 0] <br>  Track ID 13: subtitles (S_TEXT / UTF8) [language: eng track_name: Sub-SDH default_track: 0 forced_track: 0] <br></blockquote><br>  We are interested in streams with the subtitles type and the S_TEXT / UTF8 codec, for which we need TrackID and a language code.  In addition to S_TEXT / UTF8, I have met subtitles with the encoding S_HDMV / PGS, but this is a rare bird, it requires conversion to srt, and therefore we will not consider subtitles of this type.  Interested offer to pay attention to the utility <a href="https://github.com/mjuhasz/BDSup2Sub">BDSup2Sub</a> . <br><br>  For direct extraction of the stream we use: <br><pre> <code class="bash hljs">mkvextract tracks &lt;filename&gt; &lt;trackId&gt;:&lt;subname&gt;</code> </pre><br>  The first two parameters (TrackID and the name of the container file) are pretty obvious, but with the third ‚Äî the name for the file with subtitles ‚Äî everything is a bit more complicated.  Here it is necessary to pause for a while and become familiar with the <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_Subtitles">rules for naming external subtitles in Plex</a> . <br><br>  According to the specification, the name of the subtitle should be <pre> <code class="hljs lua"><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">[[ "$1" != *.mkv ]]</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; fi; FORMAT_FULL=<span class="hljs-string"><span class="hljs-string">".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"</span></span>; FORMAT_SHORT=<span class="hljs-string"><span class="hljs-string">".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"</span></span>; baseName=${<span class="hljs-number"><span class="hljs-number">1</span></span>%.mkv}; requiredLangs=$(echo <span class="hljs-string"><span class="hljs-string">"$2"</span></span> | tr <span class="hljs-string"><span class="hljs-string">","</span></span> <span class="hljs-string"><span class="hljs-string">"\n"</span></span>); echo <span class="hljs-string"><span class="hljs-string">"$(date +"</span></span>%D %T<span class="hljs-string"><span class="hljs-string">"): $baseName"</span></span> &gt;&gt; /specshare/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.txt; counter=<span class="hljs-number"><span class="hljs-number">0</span></span>; tracks=$(mkvmerge -I <span class="hljs-string"><span class="hljs-string">"$1"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -r track; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> echo -e <span class="hljs-string"><span class="hljs-string">"$(date +"</span></span>%D %T<span class="hljs-string"><span class="hljs-string">"): $track"</span></span> &gt;&gt; /specshare/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.txt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">[[ $track =~ $FORMAT_FULL ]]</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> id=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">1</span></span>]}; tType=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">2</span></span>]}; lang=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">4</span></span>]}; codec=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">3</span></span>]}; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">[[ $track =~ $FORMAT_SHORT ]]</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> id=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">1</span></span>]}; tType=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">2</span></span>]}; codec=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">3</span></span>]}; lang=<span class="hljs-string"><span class="hljs-string">"unk"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> id=<span class="hljs-number"><span class="hljs-number">-1</span></span>; fi fi; langMatch=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; idMatch=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; typeMatch=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; codecMatch=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; shouldExtract=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> reqLang <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $requiredLangs; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> [ <span class="hljs-string"><span class="hljs-string">"$reqLang"</span></span> == <span class="hljs-string"><span class="hljs-string">"$lang"</span></span> ] &amp;&amp; langMatch=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; done [ <span class="hljs-string"><span class="hljs-string">"$tType"</span></span> == <span class="hljs-string"><span class="hljs-string">"subtitles"</span></span> ] &amp;&amp; typeMatch=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; [ <span class="hljs-string"><span class="hljs-string">"$codec"</span></span> == <span class="hljs-string"><span class="hljs-string">"S_TEXT/UTF8"</span></span> ] &amp;&amp; codecMatch=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; [ $id -ne <span class="hljs-number"><span class="hljs-number">-1</span></span> ] &amp;&amp; idMatch=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $shouldExtract ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> subName=<span class="hljs-string"><span class="hljs-string">"$baseName.$lang.srt"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -f <span class="hljs-string"><span class="hljs-string">"$subName"</span></span> -o <span class="hljs-string"><span class="hljs-string">"$lang"</span></span> == <span class="hljs-string"><span class="hljs-string">"unk"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> subName=<span class="hljs-string"><span class="hljs-string">"$baseName.$lang$counter.srt"</span></span>; (( counter++ )); fi mkvextract tracks <span class="hljs-string"><span class="hljs-string">"$1"</span></span> $id:<span class="hljs-string"><span class="hljs-string">"$subName"</span></span>; fi done &lt;&lt;&lt; <span class="hljs-string"><span class="hljs-string">"$tracks"</span></span></code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  <span class="hljs-number"><span class="hljs-number">2</span></span>     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   <span class="hljs-number"><span class="hljs-number">1</span></span>)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:<span class="hljs-number"><span class="hljs-number">32400</span></span>/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - <span class="hljs-number"><span class="hljs-number">3.</span></span> <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.13</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">32400</span></span>/library/sections/<span class="hljs-number"><span class="hljs-number">3</span></span>/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=<span class="hljs-number"><span class="hljs-number">1</span></span></code>  <code>?force=<span class="hljs-number"><span class="hljs-number">1</span></span></code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> </pre> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> <h4> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> </h4> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> <h5> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> </h5> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> <ol><li> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> </li> <li> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> </li> </ol> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> <h5> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> </h5> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> <pre> <code class="hljs lua"><code><code><code><code class="html"><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">[[ "$1" != *.mkv ]]</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; fi; FORMAT_FULL=<span class="hljs-string"><span class="hljs-string">".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"</span></span>; FORMAT_SHORT=<span class="hljs-string"><span class="hljs-string">".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"</span></span>; baseName=${<span class="hljs-number"><span class="hljs-number">1</span></span>%.mkv}; requiredLangs=$(echo <span class="hljs-string"><span class="hljs-string">"$2"</span></span> | tr <span class="hljs-string"><span class="hljs-string">","</span></span> <span class="hljs-string"><span class="hljs-string">"\n"</span></span>); echo <span class="hljs-string"><span class="hljs-string">"$(date +"</span></span>%D %T<span class="hljs-string"><span class="hljs-string">"): $baseName"</span></span> &gt;&gt; /specshare/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.txt; counter=<span class="hljs-number"><span class="hljs-number">0</span></span>; tracks=$(mkvmerge -I <span class="hljs-string"><span class="hljs-string">"$1"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -r track; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> echo -e <span class="hljs-string"><span class="hljs-string">"$(date +"</span></span>%D %T<span class="hljs-string"><span class="hljs-string">"): $track"</span></span> &gt;&gt; /specshare/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.txt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">[[ $track =~ $FORMAT_FULL ]]</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> id=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">1</span></span>]}; tType=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">2</span></span>]}; lang=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">4</span></span>]}; codec=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">3</span></span>]}; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">[[ $track =~ $FORMAT_SHORT ]]</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> id=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">1</span></span>]}; tType=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">2</span></span>]}; codec=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">3</span></span>]}; lang=<span class="hljs-string"><span class="hljs-string">"unk"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> id=<span class="hljs-number"><span class="hljs-number">-1</span></span>; fi fi; langMatch=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; idMatch=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; typeMatch=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; codecMatch=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; shouldExtract=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> reqLang <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $requiredLangs; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> [ <span class="hljs-string"><span class="hljs-string">"$reqLang"</span></span> == <span class="hljs-string"><span class="hljs-string">"$lang"</span></span> ] &amp;&amp; langMatch=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; done [ <span class="hljs-string"><span class="hljs-string">"$tType"</span></span> == <span class="hljs-string"><span class="hljs-string">"subtitles"</span></span> ] &amp;&amp; typeMatch=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; [ <span class="hljs-string"><span class="hljs-string">"$codec"</span></span> == <span class="hljs-string"><span class="hljs-string">"S_TEXT/UTF8"</span></span> ] &amp;&amp; codecMatch=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; [ $id -ne <span class="hljs-number"><span class="hljs-number">-1</span></span> ] &amp;&amp; idMatch=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $shouldExtract ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> subName=<span class="hljs-string"><span class="hljs-string">"$baseName.$lang.srt"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -f <span class="hljs-string"><span class="hljs-string">"$subName"</span></span> -o <span class="hljs-string"><span class="hljs-string">"$lang"</span></span> == <span class="hljs-string"><span class="hljs-string">"unk"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> subName=<span class="hljs-string"><span class="hljs-string">"$baseName.$lang$counter.srt"</span></span>; (( counter++ )); fi mkvextract tracks <span class="hljs-string"><span class="hljs-string">"$1"</span></span> $id:<span class="hljs-string"><span class="hljs-string">"$subName"</span></span>; fi done &lt;&lt;&lt; <span class="hljs-string"><span class="hljs-string">"$tracks"</span></span></code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  <span class="hljs-number"><span class="hljs-number">2</span></span>     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   <span class="hljs-number"><span class="hljs-number">1</span></span>)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> http://&lt;serverIP&gt;:<span class="hljs-number"><span class="hljs-number">32400</span></span>/library/sections/&lt;sectionId&gt;/refresh <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - <span class="hljs-number"><span class="hljs-number">3.</span></span> <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.13</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">32400</span></span>/library/sections/<span class="hljs-number"><span class="hljs-number">3</span></span>/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=<span class="hljs-number"><span class="hljs-number">1</span></span></code>  <code>?force=<span class="hljs-number"><span class="hljs-number">1</span></span></code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code></code> </pre> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> <pre> <code class="hljs lua"><code><code><code><code class="bash"><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">[[ "$1" != *.mkv ]]</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; fi; FORMAT_FULL=<span class="hljs-string"><span class="hljs-string">".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"</span></span>; FORMAT_SHORT=<span class="hljs-string"><span class="hljs-string">".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"</span></span>; baseName=${<span class="hljs-number"><span class="hljs-number">1</span></span>%.mkv}; requiredLangs=$(echo <span class="hljs-string"><span class="hljs-string">"$2"</span></span> | tr <span class="hljs-string"><span class="hljs-string">","</span></span> <span class="hljs-string"><span class="hljs-string">"\n"</span></span>); echo <span class="hljs-string"><span class="hljs-string">"$(date +"</span></span>%D %T<span class="hljs-string"><span class="hljs-string">"): $baseName"</span></span> &gt;&gt; /specshare/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.txt; counter=<span class="hljs-number"><span class="hljs-number">0</span></span>; tracks=$(mkvmerge -I <span class="hljs-string"><span class="hljs-string">"$1"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -r track; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> echo -e <span class="hljs-string"><span class="hljs-string">"$(date +"</span></span>%D %T<span class="hljs-string"><span class="hljs-string">"): $track"</span></span> &gt;&gt; /specshare/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.txt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">[[ $track =~ $FORMAT_FULL ]]</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> id=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">1</span></span>]}; tType=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">2</span></span>]}; lang=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">4</span></span>]}; codec=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">3</span></span>]}; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">[[ $track =~ $FORMAT_SHORT ]]</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> id=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">1</span></span>]}; tType=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">2</span></span>]}; codec=${BASH_REMATCH[<span class="hljs-number"><span class="hljs-number">3</span></span>]}; lang=<span class="hljs-string"><span class="hljs-string">"unk"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> id=<span class="hljs-number"><span class="hljs-number">-1</span></span>; fi fi; langMatch=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; idMatch=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; typeMatch=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; codecMatch=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; shouldExtract=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> reqLang <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $requiredLangs; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> [ <span class="hljs-string"><span class="hljs-string">"$reqLang"</span></span> == <span class="hljs-string"><span class="hljs-string">"$lang"</span></span> ] &amp;&amp; langMatch=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; done [ <span class="hljs-string"><span class="hljs-string">"$tType"</span></span> == <span class="hljs-string"><span class="hljs-string">"subtitles"</span></span> ] &amp;&amp; typeMatch=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; [ <span class="hljs-string"><span class="hljs-string">"$codec"</span></span> == <span class="hljs-string"><span class="hljs-string">"S_TEXT/UTF8"</span></span> ] &amp;&amp; codecMatch=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; [ $id -ne <span class="hljs-number"><span class="hljs-number">-1</span></span> ] &amp;&amp; idMatch=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $shouldExtract ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> subName=<span class="hljs-string"><span class="hljs-string">"$baseName.$lang.srt"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -f <span class="hljs-string"><span class="hljs-string">"$subName"</span></span> -o <span class="hljs-string"><span class="hljs-string">"$lang"</span></span> == <span class="hljs-string"><span class="hljs-string">"unk"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> subName=<span class="hljs-string"><span class="hljs-string">"$baseName.$lang$counter.srt"</span></span>; (( counter++ )); fi mkvextract tracks <span class="hljs-string"><span class="hljs-string">"$1"</span></span> $id:<span class="hljs-string"><span class="hljs-string">"$subName"</span></span>; fi done &lt;&lt;&lt; <span class="hljs-string"><span class="hljs-string">"$tracks"</span></span></code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  <span class="hljs-number"><span class="hljs-number">2</span></span>     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   <span class="hljs-number"><span class="hljs-number">1</span></span>)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:<span class="hljs-number"><span class="hljs-number">32400</span></span>/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - <span class="hljs-number"><span class="hljs-number">3.</span></span> <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> wget -qO - http://<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.13</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">32400</span></span>/library/sections/<span class="hljs-number"><span class="hljs-number">3</span></span>/refresh &gt;&gt; /dev/null ; <br>    URL  <code>?deep=<span class="hljs-number"><span class="hljs-number">1</span></span></code>  <code>?force=<span class="hljs-number"><span class="hljs-number">1</span></span></code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code></code> </pre> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> <ul><li> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> </li> <li> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> </li> <li> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> </li> <li> <code><code><code><code><code class="bash">..srt, <br>       .   ,            .  ,    -      ,        ,    (      ).    :         ,       -    .   ,  ,  . <br> <br>   <i>extractor.sh</i>    : <br> #!/bin/bash if [[ "$1" != *.mkv ]]; then exit 0; fi; FORMAT_FULL=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\).*language:([[:alpha:]]+)"; FORMAT_SHORT=".*ID[[:space:]]([[:digit:]]+):[[:space:]]([[:alpha:]]+)[[:space:]]\((.*)\)"; baseName=${1%.mkv}; requiredLangs=$(echo "$2" | tr "," "\n"); echo "$(date +"%D %T"): $baseName" &gt;&gt; /specshare/log.txt; counter=0; tracks=$(mkvmerge -I "$1"); while read -r track; do echo -e "$(date +"%D %T"): $track" &gt;&gt; /specshare/log.txt; if [[ $track =~ $FORMAT_FULL ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; lang=${BASH_REMATCH[4]}; codec=${BASH_REMATCH[3]}; else if [[ $track =~ $FORMAT_SHORT ]]; then id=${BASH_REMATCH[1]}; tType=${BASH_REMATCH[2]}; codec=${BASH_REMATCH[3]}; lang="unk"; else id=-1; fi fi; langMatch=false; idMatch=false; typeMatch=false; codecMatch=false; shouldExtract=false; for reqLang in $requiredLangs; do [ "$reqLang" == "$lang" ] &amp;&amp; langMatch=true; done [ "$tType" == "subtitles" ] &amp;&amp; typeMatch=true; [ "$codec" == "S_TEXT/UTF8" ] &amp;&amp; codecMatch=true; [ $id -ne -1 ] &amp;&amp; idMatch=true; $langMatch &amp;&amp; $idMatch &amp;&amp; $typeMatch &amp;&amp; $codecMatch &amp;&amp; shouldExtract=true; if $shouldExtract ; then subName="$baseName.$lang.srt" if [ -f "$subName" -o "$lang" == "unk" ]; then subName="$baseName.$lang$counter.srt"; (( counter++ )); fi mkvextract tracks "$1" $id:"$subName"; fi done &lt;&lt;&lt; "$tracks"</code> <br>  :    ,      ,     //,  .  ,        capturing groups  POSIX- ,  ,     ,     .      ,   . <br> <br> ,        .      -     Plex. <br> <br>   <br>   <br>    Plex Media Server   <code>Plex Media Scanner</code> ,   <code>/usr/lib/plexmediaserver/</code> ,   <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">      </a> .  ,     : <br>  <a href="http://forums.plexapp.com/index.php/topic/41968-error-while-loading-shared-libraries/"></a>    ;    -   , -    PMS; <br>      ,      .  2     <code>sudoers</code> -            sudo.  ,          <code>LD_LIBRARY_PATH</code> (   1)  Deluge,   ,      . <br>      ,  ,     ,     ... <br> <br>   GET- <br> - PMS,   UI   , <a href="http://wiki.plexapp.com/index.php/PlexNine_AdvancedInfo">  GET-   URL   </a> .   URL    : <br> <code class="html">http://&lt;serverIP&gt;:32400/library/sections/&lt;sectionId&gt;/refresh</code> <br>  <code>sectionId</code> -       PMS.   ,       -       <br> <img src="http://habrastorage.org/storage3/5d3/f18/51b/5d3f1851b4d44553e3786e2f05086e83.png"> <br>        - 3. <br> <br> ,    ,   <i>deluge-movie-callback.sh</i>     -  <br> <code class="bash">wget -qO - http://192.168.13.1:32400/library/sections/3/refresh &gt;&gt; /dev/null ;</code> <br>    URL  <code>?deep=1</code>  <code>?force=1</code> <a href="http://wiki.plexapp.com/index.php/PlexNine_PMS_MediaManager">   .</a> <br> <br>     ,         <i>deluge-movie-callback.sh</i>   Execute.    ,         . <br> <br>  . <br>           . ,  ,    ,            -  ,    .   -    ,        .  ,       .   Deluge       ,      <b></b> ,      .       Label.          ,    ,     ,  ,      <b>deluged</b> ,        .    ,  c  <code>sudo su -      .</code> <br></code></code></code></code> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/202870/">https://habr.com/ru/post/202870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202858/index.html">Create a galaxy in 30 lines.</a></li>
<li><a href="../202860/index.html">Another Tetris on JS (~ 30 "conditional" lines)</a></li>
<li><a href="../202864/index.html">Minimize apps to dock for lazy using AppleScript</a></li>
<li><a href="../202866/index.html">Meet Dependency Injection with the Dagger example</a></li>
<li><a href="../202868/index.html">Testing: a clear career choice</a></li>
<li><a href="../202874/index.html">Tiny Tron on JS (30 lines of code)</a></li>
<li><a href="../202876/index.html">Upgrading Nexus 4 to Android 4.4 on Linux</a></li>
<li><a href="../202878/index.html">What do bad security managers do?</a></li>
<li><a href="../202880/index.html">Git to help admin lokalkhost</a></li>
<li><a href="../202884/index.html">Overcoming the hidden dangers of KVO in Objective C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>